/*!
*  filename: ej2-gantt.min.js
*  version : 26.2.14
*  Copyright Syncfusion Inc. 2001 - 2023. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("SyncfusionBase"),require("SyncfusionPopups"),require("SyncfusionGrids"),require("SyncfusionData"),require("SyncfusionTreegrid"),require("SyncfusionSvgBase"),require("SyncfusionLayouts"),require("SyncfusionNavigations"),require("SyncfusionRichtexteditor"),require("SyncfusionInputs"),require("SyncfusionButtons"),require("SyncfusionCalendars"),require("SyncfusionDropdowns"),require("SyncfusionPdfExport")):"function"==typeof define&&define.amd?define(["SyncfusionBase","SyncfusionPopups","SyncfusionGrids","SyncfusionData","SyncfusionTreegrid","SyncfusionSvgBase","SyncfusionLayouts","SyncfusionNavigations","SyncfusionRichtexteditor","SyncfusionInputs","SyncfusionButtons","SyncfusionCalendars","SyncfusionDropdowns","SyncfusionPdfExport"],t):"object"==typeof exports?exports.SyncfusionGantt=t(require("SyncfusionBase"),require("SyncfusionPopups"),require("SyncfusionGrids"),require("SyncfusionData"),require("SyncfusionTreegrid"),require("SyncfusionSvgBase"),require("SyncfusionLayouts"),require("SyncfusionNavigations"),require("SyncfusionRichtexteditor"),require("SyncfusionInputs"),require("SyncfusionButtons"),require("SyncfusionCalendars"),require("SyncfusionDropdowns"),require("SyncfusionPdfExport")):e.SyncfusionGantt=t(e.SyncfusionBase,e.SyncfusionPopups,e.SyncfusionGrids,e.SyncfusionData,e.SyncfusionTreegrid,e.SyncfusionSvgBase,e.SyncfusionLayouts,e.SyncfusionNavigations,e.SyncfusionRichtexteditor,e.SyncfusionInputs,e.SyncfusionButtons,e.SyncfusionCalendars,e.SyncfusionDropdowns,e.SyncfusionPdfExport)}(self,((e,t,i,r,a,n,s,o,l,d,h,p,u,c)=>(()=>{"use strict";var g={766:t=>{t.exports=e},741:e=>{e.exports=h},570:e=>{e.exports=p},74:e=>{e.exports=r},778:e=>{e.exports=u},707:e=>{e.exports=i},323:e=>{e.exports=d},40:e=>{e.exports=s},215:e=>{e.exports=o},461:e=>{e.exports=c},197:e=>{e.exports=t},674:e=>{e.exports=l},727:e=>{e.exports=n},465:e=>{e.exports=a}},f={};function m(e){var t=f[e];if(void 0!==t)return t.exports;var i=f[e]={exports:{}};return g[e](i,i.exports,m),i.exports}m.d=(e,t)=>{for(var i in t)m.o(t,i)&&!m.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var y={};return(()=>{m.r(y),m.d(y,{AddDialogFieldSettings:()=>et,Column:()=>Ze,ColumnMenu:()=>_i,ContextMenu:()=>zi,CriticalPath:()=>Hi,DayMarkers:()=>Wi,DayWorkingTime:()=>Ke,Dependency:()=>$t,Edit:()=>Oi,EditDialogFieldSettings:()=>rt,EditSettings:()=>st,EventMarker:()=>dt,ExcelExport:()=>qi,Filter:()=>Ui,FilterSettings:()=>ut,Gantt:()=>li,Holiday:()=>Dt,LabelSettings:()=>wt,LoadingIndicator:()=>Zt,PdfBorders:()=>Ki,PdfExport:()=>Cr,PdfGanttTheme:()=>Yi,PdfHorizontalOverflowType:()=>k,PdfPaddings:()=>Ji,PdfTreeGridCell:()=>or,PdfTreeGridCellCollection:()=>lr,PdfTreeGridColumn:()=>ur,PdfTreeGridColumnCollection:()=>cr,PdfTreeGridHeaderCollection:()=>pr,PdfTreeGridLayoutFormat:()=>ar,PdfTreeGridLayoutResult:()=>rr,PdfTreeGridLayouter:()=>ir,PdfTreeGridRow:()=>dr,PdfTreeGridRowCollection:()=>hr,PdfTreeGridStyle:()=>er,PdfTreeGridStyleBase:()=>$i,Reorder:()=>Ii,Resize:()=>Fi,ResourceFields:()=>zt,RowDD:()=>Zi,SearchSettings:()=>ft,Selection:()=>Li,SelectionSettings:()=>Pt,Sort:()=>Ni,SortDescriptor:()=>Wt,SortSettings:()=>Ht,SplitterSettings:()=>Rt,TaskFields:()=>Ot,TemporaryDictionary:()=>Qi,TimelineSettings:()=>Ut,TimelineTierSettings:()=>Ft,Toolbar:()=>Vi,TooltipSettings:()=>Vt,UndoRedo:()=>Gi,VirtualScroll:()=>Rr,WeekWorkingTime:()=>Qt,formatString:()=>p,getIndex:()=>u,getSwapKey:()=>o,getTaskData:()=>d,getUid:()=>D,isCountRequired:()=>s,isRemoteData:()=>l,isScheduledTask:()=>n,keyPressed:()=>ci,load:()=>di,parentsUntil:()=>a,pixelToPoint:()=>c,pointToPixel:()=>g,queryCellInfo:()=>pi,rowDataBound:()=>hi,toolbarClick:()=>ui,updateDates:()=>h});var e=m(766),t=m(197),i=m(707),r=m(74);function a(e,t,i){for(var r=e;r&&!(i?r.id===t:r.classList.contains(t));)r=r.parentElement;return r}function n(t){return(0,e.isNullOrUndefined)(t.startDate)&&(0,e.isNullOrUndefined)(t.endDate)&&(0,e.isNullOrUndefined)(t.duration)?null:!((0,e.isNullOrUndefined)(t.startDate)||(0,e.isNullOrUndefined)(t.endDate)||(0,e.isNullOrUndefined)(t.duration))}function s(e){return!(!e.dataSource||e.dataSource instanceof r.DataManager||!("result"in e.dataSource))}function o(e){for(var t={},i=0,r=Object.keys(e);i<r.length;i++){var a=r[i];t[e[a]]=a}return t}function l(e){if(e instanceof r.DataManager){var t=e.adaptor;return t instanceof r.ODataAdaptor||t instanceof r.ODataV4Adaptor||t instanceof r.WebApiAdaptor||t instanceof r.WebMethodAdaptor||t instanceof r.CacheAdaptor||t instanceof r.RemoteSaveAdaptor||t instanceof r.UrlAdaptor}return!1}function d(t,i,r,a){if(r){for(var n=void 0,s=0;s<t.length;s++){n=o=i?t[parseInt(s.toString(),10)].taskData:(0,e.extend)({},t[parseInt(s.toString(),10)].taskData,{},!0)}return n}for(n=[],s=0;s<t.length;s++){!(0,e.isNullOrUndefined)(a)&&a.timezone&&h(t[s],a);var o=i?t[parseInt(s.toString(),10)].taskData:(0,e.extend)({},t[parseInt(s.toString(),10)].taskData,{},!0);n.push(o)}return n}function h(t,i){return t&&!(0,e.isNullOrUndefined)(t.ganttProperties)&&(t.taskData[i.taskFields.startDate]=i.dateValidationModule.remove(t.ganttProperties.startDate,i.timezone),null!==i.taskFields.endDate&&(t.taskData[i.taskFields.endDate]=i.dateValidationModule.remove(t.ganttProperties.endDate,i.timezone)),(i.taskFields.baselineEndDate||i.taskFields.baselineStartDate)&&(t.taskData[i.taskFields.baselineStartDate]=i.dateValidationModule.remove(t.ganttProperties.baselineStartDate,i.timezone),t.taskData[i.taskFields.baselineEndDate]=i.dateValidationModule.remove(t.ganttProperties.baselineEndDate,i.timezone))),null}function p(e,t){for(var i,r=0;r<t.length;r++)i=new RegExp("\\{"+r+"\\}","gm"),e=e.replace(i,t[r].toString());return e}function u(t,i,r,a){for(var n=-1,s=0;s<r.length;s++)if((0,e.getValue)(i,r[s])===(0,e.getValue)(i,t)&&(0,e.isNullOrUndefined)(a)||!(0,e.isNullOrUndefined)(a)&&(0,e.getValue)(i,r[s])===(0,e.getValue)(i,t)&&(0,e.getValue)(a,r[s])===(0,e.getValue)(a,t)){n=s;break}return n}function c(e){return 76*e/92}function g(e){return 92*e/76}var f=0;function D(){return f++}var v,k,w=function(){function t(e){this.fromSegments=!1,this.mondayTimeRangeLength=0,this.tuesdayTimeRangeLength=0,this.wednesdayTimeRangeLength=0,this.thursdayTimeRangeLength=0,this.fridayTimeRangeLength=0,this.saturdayTimeRangeLength=0,this.sundayTimeRangeLength=0,this.parent=e}return t.prototype.isValidateNonWorkDays=function(t){return!(0,e.isNullOrUndefined)(t)&&t.isAutoSchedule&&(!this.parent.includeWeekend||this.parent.totalHolidayDates.length>0)||(0,e.isNullOrUndefined)(t)&&(!this.parent.includeWeekend||this.parent.totalHolidayDates.length>0)},t.prototype.checkStartDate=function(t,i,r,a){if((0,e.isNullOrUndefined)(t))return null;var n,s=new Date(t.getTime()),o=this.parent.getCurrentDayStartTime(s),l=this.parent.getCurrentDayEndTime(s),d=new Date(t.getTime()),h=this.getSecondsInDecimal(d);if(r=(0,e.isNullOrUndefined)(r)?!(0,e.isNullOrUndefined)(i)&&i.isMilestone:r,h<o&&(!r||a))this.setTime(o,d);else if(h<o&&r)this.setTime(o,d);else if(h===l&&(!i||!r)||h>l)d.setDate(d.getDate()+1),o=this.parent.getCurrentDayStartTime(d),this.setTime(o,d);else if(h>o&&h<l){var p=this.parent.workingTimeRanges;this.parent.weekWorkingTime.length>0&&(p=this.parent.getWorkingRange(d));for(var u=0;u<p.length;u++){var c=p[u];if(h>=c.to&&p[u+1]&&h<p[u+1].from){(h!==c.to||i&&r)&&h===c.to||this.setTime(p[u+1].from,d);break}}}if(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)return new Date(d.getTime());do{n=new Date(d.getTime());var g=this.parent.totalHolidayDates.length;if(this.isValidateNonWorkDays(i)){o=this.parent.getCurrentDayStartTime(n),i&&(l=this.parent.getCurrentDayEndTime(i.endDate?i.isAutoSchedule?i.endDate:i.autoEndDate:n));var f=!r||a?o:l;if(!this.parent.includeWeekend){var m=new Date(d.getTime());d=this.getNextWorkingDay(d),f=this.parent.getCurrentDayStartTime(d),m.getTime()===d.getTime()||r||this.setTime(f,d)}for(var y=0;y<g;y++){var D=this.getDateFromFormat(new Date(this.parent.totalHolidayDates[y])),v=new Date(D.getTime());D.setHours(0,0,0,0),v.setHours(23,59,59,59),d.getTime()>=D.getTime()&&d.getTime()<v.getTime()&&(d.setDate(d.getDate()+1),f=this.parent.getCurrentDayStartTime(d),this.setTime(f,d))}}}while(n.getTime()!==d.getTime());return new Date(d.getTime())},t.prototype.checkEndDate=function(t,i,r){if((0,e.isNullOrUndefined)(t))return null;var a,n;if(this.parent.weekWorkingTime.length>0){var s=t;(!this.parent.includeWeekend&&i&&i.isAutoSchedule||this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.taskBarEditRecord&&!this.parent.editModule.taskbarEditModule.taskBarEditRecord.ganttProperties.isAutoSchedule)&&(s=this.getNextWorkingDay(t)),a=this.parent.getStartTime(s),n=this.parent.getEndTime(s)}else a=this.parent.defaultStartTime,n=this.parent.defaultEndTime;var o,l=new Date(t.getTime()),d=this.getSecondsInDecimal(l);if(d>n)this.setTime(n,l);else if(d<=a&&!r){var h=this.parent.taskFields;this.parent.editModule&&this.parent.editModule.editedRecord&&!this.parent.editModule.editedRecord[h.startDate]&&this.parent.editModule.editedRecord[h.endDate]?l.setDate(l.getDate()):l.setDate(l.getDate()-1),n=this.parent.getCurrentDayEndTime(l),this.setTime(n,l)}else if(d>a&&d<n)for(var p=0;p<this.parent.workingTimeRanges.length;p++){if(d>this.parent.workingTimeRanges[p].to&&this.parent.workingTimeRanges[p+1]&&d<=this.parent.workingTimeRanges[p+1].from){this.setTime(this.parent.workingTimeRanges[p].to,l);break}}if(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)return(0,e.isNullOrUndefined)(l)||(n=this.parent.getCurrentDayEndTime(t),this.setTime(n,l)),new Date(l.getTime());do{o=new Date(l.getTime());var u=this.parent.totalHolidayDates.length;if(this.isValidateNonWorkDays(i)){if(!this.parent.includeWeekend){var c=new Date(l.getTime());l=this.getPreviousWorkingDay(l),n=this.parent.getCurrentDayEndTime(l),c.getTime()!==l.getTime()&&this.setTime(n,l)}for(var g=0;g<u;g++){var f=this.getDateFromFormat(new Date(this.parent.totalHolidayDates[g])),m=new Date(f.getTime()),y=new Date(l.getTime());y.setMinutes(l.getMilliseconds()-2),f.setHours(0,0,0,0),m.setHours(23,59,59,59),(l.getTime()>=f.getTime()&&l.getTime()<m.getTime()||y.getTime()>=f.getTime()&&y.getTime()<m.getTime())&&(l.setDate(l.getDate()-1),n=this.parent.getCurrentDayEndTime(l),l.getTime()===f.getTime()&&86400===n&&0===this.getSecondsInDecimal(l)||this.setTime(n,l))}}}while(o.getTime()!==l.getTime());return new Date(l.getTime())},t.prototype.checkBaselineStartDate=function(t,i){if((0,e.isNullOrUndefined)(t))return null;var r=this.parent.getCurrentDayStartTime(t),a=this.parent.getCurrentDayEndTime(i&&i.endDate?i.isAutoSchedule?i.endDate:i.autoEndDate:t),n=new Date(t.getTime()),s=this.getSecondsInDecimal(n);if(s<r)this.setTime(r,n);else if(s>a)n.setDate(n.getDate()+1),r=this.parent.weekWorkingTime.length>0?this.parent.getStartTime(n):this.parent.defaultStartTime,this.setTime(r,n);else if(s>r&&s<a)for(var o=0;o<this.parent.workingTimeRanges.length;o++){if(s>this.parent.workingTimeRanges[o].to&&this.parent.workingTimeRanges[o+1]&&s<this.parent.workingTimeRanges[o+1].from){this.setTime(this.parent.workingTimeRanges[o+1].from,n);break}}return n},t.prototype.checkBaselineEndDate=function(t,i){if((0,e.isNullOrUndefined)(t))return null;var r=this.parent.getCurrentDayEndTime(t),a=this.parent.getCurrentDayStartTime(i&&i.startDate?i.isAutoSchedule?i.startDate:i.autoStartDate:t),n=new Date(t.getTime()),s=this.getSecondsInDecimal(n);if(s>r)this.setTime(r,n);else if(s<a&&!(0,e.isNullOrUndefined)(i)&&!i.isMilestone)n.setDate(n.getDate()-1),r=this.parent.getCurrentDayEndTime(n),this.setTime(r,n);else if(s>a&&s<r)for(var o=0;o<this.parent.workingTimeRanges.length;o++){if(s>this.parent.workingTimeRanges[o].to&&this.parent.workingTimeRanges[o+1]&&s<=this.parent.workingTimeRanges[o+1].from){this.setTime(this.parent.workingTimeRanges[o].to,n);break}}return i&&i.baselineStartDate&&n&&i.baselineStartDate.getTime()>n.getTime()&&n.setDate(n.getDate()+1),n},t.prototype.calculateStartDate=function(t){var i=t.ganttProperties,r=null;(0,e.isNullOrUndefined)(i.endDate)||(0,e.isNullOrUndefined)(i.duration)||(r=this.getStartDate(i.endDate,i.duration,i.durationUnit,i)),this.parent.setRecordValue("startDate",r,i,!0),this.parent.taskFields.startDate&&this.parent.dataOperation.updateMappingData(t,"startDate")},t.prototype.calculateEndDate=function(t){var i,r,a=t.ganttProperties,n=null;if((0,e.isNullOrUndefined)(a.startDate))n=t[this.parent.taskFields.endDate],(0,e.isNullOrUndefined)(n)||(r=this.parent.getCurrentDayEndTime(n),this.setTime(r,n)),this.parent.setRecordValue("endDate",n,a,!0);else{if(!(0,e.isNullOrUndefined)(a.endDate)&&(0,e.isNullOrUndefined)(a.duration)&&(1===this.compareDates(a.startDate,a.endDate)&&(this.parent.setRecordValue("startDate",new Date(a.endDate.getTime()),a,!0),i=this.parent.getCurrentDayStartTime(a.isAutoSchedule?a.autoStartDate:a.startDate),r=this.parent.getCurrentDayEndTime(a.isAutoSchedule?a.autoEndDate:a.endDate),this.setTime(i,a.startDate)),this.calculateDuration(t)),!(0,e.isNullOrUndefined)(a.duration)){var s=!(0,e.isNullOrUndefined)(a.segments)&&a.segments.length>1?this.totalDuration(a.segments):a.duration;n=this.getEndDate(a.startDate,s,a.durationUnit,a,!1)}this.parent.setRecordValue("endDate",n,a,!0)}this.parent.taskFields.endDate&&this.parent.dataOperation.updateMappingData(t,"endDate")},t.prototype.totalDuration=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].duration+e[i].offsetDuration;return t},t.prototype.calculateDuration=function(t){var i,r=t.ganttProperties;i=!(0,e.isNullOrUndefined)(r.segments)&&r.segments.length>0&&!(0,e.isNullOrUndefined)(this.parent.editModule.taskbarEditModule)?this.parent.editModule.taskbarEditModule.sumOfDuration(r.segments):(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||(0,e.isNullOrUndefined)(r.startDate)||(0,e.isNullOrUndefined)(r.endDate)||r.startDate.getTime()!==r.endDate.getTime()||!1!==t.taskData[this.parent.taskFields.milestone]?this.getDuration(r.startDate,r.endDate,r.durationUnit,r.isAutoSchedule,r.isMilestone):1,this.parent.setRecordValue("duration",i,r,!0);var a=this.parent.columnByField[this.parent.columnMapping.duration];if(!((0,e.isNullOrUndefined)(this.parent.editModule)||(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule)||this.parent.editModule.cellEditModule.isCellEdit||(0,e.isNullOrUndefined)(a))){if(!(0,e.isNullOrUndefined)(a.edit)&&!(0,e.isNullOrUndefined)(a.edit.read)){var n=this.parent.editModule.dialogModule.dialog;if(!(0,e.isNullOrUndefined)(n)){var s=n.querySelector("#"+this.parent.element.id+"Duration").ej2_instances[0];(0,e.isNullOrUndefined)(s)||s.value===i.toString()||(s.value=i.toString(),s.dataBind())}}this.parent.taskFields.duration&&(this.parent.dataOperation.updateMappingData(t,"duration"),this.parent.taskFields.durationUnit&&this.parent.dataOperation.updateMappingData(t,"durationUnit"))}},t.prototype.getNonworkingTime=function(t,i,r,a){a=!!(0,e.isNullOrUndefined)(a)||a;var n=this.parent.includeWeekend||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||!r?0:this.getWeekendCount(t,i),s=this.getNumberOfSeconds(t,i,a),o=!r||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?0:this.getHolidaysCount(t,i),l=(s-86400*n-86400*o)/86400,d=this.getNonWorkingSecondsOnDate(t,i,r);return(this.parent.weekWorkingTime.length>0?this.nonWorkingSeconds(t,i,r,l):l*(86400-this.parent.secondsPerDay))+86400*n+86400*o+d},t.prototype.nonWorkingSeconds=function(t,i,r,a,n){var s=t.getTime()>i.getTime()?new Date(i.getTime()):new Date(t.getTime()),o=t.getTime()>i.getTime()?new Date(t.getTime()):new Date(i.getTime()),l=0,d=0;if(n){var h=this.parent.getCurrentDayStartTime(s),p=this.parent.getCurrentDayEndTime(s);s.getHours()<p/3600&&s.getHours()>=h/3600||s.setDate(s.getDate()+1)}else s.setDate(s.getDate()+1),s.setHours(0,0,0,0),o.setHours(0,0,0,0);if(!(a>0||(0,e.isNullOrUndefined)(a)))return 0;for(;n&&s.getTime()<=o.getTime()||!n&&s.getTime()<o.getTime();){if(r){if(this.isOnHolidayOrWeekEnd(s,!0))do{s.setDate(s.getDate()+1)}while(this.isOnHolidayOrWeekEnd(s,!0));this.parent.includeWeekend||this.getNextWorkingDay(s)}if(s.getTime()<=o.getTime()){d++;var u=this.parent.getSecondsPerDay(s);if(l+=n?u:86400-u,s.setDate(s.getDate()+1),r){if(this.isOnHolidayOrWeekEnd(s,!0))do{s.setDate(s.getDate()+1)}while(this.isOnHolidayOrWeekEnd(s,!0));this.parent.includeWeekend||this.getNextWorkingDay(s)}}}return n&&(l>0?l/=d:l=this.parent.secondsPerDay),l},t.prototype.getDuration=function(t,i,r,a,n,s){if((0,e.isNullOrUndefined)(t)||(0,e.isNullOrUndefined)(i))return null;s=!!(0,e.isNullOrUndefined)(s)||s;var o,l=0,d=this.getTimeDifference(t,i,s)/1e3-this.getNonworkingTime(t,i,a,s);return o=this.parent.weekWorkingTime.length>0?this.nonWorkingSeconds(t,i,a,void 0,!0):this.parent.secondsPerDay,l=n&&this.parent.getFormatedDate(t)===this.parent.getFormatedDate(i)?0:r&&"day"!==r?"minute"===r?d/60:d/3600:d/o,parseFloat(l.toString())},t.prototype.getDurationAsSeconds=function(e,t,i){var r;return r=this.parent.weekWorkingTime.length>0?this.parent.getSecondsPerDay(i):this.parent.secondsPerDay,t&&"day"!==t.toLocaleLowerCase()?"hour"===t.toLocaleLowerCase()?3600*e:60*e:r*e},t.prototype.getEndDate=function(e,t,i,r,a){var n,s=new Date(e.getTime()),o=new Date(e.getTime()),l=new Date(e.getTime());n=this.parent.weekWorkingTime.length>0&&(!i||"day"===i.toLocaleLowerCase())?this.calculateSecondDuration(t,l,n,e,!0):this.getDurationAsSeconds(t,i,e);for(;n>0;)o.setSeconds(o.getSeconds()+n),(n-=n-this.getNonworkingTime(s,o,r.isAutoSchedule,!0))>0&&(o=this.checkStartDate(o,r,a)),s=new Date(o.getTime());return o},t.prototype.getStartDate=function(e,t,i,r,a){var n,s=new Date(e.getTime()),o=new Date(e.getTime()),l=new Date(s.getTime());n=this.parent.weekWorkingTime.length>0?this.calculateSecondDuration(t,l,n,s,!1):this.getDurationAsSeconds(t,i,s);for(;n>0;)o.setSeconds(o.getSeconds()-n),(n-=n-this.getNonworkingTime(o,s,r.isAutoSchedule,!0))>0&&(s=this.checkEndDate(o,r)),s=new Date(o.getTime());if(a&&r.isMilestone){o.setDate(o.getDate()-1);var d=this.parent.getCurrentDayEndTime(r.endDate?r.isAutoSchedule?r.endDate:r.autoEndDate:o);this.parent.dateValidationModule.setTime(d,o),o=this.parent.dateValidationModule.checkStartDate(o,r,!0)}return o},t.prototype.calculateSecondDuration=function(e,t,i,r,a){if(e<1)i=this.parent.getSecondsPerDay(t)*e;else{i=0;var n=e,s=this.parent.getCurrentDayStartTime(t),o=this.parent.getCurrentDayEndTime(t);for(t.getHours()<o/3600&&t.getHours()>s/3600||!this.fromSegments||(a?t.setDate(t.getDate()+1):t.setDate(t.getDate()-1));n>0;){if(this.isOnHolidayOrWeekEnd(t,!0))do{a?t.setDate(t.getDate()+1):t.setDate(t.getDate()-1)}while(this.isOnHolidayOrWeekEnd(t,!0));this.parent.includeWeekend||(t=a?this.getNextWorkingDay(t):this.getPreviousWorkingDay(t));var l=this.parent.getSecondsPerDay(t),d=0;if(this.getSecondsInDecimal(r)!==this.parent.getStartTime(r)&&!Number.isInteger(n)){var h=e.toString().split(".");l*=d=parseFloat("."+h[1]),n-=d}n<1&&(l*=n),i+=l,a?t.setDate(t.getDate()+1):t.setDate(t.getDate()-1),d||n--}}return i},t.prototype.getProjectStartDate=function(t,i){if(!(0,e.isNullOrUndefined)(this.parent.cloneProjectStartDate)){"string"==typeof this.parent.cloneProjectStartDate&&(this.parent.cloneProjectStartDate=this.getDateFromFormat(this.parent.cloneProjectStartDate));var r=this.checkStartDate(this.parent.cloneProjectStartDate);return this.parent.cloneProjectStartDate=r,new Date(r.getTime())}if((0,e.isNullOrUndefined)(this.parent.projectStartDate)){if((0,e.isNullOrUndefined)(i))return null;var a=this.parent.flatData,n=void 0;a.length>0?n=a[0].ganttProperties.startDate:(n=new Date).setHours(0,0,0,0);for(var s=1;s<a.length;s++){var o=a[s].ganttProperties.startDate;(0,e.isNullOrUndefined)(o)||-1!==this.compareDates(o,n)||(n=o)}this.parent.cloneProjectStartDate=this.checkStartDate(n,t)}else{r=this.getDateFromFormat(this.parent.projectStartDate);this.parent.cloneProjectStartDate=this.checkStartDate(r)}return new Date(this.parent.cloneProjectStartDate.getTime())},t.prototype.getValidStartDate=function(t,i){var r=null,a=i?t.autoStartDate:t.startDate,n=i?t.autoEndDate:t.endDate,s=!t.isAutoSchedule&&t.autoDuration?t.autoDuration:t.duration;if((0,e.isNullOrUndefined)(a))if((0,e.isNullOrUndefined)(n))(0,e.isNullOrUndefined)(s)||(r=this.getProjectStartDate(t));else{r=new Date(n.getTime());var o=this.parent.getCurrentDayStartTime(r);this.setTime(o,r)}else r=new Date(a.getTime());return r},t.prototype.getValidEndDate=function(t,i){var r=null,a=i?t.autoStartDate:t.startDate,n=i?t.autoEndDate:t.endDate,s=i?t.autoDuration:t.duration;if((0,e.isNullOrUndefined)(n))if((0,e.isNullOrUndefined)(a)){if(!(0,e.isNullOrUndefined)(s)){var o=this.getValidStartDate(t);o&&(r=this.getEndDate(o,s,t.durationUnit,t,!1))}}else if(t.isMilestone)r=this.checkStartDate(a);else{r=new Date(a.getTime());var l=this.parent.getCurrentDayEndTime(n||r);this.setTime(l,r)}else r=new Date(n.getTime());return r},t.prototype.getWorkingTime=function(t,i,r,a,n,s,o,l){if(!(0,e.isNullOrUndefined)(i.from)&&!(0,e.isNullOrUndefined)(i.to)){r.setHours(0,0,0,0);var d=new Date(r.getTime());r.setTime(r.getTime()+36e5*i.from);var h=new Date(r.getTime());if(24===i.to){d.setTime(d.getTime()+86399e3)}else d.setTime(d.getTime()+36e5*i.to);var p=new Date(d.getTime()),u=p.getTime()-h.getTime(),c=this.getSecondsInDecimal(h),g=this.getSecondsInDecimal(p);0===g&&(g=86400),a+=u/1e3,0===n&&(this.parent.defaultStartTime=c,this.parent.weekWorkingTime.length>0&&this.assignStartTime(t,c)),n!==this[t.toLowerCase()+"TimeRangeLength"]-1&&""!==t||(this.parent.defaultEndTime=g,this.parent.weekWorkingTime.length>0&&this.assignEndTime(t,g)),n>0?""===t?(s.push(s[s.length-1]+c-o[n-1].to),o[n-1].to<c&&l.push({from:o[n-1].to,to:c,isWorking:!1,interval:c-o[n-1].to})):(this.parent[t.toLowerCase()+"NonWorkingHours"].push(this.parent[t.toLowerCase()+"NonWorkingHours"][this.parent[t.toLowerCase()+"NonWorkingHours"].length-1]+c-this.parent[t.toLowerCase()+"NonWorkingTimeRanges"][n-1].to),this.parent[t.toLowerCase()+"WorkingTimeRanges"][n-1].to<c&&this.parent[t.toLowerCase()+"NonWorkingTimeRanges"].push({from:this.parent[t.toLowerCase()+"WorkingTimeRanges"][n-1].to,to:c,isWorking:!1,interval:c-this.parent[t.toLowerCase()+"WorkingTimeRanges"][n-1].to})):""===t?(s.push(0),l.push({from:0,to:c,isWorking:!1,interval:c})):(this.parent[t.toLowerCase()+"NonWorkingHours"].push(0),this.parent[t.toLowerCase()+"NonWorkingTimeRanges"].push({from:0,to:c,isWorking:!1,interval:c})),""===t?(o.push({from:c,to:g}),l.push({from:c,to:g,isWorking:!0,interval:g-c})):(this.parent[t.toLowerCase()+"WorkingTimeRanges"].push({from:c,to:g}),this.parent[t.toLowerCase()+"NonWorkingTimeRanges"].push({from:c,to:g,isWorking:!0,interval:g-c}))}return a},t.prototype.assignStartTime=function(e,t){switch(e){case"Monday":this.parent.mondayDefaultStartTime=t;break;case"Tuesday":this.parent.tuesdayDefaultStartTime=t;break;case"Wednesday":this.parent.wednesdayDefaultStartTime=t;break;case"Thursday":this.parent.thursdayDefaultStartTime=t;break;case"Friday":this.parent.fridayDefaultStartTime=t;break;case"Saturday":this.parent.saturdayDefaultStartTime=t;break;case"Sunday":this.parent.sundayDefaultStartTime=t}},t.prototype.assignEndTime=function(e,t){switch(e){case"Monday":this.parent.mondayDefaultEndTime=t;break;case"Tuesday":this.parent.tuesdayDefaultEndTime=t;break;case"Wednesday":this.parent.wednesdayDefaultEndTime=t;break;case"Thursday":this.parent.thursdayDefaultEndTime=t;break;case"Friday":this.parent.fridayDefaultEndTime=t;break;case"Saturday":this.parent.saturdayDefaultEndTime=t;break;case"Sunday":this.parent.sundayDefaultEndTime=t}},t.prototype.calculateWeekWorkTime=function(e,t,i,r,a,n,s){for(var o=0,l=0;l<t.length;l++){var d=t[l];o+=this.getWorkingTime(e,d,i,r,l,a,n,s)}return this.parent[e.toLowerCase()+"DefaultStartTime"]/3600!=24&&this.parent[e.toLowerCase()+"NonWorkingTimeRanges"].push({from:this.parent[e.toLowerCase()+"DefaultEndTime"],to:86400,isWorking:!1,interval:86400-this.parent[e.toLowerCase()+"DefaultEndTime"]}),o},t.prototype.getSecondsPerDay=function(){var t=0,i=new Date("10/11/2018");this.parent.nonWorkingHours=[];var r=this.parent.nonWorkingHours;this.parent.workingTimeRanges=[],this.parent.workingTimeRanges=[];var a=this.parent.workingTimeRanges;this.parent.nonWorkingTimeRanges=[];for(var n=this.parent.nonWorkingTimeRanges,s=0,o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];s<o.length;s++){this[(y=o[s]).toLowerCase()+"TimeRangeLength"]=this.parent.dayWorkingTime.length}if(this.parent.weekWorkingTime.length>0){for(var l=0;l<this.parent.weekWorkingTime.length;l++)this[this.parent.weekWorkingTime[l].dayOfWeek.toLowerCase()+"TimeRangeLength"]=this.parent.weekWorkingTime[l].timeRange.length;for(var d=this.parent.weekWorkingTime,h=this.parent.dayWorkingTime,p=0,u=d;p<u.length;p++){var c=u[p];if(c.timeRange&&c.timeRange.length>0){var g=this.calculateWeekWorkTime(c.dayOfWeek,c.timeRange,i,t,r,a,n);this.parent[c.dayOfWeek.toLowerCase()+"Seconds"]=g}}for(var f=0,m=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];f<m.length;f++){var y=m[f],D=this.parent[y.toLowerCase()+"DefaultStartTime"];if((0,e.isNullOrUndefined)(D)){var v=this.calculateWeekWorkTime(y,h,i,t,r,a,n);this.parent[y.toLowerCase()+"Seconds"]=v}}}for(var k=this.parent.dayWorkingTime,w=k.length,b=0,T=0;T<w;T++){var P=k[T];b+=this.getWorkingTime("",P,i,t,T,r,a,n)}return this.parent.defaultEndTime/3600!=24&&n.push({from:this.parent.defaultEndTime,to:86400,isWorking:!1,interval:86400-this.parent.defaultEndTime}),t=b},t.prototype.getDurationValue=function(t,i){var r=null,a=null;if("string"==typeof t){var n=t.match(/(\d*\.*\d+|.+$)/g);if(n&&n.length<=2){a=parseFloat(n[0].toString().trim());var s=n[1]?n[1].toString().trim().toLowerCase():null;-1!==(0,e.getValue)("minute",this.parent.durationUnitEditText).indexOf(s)?r="minute":-1!==(0,e.getValue)("hour",this.parent.durationUnitEditText).indexOf(s)?r="hour":-1!==(0,e.getValue)("day",this.parent.durationUnitEditText).indexOf(s)&&(r="day")}}else a=t,r=null;return{duration:a,durationUnit:r}},t.prototype.getNextWorkingDay=function(e){var t=e.getDay();return-1!==this.parent.nonWorkingDayIndex.indexOf(t)?(e.setDate(e.getDate()+1),e=this.getNextWorkingDay(e)):e},t.prototype.getWeekendCount=function(e,t){var i=0,r=new Date(e.getTime()),a=new Date(t.getTime());for(r.setHours(0,0,0,0),r.setDate(r.getDate()+1),a.setHours(0,0,0,0);r.getTime()<a.getTime();)-1!==this.parent.nonWorkingDayIndex.indexOf(r.getDay())&&(i+=1),r.setDate(r.getDate()+1);return i},t.prototype.getNumberOfSeconds=function(e,t,i){var r=new Date(e.getTime()),a=new Date(t.getTime()),n=0;return r.setDate(r.getDate()+1),r.setHours(0,0,0,0),a.setHours(0,0,0,0),r.getTime()<a.getTime()&&(n=this.getTimeDifference(r,a,i)/1e3),n%86400!=0&&(n=n-n%86400+86400),n},t.prototype.getHolidaysCount=function(e,t){var i=0,r=this.parent.totalHolidayDates,a=new Date(e.getTime()),n=new Date(t.getTime());if(a.setDate(a.getDate()+1),a.setHours(0,0,0,0),n.setHours(0,0,0,0),a.getTime()<n.getTime())for(var s=0;s<r.length;s++){var o=this.getDateFromFormat(new Date(r[s]));a.getTime()<=o.getTime()&&n.getTime()>o.getTime()&&(!this.parent.includeWeekend&&-1===this.parent.nonWorkingDayIndex.indexOf(o.getDay())||this.parent.includeWeekend)&&(i+=1)}return i},t.prototype.getHolidayDates=function(){for(var t=this.parent.holidays,i=[],r=0;r<t.length;r++){var a=this.getDateFromFormat(t[r].from),n=this.getDateFromFormat(t[r].to);if(!(0,e.isNullOrUndefined)(a)||!(0,e.isNullOrUndefined)(n))if((0,e.isNullOrUndefined)(a)||(0,e.isNullOrUndefined)(n)){var s=a||n;s.setHours(0,0,0,0),-1===i.indexOf(s.getTime())&&i.push(s.getTime())}else for(;a<=n;)a.setHours(0,0,0,0),-1===i.indexOf(a.getTime())&&i.push(a.getTime()),a.setDate(a.getDate()+1)}return i},t.prototype.isOnHolidayOrWeekEnd=function(t,i){if(i=(0,e.isNullOrUndefined)(i)?this.parent.includeWeekend:i,this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||(i=!0),!i&&-1!==this.parent.nonWorkingDayIndex.indexOf(t.getDay()))return!0;for(var r=this.parent.totalHolidayDates,a=0;a<r.length;a++){var n=this.getDateFromFormat(new Date(r[a])),s=new Date(n.getTime());if(n.setHours(0,0,0,0),s.setHours(23,59,59,59),t.getTime()>=n.getTime()&&t.getTime()<s.getTime())return!0}return!1},t.prototype.getNonWorkingSecondsOnDate=function(e,t,i){var r,a,n=this.getSecondsInDecimal(e),s=this.getSecondsInDecimal(t),o=-1,l=-1,d=0,h=!(!i||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&this.isOnHolidayOrWeekEnd(e,null),p=!(!i||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&this.isOnHolidayOrWeekEnd(t,null);if(this.parent.weekWorkingTime.length>0){r=this.parent.getNonWorkingRange(e);for(var u=0;u<r.length;u++){n>=(c=r[u]).from&&n<=c.to&&(o=u)}a=this.parent.getNonWorkingRange(t);for(u=0;u<a.length;u++){s>=(c=a[u]).from&&s<=c.to&&(l=u)}}else{r=this.parent.nonWorkingTimeRanges,a=this.parent.nonWorkingTimeRanges;for(u=0;u<r.length;u++){var c;n>=(c=r[u]).from&&n<=c.to&&(o=u),s>=c.from&&s<=c.to&&(l=u)}}if(e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()||e.getFullYear()!==t.getFullYear()){if(h)d+=86400-n;else for(u=o;u<r.length;u++)r[u].isWorking||(d+=u===o?r[u].to-n:r[u].interval);if(p)d+=s;else for(u=0;u<=l;u++)a[u].isWorking||(d+=u===l?s-a[u].from:a[u].interval)}else{if(o!==l)if(p)d+=s-n;else for(u=o;u<=l;u++)r[u].isWorking||(d+=u===o?r[u].to-n:u===l?s-r[u].from:r[u].interval);else if(p)d+=s-n;else r[o].isWorking||(d=s-n)}return d},t.prototype.getPreviousWorkingDay=function(e){var t=e.getDay(),i=0===t?6:t-1,r=this.parent.getCurrentDayEndTime(e);return-1!==this.parent.nonWorkingDayIndex.indexOf(t)||-1!==this.parent.nonWorkingDayIndex.indexOf(i)&&86400===r&&0===this.getSecondsInDecimal(e)?(e.setDate(e.getDate()-1),-1!==this.parent.nonWorkingDayIndex.indexOf(e.getDay())&&(e=this.getPreviousWorkingDay(e)),e):e},t.prototype.getNonWorkingDayIndex=function(){var e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],t=e.length;0===this.parent.workWeek.length&&(this.parent.workWeek=["Monday","Tuesday","Wednesday","Thursday","Friday"]);for(var i=this.parent.workWeek.slice(),r=i.length,a=0;a<r;a++)i[a]=i[a].toLowerCase();this.parent.nonWorkingDayIndex=[];for(a=0;a<t;a++)-1===i.indexOf(e[a])&&this.parent.nonWorkingDayIndex.push(a)},t.prototype.setTime=function(e,t){var i=e/3600,r=(e-3600*(i=parseInt(i,10)))/60,a=e-3600*i-60*(r=parseInt(r,10));t.setHours(i,r,a)},t.prototype.getTimeDifference=function(e,t,i){var r=new Date(e.getTime()),a=new Date(t.getTime());return i&&this.updateDateWithTimeZone(r,a),a.getTime()-r.getTime()},t.prototype.updateDateWithTimeZone=function(e,t){var i,r,a=e.getTimezoneOffset(),n=t.getTimezoneOffset();if(a!==n){var s=new Date((new Date).getFullYear(),0,1).getTimezoneOffset();if(s!==a?(r=e,i=a):s!==n&&(r=t,i=n),s<0){var o=s-i;r.setTime(r.getTime()+60*o*1e3)}else if(s>=0){o=i-s;r.setTime(r.getTime()-60*o*1e3)}}},t.prototype.getSecondsInDecimal=function(e){return 60*e.getHours()*60+60*e.getMinutes()+e.getSeconds()+e.getMilliseconds()/1e3},t.prototype.offset=function(e,t){var i=e.getTimezoneOffset();try{var r=new Date(e.toLocaleString("en-US",{timeZone:t}));return isNaN(r.getTime())?0:(e.getTime()-r.getTime())/6e4+i}catch(e){return 0}},t.prototype.remove=function(t,i){return(0,e.isNullOrUndefined)(t)||(t=this.reverse(t,i,t.getTimezoneOffset())),t},t.prototype.reverse=function(e,t,i){"string"==typeof t&&(t=this.offset(e,t)),"string"==typeof i&&(i=this.offset(e,i));var r=e.getTimezoneOffset(),a=(e=new Date(e.getTime()+6e4*(t-i))).getTimezoneOffset();return new Date(e.getTime()+6e4*(a-r))},t.prototype.convert=function(e,t){var i=e.getTimezoneOffset(),r=this.offset(e,t);"string"==typeof i&&(i=this.offset(e,i)),"string"==typeof r&&(r=this.offset(e,r));var a=e.getTimezoneOffset(),n=(e=new Date(e.getTime()+6e4*(i-r))).getTimezoneOffset();return new Date(e.getTime()+6e4*(n-a))},t.prototype.getDateFromFormat=function(t,i){var r;if((0,e.isNullOrUndefined)(t))return null;if(t instanceof Date)r=new Date(t.getTime());else{var a=this.parent.globalize.parseDate(t,{format:this.parent.getDateFormat(),type:"dateTime"});r=(0,e.isNullOrUndefined)(a)&&!isNaN(new Date(t).getTime())?new Date(t):a}return!(0,e.isNullOrUndefined)(this.parent.timezone)&&i?this.convert(r,this.parent.timezone):r},t.prototype.compareDates=function(t,i){return(0,e.isNullOrUndefined)(t)||(0,e.isNullOrUndefined)(i)?!(0,e.isNullOrUndefined)(t)&&(0,e.isNullOrUndefined)(i)?1:(0,e.isNullOrUndefined)(t)&&!(0,e.isNullOrUndefined)(i)?-1:null:t.getTime()>i.getTime()?1:t.getTime()<i.getTime()?-1:0},t.prototype.getDurationString=function(t,i){var r="";if(!(0,e.isNullOrUndefined)(t)&&(r+=parseFloat(t.toFixed(2))+" ",!(0,e.isNullOrUndefined)(i))){var a=1!==t;"day"===i?r+=a?this.parent.localeObj.getConstant("days"):this.parent.localeObj.getConstant("day"):"hour"===i?r+=a?this.parent.localeObj.getConstant("hours"):this.parent.localeObj.getConstant("hour"):"minute"===i&&(r+=a?this.parent.localeObj.getConstant("minutes"):this.parent.localeObj.getConstant("minute"))}return r},t.prototype.getWorkString=function(t,i){var r="";if(!(0,e.isNullOrUndefined)(t)&&(r+=parseFloat(t).toFixed(2)+" ",!(0,e.isNullOrUndefined)(i))){var a=1!==t;"day"===i?r+=a?this.parent.localeObj.getConstant("days"):this.parent.localeObj.getConstant("day"):"hour"===i?r+=a?this.parent.localeObj.getConstant("hours"):this.parent.localeObj.getConstant("hour"):"minute"===i&&(r+=a?this.parent.localeObj.getConstant("minutes"):this.parent.localeObj.getConstant("minute"))}return r},t.prototype.calculateProjectDatesForValidatedTasks=function(t){var i=this,r="string"==typeof this.parent.projectStartDate?new Date(this.parent.projectStartDate):this.parent.projectStartDate,a="string"==typeof this.parent.projectEndDate?new Date(this.parent.projectEndDate):this.parent.projectEndDate,n=null,s=null,o=(0,e.getValue)("dataOperation.dataArray",this.parent);if(r&&a||!o||0!==o.length){if(o.length>0){var l=o.slice().sort((function(e,t){return new Date(e[i.parent.taskFields.startDate]).getTime()-new Date(t[i.parent.taskFields.startDate]).getTime()})),d=o.slice().sort((function(e,t){return new Date(t[i.parent.taskFields.endDate]).getTime()-new Date(e[i.parent.taskFields.endDate]).getTime()}));n=l[0][this.parent.taskFields.startDate],s=d[d.length-1][this.parent.taskFields.endDate]}}else n=this.getDateFromFormat(new Date),s=this.getDateFromFormat(new Date(n.getTime()));this.parent.cloneProjectStartDate=r?new Date(r.getTime()):"string"==typeof n?new Date(n):n,this.parent.cloneProjectEndDate=a?new Date(a.getTime()):"string"==typeof s?new Date(s):s},t.prototype.calculateProjectDates=function(t){var i=this;if(this.parent.isLoad&&this.parent.enablePersistence&&this.parent.cloneProjectStartDate&&this.parent.cloneProjectEndDate)return this.parent.cloneProjectStartDate=this.getDateFromFormat(this.parent.cloneProjectStartDate),void(this.parent.cloneProjectEndDate=this.getDateFromFormat(this.parent.cloneProjectEndDate));var r="string"==typeof this.parent.projectStartDate?new Date(this.parent.projectStartDate):this.parent.projectStartDate,a="string"==typeof this.parent.projectEndDate?new Date(this.parent.projectEndDate):this.parent.projectEndDate,n=this.parent.timelineModule.isZooming&&this.parent.cloneProjectStartDate?this.getDateFromFormat(this.parent.cloneProjectStartDate):this.getDateFromFormat(r),s=this.parent.timelineModule.isZooming&&this.parent.cloneProjectEndDate?this.getDateFromFormat(this.parent.cloneProjectEndDate):this.getDateFromFormat(a),o=null,l=null,d=this.parent.flatData,h=this.parent.currentViewData,p=[],u=function(t){(0,e.isNullOrUndefined)(t)||p.push(t)},c=function(e){e.length>0&&(e.sort((function(e,t){return e.getTime()-t.getTime()})),o=new Date(e[0].getTime()),l=e.length>1?new Date(e[e.length-1].getTime()):null)};if((!n||!s)&&d.length>0||t||this.parent.timelineModule.isZoomToFit){if((h.length>0&&this.parent.timelineModule.isZoomToFit&&this.parent.treeGrid.filterModule&&this.parent.treeGrid.filterModule.filteredResult.length>0?h:d).forEach((function(t){p=[];var r,a,n=t.ganttProperties;(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.endDate)?(r=null,a=null):(r=i.getValidStartDate(n),a=i.getValidEndDate(n)),u(o),u(l),u(r),u(a),i.parent.renderBaseline&&!i.parent.timelineModule.isZoomToFit&&(u(n.baselineStartDate),u(n.baselineEndDate)),n.indicators&&n.indicators.length>0&&!i.parent.timelineModule.isZoomToFit&&n.indicators.forEach((function(e){u(i.getDateFromFormat(e.date))})),c(p)})),p=[],u(o),u(l),this.parent.eventMarkers.length>0&&!this.parent.timelineModule.isZoomToFit)this.parent.eventMarkers.forEach((function(e,t){u(i.getDateFromFormat(e.day))}));if(this.parent.totalHolidayDates.length>0&&!this.parent.timelineModule.isZoomToFit)this.parent.totalHolidayDates.forEach((function(e,t){u(new Date(e))}));c(p),o&&l||(o?o=(0,e.isNullOrUndefined)(o)?this.getDateFromFormat(new Date):o:(o=(0,e.isNullOrUndefined)(o)?this.getDateFromFormat(new Date):o).setHours(0,0,0,0),(l=this.getDateFromFormat(new Date(o.getTime()))).setDate(l.getDate()+20))}else n&&s||0!==d.length||(o=this.getDateFromFormat(new Date),l=this.getDateFromFormat(new Date(o.getTime())));t?((0,e.setValue)("minStartDate",o,t),(0,e.setValue)("maxEndDate",l,t)):(this.prevProjectStartDate=this.parent.cloneProjectStartDate,this.parent.cloneProjectStartDate=o&&(this.parent.timelineModule.isZoomToFit||(0,e.isNullOrUndefined)(n))?o:new Date(n.getTime()),this.parent.cloneProjectEndDate=l&&(this.parent.timelineModule.isZoomToFit||(0,e.isNullOrUndefined)(s))?l:new Date(s.getTime())),this.parent.isProjectDateUpdated=!0},t.prototype.splitTasksDuration=function(e){for(var t=0,i=0;i<e.length;i++){var r=e[i],a=r.startDate,n=r.endDate;"Hour"===this.parent.timelineModule.bottomTier?t+=Math.ceil(this.getTimeDifference(a,n)/36e5):"Minutes"===this.parent.timelineModule.bottomTier?t+=Math.ceil(this.getTimeDifference(a,n)/6e4):t+=Math.ceil(this.getTimeDifference(a,n)/864e5)}return t},t}(),b=(v=function(e,t){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},v(e,t)},function(e,t){function i(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),T=function(t){function a(e){var i=t.call(this,e)||this;return i.customSegmentProperties=[],i.recordIndex=0,i.taskIds=[],i.hierarchyData=[],i.addEventListener(),i}return b(a,t),a.prototype.addEventListener=function(){this.parent.on("beforeDataManipulate",this.checkDataBinding.bind(this))},a.prototype.checkDataBinding=function(t){var i=this;if(t&&(this.parent.flatData=[],this.parent.currentViewData=[],this.parent.updatedRecords=[],this.dataArray=[],this.taskIds=[],this.parent.ids=[],this.recordIndex=0,this.hierarchyData=[],this.parent.predecessorsCollection=[],this.parent.treeGrid.parentData=[],this.parent.taskIds=[]),(0,e.isNullOrUndefined)(this.parent.dataSource))this.parent.dataSource=[],this.parent.processTimeline(),this.parent.renderGantt(t);else if(this.parent.dataSource instanceof r.DataManager)this.initDataSource(t);else{if(this.parent.dataSource instanceof Object&&s(this.parent)){var a=(0,e.getValue)("result",this.parent.dataSource);this.dataArray=a}else this.dataArray=this.parent.dataSource;this.processTimeline(),this.cloneDataSource(),this.parent.renderGantt(t)}this.parent.flatData.map((function(e){i.parent.chartRowsModule.updateSegment(e.ganttProperties.segments,e.ganttProperties.taskId)}))},a.prototype.processTimeline=function(){this.parent.processTimeline(),this.parent.enableValidation||(this.parent.dataOperation.calculateProjectDatesForValidatedTasks(),this.parent.timelineModule.validateTimelineProp())},a.prototype.initDataSource=function(e){var t=this,i=this.parent.query instanceof r.Query?this.parent.query:new r.Query;i.requiresCount();var a=this.parent.dataSource;!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?(this.processTimeline(),this.parent.renderGantt(e)):a.executeQuery(i).then((function(i){t.dataArray=i.result,t.processTimeline(),(t.parent.loadChildOnDemand||!t.parent.loadChildOnDemand&&!t.parent.taskFields.hasChildMapping)&&t.cloneDataSource(),t.parent.renderGantt(e)})).catch((function(i){t.parent.processTimeline(),t.parent.renderGantt(e),t.parent.trigger("actionFailure",{error:i})}))},a.prototype.constructDataSource=function(t){for(var i,a=new r.DataManager(t).executeLocal((new r.Query).group(this.parent.taskFields.parentID)),n=[],s=0;s<a.length;s++){var o=a[s];!(0,e.isNullOrUndefined)(o.key)&&(i=this.taskIds.indexOf(o.key.toString()))>-1&&!(0,e.isNullOrUndefined)(o.key)?t[i][this.parent.taskFields.child]=o.items:-1!==i&&n.push.apply(n,o.items)}this.hierarchyData=this.dataReorder(t,n)},a.prototype.cloneDataSource=function(){var t=this.parent.taskFields.id,i=this.parent.taskFields.parentID,a=[];if((0,e.isNullOrUndefined)(t)||(0,e.isNullOrUndefined)(i))a=this.dataArray;else{for(var n=[],s=0;s<this.dataArray.length;s++){var o=this.dataArray[s];o.parentItem&&delete o.parentItem,n.push((0,e.extend)({},{},o,!0)),(0,e.isNullOrUndefined)(o[t])||this.taskIds.push(o[t].toString())}this.parent.taskFields.child||this.parent.setProperties({taskFields:{child:"Children"}},!0),this.constructDataSource(n),a=!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.dataArray:this.hierarchyData}if(this.parent.taskFields.segmentId&&(this.segmentCollection=new r.DataManager(this.parent.segmentData).executeLocal((new r.Query).group(this.parent.taskFields.segmentId)),this.parent.taskFields.segments||(this.parent.taskFields.segments="Segments")),"ProjectView"!==this.parent.viewType){var l=(0,e.extend)([],[],this.parent.resources,!0),d=[];if(this.constructResourceViewDataSource(l,a,d),d.length>0){var h={},p=this.parent.resourceFields.name||"resourceName";h[this.parent.resourceFields.id]=0,h[p]=this.parent.localeObj.getConstant("unassignedTask"),h[this.parent.taskFields.child]=d,l.push(h)}a=l}this.prepareDataSource(a)},a.prototype.constructResourceViewDataSource=function(e,t,i){for(var r=function(r){var n=t[r],s=null!==a.parent.taskFields.child?a.parent.taskFields.child:a.parent.taskFields.child="Children",o=n&&n[a.parent.taskFields.resourceInfo],l=a.parent.resourceFields.id;if(n[s]&&0!==n[s].length||!o||!o.length)(!n[s]||n[s]&&0===n[s].length)&&i.push(n);else if("string"==typeof o){a.isResourceString=!0;for(var d=o,h=0;h<e.length;h++)if(e[h][a.parent.resourceFields.name].toString()===d.toString()){e[h][s]?e[h][s].push(n):e[h][s]=[n];break}}else o.forEach((function(t){for(var i="object"==typeof t?t[l]:t,r=0;r<e.length;r++)if(e[r][l].toString()===i.toString()){e[r][s]?e[r][s].push(n):e[r][s]=[n];break}}));n[a.parent.taskFields.child]&&n[a.parent.taskFields.child].length&&a.constructResourceViewDataSource(e,n[a.parent.taskFields.child],i)},a=this,n=0;n<t.length;n++)r(n)},a.prototype.prepareDataSource=function(t){this.prepareRecordCollection(t,0),this.parent.initialLoadData=(0,e.extend)({},{},this.parent.flatData,!0),(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&(this.parent.dataMap=this.parent.flatData.reduce((function(e,t){return e.set(t.uniqueID,t),e}),new Map)),"ResourceView"===this.parent.viewType&&this.calculateSharedTaskUniqueIds(),this.parent.taskFields.dependency&&this.parent.predecessorModule&&this.parent.predecessorModule.ensurePredecessorCollection()},a.prototype.calculateSharedTaskUniqueIds=function(){for(var e=function(e){var i=[];if(i[0]=t.parent.getTaskIds()[e][0],i[1]=t.parent.getTaskIds()[e].slice(1),"R"!==i[0]){var r=[],a=[];t.parent.flatData.filter((function(e){e.ganttProperties.taskId.toString()===i[1]&&0!==e.level&&(a.push(e.ganttProperties.rowUniqueID),r.push(e))}));for(var n=0;n<r.length;n++)r[n].ganttProperties.sharedTaskUniqueIds=a}},t=this,i=0;i<this.parent.getTaskIds().length;i++)e(i)},a.prototype.prepareRecordCollection=function(t,i,r){for(var a=this,n=t.length,s=function(n){var s=t[n];if(!(0,e.isNullOrUndefined)(o.parent.taskFields.segmentId)){var l=o.segmentCollection.filter((function(e){return e.key===s[a.parent.taskFields.id]}));l.length>0&&(s[o.parent.taskFields.segments]=l[0].items)}var d=o.createRecord(s,i,r,!0);(!o.parent.enableValidation||!o.parent.autoCalculateDateScheduling||o.parent.isLoad&&!o.parent.treeGrid.loadChildOnDemand&&o.parent.taskFields.hasChildMapping)&&o.updateTaskLeftWidth(d),d.index=o.recordIndex++,o.parent.ids[d.index]=d.ganttProperties.rowUniqueID,o.parent.flatData.push(d),o.parent.setTaskIds(d);var h=s[o.parent.taskFields.child]||s.taskData&&s.taskData[o.parent.taskFields.child];if("ResourceView"===o.parent.viewType&&(0,e.isNullOrUndefined)(h)&&(0,e.isNullOrUndefined)(d.parentItem)&&0===d.level){var p=d.ganttProperties,u=d;o.parent.setRecordValue(p.isAutoSchedule?"startDate":"autoStartDate",null,u.ganttProperties,!0),o.parent.setRecordValue(p.isAutoSchedule?"endDate":"autoEndDate",null,u.ganttProperties,!0);var c=u.ganttProperties;o.parent.setRecordValue("isMilestone",!1,c,!0),c.isAutoSchedule&&o.calculateDuration(u),o.updateWorkWithDuration(u);var g=c.work;o.parent.setRecordValue("work",g,c,!0),o.parent.setRecordValue("taskType","FixedDuration",c,!0),(0,e.isNullOrUndefined)(o.parent.taskFields.type)||o.updateMappingData(u,"type"),o.parent.setRecordValue("progress",Math.floor(0),c,!0),o.parent.setRecordValue("totalProgress",0,c,!0),o.parent.setRecordValue("totalDuration",0,c,!0),c.isAutoSchedule||(o.parent.setRecordValue("autoDuration",o.calculateAutoDuration(c),c,!0),o.updateAutoWidthLeft(u)),o.parent.allowParentDependency||o.resetDependency(u),o.updateWidthLeft(u),o.updateTaskData(u)}!(0,e.isNullOrUndefined)(h)&&h.length>0&&o.prepareRecordCollection(h,d.level+1,d)},o=this,l=0;l<n;l++)s(l)},a.prototype.addCustomFieldValue=function(e,t){var i=this.parent.ganttColumns,r=i.length;if(r)for(var a=0;a<r;a++){void 0===t[i[a].field]&&this.parent.setRecordValue(i[a].field,e[i[a].field],t)}},a.prototype.createRecord=function(t,r,a,n){var o=this.parent.taskFields,l=this.parent.resourceFields,d=t[o.progress],h=null,p=null,u=t[o.notes];d=100<(d=d&&parseFloat(d.toString())?parseFloat(d.toString()):0)?100:d;var c,g=t[o.dependency],f=this.getDateFromFormat(t[o.baselineStartDate],!0),m=this.getDateFromFormat(t[o.baselineEndDate],!0),y={},D={},v="Auto"===this.parent.taskMode||"Manual"!==this.parent.taskMode&&!0!==t[o.manual];(this.parent.setRecordValue("ganttProperties",D,y),t.ganttProperties&&t.ganttProperties.predecessor&&t.ganttProperties.predecessor.length>0&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.setRecordValue("predecessor",t.ganttProperties.predecessor,D,!0),(0,e.isNullOrUndefined)(t[o.id]))?(0,e.isNullOrUndefined)(t[l.id])||(h=t[l.id],p=(0,e.isNullOrUndefined)(t[l.name])&&"Unassigned Task"===t.resourceName?t.resourceName:t[l.name],this.addTaskData(y,t,!1)):(h=t[o.id],p=t[o.name],!(this.parent.loadChildOnDemand||!o.hasChildMapping||!t.taskData)?y.taskData=t.taskData:t.taskData&&t.ganttProperties?this.addTaskData(y,t.taskData,n):this.addTaskData(y,t,n));this.parent.setRecordValue("taskId",h,D,!0),this.parent.setRecordValue("taskName",p,D,!0),this.parent&&o.parentID&&this.parent.setRecordValue("parentId",t[o.parentID],D,!0),this.addCustomFieldValue(t,y),this.parent.setRecordValue("isAutoSchedule",v,D,!0),!this.parent.undoRedoModule||this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed?this.parent.setRecordValue("resourceInfo",this.setResourceInfo(t),D,!0):t.ganttProperties&&this.parent.setRecordValue("resourceInfo",t.ganttProperties.resourceInfo,D,!0),this.parent.setRecordValue("isMilestone",!1,D,!0),this.parent.setRecordValue("indicators",t[o.indicators],D,!0),this.updateResourceName(y),this.calculateScheduledValues(y,t,n),this.parent.setRecordValue("baselineStartDate",this.checkBaselineStartDate(f,D),D,!0),c=this.parent.weekWorkingTime.length>0&&m?this.parent.getEndTime(m):this.parent.defaultEndTime,m&&0===m.getHours()&&86400!==c&&this.setTime(c,m),(D.baselineStartDate&&m&&D.baselineStartDate.getTime()>m.getTime()||!(0,e.isNullOrUndefined)(D.baselineStartDate)&&!(0,e.isNullOrUndefined)(D.startDate)&&D.baselineStartDate.getTime()===D.startDate.getTime()&&!(0,e.isNullOrUndefined)(m)&&!(0,e.isNullOrUndefined)(D.endDate)&&m.toLocaleDateString()===D.endDate.toLocaleDateString()&&D.isMilestone)&&(m=D.baselineStartDate),this.parent.setRecordValue("baselineEndDate",this.checkBaselineEndDate(m,D),D,!0),this.parent.setRecordValue("progress",d,D,!0),this.parent.setRecordValue("totalProgress",d,D,!0),t.ganttProperties&&t.ganttProperties.predecessorsName&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed?this.parent.setRecordValue("predecessorsName",t.ganttProperties.predecessorsName,D,!0):this.parent.setRecordValue("predecessorsName",g,D,!0),this.parent.setRecordValue("notes",u,D,!0),this.parent.setRecordValue("cssClass",t[o.cssClass],D,!0),this.parent.setRecordValue("parentItem",this.getCloneParent(a),y),!this.parent.loadChildOnDemand&&o.hasChildMapping&&this.parent.currentViewData.length>0&&this.parent.setRecordValue("parentItem",y.parentItem,this.parent.currentViewData[this.taskIds.indexOf(t[o.id].toString())]);var k=y.parentItem?y.parentItem.uniqueID:null;if(this.parent.setRecordValue("parentUniqueID",k,y),"ResourceView"!==this.parent.viewType||(0,e.isNullOrUndefined)(o.parentID)||(0,e.isNullOrUndefined)(y.parentItem)||this.parent.setRecordValue("parentId",y.parentItem.taskId,D,!0),this.parent.setRecordValue("level",r,y),t.ganttProperties&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||!this.parent.loadChildOnDemand&&o.hasChildMapping&&t.uniqueID?this.parent.setRecordValue("uniqueID",t.uniqueID,y):this.parent.setRecordValue("uniqueID",(0,i.getUid)(this.parent.element.id+"_data_"),y),this.parent.setRecordValue("uniqueID",y.uniqueID,D,!0),this.parent.setRecordValue("childRecords",[],y),this.parent.dataSource instanceof Object&&s(this.parent)&&!(0,e.isNullOrUndefined)(o.child)&&this.parent.setRecordValue(o.child,[],y),!(0,e.isNullOrUndefined)(t[o.child])&&t[o.child].length>0||t.taskData&&t.taskData[o.child]&&t.taskData[o.child].length>0?(this.parent.setRecordValue("hasChildRecords",!0,y),this.parent.setRecordValue("isMilestone",!1,D,!0),this.parent.allowParentDependency||this.resetDependency(y)):!this.parent.loadChildOnDemand&&o.hasChildMapping&&y.taskData[o.hasChildMapping]?this.parent.setRecordValue("hasChildRecords",!0,y):this.parent.setRecordValue("hasChildRecords",!1,y),y.hasChildRecords&&(this.parent.setRecordValue("autoStartDate",y.ganttProperties.startDate,D),this.parent.setRecordValue("autoEndDate",y.ganttProperties.endDate,D),this.parent.setRecordValue("autoDuration",y.ganttProperties.duration,D)),this.parent.setRecordValue("expanded",!y.hasChildRecords||!this.parent.collapseAllParentTasks,y),this.updateExpandStateMappingValue(y,t),n||(this.parent.setRecordValue("width",this.calculateWidth(y),D,!0),this.parent.setRecordValue("left",this.calculateLeft(D),D,!0),this.parent.setRecordValue("progressWidth",this.getProgressWidth(D.width,d),D,!0),D.baselineEndDate&&D.baselineStartDate&&(this.parent.setRecordValue("baselineLeft",this.calculateBaselineLeft(D),D,!0),this.parent.setRecordValue("baselineWidth",this.calculateBaselineWidth(D),D,!0))),(0,e.isNullOrUndefined)(o.work)&&this.updateWorkWithDuration(y),(0,e.isNullOrUndefined)(o.manual)||this.parent.dataOperation.updateMappingData(y,"manual"),this.updateTaskData(y),g&&this.parent.predecessorsCollection.push(y),(0,e.isNullOrUndefined)(a)||(a.childRecords.push(y),this.parent.dataSource instanceof Object&&s(this.parent)&&!(0,e.isNullOrUndefined)(this.parent.taskFields.child)&&a[this.parent.taskFields.child].push(y.taskData)),"ProjectView"===this.parent.viewType)this.parent.setRecordValue("rowUniqueID",D.taskId.toString(),D,!0);else{var w=y.uniqueID.replace(this.parent.element.id+"_data_","");this.parent.setRecordValue("rowUniqueID",w,y),this.parent.setRecordValue("rowUniqueID",w,D,!0),this.parent.setRecordValue("sharedTaskUniqueIds",[],D,!0)}return this.parent.allowUnscheduledTasks&&y.ganttProperties.startDate&&(y.ganttProperties.endDate||y.ganttProperties.duration)&&(this.parent.setRecordValue("segments",this.setSegmentsInfo(y,!0),D,!0),this.parent.dataOperation.updateMappingData(y,"segments"),n||this.updateWidthLeft(y)),this.parent.chartRowsModule.updateSegment(y.ganttProperties.segments,y.ganttProperties.taskId),y},a.prototype.sortSegmentsData=function(e,t,i){var r=this;return t?e.sort((function(e,t){var i=r.parent.taskFields.startDate;return r.getDateFromFormat(e[i]).getTime()-r.getDateFromFormat(t[i]).getTime()})):e.sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),e},a.prototype.setSegmentsInfo=function(t,i){var r,a=this,n=this.parent.taskFields,s=[],o=0,l=0,d=[this.parent.taskFields.duration,this.parent.taskFields.endDate,this.parent.taskFields.startDate,this.parent.taskFields.id],h=[];if(!(0,e.isNullOrUndefined)(this.parent.taskFields.segments)&&(r=i?t.taskData[this.parent.taskFields.segments]:t.ganttProperties.segments,i||t.taskData[this.parent.taskFields.segments]&&t.taskData[this.parent.taskFields.segments].length>0&&t.taskData[this.parent.taskFields.segments].forEach((function(e){var t={},i={};for(var r in e)-1!==d.indexOf(r)?t[r]=e[r]:i[r]=e[r];a.customSegmentProperties.push(i)})),!(0,e.isNullOrUndefined)(r)&&r.length>1)){this.sortSegmentsData(r,i,t.ganttProperties);for(var p=0;p<r.length;p++){var u=r[p],c=i?u[n.startDate]:u.startDate,g=i?u[n.endDate]:u.endDate,f=i?u[n.duration]:u.duration;if(c=this.getDateFromFormat(c),c=this.checkStartDate(c,t.ganttProperties,!1),(0,e.isNullOrUndefined)(f)){if((g=this.getDateFromFormat(g))&&((0,e.isNullOrUndefined)(f)||""===String(f))){var m=void 0;m=this.parent.weekWorkingTime.length>0?this.parent.getEndTime(g):this.parent.defaultEndTime,0===g.getHours()&&86400!==m&&this.setTime(m,g)}if(g=this.checkEndDate(g,t.ganttProperties,!1),f=this.getDuration(c,g,t.ganttProperties.durationUnit,t.ganttProperties.isAutoSchedule,t.ganttProperties.isMilestone),n.duration){if((l=t.ganttProperties.duration-o-1)<=0)continue;f=p===r.length-1||l>0&&f>l?l:f,g=this.getEndDate(c,f,t.ganttProperties.durationUnit,t.ganttProperties,!1)}else if(!n.duration&&n.endDate&&g&&(g=!(0,e.isNullOrUndefined)(t.ganttProperties.endDate)&&g.getTime()>=t.ganttProperties.endDate.getTime()&&p===r.length-1?t.ganttProperties.endDate:g,f=this.getDuration(c,g,t.ganttProperties.durationUnit,t.ganttProperties.isAutoSchedule,t.ganttProperties.isMilestone),s.length>0&&g.getTime()<c.getTime()&&g.getTime()<=t.ganttProperties.endDate.getTime())){s[p-1].duration=this.getDuration(s[p-1].startDate,t.ganttProperties.endDate,t.ganttProperties.durationUnit,t.ganttProperties.isAutoSchedule,t.ganttProperties.isMilestone);continue}}else if(g=this.getEndDate(c,f,t.ganttProperties.durationUnit,t.ganttProperties,!1),n.duration){if((l=t.ganttProperties.duration-o)<=0)continue;f=p===r.length-1||l>0&&f>l?l:f,g=this.getEndDate(c,f,t.ganttProperties.durationUnit,t.ganttProperties,!1)}else if(!n.duration&&n.endDate&&g&&(g=!(0,e.isNullOrUndefined)(t.ganttProperties.endDate)&&g.getTime()>=t.ganttProperties.endDate.getTime()&&p===r.length-1?t.ganttProperties.endDate:g,f=this.getDuration(c,g,t.ganttProperties.durationUnit,t.ganttProperties.isAutoSchedule,t.ganttProperties.isMilestone),s.length>0&&g.getTime()<c.getTime()&&g.getTime()<=t.ganttProperties.endDate.getTime())){s[p-1].duration=this.getDuration(s[p-1].startDate,t.ganttProperties.endDate,t.ganttProperties.durationUnit,t.ganttProperties.isAutoSchedule,t.ganttProperties.isMilestone);continue}if(u={},!(c&&g&&c&&f))break;if(o+=Number(f),u.startDate=c,u.endDate=g,u.duration=Number(f),u.width=0,u.left=0,u.segmentIndex=p,s.push(u),(0,e.isNullOrUndefined)(s[p-1]))u.offsetDuration=0;else{var y=this.getDuration(s[p-1].endDate,s[p].startDate,t.ganttProperties.durationUnit,t.ganttProperties.isAutoSchedule,t.ganttProperties.isMilestone);if(u.offsetDuration=y,y<1){if(0===this.parent.weekWorkingTime.length)u.startDate=this.getEndDate(s[p-1].endDate,1,t.ganttProperties.durationUnit,t.ganttProperties,!1);else{var D=new Date(s[p-1].endDate.getTime());if(u.startDate=new Date(D.setHours(D.getHours()+24)),this.isOnHolidayOrWeekEnd(u.startDate,!0))do{u.startDate.setDate(u.startDate.getDate()+1)}while(this.isOnHolidayOrWeekEnd(u.startDate,!0));this.parent.includeWeekend||(u.startDate=this.getNextWorkingDay(u.startDate));m=this.parent.getEndTime(s[p-1].endDate);this.getSecondsInDecimal(s[p-1].endDate)===m&&this.setTime(this.parent.getEndTime(u.startDate),u.startDate)}u.startDate=this.checkStartDate(u.startDate,t.ganttProperties,!1),u.endDate=this.getEndDate(u.startDate,u.duration,t.ganttProperties.durationUnit,t.ganttProperties,!1),u.endDate=!n.duration&&n.endDate&&u.endDate>t.ganttProperties.endDate?t.ganttProperties.endDate:u.endDate,u.offsetDuration=1}}h.push(this.setSegmentTaskData(u,r[p]))}this.parent.setRecordValue("duration",o,t.ganttProperties,!0),(0,e.isNullOrUndefined)(s[s.length-1])||this.parent.setRecordValue("endDate",s[s.length-1].endDate,t.ganttProperties,!0),(0,e.isNullOrUndefined)(n.endDate)||(0,e.isNullOrUndefined)(s[s.length-1])||this.parent.setRecordValue(this.parent.taskFields.endDate,s[s.length-1].endDate,t,!0),!i&&h&&h.length>0&&h.forEach((function(e,t){var i=Object.assign({},e,a.customSegmentProperties[t]);h[t]=i})),this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,h,t)}return s.length>1?(this.parent.setRecordValue("segments",s,t.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.segments,t.taskData[this.parent.taskFields.segments],t,!0)):s=null,s},a.prototype.setSegmentTaskData=function(t,i){var r=this.parent.taskFields,a=(0,e.extend)({},{},i,!0);return(0,e.isNullOrUndefined)(r.startDate)||(a[this.parent.taskFields.startDate]=t.startDate),(0,e.isNullOrUndefined)(r.endDate)||(a[this.parent.taskFields.endDate]=t.endDate),(0,e.isNullOrUndefined)(r.duration)||(a[this.parent.taskFields.duration]=Number(t.duration)),a},a.prototype.updateWorkWithDuration=function(t){var i,r=this.parent.editModule&&this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.currentResources?this.parent.editModule.dialogModule.currentResources:t.ganttProperties.resourceInfo,a=0;if(!(0,e.isNullOrUndefined)(r)&&!t.hasChildRecords){var n=r.length,s=void 0,o=void 0,l=(this.parent.weekWorkingTime.length>0?this.parent.getSecondsPerDay(t.ganttProperties.startDate?t.ganttProperties.startDate:t.ganttProperties.endDate):this.parent.secondsPerDay)/3600,d=this.getDurationInDay(t.ganttProperties.duration,t.ganttProperties.durationUnit);for(s=0;s<n;s++)a+=(i=(o=r[s][this.parent.resourceFields.unit])>0?l*o/100:"FixedUnit"!==t.ganttProperties.taskType?l:0)*d;"minute"===t.ganttProperties.workUnit&&(a*=60),"day"===t.ganttProperties.workUnit&&(a/=l),a%1!=0&&(a=parseFloat(a.toFixed(2)))}if(t.childRecords&&t.childRecords.length>0&&this.parent.isOnEdit){for(var h=0,p=0;p<t.childRecords.length;p++)h+=t.childRecords[p].ganttProperties.work;a+=h}"FixedUnit"===t.ganttProperties.taskType&&0===i&&(a=0,this.parent.setRecordValue("duration",0,t.ganttProperties,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.duration)||this.parent.setRecordValue(this.parent.taskFields.duration,0,t,!0)),this.parent.setRecordValue("work",a,t.ganttProperties,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.work)||this.parent.dataOperation.updateMappingData(t,"work")},a.prototype.getCloneParent=function(t){if((0,e.isNullOrUndefined)(t))return null;var i={};return i.uniqueID=t.uniqueID,i.expanded=t.expanded,i.level=t.level,i.index=t.index,i.taskId=t.ganttProperties.rowUniqueID,i},a.prototype.reUpdateResources=function(){if(this.parent.flatData.length>0)for(var e=void 0,t=void 0,i=void 0,r=0;r<this.parent.flatData.length;r++)e=this.parent.flatData[r].taskData,t=this.parent.flatData[r].ganttProperties,i=this.parent.flatData[r],this.parent.setRecordValue("resourceInfo",this.setResourceInfo(e),t,!0),this.updateResourceName(i)},a.prototype.addTaskData=function(t,i,a){var n=this,s=this.parent.taskFields,o=this.parent.dataSource;if(a)if(s.parentID||o instanceof r.DataManager&&o.dataSource.json&&o.dataSource.offline)if(s.parentID){var l=i[s.id],d=this.taskIds.indexOf(l.toString()),h=d>-1?this.dataArray[d]:{};if(!(0,e.isNullOrUndefined)(this.parent.taskFields.segmentId)){var p=this.segmentCollection.filter((function(e){return e.key===h[n.parent.taskFields.id]}));p.length>0&&(h[this.parent.taskFields.segments]=p[0].items)}this.parent.setRecordValue("taskData",h,t)}else this.parent.setRecordValue("taskData",i,t);else this.parent.setRecordValue("taskData",i,t);else this.parent.setRecordValue("taskData",i,t)},a.prototype.updateExpandStateMappingValue=function(t,i){var r,a=this.parent.taskFields.expandState,n=i[a];a&&t.hasChildRecords&&((0,e.isNullOrUndefined)(n)?(0,e.isNullOrUndefined)(n)&&!this.parent.collapseAllParentTasks?r=!0:(0,e.isNullOrUndefined)(n)&&this.parent.collapseAllParentTasks&&(r=!1):r="true"===n.toString(),this.parent.setRecordValue("taskData."+a,r,t),this.parent.setRecordValue(a,r,t),this.parent.setRecordValue("expanded",r,t))},a.prototype.setValidatedDates=function(t,i){var r=t.ganttProperties,a=this.parent.taskFields,n=i[a.duration],s=this.getDateFromFormat(i[a.startDate],!0),o=this.getDateFromFormat(i[a.endDate],!0);n=(0,e.isNullOrUndefined)(n)||""===n?null:n,this.parent.setRecordValue("startDate",new Date(s.getTime()),r,!0),(0,e.isNullOrUndefined)(n)||""===n?this.calculateDuration(t):this.updateDurationValue(n,r),this.parent.setRecordValue("endDate",new Date(o.getTime()),r,!0)},a.prototype.calculateScheduledValues=function(t,i,r){var a,n,s=this.parent.taskFields,o=t.ganttProperties,l=i[s.duration];l=(0,e.isNullOrUndefined)(l)||""===l?null:l,o.startDate&&o.endDate?(a=this.getDateFromFormat(o.startDate,!0),n=this.getDateFromFormat(o.endDate,!0)):(a=this.getDateFromFormat(i[s.startDate],!0),n=this.getDateFromFormat(i[s.endDate],!0));var d=s.segments?i[s.segments]||t.taskData[s.segments]:null,h=!!s.milestone&&!!i[s.milestone],p=i[s.durationUnit]?i[s.durationUnit]:"";this.parent.setRecordValue("durationUnit",this.validateDurationUnitMapping(p),o,!0);var u=(0,e.isNullOrUndefined)(i[s.work])?0:parseFloat(i[s.work]);this.parent.setRecordValue("workUnit",this.validateWorkUnitMapping(this.parent.workUnit),o,!0);var c=i[s.type]?i[s.type]:"",g=this.validateTaskTypeMapping(c);if(this.parent.setRecordValue("taskType",g,o,!0),r&&!this.parent.enableValidation&&a&&n)this.setValidatedDates(t,i);else if(n||a||!(0,e.isNullOrUndefined)(l)&&""!==l)a?this.calculateDateFromStartDate(a,n,l,t,r):n?this.calculateDateFromEndDate(n,l,t):(0,e.isNullOrUndefined)(l)||""===l||(this.updateDurationValue(l,o),this.parent.allowUnscheduledTasks?(this.parent.setRecordValue("startDate",null,o,!0),this.parent.setRecordValue("endDate",null,o,!0)):(this.parent.setRecordValue("startDate",this.getProjectStartDate(o,r),o,!0),this.calculateEndDate(t)));else{if(this.parent.allowUnscheduledTasks)return;this.parent.setRecordValue("duration",1,o,!0),this.parent.setRecordValue("startDate",this.getProjectStartDate(o,r),o,!0),this.calculateEndDate(t)}if((!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&((0,e.isNullOrUndefined)(t.ganttProperties.startDate)||(t[this.parent.taskFields.startDate]=t.ganttProperties.startDate,t.taskData[this.parent.taskFields.startDate]=t.ganttProperties.startDate),(0,e.isNullOrUndefined)(t.ganttProperties.endDate)||(t[this.parent.taskFields.endDate]=t.ganttProperties.endDate,t.taskData[this.parent.taskFields.endDate]=t.ganttProperties.endDate)),(0,e.isNullOrUndefined)(d)||this.parent.setRecordValue("segments",this.setSegmentsInfo(t,!0),o,!0),0===o.duration&&(this.parent.setRecordValue("isMilestone",!0,o,!0),(0,e.isNullOrUndefined)(this.parent.taskFields)||(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,t,!0),this.parent.setRecordValue("endDate",o.startDate,o,!0)),!(0,e.isNullOrUndefined)(h)&&h&&(this.parent.setRecordValue("duration",0,o,!0),this.parent.setRecordValue("isMilestone",!0,o,!0),(0,e.isNullOrUndefined)(this.parent.taskFields)||(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,t,!0),this.parent.setRecordValue("endDate",o.startDate,o,!0)),(0,e.isNullOrUndefined)(s.work))s.type&&o.taskType&&this.parent.dataOperation.updateMappingData(t,"type");else{if(this.parent.setRecordValue("durationUnit",this.parent.durationUnit,o,!0),isNaN(u)||(0,e.isNullOrUndefined)(u))this.parent.setRecordValue("work",0,o,!0),this.parent.setRecordValue("duration",0,o,!0),this.parent.setRecordValue("isMilestone",!0,o,!0),(0,e.isNullOrUndefined)(this.parent.taskFields)||(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,t,!0),this.parent.setRecordValue("endDate",o.startDate,o,!0);else{switch(this.parent.setRecordValue("work",u,o,!0),g){case"FixedDuration":(0,e.isNullOrUndefined)(t[this.parent.taskFields.resourceInfo])||0===t.ganttProperties.resourceInfo.length||this.updateWorkWithDuration(t);break;case"FixedWork":(0,e.isNullOrUndefined)(t[this.parent.taskFields.resourceInfo])||0===t.ganttProperties.resourceInfo.length||this.updateDurationWithWork(t),this.updateUnitWithWork(t);break;case"FixedUnit":this.updateWorkWithDuration(t)}(0,e.isNullOrUndefined)(s.type)||this.parent.dataOperation.updateMappingData(t,"type"),0===o.duration?(this.parent.setRecordValue("isMilestone",!0,o,!0),(0,e.isNullOrUndefined)(this.parent.taskFields)||(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,t,!0),this.parent.setRecordValue("endDate",o.startDate,o,!0)):(0,e.isNullOrUndefined)(o.startDate)||(0,e.isNullOrUndefined)(o.duration)||(this.parent.setRecordValue("isMilestone",!1,o,!0),(0,e.isNullOrUndefined)(this.parent.taskFields)||(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!1,t,!0),this.calculateEndDate(t))}this.parent.dataOperation.updateMappingData(t,"work")}},a.prototype.updateDurationWithWork=function(t){var i=t.ganttProperties,r=this.parent.editModule&&this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.currentResources?this.parent.editModule.dialogModule.currentResources:i.resourceInfo;if(!(0,e.isNullOrUndefined)(r)){var a=(0,e.isNullOrUndefined)(r)?0:r.length,n=0,s=(this.parent.weekWorkingTime.length>0?this.parent.getSecondsPerDay(t.ganttProperties.startDate?t.ganttProperties.startDate:t.ganttProperties.endDate):this.parent.secondsPerDay)/3600,o=0,l=void 0,d=void 0;for(d=0;d<a;d++)n+=(l=r[d][this.parent.resourceFields.unit])>0?s*l/100:"FixedUnit"!==t.ganttProperties.taskType?s:0;var h=this.getWorkInHour(i.work,i.workUnit);a>0&&n>0&&(o+=h/n),"FixedUnit"===i.taskType&&0===n&&(this.parent.setRecordValue("work",0,i,!0),this.parent.setRecordValue(this.parent.taskFields.work,0,t,!0)),"minute"===i.durationUnit&&(o=o*s*60),"hour"===i.durationUnit&&(o*=s),o%1!=0&&(o=parseFloat(o.toFixed(2))),(0,e.isNullOrUndefined)(i.duration)||this.parent.setRecordValue("duration",o,i,!0),this.parent.dataOperation.updateMappingData(t,"duration")}},a.prototype.updateUnitWithWork=function(t){var i=t.ganttProperties,r=this.parent.isLoad||(0,e.isNullOrUndefined)(this.parent.editModule)||(0,e.isNullOrUndefined)(this.parent.editModule.dialogModule)||this.parent.editModule.dialogModule.isEdit||this.parent.editModule.cellEditModule.isCellEdit?i.resourceInfo:this.parent.editModule.dialogModule.ganttResources,a=(0,e.isNullOrUndefined)(r)?0:r.length,n=(this.parent.weekWorkingTime.length>0?this.parent.getSecondsPerDay(t.ganttProperties.startDate?t.ganttProperties.startDate:t.ganttProperties.endDate):this.parent.secondsPerDay)/3600;if(0!==a){var s=this.getDurationInDay(t.ganttProperties.duration,t.ganttProperties.durationUnit),o=this.getWorkInHour(i.work,i.workUnit),l=s>0?o/(s*n)*100:0,d=0===l?0:l>0?l/a:100;d%1!=0&&(d=parseFloat(d.toFixed(2)));for(var h=0;h<a;h++)r[h][this.parent.resourceFields.unit]=d;this.updateResourceName(t)}},a.prototype.calculateDateFromEndDate=function(t,i,r){var a,n=r.ganttProperties;a=this.parent.weekWorkingTime.length>0?this.parent.getEndTime(t):this.parent.defaultEndTime,0===t.getHours()&&86400!==a&&this.setTime(a,t);var s=0===parseInt(i,10)||null;this.parent.setRecordValue("endDate",this.checkEndDate(t,r.ganttProperties,s),n,!0),(0,e.isNullOrUndefined)(i)||""===i?this.parent.allowUnscheduledTasks?(this.parent.setRecordValue("startDate",null,n,!0),this.parent.setRecordValue("duration",null,n,!0)):(this.parent.setRecordValue("duration",1,n,!0),this.parent.setRecordValue("startDate",this.getStartDate(n.endDate,n.duration,n.durationUnit,n),n,!0)):(0,e.isNullOrUndefined)(i)||""===i||(this.updateDurationValue(i,n),this.parent.setRecordValue("startDate",this.getStartDate(n.endDate,n.duration,n.durationUnit,n),n,!0))},a.prototype.calculateDateFromStartDate=function(t,i,r,a,n){var s=a.ganttProperties,o=!!(0===parseInt(r,10)||t&&i&&new Date(t.getTime())===new Date(i.getTime()))||null;if(this.parent.setRecordValue("startDate",this.checkStartDate(t,s,o,n),s,!0),this.parent.isTreeGridRendered&&a&&this.updateTaskData(a),i||!(0,e.isNullOrUndefined)(r)&&""!==r)if((0,e.isNullOrUndefined)(r)||i)if(i&&((0,e.isNullOrUndefined)(r)||""===r)){var l=void 0;l=this.parent.weekWorkingTime.length>0?this.parent.getEndTime(i):this.parent.defaultEndTime,0===i.getHours()&&86400!==l&&this.setTime(l,i),this.parent.setRecordValue("endDate",this.checkEndDate(i,a.ganttProperties),s,!0),1===this.compareDates(s.startDate,s.endDate)?(this.parent.setRecordValue("endDate",s.startDate,s,!0),this.parent.setRecordValue("isMilestone",!0,s,!0),this.parent.setRecordValue("duration",0,s,!0)):this.calculateDuration(a)}else this.updateDurationValue(r,s),!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.setRecordValue("endDate",i,s,!0):this.calculateEndDate(a);else this.updateDurationValue(r,s),this.calculateEndDate(a);else this.parent.allowUnscheduledTasks?(this.parent.setRecordValue("endDate",null,s,!0),this.parent.setRecordValue("duration",null,s,!0)):(this.parent.setRecordValue("duration",1,s,!0),this.calculateEndDate(a))},a.prototype.getProgressWidth=function(e,t){return e*t/100},a.prototype.calculateWidth=function(t,i){var r=t.ganttProperties,a=i?r.autoStartDate:r.startDate,n=i?r.autoEndDate:r.endDate;return(0,e.isNullOrUndefined)(a)&&(0,e.isNullOrUndefined)(n)&&(a=this.getValidStartDate(r,i),n=this.getValidEndDate(r,i)),(0,e.isNullOrUndefined)(a)||(0,e.isNullOrUndefined)(n)?3:!r.isMilestone||t.hasChildRecords&&!r.isAutoSchedule?this.getTaskWidth(a,n,r):0},a.prototype.getTaskbarHeight=function(){var e=this.parent.rowHeight,t=this.parent.taskbarHeight;return t<e?t:e},a.prototype.calculateLeft=function(t,i){var r=null,a=-300,n=i?t.autoStartDate:t.startDate,s=i?t.autoEndDate:t.endDate,o=(i?t.autoDuration:t.duration,t.isMilestone);if(n?r=new Date(n.getTime()):s?(r=new Date(s.getTime()),o=!(0,e.isNullOrUndefined)(n)||!this.parent.allowUnscheduledTasks):r=this.getValidStartDate(t),!(0,e.isNullOrUndefined)(r)){var l=void 0;t.duration&&/^\d+\.\d+$/.test(t.duration.toString())&&"day"===t.durationUnit&&(l=!!/^\d+\.\d+$/.test(t.duration.toString())),a=this.getTaskLeft(r,o,!1,l)}return a},a.prototype.calculateAutoLeft=function(e){return this.getTaskLeft(e.autoStartDate,e.isMilestone)},a.prototype.calculateAutoDuration=function(e){return this.getDuration(e.autoStartDate,e.autoEndDate,e.durationUnit,!1,e.isMilestone)},a.prototype.calculateAutoWidth=function(e){return this.getTaskWidth(e.autoStartDate,e.autoEndDate)},a.prototype.calculateBaselineLeft=function(e){var t=this.getDateFromFormat(e.baselineStartDate),i=this.getDateFromFormat(e.baselineEndDate);return t&&i?this.getTaskLeft(t,e.isMilestone):0},a.prototype.calculateBaselineWidth=function(e){var t=this.getDateFromFormat(e.baselineStartDate),i=this.getDateFromFormat(e.baselineEndDate);return t&&i&&t.getTime()!==i.getTime()?this.getTaskWidth(t,i):0},a.prototype.getTaskWidth=function(t,i,r){var a=new Date(t.getTime()),n=new Date(i.getTime()),s="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier,o=this.parent.currentZoomingLevel?this.parent.currentZoomingLevel:this.parent.timelineSettings,l=null!==o.bottomTier?o.bottomTier.count:o.topTier.count,d=!1,h=new Date(t.getTime()),p=0;if((0,e.isNullOrUndefined)(r)||"hour"!==r.durationUnit||(h=new Date(h.getTime()+60*r.duration*60*1e3)),(!(0,e.isNullOrUndefined)(r)&&"minute"===r.durationUnit||!(0,e.isNullOrUndefined)(r)&&"day"===r.durationUnit&&r.duration<1)&&(h=new Date(h.getTime()+60*r.duration*1e3)),this.parent.weekWorkingTime.length>0)for(var u=new Date(t.getTime()),c=t.getDate();c<=i.getDate();c++){var g=u.getDay(),f=void 0,m=this.parent.weekWorkingTime;switch(g){case 0:f="Sunday";break;case 1:f="Monday";break;case 2:f="Tuesday";break;case 3:f="Wednesday";break;case 4:f="Thursday";break;case 5:f="Friday";break;case 6:f="Saturday";break;default:f=""}for(var y=!0,D=0;D<m.length;D++)if(m[D][f]&&m[D][f].length>0){y=!1;for(var v=0;v<m[D][f].length;v++)p=p+m[D][f][v].to-m[D][f][v].from}if(y)for(var k=0;k<this.parent.dayWorkingTime.length;k++)p=p+this.parent.dayWorkingTime[k].to-this.parent.dayWorkingTime[k].from;u=new Date(u.setDate(u.getDate()+1)),this.parent.includeWeekend||(u=this.parent.dataOperation.getNextWorkingDay(u))}else for(D=0;D<this.parent.dayWorkingTime.length;D++)p=p+this.parent.dayWorkingTime[D].to-this.parent.dayWorkingTime[D].from;var w,b,T=h.getTime()-a.getTime();if(!(0,e.isNullOrUndefined)(r)&&"minute"===r.durationUnit&&r.duration<60*p||!(0,e.isNullOrUndefined)(r)&&"day"===r.durationUnit&&/^\d+\.\d+$/.test(r.duration.toString()))return"Day"===s?(this.parent.weekWorkingTime.length>0?(w=this.parent.getStartTime(a),b=this.parent.getEndTime(n)):(w=this.parent.defaultStartTime,b=this.parent.defaultEndTime),(Math.floor(T/36e5%24)>=p||0===T)&&(d=!0),this.getSecondsInDecimal(a)===w&&d&&a.setHours(0,0,0,0),this.getSecondsInDecimal(n)===b&&d&&n.setHours(24),this.getSecondsInDecimal(n)===w&&n.setHours(0,0,0,0)):d=!0,a.getTime()===n.getTime()?this.parent.perDayWidth:d?"day"===r.durationUnit&&/^\d+\.\d+$/.test(r.duration.toString())&&"Day"===this.parent.timelineModule.bottomTier?((this.parent.holidays&&this.parent.holidays.length>0?this.getHolidaysCount(a,n):0)+(this.parent.includeWeekend?0:this.getWeekendCount(a,n))+r.duration)*this.parent.perDayWidth:this.getTimeDifference(a,n,!0)/864e5*this.parent.perDayWidth:"day"===r.durationUnit&&r.duration<1?r.duration*this.parent.perDayWidth:this.getTimeDifference(a,n)/(36e5*p)*this.parent.perDayWidth;if("Day"===s&&(this.parent.weekWorkingTime.length>0?(w=this.parent.getStartTime(a),b=this.parent.getEndTime(n)):(w=this.parent.defaultStartTime,b=this.parent.defaultEndTime),this.getSecondsInDecimal(a)===w&&a.setHours(0,0,0,0),this.getSecondsInDecimal(n)===b&&(n.setHours(24),n.setHours(0,0,0,0)),this.getSecondsInDecimal(n)===w&&n.setHours(0,0,0,0)),a.getTime()===n.getTime())return this.parent.perDayWidth;if(this.parent.isInDst(a)||this.parent.isInDst(n)){var P=this.getTimeDifference(a,n,!0)/864e5*this.parent.perDayWidth,S=a.getTimezoneOffset(),C=n.getTimezoneOffset(),R=this.parent.timelineModule.customTimelineSettings.topTier;return R&&"Hour"===R.unit&&1===R.count&&(s=R.unit,l=R.count),"Hour"===s&&1===l&&S!==C&&S>C&&(P-=this.parent.perDayWidth/24),P}return this.getTimeDifference(a,n)/864e5*this.parent.perDayWidth},a.prototype.getDSTTransitions=function(e){function t(e,t,i,r){var a=(new Date(e,t,1).getDay()+7)%7;return new Date(e,t,1+(i-a+7)%7+7*(r-1))}var i=t(e,2,0,2),r=new Date(i.setHours(2,0,0)),a=t(e,10,0,1);return{dstStart:r,dstEnd:new Date(a.setHours(2,0,0))}},a.prototype.hasDSTTransition=function(e){var t=new Date(e,0,1),i=new Date(e,6,1);return t.getTimezoneOffset()!==i.getTimezoneOffset()},a.prototype.getTaskLeft=function(t,i,r,a){var n,s=new Date(t.getTime()),o="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier,l=this.parent.currentZoomingLevel?this.parent.currentZoomingLevel:this.parent.timelineSettings,d=null!==l.bottomTier?l.bottomTier.count:l.topTier.count;if("Day"===o){var h=void 0,p=void 0;this.parent.weekWorkingTime.length>0?(h=this.parent.getStartTime(s),p=this.parent.getEndTime(s)):(h=this.parent.defaultStartTime,p=this.parent.defaultEndTime),this.getSecondsInDecimal(s)===h?s.setHours(0,0,0,0):i&&this.getSecondsInDecimal(s)===p?s.setHours(24):this.getSecondsInDecimal(s)===p&&this.parent.allowUnscheduledTasks&&s.setHours(22)}var u=!0;this.parent.editModule&&(this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.taskBarEditAction||this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.isEdit||this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit||this.parent.ganttChartModule.scrollObject.isSetScrollLeft)&&!r&&(u=!1),this.parent.enableTimelineVirtualization&&u&&!this.parent.timelineModule.performedTimeSpanAction&&(n=this.parent.enableTimelineVirtualization&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():null);var c=this.parent.enableTimelineVirtualization&&!(0,e.isNullOrUndefined)(n)?new Date(this.parent.timelineModule.dateByLeftValue(n).toString()):new Date(this.parent.timelineModule.timelineStartDate);if(c){var g=void 0,f=this.getDSTTransitions(t.getFullYear()),m=this.hasDSTTransition(t.getFullYear());if(this.parent.isInDst(t)&&!this.parent.isInDst(c)){var y=new Date(c.getTime()-36e5);this.parent.dayWorkingTime[0].properties.from>f.dstStart.getHours()&&"Day"===o&&(y=new Date(c.getTime())),g=(s.getTime()-y.getTime())/864e5*this.parent.perDayWidth}else{var D=void 0;if("Day"===this.parent.timelineModule.bottomTier&&a){if(this.getSecondsInDecimal(s)!==this.parent.defaultStartTime){var v=new Date(t.getTime()),k=new Date(v.setHours(0,0,0,0));D=this.getDuration(k,t,"day",!0,!1)*this.parent.perDayWidth,s.setHours(0,0,0,0)}g=(s.getTime()-c.getTime())/864e5*this.parent.perDayWidth,this.getSecondsInDecimal(s)!==this.parent.defaultStartTime&&"Day"===this.parent.timelineModule.bottomTier&&(g+=D)}else g=(s.getTime()-c.getTime())/864e5*this.parent.perDayWidth}var w=c.getTime()<=f.dstStart.getTime();if(this.parent.dayWorkingTime[0].properties.from>f.dstStart.getHours()&&w&&"Day"===o&&m&&this.getSecondsInDecimal(s)===this.parent.defaultStartTime)if(g%this.parent.perDayWidth!=0)g+=this.parent.perDayWidth-g%this.parent.perDayWidth;!this.parent.isInDst(c)||this.parent.isInDst(t)||"Hour"!==this.parent.timelineModule.topTier&&"Hour"!==this.parent.timelineModule.bottomTier||(g-=this.parent.timelineSettings.timelineUnitSize);var b=this.parent.timelineModule.customTimelineSettings.topTier;return b&&"Hour"===b.unit&&1===b.count&&(o=b.unit,d=b.count),1===d&&"Hour"===o&&t>=f.dstStart&&w&&m&&(g-=this.parent.perDayWidth/24),g}return 0},a.prototype.getSplitTaskWidth=function(e,t,i){var r=new Date(e.getTime()),a=new Date(this.getEndDate(r,t,i.ganttProperties.durationUnit,i.ganttProperties,!1).getTime());if("Day"===("None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier)){var n=void 0,s=void 0;this.parent.weekWorkingTime.length>0?(n=this.parent.getStartTime(r),s=this.parent.getEndTime(a)):(n=this.parent.defaultStartTime,s=this.parent.defaultEndTime),this.getSecondsInDecimal(r)===n&&r.setHours(0,0,0,0),this.getSecondsInDecimal(a)===s&&a.setHours(24),this.getSecondsInDecimal(a)===n&&a.setHours(0,0,0,0)}return this.getTimeDifference(r,a)/864e5*this.parent.perDayWidth},a.prototype.getSplitTaskLeft=function(e,t){var i=new Date(e.getTime());if("Day"===("None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier)){var r=void 0,a=void 0;this.parent.weekWorkingTime.length>0?(r=this.parent.getStartTime(i),a=this.parent.getStartTime(t)):a=r=this.parent.defaultStartTime,this.getSecondsInDecimal(i)===r&&i.setHours(0,0,0,0),this.getSecondsInDecimal(t)===a&&t.setHours(0,0,0,0)}return t?(i.getTime()-t.getTime())/864e5*this.parent.perDayWidth:0},a.prototype.updateMappingData=function(t,i){var r=this.parent.columnMapping,a=t.ganttProperties;if(!(0,e.isNullOrUndefined)(r[i])||"taskType"===i||"segments"===i)if("predecessorName"===i);else if("resourceInfo"===i){var n=a.resourceInfo,s=this.parent.resourceFields,o=[],l=[];if(!(0,e.isNullOrUndefined)(n))for(var d=0;d<n.length;d++){o.push(n[d][s.id]);var h=n[d][s.name],p=n[d][s.unit];100!==p&&(h+="["+p+"%]"),h&&l.push(h)}this.parent.setRecordValue("resourceNames",l.join(","),a,!0),this.isResourceString?(t.taskData[this.parent.taskFields.resourceInfo]=t.taskData[this.parent.taskFields.resourceInfo][0][s.name],this.updateTaskDataResource(t)):this.updateTaskDataResource(t),this.parent.setRecordValue(r[i],l.join(","),t)}else"startDate"===i||"endDate"===i?this.setRecordDate(t,a[i],r[i]):"duration"===i?this.setRecordDuration(t,r[i]):"work"===i?(this.parent.setRecordValue("taskData."+r[i],a.work,t),this.parent.setRecordValue(r[i],a[i],t)):"type"===i?(this.parent.setRecordValue("taskData."+r[i],a[i],t),this.parent.setRecordValue(r[i],a[i],t)):"manual"===i?(this.parent.setRecordValue("taskData."+r[i],!a.isAutoSchedule,t),this.parent.setRecordValue(r[i],!a.isAutoSchedule,t)):"segments"===i?this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,this.segmentTaskData(t),t):(this.parent.setRecordValue("taskData."+r[i],a[i],t),this.parent.setRecordValue(r[i],a[i],t))},a.prototype.segmentTaskData=function(t){var i=this,r=t.ganttProperties.segments,a=this.parent.taskFields;if((0,e.isNullOrUndefined)(r))return null;for(var n=(0,e.extend)([],[],t.taskData[a.segments],!0),s=0;s<r.length;s++)(this.parent.isEdit||this.parent.editModule&&this.parent.editModule.dialogModule&&(0,e.getValue)("isEdit",this.parent.editModule.dialogModule)||this.parent.contextMenuModule&&(0,e.getValue)("isEdit",this.parent.contextMenuModule))&&(n[s]={}),(0,e.isNullOrUndefined)(a.startDate)||(n[s][this.parent.taskFields.startDate]=r[s].startDate),(0,e.isNullOrUndefined)(a.endDate)||(n[s][this.parent.taskFields.endDate]=r[s].endDate),(0,e.isNullOrUndefined)(a.duration)||(n[s][this.parent.taskFields.duration]=Number(r[s].duration));return this.customSegmentProperties.length>0&&n&&n.length>0&&n.forEach((function(e,t){var r=Object.assign({},e,i.customSegmentProperties[t]);n[t]=r})),n},a.prototype.updateTaskDataResource=function(t){var i=t.ganttProperties.resourceInfo,r=t.taskData[this.parent.taskFields.resourceInfo],a=this.parent.resourceFields;if((0,e.isNullOrUndefined)(r))t.taskData[this.parent.taskFields.resourceInfo]=i;else if(i.length){for(var n=0;n<i.length;n++){var s=!1;if("string"==typeof r){if("string"==typeof r&&r===i[n][a.name]){r=i[n][a.name],s=!0;break}}else for(var o=0;o<r.length;o++)if("number"==typeof r[o]||"string"==typeof r[o]){if(parseInt(r[o],10)===parseInt(i[n][a.id],10)){r[o]=i[n],s=!0;break}}else if(r[o][a.id]===i[n][a.id]&&"number"!=typeof r[o]){r[o]=(0,e.extend)({},r[o],i[n],!0),s=!0;break}s||("string"==typeof r?r=i[n][a.name]:r.push(i[n]))}var l=[];if("string"!=typeof r){for(var d=function(e){i.filter((function(t){t[a.id]===r[e][a.id]&&-1===l.indexOf(r[e])&&l.push(r[e])}))},h=0;h<r.length;h++)d(h);this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,l,t)}else this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,r,t)}else this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,[],t)},a.prototype.setRecordDate=function(t,i,r){var a="string"==typeof i?new Date(i):i;(0,e.isNullOrUndefined)(i)||(i=new Date(a.getTime())),this.parent.setRecordValue(r,i,t),(0,e.isNullOrUndefined)(i)||(i=new Date(a.getTime())),this.parent.isLoad||this.parent.isDynamicData||this.parent.setRecordValue("taskData."+r,i,t),this.parent.isDynamicData=!1},a.prototype.getDurationInDay=function(e,t){return"day"===t?e:"hour"===t?e/(this.parent.secondsPerDay/3600):e/(this.parent.secondsPerDay/60)},a.prototype.setRecordDuration=function(t,i){var r=t.ganttProperties.duration,a=t.ganttProperties.durationUnit;if((0,e.isNullOrUndefined)(r))this.parent.setRecordValue(i,r,t),this.parent.setRecordValue("taskData."+i,r,t);else{this.parent.setRecordValue(i,t.ganttProperties.duration,t);var n=(0,e.getValue)(i,t.taskData);isNaN(n)&&(0,e.isNullOrUndefined)(this.parent.taskFields.durationUnit)&&!(0,e.isNullOrUndefined)(n)?this.parent.setRecordValue("taskData."+i,this.getDurationString(r,a),t):"string"==typeof n?this.parent.setRecordValue("taskData."+i,r.toString(),t):this.parent.setRecordValue("taskData."+i,r,t)}this.parent.taskFields.durationUnit&&(t.taskData[this.parent.taskFields.durationUnit]=t.ganttProperties.durationUnit)},a.prototype.setDataSource=function(t){var i,r=[];Array.isArray(t)&&(i=t);for(var a=i.length,n=0;n<a;n++){var s=t[n];r.push(s),(0,e.isNullOrUndefined)(t[n][this.parent.taskFields.child])||this.setDataSource(t[n][this.parent.taskFields.child])}return r},a.prototype.setStartDate=function(t){var i=this;((0,e.isNullOrUndefined)(this.parent.taskFields.parentID)||(0,e.isNullOrUndefined)(this.parent.taskFields.id)?this.parent.dataSource:this.setDataSource(this.parent.dataSource)).map((function(r){t.ganttProperties.taskId===r[i.parent.taskFields.id]&&((0,e.isNullOrUndefined)(i.parent.taskFields.startDate)||(t[i.parent.taskFields.startDate]=r[i.parent.taskFields.startDate]),(0,e.isNullOrUndefined)(i.parent.taskFields.endDate)||(t[i.parent.taskFields.endDate]=r[i.parent.taskFields.endDate]))}))},a.prototype.getWorkInHour=function(e,t){return"day"===t?e*(this.parent.secondsPerDay/3600):"minute"===t?e/60:e},a.prototype.updateTaskData=function(t){var i=this.parent.taskFields,r=t.ganttProperties;if(!(0,e.isNullOrUndefined)(t.taskData)){var a=t.taskData;if(i.id&&(this.parent.setRecordValue("taskData."+i.id,r.taskId,t),this.parent.setRecordValue(i.id,r.taskId,t)),i.name&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.name,r.taskName,t),this.parent.setRecordValue(i.name,r.taskName,t)),i.startDate&&this.setRecordDate(t,r.startDate,i.startDate),i.endDate&&this.setRecordDate(t,r.endDate,i.endDate),i.duration&&((0,e.isNullOrUndefined)(i.milestone)||!(0,e.isNullOrUndefined)(i.milestone)&&!t.taskData[i.milestone])&&this.setRecordDuration(t,i.duration),i.durationUnit&&(a[i.durationUnit]=r.durationUnit),i.progress&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.progress,r.progress,t),this.parent.setRecordValue(i.progress,r.progress,t)),i.baselineStartDate&&this.setRecordDate(t,r.baselineStartDate,i.baselineStartDate),i.baselineEndDate&&this.setRecordDate(t,r.baselineEndDate,i.baselineEndDate),i.notes&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.notes,r.notes,t),this.parent.setRecordValue(i.notes,r.notes,t)),i.cssClass&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.cssClass,r.cssClass,t),this.parent.setRecordValue(i.cssClass,r.cssClass,t)),i.indicators&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.indicators,r.indicators,t),this.parent.setRecordValue(i.indicators,r.indicators,t)),i.parentID){var n="ProjectView"===this.parent.viewType?r.parentId:a[i.parentID];this.parent.setRecordValue("taskData."+i.parentID,n,t),this.parent.setRecordValue(i.parentID,r.parentId,t)}i.work&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.work,r.work,t),this.parent.setRecordValue(i.work,r.work,t)),i.type&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.type,r.taskType,t),this.parent.setRecordValue(i.type,r.taskType,t))}},a.prototype.setResourceInfo=function(t){var i,r,a=this;if((0,e.isNullOrUndefined)(t[this.parent.taskFields.resourceInfo]))return i;i=t[this.parent.taskFields.resourceInfo],r=(0,e.isNullOrUndefined)(this.parent.editModule)||(0,e.isNullOrUndefined)(this.parent.editModule.dialogModule)||!this.parent.editModule.dialogModule.isAddNewResource?this.parent.resources:this.parent.editModule.dialogModule.ganttResources;var n,s=this.parent.resourceFields.id,o=this.parent.resourceFields.unit,l=this.parent.resourceFields.group,d=[];if("string"==typeof i&&""!==i){if(0===t[this.parent.taskFields.resourceInfo].split(",").length){r.forEach((function(e){i===e[a.parent.resourceFields.name]&&(n=[e])}));var h=(0,e.extend)({},n[0]);d.push(h),(0,e.isNullOrUndefined)(o)||(0,e.isNullOrUndefined)(i[o])||(h[o]=i[o]),(0,e.isNullOrUndefined)(l)||(0,e.isNullOrUndefined)(i[l])||(h[l]=i[l])}}else for(var p=function(t){var a=r.filter((function(e){return"object"==typeof i[t]&&i[t][s]===e[s]||i[t]===e[s]})),n=(0,e.extend)({},a[0]);d.push(n),(0,e.isNullOrUndefined)(o)||(0,e.isNullOrUndefined)(i[t][o])||(n[o]=i[t][o]),(0,e.isNullOrUndefined)(l)||(0,e.isNullOrUndefined)(i[t][l])||(n[l]=i[t][l])},u=0;u<i.length;u++)p(u);return this.updateResourceUnit(d),d},a.prototype.updateResourceUnit=function(t){var i=this.parent.resourceFields.unit;if(!(0,e.isNullOrUndefined)(i)){var r=t.length,a=void 0;for(a=0;a<r;a++)(0,e.isNullOrUndefined)(t[a][i])&&(t[a][i]=100)}},a.prototype.updateResourceName=function(t){var i=t.ganttProperties.resourceInfo,r=[],a=this.parent.taskFields;if(i&&i.length>0){var n=i.length;if("string"==typeof t.taskData[this.parent.taskFields.resourceInfo]){var s=o=t.taskData[this.parent.taskFields.resourceInfo];this.parent.setRecordValue("resourceNames",s,t.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.resourceInfo,s,t,!0),this.updateTaskDataResource(t)}else{var o=(0,e.extend)([],[],t.taskData[this.parent.taskFields.resourceInfo],!0);this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,[],t);for(var l=0;l<n;l++){var d=i[l],h=d[this.parent.resourceFields.name],p=d[this.parent.resourceFields.unit];if(100!==p&&(h+="["+p+"%]"),(0,e.isNullOrUndefined)(h)||r.push(h),t.taskData){var u=a.resourceInfo;o[l]&&(o[parseInt(l.toString(),10)],1)?t.taskData[u].push(o[l]):t.taskData[u].push(d[this.parent.resourceFields.id])}}this.parent.setRecordValue("resourceNames",r.join(","),t.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.resourceInfo,r.join(","),t,!0),this.updateTaskDataResource(t)}}},a.prototype.dataReorder=function(e,t){for(var i=[];e.length>0&&t.length>0;){var r=t.indexOf(e[0]);-1===r?e.shift():(i.push(e.shift()),t.splice(r,1))}return i},a.prototype.validateDurationUnitMapping=function(e){var t=e;return t="minute"===t||"minutes"===t||"m"===t||"min"===t?"minute":"hour"===t||"hours"===t||"h"===t||"hr"===t?"hour":"day"===t||"days"===t||"d"===t?"day":this.parent.durationUnit.toLocaleLowerCase()},a.prototype.validateTaskTypeMapping=function(e){var t=e;return t="FixedDuration"===t?"FixedDuration":"FixedUnit"===t?"FixedUnit":"FixedWork"===t?"FixedWork":this.parent.taskType},a.prototype.validateWorkUnitMapping=function(e){var t=e;return t="minute"===t?"minute":"hour"===t?"hour":"day"===t?"day":this.parent.workUnit.toLocaleLowerCase()},a.prototype.updateDurationValue=function(t,i){var r=this.getDurationValue(t);isNaN((0,e.getValue)("duration",r))||"ResourceView"===this.parent.viewType&&0===r.duration&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit||this.parent.setRecordValue("duration",(0,e.getValue)("duration",r),i,!0),(0,e.isNullOrUndefined)((0,e.getValue)("durationUnit",r))||this.parent.setRecordValue("durationUnit",(0,e.getValue)("durationUnit",r),i,!0)},a.prototype.reUpdateGanttData=function(){if(this.parent.flatData.length>0){var t=void 0,i=void 0;this.parent.secondsPerDay=this.getSecondsPerDay();for(var r=0;r<this.parent.flatData.length;r++)t=this.parent.flatData[r].taskData,i=this.parent.flatData[r],(0,e.isNullOrUndefined)(this.parent.taskFields.duration)||this.setRecordDuration(i,this.parent.taskFields.duration),this.parent.isLoad&&this.setStartDate(i),this.calculateScheduledValues(i,t,!1);this.updateGanttData()}},a.prototype._isInStartDateRange=function(e,t,i){var r=!1;return e.getTime()>=t.getTime()&&e.getTime()<i.getTime()&&(r=!0),r},a.prototype._isInEndDateRange=function(e,t,i){var r=!1;return e.getTime()>t.getTime()&&e.getTime()<=i.getTime()&&(r=!0),r},a.prototype.updateOverlappingValues=function(e){var t,i=e.childRecords,r=[];if(i.length<=1)e.ganttProperties.workTimelineRanges=[];else{i=this.setSortedChildTasks(e),this.updateOverlappingIndex(i);for(var a=1;a<i.length;a++){var n=void 0,s=void 0;(t=i[a]).ganttProperties.startDate&&(n=new Date(t.ganttProperties.startDate.getTime())),t.ganttProperties.endDate&&(s=new Date(t.ganttProperties.endDate.getTime()));for(var o=[],l=0;l<a;l++){var d=i[l].ganttProperties.startDate,h=i[l].ganttProperties.endDate,p={};n&&s&&h&&(this._isInStartDateRange(n,d,h)||this._isInEndDateRange(s,d,h))&&(d.getTime()>n.getTime()&&d.getTime()<s.getTime()&&h.getTime()>n.getTime()&&h.getTime()>=s.getTime()||n.getTime()===d.getTime()&&s.getTime()<=h.getTime()?(p.from=d,p.to=s):n.getTime()===d.getTime()&&s.getTime()>h.getTime()?(p.from=d,p.to=h):n.getTime()>d.getTime()&&s.getTime()>=h.getTime()?(p.from=n,p.to=h):n.getTime()>d.getTime()&&s.getTime()<h.getTime()&&(p.from=n,p.to=s),o.push(p))}r.push.apply(r,this.mergeRangeCollections(o))}this.parent.setRecordValue("workTimelineRanges",this.mergeRangeCollections(r,!0),e.ganttProperties,!0),this.calculateRangeLeftWidth(e.ganttProperties.workTimelineRanges)}},a.prototype.updateOverlappingIndex=function(e){for(var t=0;t<e.length;t++)e[t].ganttProperties.eOverlapIndex=t},a.prototype.calculateRangeLeftWidth=function(e){for(var t=0;t<e.length;t++)e[t].left=this.getTaskLeft(e[t].from,!1),e[t].width=this.getTaskWidth(e[t].from,e[t].to)},a.prototype.mergeRangeCollections=function(e,t){for(var i,a,n,s,o=[],l={},d={},h=new r.DataManager(e).executeLocal((new r.Query).sortBy(this.parent.taskFields.startDate,"Ascending")),p=0;p<h.length;p++)0!==o.length||0!==p?(i=(l=o[o.length-1]).from,a=l.to,n=(d=h[p]).from,s=d.to,i.getTime()===n.getTime()&&a.getTime()>=s.getTime()||i.getTime()<n.getTime()&&a.getTime()>=s.getTime()||(i.getTime()<=n.getTime()&&a.getTime()>=n.getTime()&&a.getTime()<s.getTime()||a.getTime()<n.getTime()&&this.checkStartDate(a).getTime()===n.getTime()?l.to=s:a.getTime()<n.getTime()&&this.checkStartDate(a).getTime()!==n.getTime()&&o.push(h[p]))):o.push(h[p]);return t&&(o=this.splitRangeCollection(o)),o},a.prototype.setSortedChildTasks=function(e){return new r.DataManager(e.childRecords).executeLocal((new r.Query).sortBy(this.parent.taskFields.startDate,"Ascending"))},a.prototype.splitRangeCollection=function(e,t,i){var r;return"Week"===(r=this.parent.timelineModule.isSingleTier?"None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier:this.parent.timelineModule.bottomTier)||"Month"===r||"Year"===r?e:"Day"===r||0===this.parent.workingTimeRanges[0].from&&86400===this.parent.workingTimeRanges[0].to?this.getRangeWithWeek(e,t,i):this.getRangeWithDay(e,t,i)},a.prototype.getRangeWithDay=function(e,t,i){for(var r=[],a=0;a<e.length;a++)r.push.apply(r,this.splitRangeForDayMode(e[parseInt(a.toString(),10)],t,i));return r},a.prototype.splitRangeForDayMode=function(t,i,r){var a=i||"from",n=r||"to",s=new Date(t[a]),o=new Date(t[n]),l=[],d={};if(s.getTime()<o.getTime())do{for(var h=new Date(s.getTime()),p=new Date(s.getTime()),u=0,c=this.parent.dataOperation.getSecondsInDecimal(s),g=-1,f=0;f<this.parent.workingTimeRanges.length;f++){var m=this.parent.workingTimeRanges[f];if(c>=m.from&&c<=m.to){g=f;break}}-1!==g&&(u=Math.round(this.parent.workingTimeRanges[g].to-c),p.setSeconds(p.getSeconds()+u));var y="task";p.getTime()<o.getTime()?(d={},t.task&&(d[y]=(0,e.extend)([],t.task)),d[a]=h,d[n]=p,d.isSplit=!0,l.push(d)):(d={},t.task&&(d[y]=(0,e.extend)([],t.task)),d[a]=h,d[n]=o,d.isSplit=!0,l.push(d)),s=this.checkStartDate(p)}while(s.getTime()<o.getTime());else l.push(t);return l},a.prototype.getRangeWithWeek=function(e,t,i){for(var r=[],a=0;a<e.length;a++)r.push.apply(r,this.splitRangeForWeekMode(e[a],t,i));return r},a.prototype.splitRangeForWeekMode=function(t,i,r){var a=i||"from",n=r||"to",s=new Date(t[a]),o=new Date(t[a]),l=new Date(t[n]),d=!1,h=[],p={};if(o.setDate(o.getDate()+1),o.getTime()<l.getTime()){do{if(this.parent.dataOperation.isOnHolidayOrWeekEnd(o,null)){var u=new Date(o.getTime());u.setDate(o.getDate()-1);var c=void 0;c=this.parent.weekWorkingTime.length>0?this.parent.getEndTime(u):this.parent.defaultEndTime,this.setTime(c,u),(p={})[a]=s,p.isSplit=!0,p[n]=new Date(u),t.task&&(p.task=(0,e.extend)([],t.task,!0));var g=!this.parent.dataOperation.isOnHolidayOrWeekEnd(s,null),f=!this.parent.dataOperation.isOnHolidayOrWeekEnd(u,null),m=s.getTime()!==u.getTime();g&&f&&m&&h.push(p),u.setDate(u.getDate()+1),s=this.checkStartDate(u),o=new Date(s.getTime()),d=!0}else o.setDate(o.getDate()+1)}while(o.getTime()<l.getTime());d?s.getTime()!==l.getTime()&&(p={},t.task&&(p.task=(0,e.extend)([],t.task,!0)),p[a]=s,p[n]=l,p.isSplit=!0,h.push(p)):h.push(t)}else h.push(t);return h},a.prototype.updateGanttData=function(){for(var e=this.parent.flatData,t=e.length,i=0;i<t;i++){var r=e[i];this.updateTaskLeftWidth(r)}},a.prototype.updateTaskLeftWidth=function(e){var t=e.ganttProperties;(!e.hasChildRecords||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&this.updateWidthLeft(e),this.parent.setRecordValue("baselineLeft",this.calculateBaselineLeft(t),t,!0),this.parent.setRecordValue("baselineWidth",this.calculateBaselineWidth(t),t,!0);var i,r=[];e.parentItem&&(r=(i=this.parent.getParentTask(e.parentItem)).childRecords),i&&r.indexOf(e)===r.length-1&&!e.hasChildRecords&&this.parent.enableValidation?((!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&"ResourceView"!==this.parent.viewType||this.updateParentItems(i),(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&this.updateWidthLeft(i)):i&&!this.parent.enableValidation&&this.updateWidthLeft(i)},a.prototype.reUpdateGanttDataPosition=function(){for(var e,t=(e=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.flatData).length,i=0;i<t;i++){var r=e[i],a=r.ganttProperties;this.updateWidthLeft(r),"Auto"!==this.parent.taskMode&&r.hasChildRecords&&this.updateAutoWidthLeft(r),this.parent.setRecordValue("baselineLeft",this.calculateBaselineLeft(a),a,!0),this.parent.setRecordValue("baselineWidth",this.calculateBaselineWidth(a),a,!0),this.parent.dataOperation.updateTaskData(r)}},a.prototype.updateWidthLeft=function(t){var i=t.ganttProperties,r=0;if(!(0,e.isNullOrUndefined)(i.segments)&&i.segments.length>0){for(var a=i.segments,n=0;n<a.length;n++){var s=a[n];if(0===n&&!(0,e.isNullOrUndefined)(i.startDate)&&!(0,e.isNullOrUndefined)(s.startDate)&&!(0,e.isNullOrUndefined)(s.startDate.getTime())&&s.startDate.getTime()!==i.startDate.getTime()){s.startDate=i.startDate;var o=this.parent.dataOperation.getEndDate(s.startDate,s.duration,i.durationUnit,i,!1);s.endDate=this.parent.dataOperation.checkEndDate(o,i,!1),this.parent.chartRowsModule.incrementSegments(a,0,t)}if(s.width=this.getSplitTaskWidth(s.startDate,s.duration,t),r+=s.width,s.showProgress=!1,s.progressWidth=-1,0!==n){var l=new Date(i.startDate.getTime());s.left=this.getSplitTaskLeft(s.startDate,l)}}var d=this.parent.dataOperation.getProgressWidth(r,i.progress),h=!0;for(n=0;n<a.length;n++)h&&(d<=a[n].width?(a[n].progressWidth=d,a[n].showProgress=!0,h=!1):(a[n].progressWidth=a[n].width,d-=a[n].progressWidth));this.parent.setRecordValue("segments",i.segments,i,!0),this.parent.dataOperation.updateMappingData(t,"segments")}this.parent.setRecordValue("width",this.parent.dataOperation.calculateWidth(t),i,!0),this.parent.setRecordValue("left",this.parent.dataOperation.calculateLeft(i),i,!0),!(0,e.isNullOrUndefined)(i.segments)&&i.segments.length>0?this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(r,i.progress),i,!0):this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(i.isAutoSchedule||!t.hasChildRecords?i.width:i.autoWidth,i.progress),i,!0)},a.prototype.updateAutoWidthLeft=function(e){var t=e.ganttProperties;this.parent.setRecordValue("autoWidth",this.calculateWidth(e,!0),t,!0),this.parent.setRecordValue("autoLeft",this.calculateLeft(t,!0),t,!0),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(t.isAutoSchedule||!e.hasChildRecords?t.width:t.autoWidth,t.progress),t,!0)},a.prototype.getParentProgress=function(t){var i,r=0,a={};switch(i=this.parent.weekWorkingTime.length>0?this.parent.getSecondsPerDay(t.ganttProperties.startDate?t.ganttProperties.startDate:t.ganttProperties.endDate):this.parent.secondsPerDay,t.ganttProperties.durationUnit){case"hour":r=t.ganttProperties.duration/(i/3600);break;case"minute":r=t.ganttProperties.duration/(i/60);break;default:r=t.ganttProperties.duration}return t.hasChildRecords?((0,e.setValue)("totalProgress",t.ganttProperties.totalProgress,a),(0,e.setValue)("totalDuration",t.ganttProperties.totalDuration?t.ganttProperties.totalDuration:0,a)):((0,e.setValue)("totalProgress",t.ganttProperties.progress*r,a),(0,e.setValue)("totalDuration",r,a)),a},a.prototype.resetDependency=function(t){var i=this.parent.taskFields.dependency;if(!(0,e.isNullOrUndefined)(i)){var r=t.ganttProperties;this.parent.setRecordValue("predecessor",[],r,!0),this.parent.setRecordValue("predecessorsName",null,r,!0),this.parent.setRecordValue("taskData."+i,null,t),this.parent.setRecordValue(i,null,t)}},a.prototype.isUnscheduledTask=function(t,i){for(var r=0,a=null,n=0,s=["startDate","endDate","duration"];n<s.length;n++){var o=s[n];t[o]&&(r++,a=o)}return 1===r||0===r&&!(0,e.isNullOrUndefined)(i)&&i.hasChildRecords?[!0,a]:[!1,null]},a.prototype.updateParentItems=function(t,i){var r=this,a=i?t:this.parent.getParentTask(t);a=a||t;var s=!1,o=(0,e.isNullOrUndefined)(a)?null:a.ganttProperties,l=this.isUnscheduledTask(o,a),d=l[0];l[1];if(this.parent.autoCalculateDateScheduling&&(!this.parent.isLoad||this.parent.treeGrid.loadChildOnDemand||!this.parent.taskFields.hasChildMapping)||"ResourceView"===this.parent.viewType){if(a&&a.childRecords&&a.childRecords.length>0){var h=o.isAutoSchedule?o.startDate:o.autoStartDate,p=o.isAutoSchedule?o.endDate:o.autoEndDate,u=a.childRecords,c=u.length,g=0,f={},m=null,y=null,D=0,v=0,k=0,w=void 0,b=void 0,T=0,P=0;u.some((function(e){var t=r.isUnscheduledTask(e.ganttProperties),i=t[0],a=t[1];return i&&"duration"===a?++P:i||++T,T>0&&P>0})),b=T>0&&P>0||b;for(var S=function(t){if(w=!C.parent.loadChildOnDemand&&C.parent.taskFields.hasChildMapping?C.parent.currentViewData.filter((function(e){return e.ganttProperties.taskId===u[t][r.parent.taskFields.id]}))[0]:u[t],C.parent.isOnDelete&&w.isDelete)return 1===c&&"ProjectView"===C.parent.viewType&&(s=!0),"continue";var i=C.isUnscheduledTask(w.ganttProperties),l=i[0],h=i[1],p=l&&"startDate"!==h&&"endDate"!==h&&!d?o.startDate:C.getValidStartDate(w.ganttProperties);!a.hasChildRecords||o.isAutoSchedule||(0,e.isNullOrUndefined)(w.ganttProperties.autoStartDate)||(p=w.ganttProperties.autoStartDate);var T=l&&"startDate"!==h&&"endDate"!==h&&!d?o.endDate:C.getValidEndDate(w.ganttProperties);!a.hasChildRecords||o.isAutoSchedule||(0,e.isNullOrUndefined)(w.ganttProperties.autoEndDate)||(T=w.ganttProperties.autoEndDate),(0,e.isNullOrUndefined)(m)&&(b&&!l||(0,e.isNullOrUndefined)(b))&&(m=C.getDateFromFormat(p)),(0,e.isNullOrUndefined)(y)&&(b&&!l||(0,e.isNullOrUndefined)(b))&&(y=C.getDateFromFormat(T)),!(0,e.isNullOrUndefined)(T)&&y&&1===C.compareDates(T,y)&&(y=C.getDateFromFormat(T)),!(0,e.isNullOrUndefined)(p)&&m&&-1===C.compareDates(p,m)&&(m=C.getDateFromFormat(p)),!(w.ganttProperties.isMilestone||!n(w.ganttProperties))?(f=C.getParentProgress(w),v+=(0,e.getValue)("totalProgress",f),w[C.parent.taskFields.duration]<1?(g+=(0,e.getValue)("totalDuration",f),g=Number(g.toFixed(4))):g+=(0,e.getValue)("totalDuration",f)):D++;var P=w.ganttProperties.work;if("string"==typeof P){var S=parseFloat(P);isNaN(S)||(k+=S)}else"number"==typeof P&&(k+=P)},C=this,R=0;R<c;R++)S(R);if(!s){var M=void 0,x=(M=this.parent.isOnDelete&&w.isDelete?c-D-1:c-D)>0&&g>0?Number((v/g).toFixed(2)):0,O=a.ganttProperties,I=!(0!==M||!m||!y||m.getTime()!==y.getTime());0!==this.compareDates(h,m)&&(this.parent.setRecordValue(o.isAutoSchedule?"startDate":"autoStartDate",m,a.ganttProperties,!0),((0,e.isNullOrUndefined)(o.autoDuration)?0===o.duration:0===o.autoDuration)&&a.isManual&&I&&a.hasChildRecords&&a.ganttProperties.isAutoSchedule&&"TaskbarEditing"!==this.parent.editModule.taskbarEditModule.taskbarEditedArgs.action&&this.parent.setRecordValue("startDate",m,a.ganttProperties,!0)),0!==this.compareDates(p,y)&&(this.parent.setRecordValue(o.isAutoSchedule?"endDate":"autoEndDate",y,a.ganttProperties,!0),((0,e.isNullOrUndefined)(o.autoDuration)?0===o.duration:0===o.autoDuration)&&a.isManual&&I&&a.hasChildRecords&&a.ganttProperties.isAutoSchedule&&"TaskbarEditing"!==this.parent.editModule.taskbarEditModule.taskbarEditedArgs.action&&this.parent.setRecordValue("endDate",y,a.ganttProperties,!0)),this.parent.setRecordValue("isMilestone",I,O,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||(this.updateMappingData(a,"milestone"),this.parent.setRecordValue(this.parent.taskFields.milestone,I,a,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.milestone,I,a,!0)),O.isAutoSchedule&&this.calculateDuration(a),this.updateWorkWithDuration(a);var E=O.work;E=this.parent.isOnEdit?E:E+k,this.parent.setRecordValue("work",E,O,!0),this.parent.setRecordValue("taskType","FixedDuration",O,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.type)||this.updateMappingData(a,"type"),this.parent.setRecordValue("progress",Math.floor(x),O,!0),this.parent.setRecordValue("totalProgress",v,O,!0),this.parent.setRecordValue("totalDuration",g,O,!0),this.parent.setRecordValue("autoDuration",O.duration,O,!0),O.isAutoSchedule||(this.parent.setRecordValue("autoDuration",this.calculateAutoDuration(O),O,!0),this.updateAutoWidthLeft(a)),this.parent.allowParentDependency||this.resetDependency(a),this.updateWidthLeft(a),this.updateTaskData(a)}}}else this.parent.setRecordValue("endDate",a.taskData[this.parent.taskFields.endDate],a.ganttProperties,!0);s&&1===a.childRecords.length&&0===a.ganttProperties.duration&&(this.parent.setRecordValue("isMilestone",!0,a.ganttProperties,!0),this.updateWidthLeft(a),this.updateTaskData(a));var F=(0,e.isNullOrUndefined)(a)?null:this.parent.getParentTask(a.parentItem);F&&((!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&"ResourceView"!==this.parent.viewType||this.updateParentItems(F)),s=!1},a}(w),P="e-gantt",S="e-chart-root-container",C="e-chart-rows-container",R="e-device",M="e-grid",x="e-timeline-header-container",O="e-timeline-header-table-container",I="e-timeline-header-table-body",E="e-timeline-single-header-outer-div",F="e-left-label-container",U="e-left-label-inner-div",N="e-right-label-container",L="e-right-label-inner-div",V="e-taskbar-main-container",B="e-task-label",A="e-gantt-child-taskbar-inner-div",W="e-gantt-child-progressbar-inner-div",H="e-gantt-child-critical-taskbar-inner-div",j="e-gantt-child-critical-progressbar-inner-div",G="e-critical-milestone",z="e-baseline-bar",q="e-baseline-gantt-milestone-container",_="e-chart-row-cell",Z="e-chart-row",X="e-taskbar-left-resizer",Y="e-taskbar-right-resizer",Q="e-child-progress-resizer",K="e-progressbar-handler",J="e-progressbar-handler-element",$="e-progressbar-handler-after",ee="e-icon",te="e-gantt-milestone",ie="e-gantt-child-taskbar",re="e-gantt-child-progressbar",ae="e-manualparent-main-container",ne="e-gantt-manualparenttaskbar",se="e-gantt-manualparent-milestone",oe="e-gantt-child-manualtaskbar",le="e-gantt-manualparenttaskbar-right",de="e-gantt-parent-taskbar",he="e-gantt-parent-progressbar",pe="e-gantt-unscheduled-task",ue="e-left-resize-gripper",ce="e-right-resize-gripper",ge="e-progress-resize-gripper",fe="e-label",me="e-span",ye="e-gantt-unscheduled-taskbar-left",De="e-gantt-unscheduled-taskbar-right",ve="e-connector-line-container",ke="e-connector-line",we="e-critical-line",be="e-critical-line-arrow",Te="e-connector-line-arrow",Pe="e-connector-line-z-index",Se="e-connectorpoint-left",Ce="e-connectorpoint-right",Re="e-connectorpoint-left-hover",Me="e-connectorpoint-right-hover",xe="e-right-connectorpoint-outer-div",Oe="e-connectorpoint-allow-block",Ie="e-gantt-tooltip",Ee=".e-content",Fe=".e-gridform",Ue="e-edit",Ne="e-active-parent-task",Le="e-active-child-task",Ve="e-active-connected-task",Be="e-predecessor-touch-mode",Ae="e-rangecontainer",We="e-rg-rangdiv",He=function(){function t(e){this.previousCount=-1,this.isSetScrollLeft=!1,this.previousScroll={top:0,left:0},this.parent=e,this.element=this.parent.ganttChartModule.scrollElement,this.addEventListeners()}return t.prototype.addEventListeners=function(){this.parent.on("grid-scroll",this.gridScrollHandler,this),e.EventHandler.add(this.element,"scroll",this.onScroll,this),this.parent.treeGrid.grid.on("showGanttShimmer",this.updateShimmer,this),this.parent.treeGrid.grid.on("removeGanttShimmer",this.removeShimmer,this),this.parent.treeGrid.grid.on("virtualTransform",this.transformChange,this)},t.prototype.removeEventListeners=function(){e.EventHandler.remove(this.element,"scroll",this.onScroll),this.parent.off("grid-scroll",this.gridScrollHandler),this.parent.treeGrid.grid.off("showGanttShimmer",this.updateShimmer),this.parent.treeGrid.grid.off("removeGanttShimmer",this.removeShimmer),this.parent.treeGrid.grid.off("virtualTransform",this.transformChange)},t.prototype.gridScrollHandler=function(t){this.element.scrollTop=(0,e.getValue)("top",t),this.isFromTreeGrid=!0},t.prototype.updateContent=function(){var e=this.parent.element,t=Math.round(this.element.scrollLeft/e.offsetWidth);(this.previousCount!==t||this.parent.timelineModule.performedTimeSpanAction)&&(this.deleteTableElements(),this.parent.timelineModule.createTimelineSeries(),"Vertical"!==this.parent.gridLines&&"Both"!==this.parent.gridLines||this.parent.renderChartVerticalLines(),this.parent.dayMarkersModule&&this.parent.dayMarkersModule.eventMarkerRender.renderEventMarkers(),this.parent.timelineModule.performedTimeSpanAction=!1,this.parent.dayMarkersModule&&(this.parent.dayMarkersModule.nonworkingDayRender.renderWeekends(),this.parent.dayMarkersModule.nonworkingDayRender.renderHolidays()),this.updateChartElementStyles(),this.previousCount=t,this.isSetScrollLeft&&(this.parent.ganttChartModule.chartTimelineContainer.scrollLeft=this.element.scrollLeft))},t.prototype.getTimelineLeft=function(){var e,t=this.parent.element,i=this.parent.timelineModule.wholeTimelineWidth>3*t.offsetWidth?this.parent.timelineModule.wholeTimelineWidth-3*t.offsetWidth:0;if(this.element.scrollLeft===(this.parent.enableRtl?-i:i))e=this.element.scrollLeft;else{var r=this.parent.enableRtl?-this.element.scrollLeft:this.element.scrollLeft;e=r>t.offsetWidth?r-t.offsetWidth:0}return e>=i&&(e=i),e<=t.offsetWidth&&this.isBackwardScrolled&&(e=0),(this.parent.timelineModule.isZoomToFit||this.parent.timelineModule.isZooming)&&(e=0),e},t.prototype.deleteTableElements=function(){var e=this.parent.element.getElementsByClassName("e-timeline-header-table-container");do{e[0].remove()}while(e.length>0);this.parent.element.querySelector("#ganttContainerline-container")&&(this.parent.element.querySelector("#ganttContainerline-container").innerHTML=""),this.parent.element.querySelector(".e-nonworking-day-container")&&(this.parent.element.querySelector(".e-nonworking-day-container").outerHTML=null)},t.prototype.updateChartElementStyles=function(){var e=this.getTimelineLeft();if(this.parent.enableTimelineVirtualization){var t=this.parent.connectorLineModule.dependencyViewContainer,i=this.parent.chartRowsModule.taskTable;this.parent.enableRtl?(t.style.left=e+"px",i.style.right=-e+"px"):(t.style.left=-e+"px",i.style.left=-e+"px"),i.style.width=this.parent.timelineModule.wholeTimelineWidth+"px"}},t.prototype.updateTopPosition=function(){var t,i=this.parent.treeGrid.element.querySelector(".e-content").scrollTop;this.parent.virtualScrollModule&&this.parent.enableVirtualization?t=i-this.parent.virtualScrollModule.getTopPosition():t=i;if(!(0,e.isNullOrUndefined)(this.parent.dayMarkersModule)){var r=(0,e.getValue)("nonworkingDayRender.holidayContainer",this.parent.dayMarkersModule),a=(0,e.getValue)("nonworkingDayRender.weekendContainer",this.parent.dayMarkersModule),n=(0,e.getValue)("eventMarkerRender.eventMarkersContainer",this.parent.dayMarkersModule);r&&(r.style.top=(0,e.formatUnit)(t)),a&&(a.style.top=(0,e.formatUnit)(t)),n&&(n.style.top=(0,e.formatUnit)(t))}this.parent.chartVerticalLineContainer&&(this.parent.chartVerticalLineContainer.style.top=(0,e.formatUnit)(t))},t.prototype.removeShimmer=function(){var e=this.parent;setTimeout((function(){if(e.hideMaskRow(),!e.allowTaskbarOverlap&&e.showOverAllocation){for(var t=0;t<e.currentViewData.length;t++){var i=e.chartRowsModule.ganttChartTableBody.childNodes[t];"none"!==i.style.display&&e.currentViewData[t].hasChildRecords&&!e.currentViewData[t].expanded&&(e.ganttChartModule.isExpandAll||e.ganttChartModule.isCollapseAll?e.treeGrid.getRowByIndex(t).style.height=i.style.height:e.treeGrid.getRows()[t].style.height=i.style.height)}e.contentHeight=e.enableRtl?e.element.getElementsByClassName("e-content")[2].children[0].offsetHeight:e.element.getElementsByClassName("e-content")[0].children[0].offsetHeight,e.element.getElementsByClassName("e-chart-rows-container")[0].style.height=e.contentHeight+"px"}}),0)},t.prototype.transformChange=function(){this.parent.ganttChartModule.virtualRender.adjustTable(),this.parent.ganttChartModule.scrollObject.updateTopPosition()},t.prototype.updateShimmer=function(){var e=this.parent;setTimeout((function(){e.showMaskRow()}),0)},t.prototype.updateSpinner=function(){var e=this.parent;this.parent.showSpinner(),window.clearTimeout(this.isScrolling),this.isScrolling=setTimeout((function(){e.hideSpinner()}),200)},t.prototype.onScroll=function(){var t=this,i={};this.element.scrollTop!==this.previousScroll.top&&(this.isFromTreeGrid?this.isFromTreeGrid=!1:this.parent.notify("chartScroll",{top:this.element.scrollTop}),i.previousScrollTop=this.previousScroll.top,this.previousScroll.top=this.element.scrollTop,i.scrollTop=this.element.scrollTop,i.scrollDirection="Vertical",i.action="VerticalScroll",this.updateTopPosition()),this.element.scrollLeft!==this.previousScroll.left&&(this.isBackwardScrolled=this.element.scrollLeft<this.previousScroll.left&&!this.parent.enableRtl,this.parent.ganttChartModule.chartTimelineContainer.scrollLeft=this.element.scrollLeft,i.previousScrollLeft=this.previousScroll.left,this.previousScroll.left=this.element.scrollLeft,i.scrollLeft=this.element.scrollLeft,i.scrollDirection="Horizontal",i.action="HorizontalScroll",this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?(this.isSetScrollLeft=!0,this.parent.timelineModule.totalTimelineWidth>3*this.parent.element.offsetWidth&&this.updateContent(),this.parent.ganttChartModule.updateWidthAndHeight(),this.parent.element.getElementsByClassName("e-weekend-container")[0]&&(this.parent.element.getElementsByClassName("e-weekend-container")[0].style.height="100%"),this.parent.element.getElementsByClassName("e-holiday-container")[0]&&(this.parent.element.getElementsByClassName("e-holiday-container")[0].style.height="100%")):this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth<3*this.parent.element.offsetWidth&&this.parent.connectorLineModule.svgObject.setAttribute("width","100%")),this.parent.timelineModule.performedTimeSpanAction=!1,(0,e.isNullOrUndefined)(i.scrollDirection)||!0!==this.parent.enableVirtualization&&!0!==this.parent.enableTimelineVirtualization||!this.parent.isToolBarClick&&!(0,e.isNullOrUndefined)(this.parent.isToolBarClick)||(this.parent.isVirtualScroll=!0,(this.parent.showIndicator||(0,e.isNullOrUndefined)(this.parent.showIndicator))&&(!this.parent.enableVirtualMaskRow&&this.parent.enableVirtualization&&"Spinner"===this.parent.loadingIndicator.indicatorType?this.updateSpinner():this.parent.enableTimelineVirtualization&&!this.parent.isRowSelected&&Math.abs(this.element.scrollLeft-i.previousScrollLeft)>1e3&&(this.parent.enableVirtualMaskRow||"Spinner"!==this.parent.loadingIndicator.indicatorType?(this.parent.showMaskRow(),setTimeout((function(){t.removeShimmer()}),0)):this.updateSpinner()),this.parent.isRowSelected=!1)),this.isSetScrollLeft=!1,this.parent.isToolBarClick=!0,i.requestType="scroll",this.parent.trigger("actionComplete",i)},t.prototype.setHeight=function(t){this.element.style.height=(0,e.formatUnit)(t)},t.prototype.setWidth=function(t){this.element.style.width=(0,e.formatUnit)(t)},t.prototype.setScrollTop=function(e){this.element.scrollTop=e,this.parent.treeGrid.element.querySelector(".e-content").scrollTop=e},t.prototype.setScrollLeft=function(e,t){t&&(e=-1===t&&this.parent.enableRtl?-e:e),this.isSetScrollLeft=!0,this.element.scrollLeft=e,this.parent.ganttChartModule.chartTimelineContainer.scrollLeft=this.element.scrollLeft,(!this.parent.enableTimelineVirtualization||!this.parent.enableTimelineVirtualization&&this.parent.timelineModule.totalTimelineWidth>3*this.parent.element.offsetWidth)&&(this.previousScroll.left=this.element.scrollLeft)},t.prototype.destroy=function(){this.removeEventListeners()},t}(),je=function(){function t(e){this.parent=e}return t.prototype.renderWrapper=function(){this.wrapper=(0,e.createElement)("div",{className:"e-virtualtable",styles:"position: absolute; transform: translate(0px, 0px);"}),this.parent.ganttChartModule.scrollElement.appendChild(this.wrapper),this.virtualTrack=(0,e.createElement)("div",{className:"e-virtualtrack",styles:"position: relative; pointer-events: none; width: 100%;"}),this.parent.ganttChartModule.scrollElement.appendChild(this.virtualTrack),this.wrapper.appendChild(this.parent.ganttChartModule.chartBodyContent)},t.prototype.appendChildElements=function(e){this.wrapper.appendChild(e)},t.prototype.adjustTable=function(){var e=this.parent.treeGrid.getContent().querySelector(".e-content").querySelector(".e-virtualtable");if(this.parent.enableTimelineVirtualization){var t=document.getElementsByClassName("e-virtualtable")[1].style.transform,i=this.parent.treeGrid.element.getElementsByClassName("e-virtualtable")[0].style.transform,r=void 0;if(""!==t)r=t.match(/translate.*\((.+)\)/)[1].split(", ")[0];else r=this.parent.ganttChartModule.scrollElement.getElementsByClassName("e-virtualtable")[0].style.transform.match(/translate.*\((.+)\)/)[1].split(", ")[0];var a=i.match(/translate.*\((.+)\)/)[1].split(", ")[1];this.parent.ganttChartModule.virtualRender.wrapper.style.transform="translate("+r+", "+a+")"}else this.parent.ganttChartModule.virtualRender.wrapper.style.transform=e.style.transform},t}(),Ge=function(){function t(t){this.isExpandCollapseFromChart=!1,this.isExpandAll=!1,this.isCollapseAll=!1,this.isGanttElement=!1,this.currentToolbarIndex=-1,this.parent=t,this.chartTimelineContainer=null,this.rangeViewContainer=(0,e.createElement)("div",{className:Ae}),this.rangeViewContainer.setAttribute("role","button"),this.rangeViewContainer.setAttribute("aria-label","RangeContainer"),this.virtualRender=new je(this.parent),this.addEventListener()}return t.prototype.addEventListener=function(){this.parent.on("renderPanels",this.renderChartContainer,this),this.parent.on("recordsUpdated",this.renderChartElements,this),this.parent.on("dataReady",this.renderInitialContents,this),this.parent.on("tree-grid-created",this.renderChartContents,this),this.parent.on("destroy",this.destroy,this)},t.prototype.renderChartContents=function(){this.parent.notify("refreshDayMarkers",{}),this.wireEvents()},t.prototype.renderChartContainer=function(){this.chartElement=(0,e.createElement)("div",{id:this.parent.element.id+"GanttChart",className:"e-gantt-chart"}),this.parent.chartPane.appendChild(this.chartElement),this.renderTimelineContainer(),this.renderBodyContainers()},t.prototype.renderInitialContents=function(){this.parent.timelineModule.createTimelineSeries()},t.prototype.renderOverAllocationContainer=function(){for(var e=0;e<this.parent.flatData.length;e++){var t=this.parent.flatData[e];t.childRecords.length>0&&this.parent.dataOperation.updateOverlappingValues(t)}var i=this.parent.element.querySelector("."+Ae);i&&(i.innerHTML=""),0===this.parent.treeGrid.grid.filterSettings.columns.length&&this.renderRangeContainer(this.parent.currentViewData)},t.prototype.renderChartElements=function(){if(this.parent.isFromOnPropertyChange)this.rangeViewContainer.innerHTML="",this.parent.updateProjectDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate,this.parent.isTimelineRoundOff),this.parent.isFromOnPropertyChange=!1;else{this.parent.chartRowsModule.renderChartRows(),this.parent.predecessorModule&&this.parent.taskFields.dependency&&(this.parent.connectorLineIds=[],this.parent.updatedConnectorLineCollection=[],this.parent.predecessorModule.createConnectorLinesCollection()),this.parent.connectorLineModule.renderConnectorLines(this.parent.updatedConnectorLineCollection);for(var t=0;t<this.parent.chartRowsModule.ganttChartTableBody.children.length;t++)if(this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[4])this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[1].setAttribute("tabindex","-1"),this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[2].setAttribute("tabindex","-1"),this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[4].setAttribute("tabindex","-1");else if("ProjectView"===this.parent.viewType){var i=this.parent.chartRowsModule.ganttChartTableBody.children[parseInt(t.toString(),10)].children[0].children[1].children[1];(0,e.isNullOrUndefined)(i)||this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[1].setAttribute("tabindex","-1")}else this.parent.chartRowsModule.ganttChartTableBody.children[parseInt(t.toString(),10)].children[0].children[1].children[0]&&this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[0].setAttribute("tabindex","-1");var r=this.parent.criticalPathModule;this.parent.enableCriticalPath&&r&&r.criticalPathCollection&&this.parent.criticalPathModule.criticalConnectorLine(r.criticalPathCollection,r.detailPredecessorCollection,this.parent.enableCriticalPath,r.predecessorCollectionTaskIds),this.parent.showOverAllocation&&this.renderOverAllocationContainer()}this.updateWidthAndHeight(),this.parent.isLoad&&this.parent.notify("selectRowByIndex",{}),this.parent.timelineModule.isZoomToFit&&this.parent.timelineModule.processZoomToFit()},t.prototype.renderRangeContainer=function(e){var t,i,r,a=e.length;if(0===this.parent.treeGrid.grid.filterSettings.columns.length)for(t=0;t<a;t++)(r=(i=e[t]).ganttProperties.workTimelineRanges)&&this.renderRange(r,i)},t.prototype.getTopValue=function(e){var t=this.parent.getExpandedRecords(this.parent.currentViewData),i=t.indexOf(e);if(e.parentItem&&-1===i){var r=this.parent.getRecordByID(e.parentItem.taskId);i=t.indexOf(r)}return e.expanded?(i+1)*this.parent.rowHeight:i*this.parent.rowHeight},t.prototype.getRangeHeight=function(e){return!e.expanded&&e.hasChildRecords?this.parent.rowHeight-Math.floor(this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight):e.childRecords.length*this.parent.rowHeight-Math.floor(this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight)},t.prototype.renderRange=function(t,i){var r=0,a=this.parent.currentViewData.indexOf(i);r=!this.parent.allowTaskbarOverlap&&this.parent.enableMultiTaskbar?i.expanded?this.parent.getRowByIndex(a).offsetTop+this.parent.rowHeight:this.parent.getRowByIndex(a).offsetTop:this.getTopValue(i);var n=this.rangeViewContainer.querySelector(".rangeContainer"+i.ganttProperties.rowUniqueID);n&&n.remove();var s=(0,e.createElement)("div",{className:"rangeContainer"+i.ganttProperties.rowUniqueID,styles:"top:"+r+"px; position: absolute;"});if((0!==i.level||i.expanded||!(0,e.isNullOrUndefined)(i.parentItem)||this.parent.enableMultiTaskbar)&&(!(i.level>0&&i.expanded)||this.parent.getRecordByID(i.parentItem.taskId).expanded)){for(var o=0;o<t.length;o++){var l=void 0,d=this.parent.chartRowsModule.ganttChartTableBody.childNodes;l=this.parent.allowTaskbarOverlap||i.expanded||!this.parent.enableMultiTaskbar||this.isCollapseAll?this.getRangeHeight(i):parseInt(d[a].style.height,10)-(this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight);var h=(0,e.createElement)("div",{className:We+" e-leftarc",styles:(this.parent.enableRtl?"right:":"left:")+(this.parent.enableRtl?t[o].left+t[o].width-5:t[o].left)+"px;\n                top: "+Math.floor((this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight)/2)+"px;\n                height: "+(l+1)+"px; border-right: 0px;\n                z-index: "+("ProjectView"===this.parent.viewType?i.childRecords.length>1?i.childRecords.length+1:i.childRecords.length:6)}),p=(0,e.createElement)("div",{className:We+" e-rightarc",styles:(this.parent.enableRtl?"right:":"left:")+(this.parent.enableRtl?t[o].left:t[o].left+t[o].width-5)+"px;\n                top: "+Math.floor((this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight)/2)+"px; height: "+(l+1)+"px;\n                border-left: 0px;\n                z-index: "+("ProjectView"===this.parent.viewType?i.childRecords.length>1?i.childRecords.length+1:i.childRecords.length:6)});s.appendChild(h),s.appendChild(p),this.rangeViewContainer.appendChild(s)}this.parent.ganttChartModule.chartBodyContent.appendChild(this.rangeViewContainer)}},t.prototype.renderTimelineContainer=function(){this.chartTimelineContainer=(0,e.createElement)("div",{className:x}),this.parent.enableRtl&&(this.chartTimelineContainer.style.borderLeftWidth="1px",this.chartTimelineContainer.style.borderRightWidth="0px"),this.chartTimelineContainer.setAttribute("role","presentation"),this.chartElement.appendChild(this.chartTimelineContainer)},t.prototype.renderBodyContainers=function(){this.chartBodyContainer=(0,e.createElement)("div",{className:S}),this.chartElement.appendChild(this.chartBodyContainer),this.scrollElement=(0,e.createElement)("div",{className:"e-chart-scroll-container e-content",styles:"position:relative;"}),this.chartBodyContainer.appendChild(this.scrollElement),this.chartBodyContent=(0,e.createElement)("div",{className:C,styles:"position:relative; overflow:hidden "}),this.parent.virtualScrollModule&&this.parent.enableVirtualization||this.parent.enableTimelineVirtualization?this.parent.ganttChartModule.virtualRender.renderWrapper():this.scrollElement.appendChild(this.chartBodyContent),this.scrollObject=new He(this.parent);var t=0;(0,e.isNullOrUndefined)(this.parent.toolbarModule)||(0,e.isNullOrUndefined)(this.parent.toolbarModule.element)||(t=this.parent.toolbarModule.element.offsetHeight),this.scrollObject.setHeight(this.parent.ganttHeight-this.chartTimelineContainer.offsetHeight-t)},t.prototype.updateWidthAndHeight=function(){var t=0===this.parent.contentHeight?this.parent.flatData.length>1?36:0:this.parent.contentHeight,i=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0];if(t>=i.offsetHeight||"auto"===this.parent.height||i.offsetHeight-t<36)this.chartBodyContent.style.height=(0,e.formatUnit)(t);else{var r=this.parent.element.getElementsByClassName("e-chart-rows-container")[0].offsetHeight;i.offsetHeight>=r?this.chartBodyContent.style.height=i.offsetHeight-17+"px":this.chartBodyContent.style.height=i.offsetHeight+"px"}this.chartBodyContent.style.width=this.parent.enableTimelineVirtualization&&this.parent.timelineModule.totalTimelineWidth>3*this.parent.element.offsetWidth?(0,e.formatUnit)(3*this.parent.element.offsetWidth):(0,e.formatUnit)(this.parent.timelineModule.totalTimelineWidth),this.setVirtualHeight(),this.parent.notify("updateHeight",{}),this.parent.updateGridLineContainerHeight(),this.updateLastRowBottomWidth()},t.prototype.setVirtualHeight=function(){if(this.parent.virtualScrollModule&&this.parent.enableVirtualization){(0,e.getValue)("virtualTrack",this.parent.ganttChartModule.virtualRender).style.height=this.parent.treeGrid.element.getElementsByClassName("e-virtualtrack")[0].style.height;var t=(0,e.getValue)("wrapper",this.parent.ganttChartModule.virtualRender),i=this.parent.treeGrid.element.getElementsByClassName("e-virtualtable")[0].style.transform,r=document.getElementsByClassName("e-virtualtable")[1].style.transform;if(this.parent.enableTimelineVirtualization){var a=void 0;if(""!==r)a=r.match(/translate.*\((.+)\)/)[1].split(", ")[0];else a=this.parent.ganttChartModule.scrollElement.getElementsByClassName("e-virtualtable")[0].style.transform.match(/translate.*\((.+)\)/)[1].split(", ")[0];var n=i.match(/translate.*\((.+)\)/)[1].split(", ")[1];t.style.transform="translate("+a+", "+n+")"}else t.style.transform=i}},t.prototype.updateLastRowBottomWidth=function(){if(this.parent.currentViewData.length>0&&"auto"!==this.parent.height){var t=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.currentViewData:this.parent.getExpandedRecords(this.parent.currentViewData),i=t[t.length-1],r=this.parent.currentViewData.indexOf(i),a=this.parent.getRowByIndex(r),n=this.parent.chartRowsModule.ganttChartTableBody;if(n.querySelectorAll(".e-chart-row-cell.e-chart-row-border.e-lastrow")&&(0,e.removeClass)(n.querySelectorAll(".e-chart-row-cell.e-chart-row-border.e-lastrow"),"e-lastrow"),this.chartBodyContent.clientHeight<this.chartBodyContainer.clientHeight&&a){(0,e.addClass)(a.querySelectorAll("td"),"e-lastrow");var s=0===this.parent.contentHeight?this.parent.flatData.length>1?36:0:this.parent.contentHeight,o=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0];if(s>=o.offsetHeight||o.offsetHeight-s<36)this.chartBodyContent.style.height=(0,e.formatUnit)(s);else{var l=this.parent.element.getElementsByClassName("e-chart-rows-container")[0].offsetHeight;o.offsetHeight>=l?this.chartBodyContent.style.height=o.offsetHeight-17+"px":this.chartBodyContent.style.height=o.offsetHeight+"px"}}}},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("renderPanels",this.renderChartContainer),this.parent.off("recordsUpdated",this.renderChartElements),this.parent.off("dataReady",this.renderInitialContents),this.parent.off("tree-grid-created",this.renderChartContents),this.parent.off("destroy",this.destroy))},t.prototype.ganttChartMouseDown=function(t){var i=!1;if(this.parent.allowTaskbarDragAndDrop&&this.parent.editModule&&this.parent.editSettings.allowTaskbarEditing){var r=this.parent.editModule.taskbarEditModule.getTaskBarAction(t);if("ChildDrag"===r||"ParentDrag"===r||"MilestoneDrag"===r||"ManualParentDrag"===r){var a={cancel:i,data:this.getRecordByTaskBar(t.target),target:t.target,chartRow:(0,e.closest)(t.target,"tr")};this.parent.trigger("rowDragStartHelper",a),i=a.cancel}}if(!i){3!==t.which&&this.parent.editSettings.allowTaskbarEditing&&(this.parent.notify("chartMouseDown",t),this.parent.element.tabIndex=0);var n=!1;this.parent.editSettings.allowTaskbarEditing&&(this.parent.element.querySelector(".e-left-resize-gripper")||this.parent.element.querySelector(".e-left-connectorpoint-outer-div"))&&(n=!0),n&&2!==t.button||this.parent.editSettings.allowEditing&&this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length>0&&this.parent.treeGrid.endEdit()}},t.prototype.ganttChartMouseClick=function(e){this.parent.autoFocusTasks&&this.scrollToTarget(e),this.parent.notify("chartMouseClick",e)},t.prototype.ganttChartMouseUp=function(t){if("touchend"===t.type){var i=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-taskbar-resize-div");(0,e.isNullOrUndefined)(i)||i.remove();var r=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-clone-taskbar")||this.parent.chartPane.querySelector(".e-clone-taskbar");if(!(0,e.isNullOrUndefined)(r))r.parentElement.parentElement.remove();var a=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-gantt-false-line");(0,e.isNullOrUndefined)(a)||this.parent.editModule.taskbarEditModule.removeFalseLine(!0)}if(this.parent.editSettings.allowTaskbarEditing&&this.parent.notify("chartMouseUp",t),!this.parent.editSettings.allowEditing){var n=!1;if(this.parent.editSettings.allowTaskbarEditing&&(0,e.getValue)("editModule.taskbarEditModule.isMouseDragged",this.parent)&&(0,e.getValue)("editModule.taskbarEditModule.taskBarEditAction",this.parent)&&(n=!0),!n){var s=t.target,o=t.target.classList.contains(V)||(0,e.closest)(t.target,"."+V);(0,e.closest)(s,".e-gantt-parent-taskbar")&&!this.parent.editSettings.allowEditing?this.chartExpandCollapseRequest(t):!o&&this.parent.autoFocusTasks&&this.scrollToTarget(t)}}},t.prototype.scrollToTarget=function(t){var i=(0,e.closest)(t.target,"tr");if(i&&this.parent.element.contains(i)&&(this.parent.element.querySelectorAll(".e-chart-rows-container")[0].contains(t.target)||this.parent.element.querySelectorAll(".e-gridcontent")[0].contains(t.target))&&this.parent.currentViewData.length>0){var r=(0,e.getValue)("rowIndex",(0,e.closest)(t.target,"tr")),a=this.parent.currentViewData[r].ganttProperties.startDate,n=this.parent.currentViewData[r].ganttProperties.left;if(!(0,e.isNullOrUndefined)(a)){var s=this.parent.enableTimelineVirtualization?{}:this.parent.dataOperation.getTaskLeft(a,!1);this.parent.autoFocusTasks&&(this.parent.enableTimelineVirtualization?this.updateScrollLeft(n):this.updateScrollLeft(s))}}},t.prototype.updateScrollLeft=function(e){e=e>0?e:0,e=this.scrollElement.scrollWidth<=e?this.scrollElement.scrollWidth:e,(this.scrollElement.offsetWidth+this.parent.ganttChartModule.scrollElement.scrollLeft<e||this.scrollElement.scrollLeft>e)&&this.scrollObject.setScrollLeft(e-50,this.parent.enableRtl?-1:0)},t.prototype.mouseUp=function(t){(0,e.isNullOrUndefined)(this.parent.editModule)||(0,e.isNullOrUndefined)(this.parent.editModule.taskbarEditModule)||this.parent.editModule.taskbarEditModule.removeFalseLine(!1);var i=this.parent.element.querySelector(".e-taskbar-resize-div");if((0,e.isNullOrUndefined)(i)||i.remove(),this.parent.allowTaskbarDragAndDrop&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&(this.parent.editModule.taskbarEditModule.previousLeftValue=0),this.parent.allowRowDragAndDrop){var r=this.parent.element.querySelector(".e-ganttdrag");r&&r.remove()}this.isGanttElement||this.parent.notify("chartMouseUp",t),this.isGanttElement=!1},t.prototype.documentMouseUp=function(t){if(this.isGanttElement=!0,(t.target.classList.contains("e-treegridexpand")||t.target.classList.contains("e-treegridcollapse"))&&!0===(0,e.getValue)("isEditCollapse",this.parent.treeGrid)&&(0,e.setValue)("isEditCollapse",!1,this.parent.treeGrid),this.parent.allowRowDragAndDrop){var i=this.parent.element.querySelector(".e-ganttdrag");i&&i.remove()}if(!this.parent.isDestroyed&&3!==t.which){var r=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-taskbar-resize-div");(0,e.isNullOrUndefined)(r)||r.remove();var a=this.parent.element.getElementsByClassName("e-clone-taskbar")[0];if(!(0,e.isNullOrUndefined)(a))a.parentElement.parentElement.remove();var n=!1;if(this.parent.editSettings.allowTaskbarEditing&&(0,e.getValue)("editModule.taskbarEditModule.isMouseDragged",this.parent)&&(0,e.getValue)("editModule.taskbarEditModule.taskBarEditAction",this.parent)&&(n=!0),this.parent.notify("chartMouseUp",t),this.parent.showActiveElement&&(this.parent.showIndicator=!0,(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.focusedElement&&!t.target.classList.contains("e-split-bar")&&(this.focusedElement.tabIndex=0===this.focusedElement.tabIndex?-1:this.focusedElement.tabIndex,(0,e.removeClass)([this.focusedElement],"e-active-container"))),!n){var s=t.target,o=t.target.classList.contains(V)||(0,e.closest)(t.target,"."+V);(0,e.closest)(s,".e-gantt-parent-taskbar")&&!this.parent.editSettings.allowEditing?this.chartExpandCollapseRequest(t):!o&&this.parent.autoFocusTasks&&this.scrollToTarget(t)}if(this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.removeFalseLine(!0),!(0,e.isNullOrUndefined)(this.parent.onTaskbarClick)&&!n){s=t.target;var l=(0,e.closest)(s,".e-gantt-parent-taskbar,.e-gantt-child-taskbar,.e-gantt-milestone");l&&this.onTaskbarClick(t,s,l)}}},t.prototype.onTaskbarClick=function(t,i,r){var a=(0,e.closest)(i,"tr"),n=(0,e.getValue)("rowIndex",a),s={data:this.getRecordByTarget(t),taskbarElement:r,rowIndex:n,target:i};this.parent.trigger("onTaskbarClick",s)},t.prototype.ganttChartLeave=function(e){this.parent.editSettings.allowTaskbarEditing&&this.parent.notify("chartMouseLeave",e)},t.prototype.ganttChartMove=function(t){if(this.parent.editSettings.allowTaskbarEditing){if(this.parent.element.getElementsByClassName("e-clone-taskbar").length>0&&!this.parent.enableRtl){if(("touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type?t.changedTouches[0].pageX:t.pageX)<=this.parent.getOffsetRect(this.parent.ganttChartModule.chartElement).left)return}this.parent.notify("chartMouseMove",t),!(0,e.isNullOrUndefined)(this.parent.taskFields.dependency)&&this.parent.connectorLineEditModule&&this.parent.connectorLineEditModule.updateConnectorLineEditElement(t)}},t.prototype.contextClick=function(t){if(this.parent.allowFiltering&&this.parent.filterModule&&this.parent.filterModule.closeFilterOnContextClick(t.srcElement),this.parent.allowTaskbarDragAndDrop){var i=this.parent.chartPane.querySelector(".e-clone-taskbar");if(!(0,e.isNullOrUndefined)(i))i.parentElement.parentElement.remove()}},t.prototype.mouseMoveHandler=function(t){if(!(0,e.isNullOrUndefined)(this.parent.onMouseMove)&&(this.parent.flatData.length||t.target.classList.contains("e-header-cell-label")||t.target.classList.contains("e-headercell"))){var i=t.target,r={originalEvent:t},a=(0,e.closest)(i,".e-chart-row-cell,.e-connector-line-container,.e-event-markers,.e-header-cell-label,.e-rowcell,.e-headercell,.e-indicator-span");if(a){var n,s=void 0,o=(0,e.closest)(i,".e-rowcell,.e-chart-row-cell"),l=(0,e.closest)(i,".e-rowcell,.e-headercell");if(o&&(s=this.parent.ganttChartModule.getRecordByTarget(t),r.data=s),l){var d=(0,e.getValue)("cellIndex",l);r.column=this.parent.treeGrid.columns[d]}if((0,e.closest)(i,".e-indicator-span")){var h=0,p=s.ganttProperties.indicators;if(p.length>1)for(h=0;h<p.length&&p[h].name!==a.innerText.trim();h++);r.indicator=p[h]}if((0,e.closest)(i,".e-connector-line-container"))(n={}).target=a,r.predecessor=this.parent.tooltipModule.getPredecessorTooltipData(n);if((0,e.closest)(i,".e-event-markers"))(n={}).target=a,r.eventMarkers=this.parent.tooltipModule.getMarkerTooltipData(n);i.classList.contains("e-header-cell-label")&&(r.date=new Date(i.dataset.content))}this.parent.trigger("onMouseMove",r)}},t.prototype.doubleClickHandler=function(t){var i=t.target,r=(0,e.closest)(i,"tr"),a=(0,e.getValue)("rowIndex",r),n=this.parent.ganttChartModule.getRecordByTarget(t);this.parent.editSettings.allowEditing&&this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length>0&&this.parent.treeGrid.endEdit(),this.parent.notify("chartDblClick",t);var s={row:r,rowData:n,rowIndex:a,target:i};this.recordDoubleClick(s)},t.prototype.recordDoubleClick=function(e){this.parent.trigger("recordDoubleClick",e)},t.prototype.getRecordByTarget=function(t){var i,r=(0,e.closest)(t.target,"div."+V);if((0,e.isNullOrUndefined)(r)){if(r=(0,e.closest)(t.target,"tr")){var a=(0,e.getValue)("rowIndex",(0,e.closest)(t.target,"tr"));i=this.parent.currentViewData[a]}}else{var n=r.getAttribute("rowUniqueId");i=this.parent.getRecordByID(n)}return i},t.prototype.getChartRows=function(){return null!==document.getElementById(this.parent.element.id+"GanttTaskTableBody")?document.getElementById(this.parent.element.id+"GanttTaskTableBody").querySelectorAll(".e-chart-row"):null},t.prototype.chartExpandCollapseRequest=function(t){if(!this.parent.enableMultiTaskbar){var i=t.target,r=(0,e.closest)(i,".e-gantt-parent-taskbar"),a=this.getRecordByTarget(t),n=(0,e.closest)(i,"tr"),s=(0,e.getValue)("rowIndex",n),o={data:a,gridRow:this.parent.treeGrid.getRows()[s],chartRow:n,cancel:!1};this.isExpandCollapseFromChart=!0,r.classList.contains("e-row-expand")?this.collapseGanttRow(o):r.classList.contains("e-row-collapse")&&this.expandGanttRow(o)}},t.prototype.reRenderConnectorLines=function(){this.parent.connectorLineModule.dependencyViewContainer.innerHTML="",this.parent.connectorLineIds=[],this.parent.updatedConnectorLineCollection=[],this.parent.predecessorModule.createConnectorLinesCollection(),this.parent.connectorLineModule.renderConnectorLines(this.parent.updatedConnectorLineCollection);var e=this.parent.criticalPathModule;this.parent.enableCriticalPath&&e&&e.criticalPathCollection&&e.criticalConnectorLine(e.criticalPathCollection,e.detailPredecessorCollection,!0,e.predecessorCollectionTaskIds)},t.prototype.collapseGanttRow=function(t,i){var r=this;i?this.collapsedGanttRow(t):this.parent.trigger("collapsing",t,(function(t){r.isExpandCollapseFromChart&&!(0,e.getValue)("cancel",t)&&r.collapsedGanttRow(t),r.isExpandCollapseFromChart=!1}))},t.prototype.collapsedGanttRow=function(t){var i=this;if(!((0,e.isNullOrUndefined)(t.gridRow)&&this.parent.enableVirtualization||(0,e.isNullOrUndefined)(t.chartRow))){var r;if(r=!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.currentViewData.filter((function(e){return e.ganttProperties[i.parent.taskFields.id]===t.data[i.parent.taskFields.id]}))[0]:(0,e.getValue)("data",t),this.isExpandCollapseFromChart){this.expandCollapseChartRows("collapse",(0,e.getValue)("chartRow",t),r,null);var a=this.parent.taskFields.id;if(!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping){var n=this.parent.treeGrid.getCurrentViewRecords().filter((function(e){return e[a]===t.data[a]}))[0];this.parent.treeGrid.collapseRow((0,e.getValue)("gridRow",t),n)}else this.parent.treeGrid.collapseRow((0,e.getValue)("gridRow",t),r);this.isExpandCollapseFromChart=!1}else this.expandCollapseChartRows("collapse",(0,e.getValue)("chartRow",t),r,null);"ResourceView"!==this.parent.viewType&&"ProjectView"!==this.parent.viewType||this.renderMultiTaskbar(r),this.parent.enableVirtualization||this.parent.updateContentHeight(),this.updateWidthAndHeight(),this.reRenderConnectorLines(),(0,e.getValue)("chartRow",t).setAttribute("aria-expanded","false")}},t.prototype.expandGanttRow=function(t,i){var r=this;i?this.expandedGanttRow(t):this.parent.trigger("expanding",t,(function(t){r.isExpandCollapseFromChart&&!(0,e.getValue)("cancel",t)&&r.expandedGanttRow(t),r.isExpandCollapseFromChart=!1}))},t.prototype.expandedGanttRow=function(t){var i=this;if(!((0,e.isNullOrUndefined)(t.gridRow)&&this.parent.enableVirtualization||(0,e.isNullOrUndefined)(t.chartRow))){var r;if(r=!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.currentViewData.filter((function(e){return e.ganttProperties.taskId===t.data[i.parent.taskFields.id]}))[0]:(0,e.getValue)("data",t),this.isExpandCollapseFromChart){this.expandCollapseChartRows("expand",(0,e.getValue)("chartRow",t),r,null);var a=this.parent.taskFields.id;if(!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping){var n=this.parent.treeGrid.getCurrentViewRecords().filter((function(e){return e[a]===t.data[a]}))[0];this.parent.treeGrid.expandRow((0,e.getValue)("gridRow",t),n)}else this.parent.treeGrid.expandRow((0,e.getValue)("gridRow",t),r);this.isExpandCollapseFromChart=!1}else this.parent.isExpandCollapseLevelMethod||this.expandCollapseChartRows("expand",(0,e.getValue)("chartRow",t),r,null),this.parent.isExpandCollapseLevelMethod=!1;"ResourceView"!==this.parent.viewType&&"ProjectView"!==this.parent.viewType||this.renderMultiTaskbar(r),this.parent.enableVirtualization||this.parent.updateContentHeight(),this.updateWidthAndHeight(),this.reRenderConnectorLines(),(0,e.getValue)("chartRow",t).setAttribute("aria-expanded","true")}},t.prototype.renderMultiTaskbar=function(e){this.parent.enableMultiTaskbar?this.parent.chartRowsModule.refreshRecords([e],!0):this.parent.showOverAllocation&&this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)},t.prototype.expandCollapseChartRows=function(t,i,r,a){var n;if("expand"===t){n="table-row",a||(r.expanded=!0);for(var s=i.querySelectorAll(".e-row-collapse"),o=0;o<s.length;o++)(0,e.addClass)([s[o]],"e-row-expand"),(0,e.removeClass)([s[o]],"e-row-collapse")}else if("collapse"===t){n="none",a||(r.expanded=!1);for(s=i.querySelectorAll(".e-row-expand"),o=0;o<s.length;o++)(0,e.addClass)([s[o]],"e-row-collapse"),(0,e.removeClass)([s[o]],"e-row-expand")}if(!this.parent.enableVirtualization){for(var l=r.childRecords,d=this.getChartRows(),h=[],p=0;p<d.length;p++)d[p].classList.contains("gridrowtaskId"+r.ganttProperties.rowUniqueID+"level"+(r.level+1))&&h.push(d[p]);for(p=0;p<h.length;p++)h[p].style.display=n,l[p].childRecords&&l[p].childRecords.length&&("collapse"===t||l[p].expanded||this.isExpandAll)&&this.expandCollapseChartRows(t,h[p],l[p],!0)}},t.prototype.expandCollapseAll=function(e){if("expand"===e)this.isExpandAll=!0,this.parent.treeGrid.expandAll();else if(this.isCollapseAll=!0,this.parent.treeGrid.collapseAll(),this.isCollapseAll&&!this.parent.allowTaskbarOverlap){var t=this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2].children[0].offsetHeight:this.parent.element.getElementsByClassName("e-content")[0].children[0].offsetHeight;this.parent.contentHeight=t,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px"}this.isExpandAll=!1,this.isCollapseAll=!1},t.prototype.expandAtLevel=function(e){this.parent.treeGrid.expandAtLevel(e)},t.prototype.collapseAtLevel=function(e){this.parent.enableVirtualization&&(this.parent.isExpandCollapseLevelMethod=!0),this.parent.treeGrid.collapseAtLevel(e)},t.prototype.wireEvents=function(){var t=e.Browser.isPointer,r=e.Browser.touchStartEvent,a=e.Browser.touchEndEvent,n=e.Browser.touchMoveEvent,s=t?"pointerleave":"mouseleave";e.EventHandler.add(this.parent.chartPane,r,this.ganttChartMouseDown,this),e.EventHandler.add(this.parent.chartPane,s,this.ganttChartLeave,this),e.EventHandler.add(this.parent.chartPane,n,this.ganttChartMove,this),this.parent.isAdaptive&&(e.EventHandler.add(this.parent.chartPane,i.click,this.ganttChartMouseClick,this),e.EventHandler.add(this.parent.chartPane,a,this.ganttChartMouseUp,this)),this.parent.isAdaptive||(e.EventHandler.add(this.parent.element,a,this.documentMouseUp,this),e.EventHandler.add(document,a,this.mouseUp,this)),e.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),e.EventHandler.add(document.body,"contextmenu",this.contextClick,this),e.EventHandler.add(document,"mouseup",this.contextClick,this),e.EventHandler.add(this.parent.chartRowsModule.ganttChartTableBody,"dblclick",this.doubleClickHandler,this)},t.prototype.unWireEvents=function(){var t=e.Browser.isPointer,r=e.Browser.touchStartEvent,a=e.Browser.touchEndEvent,n=e.Browser.touchMoveEvent,s=t?"pointerleave":"mouseleave";(0,e.isNullOrUndefined)(this.parent.chartRowsModule.ganttChartTableBody)||e.EventHandler.remove(this.parent.chartRowsModule.ganttChartTableBody,r,this.ganttChartMouseDown),(0,e.isNullOrUndefined)(this.parent.chartPane)||(e.EventHandler.remove(this.parent.chartPane,s,this.ganttChartLeave),e.EventHandler.remove(this.parent.chartPane,n,this.ganttChartMove)),this.parent.isAdaptive&&((0,e.isNullOrUndefined)(this.parent.chartPane)||(e.EventHandler.remove(this.parent.chartPane,i.click,this.ganttChartMouseClick),e.EventHandler.remove(this.parent.chartPane,a,this.ganttChartMouseUp))),this.parent.isAdaptive||((0,e.isNullOrUndefined)(this.parent.element)||e.EventHandler.remove(this.parent.element,a,this.documentMouseUp),(0,e.isNullOrUndefined)(document)||e.EventHandler.remove(document,a,this.mouseUp)),(0,e.isNullOrUndefined)(this.parent.element)||e.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler),(0,e.isNullOrUndefined)(document)||(e.EventHandler.remove(document,"mouseup",this.contextClick),(0,e.isNullOrUndefined)(document.body)||e.EventHandler.remove(document.body,"contextmenu",this.contextClick)),(0,e.isNullOrUndefined)(this.parent.chartRowsModule.ganttChartTableBody)||e.EventHandler.remove(this.parent.chartRowsModule.ganttChartTableBody,"dblclick",this.doubleClickHandler)},t.prototype.getRecordByTaskBar=function(e){return this.parent.enableVirtualization&&this.parent.enableMultiTaskbar?this.parent.flatData[this.getIndexByTaskBar(e)]:this.parent.currentViewData[this.getIndexByTaskBar(e)]},t.prototype.updateElement=function(e,t,i,r,a){if(this.parent.ganttColumns[e.getAttribute("data-colindex")].field===this.parent.taskFields.progress){var n=a.index;do{e=this.getNextElement(e,i,r),t=this.parent.ganttColumns[e.getAttribute("data-colindex")],n=parseInt(e.parentElement.getAttribute("data-rowindex"))}while(!t.allowEditing);this.parent.treeGrid.saveCell(),this.parent.treeGrid.editCell(n,this.parent.ganttColumns[e.getAttribute("data-colindex")].field)}return e},t.prototype.onTabAction=function(t){this.parent.treeGrid.grid.enableHeaderFocus=this.parent.enableHeaderFocus;var i=document.getElementsByClassName("e-toolbar-item"),r=this.parent.editModule&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit;if(this.parent.showActiveElement||r){var a=r?t.target.closest(".e-rowcell"):t.target;this.parent.element.querySelectorAll(".e-focused").length>0&&(a=this.parent.element.querySelectorAll(".e-focused")[0]),a&&!(a.classList.contains("e-toolbar-item")||a.classList.contains("e-input")||a.classList.contains("e-btn"))&&(this.currentToolbarIndex=-1),(a.closest(".e-rowcell")||a.closest(".e-chart-row"))&&this.parent.focusModule.setActiveElement(a),this.focusedRowIndex=a.closest(".e-rowcell")?a.parentElement.rowIndex:a.closest(".e-chart-row")?a.closest(".e-chart-row").rowIndex:-1;var n="tab"===t.action,s=this.getNextElement(a,n,r);if(s&&("noNextRow"===s||s.classList.contains("e-rowdragheader"))&&("noNextRow"===s&&this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length>0&&this.parent.treeGrid.saveCell(),s=null),s&&a.classList.contains("e-headercell")){var o=parseInt(s.getAttribute("data-colindex"),10);if("shiftTab"===t.action){for(;-1!==o&&!this.parent.treeGrid.columns[o].visible;)o-=1;if(-1!==o)o=this.parent.allowRowDragAndDrop?o+1:o,s=document.getElementsByClassName("e-columnheader")[0].childNodes[o];else for(var l=document.getElementsByClassName("e-toolbar-item").length-1;l>0;l--)if(!document.getElementsByClassName("e-toolbar-item")[l].classList.contains("e-hidden")){s=document.getElementsByClassName("e-toolbar-item")[l],this.currentToolbarIndex=l;break}}else{for(;!this.parent.treeGrid.columns[o].visible;)o+=1;o=this.parent.allowRowDragAndDrop?o+1:o,s=document.getElementsByClassName("e-columnheader")[0].childNodes[o]}}if(!s&&a.classList.contains("e-headercell")&&"tab"===t.action&&(s=document.getElementsByClassName("e-timeline-header-container")[0]),!s&&(a.classList.contains("e-headercell")||a.classList.contains("e-toolbar-item")||a.classList.contains("e-treegrid")||a.classList.contains("e-input")||a.classList.contains("e-btn"))&&this.parent.toolbarModule&&this.parent.toolbar.length>0){var d=-1!==this.currentToolbarIndex?"tab"===t.action?this.currentToolbarIndex+1:this.currentToolbarIndex-1:"shiftTab"===t.action?i.length-1:1,h=!1;if(-1!==d&&("shiftTab"===t.action||"tab"===t.action&&d<i.length))do{i[d].classList.contains("e-hidden")?"tab"==t.action?d++:d--:((s=i[d]).setAttribute("tabindex","-1"),s.querySelector(".e-btn")===a&&("tab"===t.action?d++:d--,s=i[d]),s.querySelector(".e-btn")&&s.querySelector(".e-btn").setAttribute("tabindex","0"),h=!0,this.currentToolbarIndex=d)}while(!h)}if("tab"===t.action&&!s&&this.currentToolbarIndex===i.length-1&&(a.classList.contains("e-toolbar-item")||a.classList.contains("e-input")||a.classList.contains("e-btn")))for(l=0;l<this.parent.treeGrid.columns.length;l++)if(this.parent.treeGrid.columns[l].visible){s=document.getElementsByClassName("e-columnheader")[0].childNodes[l];break}if("shiftTab"!==t.action||s||a.classList.contains("e-headercell")||(s=document.getElementsByClassName("e-timeline-header-container")[0]),"shiftTab"===t.action&&a.classList.contains("e-timeline-header-container"))for(l=this.parent.treeGrid.columns.length;l>0;l--)if(this.parent.treeGrid.columns[l-1].visible){s=document.getElementsByClassName("e-columnheader")[0].childNodes[l-1];break}if(this.tempNextElement=s,(0,e.isNullOrUndefined)(s)||(0,e.isNullOrUndefined)(s.cellIndex)||(this.parent.allowRowDragAndDrop?(this.childrenIndex=s.cellIndex,this.nextElementIndex=s.cellIndex-1):(this.childrenIndex=s.cellIndex,this.nextElementIndex=s.cellIndex),-1===this.nextElementIndex||this.parent.ganttColumns[this.nextElementIndex].allowEditing||this.parent.ganttColumns[this.nextElementIndex].field===this.parent.taskFields.id?this.isEditableElement=!1:this.isEditableElement=!0),"noNextRow"!==s){if("string"!=typeof s){if((a.classList.contains("e-rowcell")||a.closest(".e-chart-row-cell")||a.classList.contains("e-headercell")||a.closest(".e-segmented-taskbar")||a.classList.contains("e-timeline-header-container"))&&t.preventDefault(),n&&a.classList.contains("e-rowdragdrop"))return void this.parent.treeGrid.grid.notify("key-pressed",t);if(a.classList.contains("e-rowcell")&&s&&s.classList.contains("e-rowcell")||a.classList.contains("e-headercell"))if(n){if(this.parent.editSettings.allowNextRowEdit){var p=this.parent.currentViewData[this.focusedRowIndex],u=this.parent.ganttColumns[s.getAttribute("data-colindex")].field;p.hasChildRecords?u===this.parent.taskFields.endDate||u===this.parent.taskFields.duration||u===this.parent.taskFields.dependency||u===this.parent.taskFields.progress||u===this.parent.taskFields.work||u===this.parent.taskFields.type||"taskType"===u?(this.parent.treeGrid.grid.endEdit(),this.parent.treeGrid.grid.notify("key-pressed",t)):u===this.parent.taskFields.name||u===this.parent.taskFields.startDate?this.parent.treeGrid.grid.notify("key-pressed",t):(this.parent.treeGrid.grid.notify("key-pressed",t),r&&this.parent.treeGrid.editCell(this.focusedRowIndex,u)):this.parent.treeGrid.grid.notify("key-pressed",t)}else if(!s||s&&!s.classList.contains("e-headercell")&&!s.classList.contains("e-timeline-header-container")){a.classList.contains("e-headercell")&&this.manageFocus(a,"remove",!1);var c=s;if(!(f=this.parent.flatData[a.parentElement.rowIndex]).hasChildRecords||this.parent.ganttColumns[c.getAttribute("data-colindex")].field!==this.parent.taskFields.progress&&this.parent.ganttColumns[c.getAttribute("data-colindex")].allowEditing||this.parent.ganttColumns[c.getAttribute("data-colindex")].field===this.parent.taskFields.id||!a.classList.contains("e-editedbatchcell"))s&&!a.classList.contains("e-editedbatchcell")||this.parent.treeGrid.grid.notify("key-pressed",t);else{var g=void 0;for(c=this.updateElement(c,g,n,r,f);!this.parent.ganttColumns[c.getAttribute("data-colindex")].allowEditing;)c=this.getNextElement(c,n,r);c=this.updateElement(c,g,n,r,f)}}}else if(s&&!s.classList.contains("e-headercell")&&s.classList.contains("e-rowcell")&&!s.classList.contains("e-toolbar-item")){var f;c=s;if(!(f=this.parent.flatData[a.parentElement.rowIndex]).hasChildRecords||this.parent.ganttColumns[c.getAttribute("data-colindex")].field!==this.parent.taskFields.progress&&this.parent.ganttColumns[c.getAttribute("data-colindex")].allowEditing||this.parent.ganttColumns[c.getAttribute("data-colindex")].field===this.parent.taskFields.id||!a.classList.contains("e-editedbatchcell"))if(0!==parseInt(c.parentElement.getAttribute("data-rowindex"))&&0===parseInt(c.getAttribute("data-colindex"))&&this.parent.ganttColumns[c.getAttribute("data-colindex")].field===this.parent.taskFields.id&&a.classList.contains("e-editedbatchcell")){var m=a.parentElement.rowIndex,y=this.getNextRowElement(m,n,!0);if(c=this.getChildElement(y,n),(p=this.parent.flatData[parseInt(y.getAttribute("data-rowindex"))]).hasChildRecords&&this.parent.ganttColumns[c.getAttribute("data-colindex")].field===this.parent.taskFields.progress){g=void 0;for(c=this.updateElement(c,g,n,r,p);!this.parent.ganttColumns[c.getAttribute("data-colindex")].allowEditing;)c=this.getNextElement(c,n,r);c=this.updateElement(c,g,n,r,p)}else this.parent.treeGrid.grid.notify("key-pressed",t)}else this.parent.treeGrid.grid.notify("key-pressed",t);else{var g=void 0;for(c=this.updateElement(c,g,n,r,f);!this.parent.ganttColumns[c.getAttribute("data-colindex")].allowEditing;)c=this.getNextElement(c,n,r);c=this.updateElement(c,g,n,r,f)}}if(this.parent.element.querySelectorAll(".e-focused").length>0&&this.manageFocus(this.parent.element.querySelectorAll(".e-focused")[0],"remove",!1),(!this.parent.editModule||!this.parent.editModule.cellEditModule||(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule.editedColumn))&&s){if(a.classList.contains("e-rowcell")?this.manageFocus(a,"remove",!1):this.manageFocus(a,"remove",!0),s.classList.contains("e-rowcell")&&a.nextElementSibling&&!a.classList.contains("e-timeline-header-container")||a.classList.contains("e-right-label-container")){if(!a.classList.contains("e-rowcell")){this.parent.treeGrid.grid.notify("key-pressed",t);var D=(0,e.getValue)("focusModule",this.parent.treeGrid.grid);D.currentInfo.element=s,D.currentInfo.elementToFocus=s,D.content.matrix.current=[s.parentElement.rowIndex,s.cellIndex]}this.manageFocus(s,"add",!1)}else s&&(s.classList.contains("e-toolbar-item")||s.classList.contains("e-headercell")||s.classList.contains("e-rowcell"))?(this.manageFocus(a,"remove",!1),s.classList.contains("e-toolbar-item")||this.manageFocus(s,"add",!1),a.classList.contains("e-treegrid")&&t.preventDefault()):this.manageFocus(s,"add",!0);this.parent.focusModule.setActiveElement(s)}}}else this.manageFocus(a,"remove",!0)}},t.prototype.getNextElement=function(t,i,r){if(t.classList.contains("e-timeline-header-container")&&i){var a=this.getNextRowElement(-1,i,!0);return this.getChildElement(a,i)}for(var n=i?t.nextElementSibling:t.previousElementSibling;n&&n.parentElement.classList.contains("e-row");){if(!n.matches(".e-hide")&&!n.matches(".e-rowdragdrop"))return n;n=i?n.nextElementSibling:n.previousElementSibling}if(!(0,e.isNullOrUndefined)(n)&&(n.classList.contains("e-taskbar-main-container")||n.classList.contains("e-right-connectorpoint-outer-div"))){var s=this.parent.currentViewData[this.focusedRowIndex];!(0,e.isNullOrUndefined)(s.ganttProperties.segments)&&s.ganttProperties.segments.length>0&&(n=n.classList.contains("e-right-connectorpoint-outer-div")?n.parentElement.nextElementSibling:n.getElementsByClassName("e-gantt-child-taskbar-inner-div")[0])}if(this.validateNextElement(n))return n;var o=-1;a=null;if(t.classList.contains("e-rowcell")&&r&&this.parent.editSettings.allowNextRowEdit)return o=t.parentElement.rowIndex,a=this.getNextRowElement(o,i,!0),this.getChildElement(a,i);if(t.classList.contains("e-rowcell"))if(o=t.parentElement.rowIndex,i){if(a=this.parent.getRowByIndex(o),this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length>0)return a=this.getNextRowElement(o,i,!0),this.getChildElement(a,i);if(this.validateNextElement(a,"e-left-label-container"))return a.getElementsByClassName("e-left-label-container")[0];if(this.validateNextElement(a,"e-taskbar-main-container"))return a.getElementsByClassName("e-taskbar-main-container")[0];if(this.validateNextElement(a,"e-right-label-container"))return a.getElementsByClassName("e-right-label-container")[0]}else{if(a=this.getNextRowElement(o,i,!1),this.validateNextElement(a,"e-right-label-container"))return a.getElementsByClassName("e-right-label-container")[0];if(this.validateNextElement(a,"e-taskbar-main-container"))return a.getElementsByClassName("e-taskbar-main-container")[0];if(this.validateNextElement(a,"e-left-label-container"))return a.getElementsByClassName("e-left-label-container")[0]}else if(t.parentElement.classList.contains("e-chart-row-cell")||t.parentElement.parentElement.classList.contains("e-chart-row-cell")){return o=(0,e.closest)(t,".e-chart-row").rowIndex,a=i?this.getNextRowElement(o,i,!0):this.parent.treeGrid.grid.getRowByIndex(o),this.getChildElement(a,i)}return n=t,null},t.prototype.getNextRowElement=function(e,t,i){var r=this.parent.getExpandedRecords(this.parent.currentViewData),a=this.parent.currentViewData[e],n=r.indexOf(a),s=t?r[n+1]:r[n-1],o=this.parent.currentViewData.indexOf(s);return s?i?this.parent.treeGrid.grid.getRowByIndex(o):this.parent.getRowByIndex(o):null},t.prototype.validateNextElement=function(t,i){if(t&&t.classList.contains("e-rowcell"))return!0;if(t&&i){var r=t.getElementsByClassName(i)[0];return!(!r||!r.hasChildNodes())}return!!t&&!((0,e.isNullOrUndefined)(t)||!t.hasChildNodes())},t.prototype.getChildElement=function(e,t){var i;if(!e)return"noNextRow";for(i=t?e.children[0]:e.children[e.children.length-1];i;){if(!i.matches(".e-hide")&&!i.matches(".e-rowdragdrop"))return i;i=t?i.nextElementSibling:i.previousElementSibling}return i},t.prototype.manageFocus=function(t,i,r,a){if(r){var n=null;if(t.classList.contains("e-left-label-container")||t.classList.contains("e-right-label-container"))n=t.getElementsByTagName("span")[0];else if(t.classList.contains("e-taskbar-main-container")||t.classList.contains("e-gantt-child-taskbar-inner-div")){var s=(0,e.closest)(t,".e-chart-row").rowIndex,o=this.parent.currentViewData[s],l=o.hasChildRecords?o.ganttProperties.isAutoSchedule?"e-gantt-parent-taskbar":"e-manualparent-main-container":o.ganttProperties.isMilestone?"e-gantt-milestone":!(0,e.isNullOrUndefined)(o.ganttProperties.segments)&&o.ganttProperties.segments.length>0?"e-segmented-taskbar":"e-gantt-child-taskbar";n=t.getElementsByClassName(l)[0],(0,e.isNullOrUndefined)(n)&&(n=t)}(t.classList.contains("e-right-label-temp-container")||t.classList.contains("e-left-label-temp-container")||t.classList.contains("e-indicator-span")||t.classList.contains("e-timeline-header-container"))&&("add"===i?(t.setAttribute("tabIndex","0"),(0,e.addClass)([t],"e-active-container"),t.focus()):"downArrow"!==a&&"upArrow"!==a&&((0,e.removeClass)([t],"e-active-container"),t.setAttribute("tabIndex","-1"),t.blur())),"add"!==i||(0,e.isNullOrUndefined)(n)?(0,e.isNullOrUndefined)(n)||"downArrow"===a||"upArrow"===a||((0,e.removeClass)([n],"e-active-container"),t.setAttribute("tabIndex","-1"),t.blur()):(t.setAttribute("tabIndex","0"),(0,e.addClass)([n],"e-active-container"),t.focus(),this.focusedElement=n)}else"add"===i?(t.setAttribute("tabIndex","0"),(0,e.addClass)([t],["e-focused","e-focus"]),t.focus()):(t.setAttribute("tabIndex","-1"),(0,e.removeClass)([t],["e-focused","e-focus"]),t.blur())},t.prototype.getIndexByTaskBar=function(t){var i,r;if(i=t.classList.contains(V)?t:(0,e.closest)(t,"div."+V),(0,e.isNullOrUndefined)(i))i=(0,e.closest)(t,"tr."+Z),r=[].slice.call(this.parent.chartRowsModule.ganttChartTableBody.childNodes).indexOf(i);else{var a=i.getAttribute("rowUniqueId"),n=this.parent.getRecordByID(a);r=this.parent.enableVirtualization&&this.parent.enableMultiTaskbar?this.parent.flatData.indexOf(n):this.parent.pdfExportModule&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.pdfExportModule.isPdfExport?this.parent.ids.indexOf(n.ganttProperties.taskId.toString()):this.parent.currentViewData.indexOf(n)}return r},t.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents(),this.rangeViewContainer=null,this.chartBodyContent=null,this.scrollElement=null,this.chartTimelineContainer=null,this.chartBodyContainer=null,(0,e.isNullOrUndefined)(this.scrollObject)||(this.scrollObject.destroy(),this.scrollObject=null)},t}(),ze=function(){return ze=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ze.apply(this,arguments)},qe=function(){function t(e){this.isZoomIn=!1,this.isZooming=!1,this.isZoomToFit=!1,this.topTierCollection=[],this.bottomTierCollection=[],this.pdfExportTopTierCollection=[],this.pdfExportBottomTierCollection=[],this.restrictRender=!0,this.performedTimeSpanAction=!1,this.isZoomedToFit=!1,this.parent=e,this.initProperties()}return t.prototype.initProperties=function(){this.timelineStartDate=null,this.timelineEndDate=null,this.totalTimelineWidth=0,this.customTimelineSettings=null,this.parent.isTimelineRoundOff=!this.isZoomToFit&&!!(0,e.isNullOrUndefined)(this.parent.projectStartDate),this.parent.enablePersistence&&this.parent.isLoad&&(this.parent.timelineSettings=this.parent.currentZoomingLevel)},t.prototype.validateTimelineProp=function(){this.roundOffDays(),this.processTimelineProperty(),this.timelineWidthCalculation()},t.prototype.refreshTimeline=function(){this.initProperties(),this.processTimelineUnit(),this.parent.dataOperation.calculateProjectDates(),this.parent.isFromOnPropertyChange||this.parent.updateProjectDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate,this.parent.isTimelineRoundOff);var e=this.parent.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight;this.parent.element.getElementsByClassName("e-gridcontent")[0].style.height="calc(100% - "+e+"px)",this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].style.height="calc(100% - "+e+"px)"},t.prototype.refreshTimelineByTimeSpan=function(){this.validateTimelineProp(),(!this.parent.pdfExportModule||this.parent.pdfExportModule&&!this.parent.pdfExportModule.isPdfExport||this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&!this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth)&&(this.parent.ganttChartModule.chartTimelineContainer.innerHTML=""),this.createTimelineSeries()},t.prototype.updateChartByNewTimeline=function(){this.parent.chartRowsModule.refreshChartByTimeline();var e=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].scrollLeft;this.parent.element.getElementsByClassName("e-timeline-header-container")[0].scrollLeft=e,this.parent.notify("refreshDayMarkers",{})},t.prototype.processZooming=function(t){this.isZoomToFit=!1,this.isZoomedToFit=!1;var i=t?"ZoomIn":"ZoomOut";if(this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent(i)){this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection();var r={};r.action=i,r.previousZoomingLevel=(0,e.extend)({},{},this.parent.currentZoomingLevel,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=r}this.parent.isProjectDateUpdated||this.parent.dateValidationModule.calculateProjectDates(),(0,e.isNullOrUndefined)(this.parent.zoomingProjectStartDate)||(this.parent.cloneProjectStartDate=this.parent.zoomingProjectStartDate,this.parent.cloneProjectEndDate=this.parent.zoomingProjectEndDate),this.parent.zoomingProjectStartDate=null,this.parent.zoomingProjectEndDate=null;var a,n=this.checkCurrentZoomingLevel();this.isZoomIn=t,this.isZooming=!0;var s=t?n+1:n-1,o=this.parent.zoomingLevels.find((function(e){return e.level===s}));a=o?s:n,this.parent.toolbarModule&&(t?a===this.parent.zoomingLevels[this.parent.zoomingLevels.length-1].level?(this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!1),this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!0)):this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!0):a===this.parent.zoomingLevels[0].level?(this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!1),this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!0)):this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!0)),a=this.parent.zoomingLevels.findIndex((function(e){return e.level===a}));var l=this.parent.zoomingLevels[a],d={requestType:t?"beforeZoomIn":"beforeZoomOut",timeline:l,cancel:!1};this.parent.trigger("actionBegin",d),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),d.cancel||(l=d.timeline,this.changeTimelineSettings(l))},t.prototype.changeTimelineSettings=function(t){var i=this;this.isZoomToFit?this.isSingleTier="None"===this.customTimelineSettings.topTier.unit||"None"===this.customTimelineSettings.bottomTier.unit:this.isZoomIn||(this.isSingleTier="None"===t.topTier.unit||"None"===t.bottomTier.unit);var r=this.isSingleTier?"None"===this.customTimelineSettings.topTier.unit?"topTier":"bottomTier":null;Object.keys(this.customTimelineSettings).forEach((function(a){if(a!==r)i.customTimelineSettings[a]="object"!=typeof t[a]||(0,e.isNullOrUndefined)(t[a])?t[a]:ze({},t[a]);else{var n="topTier"===a?"bottomTier":"topTier",s="bottomTier";"None"!==t[""+s].unit&&(i.customTimelineSettings[n]=ze({},t[s]))}})),this.parent.isTimelineRoundOff=!this.isZoomToFit&&!!(0,e.isNullOrUndefined)(this.parent.projectStartDate),this.processTimelineUnit(),this.parent.updateProjectDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate,this.parent.isTimelineRoundOff);var a=this.parent.criticalPathModule;if(this.parent.enableCriticalPath&&a&&a.criticalConnectorLine(a.criticalPathCollection,a.detailPredecessorCollection,!0,a.predecessorCollectionTaskIds),this.isZooming||this.isZoomToFit){var n={requestType:this.isZoomIn?"AfterZoomIn":this.isZoomToFit?"AfterZoomToProject":"AfterZoomOut",timeline:this.parent.currentZoomingLevel};this.parent.trigger("actionComplete",n),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()}var s="None"===this.topTier?"bottomTier":"topTier";this.parent.enableTimelineVirtualization&&(!this.parent.pdfExportModule||this.parent.pdfExportModule&&!this.parent.pdfExportModule.isPdfExport)&&(this.wholeTimelineWidth=this.calculateWidthBetweenTwoDate(s,this.parent.timelineModule.timelineStartDate,this.parent.timelineModule.timelineEndDate),this.wholeTimelineWidth<=this.totalTimelineWidth&&(this.wholeTimelineWidth=this.totalTimelineWidth),this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtrack").style.width=this.wholeTimelineWidth+"px",this.parent.element.querySelectorAll(".e-timeline-header-container")[0].querySelector(".e-virtualtrack").style.width=this.wholeTimelineWidth+"px",this.parent.ganttChartModule.updateWidthAndHeight())},t.prototype.processZoomToFit=function(){this.isZoomToFit=!0,this.isZooming=!1,this.isZoomedToFit=!0;var t={};this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("ZoomToFit")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),t.action="ZoomToFit",t.previousTimelineStartDate=(0,e.extend)([],[],[this.parent.cloneProjectStartDate],!0)[0],t.previousTimelineEndDate=(0,e.extend)([],[],[this.parent.cloneProjectEndDate],!0)[0],t.previousZoomingLevel=(0,e.extend)({},{},this.parent.currentZoomingLevel,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=t),this.parent.zoomingProjectStartDate||(this.parent.zoomingProjectStartDate=this.parent.cloneProjectStartDate,this.parent.zoomingProjectEndDate=this.parent.cloneProjectEndDate),this.parent.zoomingProjectStartDate>this.parent.cloneProjectStartDate&&(this.parent.cloneProjectStartDate=new Date(this.parent.allowUnscheduledTasks?this.parent.zoomingProjectStartDate:this.parent.cloneProjectStartDate)),this.parent.dataOperation.calculateProjectDates();var i,r,a,n=(this.parent.cloneProjectEndDate.getTime()-this.parent.cloneProjectStartDate.getTime())/864e5,s=this.parent.ganttChartModule.chartElement.offsetWidth,o=s/n,l=this.parent.zoomingLevels.slice().sort((function(e,t){return e.perDayWidth||t.perDayWidth?e.perDayWidth<t.perDayWidth?1:-1:0}));if(0!==o){for(var d=0;d<l.length;d++){if(r=l[d],d===l.length-1){i=l[d];break}if(a=l[d+1],o>=r.perDayWidth){i=l[d];break}if(o<r.perDayWidth&&o>a.perDayWidth){i=l[d+1];break}}var h=(0,e.extend)({},{},i,!0);this.roundOffDateToZoom(this.parent.cloneProjectStartDate,!0,o,h.bottomTier.unit,i),this.roundOffDateToZoom(this.parent.cloneProjectEndDate,!1,o,h.bottomTier.unit,i);var p=this.calculateNumberOfTimelineCells(h),u=this.parent.ganttChartModule.scrollElement.offsetHeight-17,c=this.parent.ganttChartModule.chartBodyContent.offsetHeight<=u?0:17;h.timelineUnitSize=Math.abs(s-c)/p;var g={requestType:"beforeZoomToProject",timeline:h};this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin",this.parent.controlId+"_zoomout"],!0),this.parent.trigger("actionBegin",g),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),this.changeTimelineSettings(h),this.parent.isTimelineRoundOff=!!(0,e.isNullOrUndefined)(this.parent.projectStartDate),this.isZoomToFit=!1}},t.prototype.bottomTierCellWidthCalc=function(e,t,i){var r;switch(e){case"Minutes":r=6e4*t.bottomTier.count;break;case"Hour":r=36e5*t.bottomTier.count;break;case"Week":r=6048e5*t.bottomTier.count;break;case"Day":r=864e5*t.bottomTier.count;break;case"Month":var a=new Date(i.getFullYear(),i.getMonth()+1,0).getDate();r=t.bottomTier.count*(86400*a*1e3);break;case"Year":var n=i.getFullYear()%400==0||i.getFullYear()%100!=0&&i.getFullYear()%4==0?366:365;r=t.bottomTier.count*(86400*n*1e3)}return r},t.prototype.roundOffDateToZoom=function(e,t,i,r,a){var n=this.bottomTierCellWidthCalc(r,a,e);t?e.setTime(e.getTime()-n):e.setTime(e.getTime()+n)},t.prototype.calculateNumberOfTimelineCells=function(e){var t=new Date(this.parent.cloneProjectStartDate.getTime()),i=new Date(this.parent.cloneProjectEndDate.getTime());this.parent.dateValidationModule.updateDateWithTimeZone(t,i);var r=Math.abs((i.getTime()-t.getTime())/864e5),a=e.bottomTier.count,n=e.bottomTier.unit;return"Day"===n?r/a:"Week"===n?r/a/7:"Month"===n?r/a/28:"Year"===n?r/a/336:"Hour"===n?r*(24/a):r*(1440/a)},t.prototype.processTimelineUnit=function(){var e=["Year","Month","Week","Day","Hour","Minutes"];this.customTimelineSettings=this.customTimelineSettings?this.customTimelineSettings:this.extendFunction(this.parent.timelineSettings,["timelineViewMode","timelineUnitSize","weekStartDay","weekendBackground"],{topTier:["unit","format","count","formatter"],bottomTier:["unit","format","count","formatter"]}),-1===e.indexOf(this.customTimelineSettings.topTier.unit)&&-1===e.indexOf(this.customTimelineSettings.bottomTier.unit)?(this.customTimelineSettings.topTier.unit=-1!==e.indexOf(this.customTimelineSettings.timelineViewMode)?this.customTimelineSettings.timelineViewMode:"Week",this.customTimelineSettings.bottomTier.unit=5!==e.indexOf(this.customTimelineSettings.topTier.unit)?e[e.indexOf(this.customTimelineSettings.topTier.unit)+1]:"None"):-1!==e.indexOf(this.customTimelineSettings.topTier.unit)&&-1!==e.indexOf(this.customTimelineSettings.bottomTier.unit)&&e.indexOf(this.customTimelineSettings.topTier.unit)>e.indexOf(this.customTimelineSettings.bottomTier.unit)?this.customTimelineSettings.bottomTier.unit=this.customTimelineSettings.topTier.unit:(this.customTimelineSettings.topTier.unit=-1===e.indexOf(this.customTimelineSettings.topTier.unit)?"None":this.customTimelineSettings.topTier.unit,this.customTimelineSettings.bottomTier.unit=-1===e.indexOf(this.customTimelineSettings.bottomTier.unit)?"None":this.customTimelineSettings.bottomTier.unit),this.topTier=this.customTimelineSettings.topTier.unit,this.bottomTier=this.customTimelineSettings.bottomTier.unit,this.previousIsSingleTier=this.isSingleTier,this.isSingleTier="None"===this.topTier||"None"===this.bottomTier},t.prototype.processTimelineProperty=function(){this.customTimelineSettings.topTier.count="None"===this.topTier?1:this.validateCount(this.customTimelineSettings.topTier.unit,this.customTimelineSettings.topTier.count,"topTier"),this.customTimelineSettings.bottomTier.count="None"===this.customTimelineSettings.bottomTier.unit?1:this.validateCount(this.customTimelineSettings.bottomTier.unit,this.customTimelineSettings.bottomTier.count,"bottomTier"),this.customTimelineSettings.bottomTier.format=this.validateFormat(this.customTimelineSettings.bottomTier.unit,this.customTimelineSettings.bottomTier.format),this.customTimelineSettings.topTier.format=this.validateFormat(this.topTier,this.customTimelineSettings.topTier.format),this.customTimelineSettings.weekStartDay=this.customTimelineSettings.weekStartDay>=0&&this.customTimelineSettings.weekStartDay<=6?this.customTimelineSettings.weekStartDay:0,this.parent.pdfExportModule&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth||this.checkCurrentZoomingLevel()},t.prototype.calculateZoomingLevelsPerDayWidth=function(){for(var e=this.parent.zoomingLevels,t=0;t<e.length;t++){var i=this.getPerDayWidth(e[t].timelineUnitSize,e[t].bottomTier.count,e[t].bottomTier.unit);e[t].perDayWidth=i}},t.prototype.checkCurrentZoomingLevel=function(){var e="None"!==this.customTimelineSettings.bottomTier.unit?this.customTimelineSettings.bottomTier.count:this.customTimelineSettings.topTier.count,t="None"!==this.customTimelineSettings.bottomTier.unit?this.customTimelineSettings.bottomTier.unit:this.customTimelineSettings.topTier.unit,i="None"!==this.customTimelineSettings.bottomTier.unit?"bottomTier":"topTier",r=this.getCurrentZoomingLevel(t,e,i);return this.parent.toolbarModule&&(r===this.parent.zoomingLevels[this.parent.zoomingLevels.length-1].level?this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!1):r===this.parent.zoomingLevels[0].level&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!1)),this.parent.currentZoomingLevel=this.parent.zoomingLevels[r],r},t.prototype.getCurrentZoomingLevel=function(e,t,i){var r,a,n,s,o;this.parent.zoomingLevels.length||(this.parent.zoomingLevels=this.parent.getZoomingLevels());var l=this.parent.zoomingLevels.filter((function(t){return"bottomTier"===i?t.bottomTier.unit===e:t.topTier.unit===e}));if(0===l.length){var d=this.getClosestUnit(e,"",!1);l=this.parent.zoomingLevels.filter((function(e){return"bottomTier"===i?e.bottomTier.unit===d:e.topTier.unit===d}))}for(var h=l.sort((function(e,t){return"bottomTier"===i?e.bottomTier.count&&t.bottomTier.count?e.bottomTier.count<t.bottomTier.count?1:-1:0:e.topTier.count&&t.topTier.count?e.topTier.count<t.topTier.count?1:-1:0})),p=0;p<h.length;p++){if(o=h[p],p===h.length-1){r=h[p].level;break}if(s=h[p+1],t>=o[""+i].count){a=h[p],r=(n=h.filter((function(e){return"bottomTier"===i?e.bottomTier.count===a.bottomTier.count:e.topTier.count===a.topTier.count}))).length>1?this.checkCollectionsWidth(n):n[0].level;break}if(t<o[""+i].count&&t>s[""+i].count){a=h[p+1],r=(n=h.filter((function(e){return"bottomTier"===i?e.bottomTier.count===a.bottomTier.count:e.topTier.count===a.topTier.count}))).length>1?this.checkCollectionsWidth(n):n[0].level;break}}return r},t.prototype.getClosestUnit=function(e,t,i){var r=["Year","Month","Week","Day","Hour","Minutes"],a=r.indexOf(e);return 0===a&&(i=!0),e=this.isZoomIn||i?r[a+1]:r[a-1],0===this.parent.zoomingLevels.filter((function(t){return t.bottomTier.unit===e})).length?("Year"===e&&(i=!0),t=e,this.getClosestUnit(e,t,i)):e},t.prototype.checkCollectionsWidth=function(e){for(var t,i,r,a=e,n=this.customTimelineSettings.timelineUnitSize,s=a.sort((function(e,t){return e.timelineUnitSize<t.timelineUnitSize?1:-1})),o=0;o<s.length;o++){if(r=s[o],o===s.length-1){t=s[o].level;break}if(i=s[o+1],n>=r.timelineUnitSize){t=s[o].level;break}if(n<r.timelineUnitSize&&n>i.timelineUnitSize){t=s[o+1].level;break}}return t},t.prototype.updateTimelineHeaderHeight=function(){if(this.parent.timelineModule.isSingleTier?((0,e.addClass)([this.parent.ganttChartModule.chartTimelineContainer],E),this.parent.treeGrid.element&&((0,e.addClass)(this.parent.treeGrid.element.querySelectorAll(".e-headercell"),E),(0,e.addClass)(this.parent.treeGrid.element.querySelectorAll(".e-columnheader"),E))):((0,e.removeClass)([this.parent.ganttChartModule.chartTimelineContainer],E),this.parent.treeGrid.element&&((0,e.removeClass)(this.parent.treeGrid.element.querySelectorAll(".e-headercell"),E),(0,e.removeClass)(this.parent.treeGrid.element.querySelectorAll(".e-columnheader"),E))),this.previousIsSingleTier!==this.isSingleTier){var t=0;(0,e.isNullOrUndefined)(this.parent.toolbarModule)||(0,e.isNullOrUndefined)(this.parent.toolbarModule.element)||(t=this.parent.toolbarModule.element.offsetHeight),this.parent.ganttChartModule.scrollObject.setHeight(this.parent.ganttHeight-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight-t),this.parent.treeGrid.height=this.parent.ganttHeight-t-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight}},t.prototype.dateByLeftValue=function(t,i,r){var a=new Date(this.parent.timelineModule.timelineStartDate.toString()),n=864e5/this.parent.perDayWidth;if(a.setTime(a.getTime()+t*n),i&&!(0,e.isNullOrUndefined)(r.predecessorsName)&&""!==r.predecessorsName){a.setDate(a.getDate()-1);var s=this.parent.getCurrentDayEndTime(r.isAutoSchedule?r.autoEndDate:r.endDate);this.parent.dateValidationModule.setTime(s,a),a=this.parent.dateValidationModule.checkStartDate(a,r,!0)}var o="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.topTier:this.parent.timelineModule.bottomTier;return"Hour"!==o&&"Minutes"!==o&&(this.parent.isInDst(new Date(this.parent.timelineModule.timelineStartDate.toString()))&&!this.parent.isInDst(a)?a.setTime(a.getTime()+36e5):!this.parent.isInDst(new Date(this.parent.timelineModule.timelineStartDate.toString()))&&this.parent.isInDst(a)&&a.setTime(a.getTime()-36e5)),a},t.prototype.createTimelineSeries=function(){var t,i,r,a,n,s,o,l=this.isSingleTier?1:2,d="None"===this.topTier?"bottomTier":"topTier";if(this.topTierCollection=[],this.bottomTierCollection=[],!0===this.restrictRender&&(this.updateTimelineHeaderHeight(),this.wholeTimelineWidth=this.calculateWidthBetweenTwoDate(d,this.parent.timelineModule.timelineStartDate,this.parent.timelineModule.timelineEndDate)),this.parent.enableTimelineVirtualization&&this.wholeTimelineWidth>3*this.parent.element.offsetWidth){for(var h=0;h<l;h++){(a=(0,e.createElement)("table",{className:O,styles:"display: block;"})).setAttribute("role","none"),n=(0,e.createElement)("thead",{className:I,styles:"display:block; border-collapse:collapse"});var p=this.createTimelineTemplate(d);t=(0,e.createElement)("tr"),Array.from(p.childNodes).forEach((function(e){t.appendChild(e)})),i=(0,e.createElement)("td"),r=(0,e.createElement)("div",{styles:"width: 20px"}),s=(0,e.createElement)("div",{className:"e-virtualtable"}),o=(0,e.createElement)("div",{className:"e-virtualtrack"}),i.appendChild(r),t.appendChild(i),s.appendChild(t),n.appendChild(s),n.appendChild(o),a.appendChild(n),this.parent.ganttChartModule.chartTimelineContainer.appendChild(a),d="bottomTier",t=null,this.restrictRender=!1}if("Auto"===this.parent.height||this.parent.timelineModule.isSingleTier){var u=this.parent.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight;this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].style.height="calc(100% - "+u+"px)",(0,e.isNullOrUndefined)(this.parent.element.getElementsByClassName("e-gridcontent")[0])||(this.parent.treeGrid.element.getElementsByClassName("e-gridcontent")[0].style.height="calc(100% - "+u+"px)")}this.timelineVirtualizationStyles()}else{for(h=0;h<l;h++){(a=(0,e.createElement)("table",{className:O,styles:"display: block;"})).setAttribute("role","none"),n=(0,e.createElement)("thead",{className:I,styles:"display:block; border-collapse:collapse"});p=this.createTimelineTemplate(d);t=(0,e.createElement)("tr"),Array.from(p.childNodes).forEach((function(e){t.appendChild(e)})),i=(0,e.createElement)("td"),r=(0,e.createElement)("div",{styles:"width: 20px"}),i.appendChild(r),t.appendChild(i),n.appendChild(t),a.appendChild(n),this.parent.ganttChartModule.chartTimelineContainer.appendChild(a),d="bottomTier",t=null}if(this.wholeTimelineWidth=this.totalTimelineWidth,"Auto"===this.parent.height||this.parent.timelineModule.isSingleTier){u=this.parent.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight;this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].style.height="calc(100% - "+u+"px)",(0,e.isNullOrUndefined)(this.parent.element.getElementsByClassName("e-gridcontent")[0])||(this.parent.treeGrid.element.getElementsByClassName("e-gridcontent")[0].style.height="calc(100% - "+u+"px)")}}},t.prototype.timelineVirtualizationStyles=function(){var t=0,i=this.wholeTimelineWidth;if(this.parent.enableTimelineVirtualization){t=this.parent.enableTimelineVirtualization&&!(0,e.isNullOrUndefined)(this.parent.ganttChartModule.scrollObject.element.scrollLeft)&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():0,this.parent.enableRtl&&(t=-t),this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtable").style.transform="translate("+t+"px, 0px)";var r=this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtrack");if(r.style.position="relative",r.style.width=i+"px",this.parent.ganttChartModule.scrollObject.isSetScrollLeft){var a=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[0].querySelector(".e-virtualtable"),n=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[1].querySelector(".e-virtualtable");a.style.transform="translate("+t+"px, 0px)",n.style.transform="translate("+t+"px, 0px)"}var s=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[0].querySelector(".e-virtualtrack"),o=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[1].querySelector(".e-virtualtrack");s.style.position="relative",o.style.position="relative",s.style.width=i+"px",o.style.width=i+"px",this.parent.connectorLineModule.svgObject.style.width=i+"px",this.parent.element.querySelector("."+x).style.width="calc(100% - 17px)",(this.parent.timelineModule.isZooming||this.parent.timelineModule.isZoomToFit)&&(this.parent.ganttChartModule.scrollElement.scrollLeft=0,this.parent.ganttChartModule.scrollObject.updateChartElementStyles())}},t.prototype.validateCount=function(t,i,r){var a,n=!(0,e.isNullOrUndefined)(i)&&parseInt(i.toString(),10)>0?parseInt(i.toString(),10):1,s=Math.abs(this.timelineRoundOffEndDate.getTime()-this.timelineStartDate.getTime());switch(t){case"Year":n=n<=(a=Math.round(s/864e5/336))?n:a>0?a:1,"None"!==this.topTier&&"bottomTier"===r&&(n=this.validateBottomTierCount(t,n));break;case"Month":n=n<=(a=Math.round(s/864e5/28))?n:a>0?a+1:1,"None"!==this.topTier&&"bottomTier"===r&&(n=this.validateBottomTierCount(t,n));break;case"Week":n=n<=(a=Math.round(s/864e5/7))?n:a>0?a:1,"None"!==this.topTier&&"bottomTier"===r&&(n=this.validateBottomTierCount(t,n));break;case"Day":n=n<=(a=Math.round(s/864e5))?n:a>0?a:1,"None"!==this.topTier&&"bottomTier"===r&&(n=this.validateBottomTierCount(t,n));break;case"Hour":n=n<=(a=Math.round(s/36e5))?n:a>0?a:1,"None"!==this.topTier&&"bottomTier"===r&&(n=this.validateBottomTierCount(t,n));break;case"Minutes":n=n<=(a=Math.round(s/6e4))?n:a>0?a:1,"None"!==this.topTier&&"bottomTier"===r&&(n=this.validateBottomTierCount(t,n))}return i!==n&&this.isZooming&&this.parent.toolbarModule&&("bottomTier"===r||this.isSingleTier)&&(this.isZoomIn?this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!1):this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!1)),n},t.prototype.validateBottomTierCount=function(e,t){var i;switch(e){case"Year":i=t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Month":i="Year"===this.topTier?t<=12*this.customTimelineSettings.topTier.count?t:12*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Week":i="Year"===this.topTier?t<=48*this.customTimelineSettings.topTier.count?t:48*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=4*this.customTimelineSettings.topTier.count?t:4*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Day":i="Year"===this.topTier?t<=336*this.customTimelineSettings.topTier.count?t:336*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=28*this.customTimelineSettings.topTier.count?t:28*this.customTimelineSettings.topTier.count:"Week"===this.topTier?t<=7*this.customTimelineSettings.topTier.count?t:7*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Hour":i="Year"===this.topTier?t<=8064*this.customTimelineSettings.topTier.count?t:8064*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=672*this.customTimelineSettings.topTier.count?t:672*this.customTimelineSettings.topTier.count:"Week"===this.topTier?t<=7*this.customTimelineSettings.topTier.count*24?t:7*this.customTimelineSettings.topTier.count*24:"Day"===this.topTier?t<=24*this.customTimelineSettings.topTier.count?t:24*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Minutes":i="Year"===this.topTier?t<=483840*this.customTimelineSettings.topTier.count?t:483840*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=40320*this.customTimelineSettings.topTier.count?t:40320*this.customTimelineSettings.topTier.count:"Week"===this.topTier?t<=7*this.customTimelineSettings.topTier.count*24*60?t:7*this.customTimelineSettings.topTier.count*24*60:"Day"===this.topTier?t<=24*this.customTimelineSettings.topTier.count*60?t:24*this.customTimelineSettings.topTier.count*60:"Hour"===this.topTier?t<=60*this.customTimelineSettings.topTier.count?t:60*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count}return i},t.prototype.validateFormat=function(e,t){var i;switch(e){case"Week":i=t||"MMM dd, yyyy";break;case"Day":case"None":i=t||"";break;case"Hour":i=t||"H";break;case"Month":i=t||"MMM yyyy";break;case"Year":i=t||"yyyy";break;case"Minutes":i=t||"m"}return i},t.prototype.extendFunction=function(e,t,i){for(var r=this,a={},n=0;n<t.length;n++)a[t[n]]=e[t[n]];return i&&Object.keys(i).forEach((function(t){a[t]=r.extendFunction(e[t],i[t],null)})),a},t.prototype.formatDateHeader=function(e,t){var i,r=new Date(t.getTime());""===e?(i=this.parent.globalize.formatDate(r,{format:"E"}),i="zh"===this.parent.locale?i.slice(1):"ar"===this.parent.locale?i:i.slice(0,1)):i=this.parent.globalize.formatDate(r,{format:e});return i},t.prototype.customFormat=function(t,i,r,a,n){return(n="string"==typeof n?(0,e.getValue)(n,window):n)(t,i,r,a)},t.prototype.createTimelineTemplate=function(t){var i,r,a,n=!1,s=this.parent,o=(0,e.createElement)("th"),l="topTier"===t?s.timelineModule.customTimelineSettings.topTier.unit:s.timelineModule.customTimelineSettings.bottomTier.unit,d="topTier"===t?s.timelineModule.customTimelineSettings.topTier.count:s.timelineModule.customTimelineSettings.bottomTier.count,h=this.parent.enableTimelineVirtualization&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():null,p=this.parent.enableTimelineVirtualization&&!(0,e.isNullOrUndefined)(h)?new Date(this.dateByLeftValue(h).toString()):new Date(this.parent.timelineModule.timelineStartDate.toString()),u=new Date(this.timelineRoundOffEndDate.toString()),c=[],g=0,f=3*this.parent.element.offsetWidth;do{var m={};m.startDate=new Date(p.getTime()),"Month"!==l&&"Hour"!==l||"bottomTier"!==t||1===d||0!==c.length||(n=!0),i=this.getHeaterTemplateString(new Date(p.toString()),l,t,!1,d,m,n),c.push(new Date(p.toString())),n&&"Month"===l?a=this.calculateQuarterEndDate(p,d).getTime():(r=Math.abs(this.getIncrement(p,d,l)),a=p.getTime()+r);var y=new Date(p.getTime());n=!1,p.setTime(a);var D=y.getHours(),v=p.getHours()-D;if(v!=d&&v>1)if(!this.parent.isInDst(p)&&this.parent.isInDst(y)||this.parent.isInDst(p)&&!this.parent.isInDst(y))p.getTimezoneOffset()>y.getTimezoneOffset()&&p.setTime(p.getTime()-36e5*(v-d)),"Minutes"===l&&r/6e4/d!=v&&15===d&&p.setTime(p.getTime()-d*v*6e4);5===p.getHours()&&2===d&&"bottomTier"===t&&"Hour"===s.timelineModule.customTimelineSettings.bottomTier.unit&&p.setTime(p.getTime()-36e5),8===p.getHours()&&12===d&&"bottomTier"===t&&"Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit&&p.setTime(p.getTime()-288e5),p>=u&&(i=this.getHeaterTemplateString(c[c.length-1],l,t,!0,d,m)),o.appendChild(i);var k="topTier"===t?this.topTierCollection:this.bottomTierCollection;m.endDate=new Date(p.getTime()),this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.enableTimelineVirtualization?"topTier"===t?this.pdfExportTopTierCollection.push(m):this.pdfExportBottomTierCollection.push(m):k.push(m),g+=m.width,this.weekendEndDate=m.endDate>=u?u:m.endDate}while(this.parent.enableTimelineVirtualization&&(!this.parent.pdfExportModule||this.parent.pdfExportModule&&!this.parent.pdfExportModule.isPdfExport)?g<f&&p<u:p<u);return o},t.prototype.updateTimelineAfterZooming=function(t,i){var r,a,n,s=document.getElementsByClassName("e-chart-scroll-container e-content")[0];if(!(0,e.isNullOrUndefined)(s)){var o=s.offsetWidth,l=s.offsetHeight,d=document.getElementsByClassName("e-chart-rows-container")[0].offsetHeight;if(r=Math.abs(this.timelineStartDate.getTime()-t.getTime()),r/=864e5,a="None"===this.bottomTier?this.getPerDayWidth(this.customTimelineSettings.timelineUnitSize,this.customTimelineSettings.topTier.count,this.topTier):this.getPerDayWidth(this.customTimelineSettings.timelineUnitSize,this.customTimelineSettings.bottomTier.count,this.bottomTier),o>=(n=l<d?a*r+17:a*r)){var h=o-n;h=Math.round(h/a),t.setDate(t.getDate()+h),this.parent.timelineModule.timelineEndDate=t,i&&this.parent.updateProjectDates(this.timelineStartDate,this.timelineEndDate,this.parent.isTimelineRoundOff)}}},t.prototype.getTimelineRoundOffEndDate=function(t){var i="None"===this.topTier?this.bottomTier:this.topTier,r=new Date(t.toString());return this.parent.isTimelineRoundOff&&("Hour"===i?r.setMinutes(60):"Minutes"===i?r.setSeconds(60):r.setHours(24,0,0,0)),(0,e.isNullOrUndefined)(this.parent.projectEndDate)&&this.updateTimelineAfterZooming(r,!1),r},t.prototype.getIncrement=function(e,t,i,r){var a,n=new Date(e.getTime()),s=new Date(e.getTime());switch(i){case"Year":n=e,a=(s=new Date(e.getFullYear()+(t-1),11,31)).getTime()-n.getTime()+864e5;break;case"Month":n=e,a=(s=new Date(e.getFullYear(),e.getMonth()+t,1)).getTime()-n.getTime();break;case"Week":var o=this.parent.timelineModule.customTimelineSettings.weekStartDay,l=e.getDay()<o?o-e.getDay():6-e.getDay()+o;t=l>0?t-1:0,s.setHours(24,0,0,0),l=e.getDay()<o&&l>0?l-1:l,s.setDate(s.getDate()+(l+7*t)),a=s.getTime()-n.getTime();break;case"Day":s.setHours(24,0,0,0),a=s.getTime()-n.getTime()+864e5*(t-1),a=this.checkDate(n,s,a,t,i);break;case"Hour":s.setMinutes(60),s.setSeconds(0),a=s.getTime()-n.getTime()+36e5*(t-1);var d=new Date(s);d.setTime(d.getTime()+a),r&&12===t&&0!==n.getHours()&&(d.setHours(0,0,0,0),a=d.getTime()-n.getTime()),r&&6===t&&0!==n.getHours()&&(d.setHours(6,0,0,0),a=d.getTime()-n.getTime()),a=this.checkDate(n,s,a,t,i);break;case"Minutes":s.setSeconds(60),a=s.getTime()-n.getTime()+6e4*(t-1),a=this.checkDate(n,s,a,t,i)}return a},t.prototype.checkDate=function(e,t,i,r,a){var n=new Date(e.getTime());if(n.setTime(n.getTime()+i),"Day"===a&&1!==r&&(n.getTime()-t.getTime())/864e5!==r&&e.getTimezoneOffset()!==n.getTimezoneOffset()){var s=r-(n.getTime()-t.getTime())/864e5;this.parent.isInDst(n)?this.parent.isInDst(n)&&2!==r&&(i-=36e5*s):i+=36e5*s}else if("Hour"===a&&1!==r&&(n.getTime()-t.getTime())/36e5!==r&&e.getTimezoneOffset()!==n.getTimezoneOffset()){s=r-(n.getTime()-t.getTime())/36e5;this.parent.isInDst(n)?this.parent.isInDst(n)&&2!==r&&(i-=36e5*s):i+=36e5*s}else if("Minutes"===a&&1!==r&&(n.getTime()-t.getTime())/6e4!==r&&e.getTimezoneOffset()!==n.getTimezoneOffset()){s=r-(n.getTime()-t.getTime())/6e4;this.parent.isInDst(n)?this.parent.isInDst(n)&&2!==r&&(i-=36e5*s):i+=36e5*s}return i},t.prototype.isWeekendHeaderCell=function(e,t,i){return!("Day"!==e&&"Hour"!==e&&"Minutes"!==e||1!==this.customTimelineSettings[t].count&&"Hour"!==e&&"Minutes"!==e||-1===this.parent.nonWorkingDayIndex.indexOf(i.getDay()))},t.prototype.calculateQuarterEndDate=function(e,t){var i=e.getMonth();return 3===t?i>=0&&i<=2?new Date(e.getFullYear(),3,1):i>=3&&i<=5?new Date(e.getFullYear(),6,1):i>=6&&i<=8?new Date(e.getFullYear(),9,1):new Date(e.getFullYear()+1,0,1):i>=0&&i<=5?new Date(e.getFullYear(),6,1):new Date(e.getFullYear()+1,0,1)},t.prototype.getHeaterTemplateString=function(t,i,r,a,n,s,o){var l,d=null;(0,e.isNullOrUndefined)(this.parent.timelineTemplate)||(d=this.parent.chartRowsModule.templateCompiler(this.parent.timelineTemplate));var h,p="topTier"===r?this.parent.timelineModule.customTimelineSettings.topTier.format:this.parent.timelineModule.customTimelineSettings.bottomTier.format,u="topTier"===r?this.parent.timelineModule.customTimelineSettings.topTier.formatter:this.parent.timelineModule.customTimelineSettings.bottomTier.formatter,c=(0,e.isNullOrUndefined)(u)?this.parent.globalize.formatDate(t,{format:this.parent.getDateFormat()}):this.customFormat(t,p,r,i,u);h=this.getIncrement(t,n,i,o)/864e5*this.parent.perDayWidth;var g=this.getIncrement(t,n,i),f=new Date(t.getTime()+g),m=new Date(t.getTime()+36e5*n),y=f.getTime(),D=m.getTime(),v=this.parent.timelineModule.timelineStartDate.getTime(),k=this.parent.dataOperation.getDSTTransitions(t.getFullYear()).dstStart.getTime();if(!this.parent.isInDst(f)&&this.parent.isInDst(t)||this.parent.isInDst(f)&&!this.parent.isInDst(t)||y!=D&&D>y&&v<=k){var w=0,b=g/36e5;if(!this.parent.isInDst(f)&&this.parent.isInDst(t)){switch(i){case"Hour":w=1*n;break;case"Day":w=24*n;break;case"Week":w=168*n;break;case"Minutes":w=n/60}if(b!=w&&b>w)if(0===(h=(this.getIncrement(t,n,i)-36e5*(b-w))/864e5*this.parent.perDayWidth)&&"Minutes"===i)h=this.parent.perDayWidth/1440*n}else{var T=this.parent.currentZoomingLevel?this.parent.currentZoomingLevel:this.parent.timelineSettings,P=null!==T.bottomTier?T.bottomTier:T.topTier,S=1===P.count&&"Hour"===P.unit;switch(i){case"Hour":w=1*n;break;case"Day":w=24*n;break;case"Week":w=168*n;break;case"Minutes":w=n/60}if(b!=w&&b<w&&("topTier"!==r||!S))if(0===(h=(this.getIncrement(t,n,i)+36e5)/864e5*this.parent.perDayWidth)&&"Minutes"===i)h=this.parent.perDayWidth/1440*n}}var C=h;h=a||o&&"Hour"!==i?a?this.calculateWidthBetweenTwoDate(i,t,this.timelineRoundOffEndDate):this.calculateWidthBetweenTwoDate(i,t,this.calculateQuarterEndDate(t,n)):h;var R=this.isWeekendHeaderCell(i,r,t),M="topTier"===r?" e-gantt-top-cell-text":"";o&&20===t.getHours()&&12===n&&"bottomTier"===r&&"Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit&&t.setTime(t.getTime()-72e6);var x=(0,e.isNullOrUndefined)(u)?this.formatDateHeader(p,t):this.customFormat(t,p,r,i,u);if(!(0,e.isNullOrUndefined)(d)){var O={date:c,tier:r,value:x};l=d((0,e.extend)({},O),this.parent,"TimelineTemplate",this.parent.chartRowsModule.getTemplateID("TimelineTemplate"),!1,void 0,null,this.parent.root)}var I=this.parent.timelineModule.isSingleTier?"e-timeline-single-header-cell":"e-timeline-top-header-cell",E=R?" e-weekend-header-cell":"",F=(0,e.createElement)("th",{className:""+I+E,styles:"width:"+h+"px;"+(R&&this.customTimelineSettings.weekendBackground?"background-color:"+this.customTimelineSettings.weekendBackground+";":"")});F.tabIndex=-1,F.setAttribute("aria-label",this.parent.localeObj.getConstant("timelineCell")+" "+c);var U=(0,e.createElement)("div",{className:"e-header-cell-label"+M,styles:"width:"+(h-1)+"px;"});return U.title=this.parent.timelineSettings.showTooltip?c:"",U.textContent=x,this.parent.isReact&&!(0,e.isNullOrUndefined)(l)&&l.length>0&&(l[0].style.width="100%",l[0].style.height="100%"),!(0,e.isNullOrUndefined)(d)&&!(0,e.isNullOrUndefined)(l)&&l.length>0?(0,e.append)(l,F):F.append(U),F.outerHTML,!this.isSingleTier&&"topTier"!==r||a?(this.isSingleTier||"topTier"===r)&&a&&(this.totalTimelineWidth=this.totalTimelineWidth-C+h):this.totalTimelineWidth=this.totalTimelineWidth+h,s.value=x,s.isWeekend=R,s.width=h,F},t.prototype.calculateWidthBetweenTwoDate=function(e,t,i){var r=new Date(t.getTime()),a=new Date(i.getTime());return this.parent.dateValidationModule.updateDateWithTimeZone(r,a),(a.getTime()-r.getTime())/864e5*this.parent.perDayWidth},t.prototype.timelineWidthCalculation=function(){var e=this.customTimelineSettings.timelineUnitSize,t=this.customTimelineSettings.bottomTier.count,i=this.customTimelineSettings.topTier.count;this.bottomTierCellWidth=e,"None"===this.bottomTier?this.parent.perDayWidth=this.getPerDayWidth(e,i,this.topTier):this.parent.perDayWidth=this.getPerDayWidth(e,t,this.bottomTier),this.topTierCellWidth="None"!==this.bottomTier?"Week"===this.topTier?7*this.parent.perDayWidth:"Hour"===this.topTier?this.parent.perDayWidth/24:"Minutes"===this.topTier?this.parent.perDayWidth/1440:this.parent.perDayWidth:e,this.topTierCellWidth=this.isSingleTier?this.topTierCellWidth:this.topTierCellWidth*i},t.prototype.getPerDayWidth=function(e,t,i){var r;switch(i){case"Year":r=e/t/336;break;case"Month":r=e/t/28;break;case"Week":r=e/t/7;break;case"Day":r=e/t;break;case"Hour":r=24/t*e;break;case"Minutes":r=1440/t*e}return r},t.prototype.roundOffDays=function(){var t=this.parent.cloneProjectStartDate,i=this.parent.cloneProjectEndDate,r="None"===this.topTier?this.bottomTier:this.topTier;if(this.parent.isTimelineRoundOff){if("Year"===r)t=new Date(t.getFullYear(),0,1),i=new Date(i.getFullYear(),11,31);else if("Month"===r)t=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(i.getFullYear(),i.getMonth()+1,0);else if("Week"===r){var a=(0,e.isNullOrUndefined)(this.customTimelineSettings.weekStartDay)?0:this.parent.timelineModule.customTimelineSettings.weekStartDay,n=t.getDay()<a?t.getDate()-(7-a+t.getDay()):t.getDate()-t.getDay()+a;t.setDate(n);var s=i.getDate()-i.getDay()+6+a;i.setDate(s)}"Hour"===r?t.setMinutes(0):"Minutes"===r?t.setSeconds(0):t.setHours(0,0,0,0)}this.timelineStartDate=t,this.timelineEndDate=i,this.timelineRoundOffEndDate=this.getTimelineRoundOffEndDate(this.timelineEndDate)},t.prototype.updateScheduleDatesByToolBar=function(e,t,i,r){if("Year"===e&&("prevTimeSpan"===t?i=0===i.getMonth()?new Date(i.getFullYear()-1,0,1):new Date(i.getFullYear(),0,1):r=11===r.getMonth()?new Date(r.getFullYear()+1,0,1):new Date(r.getFullYear(),12,1)),"Month"===e&&("prevTimeSpan"===t?i=1===i.getDate()?new Date(i.getFullYear(),i.getMonth()-1,1):new Date(i.getFullYear(),i.getMonth(),1):r=new Date(r.getFullYear(),r.getMonth()+1,1)),"Week"===e){var a=this.parent.timelineModule.customTimelineSettings.weekStartDay,n=void 0;"prevTimeSpan"===t?(n=i.getDay()<a?7-(a-i.getDay()):i.getDay()-a,i.setHours(0,0,0,0),0===n?i.setDate(i.getDate()-7):i.setDate(i.getDate()-n)):(n=r.getDay()<a?a-r.getDay():7-r.getDay()+a,r.setHours(0,0,0,0),0===n?r.setDate(r.getDate()+6):r.setDate(r.getDate()+n))}"Day"===e&&("prevTimeSpan"===t?0===i.getHours()?i.setTime(i.getTime()-864e5):i.setHours(0):0===r.getHours()?r.setTime(r.getTime()+864e5):r.setHours(24)),"Hour"===e&&("prevTimeSpan"===t?0===i.getMinutes()?i.setTime(i.getTime()-36e5):i.setMinutes(0):0===r.getMinutes()?r.setTime(r.getTime()+36e5):r.setMinutes(60)),"Minutes"===e&&("prevTimeSpan"===t?0===i.getSeconds()?i.setTime(i.getTime()-6e4):i.setSeconds(0):0===r.getSeconds()?r.setTime(r.getTime()+6e4):r.setSeconds(60)),this.parent.cloneProjectStartDate=i,this.parent.cloneProjectEndDate=r},t.prototype.updateTimeLineOnEditing=function(t,i){if(t[0].length>=1)for(var a=0;a<t.length;a++){var n=t[parseInt(a.toString(),10)],s=n.filter((function(t){return!(0,e.isNullOrUndefined)(t.ganttProperties.startDate)})),o=n.filter((function(t){return!(0,e.isNullOrUndefined)(t.ganttProperties.endDate)})),l=s.length>0?new Date(r.DataUtil.aggregates.min(s,"ganttProperties.startDate")):null,d=s.length>0?new Date(r.DataUtil.aggregates.min(o,"ganttProperties.endDate")):null,h=o.length>0?new Date(r.DataUtil.aggregates.max(o,"ganttProperties.endDate")):null,p=new Date(this.parent.dataOperation.checkStartDate(this.timelineStartDate).getTime()),u=new Date(this.parent.dataOperation.checkEndDate(this.timelineEndDate).getTime()),c=(0,e.isNullOrUndefined)(l)?null:this.parent.dataOperation.getTaskLeft(l,!1),g=(0,e.isNullOrUndefined)(h)?null:this.parent.dataOperation.getTaskLeft(h,!1),f=this.parent.dataOperation.getTaskLeft(p,!1),m=this.parent.dataOperation.getTaskLeft(u,!1),y=void 0,D=this.parent.editModule.taskbarEditModule,v=s.length>0?new Date(r.DataUtil.aggregates.min(s,"ganttProperties.startDate")).setHours(0,0,0,0):null,k=new Date(this.timelineStartDate.getTime()).setHours(0,0,0,0);!(0,e.isNullOrUndefined)(c)&&!(0,e.isNullOrUndefined)(D)&&(D.taskBarEditAction&&"RightResizing"!==D.taskBarEditAction||(0,e.isNullOrUndefined)(D.taskBarEditAction))&&v<=k&&(c<this.bottomTierCellWidth||c<=f)?(y="prevTimeSpan",l=l>this.timelineStartDate?this.timelineStartDate:l):l=this.timelineStartDate,!(0,e.isNullOrUndefined)(g)&&g>=(this.parent.enableTimelineVirtualization?this.wholeTimelineWidth:this.totalTimelineWidth)-this.bottomTierCellWidth&&g>m?(y="prevTimeSpan"===y?"both":"nextTimeSpan",h=h<this.timelineEndDate?this.timelineEndDate:h):h=this.timelineEndDate,y?this.performTimeSpanAction(y,i,l,h):(0,e.isNullOrUndefined)(n[0].ganttProperties.segments)||this.parent.dataOperation.updateWidthLeft(n[0]),!(0,e.isNullOrUndefined)(l)&&!(0,e.isNullOrUndefined)(d)&&d<=l&&("CellEditing"===i||"DialogEditing"===i)&&this.parent.allowUnscheduledTasks?(l=new Date(Math.min(l.getTime(),d.getTime())),l=new Date(Math.min(l.getTime(),this.timelineStartDate.getTime())),this.performTimeSpanAction("prevTimeSpan",i,l,h)):(0,e.isNullOrUndefined)(d)&&d<=l&&("CellEditing"===i||"DialogEditing"===i)&&this.parent.allowUnscheduledTasks&&1===t[0].length&&!(0,e.isNullOrUndefined)(t[0][0].ganttProperties.endDate)&&(l=new Date(Math.min(t[0][0].ganttProperties.endDate.getTime(),l.getTime())),this.performTimeSpanAction("prevTimeSpan",i,l,h));break}},t.prototype.performTimeSpanAction=function(t,i,r,a,n){n=(0,e.isNullOrUndefined)(n)?"None"===this.parent.timelineModule.topTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier:n;var s=new Date(this.parent.cloneProjectStartDate.getTime()),o=new Date(this.parent.cloneProjectEndDate.getTime());"publicMethod"!==i&&"both"===t?(this.updateScheduleDatesByToolBar(n,"prevTimeSpan",r,a),this.updateScheduleDatesByToolBar(n,"nextTimeSpan",new Date(this.parent.cloneProjectStartDate.getTime()),a)):this.updateScheduleDatesByToolBar(n,t,r,a);var l=this.timeSpanActionEvent("actionBegin",t,i);if(l.cancel)this.parent.cloneProjectStartDate=s,this.parent.cloneProjectEndDate=o;else{this.restrictRender=!0,this.performedTimeSpanAction=!0;var d=this.parent.ganttChartModule.scrollElement.scrollLeft;if(this.parent.updateProjectDates(l.projectStartDate,l.ProjectEndDate,l.isTimelineRoundOff,i),"prevTimeSpan"===t&&"publicMethod"===i)this.parent.ganttChartModule.updateScrollLeft(0),this.parent.timelineModule.isZoomToFit=!1;else if("nextTimeSpan"===t&&"publicMethod"===i)this.parent.ganttChartModule.updateScrollLeft(this.parent.enableTimelineVirtualization?this.wholeTimelineWidth:this.totalTimelineWidth),this.parent.timelineModule.isZoomToFit=!1;else if("nextTimeSpan"===t&&"TaskbarEditing"===i){var h=document.getElementsByClassName("e-chart-scroll-container e-content")[0].scrollLeft;this.parent.element.querySelector(".e-timeline-header-container").scrollLeft=h,this.parent.timelineModule.isZoomToFit=!1}"TaskbarEditing"===i&&this.parent.enableTimelineVirtualization&&(this.wholeTimelineWidth>3*this.parent.element.offsetWidth||(0,e.isNullOrUndefined)(this.parent.projectStartDate)&&(0,e.isNullOrUndefined)(this.parent.projectEndDate))&&(this.parent.ganttChartModule.scrollObject.setScrollLeft(d),this.parent.ganttChartModule.scrollObject.updateContent()),this.parent.timelineModule.timeSpanActionEvent("actionComplete",t,i)}},t.prototype.timeSpanActionEvent=function(e,t,i){var r={};return r.projectStartDate=new Date(this.parent.cloneProjectStartDate.getTime()),r.ProjectEndDate=new Date(this.parent.cloneProjectEndDate.getTime()),r.requestType="publicMethod"===i?t:"beforeAdd"===i?"TimelineRefreshOnAdd":"TaskbarEditing"===i?"TimelineRefreshOnEdit":t,"actionBegin"===e&&(r.isTimelineRoundOff=this.parent.isTimelineRoundOff,r.cancel=!1),r.action="TimescaleUpdate",this.parent.trigger(e,r),r},t}(),_e=m(465),Ze=function(t){this.allowEditing=!0,this.allowReordering=!0,this.allowResizing=!0,this.allowSorting=!0,this.allowFiltering=!0,this.edit={},(0,e.merge)(this,t)},Xe=function(){function t(t){var i=this;this.isPersist=!1,this.previousScroll={top:0,left:0},this.queryCellInfo=function(e){i.parent.trigger("queryCellInfo",e)},this.headerCellInfo=function(e){i.parent.trigger("headerCellInfo",e)},this.rowDataBound=function(e){i.parent.trigger("rowDataBound",e)},this.columnMenuOpen=function(t){i.parent.notify("columnMenuOpen",t),i.parent.trigger("columnMenuOpen",t),document.querySelector(".e-colmenu").addEventListener("mousemove",(function(){var t=document.querySelector(".e-filter-popup"),r=document.querySelector(".e-filter-item");(0,e.isNullOrUndefined)(t)||r.classList.contains("e-focused")||(0,e.remove)(i.parent.filterModule.filterMenuElement)}))},this.columnMenuClick=function(e){i.parent.trigger("columnMenuClick",e)},this.objectEqualityChecker=function(e,t){if(e){for(var r=Object.keys(e),a=!0,n=["Children","childRecords","taskData","uniqueID","parentItem","parentUniqueID","ganttProperties"],s=0;s<r.length;s++){if((e[r[parseInt(s.toString(),10)]]instanceof Date?new Date(e[r[parseInt(s.toString(),10)]]).getTime():e[r[parseInt(s.toString(),10)]])!==(t[r[parseInt(s.toString(),10)]]instanceof Date?new Date(t[r[parseInt(s.toString(),10)]]).getTime():t[r[parseInt(s.toString(),10)]])&&-1===n.indexOf(r[s])){i.parent.modifiedRecords.push(t),a=!1;break}}return a}return!1},this.parent=t,this.parent.treeGrid=new _e.TreeGrid,this.parent.treeGrid.allowSelection=!1,this.parent.treeGrid.allowKeyboard=this.parent.allowKeyboard,this.parent.treeGrid["${enableHtmlSanitizer}"]=this.parent.enableHtmlSanitizer,this.parent.treeGrid.enableImmutableMode=this.parent.enableImmutableMode,this.treeGridColumns=[],!this.parent.isLocaleChanged&&this.parent.isLoad&&(this.parent.previousGanttColumns=(0,e.extend)([],[],this.parent.columns,!0)),this.validateGanttColumns(),this.parent.isLocaleChanged&&(this.parent.isLocaleChanged=!1),this.addEventListener()}return t.prototype.addEventListener=function(){this.parent.on("renderPanels",this.createContainer,this),this.parent.on("chartScroll",this.updateScrollTop,this),this.parent.on("destroy",this.destroy,this),this.parent.treeGrid.on("renderReactTemplate",this.renderReactTemplate,this)},t.prototype.renderReactTemplate=function(e){for(var t="portals",i=0,r=e;i<r.length;i++){var a=r[i];-1===this.parent[t].indexOf(a)&&this.parent[t].push(a)}this.parent.renderTemplates()},t.prototype.createContainer=function(){this.treeGridElement=(0,e.createElement)("div",{id:"treeGrid"+this.parent.element.id,className:"e-gantt-tree-grid"});var t=(0,e.createElement)("div",{className:"e-gantt-temp-header"});this.parent.treeGridPane.appendChild(this.treeGridElement),this.treeGridElement.appendChild(t),this.parent.treeGridPane.classList.add("e-temp-content")},t.prototype.renderTreeGrid=function(){this.composeProperties(),this.bindEvents();var t="root";this.parent.treeGrid[t]=this.parent[t]?this.parent[t]:this.parent,(0,e.setValue)("registeredTemplate",this.registeredTemplate,this.parent.treeGrid);(0,e.setValue)("viewContainerRef",this.parent.viewContainerRef,this.parent.treeGrid),this.parent.treeGrid.appendTo(this.treeGridElement),this.parent.treeGrid.grid&&this.parent.toolbarModule&&this.parent.isReact&&(this.parent.treeGrid.grid.portals=this.parent.portals),this.wireEvents()},t.prototype.composeProperties=function(){if(this.parent.treeGrid.enableAdaptiveUI=this.parent.enableAdaptiveUI,this.parent.treeGrid.hasChildMapping=this.parent.taskFields.hasChildMapping,this.parent.treeGrid.query=this.parent.query,this.parent.treeGrid.loadChildOnDemand=this.parent.loadChildOnDemand,this.parent.treeGrid.isFromGantt=!0,this.parent.treeGrid.parentIdMapping=this.parent.taskFields.parentID,this.parent.taskFields.parentID&&(this.parent.treeGrid.idMapping=this.parent.taskFields.id),this.parent.treeGrid.showColumnMenu=this.parent.showColumnMenu,this.parent.treeGrid.enableCollapseAll=this.parent.collapseAllParentTasks,this.parent.treeGrid.columnMenuItems=this.parent.columnMenuItems,this.parent.treeGrid.enableRtl=this.parent.enableRtl,this.parent.treeGrid.childMapping=(0,e.isNullOrUndefined)(this.parent.taskFields.child)?"":this.parent.taskFields.child,this.parent.treeGrid.treeColumnIndex=this.parent.treeColumnIndex,this.parent.treeGrid.columns=this.treeGridColumns,this.parent.treeGrid.loadingIndicator=this.parent.loadingIndicator,this.parent.treeGrid.enableVirtualMaskRow=this.parent.enableVirtualMaskRow,this.parent.dataSource instanceof Object&&s(this.parent)){this.parent.treeGrid.hasChildMapping="isParent";var t=(0,e.getValue)("count",this.parent.dataSource);this.parent.treeGrid.dataSource={result:this.parent.flatData,count:t}}else!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.treeGrid.dataSource=this.parent.dataSource:(this.parent.treeGrid.hasChildMapping=null,this.parent.treeGrid.dataSource=this.parent.flatData);this.parent.treeGrid.expandStateMapping=this.parent.taskFields.expandState;this.parent.treeGrid.isGantt=!0,this.parent.treeGrid.rowHeight=this.parent.rowHeight,this.parent.treeGrid.gridLines=this.parent.gridLines,0===this.parent.searchSettings.fields.length&&""===this.parent.searchSettings.key||(this.parent.treeGrid.searchSettings=this.parent.searchSettings);this.parent.treeGrid.isJsComponent=!0,this.parent.treeGrid.height=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].offsetHeight-(0===this.parent.flatData.length?0:19)},t.prototype.getContentDiv=function(){return this.treeGridElement.querySelector(".e-content")},t.prototype.getHeaderDiv=function(){return this.treeGridElement.querySelector(".e-headercontent")},t.prototype.getScrollbarWidth=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar";var t=document.createElement("div");e.appendChild(t),this.parent.element.appendChild(e);var i=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),i},t.prototype.ensureScrollBar=function(){var e=this.getContentDiv(),t=this.getHeaderDiv(),i=this.getScrollbarWidth(),r=/Android|Mac|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);0!==i?e.style.cssText+="width: calc(100% + "+(i+1)+"px);":e.classList.add("e-gantt-scroll-padding"),0===i&&r&&(t.style.cssText+="width: calc(100% + 17px);")},t.prototype.bindEvents=function(){this.parent.treeGrid.dataBound=this.dataBound.bind(this),this.parent.treeGrid.collapsing=this.collapsing.bind(this),this.parent.treeGrid.collapsed=this.collapsed.bind(this),this.parent.treeGrid.expanding=this.expanding.bind(this),this.parent.treeGrid.expanded=this.expanded.bind(this),this.parent.treeGrid.actionBegin=this.actionBegin.bind(this),this.parent.treeGrid.actionComplete=this.treeActionComplete.bind(this),this.parent.treeGrid.created=this.created.bind(this),this.parent.treeGrid.actionFailure=this.actionFailure.bind(this),this.parent.treeGrid.queryCellInfo=this.queryCellInfo.bind(this),this.parent.treeGrid.headerCellInfo=this.headerCellInfo.bind(this),this.parent.treeGrid.rowDataBound=this.rowDataBound.bind(this),this.parent.treeGrid.columnMenuOpen=this.columnMenuOpen.bind(this),this.parent.treeGrid.columnMenuClick=this.columnMenuClick.bind(this),this.parent.treeGrid.beforeDataBound=this.beforeDataBound.bind(this),this.parent.treeGrid.dataStateChange=this.dataStateChange.bind(this)},t.prototype.beforeDataBound=function(t){!(0,e.isNullOrUndefined)(this.parent.selectionModule)&&this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&this.parent.selectionModule.getSelectedRowIndexes().length>0&&"sorting"===t.actionArgs.requestType&&(this.isPersist=!0),this.parent.updatedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?(0,e.getValue)("virtualScrollModule.visualData",this.parent.treeGrid):(0,e.getValue)("result",t),this.parent.virtualScrollModule&&this.parent.enableVirtualization&&this.parent.updateContentHeight(t),(0,e.setValue)("contentModule.objectEqualityChecker",this.objectEqualityChecker,this.parent.treeGrid.grid)},t.prototype.dataBound=function(t){this.ensureScrollBar(),this.parent.treeDataBound(t),this.parent.isVirtualScroll&&((this.parent.enableVirtualMaskRow&&this.parent.enableVirtualization||this.parent.enableVirtualization&&!this.parent.enableVirtualMaskRow&&"Shimmer"===this.parent.loadingIndicator.indicatorType||"Shimmer"===this.parent.loadingIndicator.indicatorType)&&this.parent.hideMaskRow(),this.parent.isVirtualScroll=!1,(0,e.isNullOrUndefined)(this.parent.selectionModule)||(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()),this.prevCurrentView=(0,e.extend)([],[],this.parent.currentViewData,!0)},t.prototype.dataStateChange=function(t){t.action&&"refresh"===t.action.requestType&&(this.parent.treeGrid.dataSource={result:(0,e.getValue)("result",this.parent.treeGrid.dataSource),count:(0,e.getValue)("count",this.parent.treeGrid.dataSource)}),this.parent.trigger("dataStateChange",t)},t.prototype.collapsing=function(t){var i,r=(0,e.getValue)("data",t),a=r.length;if(!this.parent.ganttChartModule.isExpandCollapseFromChart)if((0,e.isNullOrUndefined)(a))i=this.createExpandCollapseArgs(t,null),this.parent.ganttChartModule.collapseGanttRow(i),(0,e.setValue)("cancel",(0,e.getValue)("cancel",i),t);else{for(var n=0;n<a;n++)i=this.createExpandCollapseArgs(t,r[n]),this.parent.ganttChartModule.collapseGanttRow(i);(0,e.setValue)("cancel",(0,e.getValue)("cancel",i),t)}},t.prototype.expanding=function(t){var i,r=(0,e.getValue)("data",t),a=r.length;if(!this.parent.ganttChartModule.isExpandCollapseFromChart)if((0,e.isNullOrUndefined)(a))i=this.createExpandCollapseArgs(t,null),this.parent.ganttChartModule.expandGanttRow(i),(0,e.setValue)("cancel",(0,e.getValue)("cancel",i),t);else{for(var n=0;n<a;n++)i=this.createExpandCollapseArgs(t,r[n]),this.parent.ganttChartModule.expandGanttRow(i);(0,e.setValue)("cancel",(0,e.getValue)("cancel",i),t)}},t.prototype.collapsed=function(t){if(!this.parent.ganttChartModule.isExpandCollapseFromChart&&!this.parent.isExpandCollapseLevelMethod){var i=void 0,r=(0,e.getValue)("data",t),a=r.length;if((0,e.isNullOrUndefined)(a))i=this.createExpandCollapseArgs(t,null),this.parent.ganttChartModule.collapsedGanttRow(i);else for(var n=0;n<a;n++)i=this.createExpandCollapseArgs(t,r[n]),this.parent.ganttChartModule.collapsedGanttRow(i);this.parent.allowTaskbarOverlap||this.parent.ganttChartModule.isCollapseAll||!i.gridRow||(i.gridRow.style.height=i.chartRow.style.height,this.parent.contentHeight=this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2].children[0].offsetHeight:this.parent.element.getElementsByClassName("e-content")[0].children[0].offsetHeight,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px")}(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.trigger("collapsed",t)},t.prototype.expanded=function(t){if(!this.parent.ganttChartModule.isExpandCollapseFromChart&&!this.parent.isExpandCollapseLevelMethod){var i=void 0,r=(0,e.getValue)("data",t),a=r.length;if((0,e.isNullOrUndefined)(a))i=this.createExpandCollapseArgs(t,null),this.parent.ganttChartModule.expandedGanttRow(i);else for(var n=0;n<a;n++)i=this.createExpandCollapseArgs(t,r[n]),this.parent.ganttChartModule.expandedGanttRow(i);this.parent.allowTaskbarOverlap||this.parent.ganttChartModule.isExpandAll||!t.row||(t.row.style.height=this.parent.rowHeight+"px",this.parent.contentHeight=this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2].children[0].offsetHeight:this.parent.element.getElementsByClassName("e-content")[0].children[0].offsetHeight,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px")}(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.isCollapseAll=!1,this.parent.trigger("expanded",t)},t.prototype.actionBegin=function(t){!this.parent.undoRedoModule||"filtering"!==t.requestType&&"searching"!==t.requestType&&"sorting"!==t.requestType&&"filterAfterOpen"!==t.requestType||(this.parent.undoRedoModule.canUpdateIndex=!1),this.parent.notify("actionBegin",t),null!==(0,e.getValue)("doubleClickTarget",this.parent.treeGrid.editModule)&&(0,e.setValue)("doubleClickTarget",null,this.parent.treeGrid.editModule),this.parent.trigger("actionBegin",t),"virtualscroll"===t.requestType||"edit"===t.type||"beginEdit"===t.requestType||t.cancel||((0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow())},t.prototype.created=function(e){this.updateKeyConfigSettings()},t.prototype.actionFailure=function(e){this.parent.trigger("actionFailure",e)},t.prototype.createExpandCollapseArgs=function(t,i){var r=(0,e.getValue)("data",t).length;if((0,e.isNullOrUndefined)(r)){var a=(0,e.getValue)("data",t);return{data:a,gridRow:(0,e.getValue)("row",t),chartRow:this.parent.ganttChartModule.getChartRows()[this.parent.currentViewData.indexOf(a)],cancel:!1}}return{data:i,gridRow:(0,e.getValue)("row",t),chartRow:this.parent.ganttChartModule.getChartRows()[this.parent.currentViewData.indexOf(i)],cancel:!1}},t.prototype.treeActionComplete=function(t){var i=this,r=(0,e.extend)({},t);"reorder"===(0,e.getValue)("requestType",t)&&(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isFromUndoRedo&&this.parent.isUndoRedoItemPresent("ColumnReorder")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(n={action:"ColumnReorder"}).fromIndex=(0,e.extend)([],[],[t.fromIndex],!0)[0],n.toIndex=(0,e.extend)([],[],[t.toIndex],!0)[0],n.toColumn=(0,e.extend)([],[],[this.parent.treeGrid.columns[t.toIndex].field],!0)[0],n.fromColumn=(0,e.extend)([],[],[this.parent.treeGrid.columns[t.fromIndex].field],!0)[0],this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=n));"columnstate"===(0,e.getValue)("requestType",t)&&(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isFromUndoRedo&&this.parent.isUndoRedoItemPresent("ColumnState")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(n={action:"ColumnState"}).showhideColumns=(0,e.extend)([],[],t.columns,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=n));if("sorting"===(0,e.getValue)("requestType",t)){if(this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Sorting")){if(this.parent.undoRedoModule.currentAction&&this.parent.undoRedoModule.currentAction.sortColumns.length>1&&this.parent.undoRedoModule.sortedColumnsLength++,!(this.parent.undoRedoModule.isFromUndoRedo||this.parent.undoRedoModule.currentAction&&this.parent.undoRedoModule.sortedColumnsLength===this.parent.undoRedoModule.currentAction.sortColumns.length))this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(n={action:"Sorting",sortColumns:[]}).sortColumns=this.parent.undoRedoModule.previousSortedColumns,this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=n;this.parent.undoRedoModule.previousSortedColumns=this.parent.treeGrid.sortSettings.columns}this.parent.notify("updateModel",{}),(0,e.deleteObject)(r,"isFrozen")}else if("filtering"===(0,e.getValue)("requestType",t)){if(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isFromUndoRedo&&this.parent.isUndoRedoItemPresent("Filtering"))this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(n={action:"Filtering"}).filteredColumns=(0,e.extend)([],[],t.columns,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=n;this.parent.notify("updateModel",{}),this.parent.element.querySelector(".e-treegrid").focus()}else if("save"===(0,e.getValue)("type",t)&&this.parent.editModule&&this.parent.editModule.cellEditModule){var a=(0,e.getValue)("data",t);(0,e.isNullOrUndefined)(a)||(0,e.isNullOrUndefined)(this.parent.getTaskByUniqueID(a.uniqueID))||(this.parent.getTaskByUniqueID(a.uniqueID).taskData[this.parent.taskFields.duration]=a.taskData[this.parent.taskFields.duration],(0,e.isNullOrUndefined)(a.taskData[this.parent.taskFields.resourceInfo])||(this.parent.getTaskByUniqueID(a.uniqueID).taskData[this.parent.taskFields.resourceInfo]=a.taskData[this.parent.taskFields.resourceInfo])),this.parent.editModule.cellEditModule.initiateCellEdit(t,this.currentEditRow),this.parent.editModule.cellEditModule.isCellEdit=!1,this.currentEditRow={}}if("filterAfterOpen"===(0,e.getValue)("requestType",t)&&this.parent.notify("actionComplete",t),"searching"===(0,e.getValue)("requestType",t)){if(this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Search")){var n;if(!this.parent.undoRedoModule.isFromUndoRedo)this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(n={action:"Search"}).searchString=this.parent.undoRedoModule.searchString,this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=n;this.parent.undoRedoModule.searchString=this.parent.treeGrid.searchSettings.key}this.parent.notify("actionComplete",t)}if((0,e.isNullOrUndefined)((0,e.getValue)("batchChanges",t))||(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(),this.parent.isCancelled&&((0,e.setValue)("requestType","cancel",r),(0,e.setValue)("action","CellEditing",r),this.parent.isCancelled=!1),"refresh"===(0,e.getValue)("requestType",t)&&(0,e.isNullOrUndefined)((0,e.getValue)("type",t))&&this.parent.addDeleteRecord){if(-1!==this.parent.selectedRowIndex)if(!(0,e.isNullOrUndefined)(this.parent.selectionModule)&&this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&this.parent.editModule.isAdded){var s=this.parent.selectionModule.selectedRowIndexes;if(s.length>1&&this.parent.selectionSettings.persistSelection)for(var o=0;o<s.length;o++){var l=this.parent.flatData[s[o].toString()];this.parent.selectRows(l)}}else this.parent.selectRow(this.parent.selectedRowIndex),this.parent.selectedRowIndex>this.parent.currentViewData.length-1&&(this.parent.selectedRowIndex=-1);else{if(!(0,e.isNullOrUndefined)(this.parent.selectionModule)&&this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&this.parent.editModule&&!this.parent.editModule.isAdded){var d=this.parent.selectionModule.getSelectedRecords(),h=function(e){var t=d[e][p.parent.taskFields.id];p.parent.editModule.deletedRecord.some((function(e){return e.ganttProperties.taskId===t}))&&d.splice(e,1)},p=this;for(o=d.length-1;o>=0;o--)h(o)}var u=0;this.parent.currentViewData.map((function(t,r){(0,e.isNullOrUndefined)(i.parent.currentSelection)||t.ganttProperties.taskId!==i.parent.currentSelection[i.parent.taskFields.id]||(u=r)})),this.addedRecord=!0,this.parent.selectRow((0,e.isNullOrUndefined)(u)?0:u)}this.parent.addDeleteRecord=!1}if(this.parent.undoRedoModule&&(this.parent.undoRedoModule.isFromUndoRedo=!1),this.parent.trigger("actionComplete",r),!this.parent.allowTaskbarOverlap&&this.parent.showOverAllocation){for(o=0;o<this.parent.currentViewData.length;o++)this.parent.currentViewData[o].hasChildRecords&&!this.parent.currentViewData[o].expanded&&this.parent.chartRowsModule.updateDragDropRecords(this.parent.currentViewData[o]);this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)}(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()},t.prototype.updateKeyConfigSettings=function(){delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.delete,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.insert,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.upArrow,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.downArrow,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.ctrlHome,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.ctrlEnd,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.enter,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.tab,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.shiftTab,delete this.parent.treeGrid.keyboardModule.keyConfigs.enter,delete this.parent.treeGrid.keyboardModule.keyConfigs.upArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.downArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlShiftUpArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlShiftDownArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlUpArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlDownArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.tab,delete this.parent.treeGrid.keyboardModule.keyConfigs.shiftTab},t.prototype.wireEvents=function(){var t=this.parent.treeGrid.element.querySelector(".e-content");t&&e.EventHandler.add(t,"scroll",this.scrollHandler,this),this.parent.isAdaptive&&e.EventHandler.add(this.parent.treeGridPane,"click",this.treeGridClickHandler,this)},t.prototype.unWireEvents=function(){var t=this.parent.treeGrid.element&&this.parent.treeGrid.element.querySelector(".e-content");t&&e.EventHandler.remove(t,"scroll",this.scrollHandler),this.parent.isAdaptive&&e.EventHandler.remove(this.parent.treeGridPane,"click",this.treeGridClickHandler)},t.prototype.scrollHandler=function(e){var t=this.parent.treeGrid.element.querySelector(".e-content");t.scrollTop!==this.previousScroll.top&&this.parent.notify("grid-scroll",{top:t.scrollTop}),this.previousScroll.top=t.scrollTop,this.parent.contextMenuModule&&this.parent.contextMenuModule.isOpen&&this.parent.contextMenuModule.contextMenu.close()},t.prototype.validateGanttColumns=function(){var t=this.parent,i=t.columns.length,r=this.parent.taskFields;this.parent.columnMapping={},this.parent.columnByField={},this.parent.customColumns=[];for(var a=["id","name","startDate","endDate","duration","dependency","progress","baselineStartDate","baselineEndDate","resourceInfo","notes","work","manual","type","milestone","segments"],n=function(e){var i={};"string"==typeof t.columns[e]?i.field=t.columns[e]:i=t.columns[e];var n=[];if(a.length>0&&(n=a.filter((function(e){return i.field===r[e]}))),0===n.length)return i.field===s.parent.resourceFields.group||(s.parent.customColumns.push(i.field),i.headerText=i.headerText?i.headerText:i.field,i.width=i.width?i.width:150,i.editType=i.editType?i.editType:"stringedit",i.type=i.type?i.type:"string",s.bindTreeGridColumnProperties(i,!0)),"continue";var o=a.indexOf(n[0]);a.splice(o,1),s.createTreeGridColumn(i,!0),s.parent.columnMapping[n[0]]=i.field},s=this,o=0;o<i;o++)n(o);for(var l=0;l<a.length;l++){var d={};(0,e.isNullOrUndefined)(r[a[l]])||(d.field=r[a[l]],this.createTreeGridColumn(d,0===i),this.parent.columnMapping[a[l]]=d.field)}if("ProjectView"!==this.parent.viewType){d={};this.composeUniqueIDColumn(d),this.createTreeGridColumn(d,!0)}},t.prototype.createTreeGridColumn=function(t,i){var a=this.parent.taskFields,n=this.parent.previousGanttColumns.filter((function(e){return t.field===e.field}))[0];if(t.disableHtmlEncode=(0,e.isNullOrUndefined)(t.disableHtmlEncode)?this.parent.disableHtmlEncode:t.disableHtmlEncode,a.id!==t.field&&(t.clipMode=t.clipMode?t.clipMode:"EllipsisWithTooltip"),a.id===t.field)this.composeIDColumn(t);else if(a.name===t.field)this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("name"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("name"),t.width=t.width?t.width:150,t.editType=t.editType?t.editType:"stringedit",t.type=t.type?t.type:"string";else if(a.startDate===t.field)this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("startDate"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("startDate"),t.editType=t.editType?t.editType:-1!==this.parent.getDateFormat().toLowerCase().indexOf("hh")?"datetimepickeredit":"datepickeredit",t.format=t.format?t.format:{type:"date",format:this.parent.getDateFormat()},t.width=t.width?t.width:150,t.edit&&t.edit.params?t.edit.params.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent):t.edit?t.edit.params={renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}:t.edit={params:{renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}};else if(a.endDate===t.field)this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("endDate"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("endDate"),t.format=t.format?t.format:{type:"date",format:this.parent.getDateFormat()},t.editType=t.editType?t.editType:-1!==this.parent.getDateFormat().toLowerCase().indexOf("hh")?"datetimepickeredit":"datepickeredit",t.width=t.width?t.width:150,t.edit&&t.edit.params?t.edit.params.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent):t.edit?t.edit.params={renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}:t.edit={params:{renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}};else if(a.duration===t.field)t.width=t.width?t.width:150,this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("duration"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("duration"),t.valueAccessor=t.valueAccessor?t.valueAccessor:(0,e.isNullOrUndefined)(t.edit)||(0,e.isNullOrUndefined)(t.edit.read)?this.durationValueAccessor.bind(this):null,t.editType=t.editType?t.editType:"stringedit",t.type=t.type?t.type:"string";else if(a.progress===t.field)this.composeProgressColumn(t);else if(a.dependency===t.field)this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("dependency"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("dependency"),t.width=t.width?t.width:150,t.editType=t.editType?t.editType:"stringedit",t.type="string",t.allowFiltering=!1!==t.allowFiltering,t.valueAccessor=t.valueAccessor?t.valueAccessor:this.dependencyValueAccessor.bind(this);else if(a.resourceInfo===t.field)this.composeResourceColumn(t);else if(a.notes===t.field)this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("notes"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("notes"),t.width=t.width?t.width:150,t.editType=t.editType?t.editType:"stringedit",this.parent.showInlineNotes||t.template||(t.template='<div class="e-ganttnotes-info"><span class="e-icons e-notes-info"></span></div>');else if(a.baselineStartDate===t.field||a.baselineEndDate===t.field){var s=a.baselineEndDate===t.field?"baselineEndDate":"baselineStartDate";t.width=t.width?t.width:150,this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant(s):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant(s),t.format=t.format?t.format:{type:"date",format:this.parent.getDateFormat()},t.editType=t.editType?t.editType:-1!==this.parent.getDateFormat().toLowerCase().indexOf("hh")?"datetimepickeredit":"datepickeredit"}else a.work===t.field?(this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("work"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("work"),t.width=t.width?t.width:150,t.valueAccessor=t.valueAccessor?t.valueAccessor:this.workValueAccessor.bind(this),t.editType=t.editType?t.editType:"numericedit"):a.type===t.field?(this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("taskType"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("taskType"),t.width=t.width?t.width:150,t.editType="dropdownedit",t.valueAccessor=t.valueAccessor?t.valueAccessor:this.taskTypeValueAccessor.bind(this)):a.manual===t.field&&"Custom"===this.parent.taskMode&&(this.parent.isLocaleChanged&&n?t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("taskMode"):t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("taskMode"),t.width=t.width?t.width:120,t.editType=t.editType?t.editType:"dropdownedit",t.valueAccessor=t.valueAccessor?t.valueAccessor:this.modeValueAccessor.bind(this),t.edit={params:{query:new r.Query,dataSource:[{id:1,text:this.parent.localeObj.getConstant("manual"),value:!0},{id:2,text:this.parent.localeObj.getConstant("auto"),value:!1}],fields:{text:"text",value:"value"}}});this.bindTreeGridColumnProperties(t,i)},t.prototype.composeResourceColumn=function(e){var t=this.parent.previousGanttColumns.filter((function(t){return e.field===t.field}))[0];this.parent.isLocaleChanged&&t?e.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("resourceName"):e.headerText=e.headerText?e.headerText:this.parent.localeObj.getConstant("resourceName"),e.width=e.width?e.width:150,e.type="string",e.valueAccessor=e.valueAccessor?e.valueAccessor:this.resourceValueAccessor.bind(this),e.allowFiltering=!1!==e.allowFiltering},t.prototype.getResourceIds=function(t){var i=(0,e.getValue)(this.parent.taskFields.resourceInfo,t.taskData),r=[];if((0,e.isNullOrUndefined)(i))return i;for(var a=0;a<i.length;a++)r.push("object"==typeof i[a]?i[a][this.parent.resourceFields.id]:i[a]);return r},t.prototype.composeIDColumn=function(t){var i,r="ProjectView"===this.parent.viewType,a=this.parent.dataSource?this.parent.dataSource.length:0;if(t.isPrimaryKey=!!r,this.parent.isLocaleChanged){var n=this.parent.previousGanttColumns.filter((function(e){return t.field===e.field}))[0];n&&(t.headerText=n.headerText?n.headerText:this.parent.localeObj.getConstant("id"))}else t.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("id");t.width=t.width?t.width:100;for(var s=0;s<a;s++)if(!(0,e.isNullOrUndefined)(this.parent.dataSource[s][this.parent.taskFields.id])){i=this.parent.dataSource[s][this.parent.taskFields.id];break}"string"==typeof i||(0,e.isNullOrUndefined)(i)?("ResourceView"===this.parent.viewType?t.allowEditing=!!t.allowEditing&&t.allowEditing:t.allowEditing=!t.allowEditing||t.allowEditing,t.editType=t.editType?t.editType:"stringedit"):(t.allowEditing=!!t.allowEditing&&t.allowEditing,t.editType=t.editType?t.editType:"numericedit"),t.valueAccessor=r?null:this.idValueAccessor.bind(this)},t.prototype.composeUniqueIDColumn=function(e){e.field="rowUniqueID",e.isPrimaryKey=!0,e.headerText="UniqueID",e.allowEditing=!1,e.visible=!1},t.prototype.composeProgressColumn=function(e){var t=this.parent.previousGanttColumns.filter((function(t){return e.field===t.field}))[0];this.parent.isLocaleChanged&&t?e.headerText=t.headerText?t.headerText:this.parent.localeObj.getConstant("progress"):e.headerText=e.headerText?e.headerText:this.parent.localeObj.getConstant("progress"),e.width=e.width?e.width:150,e.editType=e.editType?e.editType:"numericedit"},t.prototype.bindTreeGridColumnProperties=function(e,t){for(var i={},r={},a=0,n=Object.keys(e);a<n.length;a++){var s=n[a];i[s]=r[s]=e[s]}this.parent.columnByField[r.field]=r,this.parent.ganttColumns.push(new Ze(r)),t&&this.treeGridColumns.push(i)},t.prototype.durationValueAccessor=function(t,i,r){if(!(0,e.isNullOrUndefined)(i)&&!(0,e.isNullOrUndefined)(i.ganttProperties)){var a=i.ganttProperties;return this.parent.dataOperation.getDurationString(a.duration,a.durationUnit)}return!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.dataOperation.getDurationString(parseInt(i[this.parent.taskFields.duration],10),this.parent.durationUnit):""},t.prototype.dependencyValueAccessor=function(t,i,r){var a=this;if(i&&i.ganttProperties&&!(0,e.isNullOrUndefined)(i.ganttProperties.predecessorsName)){var n="",s=i.ganttProperties.predecessorsName.split(",");return s.map((function(e,t){e.includes("FS")?(n+=e.replace("FS",a.parent.localeObj.getConstant("FS")),n+=s.length!==t+1?",":""):e.includes("FF")?(n+=e.replace("FF",a.parent.localeObj.getConstant("FF")),n+=s.length!==t+1?",":""):e.includes("SS")?(n+=e.replace("SS",a.parent.localeObj.getConstant("SS")),n+=s.length!==t+1?",":""):e.includes("SF")&&(n+=e.replace("SF",a.parent.localeObj.getConstant("SF")),n+=s.length!==t+1?",":"")})),n}return""},t.prototype.resourceValueAccessor=function(t,i,r){var a=i.ganttProperties;return(0,e.isNullOrUndefined)(a)?"":a.resourceNames},t.prototype.workValueAccessor=function(t,i,r){var a=i.ganttProperties;return(0,e.isNullOrUndefined)(a)?"":this.parent.dataOperation.getWorkString(a.work,a.workUnit)},t.prototype.taskTypeValueAccessor=function(t,i,r){var a=i.ganttProperties;return(0,e.isNullOrUndefined)(a)?"":a.taskType},t.prototype.modeValueAccessor=function(e,t,i){return t[e]?"Manual":"Auto"},t.prototype.idValueAccessor=function(e,t,i){return 0===t.level?"R-"+t.ganttProperties.taskId:"T-"+t.ganttProperties.taskId},t.prototype.updateScrollTop=function(t){var i=(0,e.getValue)("top",t);this.treeGridElement.querySelector(".e-content").scrollTop=i,this.previousScroll.top=this.treeGridElement.querySelector(".e-content").scrollTop},t.prototype.treeGridClickHandler=function(e){this.parent.notify("treeGridClick",e)},t.prototype.removeEventListener=function(){this.parent.off("renderPanels",this.createContainer),this.parent.off("chartScroll",this.updateScrollTop),this.parent.off("destroy",this.destroy),this.parent.treeGrid.off("reactTemplateRender",this.renderReactTemplate)},t.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents(),this.parent.treeGrid.element&&this.parent.treeGrid.destroy()},t}(),Ye=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Qe=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Ke=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ye(i,t),Qe([(0,e.Property)(null)],i.prototype,"from",void 0),Qe([(0,e.Property)(null)],i.prototype,"to",void 0),i}(e.ChildProperty),Je=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),$e=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},et=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Je(i,t),$e([(0,e.Property)(null)],i.prototype,"type",void 0),$e([(0,e.Property)(null)],i.prototype,"headerText",void 0),$e([(0,e.Property)([])],i.prototype,"fields",void 0),$e([(0,e.Property)({})],i.prototype,"additionalParams",void 0),i}(e.ChildProperty),tt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),it=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},rt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return tt(i,t),it([(0,e.Property)(null)],i.prototype,"type",void 0),it([(0,e.Property)(null)],i.prototype,"headerText",void 0),it([(0,e.Property)([])],i.prototype,"fields",void 0),it([(0,e.Property)({})],i.prototype,"additionalParams",void 0),i}(e.ChildProperty),at=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),nt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},st=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return at(i,t),nt([(0,e.Property)(!1)],i.prototype,"allowEditing",void 0),nt([(0,e.Property)(!1)],i.prototype,"allowAdding",void 0),nt([(0,e.Property)(!1)],i.prototype,"allowDeleting",void 0),nt([(0,e.Property)("Auto")],i.prototype,"mode",void 0),nt([(0,e.Property)("Top")],i.prototype,"newRowPosition",void 0),nt([(0,e.Property)(!1)],i.prototype,"showDeleteConfirmDialog",void 0),nt([(0,e.Property)(!1)],i.prototype,"allowTaskbarEditing",void 0),nt([(0,e.Property)(!1)],i.prototype,"allowNextRowEdit",void 0),i}(e.ChildProperty),ot=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),lt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},dt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ot(i,t),lt([(0,e.Property)(null)],i.prototype,"day",void 0),lt([(0,e.Property)(null)],i.prototype,"label",void 0),lt([(0,e.Property)(null)],i.prototype,"cssClass",void 0),i}(e.ChildProperty),ht=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),pt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},ut=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return ht(r,t),pt([(0,e.Collection)([],i.Predicate)],r.prototype,"columns",void 0),pt([(0,e.Property)("Menu")],r.prototype,"type",void 0),pt([(0,e.Property)()],r.prototype,"operators",void 0),pt([(0,e.Property)(!1)],r.prototype,"ignoreAccent",void 0),pt([(0,e.Property)("Parent")],r.prototype,"hierarchyMode",void 0),r}(e.ChildProperty),ct=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),gt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},ft=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ct(i,t),gt([(0,e.Property)([])],i.prototype,"fields",void 0),gt([(0,e.Property)(!1)],i.prototype,"ignoreCase",void 0),gt([(0,e.Property)("contains")],i.prototype,"operator",void 0),gt([(0,e.Property)("")],i.prototype,"key",void 0),gt([(0,e.Property)("Parent")],i.prototype,"hierarchyMode",void 0),i}(e.ChildProperty),mt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),yt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Dt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return mt(i,t),yt([(0,e.Property)(null)],i.prototype,"from",void 0),yt([(0,e.Property)(null)],i.prototype,"to",void 0),yt([(0,e.Property)(null)],i.prototype,"label",void 0),yt([(0,e.Property)(null)],i.prototype,"cssClass",void 0),i}(e.ChildProperty),vt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),kt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},wt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return vt(i,t),kt([(0,e.Property)(null)],i.prototype,"rightLabel",void 0),kt([(0,e.Property)(null)],i.prototype,"leftLabel",void 0),kt([(0,e.Property)(null)],i.prototype,"taskLabel",void 0),i}(e.ChildProperty),bt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Tt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Pt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return bt(i,t),Tt([(0,e.Property)("Row")],i.prototype,"mode",void 0),Tt([(0,e.Property)("Flow")],i.prototype,"cellSelectionMode",void 0),Tt([(0,e.Property)("Single")],i.prototype,"type",void 0),Tt([(0,e.Property)(!1)],i.prototype,"persistSelection",void 0),Tt([(0,e.Property)(!1)],i.prototype,"enableToggle",void 0),i}(e.ChildProperty),St=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ct=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Rt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return St(i,t),Ct([(0,e.Property)(null)],i.prototype,"position",void 0),Ct([(0,e.Property)(-1)],i.prototype,"columnIndex",void 0),Ct([(0,e.Property)(4)],i.prototype,"separatorSize",void 0),Ct([(0,e.Property)(null)],i.prototype,"minimum",void 0),Ct([(0,e.Property)("Default")],i.prototype,"view",void 0),i}(e.ChildProperty),Mt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),xt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Ot=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Mt(i,t),xt([(0,e.Property)(null)],i.prototype,"id",void 0),xt([(0,e.Property)(null)],i.prototype,"name",void 0),xt([(0,e.Property)(null)],i.prototype,"parentID",void 0),xt([(0,e.Property)(null)],i.prototype,"hasChildMapping",void 0),xt([(0,e.Property)(null)],i.prototype,"startDate",void 0),xt([(0,e.Property)(null)],i.prototype,"endDate",void 0),xt([(0,e.Property)(null)],i.prototype,"dependency",void 0),xt([(0,e.Property)(null)],i.prototype,"progress",void 0),xt([(0,e.Property)(null)],i.prototype,"child",void 0),xt([(0,e.Property)(null)],i.prototype,"milestone",void 0),xt([(0,e.Property)(null)],i.prototype,"duration",void 0),xt([(0,e.Property)(null)],i.prototype,"durationUnit",void 0),xt([(0,e.Property)(null)],i.prototype,"cssClass",void 0),xt([(0,e.Property)(null)],i.prototype,"baselineStartDate",void 0),xt([(0,e.Property)(null)],i.prototype,"baselineEndDate",void 0),xt([(0,e.Property)(null)],i.prototype,"resourceInfo",void 0),xt([(0,e.Property)(null)],i.prototype,"expandState",void 0),xt([(0,e.Property)(null)],i.prototype,"indicators",void 0),xt([(0,e.Property)(null)],i.prototype,"notes",void 0),xt([(0,e.Property)(null)],i.prototype,"work",void 0),xt([(0,e.Property)(null)],i.prototype,"manual",void 0),xt([(0,e.Property)(null)],i.prototype,"type",void 0),xt([(0,e.Property)(null)],i.prototype,"segments",void 0),xt([(0,e.Property)(null)],i.prototype,"segmentId",void 0),i}(e.ChildProperty),It=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Et=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Ft=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return It(i,t),Et([(0,e.Property)("")],i.prototype,"format",void 0),Et([(0,e.Property)("None")],i.prototype,"unit",void 0),Et([(0,e.Property)(1)],i.prototype,"count",void 0),Et([(0,e.Property)(null)],i.prototype,"formatter",void 0),i}(e.ChildProperty),Ut=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return It(i,t),Et([(0,e.Property)("Week")],i.prototype,"timelineViewMode",void 0),Et([(0,e.Complex)({},Ft)],i.prototype,"topTier",void 0),Et([(0,e.Complex)({},Ft)],i.prototype,"bottomTier",void 0),Et([(0,e.Property)(33)],i.prototype,"timelineUnitSize",void 0),Et([(0,e.Property)(0)],i.prototype,"weekStartDay",void 0),Et([(0,e.Property)(null)],i.prototype,"weekendBackground",void 0),Et([(0,e.Property)(!0)],i.prototype,"showTooltip",void 0),Et([(0,e.Property)(!0)],i.prototype,"updateTimescaleView",void 0),i}(e.ChildProperty),Nt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Lt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Vt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Nt(i,t),Lt([(0,e.Property)(!0)],i.prototype,"showTooltip",void 0),Lt([(0,e.Property)()],i.prototype,"taskbar",void 0),Lt([(0,e.Property)()],i.prototype,"baseline",void 0),Lt([(0,e.Property)()],i.prototype,"connectorLine",void 0),Lt([(0,e.Property)()],i.prototype,"editing",void 0),i}(e.ChildProperty),Bt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),At=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Wt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Bt(i,t),At([(0,e.Property)()],i.prototype,"field",void 0),At([(0,e.Property)()],i.prototype,"direction",void 0),i}(e.ChildProperty),Ht=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Bt(i,t),At([(0,e.Collection)([],Wt)],i.prototype,"columns",void 0),At([(0,e.Property)(!0)],i.prototype,"allowUnsort",void 0),i}(e.ChildProperty),jt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Gt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},zt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return jt(i,t),Gt([(0,e.Property)(null)],i.prototype,"id",void 0),Gt([(0,e.Property)(null)],i.prototype,"name",void 0),Gt([(0,e.Property)(null)],i.prototype,"unit",void 0),Gt([(0,e.Property)(null)],i.prototype,"group",void 0),i}(e.ChildProperty),qt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),_t=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Zt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return qt(i,t),_t([(0,e.Property)("Spinner")],i.prototype,"indicatorType",void 0),i}(e.ChildProperty),Xt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Yt=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Qt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Xt(i,t),Yt([(0,e.Property)()],i.prototype,"dayOfWeek",void 0),Yt([(0,e.Collection)([],Ke)],i.prototype,"timeRange",void 0),i}(e.ChildProperty),Kt=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Jt=function(t){function i(e){var i=t.call(this,e)||this;return i.taskBarHeight=0,i.milestoneHeight=0,i.milesStoneRadius=0,i.baselineTop=0,i.baselineHeight=8,i.touchLeftConnectorpoint="",i.touchRightConnectorpoint="",i.dropSplit=!1,i.refreshedTr=[],i.refreshedData=[],i.isUpdated=!0,i.taskBaselineTemplateNode=null,i.parent=e,i.initPublicProp(),i.addEventListener(),i}return Kt(i,t),i.prototype.initPublicProp=function(){this.ganttChartTableBody=null},i.prototype.addEventListener=function(){this.parent.on("renderPanels",this.createChartTable,this),this.parent.on("dataReady",this.initiateTemplates,this),this.parent.on("destroy",this.destroy,this)},i.prototype.refreshChartByTimeline=function(){this.taskTable.style.width=(0,e.formatUnit)(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth);var t=(0,e.getValue)("prevProjectStartDate",this.parent.dataOperation),i=!1;t&&(i=t.getTime()===this.parent.cloneProjectStartDate.getTime()),this.isUpdated=!!(this.parent.isFromOnPropertyChange&&i&&(0,e.getValue)("mutableData",this.parent.treeGrid.grid.contentModule)),this.refreshGanttRows(),this.isUpdated=!0},i.prototype.createChartTable=function(){this.taskTable=(0,e.createElement)("table",{className:"e-task-table e-zero-spacing",id:"GanttTaskTable"+this.parent.element.id,styles:"position: absolute;width:"+(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth)+"px;",attrs:{cellspacing:"0.25px"}});var t=(0,e.createElement)("colgroup"),i=(0,e.createElement)("col",{styles:"width:"+this.parent.timelineModule.totalTimelineWidth+"px;"});t.appendChild(i),this.taskTable.appendChild(t),this.ganttChartTableBody=(0,e.createElement)("tbody",{id:this.parent.element.id+"GanttTaskTableBody"}),this.taskTable.appendChild(this.ganttChartTableBody),this.parent.ganttChartModule.chartBodyContent.appendChild(this.taskTable)},i.prototype.initiateTemplates=function(){this.taskTable.style.width=(0,e.formatUnit)(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth),this.initChartHelperPrivateVariable(),this.initializeChartTemplate()},i.prototype.renderChartRows=function(){this.createTaskbarTemplate(),this.parent.isGanttChartRendered=!0},i.prototype.getIndicatorNode=function(e){var t='<label class="'+fe+' e-indicator-span"style="line-height:'+this.parent.rowHeight+"px;"+(this.parent.enableRtl?"right:":"left:")+this.getIndicatorleft(e.date)+'px;"><i class="'+e.iconClass+'"></i> </label>';return this.createDivElement(t)},i.prototype.getIndicatorleft=function(e){return e=this.parent.dateValidationModule.getDateFromFormat(e),this.parent.dataOperation.getTaskLeft(e,!1)},i.prototype.getChildTaskbarNode=function(t,i){var r,a=null,n=this.templateData;if(r=this.parent.enableRtl?"right:":"left:",this.childTaskbarTemplateFunction)a=this.childTaskbarTemplateFunction((0,e.extend)({index:t},n),this.parent,"TaskbarTemplate",this.getTemplateID("TaskbarTemplate"),!1,void 0,i[0],this.parent.treeGrid.root);else{var s="",o="",l=void 0,d=void 0;n.ganttProperties.startDate&&n.ganttProperties.endDate&&n.ganttProperties.duration&&(l=this.createDivElement('<div class="'+A+" "+ie+" "+(n.ganttProperties.isAutoSchedule?"":oe)+'"style="width:'+n.ganttProperties.width+"px;height:"+this.taskBarHeight+'px; margin-top :-1px"></div>'),d=this.createDivElement('<div class="'+W+" "+re+" "+(n.ganttProperties.isAutoSchedule?"":"e-gantt-child-manualprogressbar")+'" style="border-style:'+(n.ganttProperties.progressWidth?"solid;":"none;")+"width:"+n.ganttProperties.progressWidth+"px;height:100%;border-top-right-radius:"+this.getBorderRadius(n.ganttProperties)+"px;border-bottom-right-radius:"+this.getBorderRadius(n.ganttProperties)+'px;"></div>'));var h=(0,e.createElement)("div");if(this.taskLabelTemplateFunction&&!(0,e.isNullOrUndefined)(d)&&d.length>0){var p=this.taskLabelTemplateFunction((0,e.extend)({index:t},n),this.parent,"TaskLabelTemplate",this.getTemplateID("TaskLabelTemplate"),!1,void 0,d[0]);p&&p.length>0&&((0,e.append)(p,h),s=h.innerHTML)}else{var u=this.parent.labelSettings.taskLabel;s="isCustomTemplate"===(s=this.getTaskLabel(u))?this.parent.labelSettings.taskLabel:s,this.parent.enableHtmlSanitizer&&"string"==typeof s&&(s=e.SanitizeHtmlHelper.sanitize(s))}-1===s.indexOf("null")&&("isCustomTemplate"!==this.getTaskLabel(this.parent.labelSettings.taskLabel)||this.isTemplate(this.parent.labelSettings.taskLabel)||(s=""),o=isNaN(parseInt(s,10))?'<span class="'+B+'" style="line-height:'+(this.taskBarHeight-1)+"px; text-align:"+(this.parent.enableRtl?"right;":"left;")+"display:inline-block;width:"+(n.ganttProperties.width-10)+"px; height:"+this.taskBarHeight+'px;"></span>':'<span class="'+B+'" style="line-height:'+(this.taskBarHeight-1)+"px;"+("ResourceView"===this.parent.viewType?"text-align:"+(this.parent.enableRtl?"right;":"left;"):"")+ +("ResourceView"===this.parent.viewType?"display:inline-flex;":"")+ +("ResourceView"===this.parent.viewType?n.ganttProperties.width-10:"")+"px; height:"+this.taskBarHeight+'px;"></span>');var c=!(0,e.isNullOrUndefined)(n.ganttProperties.segments)&&n.ganttProperties.segments.length>0?this.splitTaskbar(n,s):n.ganttProperties.startDate&&n.ganttProperties.endDate&&n.ganttProperties.duration?o:!n.ganttProperties.startDate||n.ganttProperties.endDate||n.ganttProperties.duration?!n.ganttProperties.endDate||n.ganttProperties.startDate||n.ganttProperties.duration?!n.ganttProperties.duration||n.ganttProperties.startDate||n.ganttProperties.endDate?"":'<div class="'+W+" "+ie+" e-gantt-unscheduled-taskbar "+(n.ganttProperties.isAutoSchedule?"":oe)+'"style="'+r+n.ganttProperties.left+"px; width:"+n.ganttProperties.width+"px; height:"+this.taskBarHeight+'px;"></div>':'<div class="'+W+" "+ie+" "+De+" "+(n.ganttProperties.isAutoSchedule?"":oe)+'"style="'+r+n.ganttProperties.left+"px; height:"+this.taskBarHeight+'px;"></div>':'<div class="'+W+" "+ie+" "+ye+" "+(n.ganttProperties.isAutoSchedule?"":oe)+'"style="'+r+n.ganttProperties.left+"px; height:"+this.taskBarHeight+'px;"></div>';if(n.ganttProperties.startDate&&n.ganttProperties.endDate&&n.ganttProperties.duration&&((0,e.isNullOrUndefined)(n.ganttProperties.segments)||!(0,e.isNullOrUndefined)(n.ganttProperties.segments)&&0===n.ganttProperties.segments.length)){if(""!==c&&!(0,e.isNullOrUndefined)(d)&&d.length>0){var g=this.createDivElement(c)[0];this.parent.disableHtmlEncode?g.innerText=s:g.innerHTML=s;var f=this.parent.labelSettings.taskLabel;f&&f.elementRef&&g.appendChild(h),d[0].appendChild(g),""!==d[0].querySelectorAll(".e-task-label")[0].textContent&&!this.isTemplate(f)&&d[0].querySelectorAll(".e-task-label")[0].children[0]&&d[0].querySelectorAll(".e-task-label")[0].children[0].remove(),""===d[0].querySelectorAll(".e-task-label")[0].textContent&&f&&!f.elementRef&&""!==h.innerHTML&&(d[0].querySelectorAll(".e-task-label")[0].textContent=f)}!(0,e.isNullOrUndefined)(l)&&l.length>0&&l[0].appendChild([].slice.call(d)[0]),a=l}else a=this.createDivElement(c)}return this.parent.enableRtl&&!(0,e.isNullOrUndefined)(a)&&a[0]&&a[0].querySelector(".e-task-label")&&(a[0].querySelector(".e-task-label").style.marginLeft="15px",a[0].querySelector(".e-task-label").style.marginRight="8px",a[0].querySelector(".e-gantt-child-progressbar")&&(a[0].querySelector(".e-gantt-child-progressbar").style.textAlign="left")),a},i.prototype.splitTaskbar=function(e,t){for(var i="",r=0;r<e.ganttProperties.segments.length;r++){var a=e.ganttProperties.segments[r],n=void 0;n=a.showProgress?"initial":"hidden";var s=0===r?"e-segment-first":r===e.ganttProperties.segments.length-1?"e-segment-last":"e-segment-inprogress";i+='<div class="'+A+" "+s+" "+ie+'  e-segmented-taskbar"style="width:'+a.width+"px;position: absolute;"+(this.parent.enableRtl?"right:":"left:")+a.left+"px;height:"+this.taskBarHeight+"px; overflow:"+n+';" data-segment-index = "'+r+'" aria-label = "'+this.generateSpiltTaskAriaLabel(a,e.ganttProperties)+'"> '+this.getSplitTaskbarLeftResizerNode()+'<div class="'+W+" "+re+' " style="border-style:'+(a.progressWidth?"solid;":"none;")+"display:"+(a.progressWidth>=0?"block;":"none;")+"width:"+a.progressWidth+"px;height:100%;text-align:"+(this.parent.enableRtl?"left;":"right;")+"border-top-right-radius:"+this.getSplitTaskBorderRadius(a)+"px;border-bottom-right-radius:"+this.getSplitTaskBorderRadius(a)+'px;"><span class="'+B+'" style="line-height:'+(this.taskBarHeight-1)+"px;display:"+(a.showProgress?"inline;":"none;")+"height:"+this.taskBarHeight+'px;">'+t+"</span></div>"+this.getSplitTaskbarRightResizerNode(a)+(a.showProgress?this.getSplitProgressResizerNode(a):"")+"</div></div>"}return i},i.prototype.getSplitTaskbarLeftResizerNode=function(){var t=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?5:-2;return'<div class="'+X+" "+ee+'" style="'+(this.parent.enableRtl?"right:":"left:")+t+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>'},i.prototype.getSplitTaskbarRightResizerNode=function(t){var i=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?-17:-10;return'<div class="'+Y+" "+ee+'" style="'+(this.parent.enableRtl?"right:":"left:")+(t.width+i)+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>'},i.prototype.getSplitProgressResizerNode=function(e){var t=this.parent.enableRtl?e.progressWidth+8:e.progressWidth-6;return'<div class="'+Q+'" style="'+(this.parent.enableRtl?"right:":"left:")+t+"px;margin-top:"+(this.taskBarHeight-4)+'px;"><div class="'+K+'"><div class="'+J+'"></div><div class="'+$+'"></div></div>'},i.prototype.getSegmentIndex=function(t,i){var r=-1,a=i.ganttProperties,n=a.segments;if(!(0,e.isNullOrUndefined)(n)){n.sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}));for(var s=n.length,o=0;o<s;o++){var l=n[o];if(t.getTime()===a.startDate.getTime())this.dropSplit=!0,r=0;else if(t.getTime()===l.startDate.getTime()){this.dropSplit=!0;var d=l.startDate;d.setDate(d.getDate()+1),d=l.startDate=this.parent.dataOperation.checkStartDate(d,a,!1),l.startDate=d;var h=l.endDate;h=this.parent.dataOperation.getEndDate(d,l.duration,a.durationUnit,a,!1),l.endDate=h,o===n.length-1&&this.parent.setRecordValue("endDate",h,a,!0),this.incrementSegments(n,o,i),r=l.segmentIndex}else l.endDate=this.parent.dataOperation.getEndDate(l.startDate,l.duration,a.durationUnit,a,!1),t.getTime()>=l.startDate.getTime()&&t.getTime()<=l.endDate.getTime()&&(r=l.segmentIndex);this.parent.setRecordValue("segments",a.segments,a,!0)}}return-1===r&&(this.dropSplit=!0),r},i.prototype.mergeTask=function(t,i){var r=i.length,a=this.parent.taskFields,n=this.parent.flatData.filter((function(e){return e[a.id]===t?e:null}))[0];if(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed){var s={action:"MergeTaskbar"};if(this.parent.isUndoRedoItemPresent("Edit")){this.parent.editModule&&this.parent.editModule.taskbarEditModule.isDragged&&this.parent.getUndoActions().length>0&&this.parent.undoRedoModule.getUndoCollection.splice(this.parent.undoRedoModule.getUndoCollection.length-1,1),this.parent.undoRedoModule.createUndoCollection();var o=this.parent.previousFlatData[n.index];s.modifiedRecords=(0,e.extend)([],[o],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=s}}var l,d=n.ganttProperties.segments;i=i.sort((function(e,t){return t.firstSegmentIndex-e.firstSegmentIndex}));for(var h=0;h<r;h++){var p=d[i[h].firstSegmentIndex],u=d[i[h].secondSegmentIndex],c=p.duration+u.duration,g=this.parent.dataOperation.getEndDate(p.startDate,c,n.ganttProperties.durationUnit,n.ganttProperties,!1),f={startDate:p.startDate,endDate:g,duration:c},m=i[h].firstSegmentIndex;d.splice(m,2,f),this.parent.setRecordValue("segments",d,n.ganttProperties,!0),this.parent.dataOperation.updateMappingData(n,"segments"),1===d.length?(this.parent.setRecordValue("endDate",g,n.ganttProperties,!0),this.parent.setRecordValue("EndDate",g,n,!0),this.parent.setRecordValue("segments",null,n.ganttProperties,!0),this.parent.dataOperation.updateMappingData(n,"segments")):n.ganttProperties.endDate!==d[d.length-1].endDate&&this.parent.setRecordValue("endDate",d[d.length-1].endDate,n.ganttProperties,!0)}(0,e.isNullOrUndefined)(n[a.segments])||(0,e.isNullOrUndefined)(n[a.segments][0])||(l=Object.keys(n[a.segments][0]));for(var y=[],D=0;D<d.length;D++)(0,e.isNullOrUndefined)(l)||y[D]||(y[D]={}),(0,e.isNullOrUndefined)(l)||-1===l.indexOf("StartDate")||(y[D][a.startDate]=d[D].startDate),(0,e.isNullOrUndefined)(l)||-1===l.indexOf("EndDate")||(y[D][a.endDate]=d[D].endDate),(0,e.isNullOrUndefined)(l)||-1===l.indexOf("Duration")||(y[D][a.duration]=d[D].duration);n[a.segments]=y,this.updateSegment(n.ganttProperties.segments,t),this.refreshChartAfterSegment(n,"mergeSegment")},i.prototype.updateSegment=function(t,i){var r=this;if(!(0,e.isNullOrUndefined)(this.parent.taskFields.segmentId))if((0,e.isNullOrUndefined)(t)){l=this.parent.segmentData.filter((function(e){return!(i===e[r.parent.taskFields.segmentId])}));this.parent.segmentData=l}else{for(var a=[],n=0;n<t.length;n++){var s={},o=t[n];s[this.parent.taskFields.segmentId]=i,(0,e.isNullOrUndefined)(this.parent.taskFields.startDate)||(s[this.parent.taskFields.startDate]=o.startDate),(0,e.isNullOrUndefined)(this.parent.taskFields.duration)||(s[this.parent.taskFields.duration]=o.duration),(0,e.isNullOrUndefined)(this.parent.taskFields.endDate)||(s[this.parent.taskFields.endDate]=o.endDate),a.push(s)}var l=this.parent.segmentData.filter((function(e){return!(i===e[r.parent.taskFields.segmentId])}));for(n=0;n<a.length;n++)l.push(a[n]);this.parent.segmentData=l}},i.prototype.refreshChartAfterSegment=function(t,i){this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(t,!1),t.ganttProperties,!0),this.parent.dataOperation.updateMappingData(t,"segments"),this.parent.dataOperation.updateWidthLeft(t),this.parent.dataOperation.updateParentItems(t),this.parent.predecessorModule&&this.parent.taskFields.dependency?(this.parent.predecessorModule.updatedRecordsDateByPredecessor(),this.parent.connectorLineModule.removePreviousConnectorLines(this.parent.flatData),this.parent.connectorLineEditModule.refreshEditedRecordConnectorLine(this.parent.flatData),t.parentItem&&this.parent.getParentTask(t.parentItem).ganttProperties.isAutoSchedule&&this.parent.isInPredecessorValidation&&this.parent.dataOperation.updateParentItems(t.parentItem),this.refreshRecords(this.parent.currentViewData)):this.refreshRecords(this.parent.currentViewData);var r=this.ganttChartTableBody.querySelectorAll("tr")[this.parent.currentViewData.indexOf(t)],a={requestType:i,rowData:t,modifiedRecords:this.parent.editedRecords,modifiedTaskData:d(this.parent.editedRecords,!0)};this.triggerQueryTaskbarInfoByIndex(r,t),this.parent.selectionModule&&this.parent.selectionModule.clearSelection();var n=a.rowData.taskData[this.parent.taskFields.segments];if(this.parent.timezone&&null!=n)for(var s=0;s<n.length;s++)n[s][this.parent.taskFields.startDate]=this.parent.dateValidationModule.remove(a.rowData.ganttProperties.segments[s].startDate,this.parent.timezone),this.parent.taskFields.endDate&&(n[s][this.parent.taskFields.endDate]=this.parent.dateValidationModule.remove(a.rowData.ganttProperties.segments[s].endDate,this.parent.timezone));this.parent.trigger("actionComplete",a),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),(0,e.setValue)("isEdit",!1,this.parent.contextMenuModule),(0,e.setValue)("isEdit",!1,this.parent)},i.prototype.splitTask=function(t,i){var r=this.parent.taskFields,a=i,n=this.parent.flatData.filter((function(e){return e[r.id]===t?e:null}))[0];if(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed){var s={action:"MergeTaskbar"};this.parent.isUndoRedoItemPresent("Edit")&&(this.parent.undoRedoModule.createUndoCollection(),s.modifiedRecords=(0,e.extend)([],[n],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=s)}var o=n.ganttProperties;this.dropSplit=!1;var l=-1,d=o.segments;if((0,e.isNullOrUndefined)(i.length)||i.length<0){var h=this.parent.dataOperation.checkStartDate(a,o,!1);if(h.getTime()!==o.startDate.getTime()&&o.isAutoSchedule){if(!(0,e.isNullOrUndefined)(d)&&d.length>0&&(l=this.getSegmentIndex(h,n)),!1===this.dropSplit&&a.getTime()>o.startDate.getTime()&&a.getTime()<o.endDate.getTime()){d=-1!==l?d:[];var p=-1!==l?d[l].startDate:new Date(o.startDate.getTime()),u=-1!==l?d[l].endDate:new Date(o.endDate.getTime()),c=this.parent.dataOperation.getDuration(p,u,o.durationUnit,o.isAutoSchedule,o.isMilestone);this.parent.setRecordValue("segments",this.splitSegmentedTaskbar(p,u,a,l,d,n,c),o,!0);for(var g=[],f=0;f<d.length;f++)g[f]||(g[f]={}),g[f][r.startDate]=d[f].startDate,g[f][r.endDate]=d[f].endDate,g[f][r.duration]=d[f].duration;n[r.segments]=g,-1!==l&&this.incrementSegments(d,l+1,n),this.parent.setRecordValue("endDate",d[d.length-1].endDate,o,!0),this.parent.taskFields.endDate&&this.parent.dataOperation.updateMappingData(n,"endDate")}this.updateSegment(n.ganttProperties.segments,t),this.refreshChartAfterSegment(n,"splitTaskbar")}}else i.sort((function(e,t){return e.getTime()-t.getTime()})),this.parent.setRecordValue("segments",this.constructSegments(i,n.ganttProperties),n.ganttProperties,!0),this.updateSegment(n.ganttProperties.segments,t),this.refreshChartAfterSegment(n,"splitTask")},i.prototype.constructSegments=function(e,t){for(var i,r,a,n=[],s=new Date,o=0;o<e.length+1&&(s=0===o?t.startDate:s,s=this.parent.dataOperation.checkStartDate(s,t,!1),r=o!==e.length?new Date(e[o].getTime())>t.endDate?t.endDate:new Date(e[o].getTime()):t.endDate,r=this.parent.dataOperation.checkEndDate(r,t,!1),a=this.parent.dataOperation.getDuration(s,r,t.durationUnit,t.isAutoSchedule,t.isMilestone),r.getTime()>=s.getTime()&&(i={startDate:s,endDate:r,duration:a},n.push(i)),o!==e.length);o++)(s=new Date(e[o].getTime())).setDate(e[o].getDate()+1);return n},i.prototype.splitSegmentedTaskbar=function(e,t,i,r,a,n,s){var o,l,d=n.ganttProperties,h=-1===(o=this.parent.includeWeekend?-1:this.parent.nonWorkingDayIndex.indexOf(i.getDay()))?0:0===o||1===o?1:2;e=this.parent.dataOperation.checkStartDate(e,d,!1);var p=new Date(i.getTime());p=this.parent.dataOperation.checkEndDate(p,d,!1);for(var u=0;u<2;u++){if(this.parent.weekWorkingTime.length>0){var c=this.parent.getCurrentDayEndTime(p);this.setTime(c,p)}var g={startDate:e,endDate:p,duration:this.parent.dataOperation.getDuration(e,p,d.durationUnit,d.isAutoSchedule,d.isMilestone),offsetDuration:1};l=this.parent.includeWeekend?-1:this.parent.nonWorkingDayIndex.indexOf(p.getDay()),-1!==r&&(a.splice(r,1),r=-1),a.push(g);var f=this.parent.timelineModule.customTimelineSettings.bottomTier.unit;if("Hour"===f||"Minutes"===f){e=new Date(i.getTime()),e=this.parent.dataOperation.checkStartDate(e,d,!1);var m=this.parent.timelineModule.customTimelineSettings.bottomTier.count,y=this.parent.timelineModule.customTimelineSettings.bottomTier.unit,D=this.parent.timelineModule.getIncrement(e,m,y),v=e.getTime()+D;e.setTime(v+h),p=new Date(t.getTime()),D=this.parent.timelineModule.getIncrement(p,m,y),v=p.getTime()+D,p.setTime(v+h)}else{(e=new Date(i.getTime())).setDate(e.getDate()+1+h);var k=this.parent.getCurrentDayStartTime(e);if(this.setTime(k,e),e=this.parent.dataOperation.checkStartDate(e,d,!1),!this.parent.taskFields.duration&&h<=0&&e.setDate(e.getDate()+1),p=new Date(t.getTime()),this.isOnHolidayOrWeekEnd(p,!0))do{p.setDate(p.getDate()+1)}while(this.isOnHolidayOrWeekEnd(p,!0));this.parent.includeWeekend||(p=this.getNextWorkingDay(p))}if(-1!==l){var w=s-g.duration;p=this.parent.dataOperation.getEndDate(e,w,d.durationUnit,d,!1)}else p=this.parent.dataOperation.checkEndDate(p,d,!1)}return a.sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),a},i.prototype.incrementSegments=function(e,t,i){for(var r=i.ganttProperties,a=t+1;a<e.length;a++){var n=e[a],s=0!==a?new Date(e[a-1].endDate.getTime()):new Date(n.startDate.getTime());this.parent.dataOperation.fromSegments=!0,s=this.parent.dataOperation.getEndDate(s,n.offsetDuration,r.durationUnit,r,!1),this.parent.dataOperation.fromSegments=!1,s=this.parent.dataOperation.checkStartDate(s,r,!1),n.startDate=s;var o=n.endDate=this.parent.dataOperation.getEndDate(s,n.duration,r.durationUnit,r,!1);n.endDate=o,a===e.length-1&&(this.parent.setRecordValue("endDate",o,r,!0),this.parent.taskFields.endDate&&this.parent.dataOperation.updateMappingData(i,"endDate"))}e.sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()})),this.parent.setRecordValue("segments",e,r,!0),this.parent.dataOperation.updateMappingData(i,"segments")},i.prototype.getMilestoneNode=function(t,i){var r=null,a=this.templateData;if(this.milestoneTemplateFunction)r=this.milestoneTemplateFunction((0,e.extend)({index:t},a),this.parent,"MilestoneTemplate",this.getTemplateID("MilestoneTemplate"),!1,void 0,i[0],this.parent.treeGrid.root);else{var n='<div class="'+te+'" style="width:'+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-6)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-6)+'px;position:absolute;transform: rotate(45deg);left:1px;"> </div>';r=this.createDivElement(n)}return r},i.prototype.getTaskBaselineNode=function(){var e=this.templateData,t='<div class="'+z+' " role="term" style="margin-top:'+this.baselineTop+"px;"+(this.parent.enableRtl?"right:":"left:")+e.ganttProperties.baselineLeft+"px;width:"+e.ganttProperties.baselineWidth+"px;height:"+this.baselineHeight+"px;"+(this.baselineColor?"background-color: "+this.baselineColor+";":"")+'"></div>';return this.createDivElement(t)},i.prototype.updateTaskBaselineNode=function(e){var t='<div class="'+z+' " role="term" style="margin-top:'+this.baselineTop+"px;"+(this.parent.enableRtl?"right:":"left:")+e.ganttProperties.baselineLeft+"px;width:"+e.ganttProperties.baselineWidth+"px;height:"+this.baselineHeight+"px;"+(this.baselineColor?"background-color: "+this.baselineColor+";":"")+'"></div>';return this.createDivElement(t)},i.prototype.getMilestoneBaselineNode=function(){var e=this.templateData,t=this.parent.renderBaseline?5:2,i='<div class="'+q+'" style="width:'+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-10)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-10)+"px;position:absolute;transform:rotate(45deg);"+(this.parent.enableRtl?"right:":"left:")+(this.parent.enableRtl?e.ganttProperties.left-this.milestoneHeight/2+3:e.ganttProperties.baselineLeft-this.milestoneHeight/2+1)+"px;"+(this.baselineColor?"background-color: "+this.baselineColor+";":"")+"margin-top:"+(-Math.floor(this.parent.rowHeight-this.milestoneMarginTop)+t+2)+'px"> </div>';return this.createDivElement(i)},i.prototype.getLeftLabelNode=function(t){var i=this.leftLabelContainer();""!==this.generateTaskLabelAriaLabel("left")&&i[0].setAttribute("aria-label",this.generateTaskLabelAriaLabel("left"));var r=null;if(this.leftTaskLabelTemplateFunction)r=this.leftTaskLabelTemplateFunction((0,e.extend)({index:t},this.templateData),this.parent,"LeftLabelTemplate",this.getTemplateID("LeftLabelTemplate"),!1,void 0,i[0],this.parent.treeGrid.root);else{var a=this.parent.labelSettings.leftLabel,n=this.getTaskLabel(a);n&&(n="isCustomTemplate"===n?a:n,r=this.getLableText(n,U),this.parent.enableHtmlSanitizer&&"string"==typeof n&&(n="isCustomTemplate"===(n=e.SanitizeHtmlHelper.sanitize(n))?a:n,r=this.getLableText(n,U)))}return r&&r.length>0&&("null"===r[0].data&&(r[0].data=""),(0,e.append)(r,i[0])),this.parent.enableRtl&&(i[0].style.paddingLeft="25px",i[0].style.paddingRight="0px"),i},i.prototype.getLableText=function(t,i){var r=this.parent.renderBaseline?(this.parent.rowHeight-this.taskBarHeight)/2:this.taskBarMarginTop,a=(0,e.createElement)("div",{className:i,styles:"height:"+this.taskBarHeight+"px;margin-top:"+r+"px;"}),n=(0,e.createElement)("span",{className:fe});n[this.parent.disableHtmlEncode?"textContent":"innerHTML"]=t,a.appendChild(n);var s=(0,e.createElement)("div");return s.appendChild(a),s.childNodes},i.prototype.getRightLabelNode=function(t){var i=this.rightLabelContainer();""!==this.generateTaskLabelAriaLabel("right")&&i[0].setAttribute("aria-label",this.generateTaskLabelAriaLabel("right"));var r=null;if(this.rightTaskLabelTemplateFunction)r=this.rightTaskLabelTemplateFunction((0,e.extend)({index:t},this.templateData),this.parent,"RightLabelTemplate",this.getTemplateID("RightLabelTemplate"),!1,void 0,i[0],this.parent.treeGrid.root);else{var a=this.parent.labelSettings.rightLabel,n=this.getTaskLabel(a);n&&(n="isCustomTemplate"===n?a:n,r=this.getLableText(n,L),this.parent.enableHtmlSanitizer&&"string"==typeof n&&(n="isCustomTemplate"===(n=e.SanitizeHtmlHelper.sanitize(n))?a:n,r=this.getLableText(n,L)))}return r&&r.length>0&&("null"===r[0].data&&(r[0].data=""),(0,e.append)(r,i[0])),this.parent.enableRtl&&(i[0].style.marginLeft="0px",i[0].style.paddingRight="25px"),i},i.prototype.getManualTaskbar=function(){var e=this.templateData,t=this.taskBarHeight/2-1,i=e.ganttProperties.startDate&&e.ganttProperties.endDate&&(e.ganttProperties.duration||e.hasChildRecords)?'<div class="'+ne+'" style="width:'+e.ganttProperties.width+"px;height:"+t/5+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div>':e.ganttProperties.startDate||e.ganttProperties.endDate||!e.ganttProperties.duration?'<div class="'+ne+" "+(e.ganttProperties.startDate?ye:De)+'" style="width:'+e.ganttProperties.width+"px;height:"+2*t+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div>':'<div class="'+ne+' e-gantt-unscheduled-manualtask" style="width:'+e.ganttProperties.width+"px;height:"+(t/5+1)+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div>',r='<div class="'+ae+'"style='+(this.parent.enableRtl?"right:":"left:")+(e.ganttProperties.left-e.ganttProperties.autoLeft)+"px;width:"+e.ganttProperties.width+"px;height:"+t+"px;cursor:"+(this.parent.editSettings.allowTaskbarEditing?"move;":"default;")+"</div>"+i+(e.ganttProperties.startDate&&e.ganttProperties.endDate&&(e.ganttProperties.duration||e.hasChildRecords)||e.ganttProperties.duration?'<div class="e-gantt-manualparenttaskbar-left" style='+(this.parent.enableRtl?"margin-right:0px;":"")+'"height:'+(t/5+8)+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div><div class="e-gantt-manualparenttaskbar-right" style='+(this.parent.enableRtl?"margin-right:-8px;":"")+(this.parent.enableRtl?"right:":"left:")+(e.ganttProperties.width-Math.floor((t/5+8)/5))+"px;height:"+(t/5+8)+"px;border-right-width:"+t/5+"px;border-bottom:"+t/5+"px solid transparent;></div></div>":""),a='<div class="'+se+'" style="width:'+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;position:absolute;transform: rotate(45deg);top:"+(this.parent.rowHeight>40?0:2)+"px;left:"+(this.parent.renderBaseline?2:1)+'px;"> </div>';return this.createDivElement(0!==e.ganttProperties.duration||e.hasChildRecords?r:a)},i.prototype.getParentTaskbarNode=function(t,i){var r=null,a=this.templateData;if(this.parentTaskbarTemplateFunction)r=this.parentTaskbarTemplateFunction((0,e.extend)({index:t},a),this.parent,"ParentTaskbarTemplate",this.getTemplateID("ParentTaskbarTemplate"),!1,void 0,i[0],this.parent.treeGrid.root);else{var n="",s=void 0,o=this.taskBarHeight/5,l=this.createDivElement('<div class="e-gantt-parent-taskbar-inner-div '+this.getExpandClass(a)+" "+de+'" style="width:'+(a.ganttProperties.isAutoSchedule?a.ganttProperties.width:a.ganttProperties.autoWidth)+"px;height:"+(a.ganttProperties.isAutoSchedule?this.taskBarHeight:3*o)+"px;margin-top:"+(a.ganttProperties.isAutoSchedule?-1:2*o)+'px; "></div>'),d=this.createDivElement('<div class="e-gantt-parent-progressbar-inner-div '+this.getExpandClass(a)+" "+he+'" style="border-style:'+(a.ganttProperties.progressWidth?"solid;":"none;")+"width:"+a.ganttProperties.progressWidth+"px;border-top-right-radius:"+this.getBorderRadius(a)+"px;border-bottom-right-radius:"+this.getBorderRadius(a)+'px;height:100%;"></div>'),h=(0,e.createElement)("div");if(this.taskLabelTemplateFunction){var p=this.taskLabelTemplateFunction((0,e.extend)({index:t},a),this.parent,"TaskLabelTemplate",this.getTemplateID("TaskLabelTemplate"),!1,void 0,d[0]);p&&p.length>0&&((0,e.append)(p,h),n=h.innerHTML)}else n="isCustomTemplate"===(n=this.getTaskLabel(this.parent.labelSettings.taskLabel))?this.parent.labelSettings.taskLabel:n,this.parent.enableHtmlSanitizer&&"string"==typeof n&&(n=e.SanitizeHtmlHelper.sanitize(n));if(-1===n.indexOf("null")){"isCustomTemplate"!==this.getTaskLabel(this.parent.labelSettings.taskLabel)||this.isTemplate(this.parent.labelSettings.taskLabel)||(n=""),s=isNaN(parseInt(n,10))?'<span class="'+B+'" style="line-height:'+(a.isManual&&a.hasChildRecords?Math.floor(.6*this.taskBarHeight):this.taskBarHeight-1)+"px; text-align:"+(this.parent.enableRtl?"right;":"left;")+"display:inline-block;width:"+(a.ganttProperties.width-10)+"px; height:"+this.taskBarHeight+'px;"></span>':'<span class="'+B+'" style="line-height:'+(a.isManual&&a.hasChildRecords?Math.floor(.6*this.taskBarHeight):this.taskBarHeight-1)+"px;"+("ResourceView"===this.parent.viewType?"display:inline-flex;":"")+("ResourceView"===this.parent.viewType?"width:"+(a.ganttProperties.width-10):"")+"px; height:"+(this.taskBarHeight-1)+"px;"+("ResourceView"===this.parent.viewType?"display: inline-flex;":"")+("ResourceView"===this.parent.viewType?"width:"+(a.ganttProperties.width-10):"")+"px; height:"+this.taskBarHeight+'px;"></span>';var u=this.createDivElement(s)[0];this.parent.disableHtmlEncode?u.innerText=n:u.innerHTML=n;var c=this.parent.labelSettings.taskLabel;c&&c.elementRef&&u.appendChild(h),d[0].appendChild(u),""!==d[0].querySelectorAll(".e-task-label")[0].textContent&&!this.isTemplate(c)&&d[0].querySelectorAll(".e-task-label")[0].children[0]&&d[0].querySelectorAll(".e-task-label")[0].children[0].remove(),""===d[0].querySelectorAll(".e-task-label")[0].textContent&&c&&!c.elementRef&&""!==h.innerHTML&&(d[0].querySelectorAll(".e-task-label")[0].textContent=c)}var g='<div class="e-gantt-parent-milestone" style="width:'+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;position:absolute;transform: rotate(45deg);top:"+(this.parent.rowHeight>40?0:2)+"px;left:"+(this.parent.renderBaseline?2:1)+'px;"> </div>';l[0].appendChild([].slice.call(d)[0]),r=a.ganttProperties.isMilestone?this.createDivElement(a.ganttProperties.isAutoSchedule?g:""):l}return this.parent.enableRtl&&r[0]&&r[0].querySelector(".e-task-label")&&(r[0].querySelector(".e-task-label").style.marginLeft="15px",r[0].querySelector(".e-task-label").style.marginRight="8px",r[0].querySelector(".e-gantt-parent-progressbar")&&(r[0].querySelector(".e-gantt-parent-progressbar").style.textAlign="left")),r},i.prototype.getTableTrNode=function(t){var i,r,a=this,n=(0,e.createElement)("table"),s="Horizontal"===this.parent.gridLines||"Both"===this.parent.gridLines?"e-chart-row-border":"";return this.parent.treeGridModule.isPersist?setTimeout((function(){(0,e.isNullOrUndefined)(a.parent.treeGrid.grid)||(0,e.isNullOrUndefined)(a.parent.treeGrid.grid.contentModule)||(0,e.isNullOrUndefined)(a.parent.treeGrid.grid.contentModule.getRows())||(r=a.parent.treeGrid.grid.contentModule.getRows()[t],i=r&&r.isSelected?"e-active":"")}),0):(r=this.parent.treeGrid.grid.contentModule.getRows()[t],i=r&&r.isSelected?"e-active":""),n.innerHTML='<tr class="'+this.getRowClassName(this.templateData)+" "+Z+" "+i+'"style="display:'+this.getExpandDisplayProp(this.templateData)+";height:"+this.parent.rowHeight+'px;"><td class="'+_+" "+s+'"style="width:'+this.parent.timelineModule.totalTimelineWidth+'px;"></td></tr>',n.childNodes},i.prototype.initializeChartTemplate=function(){(0,e.isNullOrUndefined)(this.parent.parentTaskbarTemplate)||(this.parentTaskbarTemplateFunction=this.templateCompiler(this.parent.parentTaskbarTemplate)),!(0,e.isNullOrUndefined)(this.parent.labelSettings.leftLabel)&&this.isTemplate(this.parent.labelSettings.leftLabel)&&(this.leftTaskLabelTemplateFunction=this.templateCompiler(this.parent.labelSettings.leftLabel)),!(0,e.isNullOrUndefined)(this.parent.labelSettings.rightLabel)&&this.isTemplate(this.parent.labelSettings.rightLabel)&&(this.rightTaskLabelTemplateFunction=this.templateCompiler(this.parent.labelSettings.rightLabel)),!(0,e.isNullOrUndefined)(this.parent.labelSettings.taskLabel)&&this.isTemplate(this.parent.labelSettings.taskLabel)&&(this.taskLabelTemplateFunction=this.templateCompiler(this.parent.labelSettings.taskLabel)),(0,e.isNullOrUndefined)(this.parent.taskbarTemplate)||(this.childTaskbarTemplateFunction=this.templateCompiler(this.parent.taskbarTemplate)),(0,e.isNullOrUndefined)(this.parent.milestoneTemplate)||(this.milestoneTemplateFunction=this.templateCompiler(this.parent.milestoneTemplate))},i.prototype.createDivElement=function(t){var i=(0,e.createElement)("div");return i.innerHTML=t,i.childNodes},i.prototype.isTemplate=function(e){for(var t=!1,i=0;i<this.parent.ganttColumns.length;i++)if(e===this.parent.ganttColumns[i].field){t=!0;break}return t="string"!=typeof e||0===e.indexOf("#")||e.indexOf("<")>-1||e.indexOf("$")>-1||!t},i.prototype.getTemplateID=function(e){return this.parent.element.id+e},i.prototype.leftLabelContainer=function(){var e='<div class="'+(this.leftTaskLabelTemplateFunction?"e-left-label-container e-left-label-temp-container":F)+' " tabindex="-1" role="term" style="height:'+(this.parent.rowHeight-2)+"px;width:"+this.taskNameWidth(this.templateData)+'"></div>';return this.createDivElement(e)},i.prototype.taskbarContainer=function(){var e=this.templateData,t=!(!this.parent.editModule||!this.parent.editSettings.allowTaskbarEditing||"ParentResizing"!==this.parent.editModule.taskbarEditModule.taskBarEditAction),i='<div class="'+V+" "+this.parent.getUnscheduledTaskClass(e.ganttProperties)+" "+(e.ganttProperties.cssClass?e.ganttProperties.cssClass:"")+'"  tabindex="-1" role="term" style="'+(!e.ganttProperties.isMilestone||t||e.hasChildRecords&&!e.ganttProperties.isAutoSchedule?"width:"+e.ganttProperties.width+"px;margin-top:"+this.taskBarMarginTop+"px;"+(this.parent.enableRtl?"right:":"left:")+(!e.hasChildRecords||e.ganttProperties.isAutoSchedule?e.ganttProperties.left:e.ganttProperties.autoLeft)+"px;height:"+this.taskBarHeight+"px;cursor:"+(this.parent.editSettings.allowTaskbarEditing?"move;":"default;"):"width:"+this.milestoneHeight+"px;height:"+this.milestoneHeight+"px;margin-top:"+this.milestoneMarginTop+"px;"+(this.parent.enableRtl?"right:":"left:")+(e.ganttProperties.left-this.milestoneHeight/2)+"px;cursor:"+(this.parent.editSettings.allowTaskbarEditing?"move;":"default;"))+'"></div>';return this.createDivElement(i)},i.prototype.rightLabelContainer=function(){var e='<div class="'+(this.rightTaskLabelTemplateFunction?"e-right-label-container e-right-label-temp-container":N)+'"  tabindex="-1" role="term" style="'+(this.parent.enableRtl?"right:":"left:")+this.getRightLabelLeft(this.templateData)+"px; height:"+(this.parent.rowHeight-2)+'px;"></div>';return this.createDivElement(e)},i.prototype.childTaskbarLeftResizer=function(){var t=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?5:-2,i='<div class="'+X+" "+ee+'"style="'+(this.parent.enableRtl?"right:":"left:")+t+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>';return this.createDivElement(i)},i.prototype.childTaskbarRightResizer=function(){var t=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?-17:-11,i='<div class="'+Y+" "+ee+'"style="'+(this.parent.enableRtl?"right:":"left:")+(this.templateData.ganttProperties.width+t)+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>';return this.createDivElement(i)},i.prototype.childTaskbarProgressResizer=function(){var e=this.parent.enableRtl?this.templateData.ganttProperties.progressWidth+8:this.templateData.ganttProperties.progressWidth-6,t='<div class="'+Q+'"style="'+(this.parent.enableRtl?"right:":"left:")+e+"px;margin-top:"+(this.taskBarHeight-4)+'px;"><div class="'+K+'"><div class="'+J+'"></div><div class="'+$+'"></div></div>';return this.createDivElement(t)},i.prototype.getLeftPointNode=function(){var t,i=this.templateData,r=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?12:0,a=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?6:3,n=-(2+this.connectorPointWidth+r),s=-(this.connectorPointWidth+a),o=Math.floor(this.milesStoneRadius-this.connectorPointWidth/2);t=!this.templateData.ganttProperties.isAutoSchedule&&this.templateData.hasChildRecords&&this.parent.allowParentDependency?"":"margin-top:"+this.connectorPointMargin+"px";var l=!0;i.hasChildRecords&&!this.parent.allowParentDependency&&(l=!1);var d='<div class="e-left-connectorpoint-outer-div" style="'+(i.ganttProperties.isMilestone?"margin-top:"+o+"px;left:"+s+"px;":t+";left:"+n+"px;")+'"><div class="'+(l?Se:"")+" "+this.parent.getUnscheduledTaskClass(i.ganttProperties)+'" style="width: '+this.connectorPointWidth+"px;"+(this.parent.enableRtl?"margin-right:2px;":"")+"height: "+this.connectorPointWidth+'px;">'+this.touchLeftConnectorpoint+"</div></div>";return this.createDivElement(d)},i.prototype.getRightPointNode=function(){var t,i=this.templateData,r=-(3+(!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?-12:0)),a=Math.floor(this.milesStoneRadius-this.connectorPointWidth/2);t=!this.templateData.ganttProperties.isAutoSchedule&&this.templateData.hasChildRecords&&this.parent.allowParentDependency?"":"margin-top:"+this.connectorPointMargin+"px";var n=!0;i.hasChildRecords&&!this.parent.allowParentDependency&&(n=!1);var s='<div class="'+xe+'" style="'+(i.ganttProperties.isMilestone?"left:"+(!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?this.milestoneHeight+5:this.milestoneHeight-2)+"px;margin-top:"+a+"px;":"left:"+(i.ganttProperties.width+r)+"px;"+t+";")+'"><div class="'+(n?Ce:"")+" "+this.parent.getUnscheduledTaskClass(i.ganttProperties)+'" style="width:'+this.connectorPointWidth+"px;height:"+this.connectorPointWidth+'px;">'+this.touchRightConnectorpoint+"</div></div>";return this.createDivElement(s)},i.prototype.getTaskLabel=function(t){var i=this.parent.ganttColumns.length,r=null;if((0,e.isNullOrUndefined)(t)||""===t)r="";else if(t===this.parent.taskFields.resourceInfo)r=this.getResourceName(this.templateData);else{for(var a=0;a<i;a++)if(t===this.parent.ganttColumns[a].field){r=this.getFieldValue(this.templateData[t]).toString();break}if((0,e.isNullOrUndefined)(r))return"isCustomTemplate"}return r},i.prototype.getExpandDisplayProp=function(e){return e=this.templateData,this.parent.getExpandStatus(e)?"table-row":"none"},i.prototype.getRowClassName=function(e){var t="gridrowtaskId",i=(e=this.templateData).parentItem;return i&&(t+=i.taskId.toString()),t+="level",t+=e.level.toString()},i.prototype.getBorderRadius=function(e){var t=(e=this.templateData).ganttProperties.width-e.ganttProperties.progressWidth;return t<=4?4-t:0},i.prototype.getSplitTaskBorderRadius=function(e){var t=e.width-e.progressWidth;return t<=4?4-t:0},i.prototype.taskNameWidth=function(e){var t,i=(e=this.templateData).ganttProperties;return(t=e.ganttProperties.isMilestone?e.ganttProperties.left-this.parent.getTaskbarHeight()/2:e.hasChildRecords&&!i.isAutoSchedule?this.parent.allowUnscheduledTasks?i.left<i.autoLeft?i.left:i.autoLeft:i.autoStartDate.getTime()<i.startDate.getTime()?i.autoLeft:i.left:e.ganttProperties.left)<0&&(t=0),t+"px"},i.prototype.getRightLabelLeft=function(e){var t,i,r=(e=this.templateData).ganttProperties;return e.ganttProperties.isMilestone?e.ganttProperties.left+this.parent.getTaskbarHeight()/2:e.hasChildRecords&&!r.isAutoSchedule?(this.parent.allowUnscheduledTasks?(t=r.left<r.autoLeft?r.autoLeft:r.left,i=r.autoWidth):(t=r.autoStartDate.getTime()<r.startDate.getTime()?r.autoLeft:r.left,i=(r.autoEndDate.getTime()<r.endDate.getTime()?this.parent.dataOperation.getTaskLeft(r.endDate,r.isMilestone):this.parent.dataOperation.getTaskLeft(r.autoEndDate,r.isMilestone))-t),t+i):e.ganttProperties.left+e.ganttProperties.width},i.prototype.getExpandClass=function(e){return(e=this.templateData).expanded?"e-row-expand":!e.expanded&&e.hasChildRecords?"e-row-collapse":""},i.prototype.getFieldValue=function(t){return(0,e.isNullOrUndefined)(t)?"":t},i.prototype.getResourceName=function(t){t=this.templateData;var i=null;if(!(0,e.isNullOrUndefined)(t.ganttProperties.resourceInfo)){var r=t.ganttProperties.resourceInfo.length;if(r>0){for(var a=0;a<r;a++){var n=t.ganttProperties.resourceInfo[a][this.parent.resourceFields.name],s=t.ganttProperties.resourceInfo[a][this.parent.resourceFields.unit];100!==s&&(n+="["+s+"%]"),(0,e.isNullOrUndefined)(i)?i=n:i+=" , "+n}return i}return""}return""},i.prototype.initChartHelperPrivateVariable=function(){var t=this.parent.renderBaseline?.45:!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?.7:.62,i=this.parent.renderBaseline?4:2,r=this.parent.renderBaseline?1.13:.82;if(this.parent.rowHeight=(0,e.isNullOrUndefined)(this.parent.rowHeight)?36:this.parent.rowHeight,this.baselineColor=(0,e.isNullOrUndefined)(this.parent.baselineColor)||""===this.parent.baselineColor?null:this.parent.baselineColor,this.taskBarHeight=(0,e.isNullOrUndefined)(this.parent.taskbarHeight)||this.parent.taskbarHeight>=this.parent.rowHeight?Math.floor(this.parent.rowHeight*t):this.parent.taskbarHeight,this.parent.renderBaseline){var a=void 0;a=this.taskBarHeight+this.baselineHeight<=this.parent.rowHeight?this.taskBarHeight:this.taskBarHeight-(this.baselineHeight+1),this.taskBarHeight=a}this.milestoneHeight=Math.floor(this.taskBarHeight*r),this.taskBarMarginTop=Math.floor((this.parent.rowHeight-this.taskBarHeight)/i),this.milestoneMarginTop=Math.floor((this.parent.rowHeight-this.milestoneHeight)/2),this.milesStoneRadius=Math.floor(this.milestoneHeight/2),this.baselineTop=-(Math.floor(this.parent.rowHeight-(this.taskBarHeight+this.taskBarMarginTop))-4),this.connectorPointWidth=this.parent.isAdaptive?Math.round(this.taskBarHeight/2):9,this.connectorPointMargin=Math.floor(this.taskBarHeight/2-this.connectorPointWidth/1.5)},i.prototype.refreshGanttRows=function(){if(this.parent.currentViewData=this.parent.treeGrid.getCurrentViewRecords().slice(),this.createTaskbarTemplate(),this.parent.showOverAllocation){for(var e=0;e<this.parent.currentViewData.length;e++){var t=this.parent.currentViewData[e];t.childRecords.length>0&&(this.parent.setRecordValue("workTimelineRanges",this.parent.dataOperation.mergeRangeCollections(t.ganttProperties.workTimelineRanges,!0),t.ganttProperties,!0),this.parent.dataOperation.calculateRangeLeftWidth(t.ganttProperties.workTimelineRanges))}this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)}this.parent.ganttChartModule.updateLastRowBottomWidth()},i.prototype.createTaskbarTemplate=function(){var t,i=[].slice.call(this.ganttChartTableBody.querySelectorAll("tr"));this.ganttChartTableBody.innerHTML="";var r=[],a=this.parent.treeGridModule.prevCurrentView;if(this.refreshedTr=[],this.refreshedData=[],this.parent.enableImmutableMode&&a&&a.length>0&&this.isUpdated){for(var n={},s=[],o=this.parent.treeGrid.getPrimaryKeyFieldNames()[0],l=0;l<a.length;l++)s[l]=i[l],n[a[l][o]]=l;for(var d=0;d<this.parent.currentViewData.length;d++){var h=n[this.parent.currentViewData[d][o]],p=this.parent.modifiedRecords.indexOf(this.parent.currentViewData[d]);if((0,e.isNullOrUndefined)(h)||-1!==p||this.parent.isFromRenderBaseline){var u=this.getGanttChartRow(d,this.parent.currentViewData[d]);this.ganttChartTableBody.appendChild(u),this.refreshedTr.push(this.ganttChartTableBody.querySelectorAll("tr")[d]),this.refreshedData.push(this.parent.currentViewData[d])}else this.ganttChartTableBody.appendChild(s[h]);this.ganttChartTableBody.querySelectorAll("tr")[d].setAttribute("data-rowindex",d.toString())}}else{var c=(0,e.createElement)("tbody",{id:this.parent.element.id+"GanttTaskTableBody"});for(l=0;l<this.parent.currentViewData.length;l++){var g=this.parent.currentViewData[l];!g.expanded&&this.parent.enableMultiTaskbar&&r.push(g);u=this.getGanttChartRow(l,g);g.hasChildRecords&&!g.expanded&&this.parent.enableMultiTaskbar&&!this.parent.allowTaskbarOverlap&&this.updateDragDropRecords(g,u),c.appendChild(u),this.parent.enableImmutableMode&&(this.refreshedTr.push(c.querySelectorAll("tr")[l]),this.refreshedData.push(this.parent.currentViewData[l])),this.parent.selectionModule&&this.parent.allowSelection&&this.parent.selectionModule.maintainSelectedRecords(parseInt(u.getAttribute("data-rowindex"),10))}(t=this.ganttChartTableBody).replaceChildren.apply(t,c.childNodes),this.parent.initialChartRowElements=this.parent.ganttChartModule.getChartRows()}if(this.parent.enableCriticalPath&&this.parent.criticalPathModule){var f=this.parent.criticalPathModule;f.criticalPathCollection&&this.parent.criticalPathModule.criticalConnectorLine(f.criticalPathCollection,f.detailPredecessorCollection,!0,f.predecessorCollectionTaskIds)}if(this.parent.renderTemplates(),this.triggerQueryTaskbarInfo(),this.parent.modifiedRecords=[],this.parent.showOverAllocation&&this.updateOverlapped(),r.length)for(var m=0;m<r.length;m++)r[m].hasChildRecords&&(this.parent.isGanttChartRendered=!0,this.parent.chartRowsModule.refreshRecords([r[m]]));this.parent.isGanttChartRendered=!0,this.parent.renderTemplates()},i.prototype.getGanttChartRow=function(t,i){this.templateData=i;var r,a,n=this.getTableTrNode(t),s=this.getLeftLabelNode(t),o=this.taskbarContainer();if(o[0].setAttribute("aria-label",this.generateAriaLabel(this.templateData)),o[0].setAttribute("rowUniqueId",this.templateData.ganttProperties.rowUniqueID),r=this.getLeftPointNode(),(this.templateData.ganttProperties.isAutoSchedule&&"ProjectView"===this.parent.viewType||!this.templateData.hasChildRecords)&&o[0].appendChild([].slice.call(r)[0]),this.templateData.hasChildRecords){var l=void 0;if(!this.parent.enableMultiTaskbar||this.parent.enableMultiTaskbar&&this.templateData.expanded)l=this.getParentTaskbarNode(t,o);else{o=[];for(var d=0;d<this.templateData.childRecords.length;d++){this.templateData=this.templateData.childRecords[d];var h=this.taskbarContainer();h[0].setAttribute("aria-label",this.generateAriaLabel(this.templateData)),h[0].setAttribute("rowUniqueId",this.templateData.ganttProperties.rowUniqueID),this.parent.allowParentDependency?(r=this.getLeftPointNode(),!this.templateData.ganttProperties.isAutoSchedule&&this.templateData.hasChildRecords||h[0].appendChild([].slice.call(r)[0])):(r=this.getLeftPointNode(),h[0].appendChild([].slice.call(r)[0])),this.appendChildTaskbars(i,t,h,a,o)}}if(!this.templateData.ganttProperties.isAutoSchedule){var p=this.getManualTaskbar();if(!(0,e.isNullOrUndefined)(p[0])){if(this.parent.allowParentDependency){p[0].appendChild([].slice.call(r)[0]);var u=this.getRightPointNode();p[0].appendChild([].slice.call(u)[0])}o[0].appendChild([].slice.call(p)[0])}}if(0!==this.templateData.ganttProperties.autoDuration&&!this.templateData.ganttProperties.isMilestone&&l&&l.length>0)(0,e.append)(l,o[0]);else if(0===this.templateData.ganttProperties.duration&&this.templateData.ganttProperties.isMilestone&&this.templateData.ganttProperties.isAutoSchedule){var c=this.getMilestoneNode(t,o);c&&c.length>0&&(0,e.append)(c,o[0])}this.parent.renderBaseline&&this.templateData.ganttProperties.baselineStartDate&&this.templateData.ganttProperties.baselineEndDate&&(this.taskBaselineTemplateNode=this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.baselineEndDate.getTime()&&((0,e.isNullOrUndefined)(this.templateData.ganttProperties.baselineStartDate)||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.startDate)||this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.startDate.getTime()||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.baselineEndDate)||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.endDate)||this.templateData.ganttProperties.baselineEndDate.getTime()!==this.templateData.ganttProperties.endDate.getTime()||!this.templateData.ganttProperties.isMilestone)?this.getTaskBaselineNode():this.getMilestoneBaselineNode()),(!this.parent.enableMultiTaskbar||this.parent.enableMultiTaskbar&&this.templateData.expanded)&&(this.parent.allowParentDependency&&(this.templateData.ganttProperties.isAutoSchedule&&"ProjectView"===this.parent.viewType||!this.templateData.hasChildRecords)?(a=this.getRightPointNode(),o[0].appendChild([].slice.call(a)[0])):this.parent.allowParentDependency||(a=this.getRightPointNode(),o[0].appendChild([].slice.call(a)[0])))}else this.appendChildTaskbars(i,t,o,a);var g=this.getRightLabelNode(t);if(this.parent.enableMultiTaskbar&&this.templateData.hasChildRecords&&!this.templateData.expanded){var f=(0,e.createElement)("div",{className:"e-collapse-parent"});n[0].childNodes[0].childNodes[0].appendChild(f);for(d=0;d<o.length;d++)(0,e.addClass)([o[d]],"collpse-parent-border"),n[0].childNodes[0].childNodes[0].childNodes[0].appendChild([].slice.call(o)[d]);n[0].childNodes[0].childNodes[0].appendChild([].slice.call(s)[0]),this.templateData.ganttProperties.indicators&&this.templateData.ganttProperties.indicators.length>0&&this.appendIndicators(t,n)}else n[0].childNodes[0].childNodes[0].appendChild([].slice.call(s)[0]),n[0].childNodes[0].childNodes[0].appendChild([].slice.call(o)[0]),this.templateData.ganttProperties.indicators&&this.templateData.ganttProperties.indicators.length>0&&this.appendIndicators(t,n),g&&g.length>0&&n[0].childNodes[0].childNodes[0].appendChild([].slice.call(g)[0]);(0,e.isNullOrUndefined)(this.taskBaselineTemplateNode)||n[0].childNodes[0].childNodes[0].appendChild([].slice.call(this.taskBaselineTemplateNode)[0]),this.taskBaselineTemplateNode=null;var m=n[0].childNodes[0];return this.setAriaRowIndex(i,m),m},i.prototype.setAriaRowIndex=function(t,i){var r,a=this,n=this.parent.treeGrid.getCurrentViewRecords(),s=this.parent.virtualScrollModule&&this.parent.enableVirtualization?(0,e.getValue)("virtualScrollModule.visualData",this.parent.treeGrid):n;if(!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping){var o=this.parent.treeGrid.grid.contentModule.rows.filter((function(e){if(e.data[a.parent.taskFields.id]===t.ganttProperties.taskId)return e}))[0];i.setAttribute("data-rowindex",o.index.toString())}else r=s.indexOf(t),i.setAttribute("aria-rowindex",(r+1).toString()),i.setAttribute("data-rowindex",r.toString())},i.prototype.triggerQueryTaskbarInfo=function(){if(this.parent.queryTaskbarInfo)for(var t,i,r=this.parent.enableImmutableMode?this.refreshedTr.length:this.ganttChartTableBody.querySelectorAll("tr").length,a=0;a<r;a++){t=this.parent.enableImmutableMode?this.refreshedTr[a]:this.ganttChartTableBody.querySelectorAll("tr")[a],i=this.refreshedData.length>0?this.refreshedData[a]:this.parent.currentViewData[a];var n=!(0,e.isNullOrUndefined)(i.ganttProperties.segments)&&i.ganttProperties.segments.length;if(n>0)for(var s=0;s<n;s++){var o=t.getElementsByClassName("e-segmented-taskbar")[s];this.triggerQueryTaskbarInfoByIndex(o,i)}else t&&this.triggerQueryTaskbarInfoByIndex(t,i)}},i.prototype.appendIndicators=function(t,i){for(var r,a,n=this.templateData.ganttProperties.indicators,s=0;s<n.length;s++){if((r=this.getIndicatorNode(n[s]))[0].setAttribute("aria-label",n[s].name),n[s].name.indexOf("$")>-1||n[s].name.indexOf("#")>-1)a=this.templateCompiler(n[s].name)((0,e.extend)({index:t},this.templateData),this.parent,"indicatorLabelText");else{var o=(0,e.createElement)("Text");o.innerHTML=n[s].name,this.parent.enableHtmlSanitizer&&"string"==typeof n[s].name&&(n[s].name=e.SanitizeHtmlHelper.sanitize(n[s].name)),a=o.childNodes}r[0].appendChild([].slice.call(a)[0]),r[0].title=(0,e.isNullOrUndefined)(n[s].tooltip)?"":n[s].tooltip,i[0].childNodes[0].childNodes[0].appendChild([].slice.call(r)[0])}},i.prototype.appendChildTaskbars=function(t,i,r,a,s){if(this.templateData.ganttProperties.isMilestone){var o=this.getMilestoneNode(i,r);o&&o.length>0&&(0,e.append)(o,r[0]),this.parent.renderBaseline&&this.templateData.ganttProperties.baselineStartDate&&this.templateData.ganttProperties.baselineEndDate&&(this.taskBaselineTemplateNode=this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.baselineEndDate.getTime()&&((0,e.isNullOrUndefined)(this.templateData.ganttProperties.baselineStartDate)||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.startDate)||this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.startDate.getTime()||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.baselineEndDate)||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.endDate)||this.templateData.ganttProperties.baselineEndDate.getTime()!==this.templateData.ganttProperties.endDate.getTime()||!this.templateData.ganttProperties.isMilestone)?this.getTaskBaselineNode():this.getMilestoneBaselineNode()),s&&(s.push(r[0]),this.templateData=t)}else{var l=n(this.templateData.ganttProperties),d=null,h=null,p=null;if(!(0,e.isNullOrUndefined)(l)){(l||this.templateData.ganttProperties.duration)&&l&&((0,e.isNullOrUndefined)(this.templateData.ganttProperties.segments)||this.templateData.ganttProperties.segments.length<=0)&&(d=this.childTaskbarProgressResizer(),p=this.childTaskbarLeftResizer(),h=this.childTaskbarRightResizer());var u=this.getChildTaskbarNode(i,r);if(p&&r[0].appendChild([].slice.call(p)[0]),u&&u.length>0)if(this.templateData.ganttProperties.segments&&this.templateData.ganttProperties.segments.length>0){var c,g=this.templateData.ganttProperties.segments.length;c=this.createDivElement('<div class="e-gantt-split-container-line"></div>'),r[0].appendChild([].slice.call(c)[0]);for(var f=0;f<g;f++)(0,e.append)(u,r[0])}else(0,e.append)(u,r[0]);d&&r[0].appendChild([].slice.call(d)[0]),h&&r[0].appendChild([].slice.call(h)[0])}this.parent.renderBaseline&&this.templateData.ganttProperties.baselineStartDate&&this.templateData.ganttProperties.baselineEndDate&&(this.taskBaselineTemplateNode=this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.baselineEndDate.getTime()&&((0,e.isNullOrUndefined)(this.templateData.ganttProperties.baselineStartDate)||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.startDate)||this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.startDate.getTime()||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.baselineEndDate)||(0,e.isNullOrUndefined)(this.templateData.ganttProperties.endDate)||this.templateData.ganttProperties.baselineEndDate.getTime()!==this.templateData.ganttProperties.endDate.getTime()||!this.templateData.ganttProperties.isMilestone)?this.getTaskBaselineNode():this.getMilestoneBaselineNode())}this.parent.allowParentDependency&&(this.templateData.ganttProperties.isAutoSchedule&&"ProjectView"===this.parent.viewType||!this.templateData.hasChildRecords)?(a=this.getRightPointNode(),r[0].appendChild([].slice.call(a)[0])):this.parent.allowParentDependency||(a=this.getRightPointNode(),r[0].appendChild([].slice.call(a)[0])),s&&(s.push(r[0]),this.templateData=t)},i.prototype.customizeTaskbars=function(t,i,r){var a,n=this;t.ganttProperties.segments&&t.ganttProperties.segments.length>0&&i&&i.parentElement&&i.parentElement.parentElement&&i.parentElement.parentElement.parentElement&&(a=i.parentElement.parentElement.parentElement);var s={data:t,rowElement:i,taskbarElement:r,taskbarType:t.hasChildRecords?"ParentTask":t.ganttProperties.isMilestone?"Milestone":"ChildTask"},o=this.getClassName(s);if("Milestone"===s.taskbarType)s.milestoneColor=r.querySelector(o[0])?getComputedStyle(r.querySelector(o[0])).backgroundColor:null,s.baselineColor=i.querySelector(o[1])?getComputedStyle(i.querySelector(o[1])).backgroundColor:i.querySelector("."+z)?getComputedStyle(i.querySelector("."+z)).backgroundColor:null;else if(r){var l=r.querySelector(o[0]),d=r.querySelector(o[1]);s.taskbarBgColor=(0,e.isNullOrUndefined)(l)?null:r.classList.contains(ie)?getComputedStyle(r).backgroundColor:getComputedStyle(r.querySelector(o[0])).backgroundColor,s.taskbarBorderColor=(0,e.isNullOrUndefined)(l)?null:r.classList.contains(ie)?getComputedStyle(r).backgroundColor:getComputedStyle(r.querySelector(o[0])).outlineColor,s.progressBarBgColor=(0,e.isNullOrUndefined)(d)?null:r.classList.contains(re)?getComputedStyle(r).backgroundColor:getComputedStyle(r.querySelector(o[1])).backgroundColor,s.baselineColor=a?a.querySelector("."+z)?getComputedStyle(a.querySelector("."+z)).backgroundColor:null:i.querySelector("."+z)?getComputedStyle(i.querySelector("."+z)).backgroundColor:null,s.taskLabelColor=r.querySelector("."+B)?getComputedStyle(r.querySelector("."+B)).color:null}a?(s.rightLabelColor=a.querySelector("."+N)&&a.querySelector("."+N).querySelector("."+fe)?getComputedStyle(a.querySelector("."+N).querySelector("."+fe)).color:null,s.leftLabelColor=a.querySelector("."+F)&&a.querySelector("."+F).querySelector("."+fe)?getComputedStyle(a.querySelector("."+F).querySelector("."+fe)).color:null):(s.rightLabelColor=i.querySelector("."+N)&&i.querySelector("."+N).querySelector("."+fe)?getComputedStyle(i.querySelector("."+N).querySelector("."+fe)).color:null,s.leftLabelColor=i.querySelector("."+F)&&i.querySelector("."+F).querySelector("."+fe)?getComputedStyle(i.querySelector("."+F).querySelector("."+fe)).color:null),this.parent.trigger("queryTaskbarInfo",s,(function(e){n.updateQueryTaskbarInfoArgs(e,undefined,undefined)}))},i.prototype.triggerQueryTaskbarInfoByIndex=function(t,i){if(!(0,e.isNullOrUndefined)(t)){var r,a=i;if(!(0,e.isNullOrUndefined)(i.ganttProperties.segments)&&i.ganttProperties.segments.length>0)r=t,t&&this.customizeTaskbars(i,t,r);else if(this.parent.enableMultiTaskbar)for(var n=t.querySelectorAll("."+V),s=0;s<n.length;s++){r=n[s],a=!i.expanded&&i.hasChildRecords?i.childRecords[s]:a;var o="ResourceView"===this.parent.viewType?r.getAttribute("rowUniqueId"):a.ganttProperties.taskId.toString();(t=(t=this.parent.getRowByID(o))||r.querySelector(".e-gantt-child-taskbar"))&&this.customizeTaskbars(a,t,r)}else{var l=t.querySelector("."+V);t&&this.customizeTaskbars(a,t,l)}}},i.prototype.updateQueryTaskbarInfoArgs=function(e,t,i){var r,a=e.rowElement,n=this.parent.enableVirtualization?e.rowElement:e.taskbarElement,s=this.getClassName(e);e.data.ganttProperties.segments&&e.data.ganttProperties.segments.length>0&&(r=a.parentElement.parentElement.parentElement),"Milestone"===e.taskbarType?(n.querySelector(s[0])&&getComputedStyle(n.querySelector(s[0])).backgroundColor!==e.milestoneColor&&(n.querySelector(s[0]).style.backgroundColor=e.milestoneColor),a.querySelector(s[1])&&getComputedStyle(a.querySelector(s[1])).backgroundColor!==e.baselineColor&&(a.querySelector(s[1]).style.backgroundColor=e.baselineColor),a.querySelector("."+z)&&getComputedStyle(a.querySelector("."+z)).borderTopColor!==e.baselineColor&&(a.querySelector("."+z).style.backgroundColor=e.baselineColor)):n&&(n.querySelector(s[0])&&getComputedStyle(n.querySelector(s[0])).backgroundColor!==e.taskbarBgColor&&(n.querySelector(s[0]).style.backgroundColor=e.taskbarBgColor),n.querySelector(s[0])&&getComputedStyle(n.querySelector(s[0])).outlineColor!==e.taskbarBorderColor&&(n.querySelector(s[0]).style.outlineColor=e.taskbarBorderColor),n.querySelector(s[1])&&getComputedStyle(n.querySelector(s[1])).backgroundColor!==e.progressBarBgColor&&(n.querySelector(s[1]).style.backgroundColor=e.progressBarBgColor),n.classList.contains(ie)&&getComputedStyle(n).backgroundColor!==e.taskbarBgColor&&(n.style.backgroundColor=e.taskbarBgColor),n.classList.contains(ie)&&getComputedStyle(n).outlineColor!==e.taskbarBorderColor&&(n.style.outlineColor=e.taskbarBorderColor),n.classList.contains(re)&&getComputedStyle(n).backgroundColor!==e.progressBarBgColor&&(n.style.backgroundColor=e.progressBarBgColor),n.querySelector("."+B)&&getComputedStyle(n.querySelector("."+B)).color!==e.taskLabelColor&&(n.querySelector("."+B).style.color=e.taskLabelColor),r?r.querySelector("."+z)&&getComputedStyle(r.querySelector("."+z)).backgroundColor!==e.baselineColor&&(r.querySelector("."+z).style.backgroundColor=e.baselineColor):a.querySelector("."+z)&&getComputedStyle(a.querySelector("."+z)).backgroundColor!==e.baselineColor&&(a.querySelector("."+z).style.backgroundColor=e.baselineColor)),r?(r.querySelector("."+F)&&r.querySelector("."+F).querySelector("."+fe)&&getComputedStyle(r.querySelector("."+F).querySelector("."+fe)).color!==e.leftLabelColor&&(r.querySelector("."+F).querySelector("."+fe).style.color=e.leftLabelColor),r.querySelector("."+N)&&r.querySelector("."+N).querySelector("."+fe)&&getComputedStyle(r.querySelector("."+N).querySelector("."+fe)).color!==e.rightLabelColor&&(r.querySelector("."+N).querySelector("."+fe).style.color=e.rightLabelColor)):(a.querySelector("."+F)&&a.querySelector("."+F).querySelector("."+fe)&&getComputedStyle(a.querySelector("."+F).querySelector("."+fe)).color!==e.leftLabelColor&&(a.querySelector("."+F).querySelector("."+fe).style.color=e.leftLabelColor),a.querySelector("."+N)&&a.querySelector("."+N).querySelector("."+fe)&&getComputedStyle(a.querySelector("."+N).querySelector("."+fe)).color!==e.rightLabelColor&&(a.querySelector("."+N).querySelector("."+fe).style.color=e.rightLabelColor))},i.prototype.getClassName=function(e){var t=[];return t.push("."+("ParentTask"===e.taskbarType?de:"ChildTask"===e.taskbarType?ie:te)),t.push("."+("ParentTask"===e.taskbarType?he:"ChildTask"===e.taskbarType?re:q)),t},i.prototype.templateCompiler=function(t){if(!(0,e.isNullOrUndefined)(t)&&""!==t)try{return"function"!=typeof t&&document.querySelectorAll(t).length?(0,e.compile)(document.querySelector(t).innerHTML.trim(),this.parent):(0,e.compile)(t,this.parent)}catch(i){return(0,e.compile)(t,this.parent)}return null},i.prototype.updateOverlapped=function(){for(var t=0;t<this.parent.treeGrid.parentData.length;t++)for(var i=this.parent.treeGrid.parentData[t].childRecords,r=0;r<i.length;r++){i[r+1]&&(i[r].ganttProperties.eOverlapped=void 0);for(var a=r+1;a<i.length;a++)i[a].ganttProperties.eOverlapped=void 0,i[r].ganttProperties.startDate.getTime()<i[a].ganttProperties.endDate.getTime()&&i[r].ganttProperties.endDate.getTime()>i[a].ganttProperties.startDate.getTime()?(i[a].ganttProperties.eOverlapped=!0,i[r].ganttProperties.eOverlapped=!0):((0,e.isNullOrUndefined)(i[a].ganttProperties.eOverlapped)&&(i[a].ganttProperties.eOverlapped=!1),(0,e.isNullOrUndefined)(i[r].ganttProperties.eOverlapped)&&(i[r].ganttProperties.eOverlapped=!1))}},i.prototype.updateDragDropRecords=function(e,t){var i=e.childRecords,r=this.parent.currentViewData.indexOf(e),a=this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2].children[0].offsetHeight:this.parent.element.getElementsByClassName("e-content")[0].children[0].offsetHeight;t||(t=this.ganttChartTableBody.childNodes[r]),this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll?t.style.height=this.parent.treeGrid.getRowByIndex(r).style.height=this.parent.rowHeight+"px":t.style.height=this.parent.treeGrid.getRows()[r].style.height=this.parent.rowHeight+"px",this.parent.contentHeight=a;var n=[],s=0;if(e){for(var o=0;o<i.length;o++)for(var l=o+1;l<i.length;l++)for(var d=t.getElementsByClassName("e-taskbar-main-container"),h=0;h<d.length;h++){var p="ResourceView"===this.parent.viewType?i[l].rowUniqueID:i[l].ganttProperties.rowUniqueID;i[o].ganttProperties.startDate.getTime()<i[l].ganttProperties.endDate.getTime()&&i[o].ganttProperties.endDate.getTime()>i[l].ganttProperties.startDate.getTime()?d[h].getAttribute("rowuniqueid")===p&&-1===n.indexOf(p)&&(n.push(p),s++,t.children[0].style.verticalAlign="baseline",t.getElementsByClassName("e-taskbar-main-container")[h].style.marginTop=s*this.parent.rowHeight+this.taskBarMarginTop+"px",this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll?t.style.height=this.parent.treeGrid.getRowByIndex(r).style.height=parseInt(t.style.height,10)+this.parent.rowHeight+"px":t.style.height=this.parent.treeGrid.getRows()[r].style.height=parseInt(t.style.height,10)+this.parent.rowHeight+"px"):d[h].getAttribute("rowuniqueid")===p&&-1===n.indexOf(p)&&this.parent.rowDragAndDropModule&&this.parent.rowDragAndDropModule.draggedRecord&&d[h].getAttribute("rowuniqueid")===this.parent.rowDragAndDropModule.draggedRecord.rowUniqueID&&this.parent.rowDragAndDropModule.draggedRecord.rowUniqueID===i[l].rowUniqueID&&(t.getElementsByClassName("e-taskbar-main-container")[h].style.marginTop=this.parent.editModule.taskbarEditModule.draggedRecordMarginTop)}this.parent.contentHeight=a,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px"}},i.prototype.refreshRow=function(t,i,r){var a,n=this,s=this.ganttChartTableBody.childNodes[t];if(a=r?this.parent.previousFlatData[t]:this.parent.currentViewData[t],-1!==t&&a){var o=a;!this.parent.allowTaskbarOverlap&&o.expanded&&(this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll?s.style.height=this.parent.treeGrid.getRowByIndex(t).style.height=this.parent.rowHeight+"px":s.style.height=this.parent.treeGrid.getRows()[t].style.height=this.parent.rowHeight+"px"),o.hasChildRecords&&!o.expanded&&this.parent.enableMultiTaskbar?(s.replaceChild(this.getGanttChartRow(t,o).childNodes[0],s.childNodes[0]),this.parent.renderBaseline&&o.childRecords.forEach((function(t){(0,e.isNullOrUndefined)(t.ganttProperties.baselineStartDate&&t.ganttProperties.baselineEndDate)||s.childNodes[0].appendChild(n.updateTaskBaselineNode(t)[0])}))):this.parent.allowTaskbarDragAndDrop&&!o.expanded?s.replaceWith(this.getGanttChartRow(t,o)):s.replaceChild(this.getGanttChartRow(t,o).childNodes[0],s.childNodes[0]),this.parent.renderTemplates(),o.hasChildRecords&&this.parent.showOverAllocation&&this.parent.allowTaskbarOverlap&&(i?this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData):(this.parent.dataOperation.updateOverlappingValues(o),this.parent.ganttChartModule.renderRangeContainer([o])));var l=!(0,e.isNullOrUndefined)(o.ganttProperties.segments)&&o.ganttProperties.segments.length;if(l>0)for(var d=0;d<l;d++){var h=s.getElementsByClassName("e-segmented-taskbar")[d];this.triggerQueryTaskbarInfoByIndex(h,o)}else this.triggerQueryTaskbarInfoByIndex(s,o);var p="ProjectView"===this.parent.viewType?o.ganttProperties.taskId:o.ganttProperties.rowUniqueID;this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll||this.parent.treeGrid.grid.setRowData(p,o),o.hasChildRecords&&!o.expanded&&this.parent.enableMultiTaskbar&&!this.parent.allowTaskbarOverlap&&this.updateDragDropRecords(a,s),o.hasChildRecords&&this.parent.showOverAllocation&&!this.parent.allowTaskbarOverlap&&(this.parent.dataOperation.updateOverlappingValues(o),this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData));var u=this.parent.ganttChartModule.tempNextElement;this.parent.ganttChartModule.isEditableElement&&u&&(this.parent.treeGrid.grid.focusModule.focus(),(0,e.addClass)([this.parent.treeGrid.getRows()[s.getAttribute("data-rowindex")].children[this.parent.ganttChartModule.childrenIndex]],"e-focused"),this.parent.ganttChartModule.tempNextElement=null);var c=this.parent.treeGrid.grid.getRowObjectFromUID(this.parent.treeGrid.grid.getDataRows()[t].getAttribute("data-uid"));(0,e.isNullOrUndefined)(c)||(c.data=o)}},i.prototype.updateResourceTaskbarElement=function(t,i){var r=t.querySelector(".e-taskbar-main-container");"ProjectView"===this.parent.viewType&&t.querySelector(".e-collapse-parent")&&(r=t.querySelector(".e-collapse-parent")),null===t.querySelector(".e-collapse-parent")&&(0,e.addClass)([r],"collpse-parent-border");var a=t.querySelector("."+V).getAttribute("rowUniqueId"),n=this.parent.getRecordByID(a);if(!(0,e.isNullOrUndefined)(n)&&n.ganttProperties.segments&&n.ganttProperties.segments.length>0)for(var s=r.getElementsByClassName("e-segmented-taskbar"),o=0;o<s.length;o++)this.triggerQueryTaskbarInfoByIndex(s[o],n);else if(this.parent.queryTaskbarInfo){var l=r.querySelector(".e-gantt-child-taskbar");(0,e.isNullOrUndefined)(l)||this.triggerQueryTaskbarInfoByIndex(l,n)}var d="";n&&!(0,e.isNullOrUndefined)(n.ganttProperties.eOverlapIndex)&&(d=n.ganttProperties.eOverlapIndex.toString());var h=r.cloneNode(!0);h.style.zIndex=d,i[0].childNodes[0].childNodes[0].childNodes[0].appendChild(h)},i.prototype.refreshRecords=function(e,t,i){if(this.parent.isGanttChartRendered){if(this.parent.renderTemplates(),this.parent.enableMultiTaskbar){e=new r.DataManager(e).executeLocal((new r.Query).sortBy("expanded","Descending"))}for(var a=0;a<e.length;a++){var n=void 0;n=i?this.parent.ids.indexOf(e[a].ganttProperties.taskId.toString()):this.parent.currentViewData.indexOf(e[a]),this.parent.enableMultiTaskbar&&(!this.parent.enableMultiTaskbar||!e[a].expanded&&this.parent.isLoad)||this.refreshRow(n,t,i)}this.parent.ganttChartModule.updateLastRowBottomWidth()}},i.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("renderPanels",this.createChartTable),this.parent.off("dataReady",this.initiateTemplates),this.parent.off("destroy",this.destroy))},i.prototype.destroy=function(){this.removeEventListener()},i.prototype.generateAriaLabel=function(e){e=this.templateData;var t="",i=this.parent.localeObj.getConstant("name"),r=this.parent.localeObj.getConstant("startDate"),a=this.parent.localeObj.getConstant("endDate"),n=this.parent.localeObj.getConstant("duration"),s=e.ganttProperties.taskName,o=e.ganttProperties.startDate,l=e.ganttProperties.endDate,d=e.ganttProperties.duration;return e.ganttProperties.isMilestone?t=i+" "+s+" "+r+" "+this.parent.getFormatedDate(o):(s&&(t+=i+" "+s+" "),o&&(t+=r+" "+this.parent.getFormatedDate(o)+" "),l&&(t+=a+" "+this.parent.getFormatedDate(l)+" "),d&&(t+=n+" "+this.parent.getDurationString(d,e.ganttProperties.durationUnit))),t},i.prototype.generateBaselineAriaLabel=function(e){e=this.templateData;var t="",i=this.parent.localeObj.getConstant("name"),r=this.parent.localeObj.getConstant("startDate"),a=this.parent.localeObj.getConstant("endDate"),n=e.ganttProperties.taskName,s=e.ganttProperties.baselineStartDate,o=e.ganttProperties.baselineEndDate;return t+="Baseline ",t+=i+" "+n+" ",t+=r+" "+this.parent.getFormatedDate(s)+" ",t+=a+" "+this.parent.getFormatedDate(o)+" "},i.prototype.generateSpiltTaskAriaLabel=function(e,t){var i="",r=this.parent.localeObj.getConstant("startDate"),a=this.parent.localeObj.getConstant("endDate"),n=this.parent.localeObj.getConstant("duration"),s=e.startDate,o=e.endDate,l=e.duration;return s&&(i+=r+" "+this.parent.getFormatedDate(s)+" "),o&&(i+=a+" "+this.parent.getFormatedDate(o)+" "),l&&(i+=n+" "+this.parent.getDurationString(l,t.durationUnit)),i},i.prototype.generateTaskLabelAriaLabel=function(e){var t="";return"left"===e&&this.parent.labelSettings.leftLabel&&!this.leftTaskLabelTemplateFunction?t+=this.parent.localeObj.getConstant("leftTaskLabel")+" "+this.getTaskLabel(this.parent.labelSettings.leftLabel):"right"===e&&this.parent.labelSettings.rightLabel&&!this.rightTaskLabelTemplateFunction&&(t+=this.parent.localeObj.getConstant("rightTaskLabel")+" "+this.getTaskLabel(this.parent.labelSettings.rightLabel)),t},i}(w),$t=function(){function t(e){this.parentRecord=[],this.parentIds=[],this.parentPredecessors=[],this.validatedParentIds=[],this.storeId=null,this.isChildRecordValidated=[],this.parent=e,this.dateValidateModule=this.parent.dateValidationModule}return t.prototype.ensurePredecessorCollection=function(){for(var e=this.parent.predecessorsCollection,t=e.length-1;t>=0;t--){var i=e[t],r=i.ganttProperties;(!i.hasChildRecords&&!this.parent.allowParentDependency||this.parent.allowParentDependency)&&this.ensurePredecessorCollectionHelper(i,r)}},t.prototype.ensurePredecessorCollectionHelper=function(t,i){var r=i.predecessorsName;if(!r||"string"!=typeof r&&"number"!=typeof r){if(r&&"object"==typeof r&&r.length){for(var a=[],n=0;n<r.length;n++){var s=r[n],o={};o.from=(0,e.getValue)("from",s)?(0,e.getValue)("from",s):r[n],o.to=(0,e.getValue)("to",s)?(0,e.getValue)("to",s):i.rowUniqueID,o.type=(0,e.getValue)("type",s)?(0,e.getValue)("type",s):"FS";var l=(0,e.getValue)("offset",s);if((0,e.isNullOrUndefined)(l))o.offset=0,o.offsetUnit=this.parent.durationUnit.toLocaleLowerCase();else if("string"==typeof l){var d=this.getOffsetDurationUnit((0,e.getValue)("offset",s));o.offset=d.duration,o.offsetUnit=d.durationUnit}else o.offset=parseFloat(l.toString()),o.offsetUnit=this.parent.durationUnit.toLocaleLowerCase();this.checkIsParent(o.from.toString())||a.push(o)}this.parent.setRecordValue("predecessor",a,i,!0)}}else this.parent.setRecordValue("predecessor",this.calculatePredecessor(r,t),i,!0);this.parent.setRecordValue("predecessorsName",this.getPredecessorStringValue(t),i,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,i.predecessorsName,t),this.parent.setRecordValue(this.parent.taskFields.dependency,i.predecessorsName,t)},t.prototype.updateUnscheduledDependency=function(t){for(var i=this.parent.taskFields,r=(0,e.isNullOrUndefined)(t[i.dependency])?[]:t[i.dependency].toString().split(","),a=0;a<r.length;a++){var n=parseInt(r[a],10);if(!isNaN(n)){var s=this.parent.getRecordByID(n.toString()),o=(0,e.isNullOrUndefined)(s)?null:(0,e.extend)({},{},s.taskData,!0);!(0,e.isNullOrUndefined)(o)&&(0,e.isNullOrUndefined)(o[i.startDate])&&(0,e.isNullOrUndefined)(o[i.duration])&&(0,e.isNullOrUndefined)(o[i.endDate])&&(o[i.duration]=1,o[i.startDate]=this.parent.projectStartDate,this.parent.updateRecordByID(o))}}},t.prototype.checkIsParent=function(e){var t=!1;return this.parent.connectorLineModule.getRecordByID(e).hasChildRecords&&(t=!0),t},t.prototype.calculatePredecessor=function(t,i){var r,a,n,s=this,o=t.toString(),l=[],d=[],h=[];o.split(",").forEach((function(t){var o,p,u,c=!1,g=!1,f=t.split("-");if(6===f.length&&(f[4]=f[4]+"-"+f[5],f.pop()),5===f.length&&f[4].length>=12&&(u=t.substring(0,36),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(u)&&(c=!0)),t.includes("-")){var m=t.lastIndexOf("-"),y=t.substring(m+1),D=void 0;if(D=t.includes(s.parent.localeObj.getConstant("days"))?y.includes(".")?11:9:t.includes(s.parent.localeObj.getConstant("day"))?y.includes(".")?10:8:2,p=t.slice(-D).toString(),t.includes("-")&&/[A-Za-z]/.test(p)){var v=t.indexOf(p);-1!==v&&(o=t.substring(0,v)).includes("-")&&(g=!0)}}if(c){var k=void 0,w=void 0;1===(k=f[4].split("+")).length?d[0]=t:(w=k[1].length,d[0]=t.slice(0,-(w+1)),d[1]=k[1]),a="+",f[4].indexOf("-")>=0&&(1===(k=f[4].split("-")).length?d[0]=t:(w=k[1].length,d[0]=t.slice(0,-(w+1)),d[1]=k[1]),a="-")}else g&&o.includes("-")?d[0]=o:(d=t.split("+"),a="+",t.indexOf("-")>=0&&(d=t.split("-"),a="-"));r=[];var b="ResourceView"===s.parent.viewType?s.parent.getTaskIds():s.parent.ids;-1!==("ResourceView"===s.parent.viewType?b.indexOf("T"+d[0]):b.indexOf(d[0]))?r[0]=d[0]:-1===b.indexOf(d[0])?1===(r=d[0].split(" ")).length&&(-1!==r[0].indexOf(" ")?r=d[0].match(/(\d+|[A-z]+)/g):(r[0]=d[0].slice(0,-2),r[1]=d[0].slice(-2))):r[0]=d[0];var T="ResourceView"===s.parent.viewType?b.indexOf("T"+r[0]):b.indexOf(r[0]);if(r[0]&&-1!==T){if(r.length>1)if("FS"===(S=r[1].toUpperCase())||"FF"===S||"SF"===S||"SS"===S)n=S;else{var P="The provided dependency type, "+S+", is invalid. Please ensure that the Dependency Type is FS or FF or SS or SF";s.parent.trigger("actionFailure",{error:P}),n="FS"}else if(t.includes("-")&&/[A-Za-z]/.test(p)&&o.includes("-")){var S;(S=t.slice(-2).toString()).toUpperCase(),n="FS"===S||"FF"===S||"SF"===S||"SS"===S?S:"FS"}else n="FS";var C=d.length>1?a+""+d[1]:"0",R=s.getOffsetDurationUnit(C),M={from:r[0],type:n,isDrawn:!1,to:"ResourceView"===s.parent.viewType?i.ganttProperties.taskId.toString():i.ganttProperties.rowUniqueID.toString(),offsetUnit:R.durationUnit,offset:R.duration},x=s.checkIsParent(r[0]);if(s.parent.allowParentDependency){var O=s.parent.connectorLineModule.getRecordByID(M.to),I=s.parent.connectorLineModule.getRecordByID(M.from);s.parent.connectorLineEditModule&&I&&O?s.parent.connectorLineEditModule.validateParentPredecessor(I,O)&&(l.push(M),-1===h.indexOf(I)&&I.hasChildRecords&&s.parent.editModule.cellEditModule&&s.parent.editModule.cellEditModule.isCellEdit&&h.push((0,e.extend)([],[],[I],!0)[0])):l.push(M),r.splice(0)}else x||l.push(M)}})),h.length>0&&this.parent.undoRedoModule&&this.parent.editModule&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit&&(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1].connectedRecords=h);var p=[];return l.map((function(e){var t,i=e.from,r=e.to;t=l.filter((function(e){return e.from===i&&e.to===r})),-1===p.indexOf(t[t.length-1])&&p.push(t[t.length-1])})),p},t.prototype.getPredecessorStringValue=function(e){var t,i=e.ganttProperties.predecessor,r="",a=[];if(i)for(var n=i.length,s=0;s<n;s++){var o=i[s],l="",d="ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID;if(o.from!==d.toString()){if(l=o.from+o.type,"string"==typeof e.ganttProperties.taskId?(a[0]=l.slice(0,-2),a[1]=l.slice(-2),t=a[0]+" "+a[1]):t=l,l=t,0!==o.offset){l+=o.offset>0?"+"+o.offset+" ":o.offset+" ";var h=1!==o.offset;"day"===o.offsetUnit?l+=h?this.parent.localeObj.getConstant("days"):this.parent.localeObj.getConstant("day"):"hour"===o.offsetUnit?l+=h?this.parent.localeObj.getConstant("hours"):this.parent.localeObj.getConstant("hour"):l+=h?this.parent.localeObj.getConstant("minutes"):this.parent.localeObj.getConstant("minute")}r=r.length>0?r+","+l:l}}return r},t.prototype.getOffsetDurationUnit=function(t){var i=0,r=this.parent.durationUnit.toLocaleLowerCase(),a=this.parent.durationUnitEditText;if("string"==typeof t){for(var n=t.match(/[^0-9]+|[0-9]+/g),s=0;s<n.length;s++)n[s]=n[s].trim();"-"===n[0]&&n[1]?(n[1]=n[0]+n[1],n.shift()):"+"===n[0]&&n.shift(),"."!==n[1]||isNaN(parseInt(n[2],10))||(n[0]+=n[1]+n[2],n.splice(1,2)),n&&n.length<=2&&(i=parseFloat(n[0]),r=n[1]?n[1].toLowerCase().trim():"",r=-1!==(0,e.getValue)("minute",a).indexOf(r)?"minute":-1!==(0,e.getValue)("hour",a).indexOf(r)?"hour":-1!==(0,e.getValue)("day",a).indexOf(r)?"day":this.parent.durationUnit.toLocaleLowerCase())}else i=t,r=this.parent.durationUnit.toLocaleLowerCase();if(isNaN(i)){this.parent.trigger("actionFailure",{error:"The provided value for the offset field is invalid.Please ensure the offset field contains only valid numeric values"}),i=0,r=this.parent.durationUnit.toLocaleLowerCase()}return{duration:i,durationUnit:r}},t.prototype.updatePredecessors=function(){for(var e,t=this.parent.predecessorsCollection,i=t.length,r=0;r<i;r++)(!(e=t[r]).hasChildRecords&&!this.parent.allowParentDependency||this.parent.allowParentDependency)&&(this.updatePredecessorHelper(e,t),!e.ganttProperties.isAutoSchedule&&this.parent.editSettings.allowEditing&&(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.parent.connectorLineEditModule.calculateOffset(e)))},t.prototype.updatePredecessorHelper=function(t,i){var r,a=t.ganttProperties.predecessor,n=a.length;i=(0,e.isNullOrUndefined)(i)?[]:i;for(var s=0;s<n;s++){var o=a[s];r=this.parent.connectorLineModule.getRecordByID(o.from);var l="ResourceView"===this.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID;if(o.from!==l.toString()&&r){var d=void 0;r.ganttProperties.predecessor?((d=(0,e.extend)([],r.ganttProperties.predecessor,[],!0)).push(o),this.parent.setRecordValue("predecessor",d,r.ganttProperties,!0)):((d=[]).push(o),this.parent.setRecordValue("predecessor",d,r.ganttProperties,!0),i.push(r))}}},t.prototype.traverseParents=function(e){this.parent.dataOperation.updateParentItems(e)},t.prototype.updatedRecordsDateByPredecessor=function(){if(this.parent.autoCalculateDateScheduling&&(!this.parent.isLoad||this.parent.treeGrid.loadChildOnDemand||!this.parent.taskFields.hasChildMapping))for(var e=this.parent.flatData,t=this.parent.flatData.length,i=0;i<t;i++)if(e[i].ganttProperties.predecessorsName){this.validatePredecessorDates(e[i]);var r=e[i].ganttProperties.predecessor;if(r&&r.length>1)for(var a=0;a<r.length;a++){var n=this.parent.getRecordByID(r[a].to);n&&this.validatePredecessorDates(n)}if(e[i].hasChildRecords&&this.parent.editModule&&e[i].ganttProperties.startDate&&this.parent.allowParentDependency&&this.updateChildItems(e[i]),e[i].parentItem&&!this.parent.isLoad){var s=e[i].parentItem.taskId;this.traverseParents(this.parent.getRecordByID(s))}}},t.prototype.updateParentPredecessor=function(){if(this.parent.enablePredecessorValidation)for(var e=this.parentPredecessors.length-1;e>=0;e--){var t=this.parentPredecessors[e];this.validatePredecessorDates(t),t.ganttProperties.startDate&&this.updateChildItems(t)}},t.prototype.validatePredecessorDates=function(t){if(t.ganttProperties.predecessor){var i=t.ganttProperties.predecessor,r=void 0,a=void 0,n=null,s="ResourceView"===this.parent.viewType?t.ganttProperties.taskId.toString():t.ganttProperties.rowUniqueID.toString(),o=i.filter((function(e){return e.to===s?e:null}));for(r=0;r<o.length;r++){var l=o[r];if(a=this.parent.connectorLineModule.getRecordByID(l.from),n=this.parent.connectorLineModule.getRecordByID(l.to),"ProjectView"===this.parent.viewType&&this.parent.allowTaskbarDragAndDrop){var d=void 0;(0,e.isNullOrUndefined)(n)?(d=this.parent.editModule.taskbarEditModule.previousIds.indexOf(l.to),n=this.parent.editModule.taskbarEditModule.previousFlatData[d]):(0,e.isNullOrUndefined)(a)&&(d=this.parent.editModule.taskbarEditModule.previousIds.indexOf(l.from),a=this.parent.editModule.taskbarEditModule.previousFlatData[d])}this.parent.allowParentDependency&&this.parent.isLoad&&-1===this.parentPredecessors.indexOf(t)&&(t.hasChildRecords||n.hasChildRecords)&&this.parentPredecessors.push(t),(n.ganttProperties.isAutoSchedule||this.parent.validateManualTasksOnLinking)&&this.validateChildGanttRecord(a,n)}}},t.prototype.validateChildGanttRecord=function(t,i){if(!(this.parent.editedTaskBarItem===i||t&&(0,e.isNullOrUndefined)(n(t.ganttProperties))||i&&(0,e.isNullOrUndefined)(n(i.ganttProperties)))&&this.parent.isInPredecessorValidation&&(i.ganttProperties.isAutoSchedule||this.parent.validateManualTasksOnLinking)){var r=i.ganttProperties,a="ResourceView"===this.parent.viewType?r.taskId.toString():r.rowUniqueID.toString(),s=r.predecessor.filter((function(e){return e.to===a?e:null})),o=this.getPredecessorDate(i,s);this.parent.setRecordValue("startDate",o,r,!0),this.parent.dataOperation.updateMappingData(i,"startDate");var l=i.ganttProperties.segments;((0,e.isNullOrUndefined)(l)||!(0,e.isNullOrUndefined)(l)&&0===l.length)&&this.dateValidateModule.calculateEndDate(i),this.parent.dataOperation.updateWidthLeft(i),!this.parent.isLoad&&!this.parent.isFromOnPropertyChange&&i.parentItem&&this.parent.isInPredecessorValidation&&this.parent.getParentTask(i.parentItem).ganttProperties.isAutoSchedule&&-1===this.parentIds.indexOf(i.parentItem.uniqueID)&&(this.parentIds.push(i.parentItem.uniqueID),this.parentRecord.push(i.parentItem))}},t.prototype.getPredecessorDate=function(t,i){var r,a,n,s,o=this,l=i.filter((function(e){var i="ResourceView"===o.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID;return e.to===i.toString()?e:null}));if(l)for(var d=l.length,h=0;h<d;h++){var p=l[h];n=this.parent.connectorLineModule.getRecordByID(p.from),s=this.parent.connectorLineModule.getRecordByID(p.to),"ProjectView"!==this.parent.viewType||!this.parent.allowTaskbarDragAndDrop||(0,e.isNullOrUndefined)(s)&&(0,e.isNullOrUndefined)(n)||(s=(0,e.isNullOrUndefined)(s)?this.getRecord(n,s,p):s,n=(0,e.isNullOrUndefined)(n)?this.getRecord(n,s,p):n),s&&n&&(a=this.getValidatedStartDate(s.ganttProperties,n.ganttProperties,p)),null!==r&&1!==this.dateValidateModule.compareDates(a,r)||(r=a)}return r},t.prototype.getValidatedStartDate=function(e,t,i){var r,a,n=i.type,s=i.offset;switch(n){case"FS":r=this.dateValidateModule.getValidEndDate(t),e.isMilestone&&0===s||(r=this.dateValidateModule.checkStartDate(r,e)),0!==s&&(r=this.updateDateByOffset(r,i,e)),a=e.isMilestone?r:this.dateValidateModule.checkStartDate(r,e);break;case"FF":case"SF":if(r="FF"===n?this.dateValidateModule.getValidEndDate(t):this.dateValidateModule.getValidStartDate(t),0!==s&&(r=this.updateDateByOffset(r,i,e)),!e.isMilestone){var o=new Date(r);o.setDate(o.getDate()-1),r=this.dateValidateModule.checkEndDate(r,e)}if(e.segments&&0!==e.segments.length){var l=this.dateValidateModule.getDuration(e.startDate,e.endDate,e.durationUnit,e.isAutoSchedule,e.isMilestone);a=this.dateValidateModule.getStartDate(r,l,e.durationUnit,e)}else a=this.dateValidateModule.getStartDate(r,e.duration,e.durationUnit,e);break;case"SS":r=this.dateValidateModule.getValidStartDate(t),0!==s&&(r=this.updateDateByOffset(r,i,e)),a=e.isMilestone?r:this.dateValidateModule.checkStartDate(r,e)}return a},t.prototype.updateDateByOffset=function(t,i,r){var a,n=i.offset,s=i.offsetUnit;return n<0&&!(0,e.isNullOrUndefined)(t)?a=this.dateValidateModule.getStartDate(this.dateValidateModule.checkEndDate(t,r),-1*n,s,r,!0):((0,e.isNullOrUndefined)(t)||(a=this.dateValidateModule.getEndDate(t,n,s,r,!1)),r.isMilestone||(a=this.dateValidateModule.checkStartDate(a,r))),a},t.prototype.createConnectorLinesCollection=function(e){var t=e||this.parent.currentViewData;this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.pdfExportModule.isPdfExport&&(t=this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneCurrentViewData);var i,r,a=t.length;for(this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.pdfExportModule.isPdfExport?this.parent.connectorLineModule.expandedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.getExpandedRecords(this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData):this.parent.connectorLineModule.expandedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.updatedRecords:this.parent.getExpandedRecords(this.parent.updatedRecords),i=0;i<a;i++){if(this.parent.editModule&&this.parent.editModule.deletedTaskDetails.length>0&&t[i].parentItem){var n=this.parent.getRecordByID(t[i].parentItem.taskId.toString());this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(n),t[i])}this.parent.undoRedoModule&&this.parent.undoRedoModule.canUpdateIndex&&(t[i].index=i,t[i].parentItem&&this.parent.getParentTask(t[i].parentItem)&&(t[i].parentItem.index=this.parent.getParentTask(t[i].parentItem).index)),(r=t[i].ganttProperties.predecessor)&&this.addPredecessorsCollection(r)}},t.prototype.addPredecessorsCollection=function(e){var t,i,r,a,n;if(e)for(t=e.length,i=0;i<t;i++){r=e[i];a=this.parent.connectorLineModule.getRecordByID(r.from),n=this.parent.connectorLineModule.getRecordByID(r.to);var s=!0;(a&&a.hasChildRecords&&!a.expanded||n&&n.hasChildRecords&&!n.expanded)&&!this.parent.allowTaskbarOverlap&&"ProjectView"===this.parent.viewType&&(s=!1),s&&this.parent.connectorLineModule.expandedRecords&&-1!==this.parent.connectorLineModule.expandedRecords.indexOf(a)&&-1!==this.parent.connectorLineModule.expandedRecords.indexOf(n)&&this.updateConnectorLineObject(a,n,r)}},t.prototype.updateConnectorLineObject=function(e,t,i){var r=this.parent.connectorLineModule.createConnectorLineObject(e,t,i);if(r){if(t.isCritical&&e.isCritical&&(r.isCritical=!0),this.parent.connectorLineIds.length>0&&-1===this.parent.connectorLineIds.indexOf(r.connectorLineId)||0===this.parent.connectorLineIds.length)this.parent.updatedConnectorLineCollection.push(r),this.parent.connectorLineIds.push(r.connectorLineId);else if(-1!==this.parent.connectorLineIds.indexOf(r.connectorLineId)){var a=this.parent.connectorLineIds.indexOf(r.connectorLineId);this.parent.updatedConnectorLineCollection[a]=r}i.isDrawn=!0}return r},t.prototype.validatePredecessor=function(t,i,r){if(this.parent.isInPredecessorValidation&&t.ganttProperties.predecessor){var a=this.parent.editModule.taskbarEditModule,n=void 0;a&&(n=a.taskBarEditRecord);for(var s=t.ganttProperties.predecessor,o=void 0,l=null,d=void 0,h=void 0,p="ResourceView"===this.parent.viewType?t.ganttProperties.taskId.toString():t.ganttProperties.rowUniqueID.toString(),u=s.filter((function(e){return e.to===p?e:null})),c=s.filter((function(e){return e.from===p?e:null})),g=void 0,f=0;f<u.length;f++){d=u[f],o=this.parent.connectorLineModule.getRecordByID(d.from),(l=this.parent.connectorLineModule.getRecordByID(d.to)).parentItem&&(g=this.parent.getTaskByUniqueID(l.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(g)&&this.parent.editModule.updateParentRecords.push(g)),o.parentItem&&(g=this.parent.getTaskByUniqueID(o.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(g)&&this.parent.editModule.updateParentRecords.push(g)),"ProjectView"!==this.parent.viewType||!this.parent.allowTaskbarDragAndDrop||(0,e.isNullOrUndefined)(l)&&(0,e.isNullOrUndefined)(o)||(l=(0,e.isNullOrUndefined)(l)?this.getRecord(o,l,d):l,o=(0,e.isNullOrUndefined)(o)?this.getRecord(o,l,d):o),this.parent.isInPredecessorValidation&&l.ganttProperties.isAutoSchedule?this.parent.isValidationEnabled=!0:this.parent.isValidationEnabled=!1;var m="ResourceView"===this.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID;m.toString()!==d.to&&m.toString()!==d.from||r&&"predecessor"!==r||(this.validateChildGanttRecord(o,l),this.parent.editModule.editedRecord&&this.parent.editModule.editedRecord.hasChildRecords&&!this.parent.editModule.editedRecord.parentItem&&(this.isValidatedParentTaskID=l.ganttProperties.taskId))}for(f=0;f<c.length;f++){if(h=c[f],o=this.parent.connectorLineModule.getRecordByID(h.from),(l=this.parent.connectorLineModule.getRecordByID(h.to)).parentItem&&(g=this.parent.getTaskByUniqueID(l.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(g)&&this.parent.editModule.updateParentRecords.push(g)),o.parentItem&&(g=this.parent.getTaskByUniqueID(o.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(g)&&this.parent.editModule.updateParentRecords.push(g)),"ProjectView"!==this.parent.viewType||!this.parent.allowTaskbarDragAndDrop||(0,e.isNullOrUndefined)(l)&&(0,e.isNullOrUndefined)(o)||(l=(0,e.isNullOrUndefined)(l)?this.getRecord(o,l,h):l,o=(0,e.isNullOrUndefined)(o)?this.getRecord(o,l,h):o),this.parent.isInPredecessorValidation&&l.ganttProperties.isAutoSchedule?this.parent.isValidationEnabled=!0:this.parent.isValidationEnabled=!1,"predecessor"!==r&&this.parent.isValidationEnabled){if(this.validateChildGanttRecord(o,l),this.parent.editModule.editedRecord&&l){var y=o.parentItem?this.parent.connectorLineEditModule.getRootParent(o):null;if(l.hasChildRecords&&(!this.parent.editModule.editedRecord.hasChildRecords||!l.parentItem&&(!y||y&&y.ganttProperties.taskId===this.parent.editModule.editedRecord.ganttProperties.taskId))&&this.isValidatedParentTaskID!==l.ganttProperties.taskId){this.updateChildItems(l);for(var D=0;D<l.childRecords.length;D++){var v=l.childRecords[D].ganttProperties;if(-1!==this.isChildRecordValidated.indexOf(v.taskId))return;if(this.isChildRecordValidated.push(v.taskId),v.predecessor&&v.predecessor.length>0)for(var k=0;k<v.predecessor.length;k++){var w=void 0;(w=v.predecessor[k].to!==l.ganttProperties.taskId.toString()?this.parent.flatData[this.parent.ids.indexOf(v.predecessor[k].to)]:this.parent.flatData[this.parent.ids.indexOf(v.predecessor[k].from)])&&(this.validatePredecessor(w,[],""),w.hasChildRecords&&this.parent.editModule.editedRecord.hasChildRecords&&this.updateChildItems(w),this.isValidatedParentTaskID=w.ganttProperties.taskId)}}this.isValidatedParentTaskID=l.ganttProperties.taskId}this.parent.editModule.editedRecord.hasChildRecords&&!this.parent.editModule.editedRecord.parentItem&&(this.isValidatedParentTaskID=l.ganttProperties.taskId)}}else!l.ganttProperties.isAutoSchedule&&this.parent.updateOffsetOnTaskbarEdit&&(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.parent.connectorLineEditModule.calculateOffset(l));if(!1!==o.expanded&&!1!==l.expanded){if(l)if(this.parent.editModule.isFirstCall&&(this.storeId=JSON.parse(JSON.stringify(this.parent.ids)),this.parent.editModule.isFirstCall=!1),this.storeId)-1!==(P=-1!==this.storeId.indexOf(l[this.parent.taskFields.id].toString())?this.storeId.indexOf(l[this.parent.taskFields.id].toString()):-1)&&(this.storeId=this.storeId.slice(0,P).concat(this.storeId.slice(P+1)),this.validatePredecessor(l,void 0,"successor"));else this.validatePredecessor(l,void 0,"successor")}else l&&this.validatePredecessor(l,void 0,"successor")}l&&!l.hasChildRecords&&l.parentItem&&-1===this.validatedParentIds.indexOf(l.parentItem.taskId)&&this.validatedParentIds.push(l.parentItem.taskId);var b=!0;if(l&&l.hasChildRecords&&-1!==this.validatedParentIds.indexOf(l.ganttProperties.taskId.toString())&&(b=!1),b)if(l&&l.ganttProperties.taskId!==this.isValidatedParentTaskID&&n){if("ParentDrag"!==a.taskBarEditAction&&"ChildDrag"!==a.taskBarEditAction&&!n.hasChildRecords&&l.hasChildRecords&&(this.updateChildItems(l),this.isValidatedParentTaskID=l.ganttProperties.taskId),l.parentItem){this.parent.dataOperation.updateParentItems(l,!0);var T=this.parent.getParentTask(l.parentItem),P=this.storeId&&-1!==this.storeId.indexOf(T[this.parent.taskFields.id].toString())?this.storeId.indexOf(T[this.parent.taskFields.id].toString()):-1;if(T.ganttProperties.predecessor&&T.ganttProperties.predecessor.length>0&&-1!==P)for(D=0;D<T.ganttProperties.predecessor.length;D++){if(T.ganttProperties.predecessor[D].to!==T.ganttProperties.taskId.toString())(w=this.parent.flatData[this.parent.ids.indexOf(T.ganttProperties.predecessor[D].to)])&&w.parentItem&&this.validateChildGanttRecord(l,w)}}}else l&&l.hasChildRecords&&this.isValidatedParentTaskID!==l.ganttProperties.taskId&&!n&&(this.updateChildItems(l),this.isValidatedParentTaskID=l.ganttProperties.taskId)}},t.prototype.updateChildItems=function(t){var i=this;if(t.childRecords.length>0&&this.validatedChildItems.length>0){if(!!t.childRecords.some((function(e){return i.validatedChildItems.includes(e)})))return}var r,a=this.parent.previousRecords[t.uniqueID];(0,e.isNullOrUndefined)(a)||(0,e.isNullOrUndefined)(a)&&!(0,e.isNullOrUndefined)(a.ganttProperties)?r=new Date(t.ganttProperties.startDate.getTime()):(0,e.isNullOrUndefined)(a.ganttProperties.startDate)||(r=new Date(a.ganttProperties.startDate.getTime()));var s,o,l,d,h,p=t.ganttProperties.startDate,u=[];if(this.getUpdatableChildRecords(t,u),0!==u.length){!(0,e.isNullOrUndefined)(r)&&!(0,e.isNullOrUndefined)(p)&&r.getTime()>p.getTime()?(s=this.parent.dateValidationModule.checkStartDate(p),o=this.parent.dateValidationModule.checkEndDate(r,t.ganttProperties),d=!1):(s=this.parent.dateValidationModule.checkStartDate(r),o=this.parent.dateValidationModule.checkEndDate(p,t.ganttProperties),d=!0),h=!(0,e.isNullOrUndefined)(s)&&!(0,e.isNullOrUndefined)(o)&&s.getTime()>=o.getTime()?0:this.parent.dateValidationModule.getDuration(s,o,"minute",!0,!1);for(var c=0;c<u.length;c++)if(u[c].ganttProperties.isAutoSchedule)if(h>0){var g=n(u[c].ganttProperties)||u[c].ganttProperties.startDate?u[c].ganttProperties.startDate:u[c].ganttProperties.endDate?u[c].ganttProperties.endDate:new Date(r.toString());l=d?this.parent.dateValidationModule.getEndDate(this.parent.dateValidationModule.checkStartDate(g,u[c].ganttProperties,u[c].ganttProperties.isMilestone),h,"minute",u[c].ganttProperties,!1):this.parent.dateValidationModule.getStartDate(this.parent.dateValidationModule.checkEndDate(g,u[c].ganttProperties),h,"minute",u[c].ganttProperties),this.calculateDateByRoundOffDuration(u[c],l),this.parent.isOnEdit&&-1===this.validatedChildItems.indexOf(u[c])&&this.validatedChildItems.push(u[c])}else(0,e.isNullOrUndefined)(a)&&(l=r,this.calculateDateByRoundOffDuration(u[c],l),this.parent.isOnEdit&&-1===this.validatedChildItems.indexOf(u[c])&&this.validatedChildItems.push(u[c]));u.length&&this.parent.dataOperation.updateParentItems(t,!0)}},t.prototype.getUpdatableChildRecords=function(e,t){for(var i=e.childRecords,r=0;r<i.length;r++)i[r].ganttProperties.isAutoSchedule&&(t.push(i[r]),i[r].hasChildRecords&&this.getUpdatableChildRecords(i[r],t))},t.prototype.calculateDateByRoundOffDuration=function(t,i){var r=t,a=r.ganttProperties,n=new Date(i.getTime());if(!(0,e.isNullOrUndefined)(a.endDate)&&(0,e.isNullOrUndefined)(a.startDate)){var s=this.parent.dateValidationModule.checkStartDate(n,a,null);this.parent.setRecordValue("endDate",this.parent.dateValidationModule.checkEndDate(s,r.ganttProperties),a,!0)}else this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(n,a,!1),a,!0),(0,e.isNullOrUndefined)(a.duration)||this.parent.dateValidationModule.calculateEndDate(r);this.parent.dataOperation.updateWidthLeft(t),this.parent.dataOperation.updateTaskData(r)},t.prototype.getRecord=function(t,i,r){var a,n;return(0,e.isNullOrUndefined)(i)?(a=this.parent.editModule.taskbarEditModule.previousIds.indexOf(r.to),n=this.parent.editModule.taskbarEditModule.previousFlatData[a]):(0,e.isNullOrUndefined)(t)&&(a=this.parent.editModule.taskbarEditModule.previousIds.indexOf(r.from),n=this.parent.editModule.taskbarEditModule.previousFlatData[a]),n},t.prototype.getValidPredecessor=function(t){var i=this,r=[];if(!(0,e.isNullOrUndefined)(t)){var a=t.ganttProperties.predecessor;a&&a.length>0&&(r=a.filter((function(e){var r="ResourceView"===i.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID;return e.from!==r.toString()})))}return r},t}(),ei=m(727),ti=function(){function t(t){this.transform="",this.connectorLinePath="",this.arrowPath="",this.taskLineValue=0,this.expandedRecords=[],this.parent=t,this.dependencyViewContainer=(0,e.createElement)("div",{className:"e-gantt-dependency-view-container"}),Object.assign(this.dependencyViewContainer.style,{width:"100%",height:"100%",zIndex:2,position:"absolute",pointerEvents:"none"}),this.renderer=new ei.SvgRenderer(this.parent.element.id),this.initPublicProp(),this.svgObject=this.renderer.createSvg({id:this.parent.element.id+"_svg"}),this.svgObject.setAttribute("height","100%"),this.svgObject.setAttribute("width","100%")}return t.prototype.getconnectorLineGap=function(e){return e.milestoneChild?this.parent.chartRowsModule.milestoneMarginTop/2+this.parent.chartRowsModule.milestoneHeight/2:this.parent.chartRowsModule.taskBarMarginTop/2+this.parent.chartRowsModule.taskBarHeight/2},t.prototype.initPublicProp=function(){this.lineColor=this.parent.connectorLineBackground,this.lineStroke=this.parent.connectorLineWidth>4?4:this.parent.connectorLineWidth,this.createConnectorLineTooltipTable()},t.prototype.getTaskbarMidpoint=function(e){return Math.floor(e?this.parent.chartRowsModule.milestoneMarginTop+this.parent.chartRowsModule.milestoneHeight/2:this.parent.chartRowsModule.taskBarMarginTop+this.parent.chartRowsModule.taskBarHeight/2)+1},t.prototype.createConnectorLineObject=function(t,i,r){var a,s,o,l={};if(a=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport?this.parent.flatData:this.expandedRecords,this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth){var d=this.parent.flatData.filter((function(e){return e.ganttProperties.taskId.toString()===t.ganttProperties.taskId.toString()}))[0],h=this.parent.flatData.filter((function(e){return e.ganttProperties.taskId.toString()===i.ganttProperties.taskId.toString()}))[0];s=d.index,o=h.index}else s=a.indexOf(t),o=a.indexOf(i);var p,u=t.ganttProperties,c=i.ganttProperties;if(p=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.getExpandedRecords(this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData):this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.currentViewData:this.parent.getExpandedRecords(this.parent.currentViewData),l.parentIndexInCurrentView=p.indexOf(t),l.childIndexInCurrentView=p.indexOf(i),!(this.parent.virtualScrollModule&&this.parent.enableVirtualization)&&(-1===l.parentIndexInCurrentView||-1===l.childIndexInCurrentView)||-1===l.parentIndexInCurrentView&&-1===l.childIndexInCurrentView)return null;l.parentLeft=u.isMilestone?u.left-this.parent.chartRowsModule.milestoneHeight/2:u.left,l.childLeft=c.isMilestone?c.left-this.parent.chartRowsModule.milestoneHeight/2:c.left,l.parentWidth=0===u.width||u.isMilestone?Math.floor(this.parent.chartRowsModule.milestoneHeight):u.width,l.childWidth=0===c.width||c.isMilestone?Math.floor(this.parent.chartRowsModule.milestoneHeight):c.width,l.parentIndex=s,l.childIndex=o,l.rowHeight=!(0,e.isNullOrUndefined)(this.parent.ganttChartModule.getChartRows())&&this.parent.ganttChartModule.getChartRows()[0]&&this.parent.ganttChartModule.getChartRows()[0].getBoundingClientRect().height,l.type=r.type;var g="ResourceView"===this.parent.viewType?u.taskId:u.rowUniqueID,f="ResourceView"===this.parent.viewType?c.taskId:c.rowUniqueID;return l.connectorLineId="parent"+g+"child"+f,l.milestoneParent=!!u.isMilestone,l.milestoneChild=!!c.isMilestone,l.parentEndPoint=l.parentLeft+l.parentWidth,l.childEndPoint=l.childLeft+l.childWidth,(0,e.isNullOrUndefined)(n(u))||(0,e.isNullOrUndefined)(n(c))?null:l},t.prototype.renderConnectorLines=function(e){for(var t="",i=[],r=0;r<e.length;r++)t+=this.getConnectorLineTemplate(e[r]),i.push(e[r]);this.svgObject.innerHTML=t;for(var a=this.parent.connectorLineModule.svgObject.childNodes,n=0;n<a.length;n++)for(var s=a[n].childNodes,o=0;o<s.length;o++){var l="Connector Line "+this.parent.connectorLineModule.generateAriaLabel(i[n]);s[o].setAttribute("aria-label",l),s[o].setAttribute("role","img")}this.parent.ganttChartModule.chartBodyContent.insertBefore(this.dependencyViewContainer,this.parent.ganttChartModule.chartBodyContent.lastChild),this.dependencyViewContainer.appendChild(this.svgObject);for(n=0;n<this.svgObject.children.length;n++)this.svgObject.children[n].children[0].setAttribute("tabindex","-1")},t.prototype.getParentPosition=function(e){if(e.parentIndex<e.childIndex){if("FF"===e.type)return e.childLeft+e.childWidth>=e.parentLeft+e.parentWidth?"FFType2":"FFType1";if(e.parentLeft<e.childLeft&&e.childLeft>e.parentLeft+e.parentWidth+25){if("FS"===e.type)return"FSType1";if("SF"===e.type)return"SFType1";if("SS"===e.type)return"SSType2";if("FF"===e.type)return"FFType2"}else if(e.parentLeft<e.childLeft&&e.childLeft<e.parentLeft+e.parentWidth||e.parentLeft===e.childLeft||e.parentLeft>e.childLeft){if(e.parentLeft>e.childLeft+e.childWidth+25&&"SF"===e.type)return"SFType2";if(e.parentLeft>e.childLeft){if("SS"===e.type)return"SSType1";if("SF"===e.type)return"SFType1";if("FF"===e.type)return"FFType1"}else if(e.childLeft+e.childWidth>e.parentLeft+e.parentWidth&&"FF"===e.type)return"FFType2";if("FS"===e.type)return"FSType2";if("SS"===e.type)return"SSType2";if("FF"===e.type)return"FFType1";if("SF"===e.type)return"SFType1"}else if(e.parentLeft<e.childLeft){if("FS"===e.type)return"FSType2";if("FF"===e.type)return"FFType2";if("SS"===e.type)return"SSType2";if("SF"===e.type)return"SFType1"}}else if(e.parentIndex>e.childIndex)if(e.parentLeft<e.childLeft&&e.childLeft>e.parentLeft+e.parentWidth){if("FS"===e.type)return 30>=e.childLeft-(e.milestoneParent?e.parentLeft+e.parentWidth+4:e.parentLeft+e.parentWidth)?"FSType3":"FSType4";if(e.parentLeft<e.childLeft||e.childLeft+e.childWidth>e.parentLeft+e.parentWidth){if("SS"===e.type)return"SSType4";if("FF"===e.type)return"FFType4";if("SF"===e.type)return"SFType4"}else if(e.childLeft+e.childWidth>e.parentLeft+e.parentWidth&&"FF"===e.type)return"FFType4"}else if(e.parentLeft<e.childLeft&&e.childLeft<e.parentLeft+e.parentWidth||e.parentLeft===e.childLeft||e.parentLeft>e.childLeft){if(e.childLeft+e.childWidth<=e.parentLeft+e.parentWidth){if("FF"===e.type)return"FFType3";if("SF"===e.type)return e.childLeft+e.childWidth+25<e.parentLeft?"SFType3":"SFType4";if("SS"===e.type)return e.childLeft<=e.parentLeft?"SSType3":"SSType4"}else if(e.childLeft+e.childWidth>e.parentLeft+e.parentWidth){if("FF"===e.type)return"FFType4";if("SF"===e.type)return"SFType4";if("SS"===e.type)return e.childLeft<=e.parentLeft?"SSType3":"SSType4"}if("FS"===e.type)return"FSType3"}else if(e.parentLeft<e.childLeft){if("FS"===e.type)return"FSType3";if("SS"===e.type)return"SSType4";if("FF"===e.type)return"FFType4";if("SF"===e.type)return"SFType4"}return null},t.prototype.getHeightValue=function(e){return this.parent.showOverAllocation&&!this.parent.allowTaskbarOverlap?e.parentIndex*this.parent.rowHeight>e.childIndex*this.parent.rowHeight?e.parentIndex*this.parent.rowHeight-e.childIndex*this.parent.rowHeight:e.childIndex*this.parent.rowHeight-e.parentIndex*this.parent.rowHeight:e.parentIndex*e.rowHeight>e.childIndex*e.rowHeight?e.parentIndex*e.rowHeight-e.childIndex*e.rowHeight:e.childIndex*e.rowHeight-e.parentIndex*e.rowHeight},t.prototype.getInnerElementWidthSSType2=function(e){return e.parentLeft===e.childLeft?10:e.childLeft-e.parentLeft},t.prototype.getInnerElementLeftSSType2=function(e){return e.parentLeft===e.childLeft?e.parentLeft-20:e.parentLeft-10},t.prototype.getInnerChildWidthSSType2=function(e){return e.parentLeft+e.parentWidth<e.childLeft?10:e.parentLeft===e.childLeft?20:e.parentLeft+e.parentWidth>=e.childLeft?10:e.childLeft-e.parentLeft},t.prototype.getBorderStyles=function(t,i){return"border-"+t+"-width:"+i+"px;"+("border-"+t+"-style:solid;")+((0,e.isNullOrUndefined)(this.lineColor)?"":"border-"+t+"-color:"+this.lineColor+";")},t.prototype.getConnectorLineTemplate=function(e){var t=this.getInnerChildWidthSSType2(e),i=this.getInnerElementWidthSSType2(e),r=this.getInnerElementLeftSSType2(e),a=this.getHeightValue(e),n=!!e.milestoneParent,s=!!e.milestoneChild,o=this.parent.virtualScrollModule&&this.parent.enableVirtualization,l=this.getPosition(e,this.getParentPosition(e),a),d=this.getPosition(e,this.getParentPosition(e),a).top,h=0;this.parent.renderBaseline&&(h=e.milestoneParent&&e.milestoneChild?0:e.milestoneParent?-5:e.milestoneChild?5:0);var p=o?l.height:a+h,u=0,c=0,g=0,f=0,m=0;if(this.parent.showOverAllocation&&!this.parent.allowTaskbarOverlap){for(var y=0;y<this.parent.currentViewData.length;y++)"none"!==this.parent.getRowByIndex(y).style.display&&m<e.parentIndex&&(m++,g+=this.parent.getRowByIndex(y).offsetHeight);m=0;for(var D=0;D<this.parent.currentViewData.length;D++)"none"!==this.parent.getRowByIndex(D).style.display&&m<e.childIndex&&(m++,f+=this.parent.getRowByIndex(D).offsetHeight);this.parent.enableVirtualization||(p=Math.abs(g-f))}if(this.parent.currentViewData[e.parentIndex]&&this.parent.currentViewData[e.childIndex]&&this.parent.allowParentDependency){var v=this.parent.currentViewData[e.parentIndex].hasChildRecords,k=this.parent.currentViewData[e.childIndex].hasChildRecords,w=this.parent.currentViewData[e.parentIndex].ganttProperties.isAutoSchedule,b=this.parent.currentViewData[e.childIndex].ganttProperties.isAutoSchedule,T=!0;(v&&w&&!k||k&&b&&!v||v&&w&&b&&k||!v&&!k)&&(T=!1),T&&(v&&!w&&k&&!b?c=-11:v&&!w&&k&&!b||(e.childIndex>e.parentIndex?!v&&k?u=-11:(u=11,c=-11):v&&!k?u=-11:(u=11,c=-11)),this.parent.currentViewData[e.parentIndex].ganttProperties.isMilestone?e.parentIndex>e.childIndex?(c=-11,u=12):"SS"!==e.type&&"FF"!==e.type||(c=-5):this.parent.currentViewData[e.childIndex].ganttProperties.isMilestone?e.parentIndex>e.childIndex?(c=5,u=-10):e.parentIndex<e.childIndex&&("SS"!==e.type&&"FF"!==e.type||(c=-10)):(e.parentIndex<e.childIndex&&w&&!b||e.childIndex<e.parentIndex&&!w&&b)&&(c=0,u=-11))}if(this.getParentPosition(e)){this.transform=this.parent.enableRtl?"translate("+(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth)+", 0) scale(-1, 1)":"",this.connectorId="ConnectorLine"+e.connectorLineId,this.groupObject=this.renderer.createGroup({id:this.connectorId,transform:this.transform,style:"pointer-events: stroke",class:ve}),this.connectorPath=this.renderer.drawPath({class:ke,d:this.connectorLinePath,fill:"transparent","stroke-width":1}),this.arrowlinePath=this.renderer.drawPath({d:this.arrowPath,class:Te});var P=this.lineColor&&!this.parent.enableCriticalPath?this.lineColor:"";this.connectorPath.setAttribute("style","stroke: "+P),this.arrowlinePath.setAttribute("style","fill: "+P),this.groupObject.appendChild(this.connectorPath),this.groupObject.appendChild(this.arrowlinePath),"FSType1"===this.getParentPosition(e)&&(this.taskLineValue=e.milestoneChild?1:0,this.x1=e.parentEndPoint+(e.milestoneParent||e.milestoneChild?-1:0),this.x2=e.milestoneParent?e.childLeft-(e.parentLeft+e.parentWidth+10)+this.lineStroke-10+1:e.childLeft-(e.parentLeft+e.parentWidth+10)+this.lineStroke-10,this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1)-h,this.y2=p+this.taskLineValue+u-this.lineStroke,this.connectorLinePath="M "+this.x1+" "+this.y1+" L "+(this.x1+this.x2)+" "+this.y1+" L "+(this.x1+this.x2)+" "+(this.y1+this.y2)+" L "+(this.x1+this.x2+12)+" "+(this.y1+this.y2),this.arrowPath="M "+(this.x1+this.x2+20)+" "+(this.y1+this.y2)+" L "+(this.x1+this.x2+12)+" "+(this.y1+this.y2-(4+this.lineStroke))+" L "+(this.x1+this.x2+12)+" "+(this.y1+this.y2+4)+" Z"),"FSType2"===this.getParentPosition(e)&&(this.x1=e.parentLeft,this.x2=e.parentWidth+(e.milestoneParent?-1:0),this.x3=this.x2+(e.milestoneParent?11:10),this.x4=e.parentWidth-(e.parentEndPoint-e.childLeft+20),this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1)-h,this.y2=p+u-this.getconnectorLineGap(e)-this.lineStroke,this.y3=this.getconnectorLineGap(e),this.y4=this.parent.allowTaskbarOverlap?this.y1+this.y2-(this.y1+this.y2)%e.rowHeight:f,this.connectorLinePath="M "+(this.x1+this.x2)+" "+this.y1+"  L "+(this.x1+this.x3)+" "+this.y1+" L "+(this.x1+this.x3)+" "+this.y4+" L "+(this.x1+this.x4)+" "+this.y4+" L "+(this.x1+this.x4)+" "+(this.y1+this.y2+this.y3)+" L "+(this.x1+this.x4+12)+" "+(this.y1+this.y2+this.y3),this.arrowPath="M "+(this.x1+this.x4+20)+" "+(this.y1+this.y2+this.y3)+" L "+(this.x1+this.x4+12)+" "+(this.y1+this.y2+this.y3-(4+this.lineStroke))+" L "+(this.x1+this.x4+12)+" "+(this.y1+this.y2+this.y3+4+this.lineStroke)+" Z"),"FSType3"===this.getParentPosition(e)&&(this.taskLineValue=e.milestoneChild?1:0,this.point1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(n)-(this.lineStroke-1)-h,this.x1=e.childLeft+(e.milestoneChild?-1:0)+(e.milestoneParent?1:0)-20,this.x2=e.parentEndPoint-e.childLeft+30,this.y1=this.point1+(this.parent.renderBaseline?e.milestoneChild&&!e.milestoneParent?11:e.milestoneParent&&!e.milestoneChild?-12:0:0),this.y2=this.point1+p+u-this.getconnectorLineGap(e)-this.lineStroke+this.taskLineValue,this.y3=this.getconnectorLineGap(e),this.y4=this.y2-this.y2%e.rowHeight,this.connectorLinePath="M "+(this.x1+12)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y4+" L "+(this.x1+this.x2)+" "+this.y4+" L "+(this.x1+this.x2)+" "+(this.y2+this.y3)+" L "+(this.x1+this.x2-12)+" "+(this.y2+this.y3),this.arrowPath="M "+(this.x1+20)+" "+this.y1+" L "+(this.x1+12)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+12)+" "+(this.y1+4+this.lineStroke)+" Z"),"FSType4"===this.getParentPosition(e)&&(this.point1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1),this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.parentEndPoint+(e.milestoneChild?-1:0)+(e.milestoneParent?1:0),this.x2=e.childLeft-e.parentEndPoint-20,this.y1=this.point1+(e.milestoneChild?-1:0),this.y2=this.point1+p+u-this.lineStroke+1+this.taskLineValue+(this.parent.renderBaseline?e.milestoneChild&&!e.milestoneParent?-12:e.milestoneParent&&!e.milestoneChild?11:0:0),this.connectorLinePath="M "+(this.x1+this.x2+12)+" "+this.y1+" L "+(this.x1+this.x2)+" "+this.y1+" L "+(this.x1+this.x2)+" "+this.y2+" L "+this.x1+" "+this.y2,this.arrowPath="M "+(this.x1+this.x2+20)+" "+this.y1+" L "+(this.x1+this.x2+12)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+this.x2+12)+" "+(this.y1+4+this.lineStroke)+" Z"),"SSType4"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.point1=p+this.taskLineValue+u,this.point2=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1),this.x1=e.parentLeft-10,this.x2=e.childLeft-e.parentLeft,this.y1=this.point2+(e.milestoneChild?1:0),this.y2=this.y1+this.point1+(this.parent.renderBaseline?e.milestoneParent&&!e.milestoneChild?10:e.milestoneChild&&!e.milestoneParent?-13:0:0),this.connectorLinePath="M "+(this.x1+this.x2)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y2+" L "+(this.x1+10)+" "+this.y2,this.arrowPath="M "+(this.x1+this.x2+8)+" "+this.y1+" L "+(this.x1+this.x2)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+this.x2)+" "+(this.y1+4+this.lineStroke)+" Z"),"SSType3"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=p+this.taskLineValue+u-(this.lineStroke-1),this.x1=e.childLeft-20,this.y1=(e.milestoneChild?1:0)+(this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1)),this.x2=e.parentLeft-e.childLeft+21,this.y2=this.y1+this.point1+(this.parent.renderBaseline?e.milestoneChild&&!e.milestoneParent?-11:e.milestoneParent&&!e.milestoneChild?10:0:0),this.connectorLinePath="M "+(this.x1+12)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y2+" L "+(this.x1+this.x2)+" "+this.y2,this.arrowPath="M "+(this.x1+20)+" "+this.y1+" L "+(this.x1+12)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+12)+" "+(this.y1+4+this.lineStroke)+" Z"),"SSType2"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=p+this.taskLineValue+u-this.lineStroke,this.x1=r,this.x2=t+1,this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(n)-(this.lineStroke-1),this.y2=this.y1+this.point1,this.connectorLinePath="M "+(this.x1+this.x2)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y2+" L "+(this.x1+i)+" "+this.y2,this.arrowPath="M "+(this.x1+i+8)+" "+this.y2+" L "+(this.x1+i)+" "+(this.y2-(4+this.lineStroke))+" L "+(this.x1+i)+" "+(this.y2+4+this.lineStroke)+" Z"),"SSType1"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=p+this.taskLineValue+u-this.lineStroke,this.x1=e.childLeft-20,this.x2=e.parentLeft-e.childLeft+21,this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(n)-(this.lineStroke-1),this.y2=this.y1+this.point1,this.connectorLinePath="M "+(this.x1+this.x2)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y2+" L "+(this.x1+12)+" "+this.y2,this.arrowPath="M "+(this.x1+20)+" "+this.y2+" L "+(this.x1+12)+" "+(this.y2-(4+this.lineStroke))+" L "+(this.x1+12)+" "+(this.y2+4+this.lineStroke)+" Z"),"FFType1"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.x1=e.childEndPoint,this.x2=e.parentEndPoint+(e.milestoneParent?-1:0),this.x3=e.milestoneParent?22:21,this.x4=e.milestoneChild?4:8,this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(n)-(this.lineStroke-1),this.y2=p+this.taskLineValue+u-this.lineStroke,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+(this.x2+this.x3)+" "+this.y1+" L "+(this.x2+this.x3)+" "+(this.y1+this.y2)+" L "+(this.x1+this.x4)+" "+(this.y1+this.y2),this.arrowPath="M "+this.x1+" "+(this.y1+this.y2)+" L "+(this.x1+8)+" "+(this.y1+this.y2-(4+this.lineStroke))+" L "+(this.x1+8)+" "+(this.y1+this.y2+4+this.lineStroke)+" Z"),"FFType2"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.x1=e.parentEndPoint,this.x2=e.childEndPoint+(e.milestoneParent?22:21),this.x3=e.childEndPoint+(e.milestoneChild?9:8),this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(e.milestoneParent)-(this.lineStroke-1),this.y2=p+this.taskLineValue+u-this.lineStroke,this.connectorLinePath="M "+this.x1+" "+this.y1+" L "+this.x2+" "+this.y1+" L "+this.x2+" "+(this.y1+this.y2)+" L "+this.x3+" "+(this.y1+this.y2),this.arrowPath="M "+(this.x3-8)+" "+(this.y1+this.y2)+" L "+this.x3+" "+(this.y1+this.y2-(4+this.lineStroke))+" L "+this.x3+" "+(this.y1+this.y2+4+this.lineStroke)+" Z"),"FFType3"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.childEndPoint,this.x2=this.x1+(e.milestoneChild?4:8),this.x3=e.parentEndPoint-e.childEndPoint+(e.milestoneChild?16:10),this.x4=e.parentEndPoint+(e.milestoneParent?-1:0),this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1),this.y2=p+this.taskLineValue+u-this.lineStroke+(this.parent.renderBaseline?e.milestoneParent&&!e.milestoneChild?10:e.milestoneChild&&!e.milestoneParent?-11:0:0),this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+(this.x2+this.x3)+" "+this.y1+" L "+(this.x2+this.x3)+" "+(this.y1+this.y2)+" L "+this.x4+" "+(this.y1+this.y2),this.arrowPath="M "+this.x1+" "+this.y1+" L "+(this.x1+8)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+8)+" "+(this.y1+4+this.lineStroke)+" Z"),"FFType4"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.parentEndPoint,this.x2=e.childEndPoint+(e.milestoneChild?7:8),this.x3=this.x2+(e.milestoneChild?12:11),this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1),this.y2=p+this.taskLineValue+u+(this.parent.renderBaseline?e.milestoneParent&&!e.milestoneChild?10:e.milestoneChild&&!e.milestoneParent?-12:0:0)-this.lineStroke+1,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+this.x3+" "+this.y1+" L "+this.x3+" "+(this.y1+this.y2)+" L "+this.x1+" "+(this.y1+this.y2),this.arrowPath="M "+(this.x2-8)+" "+this.y1+" L "+this.x2+" "+(this.y1-(4+this.lineStroke))+" L "+this.x2+" "+(this.y1+4+this.lineStroke)+" Z"),"SFType4"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?-1:0,this.point1=this.taskLineValue+p+u-this.getconnectorLineGap(e)-(this.lineStroke-1),this.point2=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1)-h,this.x1=e.parentLeft-10,this.x2=this.x1+(e.childEndPoint-e.parentLeft+18),this.x3=this.x2+(e.milestoneChild?16:11),this.y1=this.point2+(e.milestoneChild?2:0)+(this.parent.renderBaseline&&e.milestoneParent?-5:0),this.y2=this.y1+this.point1+(this.parent.renderBaseline?e.milestoneChild&&!e.milestoneParent?-9:e.milestoneParent&&!e.milestoneChild?9:0:0),this.y3=this.getconnectorLineGap(e),this.y4=this.y2-this.y2%e.rowHeight,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+this.x3+" "+this.y1+" L "+this.x3+" "+this.y4+" L "+this.x1+" "+this.y4+" L "+this.x1+" "+(this.y2+this.y3)+" L "+(this.x1+11)+" "+(this.y2+this.y3),this.arrowPath="M "+(this.x2-8)+" "+this.y1+" L "+this.x2+" "+(this.y1-(4+this.lineStroke))+" L "+this.x2+" "+(this.y1+4+this.lineStroke)+" Z"),"SFType3"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.point1=e.parentLeft-(e.childEndPoint+(e.milestoneParent?23:20))+1,this.point2=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.childIndex*e.rowHeight:f)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1),this.x1=e.childEndPoint,this.x2=this.x1+(e.milestoneChild?9:8),this.x3=this.x2+(e.milestoneChild?17:11),this.y1=this.point2,this.y2=this.y1+p+u-(this.lineStroke-1)+this.taskLineValue+(this.parent.renderBaseline?e.milestoneChild&&!e.milestoneParent?-12:e.milestoneParent&&!e.milestoneChild?10:0:0),this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+this.x3+" "+this.y1+" L "+this.x3+" "+this.y2+" L "+(this.x3+this.point1)+" "+this.y2,this.arrowPath="M "+(this.x2-8)+" "+this.y1+" L "+this.x2+" "+(this.y1-(4+this.lineStroke))+" L "+this.x2+" "+(this.y1+4+this.lineStroke)+" Z"),"SFType1"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=p+u-this.getconnectorLineGap(e)+this.taskLineValue-this.lineStroke,this.point2=this.getconnectorLineGap(e),this.x1=e.parentLeft-10,this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(s)-(this.lineStroke-1)-h,this.x2=e.childEndPoint-e.parentLeft+31,this.y2=this.y1+this.point1,this.x3=e.childEndPoint-e.parentLeft+18,this.y3=this.y2-this.y2%e.rowHeight,this.connectorLinePath="M "+(this.x1+11)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y3+" L "+(this.x1+this.x2)+" "+this.y3+" L "+(this.x1+this.x2)+" "+(this.y2+this.point2)+" L "+(this.x1+this.x3)+" "+(this.y2+this.point2),this.arrowPath="M "+(this.x1+this.x3-8)+" "+(this.y2+this.point2)+" L "+(this.x1+this.x3)+" "+(this.y2+this.point2-(4+this.lineStroke))+" L "+(this.x1+this.x3)+" "+(this.y2+this.point2+4+this.lineStroke)+" Z"),"SFType2"===this.getParentPosition(e)&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.childEndPoint,this.y1=this.parent.enableVirtualization?d:(this.parent.allowTaskbarOverlap?e.parentIndex*e.rowHeight:g)+c+this.getTaskbarMidpoint(n)-(this.lineStroke-1),this.x2=e.parentLeft-e.childEndPoint,this.y2=this.y1+p+this.taskLineValue+u-this.lineStroke,this.connectorLinePath="M "+(this.x1+this.x2+1)+" "+this.y1+" L "+(this.x1+this.x2-10)+" "+this.y1+" L "+(this.x1+this.x2-10)+" "+this.y2+" L "+(this.x1+8)+" "+this.y2,this.arrowPath="M "+this.x1+" "+this.y2+" L "+(this.x1+8)+" "+(this.y2-(4+this.lineStroke))+" L "+(this.x1+8)+" "+(this.y2+4+this.lineStroke)+" Z"),this.connectorPath.setAttribute("d",this.connectorLinePath),this.arrowlinePath.setAttribute("d",this.arrowPath)}return this.groupObject.outerHTML},t.prototype.getPosition=function(e,t,i){var r=0,a=0;if(this.parent.virtualScrollModule&&this.parent.enableVirtualization){var n=!!e.milestoneParent,s=!!e.milestoneChild,o=this.getTaskbarMidpoint(n)-(this.lineStroke-1),l=this.getTaskbarMidpoint(s)-(this.lineStroke-1),d=-1!==e.parentIndexInCurrentView,h=-1!==e.childIndexInCurrentView,p=this.parent.currentViewData.length-1;"SSType1"===t||"SSType2"===t||"FFType1"===t||"FFType2"===t||"SFType2"===t?(r=d?e.parentIndexInCurrentView*e.rowHeight+o:0,a=d&&h?i:h?e.childIndexInCurrentView*e.rowHeight+o:p*e.rowHeight+o):"SSType3"===t||"SSType4"===t||"FSType4"===t||"FFType3"===t||"FFType4"===t||"SFType4"===t||"SFType3"===t?(r=h?e.childIndexInCurrentView*e.rowHeight+l:0,a=d&&h?i:d?e.parentIndexInCurrentView*e.rowHeight+l:p*e.rowHeight+l):"FSType3"===t?(r=h?e.childIndexInCurrentView*e.rowHeight+o:0,a=d&&h?i:d?e.parentIndexInCurrentView*e.rowHeight+l:p*e.rowHeight+o):"SFType1"!==t&&"FSType1"!==t&&"FSType2"!==t||(r=d?e.parentIndexInCurrentView*e.rowHeight+l:0,a=d&&h?i:h?e.childIndexInCurrentView*e.rowHeight+l:p*e.rowHeight+l)}return{top:r,height:a}},t.prototype.createConnectorLineTooltipTable=function(){this.tooltipTable=(0,e.createElement)("table",{className:".e-tooltiptable",styles:"margin-top:0px",attrs:{cellspacing:"2px",cellpadding:"2px"}});var t=(0,e.createElement)("tbody");t.innerHTML="",this.tooltipTable.appendChild(t)},t.prototype.getConnectorLineTooltipInnerTd=function(e,t,i,r){var a='<tr  id="fromPredecessor"><td style="padding: 2px;">'+this.parent.localeObj.getConstant("from")+"</td><td> ";return a=(a=(a=a+e+' </td><td style="padding: 2px;"> '+this.parent.localeObj.getConstant(t)+" </td> </tr>")+'<tr id="toPredecessor"><td style="padding: 2px;">'+this.parent.localeObj.getConstant("to")+"</td><td> "+i)+' </td><td style="padding: 2px;"> '+this.parent.localeObj.getConstant(r)+" </td></tr></tbody><table>"},t.prototype.generateAriaLabel=function(e){var t=e.type,i=this.expandedRecords,r=i[e.parentIndex].ganttProperties.taskName,a=i[e.childIndex].ganttProperties.taskName,n=this.parent.localeObj.getConstant("start"),s=this.parent.localeObj.getConstant("finish");return"FS"===t?r+" "+s+" to "+a+" "+n:"FF"===t?r+" "+s+" to "+a+" "+s:"SS"===t?r+" "+n+" to "+a+" "+n:r+" "+n+" to "+a+" "+s},t.prototype.getRecordByID=function(t){return(0,e.isNullOrUndefined)(t)?null:this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData.filter((function(e){return e.ganttProperties.taskId.toString()===t.toString()}))[0]:"ResourceView"===this.parent.viewType?this.parent.flatData[this.parent.getTaskIds().indexOf("T"+t.toString())]:this.parent.flatData[this.parent.ids.indexOf(t.toString())]},t.prototype.removePreviousConnectorLines=function(t){for(var i,r=(i=!0===(0,e.isObject)(t))?Object.keys(t).length:t.length,a=Object.keys(t),n=0;n<r;n++){var s=void 0;if(i)s=t[a[n]];else s=t[n];var o=s.ganttProperties&&s.ganttProperties.predecessor;if(o&&o.length>0)for(var l=0;l<o.length;l++){var d="parent"+o[l].from+"child"+o[l].to;this.removeConnectorLineById(d)}}},t.prototype.removeConnectorLineById=function(t){var i=this.parent.connectorLineModule.dependencyViewContainer.querySelector("#ConnectorLine"+t.replace(/([\.])/g,"\\$1"));(0,e.isNullOrUndefined)(i)||(0,e.remove)(i)},t}(),ii=m(40),ri=function(){function t(e){this.parent=e,this.parent.on("destroy",this.destroy,this)}return t.prototype.renderSplitter=function(){var t=this,i=this.calculateSplitterPosition(this.parent.splitterSettings);this.parent.splitterElement=(0,e.createElement)("div",{className:"e-gantt-splitter"}),this.parent.treeGridPane=(0,e.createElement)("div",{className:"e-gantt-tree-grid-pane"}),this.parent.chartPane=(0,e.createElement)("div",{className:"e-gantt-chart-pane"}),(0,e.addClass)([this.parent.chartPane],"e-droppable"),this.parent.enableRtl?(this.parent.splitterElement.appendChild(this.parent.chartPane),this.parent.splitterElement.appendChild(this.parent.treeGridPane)):(this.parent.splitterElement.appendChild(this.parent.treeGridPane),this.parent.splitterElement.appendChild(this.parent.chartPane)),this.splitterObject=new ii.Splitter({height:null,width:this.parent.ganttWidth.toString(),enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,separatorSize:this.parent.splitterSettings.separatorSize,paneSettings:[{resizable:!0,size:i,min:this.getSpliterPositionInPercentage(this.parent.splitterSettings.minimum)},{resizable:!0}],orientation:"Horizontal",resizeStart:function(e){t.parent.contextMenuModule&&t.parent.contextMenuModule.isOpen&&t.parent.contextMenuModule.contextMenu.close();var i=e.pane[0],a=e.pane[1];t.splitterPreviousPositionGrid=i.scrollWidth+1+"px",t.splitterPreviousPositionChart=a.scrollWidth+1+"px";var n=new r.Deferred;return t.parent.trigger("splitterResizeStart",e,(function(e){n.resolve(e)})),n},resizing:function(e){t.parent.trigger("splitterResizing",e),t.parent.timelineModule.isZoomToFit&&t.parent.timelineModule.updateTimelineAfterZooming(t.parent.timelineModule.timelineEndDate,!0)},resizeStop:function(i){t.parent.calculateDimensions();var a=i.pane[0];t.splitterPreviousPositionGrid=a.scrollWidth+1+"px",t.splitterObject.paneSettings[0].size=t.getSpliterPositionInPercentage(t.splitterPreviousPositionGrid),t.splitterObject.paneSettings[1].size=t.parent.ganttWidth-parseInt(t.splitterPreviousPositionGrid,10)-4+"px";var n=new r.Deferred;return t.parent.trigger("splitterResized",i,(function(i){!0===i.cancel&&(t.splitterObject.paneSettings[0].size=null,t.splitterObject.paneSettings[0].size=t.getSpliterPositionInPercentage(t.splitterPreviousPositionGrid),t.splitterObject.paneSettings[1].size=null,t.splitterObject.paneSettings[1].size=t.getSpliterPositionInPercentage(t.splitterPreviousPositionChart)),(0,e.isNullOrUndefined)(t.parent.projectEndDate)&&t.parent.timelineModule.updateTimelineAfterZooming(t.parent.timelineModule.timelineEndDate,!0),n.resolve(i)})),n}}),this.parent.element.appendChild(this.parent.splitterElement),this.splitterObject.appendTo(this.parent.splitterElement);var a=this.splitterObject.element.querySelector(".e-split-bar");if(a){var n=parseFloat(i.replace("%","")),s=Math.min(100,Math.max(0,n));a.setAttribute("aria-valuenow",s.toString())}},t.prototype.calculateSplitterPosition=function(t){if(!(0,e.isNullOrUndefined)(this.splitterObject)&&this.parent.enablePersistence)return this.splitterObject.paneSettings[0].size;if("Grid"===t.view)return this.parent.enableRtl?"0%":"100%";if("Chart"===t.view)return this.parent.enableRtl?"100%":"0%";if((0,e.isNullOrUndefined)(t.position)||""===t.position){if(!(0,e.isNullOrUndefined)(t.columnIndex)&&t.columnIndex>=0)return 150*t.columnIndex<this.parent.ganttWidth||!this.parent.element.classList.contains("e-device")?this.getSpliterPositionInPercentage(this.getTotalColumnWidthByIndex(t.columnIndex).toString()+"px"):this.getSpliterPositionInPercentage(130*t.columnIndex+"px");var i=this.parent.ganttWidth-250+"px";return this.parent.enableRtl?this.getSpliterPositionInPercentage(i):this.getSpliterPositionInPercentage("250px")}return this.getSpliterPositionInPercentage(t.position)},t.prototype.getSpliterPositionInPercentage=function(t){var i=(0,e.isNullOrUndefined)(t)||""===t?null:t;if(!(0,e.isNullOrUndefined)(i))if(-1!==t.indexOf("px")){var r=parseInt(t,10);i=r/this.parent.ganttWidth*100<=100?r/this.parent.ganttWidth*100+"%":"25%"}else{if(this.parent.enableRtl)i=100-parseFloat(t)+"%";else i=-1===t.indexOf("%")?t+"%":t}return i},t.prototype.getTotalColumnWidthByIndex=function(e){var t=0,i=this.parent.ganttWidth,r=this.parent.ganttColumns.filter((function(e){return void 0===e.visible||!0===e.visible})).map((function(e){return Object.assign({},e)}));if(e=r.length>e?e:r.length,this.parent.enableRtl){for(var a=0;a<e;a++)t+=parseInt(r[a].width,10);t=i-t}else for(a=0;a<e;a++)t+=parseInt(r[a].width,10);return t},t.prototype.updateSplitterPosition=function(){this.splitterObject.separatorSize=this.parent.splitterSettings.separatorSize;var t=this.calculateSplitterPosition(this.parent.splitterSettings);this.splitterObject.paneSettings[0].min=this.getSpliterPositionInPercentage(this.parent.splitterSettings.minimum),this.splitterObject.dataBind(),this.splitterObject.paneSettings[0].size=t,(0,e.isNullOrUndefined)(this.parent.projectEndDate)&&this.parent.timelineModule.updateTimelineAfterZooming(this.parent.timelineModule.timelineEndDate,!0)},t.prototype.triggerCustomResizedEvent=function(){var e=this.splitterObject.element.querySelectorAll(".e-pane")[0],t=this.splitterObject.element.querySelectorAll(".e-pane")[1],i={event:null,element:this.splitterObject.element,pane:[e,t],index:[0,1],separator:this.splitterObject.element.querySelector(".e-split-bar"),paneSize:[e.offsetWidth,t.offsetWidth]};this.parent.trigger("splitterResized",i),!0===i.cancel&&(this.splitterObject.paneSettings[0].size=this.getSpliterPositionInPercentage(this.splitterPreviousPositionGrid),this.splitterObject.paneSettings[1].size=this.getSpliterPositionInPercentage(this.splitterPreviousPositionChart))},t.prototype.destroy=function(){this.splitterObject.destroy(),this.parent.off("destroy",this.destroy)},t}(),ai=function(){function i(e){this.parent=e,this.createTooltip(),this.parent.on("destroy",this.destroy,this)}return i.prototype.createTooltip=function(){this.toolTipObj=new t.Tooltip,this.toolTipObj.target=".e-header-cell-label, .e-gantt-child-taskbar,.e-gantt-parent-taskbar, .e-gantt-milestone, .e-gantt-unscheduled-taskbar.e-event-markers, .e-baseline-bar, .e-event-markers,.e-connector-line-container, .e-indicator-span, .e-notes-info, .e-gantt-manualparent-milestone,.e-taskbar-left-resizer, .e-taskbar-right-resizer, .e-baseline-gantt-milestone-container, .e-gantt-manualparenttaskbar",this.toolTipObj.position="BottomCenter",this.toolTipObj.openDelay=700,this.toolTipObj.enableRtl=this.parent.enableRtl,this.toolTipObj.enableHtmlSanitizer=this.parent.enableHtmlSanitizer,this.toolTipObj.cssClass=Ie,this.toolTipObj.animation={open:{effect:"None",delay:0},close:{effect:"None",delay:0}},this.toolTipObj.afterOpen=this.updateTooltipPosition.bind(this),this.toolTipObj.showTipPointer=!1,this.toolTipObj.beforeRender=this.tooltipBeforeRender.bind(this),this.toolTipObj.afterClose=this.tooltipCloseHandler.bind(this),this.toolTipObj.isStringTemplate=!0,this.toolTipObj.appendTo(this.parent.element)},i.prototype.tooltipBeforeRender=function(t){var i=this.parent;if(i.isOnEdit)t.cancel=!0;else{var n,s,o=(0,e.closest)(t.target,"div."+V);n=(0,e.isNullOrUndefined)(o)?a(t.target,_):t.target;var l={data:{},args:t,cancel:!1,content:""};if(t.target.classList.contains("e-header-cell-label"))i.timelineSettings.showTooltip?l.content=this.toolTipObj.content=i.tooltipModule.getTooltipContent("timeline",s,i,t):t.cancel=!0;else if(i.tooltipSettings.showTooltip)if(n&&(l.data=i.ganttChartModule.getRecordByTaskBar(n),s=l.data),t.target.classList.contains("e-gantt-child-taskbar")||t.target.classList.contains("e-gantt-parent-taskbar")||t.target.classList.contains("e-gantt-milestone")||t.target.classList.contains("e-gantt-unscheduled-taskbar")||t.target.classList.contains("e-taskbar-left-resizer")||t.target.classList.contains("e-taskbar-right-resizer")||t.target.classList.contains("e-gantt-manualparenttaskbar")&&i.tooltipSettings.taskbar){var d=void 0;i.tooltipSettings.taskbar&&(d=i.tooltipModule.templateCompiler(i.tooltipSettings.taskbar,i,s,"TooltipTaskbarTemplate"));var h=document.createElement("div");d&&(0,e.append)(d,h),l.content=this.toolTipObj.content=d?h:s?i.tooltipModule.getTooltipContent(s.ganttProperties.isMilestone?"milestone":"taskbar",s,i,t):""}else if(t.target.classList.contains("e-baseline-bar")||t.target.classList.contains("e-baseline-gantt-milestone-container")){var p=void 0;i.tooltipSettings.baseline&&(p=i.tooltipModule.templateCompiler(i.tooltipSettings.baseline,i,s,"TooltipBaselineTemplate"));var u=document.createElement("div");p&&(0,e.append)(p,u),l.content=this.toolTipObj.content=p?u:s?i.tooltipModule.getTooltipContent(s.ganttProperties.isMilestone?"milestone":"baseline",s,i,t):""}else if(t.target.classList.contains("e-event-markers"))l.content=this.toolTipObj.content=i.tooltipModule.getTooltipContent("marker",s,i,t);else if(t.target.classList.contains("e-connector-line-container")){var c=void 0;i.tooltipModule.predecessorTooltipData=i.tooltipModule.getPredecessorTooltipData(t),l.data=this.predecessorTooltipData,i.tooltipSettings.connectorLine&&(c=i.tooltipModule.templateCompiler(i.tooltipSettings.connectorLine,i,i.tooltipModule.predecessorTooltipData,"TooltipConnectorLineTemplate")),l.content=this.toolTipObj.content=c?c[0]:i.tooltipModule.getTooltipContent("connectorLine",s,i,t)}else if(t.target.classList.contains("e-indicator-span"))l.content=this.toolTipObj.content=i.tooltipModule.getTooltipContent("indicator",s,i,t),(0,e.isNullOrUndefined)(l.content)&&(t.cancel=!0);else if(t.target.classList.contains("e-notes-info")){var g=this.parent.ganttChartModule.getRecordByTarget(t.event);l.content=this.toolTipObj.content=g.ganttProperties.notes,(0,e.isNullOrUndefined)(l.content)&&(t.cancel=!0)}else t.target.classList.contains("e-gantt-manualparenttaskbar")?(l.content=this.toolTipObj.content=i.tooltipModule.getTooltipContent("manualtaskbar",s,i,t),(0,e.isNullOrUndefined)(l.content)&&(t.cancel=!0)):t.target.classList.contains("e-gantt-manualparent-milestone")&&(l.content=this.toolTipObj.content=i.tooltipModule.getTooltipContent("manualmilestone",s,i,t),(0,e.isNullOrUndefined)(l.content)&&(t.cancel=!0));else t.cancel=!0;if(!1===t.cancel){var f=new r.Deferred;return i.trigger("beforeTooltipRender",l,(function(e){f.resolve(e),e.cancel&&(t.cancel=!0)})),this.toolTipObj.content=l.content,this.parent.isAdaptive||"mouseover"!==t.event.type||(this.currentTarget=t.target,e.EventHandler.add(this.currentTarget,"mousemove",this.mouseMoveHandler.bind(this))),this.parent.renderTemplates(),f}}},i.prototype.tooltipCloseHandler=function(t){this.tooltipMouseEvent=null,this.parent.isAdaptive||(0,e.isNullOrUndefined)(this.currentTarget)||e.EventHandler.remove(this.currentTarget,"mousemove",this.mouseMoveHandler),this.currentTarget=null},i.prototype.mouseMoveHandler=function(e){this.tooltipMouseEvent=e},i.prototype.updateTooltipPosition=function(t){t.element.style.visibility="visible";var i=this.parent.element.closest('[style*="zoom"]');if((0,e.isNullOrUndefined)(i)){if((0,e.isNullOrUndefined)(this.tooltipMouseEvent)||t.target.classList.contains("e-notes-info"))return;var r=this.getPointorPosition(this.tooltipMouseEvent),a=this.parent.getOffsetRect(this.parent.chartPane),n=a.top+this.parent.chartPane.offsetHeight,s=a.left+this.parent.chartPane.offsetWidth,o=r.x,l=r.y;if(s<o+t.element.offsetWidth+10)for(;s<o+t.element.offsetWidth+10;)o=s-t.element.offsetWidth-10,t.element.style.left=o+"px";else o+=10,t.element.style.left=o+"px";window.innerHeight<t.element.offsetHeight+l&&(l=l-t.element.offsetHeight-10),n<l+t.element.offsetHeight+20?l=l-t.element.offsetHeight-10:l+=10,t.element.style.top=l+"px"}},i.prototype.getPointorPosition=function(t){var i,r;return(0,e.isNullOrUndefined)((0,e.getValue)("pageX",t))&&(0,e.isNullOrUndefined)((0,e.getValue)("pageY",t))?(0,e.isNullOrUndefined)((0,e.getValue)("clientX",t))&&(0,e.isNullOrUndefined)((0,e.getValue)("clientY",t))||(i=(0,e.getValue)("clientX",t)+document.body.scrollLeft+document.documentElement.scrollLeft,r=(0,e.getValue)("clientY",t)+document.body.scrollTop+document.documentElement.scrollTop):(i=(0,e.getValue)("pageX",t),r=(0,e.getValue)("pageY",t)),{x:i,y:r}},i.prototype.getTooltipContent=function(t,i,r,a){var n,s,o;if(i){var l=(s=i.ganttProperties).taskName;this.parent.enableHtmlSanitizer&&"string"==typeof l&&(l=e.SanitizeHtmlHelper.sanitize(l)),o=(0,e.isNullOrUndefined)(l)?"":'<tr class = "e-gantt-tooltip-rowcell"><td colspan="3">'+(this.parent.disableHtmlEncode?l.replace(/</g,"&lt;").replace(/>/g,"&gt;"):l)+"</td></tr>"}switch(t){case"milestone":var d=void 0;a.target.className.includes("e-baseline-gantt-milestone-container")&&!(0,e.isNullOrUndefined)(s.baselineStartDate)?d=s.baselineStartDate:(0,e.isNullOrUndefined)(s.startDate)||(d=s.startDate);var h=this.parent.getFormatedDate(d,this.parent.getDateFormat());this.parent.enableHtmlSanitizer&&"string"==typeof h&&(h=e.SanitizeHtmlHelper.sanitize(h));var p=(0,e.isNullOrUndefined)(d)?"":'<tr><td class = "e-gantt-tooltip-label"> Date</td><td>:</td><td class = "e-gantt-tooltip-value">'+h+"</td></tr>",u=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+o+p+"</tbody></table>"};n=(0,e.initializeCSPTemplate)(u);break;case"taskbar":var c=!(i.hasChildRecords&&!s.isAutoSchedule),g=this.parent.getFormatedDate(c?s.startDate:s.autoStartDate,this.parent.getDateFormat()),f=this.parent.getFormatedDate(c?s.endDate:s.autoEndDate,this.parent.getDateFormat()),m=this.parent.getDurationString(c?s.duration:s.autoDuration,s.durationUnit),y=s.progress;this.parent.enableHtmlSanitizer&&(g="string"==typeof g?e.SanitizeHtmlHelper.sanitize(g):g,f="string"==typeof f?e.SanitizeHtmlHelper.sanitize(f):f,m="string"==typeof m?e.SanitizeHtmlHelper.sanitize(m):m,y="string"==typeof y?e.SanitizeHtmlHelper.sanitize(y):y);var D=s.startDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant(c?"startDate":"subTasksStartDate")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value"> '+g+"</td></tr>":"",v=s.endDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant(c?"endDate":"subTasksEndDate")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value">'+f+"</td></tr>":"",k=(0,e.isNullOrUndefined)(s.duration)?"":'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("duration")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value"> '+m+"</td></tr>",w=(0,e.isNullOrUndefined)(s.progress)?"":'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("progress")+'</td><td style="padding: 2px;">:</td><td>'+y+"</td></tr>";u=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+o+D+v+k+w+"</tbody></table>"};n=(0,e.initializeCSPTemplate)(u);break;case"baseline":var b=this.parent.getFormatedDate(s.baselineStartDate,this.parent.getDateFormat()),T=this.parent.getFormatedDate(s.baselineEndDate,this.parent.getDateFormat());this.parent.enableHtmlSanitizer&&(b="string"==typeof b?e.SanitizeHtmlHelper.sanitize(b):b,T="string"==typeof T?e.SanitizeHtmlHelper.sanitize(T):T);u=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+o+'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("baselineStartDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+b+'</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("baselineEndDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+T+"</td></tr></tbody></table>"};n=(0,e.initializeCSPTemplate)(u,this);break;case"marker":var P=r.tooltipModule.getMarkerTooltipData(a),S=this.parent.getFormatedDate(this.parent.dateValidationModule.getDateFromFormat(P.day),this.parent.getDateFormat()),C=P.label?P.label:"";this.parent.enableHtmlSanitizer&&(C="string"==typeof C?e.SanitizeHtmlHelper.sanitize(C):C,S="string"==typeof S?e.SanitizeHtmlHelper.sanitize(S):S);u=function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr><td>'+S+"</td></tr><tr><td>"+(this.parent.disableHtmlEncode?C.replace(/</g,"&lt;").replace(/>/g,"&gt;"):C)+"</td></tr></tbody></table>"};n=(0,e.initializeCSPTemplate)(u,this);break;case"connectorLine":var R=r.tooltipModule.predecessorTooltipData.fromName,M=r.tooltipModule.predecessorTooltipData.fromId,x=r.tooltipModule.predecessorTooltipData.toName,O=r.tooltipModule.predecessorTooltipData.toId,I=r.tooltipModule.predecessorTooltipData.linkText,E=r.tooltipModule.predecessorTooltipData.offsetString;this.parent.enableHtmlSanitizer&&(R="string"==typeof R?e.SanitizeHtmlHelper.sanitize(R):R,M="string"==typeof M?e.SanitizeHtmlHelper.sanitize(M):M,x="string"==typeof x?e.SanitizeHtmlHelper.sanitize(x):x,O="string"==typeof O?e.SanitizeHtmlHelper.sanitize(O):O,I="string"==typeof I?e.SanitizeHtmlHelper.sanitize(I):I,E="string"==typeof E?e.SanitizeHtmlHelper.sanitize(E):E);u=function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("from")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+(this.parent.disableHtmlEncode?R.replace(/</g,"&lt;").replace(/>/g,"&gt;"):R)+" ("+(this.parent.disableHtmlEncode&&"string"==typeof M?M.replace(/</g,"&lt;").replace(/>/g,"&gt;"):M)+')</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("to")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+(this.parent.disableHtmlEncode?x.replace(/</g,"&lt;").replace(/>/g,"&gt;"):x)+" ("+O+')</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("taskLink")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+I+'</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("lag")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+E+"</td></tr></tbody></table>"};n=(0,e.initializeCSPTemplate)(u,this);break;case"indicator":if(a.target.title.length){var F=a.target.title;this.parent.enableHtmlSanitizer&&"string"==typeof F&&(F=e.SanitizeHtmlHelper.sanitize(F));u=function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr>'+F+"</tr></tbody></table>"};n=(0,e.initializeCSPTemplate)(u)}break;case"timeline":var U=a.target.title;this.parent.enableHtmlSanitizer&&"string"==typeof U&&(U=e.SanitizeHtmlHelper.sanitize(U));u=function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr>'+U+"</tr></tbody></table>"};n=(0,e.initializeCSPTemplate)(u);break;case"manualtaskbar":var N=this.parent.getFormatedDate(s.autoStartDate,this.parent.getDateFormat()),L=this.parent.getFormatedDate(s.autoEndDate,this.parent.getDateFormat()),V=this.parent.getDurationString(s.duration,s.durationUnit),B=this.parent.getFormatedDate(s.startDate,this.parent.getDateFormat()),A=this.parent.getFormatedDate(s.endDate,this.parent.getDateFormat());this.parent.enableHtmlSanitizer&&(N="string"==typeof N?e.SanitizeHtmlHelper.sanitize(N):N,L="string"==typeof L?e.SanitizeHtmlHelper.sanitize(L):L,V="string"==typeof V?e.SanitizeHtmlHelper.sanitize(V):V,B="string"==typeof B?e.SanitizeHtmlHelper.sanitize(B):B,A="string"==typeof A?e.SanitizeHtmlHelper.sanitize(A):A);var W=s.autoStartDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksStartDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+N+"</td></tr>":"",H=s.autoEndDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksEndDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+L+"</td></tr>":"",j=(0,e.isNullOrUndefined)(s.duration)?"":'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("duration")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+V+"</td></tr>",G=s.startDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("startDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+B+"</td></tr>":"",z=s.endDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("endDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+A+"</td></tr>":"";u=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+o+G+W+z+H+j+"</tbody></table>"};n=(0,e.initializeCSPTemplate)(u);break;case"manualmilestone":var q=this.parent.getFormatedDate(s.autoStartDate,this.parent.getDateFormat()),_=this.parent.getFormatedDate(s.autoEndDate,this.parent.getDateFormat()),Z=this.parent.getFormatedDate(s.startDate,this.parent.getDateFormat());this.parent.enableHtmlSanitizer&&(q="string"==typeof q?e.SanitizeHtmlHelper.sanitize(q):q,_="string"==typeof _?e.SanitizeHtmlHelper.sanitize(_):_,Z="string"==typeof Z?e.SanitizeHtmlHelper.sanitize(Z):Z);var X=s.autoStartDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksStartDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+q+"</td></tr>":"",Y=s.autoEndDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksEndDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+_+"</td></tr>":"",Q='<tr><td class = "e-gantt-tooltip-label"> Date</td><td>:</td><td class = "e-gantt-tooltip-value">'+Z+"</tr>";u=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+o+Q+X+Y+"</tbody></table>"};n=(0,e.initializeCSPTemplate)(u)}return n},i.prototype.getMarkerTooltipData=function(e){var t=e.target.id.match(/\d+/g);return this.parent.eventMarkers[Number(t)]},i.prototype.getPredecessorTooltipData=function(t){var i=t.target.id;this.parent.enableHtmlSanitizer&&"string"==typeof i&&(i=e.SanitizeHtmlHelper.sanitize(i));var r,a,n=i.match(/ConnectorLineparent(.*)child(.*)/);n.shift(),"ResourceView"===this.parent.viewType?(r=this.parent.flatData[this.parent.getTaskIds().indexOf("T"+n[0])],a=this.parent.flatData[this.parent.getTaskIds().indexOf("T"+n[1])]):(r=this.parent.flatData[this.parent.ids.indexOf(n[0])],a=this.parent.flatData[this.parent.ids.indexOf(n[1])]);var s=r.ganttProperties.predecessor.filter((function(e){return e.to===n[1]}));return{fromId:"ResourceView"===this.parent.viewType?r.ganttProperties.taskId:r.ganttProperties.rowUniqueID,toId:"ResourceView"===this.parent.viewType?a.ganttProperties.taskId:a.ganttProperties.rowUniqueID,fromName:r.ganttProperties.taskName,toName:a.ganttProperties.taskName,linkType:s[0].type,linkText:this.parent.getPredecessorTextValue(s[0].type),offset:s[0].offset,offsetUnit:s[0].offsetUnit,offsetString:this.parent.getDurationString(s[0].offset,s[0].offsetUnit)}},i.prototype.templateCompiler=function(t,i,r,a){var n=i.chartRowsModule.templateCompiler(t),s=i.chartRowsModule.getTemplateID(a);return n((0,e.extend)({index:0},r),i,a,s,!0)},i.prototype.destroy=function(){this.toolTipObj.destroy()},i}(),ni=function(){function t(e){this.parent=e,this.activeElement=null,this.previousActiveElement=null}return t.prototype.getActiveElement=function(e){return e?this.previousActiveElement:this.activeElement},t.prototype.setActiveElement=function(e){this.previousActiveElement=this.activeElement,this.activeElement=e},t.prototype.onKeyPress=function(t){var i=this.parent,r=i.getExpandedRecords(i.currentViewData);!(0,e.isNullOrUndefined)(this.parent.focusModule.getActiveElement())||"expandAll"!==t.action&&"collapseAll"!==t.action||this.parent.element.querySelector(".e-treegrid").focus();var a=this.parent.focusModule.getActiveElement();if("home"!==t.action&&"end"!==t.action&&"downArrow"!==t.action&&"upArrow"!==t.action&&"delete"!==t.action&&"rightArrow"!==t.action&&"leftArrow"!==t.action&&"focusTask"!==t.action&&"focusSearch"!==t.action&&"expandAll"!==t.action&&"collapseAll"!==t.action&&"undo"!==t.action&&"redo"!==t.action&&"selectAll"!==t.action||(0,e.isNullOrUndefined)(i.editModule)||(0,e.isNullOrUndefined)(i.editModule.cellEditModule)||!0!==i.editModule.cellEditModule.isCellEdit)switch(i.isAdaptive&&("addRowDialog"!==t.action&&"editRowDialog"!==t.action&&"delete"!==t.action&&"addRow"!==t.action||i.selectionModule&&"Multiple"===i.selectionSettings.type&&(i.selectionModule.hidePopUp(),document.getElementsByClassName("e-gridpopup")[0].style.display="none")),t.action){case"home":if(i.selectionModule&&"Cell"!==i.selectionSettings.mode){if(0===i.selectedRowIndex)return;i.selectionModule.selectRow(0,!1,!0)}break;case"end":if(i.selectionModule&&"Cell"!==i.selectionSettings.mode){var n=r[r.length-1];if(i.selectedRowIndex===i.flatData.indexOf(n))return;i.selectionModule.selectRow(i.flatData.indexOf(n),!1,!0)}break;case"downArrow":case"upArrow":(f=i.element.querySelector("#"+i.element.id+"_searchbar"))&&f.parentElement.classList.contains("e-input-focus")&&i.selectionModule.clearSelection(),i.element.classList.contains("e-scroll-disabled")||(this.upDownKeyNavigate(t),(0,e.isNullOrUndefined)(a)||(0,e.isNullOrUndefined)(a.closest(".e-chart-row"))||i.ganttChartModule.manageFocus(this.getActiveElement(),"remove",!0,t.action));break;case"expandAll":i.ganttChartModule.expandCollapseAll("expand");break;case"collapseAll":i.ganttChartModule.expandCollapseAll("collapse");break;case"expandRow":case"collapseRow":this.expandCollapseKey(t);break;case"saveRequest":if(!(0,e.isNullOrUndefined)(i.editModule)&&!(0,e.isNullOrUndefined)(i.editModule.cellEditModule)&&i.editModule.cellEditModule.isCellEdit){var s=i.editModule.cellEditModule.editedColumn;if(s.field===i.columnMapping.duration&&!(0,e.isNullOrUndefined)(s.edit)&&!(0,e.isNullOrUndefined)(s.edit.read)){var o=t.target.ej2_instances[0],l=t.target.value,d=i.currentViewData[i.selectedRowIndex].ganttProperties;s.field===i.columnMapping.duration&&l!==((0,e.isNullOrUndefined)(s.edit)||(0,e.isNullOrUndefined)(s.edit.read)?(0,e.isNullOrUndefined)(s.valueAccessor)?i.dataOperation.getDurationString(d.duration,d.durationUnit):s.valueAccessor(i.columnMapping.duration,i.editedRecords,s):s.edit.read()).toString()&&(o.value=l,o.dataBind())}if(i.editModule.dialogModule.dialogObj&&(0,e.getValue)("dialogOpen",i.editModule.dialogModule.dialogObj))return;i.treeGrid.grid.saveCell(),i.element.querySelector(".e-treegrid").focus()}if(!(0,e.isNullOrUndefined)(this.parent.onTaskbarClick)&&!(0,e.isNullOrUndefined)(a)&&!(0,e.isNullOrUndefined)(a.closest(".e-chart-row"))){var h=t.target,p=a.querySelector(".e-gantt-parent-taskbar,.e-gantt-child-taskbar,.e-gantt-milestone");p&&this.parent.ganttChartModule.onTaskbarClick(t,h,p)}break;case"cancelRequest":(0,e.isNullOrUndefined)(i.editModule)||(0,e.isNullOrUndefined)(i.editModule.cellEditModule)||(i.editModule.cellEditModule.isCellEdit=!1,(0,e.isNullOrUndefined)(i.toolbarModule)||i.toolbarModule.refreshToolbarItems());break;case"addRow":if(i.editModule&&i.editModule.cellEditModule&&i.editModule.cellEditModule.isCellEdit)t.stopPropagation();else if((0,e.isNullOrUndefined)(document.getElementById(this.parent.element.id+"_dialog"))){t.preventDefault(),i.addRecord(void 0,this.parent.editSettings.newRowPosition,this.parent.selectedRowIndex),i.element.focus()}break;case"addRowDialog":if(t.preventDefault(),i.editModule&&i.editModule.dialogModule&&i.editSettings.allowAdding){if(i.editModule.dialogModule.dialogObj&&(0,e.getValue)("dialogOpen",i.editModule.dialogModule.dialogObj))return;i.editModule.dialogModule.openAddDialog()}break;case"editRowDialog":if(t.preventDefault(),i.element.querySelector(".e-treegrid").focus(),i.editModule&&i.editModule.dialogModule&&i.editSettings.allowEditing){if(i.editModule.dialogModule.dialogObj&&(0,e.getValue)("dialogOpen",i.editModule.dialogModule.dialogObj))return;i.editModule.dialogModule.openToolbarEditDialog()}break;case"delete":i.selectionModule&&i.editModule&&i.editModule.dialogModule&&(!i.editModule.dialogModule.dialogObj||i.editModule.dialogModule.dialogObj&&!i.editModule.dialogModule.dialogObj.visible)&&(!i.editSettings.allowTaskbarEditing||i.editSettings.allowTaskbarEditing&&!i.editModule.taskbarEditModule.touchEdit)&&("Cell"!==i.selectionSettings.mode&&i.selectionModule.selectedRowIndexes.length||"Cell"===i.selectionSettings.mode&&i.selectionModule.getSelectedRowCellIndexes().length)&&((0,e.isNullOrUndefined)(t.target)||"INPUT"!==t.target.tagName)&&i.editModule.startDeleteAction();break;case"focusTask":t.preventDefault();var u=void 0;if(i.selectionModule){var c=i.currentViewData;if("Cell"===i.selectionSettings.mode||(0,e.isNullOrUndefined)(c[i.selectedRowIndex])){if("Cell"===i.selectionSettings.mode&&i.selectionModule.getSelectedRowCellIndexes().length>0){var g=i.selectionModule.getSelectedRowCellIndexes();u=c[g[g.length-1].rowIndex].ganttProperties.rowUniqueID}}else u=i.currentViewData[i.selectedRowIndex].ganttProperties.rowUniqueID}u&&i.scrollToTask(u.toString());break;case"focusSearch":var f;if(i.element.querySelector("#"+i.element.id+"_searchbar"))(f=i.element.querySelector("#"+i.element.id+"_searchbar")).setAttribute("tabIndex","-1"),f.focus();break;case"tab":case"shiftTab":i.element.classList.contains("e-scroll-disabled")||i.ganttChartModule.onTabAction(t);break;case"contextMenu":var m=document.getElementById(this.parent.element.id+"_contextmenu").ej2_instances[0],y=this.parent.getOffsetRect(t.target),D=y.top+y.height/2,v=y.left+y.width/2;this.setActiveElement(t.target),m.open(D,v),t.preventDefault();break;case"undo":this.parent.undoRedoModule&&this.parent.undoRedoModule.getUndoCollection.length>0&&this.parent.undo();break;case"redo":this.parent.undoRedoModule&&this.parent.undoRedoModule.getRedoCollection.length>0&&this.parent.redo();break;case"selectAll":t.preventDefault();var k=[].slice.call(this.parent.ganttChartModule.chartBodyContent.querySelector("tbody").children);if(k.length>0){var w=k[0].getAttribute("data-rowindex"),b=k[k.length-1].getAttribute("data-rowindex");(0,e.isNullOrUndefined)(w)||(w=Number(w)),(0,e.isNullOrUndefined)(b)||(b=Number(b)),(0,e.isNullOrUndefined)(w)||(0,e.isNullOrUndefined)(b)||this.parent.selectionModule.selectRowsByRange(w,b)}break;default:var T={requestType:"keyPressed",action:t.action,keyEvent:t};i.trigger("actionComplete",T)}},t.prototype.upDownKeyNavigate=function(t){t.preventDefault();var i=this.parent,r=i.getExpandedRecords(i.currentViewData);if(i.selectionModule){if("Cell"!==i.selectionSettings.mode&&-1!==i.selectedRowIndex){var a=i.currentViewData[i.selectedRowIndex],n=i.element.querySelector(".e-focused");n&&(0,e.removeClass)([n],"e-focused");var s=r.indexOf(a),o="downArrow"===t.action?r[s+1]:r[s-1],l=this.parent.args;document.activeElement!==l&&i.selectionModule.selectRow(i.currentViewData.indexOf(o),!1,!0)}else if("Cell"===i.selectionSettings.mode&&i.selectionModule.getSelectedRowCellIndexes().length>0){var d=i.selectionModule.getSelectedRowCellIndexes(),h=d[d.length-1],p=h.cellIndexes[h.cellIndexes.length-1],u=(a=i.currentViewData[h.rowIndex],s=r.indexOf(a),o="downArrow"===t.action?r[s+1]:r[s-1],{rowIndex:i.currentViewData.indexOf(o),cellIndex:p});i.selectionModule.selectCell(u)}this.parent.ganttChartModule.focusedRowIndex=this.parent.selectedRowIndex}},t.prototype.expandCollapseKey=function(e){var t=this.parent;if(t.selectionModule&&-1!==t.selectedRowIndex){var i=void 0;if("Cell"!==t.selectionSettings.mode)i=t.selectedRowIndex;else if("Cell"===t.selectionSettings.mode&&t.selectionModule.getSelectedRowCellIndexes().length>0){var r=t.selectionModule.getSelectedRowCellIndexes();i=r[r.length-1].rowIndex}"expandRow"===e.action?t.expandByIndex(i):t.collapseByIndex(i)}},t}(),si=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),oi=function(e,t,i,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},li=function(a){function n(t,i){var r=a.call(this,t,i)||this;return r.isRowSelected=!1,r.showIndicator=!0,r.singleTier=0,r.isLocaleChanged=!1,r.totalUndoAction=0,r.previousFlatData=[],r.isCancelled=!1,r.isCollapseAll=!1,r.previousRecords={},r.editedRecords=[],r.modifiedRecords=[],r.isOnEdit=!1,r.isOnDelete=!1,r.isOnAdded=!1,r.isExpandCollapseLevelMethod=!1,r.isDynamicData=!1,r.isConnectorLineUpdate=!1,r.staticSelectedRowIndex=-1,r.needsID=!0,r.showActiveElement=!0,r.addDeleteRecord=!1,r.enableHeaderFocus=!0,r.enableValidation=!0,r.isTreeGridRendered=!1,r.isFromOnPropertyChange=!1,r.isFromRenderBaseline=!1,r.isGanttChartRendered=!1,r.isEdit=!1,r.eventMarkerColloction=[],(0,e.setValue)("mergePersistData",r.mergePersistGanttData,r),r}return si(n,a),n.prototype.getModuleName=function(){return"gantt"},n.prototype.preRender=function(){this.initProperties()},n.prototype.getCurrentDayStartTime=function(e){return this.weekWorkingTime.length>0?this.getStartTime(e):this.defaultStartTime},n.prototype.getCurrentDayEndTime=function(e){return this.weekWorkingTime.length>0?this.getEndTime(e):this.defaultEndTime},n.prototype.getStartTime=function(e){var t;switch(e.getDay()){case 0:t=this.sundayDefaultStartTime;break;case 1:t=this.mondayDefaultStartTime;break;case 2:t=this.tuesdayDefaultStartTime;break;case 3:t=this.wednesdayDefaultStartTime;break;case 4:t=this.thursdayDefaultStartTime;break;case 5:t=this.fridayDefaultStartTime;break;case 6:t=this.saturdayDefaultStartTime;break;default:t=this.defaultStartTime}return t},n.prototype.getEndTime=function(e){var t;switch(e.getDay()){case 0:t=this.sundayDefaultEndTime;break;case 1:t=this.mondayDefaultEndTime;break;case 2:t=this.tuesdayDefaultEndTime;break;case 3:t=this.wednesdayDefaultEndTime;break;case 4:t=this.thursdayDefaultEndTime;break;case 5:t=this.fridayDefaultEndTime;break;case 6:t=this.saturdayDefaultEndTime;break;default:t=this.defaultStartTime}return t},n.prototype.getNonWorkingRange=function(e){var t;switch(e.getDay()){case 0:t=this.sundayNonWorkingTimeRanges;break;case 1:t=this.mondayNonWorkingTimeRanges;break;case 2:t=this.tuesdayNonWorkingTimeRanges;break;case 3:t=this.wednesdayNonWorkingTimeRanges;break;case 4:t=this.thursdayNonWorkingTimeRanges;break;case 5:t=this.fridayNonWorkingTimeRanges;break;case 6:t=this.saturdayNonWorkingTimeRanges;break;default:t=this.nonWorkingTimeRanges}return t},n.prototype.getWorkingRange=function(e){var t;switch(e.getDay()){case 0:t=this.sundayWorkingTimeRanges;break;case 1:t=this.mondayWorkingTimeRanges;break;case 2:t=this.tuesdayWorkingTimeRanges;break;case 3:t=this.wednesdayWorkingTimeRanges;break;case 4:t=this.thursdayWorkingTimeRanges;break;case 5:t=this.fridayWorkingTimeRanges;break;case 6:t=this.saturdayWorkingTimeRanges;break;default:t=this.workingTimeRanges}return t},n.prototype.getSecondsPerDay=function(e){var t;switch(e.getDay()){case 0:t=this.sundaySeconds;break;case 1:t=this.mondaySeconds;break;case 2:t=this.tuesdaySeconds;break;case 3:t=this.wednesdaySeconds;break;case 4:t=this.thursdaySeconds;break;case 5:t=this.fridaySeconds;break;case 6:t=this.saturdaySeconds;break;default:t=this.secondsPerDay}return t},n.prototype.initProperties=function(){this.globalize=new e.Internationalization(this.locale),this.isAdaptive=e.Browser.isDevice,this.flatData=[],this.currentViewData=[],this.updatedRecords=[],this.ids=[],this.ganttColumns=[],this.updateOffsetOnTaskbarEdit=!1===this.UpdateOffsetOnTaskbarEdit?this.UpdateOffsetOnTaskbarEdit:this.updateOffsetOnTaskbarEdit,this.localeObj=new e.L10n(this.getModuleName(),this.getDefaultLocale(),this.locale),this.dataOperation=new T(this),this.nonWorkingHours=[],this.mondayNonWorkingHours=[],this.tuesdayNonWorkingHours=[],this.wednesdayNonWorkingHours=[],this.thursdayNonWorkingHours=[],this.fridayNonWorkingHours=[],this.saturdayNonWorkingHours=[],this.sundayNonWorkingHours=[],this.nonWorkingTimeRanges=[],this.mondayNonWorkingTimeRanges=[],this.tuesdayNonWorkingTimeRanges=[],this.wednesdayNonWorkingTimeRanges=[],this.thursdayNonWorkingTimeRanges=[],this.fridayNonWorkingTimeRanges=[],this.saturdayNonWorkingTimeRanges=[],this.sundayNonWorkingTimeRanges=[],this.workingTimeRanges=[],this.mondayWorkingTimeRanges=[],this.tuesdayWorkingTimeRanges=[],this.wednesdayWorkingTimeRanges=[],this.thursdayWorkingTimeRanges=[],this.fridayWorkingTimeRanges=[],this.saturdayWorkingTimeRanges=[],this.sundayWorkingTimeRanges=[],this.defaultEndTime=null,this.defaultStartTime=null,this.mondayDefaultStartTime=null,this.mondayDefaultEndTime=null,this.tuesdayDefaultStartTime=null,this.tuesdayDefaultEndTime=null,this.wednesdayDefaultStartTime=null,this.wednesdayDefaultEndTime=null,this.thursdayDefaultStartTime=null,this.thursdayDefaultEndTime=null,this.fridayDefaultStartTime=null,this.fridayDefaultEndTime=null,this.saturdayDefaultStartTime=null,this.saturdayDefaultEndTime=null,this.sundayDefaultStartTime=null,this.sundayDefaultEndTime=null,this.durationUnitTexts={days:"days",hours:"hours",minutes:"minutes",day:"day",hour:"hour",minute:"minute"},this.durationUnitEditText={minute:["m","min","minute","minutes"],hour:["h","hr","hour","hours"],day:["d","dy","day","days"]},this.perDayWidth=null,this.isMileStoneEdited=!1,this.chartVerticalLineContainer=null,this.updatedConnectorLineCollection=[],this.connectorLineIds=[],this.predecessorsCollection=[],this.isInPredecessorValidation=this.enablePredecessorValidation,this.isValidationEnabled=!0,this.isLoad=!0,this.editedTaskBarItem=null,this.validationDialogElement=null,this.currentEditedArgs={},this.dialogValidateMode={respectLink:!1,removeLink:!1,preserveLinkWithEditing:!0},this.secondsPerDay=this.dataOperation.getSecondsPerDay(),this.nonWorkingDayIndex=[],this.dataOperation.getNonWorkingDayIndex(),this.columnMapping={},this.controlId=this.element.id,this.cloneProjectStartDate=this.enablePersistence&&this.cloneProjectStartDate?this.cloneProjectStartDate:null,this.cloneProjectEndDate=this.enablePersistence&&this.cloneProjectEndDate?this.cloneProjectEndDate:null,this.totalHolidayDates=this.dataOperation.getHolidayDates(),this.ganttChartModule=new Ge(this),this.timelineModule=new qe(this),this.chartRowsModule=new Jt(this),this.treeGridModule=new Xe(this),this.dateValidationModule=new w(this),this.predecessorModule=new $t(this),this.connectorLineModule=new ti(this),this.splitterModule=new ri(this),this.tooltipModule=new ai(this),this.keyConfig={home:"home",end:"end",downArrow:"downarrow",upArrow:"uparrow",collapseAll:"ctrl+uparrow",expandAll:"ctrl+downarrow",collapseRow:"ctrl+shift+uparrow",expandRow:"ctrl+shift+downarrow",saveRequest:"13",cancelRequest:"27",addRow:"insert",addRowDialog:"ctrl+insert",editRowDialog:"ctrl+f2",delete:"delete",tab:"tab",shiftTab:"shift+tab",focusTask:"shift+f5",indentLevel:"shift+leftarrow",outdentLevel:"shift+rightarrow",focusSearch:"ctrl+shift+70",contextMenu:"shift+F10",undo:"ctrl+z",redo:"ctrl+y",selectAll:"ctrl+a"},this.focusModule=new ni(this),0===this.zoomingLevels.length&&this.setProperties({zoomingLevels:this.getZoomingLevels()},!0),this.resourceFieldsMapping(),(0,e.isNullOrUndefined)(this.resourceFields.unit)&&this.setProperties({resourceFields:{unit:"unit"}},!0),this.taskIds=[]},n.prototype.isUndoRedoItemPresent=function(e){return!(!this.undoRedoModule||!this.undoRedoActions||-1===this.undoRedoActions.indexOf(e))},n.prototype.getDateFormat=function(){return(0,e.isNullOrUndefined)(this.dateFormat)?this.globalize.getDatePattern({skeleton:"yMd"}):this.dateFormat},n.prototype.getDefaultTZOffset=function(){var e=new Date((new Date).getFullYear(),0,1),t=new Date((new Date).getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},n.prototype.isInDst=function(e){return e.getTimezoneOffset()<this.getDefaultTZOffset()},n.prototype.resourceFieldsMapping=function(){var t=this.resourceFields;t.id=(0,e.isNullOrUndefined)(t.id)?this.resourceIDMapping:t.id,t.name=(0,e.isNullOrUndefined)(t.name)?this.resourceNameMapping:t.name},n.prototype.validateDimentionValue=function(t){return(0,e.isNullOrUndefined)(t)?null:"string"==typeof t&&"auto"!==t&&-1===t.indexOf("%")?-1===t.indexOf("px")?t+"px":t:"number"==typeof t?t+"px":t.toString()},n.prototype.calculateDimensions=function(){var t=this.validateDimentionValue(this.height),i=this.validateDimentionValue(this.width);(0,e.isNullOrUndefined)(this.width)||"string"!=typeof this.width||-1===this.width.indexOf("%")||(i=this.width);var r=this.element.style.height,a=this.element.style.width;i&&(this.element.style.width=i),t&&(this.element.style.height=t),t||r||(this.element.style.height="auto"),i||a||(this.element.style.width="auto"),this.ganttHeight=this.element.offsetHeight,this.ganttWidth=this.element.offsetWidth},n.prototype.render=function(){this.isReact&&(this.treeGrid.isReact=!0,this.treeGrid.grid.isReact=!0),this.isVue&&(this.treeGrid.isVue=!0,this.treeGrid.grid.isVue=!0,this.treeGrid.vueInstance=this.vueInstance,this.treeGrid.grid.vueInstance=this.vueInstance),this.element.setAttribute("role","application"),(0,t.createSpinner)({target:this.element},this.createElement),this.trigger("load",{}),this.element.classList.add(P);var i=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")&&36===this.rowHeight?46:this.rowHeight;this.rowHeight=(0,e.isNullOrUndefined)(this.rowHeight)?36:i,this.isAdaptive?this.element.classList.add(R):this.element.classList.remove(R),this.calculateDimensions(),(0,e.isNullOrUndefined)(this.toolbarModule)||this.renderToolbar(),this.splitterModule.renderSplitter(),this.notify("renderPanels",null),this.actionFailures(),(0,e.isNullOrUndefined)(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.showSpinner():this.showMaskRow(),this.dataMap&&this.dataMap.clear(),this.dataOperation.checkDataBinding()},n.prototype.actionFailures=function(){var t=[],i=/^[a-zA-Z\s/]+$/,a=!0,n=this.taskFields.properties;Object.keys(n).forEach((function(e){null!==n[e]&&(a=!1,!0)}));for(var s,o,l,d,h,p=!0,u=0;u<this.columns.length;u++)if(this.columns[u].isPrimaryKey){p=!1;break}function c(t,i,r,a){var n;(0,e.isNullOrUndefined)(r)||(n=r.filter((function(e){return e.prototype.getModuleName()===t}))),i&&!(0,e.isNullOrUndefined)(n)&&0===n.length&&a.push("Module "+t+" is not available in Gantt component! You either misspelled the module name or forgot to load it!")}if(a&&t.push("Gantt Task Fields are not configured properly. The task fields are crucial for both the project and resource views to function properly. Please ensure that the gantt task fields are properly configured!"),"ResourceView"===this.viewType&&(this.resourceFields.id||t.push("Gantt Resource Fields are not properly configured, which is crucial for the Resource View. Please ensure that the resource fields are configured correctly!")),this.dataSource instanceof r.DataManager&&(0,e.isNullOrUndefined)(this.taskFields.hasChildMapping)&&t.push("hasChildMapping property is not configured for load-on-demand. Please ensure its properly configured in the Gantt Task Fields!"),(0,e.isNullOrUndefined)(this.timelineSettings.topTier.format)||""===this.timelineSettings.topTier.format||i.test(this.timelineSettings.topTier.format)||t.push("The provided top tier format is invalid. Please ensure that you provide a valid format for these tier. Make sure to use only letters and avoid numbers or special characters!"),(0,e.isNullOrUndefined)(this.timelineSettings.bottomTier.format)||""===this.timelineSettings.bottomTier.format||i.test(this.timelineSettings.bottomTier.format)||t.push("The provided bottom  tier format is invalid. Please ensure that you provide a valid format for these tier. Make sure to use only letters and avoid numbers or special characters!"),p&&"ResourceView"!==this.viewType&&t.push("Primarykey is not configured properly. The primarykey is crucial for doing CRUD operations or map taskId in column field of gantt!"),this.eventMarkers.length>0&&this.eventMarkers.forEach((function(e){e.day||t.push("Day is not configured properly in event markers.Please ensure that the day in event markers is properly configured!")})),c("sort",this.allowSorting,this.injectedModules,t),(this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing||this.editSettings.allowNextRowEdit||this.editSettings.allowTaskbarEditing||this.editSettings.mode||this.editSettings.newRowPosition||this.editSettings.showDeleteConfirmDialog)&&(s=!0),c("edit",s,this.injectedModules,t),c("reorder",this.allowReordering,this.injectedModules,t),c("excelExport",this.allowExcelExport,this.injectedModules,t),(this.allowRowDragAndDrop||this.allowTaskbarDragAndDrop)&&(o=!0),c("rowDragAndDrop",o,this.injectedModules,t),c("criticalPath",this.enableCriticalPath,this.injectedModules,t),c("undoRedo",this.enableUndoRedo,this.injectedModules,t),c("resize",this.allowResizing,this.injectedModules,t),this.toolbar&&this.toolbar.length>0&&(l=!0),c("toolbar",l,this.injectedModules,t),(this.allowFiltering||this.toolbar&&-1!==this.toolbar.indexOf("Search"))&&(d=!0),c("filter",d,this.injectedModules,t),c("selection",this.allowSelection,this.injectedModules,t),(this.highlightWeekends||this.holidays&&this.holidays.length>0||this.eventMarkers&&this.eventMarkers.length>0)&&(h=!0),c("dayMarkers",h,this.injectedModules,t),c("contextMenu",this.enableContextMenu,this.injectedModules,t),c("columnMenu",this.showColumnMenu,this.injectedModules,t),c("pdfExport",this.allowPdfExport,this.injectedModules,t),c("virtualScroll",this.enableVirtualization,this.injectedModules,t),t.length>0){var g={error:{}};t.forEach((function(e,t){g.error[parseInt(t,10)]=e})),this.trigger("actionFailure",g)}},n.prototype.hideMaskRow=function(){var t=this.element.querySelectorAll(".e-masked-table").length;if(!(0,e.isNullOrUndefined)(this.contentMaskTable)&&(0!==t||this.contentMaskTable)){var i=this.contentMaskTable;(0,e.remove)(i),this.contentMaskTable=null}if(t=this.element.querySelectorAll(".e-masked-table").length,!(0,e.isNullOrUndefined)(this.headerMaskTable)&&(0!==t||this.headerMaskTable)){i=this.headerMaskTable;(0,e.remove)(i),this.headerMaskTable=null}for(;0!==this.element.querySelectorAll(".e-table-background").length;)this.element.querySelectorAll(".e-table-background")[0].remove();for(;0!==this.element.querySelectorAll(".e-temp-timeline").length;)this.element.querySelectorAll(".e-temp-timeline")[0].remove();if(0!==this.element.querySelectorAll("."+O).length)for(var r=0;r<this.singleTier;r++)(0,e.isNullOrUndefined)(this.element.querySelectorAll("."+O)[parseInt(r.toString(),10)])||(this.element.querySelectorAll("."+O)[parseInt(r.toString(),10)].style.visibility="visible");(0,e.isNullOrUndefined)(this.element.querySelector("."+x))||(this.element.querySelector("."+x).style.position="relative"),(0,e.isNullOrUndefined)(this.element.getElementsByClassName(C)[0])||(this.element.getElementsByClassName(C)[0].style.visibility="visible")},n.prototype.showMaskRow=function(){var e=this.chartPane.childNodes[0].childNodes[0];this.scrollLeftValue=this.chartPane.childNodes[0].childNodes[0].scrollLeft;var t=this.chartPane.childNodes[0].childNodes[1];if(this.treeGrid.element&&this.ganttChartModule.setVirtualHeight(),!this.contentMaskTable){if(t){var i=t;if(this.renderBackGround(i),0!==this.element.querySelectorAll("."+O).length){this.singleTier=this.timelineModule.isSingleTier?1:2;for(var r=0;r<this.singleTier;r++)this.element.querySelectorAll("."+O)[parseInt(r.toString(),10)].style.visibility="hidden"}0===this.singleTier&&(this.singleTier=2),this.element.getElementsByClassName(C)[0].style.visibility="hidden",this.contentMaskTable=this.contentMaskTable=this.createMaskTable(i)}if(e){this.element.querySelector("."+x).style.position="static";i=e;this.renderHeaderBackground(i),this.headerMaskTable=this.headerMaskTable=this.createMaskTable(i)}}},n.prototype.renderHeaderBackground=function(t){var i=t;if(!!(0,e.closest)(i,"."+x)){for(var r=this.createElement("div",{className:"e-table-background"}),a=0,n=Math.round(t.getBoundingClientRect().width),s=0;s<3;s++)this.enableRtl?r.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(n-=160)+"px; top:0px;"}})):r.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(a+=160)+"px; top:0px;"}}));i.insertBefore(r,i.firstChild)}},n.prototype.renderBackGround=function(t){var i=t;if(!!(0,e.closest)(i,"."+S)){for(var r=this.createElement("div",{className:"e-table-background"}),a=0,n=Math.round(t.getBoundingClientRect().width),s=0;s<3;s++)this.enableRtl?r.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(n-=160)+"px;z-index:1;"}})):r.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(a+=160)+"px;z-index:1;"}}));i.insertBefore(r,i.firstChild)}},n.prototype.createMaskTable=function(t){var i,r=t,a=t.getBoundingClientRect().height,n=!!(0,e.closest)(r,"."+x);if(n?((i=this.createEmptyTimeLineTable(a)).style.position="sticky",i.style.left="0px",this.enableRtl&&i.style.removeProperty("left")):((i=this.createEmptyMaskTable(a)).style.position="absolute",i.style.zIndex=1),n){i.style.height=t.getBoundingClientRect().height+"px";var s=this.createElement("div",{className:"e-temp-timeline"});s.style.width=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth+"px",s.style.position="sticky",this.enableRtl?s.style["margin-right"]=Math.abs(this.scrollLeftValue)+"px":s.style["margin-left"]=this.scrollLeftValue+"px",s.appendChild(i),r.insertBefore(s,r.firstChild)}else i.style.height=t.getBoundingClientRect().height+"px",r.insertBefore(i,r.firstChild);return i},n.prototype.createEmptyTimeLineTable=function(e){for(var t=this.createElement("table",{className:"e-table e-masked-table"}),i=this.createElement("tbody",{className:"e-masked-tbody"}),r=[],a=this.createElement("tr",{className:"e-masked-row e-row",attrs:{style:"height: "+e/2+"px;"}}),n=0;n<this.singleTier;n++)r.push(a.cloneNode(!0));this.topBottomHeader=0;for(n=0;n<r.length;n++)i.appendChild(this.applyTimelineMaskRow(r[parseInt(n.toString(),10)])),this.topBottomHeader=this.topBottomHeader+1;return t.appendChild(i),t.style.width="100%",t},n.prototype.applyTimelineMaskRow=function(e){var t=e,i=4;this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/166>4&&(i=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/166);for(var r=0;r<i;r++)t.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"}));for(r=0;r<t.childNodes.length-1;r++)t.childNodes[parseInt(r.toString(),10)].style.width="166px";var a=[].slice.call(t.childNodes);for(r=0;r<a.length;r++){var n=a[parseInt(r.toString(),10)];switch(this.topBottomHeader){case 0:this.enableRtl?(n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-timelineHeader"></span>',n.children[0].style.left="-20px"):n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-timelineHeader"></span>';break;case 1:n.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"})),n.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"})),n.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"}));for(var s=[].slice.call(n.childNodes),o=0;o<s.length;o++){var l=s[parseInt(o.toString(),10)];0===o?this.enableRtl?(l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML"></span>',l.children[0].style.left="-14px"):l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML"></span>':1===o?this.enableRtl?(l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML1"></span>',l.children[0].style.left="-30px"):l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML1"></span>':this.enableRtl?(l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML2"></span>',l.children[0].style.left="-60px"):l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML2"></span>'}}}return t},n.prototype.createEmptyMaskTable=function(e){var t=this.createElement("table",{className:"e-table e-masked-table"}),i=this.createElement("tbody",{className:"e-masked-tbody"}),r=[],a=this.createElement("tr",{className:"e-masked-row e-row",attrs:{style:"height: "+e/7+"px;"}});this.columnLoop=0;for(var n=0;n<6;n++)r.push(a.cloneNode(!0));for(var s=0;s<r.length;s++)this.columnLoop<4?this.columnLoop=this.columnLoop+1:4===this.columnLoop&&(this.columnLoop=1),i.appendChild(this.applyMaskRow(r[parseInt(s.toString(),10)]));t.appendChild(i),t.style.width="100%";var o=this.createElement("div",{className:"e-temp-container"});return o.style.width="calc(100% - 17px)",o.style.overflow="hidden",o.appendChild(t),o},n.prototype.applyMaskRow=function(e){var t=e;if(this.columnLoop<4){var i=2;this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/300>2&&(i=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/300);for(var r=0;r<i;r++)t.appendChild(this.createElement("td",{className:"e-masked-cell e-rowcell"}))}else t.appendChild(this.createElement("td",{className:"e-masked-cell e-rowcell"}));var a=[].slice.call(t.childNodes);for(r=0;r<a.length;r++){var n=a[parseInt(r.toString(),10)];switch(this.columnLoop){case 1:0===r?this.enableRtl?(n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell01"></span>',n.children[0].style.left="-14px"):n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell01"></span>':n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell02"></span>';break;case 2:0===r?this.enableRtl?(n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell03"></span>',n.children[0].style.left="-14px"):n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell03"></span>':n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell04"></span>';break;case 3:0===r?this.enableRtl?(n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell05"></span>',n.children[0].style.left="-64px"):n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell05"></span>':this.enableRtl?(n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell06"></span>',n.children[0].style.left="-192px"):n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell06"></span>';break;case 4:this.enableRtl?(n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell07"></span>',n.children[0].style.left="-388px"):n.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell07"></span>'}}return t},n.prototype.showSpinner=function(){(0,t.showSpinner)(this.element)},n.prototype.hideSpinner=function(){(0,t.hideSpinner)(this.element)},n.prototype.processTimeline=function(){this.timelineModule.processTimelineUnit(),this.timelineModule.calculateZoomingLevelsPerDayWidth()},n.prototype.renderGantt=function(t){if(t&&(this.isFromOnPropertyChange=t),this.allowParentDependency&&this.predecessorModule.updateParentPredecessor(),this.predecessorModule&&this.taskFields.dependency&&(this.predecessorModule.parentIds=[],this.predecessorModule.parentRecord=[],this.predecessorModule.updatePredecessors(),this.isInPredecessorValidation&&this.enableValidation&&this.autoCalculateDateScheduling&&(!this.isLoad||this.treeGrid.loadChildOnDemand||!this.taskFields.hasChildMapping)&&this.predecessorModule.updatedRecordsDateByPredecessor()),this.enableValidation&&(this.dataOperation.calculateProjectDates(),this.timelineModule.validateTimelineProp(),this.dataOperation.updateGanttData()),t){if(this.dataSource instanceof Object&&s(this)){var i=(0,e.getValue)("count",this.dataSource);this.treeGrid.dataSource={result:this.flatData,count:i}}else this.treeGrid.setProperties({dataSource:this.flatData},!1);(0,e.isNullOrUndefined)(this.selectionModule)||this.treeGrid.setProperties({selectedRowIndex:this.selectedRowIndex},!1)}else this.treeGridPane.classList.remove("e-temp-content"),(0,e.remove)(this.treeGridPane.querySelector(".e-gantt-temp-header")),this.notify("dataReady",{}),this.enableContextMenu&&this.notify("initiate-contextMenu",{}),this.renderTreeGrid(),this.wireEvents(),this.notify("initPredessorDialog",{});this.isFromOnPropertyChange||this.splitterModule.updateSplitterPosition(),"Vertical"!==this.gridLines&&"Both"!==this.gridLines||this.dayMarkersModule||this.renderChartVerticalLines()},n.prototype.removeCriticalPathStyles=function(){var t=this.ganttChartModule.chartElement;(0,e.removeClass)(t.querySelectorAll(".e-gantt-child-taskbar-inner-div"),H),(0,e.removeClass)(t.querySelectorAll(".e-gantt-child-progressbar-inner-div"),j),(0,e.removeClass)(t.querySelectorAll(".e-critical-milestone"),G),(0,e.removeClass)(this.element.querySelectorAll(".e-connector-line"),we),(0,e.removeClass)(this.element.querySelectorAll(".e-connector-line-arrow"),be)},n.prototype.wireEvents=function(){this.allowKeyboard&&(this.keyboardModule=new e.KeyboardEvents(this.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfig,eventName:"keydown"})),e.EventHandler.add(window,"resize",this.windowResize,this),e.EventHandler.add(document.body,"keydown",this.keyDownHandler,this)},n.prototype.unwireEvents=function(){this.keyboardModule&&(this.keyboardModule.destroy(),this.keyboardModule=null),e.EventHandler.remove(window,"resize",this.windowResize),e.EventHandler.remove(document.body,"keydown",this.keyDownHandler)},n.prototype.keyDownHandler=function(e){e.altKey&&74===e.keyCode&&(this.ganttChartModule.manageFocus(this.treeGrid.element.childNodes[1],"remove",!1),this.ganttChartModule.manageFocus(this.element,"add",!1))},n.prototype.windowResize=function(){var t=this;if(!(0,e.isNullOrUndefined)(this.element)){this.updateContentHeight(),this.ganttChartModule.updateWidthAndHeight(),this.treeGridModule.ensureScrollBar(),this.predecessorModule&&this.taskFields.dependency&&(this.updateRowHeightInConnectorLine(this.updatedConnectorLineCollection),this.connectorLineModule.renderConnectorLines(this.updatedConnectorLineCollection));var i=this.criticalPathModule;this.enableCriticalPath&&i&&i.criticalPathCollection&&this.criticalPathModule.criticalConnectorLine(i.criticalPathCollection,i.detailPredecessorCollection,!0,i.predecessorCollectionTaskIds),this.calculateDimensions();var r=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[0],a=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[1];this.splitterModule.splitterPreviousPositionGrid=r.scrollWidth+1+"px",this.splitterModule.splitterPreviousPositionChart=a.scrollWidth+1+"px",this.splitterModule.splitterObject.paneSettings[1].size=this.ganttWidth-parseInt(this.splitterModule.splitterPreviousPositionGrid,10)-4+"px",this.timelineModule.isZoomToFit&&setTimeout((function(){t.timelineModule.processZoomToFit()}),0)}this.dayMarkersModule&&this.dayMarkersModule.eventMarkerRender&&this.dayMarkersModule.eventMarkerRender.updateContainerHeight(),this.enableTimelineVirtualization&&this.timelineModule.refreshTimeline()},n.prototype.keyActionHandler=function(t){if(this.enableContextMenu&&this.contextMenuModule&&("downArrow"===t.action||"upArrow"===t.action)&&document.getElementById(this.element.id+"_contextmenu")&&this.args){var i=this.args;(0,e.isNullOrUndefined)(i)||i.focus()}!t.target||"downArrow"!==t.action&&"upArrow"!==t.action||t.target!==this.element.querySelector(".e-rowcell")?this.focusModule.onKeyPress(t):this.treeGrid.grid.notify("key-pressed",t)},n.prototype.updateRowHeightInConnectorLine=function(e){if(e&&e.length){var t=this.ganttChartModule.getChartRows()[0]&&this.ganttChartModule.getChartRows()[0].getBoundingClientRect().height;if(t&&!isNaN(t))for(var i=0;i<e.length;i++)e[i].rowHeight=t}},n.prototype.renderToolbar=function(){(0,e.isNullOrUndefined)(this.toolbarModule)||(this.toolbarModule.renderToolbar(),this.toolbarModule.refreshToolbarItems())},n.prototype.renderTreeGrid=function(){this.treeGridModule.renderTreeGrid()},n.prototype.updateCurrentViewData=function(){var t=this;if(this.currentViewData=this.treeGrid.getCurrentViewRecords().slice(),!this.loadChildOnDemand&&this.taskFields.hasChildMapping&&this.currentViewData.length>0){this.isLoad=!0,this.flatData=[],this.dataOperation.taskIds=[],this.ids=[],this.dataOperation.recordIndex=0,this.dataOperation.dataArray=this.currentViewData,this.dataOperation.cloneDataSource(),this.predecessorModule&&this.taskFields.dependency&&(this.predecessorModule.parentIds=[],this.predecessorModule.parentRecord=[],this.predecessorModule.updatePredecessors());for(var i=this.treeGrid.grid.contentModule.rows.filter((function(e){if(e.data[t.taskFields.id]===t.flatData[0].ganttProperties.taskId)return e}))[0].index,r=0;r<this.flatData.length;r++)this.flatData[r].index=i,i++;this.currentViewData=this.flatData,this.treeGrid.grid.currentViewData=this.flatData,(0,e.isNullOrUndefined)(this.treeGrid.virtualScrollModule)||(this.treeGrid.virtualScrollModule.visualData=this.flatData,this.updatedRecords=this.flatData)}},n.prototype.getRecordFromFlatdata=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.getTaskByUniqueID(e[i].uniqueID));return t},n.prototype.updateContentHeight=function(t){if(this.allowTaskbarOverlap||this.ganttChartModule.isCollapseAll||this.ganttChartModule.isExpandAll||this.isLoad)if(this.virtualScrollModule&&this.enableVirtualization&&!(0,e.isNullOrUndefined)(t)){var i=(0,e.getValue)("result.length",t);this.contentHeight=i*this.rowHeight}else{var r=this.virtualScrollModule&&this.enableVirtualization?this.currentViewData:this.getExpandedRecords(this.currentViewData),a=void 0,n=(0,e.isNullOrUndefined)(this.ganttChartModule.getChartRows())?null:this.ganttChartModule.getChartRows()[0];a=!(0,e.isNullOrUndefined)(n)&&n.getBoundingClientRect().height>0?n.getBoundingClientRect().height:this.rowHeight,this.contentHeight=r.length*a}},n.prototype.getExpandStatus=function(t){var i=this.getParentTask(t.parentItem);return!!(0,e.isNullOrUndefined)(i)||!1!==i.expanded&&(!i.parentItem||!1!==this.getParentTask(i.parentItem).expanded&&this.getExpandStatus(this.getParentTask(i.parentItem)))},n.prototype.getExpandedRecords=function(t){var i=this;return(0,e.isNullOrUndefined)(t)?[]:t.filter((function(e){return!0===i.getExpandStatus(e)}))},n.prototype.getZoomingLevels=function(){var e=this.timelineSettings.weekStartDay;return[{topTier:{unit:"Year",format:"yyyy",count:50},bottomTier:{unit:"Year",format:"yyyy",count:10},timelineUnitSize:99,level:0,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:20},bottomTier:{unit:"Year",format:"yyyy",count:5},timelineUnitSize:99,level:1,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:5},bottomTier:{unit:"Year",format:"yyyy",count:1},timelineUnitSize:99,level:2,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"MMM, yy",count:1},bottomTier:{unit:"Month",formatter:this.displayHalfValue,count:6},timelineUnitSize:66,level:3,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"MMM, yy",count:1},bottomTier:{unit:"Month",formatter:this.displayHalfValue,count:6},timelineUnitSize:99,level:4,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"MMM, yy",count:1},bottomTier:{unit:"Month",formatter:this.displayQuarterValue,count:3},timelineUnitSize:66,level:5,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:1},bottomTier:{unit:"Month",formatter:this.displayQuarterValue,count:3},timelineUnitSize:99,level:6,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:1},bottomTier:{unit:"Month",format:"MMM yyyy",count:1},timelineUnitSize:99,level:7,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Month",format:"MMM, yy",count:1},bottomTier:{unit:"Week",format:"dd",count:1},timelineUnitSize:33,level:8,timelineViewMode:"Month",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Month",format:"MMM, yyyy",count:1},bottomTier:{unit:"Week",format:"dd MMM",count:1},timelineUnitSize:66,level:9,timelineViewMode:"Month",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Month",format:"MMM, yyyy",count:1},bottomTier:{unit:"Week",format:"dd MMM",count:1},timelineUnitSize:99,level:10,timelineViewMode:"Month",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Week",format:"MMM dd, yyyy",count:1},bottomTier:{unit:"Day",format:"d",count:1},timelineUnitSize:33,level:11,timelineViewMode:"Week",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Week",format:"MMM dd, yyyy",count:1},bottomTier:{unit:"Day",format:"d",count:1},timelineUnitSize:66,level:12,timelineViewMode:"Week",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Week",format:"MMM dd, yyyy",count:1},bottomTier:{unit:"Day",format:"d",count:1},timelineUnitSize:99,level:13,timelineViewMode:"Week",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:12},timelineUnitSize:66,level:14,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:12},timelineUnitSize:99,level:15,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:6},timelineUnitSize:66,level:16,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:6},timelineUnitSize:99,level:17,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:2},timelineUnitSize:66,level:18,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:2},timelineUnitSize:99,level:19,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:1},timelineUnitSize:66,level:20,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:1},timelineUnitSize:99,level:21,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Hour",format:"ddd MMM, h a",count:1},bottomTier:{unit:"Minutes",format:"mm",count:30},timelineUnitSize:66,level:22,timelineViewMode:"Hour",weekStartDay:0,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Hour",format:"ddd MMM, h a",count:1},bottomTier:{unit:"Minutes",format:"mm",count:15},timelineUnitSize:66,level:23,timelineViewMode:"Hour",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Hour",format:"ddd MMM, h a",count:1},bottomTier:{unit:"Minutes",format:"mm",count:1},timelineUnitSize:66,level:24,timelineViewMode:"Hour",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0}]},n.prototype.displayQuarterValue=function(e){var t=e.getMonth();return t>=0&&t<=2?"Q1":t>=3&&t<=5?"Q2":t>=6&&t<=8?"Q3":"Q4"},n.prototype.displayHalfValue=function(e){var t=e.getMonth();return t>=0&&t<=5?"H1":"H2"},n.prototype.getFormatedDate=function(t,i){return(0,e.isNullOrUndefined)(t)?null:((0,e.isNullOrUndefined)(i)&&(i=this.getDateFormat()),this.globalize.formatDate(t,{format:i}))},n.prototype.getDurationString=function(e,t){return this.dateValidationModule.getDurationString(e,t)},n.prototype.getWorkString=function(e,t){return this.dateValidationModule.getWorkString(e,t)},n.prototype.updateTreeColumns=function(){var t,i,r=this.treeGrid.grid.getColumns();-1!==this.treeColumnIndex&&this.columns[this.treeColumnIndex]&&!(0,e.isNullOrUndefined)(this.columns[this.treeColumnIndex].template)&&(t=this.columns[this.treeColumnIndex].template);for(var a=0;a<r.length;a++){i={};for(var n=0;n<this.columns.length;n++)if(this.columns[n].field===r[a].field){for(var s=0,o=Object.keys(this.columns[n]);s<o.length;s++){var l=o[s];(0,e.isUndefined)(this.columns[n][l])||(i[l]=r[a][l]),i.visible=r[a].visible,i.width=r[a].width}this.columns[n]=i,"checkbox"===this.columns[n].type||(0,e.isNullOrUndefined)(t)||""===t||(this.columns[n].template=t)}}this.columns.length>0&&this.treeGrid.setProperties({columns:this.columns},!0)},n.prototype.treeDataBound=function(t){this.isLoad&&this.undoRedoModule&&(this.sortSettings.columns.length>0?this.undoRedoModule.previousSortedColumns=this.sortSettings.columns:""!==this.searchSettings.key&&(this.undoRedoModule.searchString=this.searchSettings.key)),this.element.getElementsByClassName("e-chart-root-container")[0].style.height="100%",this.element.getElementsByClassName("e-gridcontent")[0].childNodes[0].setAttribute("tabindex","0"),this.element.getElementsByClassName("e-gridcontent")[0].childNodes[0].childNodes[0].setAttribute("role","treegrid");var i=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight,r=this.element.getElementsByClassName("e-chart-scroll-container e-content")[0];r.style.height="calc(100% - "+i+"px)",r.setAttribute("tabindex","0"),(0,e.isNullOrUndefined)(this.toolbarModule)||(0,e.isNullOrUndefined)(this.toolbarModule.element)?this.splitterElement.style.height="100%":this.splitterElement.style.height="calc(100% - "+this.toolbarModule.element.offsetHeight+"px)",this.isLoad?(this.enablePersistence&&this.updateTreeColumns(),this.updateCurrentViewData(),this.enableVirtualization||this.updateContentHeight(),this.isTreeGridRendered||(this.isTreeGridRendered=!0,this.timelineModule.isSingleTier?((0,e.addClass)(this.treeGrid.element.querySelectorAll(".e-headercell"),E),(0,e.addClass)(this.treeGrid.element.querySelectorAll(".e-columnheader"),E)):((0,e.removeClass)(this.treeGrid.element.querySelectorAll(".e-headercell"),E),(0,e.removeClass)(this.treeGrid.element.querySelectorAll(".e-columnheader"),E)),this.treeGrid.height="100%",this.notify("tree-grid-created",{}),this.createGanttPopUpElement(),(0,e.isNullOrUndefined)(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.hideSpinner():this.hideMaskRow(),(0,e.setValue)("isGanttCreated",!0,t),this.renderComplete())):this.getCurrentRecords(t),!this.loadChildOnDemand&&this.taskFields.hasChildMapping&&this.updateContentHeight(),this.enableCriticalPath&&this.criticalPathModule&&this.criticalPathModule.showCriticalPath(this.enableCriticalPath),this.notify("recordsUpdated",{});for(var a=0;a<document.getElementsByClassName("e-timeline-header-table-container").length;a++)for(var n=0;n<document.getElementsByClassName("e-timeline-header-table-container")[a].children[0].children[0].children.length;n++){var s=document.getElementsByClassName("e-timeline-header-table-container")[a].children[0].children[0].children[n].children[0];s&&s.setAttribute("tabindex","-1")}var o=this.criticalPathModule;this.enableCriticalPath&&o&&o.criticalPathCollection&&this.criticalPathModule.criticalConnectorLine(o.criticalPathCollection,o.detailPredecessorCollection,!0,o.predecessorCollectionTaskIds),this.initialChartRowElements=this.ganttChartModule.getChartRows(),this.isLoad=!1,this.undoRedoModule&&(this.previousFlatData=(0,e.extend)([],this.flatData,[],!0)),this.trigger("dataBound",t)},n.prototype.getCurrentRecords=function(e){this.predecessorModule&&this.taskFields.dependency&&this.connectorLineModule.removePreviousConnectorLines(this.currentViewData),this.updateCurrentViewData(),this.enableVirtualization||this.updateContentHeight(),this.virtualScrollModule&&this.enableVirtualization&&(this.ganttChartModule.virtualRender.adjustTable(),this.ganttChartModule.scrollObject.updateTopPosition())},n.prototype.onPropertyChanged=function(t,r){for(var a=!1,n=0,o=Object.keys(t);n<o.length;n++){var l=o[n];switch(l){case"allowSelection":case"allowRowDragAndDrop":case"allowFiltering":case"showColumnMenu":case"allowResizing":case"allowReordering":case"enableImmutableMode":this.treeGrid[l]=this[l],this.treeGrid.dataBind();break;case"workWeek":this.dataOperation.getNonWorkingDayIndex(),this.dataOperation.reUpdateGanttData(),this.chartRowsModule.initiateTemplates(),this.taskFields.dependency&&this.predecessorModule.updatedRecordsDateByPredecessor(),this.chartRowsModule.refreshGanttRows(),this.treeGrid.refreshColumns(),this.timelineModule.refreshTimeline();break;case"toolbar":this.notify("ui-toolbarupdate",{module:"toolbar",properties:t});break;case"columnMenuItems":this.treeGrid.grid.columnMenuItems=(0,i.getActualProperties)(this.columnMenuItems);break;case"eventMarkers":case"highlightWeekends":this.notify("ui-update",{module:"day-markers",properties:t});break;case"sortSettings":this.treeGrid.sortSettings=(0,i.getActualProperties)(this.sortSettings),this.treeGrid.dataBind();break;case"timelineSettings":this.timelineModule.refreshTimeline();break;case"rowHeight":case"taskbarHeight":this.treeGrid.rowHeight=this.rowHeight,this.treeGrid.dataBind(),this.chartRowsModule.initiateTemplates(),this.timelineModule.updateChartByNewTimeline(),this.taskFields.dependency&&this.ganttChartModule.reRenderConnectorLines();break;case"timezone":this.dataOperation.checkDataBinding(!0);break;case"enableCriticalPath":if((0,e.isNullOrUndefined)(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.hideSpinner():this.hideMaskRow(),this.enableCriticalPath&&this.criticalPathModule){this.criticalPathModule.showCriticalPath(this.enableCriticalPath);var d=this.criticalPathModule;d.criticalPathCollection&&this.criticalPathModule.criticalConnectorLine(d.criticalPathCollection,d.detailPredecessorCollection,!0,d.predecessorCollectionTaskIds)}else this.removeCriticalPathStyles();break;case"filterSettings":this.treeGrid.filterSettings=(0,i.getActualProperties)(this.filterSettings),this.treeGrid.dataBind();break;case"gridLines":this.treeGrid.gridLines=this.gridLines,this.treeGrid.dataBind(),this.renderChartGridLines();break;case"tooltipSettings":this.tooltipModule.toolTipObj&&this.tooltipModule.toolTipObj.destroy(),this.tooltipModule.createTooltip();break;case"splitterSettings":this.splitterModule.updateSplitterPosition();break;case"selectionSettings":this.treeGrid.selectionSettings=(0,i.getActualProperties)(this.selectionSettings),this.treeGrid.grid.selectionSettings.enableToggle=this.selectionSettings.enableToggle,this.treeGrid.dataBind();break;case"searchSettings":void 0!==t.searchSettings.key&&(this.treeGrid.grid.searchSettings=(0,i.getActualProperties)(this.searchSettings),this.treeGrid.grid.dataBind()),this.treeGrid.searchSettings=(0,i.getActualProperties)(this.searchSettings),this.treeGrid.dataBind(),this.toolbarModule&&this.toolbarModule.updateSearchTextBox();break;case"labelSettings":case"renderBaseline":case"baselineColor":this.isFromRenderBaseline=!0,this.chartRowsModule.initiateTemplates(),this.chartRowsModule.refreshGanttRows(),this.isFromRenderBaseline=!1;break;case"resourceIDMapping":case"resourceNameMapping":case"resources":this.dataOperation.reUpdateResources(),this.treeGrid.refreshColumns(),this.chartRowsModule.initiateTemplates(),this.chartRowsModule.refreshGanttRows();break;case"includeWeekend":case"allowUnscheduledTasks":case"holidays":this.isLoad=!0,"holidays"===l&&(this.totalHolidayDates=this.dataOperation.getHolidayDates(),this.notify("ui-update",{module:"day-markers",properties:t})),this.dataOperation.reUpdateGanttData(),this.treeGrid.refreshColumns(),this.chartRowsModule.initiateTemplates(),this.chartRowsModule.refreshGanttRows(),this.isLoad=!1,this.taskFields.dependency&&(this.predecessorModule.updatedRecordsDateByPredecessor(),this.treeGrid.refreshColumns(),this.chartRowsModule.refreshGanttRows());break;case"dayWorkingTime":case"weekWorkingTime":a=!0;break;case"addDialogFields":case"editDialogFields":this.editModule&&this.editModule.dialogModule&&this.editModule.dialogModule.processDialogFields();break;case"columns":this.treeGridModule.treeGridColumns=[],this.treeGridModule.validateGanttColumns(),this.treeGrid.columns=this.treeGridModule.treeGridColumns,this.treeGrid.refreshColumns(),this.chartRowsModule.initiateTemplates(),this.timelineModule.updateChartByNewTimeline();break;case"width":case"height":this.reUpdateDimention(l);break;case"editSettings":this.treeGrid.editSettings.allowAdding=this.editSettings.allowAdding,this.treeGrid.editSettings.allowDeleting=this.editSettings.allowDeleting,this.treeGrid.editSettings.showDeleteConfirmDialog=this.editSettings.showDeleteConfirmDialog,this.treeGrid.editSettings.allowEditing=this.editSettings.allowEditing,this.treeGrid.editSettings.allowNextRowEdit=this.editSettings.allowNextRowEdit,(0,e.isNullOrUndefined)(this.editModule)||this.editModule.reUpdateEditModules(),(0,e.isNullOrUndefined)(this.toolbarModule)||this.toolbarModule.refreshToolbarItems();break;case"connectorLineBackground":case"connectorLineWidth":this.taskFields.dependency&&(this.connectorLineModule.initPublicProp(),this.ganttChartModule.reRenderConnectorLines());break;case"treeColumnIndex":this.treeGrid.treeColumnIndex=this.treeColumnIndex;break;case"projectStartDate":case"projectEndDate":this.timelineModule.isZoomToFit=!1,this.dataOperation.calculateProjectDates(),this.updateProjectDates(this.cloneProjectStartDate,this.cloneProjectEndDate,this.isTimelineRoundOff);break;case"selectedRowIndex":(0,e.isNullOrUndefined)(this.selectionModule)||this.selectionModule.selectRowByIndex();break;case"dataSource":if(this.closeGanttActions(),this.dataSource instanceof Object&&s(this)){this.treeGrid.hasChildMapping="isParent";var h=(0,e.getValue)("count",this.dataSource);this.treeGrid.dataSource={result:this.flatData,count:h}}else this.treeGrid.hasChildMapping=null;this.dataOperation.checkDataBinding(!0);break;case"enableContextMenu":case"contextMenuItems":this.enableContextMenu||"contextMenuItems"===l?this.notify("reRender-contextMenu",{module:"contextMenu",enable:this.contextMenuItems}):this.treeGrid.contextMenuItems=[],this.treeGrid.dataBind();break;case"currencyCode":case"locale":case"enableRtl":case"readOnly":case"viewType":case"taskFields":case"allowTaskbarDragAndDrop":case"allowTaskbarOverlap":case"allowParentDependency":case"enableMultiTaskbar":if("locale"===l&&(this.isLocaleChanged=!0),"taskFields"===l&&!(0,e.isNullOrUndefined)(t.taskFields.child))return;"allowTaskbarDragAndDrop"!==l&&(a=!0);break;case"validateManualTasksOnLinking":this.validateManualTasksOnLinking=t.validateManualTasksOnLinking;break;case"showOverAllocation":this.updateOverAllocationCotainer()}}a&&(this.isLoad&&this.contentMaskTable&&(this.contentMaskTable=null),this.refresh())},n.prototype.updateOverAllocationCotainer=function(){if(this.showOverAllocation)this.ganttChartModule.renderOverAllocationContainer();else{var e=this.element.querySelector("."+Ae);e&&(e.innerHTML="")}},n.prototype.getPersistData=function(){for(var t=["sortSettings","filterSettings","columns","searchSettings","selectedRowIndex","treeColumnIndex","currentZoomingLevel","cloneProjectStartDate","cloneProjectEndDate"],i={filterSettings:["type","mode","showFilterBarStatus","immediateModeDelay","ignoreAccent","hierarchyMode"],searchSettings:["fields","operator","ignoreCase"],sortSettings:[],columns:[],selectedRowIndex:[]},r=0;r<t.length;r++)for(var a=this[t[r]],n=0,s=i[t[r]];!(0,e.isNullOrUndefined)(s)&&n<s.length;n++){delete a[s[n]]}return this.ignoreInArrays(["filter","edit","filterBarTemplate","headerTemplate","template","commandTemplate","commands","dataSource"],this.columns),this.addOnPersist(t)},n.prototype.ignoreInArrays=function(e,t){for(var i=0;i<t.length;i++)this.ignoreInColumn(e,t[i])},n.prototype.ignoreInColumn=function(e,t){for(var i=0;i<e.length;i++)delete t[e[i]],t.filter={}},n.prototype.destroy=function(){this.notify("destroy",{}),this.unwireEvents(),(0,e.isNullOrUndefined)(this.validationDialogElement)||this.validationDialogElement.isDestroyed||this.validationDialogElement.destroy();for(var t=["ganttChartModule","timelineModule","chartRowsModule","treeGridModule","ganttDataUpdatesModule","dateValidationModule","tooltipModule"],i=0;i<t.length;i++)this[t[i]]&&(this[t[i]]=null);this.keyboardModule&&this.keyboardModule.destroy(),this.editModule&&this.editModule.dialogModule&&this.editModule.dialogModule.destroy(),this.splitterModule&&this.splitterModule.destroy(),this.toolbarModule&&this.toolbarModule.toolbar.destroy(),(0,e.isNullOrUndefined)(this.dayMarkersModule)||(0,e.isNullOrUndefined)(this.dayMarkersModule.eventMarkerRender)||(0,e.isNullOrUndefined)(this.dayMarkersModule.eventMarkerRender.eventMarkersContainer)||(this.dayMarkersModule.eventMarkerRender.eventMarkersContainer=null),this.connectorLineModule&&(this.connectorLineModule.dependencyViewContainer=null,this.connectorLineModule.svgObject=null,this.connectorLineModule.renderer=null,this.connectorLineModule.tooltipTable=null),this.treeGridPane=null,this.initialChartRowElements=null,a.prototype.destroy.call(this),this.chartVerticalLineContainer=null,this.element.innerHTML="",(0,e.removeClass)([this.element],P),this.element.innerHTML="",this.isTreeGridRendered=!1,this.resetTemplates()},n.prototype.getTaskbarHeight=function(){return this.chartRowsModule.taskBarHeight},n.prototype.requiredModules=function(){var e=[];return this.isDestroyed||(this.allowSorting&&e.push({member:"sort",args:[this]}),(this.allowFiltering||this.toolbar&&-1!==this.toolbar.indexOf("Search"))&&e.push({member:"filter",args:[this]}),this.allowReordering&&e.push({member:"reorder",args:[this]}),this.allowExcelExport&&e.push({member:"excelExport",args:[this]}),(this.allowRowDragAndDrop||this.allowTaskbarDragAndDrop)&&e.push({member:"rowDragAndDrop",args:[this]}),this.enableCriticalPath&&e.push({member:"criticalPath",args:[this]}),this.enableUndoRedo&&e.push({member:"undoRedo",args:[this]}),this.allowResizing&&e.push({member:"resize",args:[this]}),this.toolbar&&this.toolbar.length>0&&e.push({member:"toolbar",args:[this]}),(this.editSettings.allowAdding||this.editSettings.allowEditing||this.editSettings.allowDeleting||this.editSettings.allowTaskbarEditing||this.allowRowDragAndDrop)&&e.push({member:"edit",args:[this]}),this.allowSelection&&e.push({member:"selection",args:[this]}),this.tooltipSettings.showTooltip&&e.push({member:"tooltip",args:[this]}),(this.highlightWeekends||this.holidays&&this.holidays.length>0||this.eventMarkers&&this.eventMarkers.length>0)&&e.push({member:"dayMarkers",args:[this]}),this.enableContextMenu&&e.push({member:"contextMenu",args:[this]}),this.showColumnMenu&&e.push({member:"columnMenu",args:[this]}),this.allowPdfExport&&e.push({member:"pdfExport",args:[this]}),this.enableVirtualization&&e.push({member:"virtualScroll",args:[this]})),e},n.prototype.sortColumn=function(e,t,i){this.sortModule&&this.allowSorting&&this.sortModule.sortColumn(e,t,i)},n.prototype.mergePersistGanttData=function(){this.treeGrid||(this.treeGrid=new _e.TreeGrid);this.treeGrid.grid.mergePersistGridData.apply(this)},n.prototype.mergeColumns=function(e,t){this.treeGrid.grid.mergeColumns.apply(this,[e,t])},n.prototype.setFrozenCount=function(){this.treeGrid.grid.setFrozenCount.apply(this)},n.prototype.splitFrozenCount=function(e){this.treeGrid.grid.splitFrozenCount.apply(this,[e])},n.prototype.isFrozenGrid=function(){return this.treeGrid.grid.isFrozenGrid()},n.prototype.clearSorting=function(){this.sortModule.clearSorting()},n.prototype.renderChartGridLines=function(){var t="e-chart-row-border",i=this.chartVerticalLineContainer,r=document.getElementById(this.element.id+"GanttTaskTableBody").querySelectorAll("td");if("Vertical"===this.gridLines){if((0,e.isNullOrUndefined)(i)?this.renderChartVerticalLines():"none"===i.style.display&&(i.style.display="block"),r[0].classList.contains(t))for(var a=0;a<r.length;a++)(0,e.removeClass)([r[a]],t)}else if("Horizontal"===this.gridLines){if((0,e.isNullOrUndefined)(i)||(i.style.display="none"),!r[0].classList.contains(t))for(a=0;a<r.length;a++)(0,e.addClass)([r[a]],t)}else if("Both"===this.gridLines){if((0,e.isNullOrUndefined)(i)?this.renderChartVerticalLines():"none"===i.style.display&&(i.style.display="block"),!r[0].classList.contains(t))for(a=0;a<r.length;a++)(0,e.addClass)([r[a]],t)}else if("None"===this.gridLines&&((0,e.isNullOrUndefined)(i)||"none"===i.style.display||(i.style.display="none"),r[0].classList.contains(t)))for(a=0;a<r.length;a++)(0,e.removeClass)([r[a]],t)},n.prototype.updateGridLineContainerHeight=function(){this.chartVerticalLineContainer&&(this.chartVerticalLineContainer.style.height=(0,e.formatUnit)(this.getContentHeight()))},n.prototype.getContentHeight=function(){var e=this.ganttChartModule.scrollElement.offsetHeight-16,t=this.ganttChartModule.chartBodyContent.offsetHeight;return t<e?t:e},n.prototype.reUpdateDimention=function(t){var i=0;if(this.calculateDimensions(),(0,e.isNullOrUndefined)(this.toolbarModule)||(0,e.isNullOrUndefined)(this.toolbarModule.element)||(this.toolbarModule.toolbar.refresh(),this.toolbarModule.refreshToolbarItems(),i=this.toolbarModule.element.offsetHeight),this.treeGrid.height=this.ganttHeight-i-this.treeGrid.grid.getHeaderContent().offsetHeight,this.splitterModule.splitterObject.height=(this.ganttHeight-i).toString(),(0,e.isNullOrUndefined)(this.chartVerticalLineContainer)||(this.chartVerticalLineContainer.style.height=this.ganttHeight+"px"),!(0,e.isNullOrUndefined)(this.dayMarkersModule)){var r=(0,e.getValue)("nonworkingDayRender.holidayContainer",this.dayMarkersModule),a=(0,e.getValue)("nonworkingDayRender.weekendContainer",this.dayMarkersModule),n=(0,e.getValue)("eventMarkerRender.eventMarkersContainer",this.dayMarkersModule);r&&(r.style.height=this.ganttHeight+"px"),a&&(a.style.height=this.ganttHeight+"px"),n&&(n.style.height=this.ganttHeight+"px")}"width"===t&&(this.splitterModule.splitterObject.width=this.ganttWidth.toString()),this.ganttChartModule.scrollObject.setHeight(this.ganttHeight-this.ganttChartModule.chartTimelineContainer.offsetHeight-i)},n.prototype.renderChartVerticalLines=function(){this.element.contains(this.chartVerticalLineContainer)||(this.chartVerticalLineContainer=(0,e.createElement)("div",{id:this.element.id+"line-container",styles:"position:absolute;height:100%;"}),this.ganttChartModule.chartBodyContent.insertBefore(this.chartVerticalLineContainer,this.ganttChartModule.chartBodyContent.lastChild)),this.chartVerticalLineContainer.innerHTML="";var t=this.element.getElementsByClassName("e-timeline-header-table-container")[1];(0,e.isNullOrUndefined)(t)&&(t=this.element.getElementsByClassName("e-timeline-header-table-container")[0]);for(var i,r=t.getElementsByTagName("th"),a=r.length,n=0,s=(0,e.createElement)("div"),o=0;o<a;o++){n=0===o?-1:n+parseFloat(i),i=r[o].style.width;var l=(0,e.createElement)("div",{className:"e-line-container-cell",styles:(this.enableRtl?"right:"+(n+1):"left:"+(-1!=n?n+.3:n))+"px"});s.appendChild(l)}this.chartVerticalLineContainer.innerHTML=s.innerHTML},n.prototype.getDefaultLocale=function(){return{emptyRecord:"No records to display",id:"ID",name:"Name",startDate:"Start Date",endDate:"End Date",duration:"Duration",progress:"Progress",dependency:"Dependency",notes:"Notes",criticalPath:"Critical Path",undo:"Undo",redo:"Redo",baselineStartDate:"Baseline Start Date",baselineEndDate:"Baseline End Date",taskMode:"Task Mode",changeScheduleMode:"Change Schedule Mode",subTasksStartDate:"SubTasks Start Date",subTasksEndDate:"SubTasks End Date",scheduleStartDate:"Schedule Start Date",scheduleEndDate:"Schedule End Date",auto:"Auto",manual:"Manual",type:"Type",offset:"Offset",resourceName:"Resources",resourceID:"Resource ID",day:"day",hour:"hour",minute:"minute",days:"days",hours:"hours",minutes:"minutes",generalTab:"General",customTab:"Custom Columns",writeNotes:"Write Notes",addDialogTitle:"New Task",editDialogTitle:"Task Information",add:"Add",edit:"Edit",update:"Update",delete:"Delete",cancel:"Cancel",search:"Search",task:" task",tasks:" tasks",zoomIn:"Zoom in",zoomOut:"Zoom out",zoomToFit:"Zoom to fit",excelExport:"Excel export",csvExport:"CSV export",pdfExport:"PDF export",expandAll:"Expand all",collapseAll:"Collapse all",nextTimeSpan:"Next timespan",prevTimeSpan:"Previous timespan",saveButton:"Save",taskBeforePredecessorFS:'You moved "{0}" to start before "{1}" finishes and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorFS:'You moved "{0}" away from "{1}" and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskBeforePredecessorSS:'You moved "{0}" to start before "{1}" starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorSS:'You moved "{0}" to start after "{1}" starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskBeforePredecessorFF:'You moved "{0}" to finish before "{1}" finishes and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorFF:'You moved "{0}" to finish after "{1}" finishes and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskBeforePredecessorSF:'You moved "{0}" away from "{1}" to starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorSF:'You moved "{0}" to finish after "{1}" starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',okText:"Ok",confirmDelete:"Are you sure you want to Delete Record?",from:"From",to:"To",taskLink:"Task Link",lag:"Lag",start:"Start",finish:"Finish",enterValue:"Enter the value",taskInformation:"Task Information",deleteTask:"Delete Task",deleteDependency:"Delete Dependency",convert:"Convert",save:"Save",above:"Above",below:"Below",child:"Child",milestone:"Milestone",toTask:"To Task",toMilestone:"To Milestone",eventMarkers:"Event markers",leftTaskLabel:"Left task label",rightTaskLabel:"Right task label",timelineCell:"Timeline cell",confirmPredecessorDelete:"Are you sure you want to remove dependency link?",unit:"Unit",work:"Work",taskType:"Task Type",unassignedTask:"Unassigned Task",group:"Group",indent:"Indent",outdent:"Outdent",segments:"Segments",splitTask:"Split Task",mergeTask:"Merge Task",left:"Left",right:"Right",FF:"FF",FS:"FS",SF:"SF",SS:"SS"}},n.prototype.removeSortColumn=function(e){this.sortModule.removeSortColumn(e)},n.prototype.actionBeginTask=function(t){this.trigger("actionBegin",t),(0,e.isNullOrUndefined)(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.showSpinner():this.showMaskRow()},n.prototype.scrollToDate=function(e){var t=this.dateValidationModule.getDateFromFormat(e),i=this.dataOperation.getTaskLeft(t,!1);this.ganttChartModule.updateScrollLeft(i)},n.prototype.scrollToTask=function(e){if(-1!==this.ids.indexOf(e)){var t=this.flatData[this.ids.indexOf(e)].ganttProperties.left;this.ganttChartModule.updateScrollLeft(t)}},n.prototype.updateChartScrollOffset=function(t,i){(0,e.isNullOrUndefined)(t)||(t=this.ganttChartModule.scrollElement.scrollWidth<=t?this.ganttChartModule.scrollElement.scrollWidth:t,this.ganttChartModule.scrollObject.setScrollLeft(t,this.enableRtl?-1:0)),(0,e.isNullOrUndefined)(i)||(i=this.ganttChartModule.scrollElement.scrollHeight<=i?this.ganttChartModule.scrollElement.scrollHeight:i,this.ganttChartModule.scrollObject.setScrollTop(i))},n.prototype.getParentTask=function(t){if((0,e.isNullOrUndefined)(t))return null;if(!this.autoCalculateDateScheduling&&this.dataMap&&this.dataMap.size>0&&!this.taskFields.hasChildMapping&&this.isLoad){var i=this.dataMap.get(t.uniqueID);if(i)return i}else{var r=this.flatData.find((function(e){return t.uniqueID===e.uniqueID}));if(r)return r}return null},n.prototype.getRootParent=function(e,t){return e.level===t?e:this.getRootParent(this.getParentTask(e.parentItem),t)},n.prototype.filterByColumn=function(e,t,i,r,a,n){this.treeGrid.filterByColumn(e,t,i,r,a,n)},n.prototype.excelExport=function(e,t,i,r){return this.excelExportModule?this.treeGrid.excelExport(e,t,i,r):null},n.prototype.csvExport=function(e,t,i,r){return this.excelExportModule?this.treeGrid.csvExport(e,t,i,r):null},n.prototype.pdfExport=function(e,t,i,r){return e&&e.fitToWidthSettings&&e.fitToWidthSettings.isFitToWidth&&(e.pageOrientation="Landscape"),this.pdfExportModule?this.pdfExportModule.export(e,t,i,r):null},n.prototype.clearFiltering=function(e){this.treeGrid.grid.clearFiltering(e)},n.prototype.removeFilteredColsByField=function(e){this.treeGrid.removeFilteredColsByField(e,!1)},n.prototype.renderWorkingDayCell=function(e){var t="Auto"!==this.taskMode||!(!this.includeWeekend&&this.autoCalculateDateScheduling)?[]:this.nonWorkingDayIndex,i=this.totalHolidayDates;if(t.length>0&&-1!==t.indexOf(e.date.getDay()))e.isDisabled=!0;else if(i.length>0){var r=new Date(e.date.getTime());r.setHours(0,0,0),-1!==i.indexOf(r.getTime())&&(!this.autoCalculateDateScheduling||this.isLoad&&!this.treeGrid.loadChildOnDemand&&this.taskFields.hasChildMapping?e.isDisabled=!1:e.isDisabled=!0)}},n.prototype.previousTimeSpan=function(t){if(this.undoRedoModule&&this.isUndoRedoItemPresent("PreviousTimeSpan")){this.undoRedoModule.redoEnabled&&this.undoRedoModule.disableRedo(),this.undoRedoModule.createUndoCollection();var i={action:"PreviousTimeSpan"};i.previousTimelineStartDate=(0,e.extend)([],[],[this.timelineModule.timelineStartDate],!0)[0],i.previousTimelineEndDate=(0,e.extend)([],[],[this.timelineModule.timelineEndDate],!0)[0],this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]=i}this.timelineModule.performTimeSpanAction("prevTimeSpan","publicMethod",new Date(this.timelineModule.timelineStartDate.getTime()),new Date(this.timelineModule.timelineEndDate.getTime()),t)},n.prototype.nextTimeSpan=function(t){if(this.undoRedoModule&&this.isUndoRedoItemPresent("NextTimeSpan")){this.undoRedoModule.redoEnabled&&this.undoRedoModule.disableRedo(),this.undoRedoModule.createUndoCollection();var i={action:"NextTimeSpan"};i.previousTimelineStartDate=(0,e.extend)([],[],[this.timelineModule.timelineStartDate],!0)[0],i.previousTimelineEndDate=(0,e.extend)([],[],[this.timelineModule.timelineEndDate],!0)[0],this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]=i}this.timelineModule.performTimeSpanAction("nextTimeSpan","publicMethod",new Date(this.timelineModule.timelineStartDate.getTime()),new Date(this.timelineModule.timelineEndDate.getTime()),t)},n.prototype.updateProjectDates=function(t,i,r,a){this.timelineModule.totalTimelineWidth=0,this.cloneProjectStartDate=t,this.cloneProjectEndDate=i,this.isTimelineRoundOff=r,this.timelineModule.refreshTimelineByTimeSpan(),this.dataOperation.reUpdateGanttDataPosition(),(!this.pdfExportModule||this.pdfExportModule&&!this.pdfExportModule.isPdfExport||this.pdfExportModule&&this.pdfExportModule.isPdfExport&&this.pdfExportModule.helper.exportProps&&this.pdfExportModule.helper.exportProps.fitToWidthSettings&&!this.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth)&&(this.timelineModule.updateChartByNewTimeline(),this.ganttChartModule.chartBodyContent.style.width=(0,e.formatUnit)(this.timelineModule.totalTimelineWidth),this.ganttChartModule.updateLastRowBottomWidth(),this.taskFields.dependency&&this.ganttChartModule.reRenderConnectorLines(),"beforeAdd"!==a&&this.notify("selectRowByIndex",{}))},n.prototype.splitTask=function(e,t){this.isEdit=!0,this.chartRowsModule.splitTask(e,t)},n.prototype.mergeTask=function(e,t){this.chartRowsModule.mergeTask(e,t)},n.prototype.reorderColumns=function(e,t){this.treeGrid.reorderColumns(e,t)},n.prototype.initiateEditAction=function(e){this.isOnEdit=e,this.previousRecords={},this.editedRecords=[]},n.prototype.setRecordValue=function(t,i,r,a){if(i=(0,e.isUndefined)(i)?null:i,!(!this.isOnEdit&&!this.isOnDelete)){this.makeCloneData(t,r,a);var n=a?r:r.ganttProperties,s=n.rowUniqueID,o=this.getRecordByID(s),l=!1;if(l=!(!(0,e.isNullOrUndefined)(i)&&((0,e.isNullOrUndefined)(i)||(0,e.isNullOrUndefined)(r[""+t])||(i instanceof Date?i.getTime()===r[""+t].getTime():r[""+t]===i)))||l,o&&(-1===this.editedRecords.indexOf(o)&&l||0===this.editedRecords.length)){if(this.editModule.draggedRecord&&this.editModule.draggedRecord.ganttProperties.taskId===n.taskId?this.editedRecords.splice(0,0,o):this.editedRecords.push(o),this.undoRedoModule){-1===this.undoRedoModule.changedRecords.indexOf(o)&&this.undoRedoModule.changedRecords.push((0,e.extend)({},{},o,!0));var d=this.undoRedoModule.getUndoCollection.length>0?this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1].action:null;if(this.editModule&&this.editSettings.allowEditing&&!this.undoRedoModule.isUndoRedoPerformed&&!this.isOnDelete&&!this.isOnAdded&&"outdent"!==d&&"indent"!==d&&"RowDragAndDrop"!==d&&"TaskbarDragAndDrop"!==d){var h=this.previousFlatData.filter((function(e){return e.ganttProperties.taskId===o.ganttProperties.taskId}))[0];h&&this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]&&this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1].modifiedRecords&&this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1].modifiedRecords.push(h)}}this.enableImmutableMode&&this.modifiedRecords.push(o)}}(0,e.setValue)(t,i,r)},n.prototype.makeCloneData=function(t,i,r){var a,n,s,o=(0,e.getValue)(t,i);if(r&&(t="ganttProperties."+t),(0,e.isNullOrUndefined)(this.previousRecords[i.uniqueID])){this.previousRecords[i.uniqueID]={}}a=this.previousRecords[i.uniqueID],n=(0,e.getValue)(t,a),(0,e.isUndefined)(n)&&(s=o instanceof Date?new Date(o.getTime()):(0,e.isObjectArray)(o)?(0,e.extend)([],o,[],!0):(0,e.isObject)(o)?(0,e.extend)({},{},o,!0):o,(0,e.isUndefined)(s)?(0,e.setValue)(t,null,a):(0,e.setValue)(t,s,a))},n.prototype.closeGanttActions=function(){this.editModule&&(this.editModule.cellEditModule&&this.editModule.cellEditModule.isCellEdit?(this.treeGrid.closeEdit(),this.editModule.cellEditModule.isCellEdit=!1,(0,e.isNullOrUndefined)(this.toolbarModule)||this.toolbarModule.refreshToolbarItems()):this.editModule.dialogModule&&this.editModule.dialogModule.dialogObj&&this.editModule.dialogModule.dialogObj.visible&&(this.editModule.dialogModule.dialogObj.hide(),this.editModule.dialogModule.dialogClose()))},n.prototype.getTaskByUniqueID=function(e){var t=this.flatData.filter((function(t){return t.uniqueID===e}));return t.length>0?t[0]:null},n.prototype.getRecordByID=function(t){return(0,e.isNullOrUndefined)(t)?null:this.flatData[this.ids.indexOf(t.toString())]},n.prototype.setSplitterPosition=function(e,t){var i={};i[t]=e;var r=this.splitterModule.calculateSplitterPosition(i);switch(t){case"view":this.splitterSettings.view=i[t];break;case"columnIndex":this.splitterSettings.columnIndex=i[t];break;case"position":this.splitterSettings.position=i[t]}var a=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[0],n=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[1];this.splitterModule.splitterPreviousPositionGrid=a.scrollWidth+1+"px",this.splitterModule.splitterPreviousPositionChart=n.scrollWidth+1+"px",this.splitterModule.splitterObject.paneSettings[0].size=r,this.splitterModule.splitterObject.paneSettings[1].size=parseFloat("99.75%")-parseFloat(r)+"%",this.splitterModule.triggerCustomResizedEvent()},n.prototype.expandByIndex=function(e){if("number"==typeof e){var t=this.contructExpandCollapseArgs(null,e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.expandGanttRow(t)}else for(var i=0;i<e.length;i++)if("number"==typeof e[i]){var r=e[i];t=this.contructExpandCollapseArgs(null,r);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.expandGanttRow(t)}},n.prototype.expandByID=function(e){var t=this.contructExpandCollapseArgs(e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.expandGanttRow(t)},n.prototype.collapseByIndex=function(e){var t=this.contructExpandCollapseArgs(null,e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.collapseGanttRow(t)},n.prototype.collapseByID=function(e){var t=this.contructExpandCollapseArgs(e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.collapseGanttRow(t)},n.prototype.addRecord=function(t,i,r){if(this.editModule&&this.editSettings.allowAdding)if("ResourceView"===this.viewType){this.editModule.addRowPosition=i,this.editModule.addRowIndex=r;var a=void 0;(0,e.isNullOrUndefined)(t)||(a=this.undoRedoModule&&this.undoRedoModule.isUndoRedoPerformed?t.ganttProperties.resourceInfo:t[this.taskFields.resourceInfo]);var n=void 0,s=void 0;if(!(0,e.isNullOrUndefined)(a)&&a.length){for(var o=0;o<a.length&&(n="object"==typeof a[o]?a[o][this.resourceFields.id]:a[0],!(s=this.flatData[this.getTaskIds().indexOf("R"+n)]));o++);if(s&&s.childRecords.length||0===s.level){var l=s.childRecords[r];if("ResourceView"===this.viewType&&this.undoRedoModule&&this.undoRedoModule.isUndoRedoPerformed)this.editModule.addRecord(t,i,r);else if(l){var d="Above"===i||"Below"===i?i:"Child";"Child"===d?this.editModule.addRecord(t,d,this.getTaskIds().indexOf("R"+n)):this.editModule.addRecord(t,d,this.flatData.indexOf(l))}else this.editModule.addRecord(t,"Child",this.getTaskIds().indexOf("R"+n))}else this.editModule.addRecord(t,"Bottom")}else this.undoRedoModule&&this.undoRedoModule.isUndoRedoPerformed?this.editModule.addRecord(t,i,r):this.editModule.addRecord(t,"Bottom");this.editModule.addRowPosition=null,this.editModule.addRowIndex=null}else this.editModule.addRecord(t,i,r),"Bottom"===i&&(this.selectedRowIndex=r),"Above"!==i&&"Below"!==i&&"Child"!==i||(this.currentSelection=(0,e.isNullOrUndefined)(t)?this.currentSelection:t)},n.prototype.updateRecordByID=function(e){this.editModule&&this.editSettings.allowEditing&&this.editModule.updateRecordByID(e)},n.prototype.updateTaskId=function(e,t){this.editModule&&this.editSettings.allowEditing&&this.editModule.updateTaskId(e,t)},n.prototype.expandAtLevel=function(e){this.enableVirtualization&&(this.isExpandCollapseLevelMethod=!0),this.ganttChartModule.expandAtLevel(e)},n.prototype.indent=function(){this.editModule&&this.editSettings.allowEditing&&this.editModule.indent()},n.prototype.outdent=function(){this.editModule&&this.editSettings.allowEditing&&this.editModule.outdent()},n.prototype.getUndoActions=function(){return this.undoRedoModule?this.undoRedoModule.getUndoCollection:[]},n.prototype.getRedoActions=function(){return this.undoRedoModule?this.undoRedoModule.getRedoCollection:[]},n.prototype.clearUndoCollection=function(){this.undoRedoModule&&(this.undoRedoModule.getUndoCollection=[],this.toolbarModule&&this.toolbarModule.enableItems([this.controlId+"_undo"],!1))},n.prototype.clearRedoCollection=function(){this.undoRedoModule&&(this.undoRedoModule.getRedoCollection=[],this.toolbarModule&&this.toolbarModule.enableItems([this.controlId+"_redo"],!1))},n.prototype.undo=function(){this.undoRedoModule&&this.undoRedoModule.undoAction()},n.prototype.redo=function(){this.undoRedoModule&&this.undoRedoModule.redoAction()},n.prototype.showCriticalPath=function(e){if(this.criticalPathModule){this.criticalPathModule.showCriticalPath(e);var t=this.criticalPathModule;this.criticalPathModule.criticalConnectorLine(t.criticalPathCollection,t.detailPredecessorCollection,!0,t.predecessorCollectionTaskIds)}},n.prototype.getCriticalTasks=function(){return!(0,e.isNullOrUndefined)(this.criticalPathModule)&&this.enableCriticalPath?this.criticalPathModule.getCriticalTasks():null},n.prototype.zoomIn=function(){this.timelineModule.processZooming(!0)},n.prototype.zoomOut=function(){this.timelineModule.processZooming(!1)},n.prototype.fitToProject=function(){this.timelineModule.processZoomToFit(),this.ganttChartModule.updateScrollLeft(0)},n.prototype.reorderRows=function(e,t,i){this.rowDragAndDropModule.reorderRows(e,t,i)},n.prototype.updateRecordByIndex=function(t,i){if(this.editModule&&this.editSettings.allowEditing){var r=this.taskFields,a=this.updatedRecords.length>0?(0,e.isNullOrUndefined)(this.updatedRecords[t])?null:this.updatedRecords[t]:null;(0,e.isNullOrUndefined)(a)||(i[r.id]=a[r.id],this.editModule.updateRecordByID(i))}},n.prototype.addPredecessor=function(t,i){var r=this.getRecordByID(t.toString());this.editModule&&!(0,e.isNullOrUndefined)(r)&&this.editSettings.allowTaskbarEditing&&this.connectorLineEditModule.addPredecessor(r,i)},n.prototype.removePredecessor=function(t){var i=this.getRecordByID(t.toString());this.editModule&&!(0,e.isNullOrUndefined)(i)&&this.editSettings.allowTaskbarEditing&&this.connectorLineEditModule.removePredecessor(i)},n.prototype.updatePredecessor=function(t,i){var r=this.getRecordByID(t.toString());this.editModule&&!(0,e.isNullOrUndefined)(r)&&this.editSettings.allowTaskbarEditing&&this.connectorLineEditModule.updatePredecessor(r,i)},n.prototype.openAddDialog=function(){this.editModule&&this.editModule.dialogModule&&this.editSettings.allowAdding&&this.editModule.dialogModule.openAddDialog()},n.prototype.openEditDialog=function(e){this.editModule&&this.editModule.dialogModule&&this.editSettings.allowEditing&&this.editModule.dialogModule.openEditDialog(e)},n.prototype.contructExpandCollapseArgs=function(t,i){var r,a,n;return(0,e.isNullOrUndefined)(i)?(a=this.getRecordByID(t.toString()),r=this.getRowByID(t),(0,e.isNullOrUndefined)(r)||(n=(0,e.getValue)("rowIndex",r))):(0,e.isNullOrUndefined)(i)||(r=this.getRowByIndex(i),n=(0,e.getValue)("rowIndex",r),a=this.currentViewData[n]),{data:a,gridRow:this.treeGrid.getRows()[n],chartRow:r,cancel:!1}},n.prototype.getRowByIndex=function(t){try{var i=this.element.querySelectorAll(".e-chart-row");return(0,e.isNullOrUndefined)(t)?null:i[t]}catch(e){return null}},n.prototype.getRowByID=function(e){var t,i=this,r=this.getRecordByID(e.toString());return-1!==(t=!this.loadChildOnDemand&&this.taskFields.hasChildMapping?this.updatedRecords.map((function(e){return e[i.taskFields.id]})).indexOf(r.ganttProperties.taskId):this.updatedRecords.indexOf(r))?this.getRowByIndex(t):null},n.prototype.getUnscheduledTaskClass=function(t){return(0,e.isNullOrUndefined)(t.startDate)&&(0,e.isNullOrUndefined)(t.endDate)&&(0,e.isNullOrUndefined)(t.duration)||(0,e.isNullOrUndefined)(t.startDate)||(0,e.isNullOrUndefined)(t.endDate)||(0,e.isNullOrUndefined)(t.duration)?" "+pe:""},n.prototype.isUnscheduledTask=function(t){return!!((0,e.isNullOrUndefined)(t.startDate)||(0,e.isNullOrUndefined)(t.endDate)||(0,e.isNullOrUndefined)(t.duration))},n.prototype.createGanttPopUpElement=function(){var t=this.createElement("div",{className:"e-ganttpopup",styles:"display:none;"}),i=this.createElement("div",{className:"e-content",attrs:{tabIndex:"-1"}});(0,e.append)([i,this.createElement("div",{className:"e-uptail e-tail"})],t),i.appendChild(this.createElement("span")),(0,e.append)([i,this.createElement("div",{className:"e-downtail e-tail"})],t),document.getElementById(this.element.id+"GanttChart").appendChild(t)},n.prototype.getPredecessorTextValue=function(e){var t;switch(e){case"SS":t=this.localeObj.getConstant("start")+"-"+this.localeObj.getConstant("start");break;case"FF":t=this.localeObj.getConstant("finish")+"-"+this.localeObj.getConstant("finish");break;case"SF":t=this.localeObj.getConstant("start")+"-"+this.localeObj.getConstant("finish");break;case"FS":t=this.localeObj.getConstant("finish")+"-"+this.localeObj.getConstant("start")}return t},n.prototype.search=function(e){this.filterModule&&(this.searchSettings.key=e,this.dataBind())},n.prototype.getOffsetRect=function(e){var t=e.getBoundingClientRect(),i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,r=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,a=document.documentElement.clientTop||document.body.clientTop||0,n=document.documentElement.clientLeft||document.body.clientLeft||0,s=t.top+i-a,o=this.enableRtl?t.right+r-n:t.left+r-n;return{top:Math.round(s),left:Math.round(o),width:t.width,height:t.height}},n.prototype.expandAll=function(){this.ganttChartModule.expandCollapseAll("expand")},n.prototype.updateDataSource=function(t,i){if(this.isDynamicData=!0,!(0,e.isNullOrUndefined)(i))for(var r=0,a=Object.keys(i);r<a.length;r++){var n=a[r];switch(n){case"projectStartDate":this.setProperties({projectStartDate:i[n]},!0);break;case"projectEndDate":this.setProperties({projectEndDate:i[n]},!0)}}this.dataSource=t},n.prototype.collapseAll=function(){this.ganttChartModule.expandCollapseAll("collapse")},n.prototype.getGridColumns=function(){return this.treeGrid.getColumns()},n.prototype.getColumnByField=function(e,t){var i=t.filter((function(t){return t.field===e}));return i.length>0?i[0]:null},n.prototype.getGanttColumns=function(){return this.ganttColumns},n.prototype.showColumn=function(e,t){this.treeGrid.showColumns(e,t),this.updateTreeColumns()},n.prototype.hideColumn=function(e,t){this.treeGrid.hideColumns(e,t),this.updateTreeColumns()},n.prototype.setScrollTop=function(e){this.ganttChartModule.scrollObject.setScrollTop(e)},n.prototype.cancelEdit=function(){this.isCancelled=!0,this.closeGanttActions()},n.prototype.selectCell=function(e,t){this.selectionModule&&this.selectionModule.selectCell(e,t)},n.prototype.selectCells=function(e){this.selectionModule&&this.selectionModule.selectCells(e)},n.prototype.selectRow=function(e,t){this.selectionModule&&this.selectionModule.selectRow(e,t)},n.prototype.selectRows=function(e){this.selectionModule&&this.selectionModule.selectRows(e)},n.prototype.deleteRecord=function(e){this.editModule&&this.editModule.deleteRecord(e)},n.prototype.enableItems=function(e,t){this.toolbarModule&&this.toolbarModule.enableItems(e,t)},n.prototype.clearSelection=function(){this.selectionModule&&this.selectionModule.clearSelection()},n.prototype.updateDataArgs=function(t){if(!Array.isArray(t.data)){var i=[];i.push(t.data),(0,e.setValue)("data",i,t)}return t},n.prototype.convertToMilestone=function(t){var i=this.getRecordByID(t);if(!(0,e.isNullOrUndefined)(i)){var r=(0,e.extend)({},{},i.taskData,!0),a=this.taskFields;if(r[a.startDate]&&this.setRecordValue(a.startDate,i.ganttProperties.startDate,r,!0),(0,e.isNullOrUndefined)(a.duration)?(r[a.startDate]=new Date(i.ganttProperties.startDate),r[a.endDate]=new Date(i.ganttProperties.endDate)):r[a.duration]=0,(0,e.isNullOrUndefined)(a.milestone)||!1===r[a.milestone]&&(r[a.milestone]=!0),(0,e.isNullOrUndefined)(a.progress)||(r[a.progress]=0),!(0,e.isNullOrUndefined)(a.child)&&r[a.child]&&(r[a.child]=[]),!(0,e.isNullOrUndefined)(a.parentID)&&r[a.parentID]&&(r[a.parentID]=null),(0,e.isNullOrUndefined)(a.segments)||(r[a.segments]=null),!(0,e.isNullOrUndefined)(this.contextMenuModule)&&this.contextMenuModule.isOpen&&"Milestone"===this.contextMenuModule.item){(0,e.isNullOrUndefined)(a.dependency)||(r[a.dependency]=null);var n=this.editSettings.newRowPosition;this.addRecord(r,n,this.selectedRowIndex)}else i.hasChildRecords||i.ganttProperties.isMilestone||this.updateRecordByID(r)}},n.prototype.changeTaskMode=function(t){if(this.undoRedoModule&&!this.undoRedoModule.isUndoRedoPerformed){this.undoRedoModule.redoEnabled&&this.undoRedoModule.disableRedo(),this.undoRedoModule.createUndoCollection();var i={action:"TaskMode"};i.modifiedRecords=(0,e.extend)([],[t],[],!0),this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]=i}var r=this.taskFields,a=this.getRecordByID(t[r.id]),n=a.ganttProperties;this.isOnEdit=!0,this.setRecordValue("isAutoSchedule",!n.isAutoSchedule,n,!0),(0,e.isNullOrUndefined)(this.taskFields.manual)||(this.setRecordValue("taskData."+r.manual,!n.isAutoSchedule,a),this.setRecordValue(r.manual,!n.isAutoSchedule,a)),this.editModule.updateTaskScheduleModes(a);var s={data:a};this.editModule.initiateUpdateAction(s)},n.prototype.getTaskIds=function(){return this.taskIds},n.prototype.setTaskIds=function(e){if("ProjectView"!==this.viewType){var t=e.ganttProperties.taskId;t=0===e.level?"R"+t:"T"+t,this.taskIds.push(t)}},n.prototype.renderTemplates=function(){this.isReact&&this.renderReactTemplates()},n.prototype.resetTemplates=function(){this.isReact&&this.clearTemplate()},oi([(0,e.Property)(!0)],n.prototype,"allowKeyboard",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableImmutableMode",void 0),oi([(0,e.Property)(!0)],n.prototype,"allowParentDependency",void 0),oi([(0,e.Property)(!0)],n.prototype,"enableHtmlSanitizer",void 0),oi([(0,e.Property)(!0)],n.prototype,"disableHtmlEncode",void 0),oi([(0,e.Complex)({},Zt)],n.prototype,"loadingIndicator",void 0),oi([(0,e.Property)(!0)],n.prototype,"enableVirtualMaskRow",void 0),oi([(0,e.Property)(!1)],n.prototype,"loadChildOnDemand",void 0),oi([(0,e.Property)(!0)],n.prototype,"updateOffsetOnTaskbarEdit",void 0),oi([(0,e.Property)(!0)],n.prototype,"UpdateOffsetOnTaskbarEdit",void 0),oi([(0,e.Property)(!0)],n.prototype,"autoCalculateDateScheduling",void 0),oi([(0,e.Property)(!0)],n.prototype,"autoFocusTasks",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableAdaptiveUI",void 0),oi([(0,e.Property)(!0)],n.prototype,"allowSelection",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowSorting",void 0),oi([(0,e.Property)(!0)],n.prototype,"enablePredecessorValidation",void 0),oi([(0,e.Property)(!1)],n.prototype,"showColumnMenu",void 0),oi([(0,e.Property)()],n.prototype,"columnMenuItems",void 0),oi([(0,e.Property)(["Sorting","Add","ColumnReorder","ColumnResize","ColumnState","Delete","Edit","Filtering","Indent","Outdent","NextTimeSpan","PreviousTimeSpan","RowDragAndDrop","Search"])],n.prototype,"undoRedoActions",void 0),oi([(0,e.Property)()],n.prototype,"timezone",void 0),oi([(0,e.Property)(!1)],n.prototype,"collapseAllParentTasks",void 0),oi([(0,e.Property)(!1)],n.prototype,"highlightWeekends",void 0),oi([(0,e.Property)(0)],n.prototype,"treeColumnIndex",void 0),oi([(0,e.Property)([])],n.prototype,"dataSource",void 0),oi([(0,e.Property)("day")],n.prototype,"durationUnit",void 0),oi([(0,e.Property)(null)],n.prototype,"query",void 0),oi([(0,e.Property)(null)],n.prototype,"dateFormat",void 0),oi([(0,e.Property)("auto")],n.prototype,"height",void 0),oi([(0,e.Property)(!1)],n.prototype,"renderBaseline",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowTaskbarDragAndDrop",void 0),oi([(0,e.Property)(!0)],n.prototype,"allowTaskbarOverlap",void 0),oi([(0,e.Property)("Horizontal")],n.prototype,"gridLines",void 0),oi([(0,e.Complex)({},wt)],n.prototype,"labelSettings",void 0),oi([(0,e.Property)(null)],n.prototype,"taskbarTemplate",void 0),oi([(0,e.Property)(null)],n.prototype,"parentTaskbarTemplate",void 0),oi([(0,e.Property)(null)],n.prototype,"timelineTemplate",void 0),oi([(0,e.Property)(null)],n.prototype,"milestoneTemplate",void 0),oi([(0,e.Property)()],n.prototype,"baselineColor",void 0),oi([(0,e.Property)("auto")],n.prototype,"width",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableVirtualization",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableTimelineVirtualization",void 0),oi([(0,e.Property)()],n.prototype,"toolbar",void 0),oi([(0,e.Property)(["Monday","Tuesday","Wednesday","Thursday","Friday"])],n.prototype,"workWeek",void 0),oi([(0,e.Property)(!1)],n.prototype,"includeWeekend",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowUnscheduledTasks",void 0),oi([(0,e.Property)(!1)],n.prototype,"showInlineNotes",void 0),oi([(0,e.Property)(36)],n.prototype,"rowHeight",void 0),oi([(0,e.Property)(null)],n.prototype,"taskbarHeight",void 0),oi([(0,e.Property)(null)],n.prototype,"projectStartDate",void 0),oi([(0,e.Property)(null)],n.prototype,"projectEndDate",void 0),oi([(0,e.Property)(null)],n.prototype,"resourceIDMapping",void 0),oi([(0,e.Property)(null)],n.prototype,"resourceNameMapping",void 0),oi([(0,e.Property)([])],n.prototype,"resources",void 0),oi([(0,e.Property)([])],n.prototype,"segmentData",void 0),oi([(0,e.Property)(null)],n.prototype,"connectorLineBackground",void 0),oi([(0,e.Property)(1)],n.prototype,"connectorLineWidth",void 0),oi([(0,e.Property)([])],n.prototype,"columns",void 0),oi([(0,e.Property)([])],n.prototype,"addDialogFields",void 0),oi([(0,e.Property)([])],n.prototype,"editDialogFields",void 0),oi([(0,e.Property)(-1)],n.prototype,"selectedRowIndex",void 0),oi([(0,e.Property)("hour")],n.prototype,"workUnit",void 0),oi([(0,e.Property)("FixedUnit")],n.prototype,"taskType",void 0),oi([(0,e.Property)("ProjectView")],n.prototype,"viewType",void 0),oi([(0,e.Collection)([{from:8,to:12},{from:13,to:17}],Ke)],n.prototype,"dayWorkingTime",void 0),oi([(0,e.Collection)([],Qt)],n.prototype,"weekWorkingTime",void 0),oi([(0,e.Collection)([],Dt)],n.prototype,"holidays",void 0),oi([(0,e.Collection)([],dt)],n.prototype,"eventMarkers",void 0),oi([(0,e.Complex)({},Ot)],n.prototype,"taskFields",void 0),oi([(0,e.Complex)({},zt)],n.prototype,"resourceFields",void 0),oi([(0,e.Complex)({},Ut)],n.prototype,"timelineSettings",void 0),oi([(0,e.Property)([])],n.prototype,"zoomingLevels",void 0),oi([(0,e.Complex)({},Ht)],n.prototype,"sortSettings",void 0),oi([(0,e.Complex)({},st)],n.prototype,"editSettings",void 0),oi([(0,e.Complex)({},Vt)],n.prototype,"tooltipSettings",void 0),oi([(0,e.Complex)({},Pt)],n.prototype,"selectionSettings",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowFiltering",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowExcelExport",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowRowDragAndDrop",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowReordering",void 0),oi([(0,e.Property)(!1)],n.prototype,"readOnly",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowResizing",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableContextMenu",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableCriticalPath",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableUndoRedo",void 0),oi([(0,e.Property)(10)],n.prototype,"undoRedoStepsCount",void 0),oi([(0,e.Property)()],n.prototype,"contextMenuItems",void 0),oi([(0,e.Property)(!1)],n.prototype,"allowPdfExport",void 0),oi([(0,e.Property)(!1)],n.prototype,"validateManualTasksOnLinking",void 0),oi([(0,e.Property)(!1)],n.prototype,"enableMultiTaskbar",void 0),oi([(0,e.Property)(!1)],n.prototype,"showOverAllocation",void 0),oi([(0,e.Property)("Auto")],n.prototype,"taskMode",void 0),oi([(0,e.Complex)({},ut)],n.prototype,"filterSettings",void 0),oi([(0,e.Complex)({},ft)],n.prototype,"searchSettings",void 0),oi([(0,e.Complex)({},Rt)],n.prototype,"splitterSettings",void 0),oi([(0,e.Event)()],n.prototype,"queryTaskbarInfo",void 0),oi([(0,e.Event)()],n.prototype,"beforeExcelExport",void 0),oi([(0,e.Event)()],n.prototype,"excelExportComplete",void 0),oi([(0,e.Event)()],n.prototype,"excelQueryCellInfo",void 0),oi([(0,e.Event)()],n.prototype,"excelHeaderQueryCellInfo",void 0),oi([(0,e.Event)()],n.prototype,"rowDrag",void 0),oi([(0,e.Event)()],n.prototype,"rowDragStart",void 0),oi([(0,e.Event)()],n.prototype,"rowDragStartHelper",void 0),oi([(0,e.Event)()],n.prototype,"rowDrop",void 0),oi([(0,e.Event)()],n.prototype,"collapsing",void 0),oi([(0,e.Event)()],n.prototype,"collapsed",void 0),oi([(0,e.Event)()],n.prototype,"expanding",void 0),oi([(0,e.Event)()],n.prototype,"expanded",void 0),oi([(0,e.Event)()],n.prototype,"actionBegin",void 0),oi([(0,e.Event)()],n.prototype,"actionComplete",void 0),oi([(0,e.Event)()],n.prototype,"actionFailure",void 0),oi([(0,e.Event)()],n.prototype,"dataStateChange",void 0),oi([(0,e.Event)()],n.prototype,"taskbarEdited",void 0),oi([(0,e.Event)()],n.prototype,"endEdit",void 0),oi([(0,e.Event)()],n.prototype,"cellEdit",void 0),oi([(0,e.Event)()],n.prototype,"load",void 0),oi([(0,e.Event)()],n.prototype,"created",void 0),oi([(0,e.Event)()],n.prototype,"destroyed",void 0),oi([(0,e.Event)()],n.prototype,"taskbarEditing",void 0),oi([(0,e.Event)()],n.prototype,"dataBound",void 0),oi([(0,e.Event)()],n.prototype,"resizeStart",void 0),oi([(0,e.Event)()],n.prototype,"resizing",void 0),oi([(0,e.Event)()],n.prototype,"resizeStop",void 0),oi([(0,e.Event)()],n.prototype,"splitterResizeStart",void 0),oi([(0,e.Event)()],n.prototype,"splitterResizing",void 0),oi([(0,e.Event)()],n.prototype,"splitterResized",void 0),oi([(0,e.Event)()],n.prototype,"columnDragStart",void 0),oi([(0,e.Event)()],n.prototype,"columnDrag",void 0),oi([(0,e.Event)()],n.prototype,"columnDrop",void 0),oi([(0,e.Event)()],n.prototype,"beforeTooltipRender",void 0),oi([(0,e.Event)()],n.prototype,"rowSelecting",void 0),oi([(0,e.Event)()],n.prototype,"rowSelected",void 0),oi([(0,e.Event)()],n.prototype,"rowDeselecting",void 0),oi([(0,e.Event)()],n.prototype,"rowDeselected",void 0),oi([(0,e.Event)()],n.prototype,"cellSelecting",void 0),oi([(0,e.Event)()],n.prototype,"cellSelected",void 0),oi([(0,e.Event)()],n.prototype,"cellDeselecting",void 0),oi([(0,e.Event)()],n.prototype,"cellDeselected",void 0),oi([(0,e.Event)()],n.prototype,"queryCellInfo",void 0),oi([(0,e.Event)()],n.prototype,"headerCellInfo",void 0),oi([(0,e.Event)()],n.prototype,"rowDataBound",void 0),oi([(0,e.Event)()],n.prototype,"columnMenuOpen",void 0),oi([(0,e.Event)()],n.prototype,"toolbarClick",void 0),oi([(0,e.Event)()],n.prototype,"columnMenuClick",void 0),oi([(0,e.Event)()],n.prototype,"contextMenuOpen",void 0),oi([(0,e.Event)()],n.prototype,"contextMenuClick",void 0),oi([(0,e.Event)()],n.prototype,"onTaskbarClick",void 0),oi([(0,e.Event)()],n.prototype,"recordDoubleClick",void 0),oi([(0,e.Event)()],n.prototype,"onMouseMove",void 0),oi([(0,e.Event)()],n.prototype,"beforePdfExport",void 0),oi([(0,e.Event)()],n.prototype,"pdfExportComplete",void 0),oi([(0,e.Event)()],n.prototype,"pdfQueryCellInfo",void 0),oi([(0,e.Event)()],n.prototype,"pdfQueryTaskbarInfo",void 0),oi([(0,e.Event)()],n.prototype,"pdfQueryTimelineCellInfo",void 0),oi([(0,e.Event)()],n.prototype,"pdfColumnHeaderQueryCellInfo",void 0),n=oi([e.NotifyPropertyChanges],n)}(e.Component);!function(e){e[e.NextPage=0]="NextPage",e[e.LastPage=1]="LastPage"}(k||(k={}));var di="load",hi="rowDataBound",pi="queryCellInfo",ui="toolbarClick",ci="key-pressed",gi=function(){function t(e){this.isCellEdit=!1,this.isResourceCellEdited=!1,this.parent=e,this.bindTreeGridProperties()}return t.prototype.bindTreeGridProperties=function(){this.parent.treeGrid.editSettings.allowEditing=this.parent.editSettings.allowEditing,this.parent.treeGrid.editSettings.allowNextRowEdit=this.parent.editSettings.allowNextRowEdit,this.parent.treeGrid.editSettings.mode="Cell",this.parent.treeGrid.cellEdit=this.ensureEditCell.bind(this),this.parent.editSettings.allowEditing&&_e.TreeGrid.Inject(_e.Edit)},t.prototype.ensureEditCell=function(t){var i=this,a=t.rowData,n=t.columnName;this.editedColumn=this.parent.getColumnByField(n,this.parent.ganttColumns);var s=this.parent.taskFields;if(this.parent.readOnly)t.cancel=!0;else if("Dialog"!==this.parent.editSettings.mode){if(!a.hasChildRecords||this.parent.allowParentDependency||(n!==s.endDate||((0,e.isNullOrUndefined)(a.isManual)||!1!==a.isManual)&&"Auto"!==this.parent.taskMode)&&n!==s.duration&&n!==s.dependency&&n!==s.progress&&n!==s.work&&n!==s.type&&"taskType"!==n){var o=new r.Deferred,l=this.parent;return this.parent.trigger("cellEdit",t,(function(t){t.columnName===l.taskFields.progress&&t.rowData.hasChildRecords&&(t.cancel=!0),0===a.level&&"ResourceView"===i.parent.viewType&&(t.cancel=!0),o.resolve(t),t.cancel||(t.columnName===i.parent.taskFields.notes?i.openNotesEditor(t):(i.isCellEdit=!0,(0,e.isNullOrUndefined)(i.parent.toolbarModule)||i.parent.toolbarModule.refreshToolbarItems()))})),o}(n===s.dependency&&!this.parent.allowParentDependency||n!==s.dependency)&&(t.cancel=!0)}else t.cancel=!0},t.prototype.openNotesEditor=function(e){var t=this.parent.taskFields,i=e.rowData,r=e.columnName;if(r===t.notes&&!this.parent.showInlineNotes){e.cancel=!0;var a=this.parent.editModule.dialogModule.updatedEditFields.map((function(e){return e.type})).indexOf("Notes");if(-1!==a)this.parent.editModule.dialogModule.openEditDialog(i.ganttProperties.rowUniqueID),document.getElementById(this.parent.element.id+"_Tab").ej2_instances[0].selectedItem=a}r===t.notes&&!0===this.parent.showInlineNotes&&(this.isCellEdit=!0)},t.prototype.initiateCellEdit=function(t,i){var r=!0;if("actionComplete"===t.name&&t.previousData===t.data[t.column.field]&&(r=!1),this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Edit")&&r){this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection();var a={action:"CellEditing"};a.editedColumn=t.column.field,a.modifiedRecords=[],this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a}var n=(0,e.getValue)("column",t),s=(0,e.getValue)("data",t),o={action:"CellEditing"};o.data=this.parent.getTaskByUniqueID(s.uniqueID);var l=(0,e.getValue)("previousData",t),d=this.parent.allowUnscheduledTasks||!(0,e.isNullOrUndefined)(s[n.field])&&""!==s[n.field]||this.parent.taskFields.duration!==n.field&&this.parent.taskFields.startDate!==n.field&&this.parent.taskFields.endDate!==n.field?s[n.field]:l;if((0,e.isNullOrUndefined)(s))this.parent.editModule.endEditAction(t);else{if(s[n.field]=l,o.data[n.field]=l,this.parent.initiateEditAction(!0),this.parent.weekWorkingTime.length>0&&d&&(n.field===this.parent.taskFields.startDate||n.field===this.parent.taskFields.baselineStartDate)){var h=n.field===this.parent.taskFields.startDate?s.ganttProperties.startDate:s.ganttProperties.baselineStartDate;if(this.parent.getStartTime(h)/3600===h.getHours()){var p=this.parent.getStartTime(d);this.parent.dataOperation.setTime(p,d),this.parent.setRecordValue(n.field,d,o.data)}else this.parent.setRecordValue(n.field,d,o.data)}else this.parent.setRecordValue(n.field,d,o.data);n.field===this.parent.taskFields.name?this.taskNameEdited(o):n.field===this.parent.taskFields.startDate?this.startDateEdited(o):n.field===this.parent.taskFields.endDate?this.endDateEdited(o):n.field===this.parent.taskFields.duration?this.durationEdited(o):n.field===this.parent.taskFields.resourceInfo?this.resourceEdited(o,i,s):n.field===this.parent.taskFields.progress?this.progressEdited(o):n.field===this.parent.taskFields.baselineStartDate||n.field===this.parent.taskFields.baselineEndDate?this.baselineEdited(o):n.field===this.parent.taskFields.dependency?this.dependencyEdited(o,l):n.field===this.parent.taskFields.notes?this.notedEdited(o):n.field===this.parent.taskFields.work?this.workEdited(o):n.field!==this.parent.taskFields.type&&"taskType"!==n.field||(0,e.isNullOrUndefined)(this.parent.taskFields.work)?n.field===this.parent.taskFields.manual?this.taskmodeEdited(o):(this.parent.setRecordValue("taskData."+n.field,o.data[n.field],o.data),this.parent.editModule.initiateSaveAction(o)):this.typeEdited(o,i)}this.isCellEdit=!1,(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule.editedColumn)||(this.parent.editModule.cellEditModule.editedColumn=null),(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},t.prototype.taskNameEdited=function(e){this.parent.setRecordValue("taskData."+this.parent.taskFields.name,e.data[this.parent.taskFields.name],e.data),this.parent.setRecordValue("taskName",e.data[this.parent.taskFields.name],e.data.ganttProperties,!0),this.updateEditedRecord(e)},t.prototype.notedEdited=function(e){this.parent.setRecordValue("taskData."+this.parent.taskFields.notes,e.data[this.parent.taskFields.notes],e.data),this.parent.setRecordValue("notes",e.data[this.parent.taskFields.notes],e.data.ganttProperties,!0),this.updateEditedRecord(e)},t.prototype.taskmodeEdited=function(e){this.parent.setRecordValue("isAutoSchedule",!e.data[this.parent.taskFields.manual],e.data.ganttProperties,!0),this.parent.editModule.updateTaskScheduleModes(e.data),this.updateEditedRecord(e)},t.prototype.startDateEdited=function(t){var i=t.data,r=t.data.ganttProperties,a=t.data[this.parent.taskFields.startDate];a=a?new Date(a.getTime()):null,a=this.parent.dateValidationModule.checkStartDate(a,i.ganttProperties,i.ganttProperties.isMilestone),(0,e.isNullOrUndefined)(a)?i.hasChildRecords||(this.parent.setRecordValue("startDate",null,r,!0),null===r.startDate&&null===r.endDate&&null!==r.duration||this.parent.setRecordValue("duration",null,r,!0),this.parent.setRecordValue("isMilestone",!1,r,!0)):r.endDate||!(0,e.isNullOrUndefined)(r.duration)?(this.parent.setRecordValue("startDate",new Date(a.getTime()),r,!0),this.parent.dateValidationModule.calculateEndDate(i)):(0,e.isNullOrUndefined)(r.endDate)&&(0,e.isNullOrUndefined)(r.duration)&&this.parent.setRecordValue("startDate",new Date(a.getTime()),r,!0),this.parent.setRecordValue("isMilestone",0===r.duration,r,!0),this.parent.dataOperation.updateWidthLeft(t.data),this.parent.dataOperation.updateMappingData(i,"startDate"),this.parent.dataOperation.updateMappingData(i,"endDate"),this.parent.dataOperation.updateMappingData(i,"duration"),this.updateEditedRecord(t)},t.prototype.validateEndDateWithSegments=function(t){for(var i=[],r=t.segments,a=0;a<r.length;a++){var n=r[parseInt(a.toString(),10)],s=n.endDate;s=!(0,e.isNullOrUndefined)(t.endDate)&&s.getTime()<t.endDate.getTime()&&a!==r.length-1?s:t.endDate,n.duration=this.parent.dataOperation.getDuration(n.startDate,s,t.durationUnit,t.isAutoSchedule,t.isMilestone),r.length>0&&s.getTime()<n.startDate.getTime()&&s.getTime()<=t.endDate.getTime()?r[a-1].duration=this.parent.dataOperation.getDuration(r[a-1].startDate,t.endDate,t.durationUnit,t.isAutoSchedule,t.isMilestone):i.push(n)}return i},t.prototype.endDateEdited=function(t){var i=t.data.ganttProperties,r=t.data[this.parent.taskFields.endDate];if(r=r?new Date(r.getTime()):null,(0,e.isNullOrUndefined)(r))this.parent.setRecordValue("endDate",r,i,!0),null===i.startDate&&null===i.endDate&&null!==i.duration||this.parent.setRecordValue("duration",null,i,!0),this.parent.setRecordValue("isMilestone",!1,i,!0);else{var a=this.parent.getCurrentDayEndTime(r);0===r.getHours()&&86400!==a&&this.parent.dateValidationModule.setTime(a,r),r=this.parent.dateValidationModule.checkEndDate(r,i,i.isMilestone),this.parent.setRecordValue("endDate",r,i,!0),!(0,e.isNullOrUndefined)(i.startDate)&&(0,e.isNullOrUndefined)(i.duration)?-1===this.parent.dateValidationModule.compareDates(i.endDate,i.startDate)&&(this.parent.setRecordValue("endDate",new Date(i.startDate.getTime()),i,!0),a=this.parent.getCurrentDayEndTime(i.endDate),this.parent.dateValidationModule.setTime(a,i.endDate)):!(0,e.isNullOrUndefined)(i.duration)&&(0,e.isNullOrUndefined)(i.startDate)&&this.parent.setRecordValue("startDate",this.parent.dateValidationModule.getStartDate(i.endDate,i.duration,i.durationUnit,i),i,!0),(0,e.isNullOrUndefined)(i.segments)||(i.segments=this.validateEndDateWithSegments(i)),-1===this.compareDatesFromRecord(i)?this.parent.dateValidationModule.calculateDuration(t.data):this.parent.editModule.revertCellEdit(t),this.updateDates(t),this.parent.setRecordValue("isMilestone",0===i.duration,i,!0),i.isMilestone&&this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(i.startDate,i),i,!0)}!(0,e.isNullOrUndefined)(t.data.ganttProperties.segments)&&t.data.ganttProperties.segments.length>0&&(this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(t.data,!1),t.data.ganttProperties,!0),this.parent.dataOperation.updateMappingData(t.data,"segments")),this.parent.dataOperation.updateWidthLeft(t.data),this.parent.dataOperation.updateMappingData(t.data,"startDate"),this.parent.dataOperation.updateMappingData(t.data,"endDate"),this.parent.dataOperation.updateMappingData(t.data,"duration"),this.parent.editModule.updateResourceRelatedFields(t.data,"endDate"),this.updateEditedRecord(t)},t.prototype.durationEdited=function(e){if(/^[^\d.-]+$/.test(e.data[this.parent.taskFields.duration])){var t="The provided value for the "+this.parent.taskFields.duration+" field is invalid. Please ensure the "+this.parent.taskFields.duration+" field contains only valid numeric values.";this.parent.trigger("actionFailure",{error:t})}parseInt(e.data[this.parent.taskFields.duration],10)<0&&(e.data[this.parent.taskFields.duration]=0);var i=e.data.ganttProperties,r=e.data[this.parent.taskFields.duration];this.parent.dataOperation.updateDurationValue(r,i),this.updateDates(e),this.parent.editModule.updateResourceRelatedFields(e.data,"duration"),this.updateEditedRecord(e)},t.prototype.updateDates=function(t){var i=t.data.ganttProperties,r=this.parent.dateValidationModule.getDateFromFormat(i.endDate),a=this.parent.dateValidationModule.getDateFromFormat(i.startDate),n=i.duration;(0,e.isNullOrUndefined)(n)?(this.parent.setRecordValue("isMilestone",!1,i,!0),null!==t.data[this.parent.taskFields.duration]&&this.parent.setRecordValue("endDate",null,i,!0)):((0,e.isNullOrUndefined)(a)&&!(0,e.isNullOrUndefined)(r)&&this.parent.setRecordValue("startDate",this.parent.dateValidationModule.getStartDate(r,n,i.durationUnit,i),i,!0),0!==n&&i.isMilestone&&(this.parent.setRecordValue("isMilestone",!1,i,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!1,t.data,!0),this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(i.startDate,i),i,!0)),!(0,e.isNullOrUndefined)(i.segments)&&i.segments.length>0&&(this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(t.data,!1),i,!0),this.parent.dataOperation.updateMappingData(t.data,"segments")),this.parent.setRecordValue("isMilestone",0===i.duration,i,!0),this.parent.dateValidationModule.calculateEndDate(t.data)),this.parent.dataOperation.updateWidthLeft(t.data),this.parent.dataOperation.updateMappingData(t.data,"endDate"),this.parent.dataOperation.updateMappingData(t.data,"startDate"),this.parent.dataOperation.updateMappingData(t.data,"duration")},t.prototype.progressEdited=function(t){var i=t.data;if(this.parent.setRecordValue("progress",i[this.parent.taskFields.progress]>100?100:i[this.parent.taskFields.progress],i.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.progress,i[this.parent.taskFields.progress]>100?100:i[this.parent.taskFields.progress],t.data),i.ganttProperties.isAutoSchedule||this.parent.setRecordValue("autoWidth",this.parent.dataOperation.calculateWidth(i,!1),i.ganttProperties,!0),!(0,e.isNullOrUndefined)(t.data.ganttProperties.segments)&&t.data.ganttProperties.segments.length>0&&!(0,e.isNullOrUndefined)(this.parent.editModule.taskbarEditModule)&&this.parent.editModule.taskbarEditModule.updateSegmentProgress(t.data.ganttProperties),!t.data.hasChildRecords){var r=i.ganttProperties.isAutoSchedule?i.ganttProperties.width:i.ganttProperties.autoWidth;this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(r,i.ganttProperties.progress),i.ganttProperties,!0)}this.updateEditedRecord(t)},t.prototype.baselineEdited=function(e){var t=e.data.ganttProperties,i=e.data[this.parent.taskFields.baselineStartDate],r=e.data[this.parent.taskFields.baselineEndDate],a=this.parent.getCurrentDayEndTime(r);r&&0===r.getHours()&&86400!==a&&this.parent.dateValidationModule.setTime(a,r),this.parent.setRecordValue("baselineStartDate",this.parent.dateValidationModule.checkBaselineStartDate(i,t),t,!0),this.parent.setRecordValue("baselineEndDate",this.parent.dateValidationModule.checkBaselineEndDate(r),t,!0),t.baselineStartDate&&t.baselineEndDate&&(this.parent.setRecordValue("baselineLeft",this.parent.dataOperation.calculateBaselineLeft(t),t,!0),this.parent.setRecordValue("baselineWidth",this.parent.dataOperation.calculateBaselineWidth(t),t,!0)),this.updateEditedRecord(e)},t.prototype.resourceEdited=function(t,i,r){var a=this.parent.resourceFields,n=i[this.parent.taskFields.resourceInfo];if(n){this.isResourceCellEdited=!0;for(var s=this.parent.dataOperation.setResourceInfo(i).length,o=r.ganttProperties.resourceInfo,l=void 0,d=[],h=this.parent.resources,p=void 0,u=function(t){if(o){var i=o.length;for(p=0;p<i;p++){if(o[p][a.id]===n[t]){l=p;break}l=-1}}if((0,e.isNullOrUndefined)(l)||-1===l){var r=h.filter((function(e){return n[t]===e[a.id]})),s=(0,e.extend)({},r[0]);s[a.unit]=100,d.push(s)}else d.push(o[parseInt(l.toString(),10)])},c=0;c<s;c++)u(c);t.data.ganttProperties.resourceInfo=d,this.parent.dataOperation.updateMappingData(t.data,"resourceInfo"),this.parent.editModule.updateResourceRelatedFields(t.data,"resource"),"ResourceView"===this.parent.viewType&&(this.parent.editModule.dialogModule.isResourceUpdate=!0,this.parent.editModule.dialogModule.previousResource=o),this.updateDates(t),this.updateEditedRecord(t)}},t.prototype.dependencyEdited=function(e,t){if(/[!@#$%^&*()_=[\]{};:<>|./?-]/.test(e.data[this.parent.taskFields.dependency])){var i="The provided value for the "+this.parent.taskFields.dependency+" field is invalid. Please ensure that the "+this.parent.taskFields.dependency+" field does not contain any special characters.";this.parent.trigger("actionFailure",{error:i})}this.parent.predecessorModule.updateUnscheduledDependency(e.data);var r=this.parent.localeObj.getConstant("FF"),a=this.parent.localeObj.getConstant("FS"),n=this.parent.localeObj.getConstant("SS"),s=this.parent.localeObj.getConstant("SF"),o=e.data[this.parent.taskFields.dependency].split(","),l="";o.map((function(e,t){e.includes(r)?(l+=e.replace(r,"FF"),l+=o.length!==t+1?",":""):e.includes(a)?(l+=e.replace(a,"FS"),l+=o.length!==t+1?",":""):e.includes(n)?(l+=e.replace(n,"SS"),l+=o.length!==t+1?",":""):e.includes(s)?(l+=e.replace(s,"SF"),l+=o.length!==t+1?",":""):(l+=e,l+=o.length!==t+1?",":"")})),this.parent.connectorLineEditModule.updatePredecessor(e.data,l,e)||this.parent.editModule.revertCellEdit(t)},t.prototype.workEdited=function(e){var t=e.data.ganttProperties;e.data[this.parent.taskFields.work]<0&&(e.data[this.parent.taskFields.work]=0);var i=e.data[this.parent.taskFields.work];this.parent.setRecordValue("work",i,t,!0),this.parent.editModule.updateResourceRelatedFields(e.data,"work"),this.updateDates(e),this.updateEditedRecord(e)},t.prototype.typeEdited=function(e,t){var i=this.parent.taskFields.type||"taskType",r=e.data.ganttProperties,a=t[""+i];this.parent.setRecordValue("taskType",a,r,!0),this.updateEditedRecord(e)},t.prototype.compareDatesFromRecord=function(e){var t=this.parent.dateValidationModule.getValidStartDate(e),i=this.parent.dateValidationModule.getValidEndDate(e);return this.parent.dateValidationModule.compareDates(t,i)},t.prototype.updateEditedRecord=function(e){this.parent.editModule.initiateUpdateAction(e)},t.prototype.destroy=function(){this.parent.editModule.cellEditModule=void 0},t}(),fi=function(){function i(e,t){this.parent=e,this.taskbarEdit=t}return i.prototype.createTooltip=function(e,i,r){var a=this;this.toolTipObj=new t.Tooltip({opensOn:e,position:"TopRight",enableRtl:this.parent.enableRtl,mouseTrail:i,cssClass:Ie,target:r||null,animation:{open:{effect:"None"},close:{effect:"None"}}}),this.toolTipObj.beforeRender=function(e){var t={data:a.taskbarEdit.taskBarEditRecord,args:e,content:a.toolTipObj.content};a.parent.trigger("beforeTooltipRender",t)},this.toolTipObj.afterOpen=function(e){a.updateTooltipPosition(e)},this.toolTipObj.isStringTemplate=!0,this.toolTipObj.appendTo(this.parent.chartPane)},i.prototype.updateTooltipPosition=function(t){t.element.style.visibility="visible";var i=this.parent.element.closest('[style*="zoom"]');if((0,e.isNullOrUndefined)(i)){var r=this.parent.getOffsetRect(this.parent.chartPane).left+this.parent.chartPane.offsetWidth,a=t.element.offsetLeft;r<a+t.element.offsetWidth&&(a+=r-(a+t.element.offsetWidth)),t.element.style.left=a+"px",t.element.style.visibility="visible"}},i.prototype.showHideTaskbarEditTooltip=function(t,i){t&&this.parent.tooltipSettings.showTooltip?(this.createTooltip("Custom",!1),this.parent.tooltipModule.toolTipObj.close(),this.updateTooltip(i),"ConnectorPointLeftDrag"===this.taskbarEdit.connectorSecondAction?this.toolTipObj.open(this.taskbarEdit.connectorSecondElement.querySelector("."+Se)):"ConnectorPointRightDrag"===this.taskbarEdit.connectorSecondAction?this.toolTipObj.open(this.taskbarEdit.connectorSecondElement.querySelector("."+Ce)):this.toolTipObj.open(this.taskbarEdit.taskBarEditElement)):(0,e.isNullOrUndefined)(this.toolTipObj)||(this.toolTipObj.destroy(),this.toolTipObj=null)},i.prototype.updateTooltip=function(t){var i=this.taskbarEdit.taskBarEditRecord.ganttProperties,r=-1===t?i.width:i.segments[t].width,a=-1===t?i.progressWidth:i.segments[t].progressWidth,n=-1===t?i.left:i.left+i.segments[t].left;(0,e.isNullOrUndefined)(this.toolTipObj)||("ConnectorPointLeftDrag"===this.taskbarEdit.taskBarEditAction||"ConnectorPointRightDrag"===this.taskbarEdit.taskBarEditAction?(this.toolTipObj.content=this.getTooltipText(t),this.toolTipObj.offsetY=-3):(this.toolTipObj.content=this.getTooltipText(t),this.toolTipObj.refresh(this.taskbarEdit.taskBarEditElement),this.parent.enableRtl&&this.toolTipObj.tooltipEle&&(this.toolTipObj.tooltipEle.style.left=this.parent.editModule.taskbarEditModule.tooltipValue+10+"px"),"LeftResizing"===this.taskbarEdit.taskBarEditAction?this.parent.enableRtl?this.toolTipObj.offsetX=0:this.toolTipObj.offsetX=-r:"RightResizing"===this.taskbarEdit.taskBarEditAction||"ParentResizing"===this.taskbarEdit.taskBarEditAction?this.parent.enableRtl?this.toolTipObj.offsetX=-r:this.toolTipObj.offsetX=0:"ProgressResizing"===this.taskbarEdit.taskBarEditAction?this.parent.enableRtl?this.toolTipObj.offsetX=-a:this.toolTipObj.offsetX=-(r-a):"MilestoneDrag"===this.taskbarEdit.taskBarEditAction?this.toolTipObj.offsetX=-this.parent.chartRowsModule.milestoneHeight/2:r>5&&(this.toolTipObj.offsetX=-(r+n-this.taskbarEdit.tooltipPositionX))))},i.prototype.getTooltipText=function(t){var i="",r=this.parent.globalize,a=this.taskbarEdit.taskBarEditRecord.ganttProperties;if(!(0,e.isNullOrUndefined)(a.segments)&&a.segments.length>0&&-1!==t&&"ProgressResizing"!==this.taskbarEdit.taskBarEditAction&&(a=a.segments[t]),this.parent.tooltipSettings.editing){var n=this.parent.tooltipModule.templateCompiler(this.parent.tooltipSettings.editing,this.parent,this.taskbarEdit.taskBarEditRecord,"TooltipEditingTemplate");(0,e.getValue)("tooltipEle",this.toolTipObj)&&this.parent.renderTemplates(),i=n[0]}else{var s=void 0,o=void 0,l=void 0;switch((0,e.isNullOrUndefined)(a.startDate)||(s='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("startDate")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value">'+r.formatDate(a.startDate,{format:this.parent.getDateFormat()})+"</td></tr>"),(0,e.isNullOrUndefined)(a.endDate)||(o='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("endDate")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value">'+r.formatDate(a.endDate,{format:this.parent.getDateFormat()})+"</td></tr>"),(0,e.isNullOrUndefined)(a.duration)||(l='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("duration")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value">'+this.parent.getDurationString(a.duration,a.durationUnit)+"</td></tr>"),this.taskbarEdit.taskBarEditAction){case"ProgressResizing":i='<table class = "e-gantt-tooltiptable"><tbody>'+('<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("progress")+'</td><td style="padding: 2px;">:</td><td class = "e-gantt-tooltip-value">'+a.progress+"</td></tr>")+"</tbody></table>";break;case"LeftResizing":i='<table class = "e-gantt-tooltiptable"><tbody>'+s+l+"</tbody></table>";break;case"RightResizing":case"ParentResizing":i='<table class = "e-gantt-tooltiptable"><tbody>'+o+l+"</tbody></table>";break;case"ChildDrag":case"ParentDrag":case"MilestoneDrag":case"ManualParentDrag":var d="",h="";(0,e.isNullOrUndefined)(this.taskbarEdit.taskBarEditRecord.ganttProperties.startDate)||(d=s),(0,e.isNullOrUndefined)(this.taskbarEdit.taskBarEditRecord.ganttProperties.endDate)||(h=o),i='<table class = "e-gantt-tooltiptable"><tbody>'+d+h+"</tbody></table>";break;case"ConnectorPointLeftDrag":case"ConnectorPointRightDrag":i=this.parent.connectorLineModule.tooltipTable,(0,e.isNullOrUndefined)(this.toolTipObj)&&(this.parent.connectorLineModule.tooltipTable.innerHTML=this.parent.connectorLineModule.getConnectorLineTooltipInnerTd(this.parent.editModule.taskbarEditModule.taskBarEditRecord.ganttProperties.taskName,this.parent.editModule.taskbarEditModule.fromPredecessorText,"",""))}}return i},i}(),mi=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),yi=function(){return yi=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},yi.apply(this,arguments)},Di=function(t){function i(e){var i=t.call(this,e)||this;return i.leftValue=0,i.previousLeftValue=0,i.isMouseDragged=!1,i.dependencyCancel=!1,i.isDragged=!1,i.editElement=null,i.elementOffsetLeft=0,i.elementOffsetTop=0,i.elementOffsetWidth=0,i.elementOffsetHeight=0,i.segmentIndex=-1,i.currentItemTop=0,i.currentItemPrevTop=0,i.topValue=0,i.draggedRecordMarginTop="0px",i.isClonedElement=!1,i.updatePosition=!1,i.tooltipValue=0,i.parent=e,i.initPublicProp(),i.wireEvents(),i.editTooltip=new fi(i.parent,i),i}return mi(i,t),i.prototype.wireEvents=function(){this.parent.on("chartMouseDown",this.mouseDownHandler,this),this.parent.on("chartMouseUp",this.mouseUpHandler,this),this.parent.on("chartMouseLeave",this.mouseLeaveHandler,this),this.parent.on("chartMouseMove",this.mouseMoveAction,this),this.parent.on("chartMouseClick",this.mouseClickHandler,this)},i.prototype.initPublicProp=function(){this.taskBarEditElement=null,this.taskBarEditRecord=null,this.taskBarEditAction=null,this.connectorSecondElement=null,this.connectorSecondRecord=null,this.connectorSecondAction=null,this.highlightedSecondElement=null,this.fromPredecessorText=null,this.toPredecessorText=null,this.finalPredecessor=null,this.drawPredecessor=!1,this.roundOffDuration=!0,this.dragMouseLeave=!1,this.isMouseDragged=!1,this.previousItemProperty=["left","progress","duration","isMilestone","startDate","endDate","width","progressWidth","autoLeft","autoDuration","autoStartDate","autoEndDate","autoWidth","segments"],this.tapPointOnFocus=!1,this.touchEdit=!1},i.prototype.mouseDownHandler=function(e){if(this.parent.editSettings.allowTaskbarEditing&&!this.parent.readOnly)if(this.canDrag=!1,this.taskBarEditElement){var t=a(this.getElementByPosition(e),V);(t&&t.innerHTML===this.taskBarEditElement.innerHTML||this.taskBarEditElement.classList.contains("e-segmented-taskbar")||this.taskBarEditElement.classList.contains("collpse-parent-border"))&&(this.updateTaskBarEditElement(e),this.canDrag=!0,e.preventDefault())}else this.parent.isAdaptive||this.updateTaskBarEditElement(e)},i.prototype.mouseClickHandler=function(t){if(this.parent.editSettings.allowTaskbarEditing){var i=this.getElementByPosition(t),r=a(i,V);this.parent.selectionModule&&this.parent.selectionModule.enableSelectMultiTouch?this.tapPointOnFocus&&this.updateTaskBarEditElement(t):this.tapPointOnFocus&&!(0,e.isNullOrUndefined)(this.taskBarEditElement)&&r&&r.innerHTML!==this.taskBarEditElement.innerHTML?(this.connectorSecondRecord=this.parent.ganttChartModule.getRecordByTaskBar(r),this.connectorSecondAction="ConnectorPointLeftDrag",this.connectorSecondElement=r,this.fromPredecessorText="Finish",this.validateConnectorPoint()&&this.taskBarEditingAction(t,!0),this.showHideActivePredecessors(!1),this.initPublicProp()):i.classList.contains(Re)?(this.canDrag=!1,this.multipleSelectionEnabled(),this.showHideTaskBarEditingElements(i,this.taskBarEditElement),this.tapPointOnFocus=!0,this.taskBarEditAction="ConnectorPointLeftDrag",this.connectorSecondRecord=this.taskBarEditRecord,this.taskBarEditingAction(t,!1)):i.classList.contains(Me)?(this.canDrag=!1,this.multipleSelectionEnabled(),this.showHideTaskBarEditingElements(i,this.taskBarEditElement),this.tapPointOnFocus=!0,this.taskBarEditAction="ConnectorPointRightDrag",this.connectorSecondRecord=this.taskBarEditRecord,this.taskBarEditingAction(t,!1)):(this.tapPointOnFocus&&(this.showHideActivePredecessors(!1),this.showHideTaskBarEditingElements(r,this.taskBarEditElement)),this.updateTaskBarEditElement(t))}},i.prototype.showHideActivePredecessors=function(t){var i=this.taskBarEditRecord.ganttProperties,r=i.predecessor,a="ResourceView"===this.parent.viewType?i.taskId:i.rowUniqueID;if(r)for(var n=0;n<r.length;n++){var s=r[n];a.toString()!==s.from&&a.toString()!==s.to||this.applyActiveColor(s.from,s.to,t)}var o=this.parent.ganttChartModule.chartBodyContainer;t?((0,e.addClass)([this.taskBarEditElement],[Le]),(0,e.addClass)([o],[Be])):((0,e.removeClass)([this.taskBarEditElement],[Le]),(0,e.removeClass)([o],[Be])),this.touchEdit=t,(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},i.prototype.applyActiveColor=function(t,i,r){var a=("ProjectView"===this.parent.viewType?this.taskBarEditRecord.ganttProperties.taskId.toString():this.taskBarEditRecord.ganttProperties.rowUniqueID.toString())===t?this.parent.connectorLineModule.getRecordByID(i):this.parent.connectorLineModule.getRecordByID(t),n=this.parent.ganttChartModule.getChartRows()[this.parent.currentViewData.indexOf(a)];if(!(0,e.isNullOrUndefined)(n)){var s=n.querySelector("."+V),o=this.parent.element.querySelector("#ConnectorLineparent"+t+"child"+i);r?((0,e.addClass)([s],[Ve]),o&&(0,e.addClass)([o],[Ve])):((0,e.removeClass)([s],[Ve]),o&&(0,e.removeClass)([o],[Ve]))}},i.prototype.validateConnectorPoint=function(){var e=this.taskBarEditRecord.ganttProperties,t=this.connectorSecondRecord.ganttProperties,i=!0,r="ResourceView"===this.parent.viewType?e.taskId:e.rowUniqueID,a="ResourceView"===this.parent.viewType?t.taskId:t.rowUniqueID;if(this.connectorSecondRecord.hasChildRecords)i=!1;else if(t.predecessor)for(var n=0;n<t.predecessor.length;n++){var s=t.predecessor[n];if(s.from===r.toString()&&s.to===a.toString()){this.parent.connectorLineEditModule.childRecord=this.connectorSecondRecord,this.parent.connectorLineEditModule.predecessorIndex=n,this.parent.connectorLineEditModule.renderPredecessorDeleteConfirmDialog(),i=!1;break}if(s.from===a.toString()&&s.to===r.toString()){this.parent.connectorLineEditModule.childRecord=this.taskBarEditRecord,this.parent.connectorLineEditModule.predecessorIndex=n,this.parent.connectorLineEditModule.renderPredecessorDeleteConfirmDialog(),i=!1;break}}return i},i.prototype.mouseLeaveHandler=function(e){"ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"ProgressResizing"===this.taskBarEditAction||"LeftResizing"===this.taskBarEditAction||"RightResizing"===this.taskBarEditAction?this.dragMouseLeave=!1:this.dragMouseLeave=!0},i.prototype.updateTaskBarEditElement=function(t){var i,r,n=this.getElementByPosition(t);if(n.classList.contains(le)||n.classList.contains(ae)||n.classList.contains(ne))r=a(n,ae);else if(n.classList.contains(se))r=a(n,se);else if(r=a(n,V),!(0,e.isNullOrUndefined)(r)&&!n.classList.contains("e-connectorpoint-left")&&!n.classList.contains("e-connectorpoint-right")){var s=this.parent.ganttChartModule.getRecordByTaskBar(r);!(0,e.isNullOrUndefined)(s.ganttProperties.segments)&&s.ganttProperties.segments.length>0&&(r=a(n,A))}if(this.parent.editSettings.allowTaskbarEditing&&r){this.showHideTaskBarEditingElements(r,this.editElement),this.editElement=r,this.realTaskbarElement=this.editElement;var o=this.editElement.getAttribute("data-segment-index");if((0,e.isNullOrUndefined)(o)?this.segmentIndex=-1:this.segmentIndex=Number(o),this.taskBarEditRecord=this.parent.ganttChartModule.getRecordByTaskBar(this.editElement),"mousedown"===t.type||"touchstart"===t.type||"click"===t.type){this.taskBarEditAction=this.getTaskBarAction(t);var l=this.editElement.getAttribute("data-segment-index"),d=(s=this.parent.ganttChartModule.getRecordByTaskBar(r)).ganttProperties,h=this.editElement.parentElement.offsetLeft;this.currentData=s;var p=(0,e.createElement)("div",{styles:"height:100%;border-style:dashed;border-bottom:none;border-top:none;border-width:1px;position:absolute;z-index:10000"});(0,e.addClass)([p],"e-taskbar-resize-div"),p.style.setProperty("width",d.width+"px");var u=this.editElement.getAttribute("data-segment-index");!(0,e.isNullOrUndefined)(d.segments)&&this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?p.style.setProperty("left",(0,e.isNullOrUndefined)(d.segments)?d.left+"px":h+"px"):p.style.setProperty("left",(0,e.isNullOrUndefined)(d.segments)||0===d.segments.length?d.left+"px":h+d.segments[Number(u)].left+"px");var c=this.parent.createElement("table"),g=this.parent.createElement("tbody");g.appendChild(p),c.appendChild(g);var f=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-clone-taskbar"),m=null;if(i="ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||(0,e.isNullOrUndefined)(l)||(0,e.isNullOrUndefined)(l)||0!==Number(l)?-1!==this.segmentIndex&&this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?this.editElement.parentElement.cloneNode(!0):this.editElement.cloneNode(!0):this.editElement.parentElement.cloneNode(!0),!f){if((0,e.addClass)([i],"e-clone-taskbar"),i.style.setProperty("position","absolute"),s.hasChildRecords&&!s.ganttProperties.isAutoSchedule){var y=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),D=this.parent.getOffsetRect(this.editElement);i.style.setProperty(this.parent.enableRtl?"right":"left",Math.abs(D.left-y.left+Math.abs(this.parent.ganttChartModule.scrollElement.scrollLeft))+"px")}i.style.setProperty("top","0px"),m=this.parent.createElement("table");var v=this.parent.createElement("tbody");v.appendChild(i),m.appendChild(v)}if("ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||(0,e.isNullOrUndefined)(l)||(0,e.isNullOrUndefined)(l)||0!==Number(l))this.cloneTaskbarElement=i;else{var k=i.getElementsByClassName("e-segmented-taskbar");this.cloneTaskbarElement=k[Number(l)]}if(this.taskBarEditElement=this.cloneTaskbarElement,this.taskbarElement=m,this.taskbarResizer=c,this.currentIndex=l,this.roundOffDuration=!0,"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||!(0,e.isNullOrUndefined)(this.parent.taskFields.dependency)||(this.taskBarEditAction=null),this.updateMouseDownProperties(t),"ResourceView"===this.parent.viewType||"ProjectView"===this.parent.viewType){if(0===this.taskBarEditRecord.level)return;if(this.parent.enableMultiTaskbar){var w=this.parent.getTaskByUniqueID(this.taskBarEditRecord.parentItem.uniqueID);(0,e.isNullOrUndefined)(w)||w.expanded||(this.prevZIndex=this.taskBarEditElement.style.zIndex,this.taskBarEditElement.style.zIndex="1000",this.taskBarEditElement.querySelector(".e-gantt-child-taskbar")&&(0,e.addClass)([this.taskBarEditElement.querySelector(".e-gantt-child-taskbar")],"e-collapsed-taskbar-drag"))}}}}else this.parent.isAdaptive?(this.taskBarEditElement&&this.showHideTaskBarEditingElements(r,this.editElement),this.initPublicProp()):this.showHideTaskBarEditingElements(r,this.editElement)},i.prototype.showHideTaskBarEditingElements=function(t,i,r){i=i||this.editElement;var a=!!this.parent.taskFields.progress,n=!0;if(!this.parent.readOnly){if(this.parent.enableMultiTaskbar&&t){var s=this.parent.ganttChartModule.getRecordByTaskBar(t),o=this.parent.getParentTask(s.parentItem);(0,e.isNullOrUndefined)(o)||o.expanded||(a=!1,n=!1)}if(t){if(t.querySelector("."+X)){if((0,e.addClass)([t.querySelector("."+X)],[ue]),(0,e.addClass)([t.querySelector("."+Y)],[ce]),a){var l=t.querySelector("."+Q);(0,e.isNullOrUndefined)(l)||((0,e.addClass)([l],[ge]),l.style.top="3px")}}else if(this.parent.isAdaptive&&a){(s=this.parent.ganttChartModule.getRecordByTaskBar(t)).hasChildRecords&&(0,e.addClass)([t],[Ne])}if((0,e.addClass)(this.parent.ganttChartModule.scrollElement.querySelectorAll("."+ve),[Pe]),!(0,e.isNullOrUndefined)(this.parent.taskFields.dependency)&&(t.querySelector("."+Se)||t.parentElement.querySelector("."+Se))&&n){var d=(0,e.isNullOrUndefined)(t.querySelector("."+Se))?t.parentElement:t;(0,e.isNullOrUndefined)(d.querySelector("."+Se))||(0,e.addClass)([d.querySelector("."+Se)],[Re]),(0,e.isNullOrUndefined)(d.querySelector("."+Ce))||(0,e.addClass)([d.querySelector("."+Ce)],[Me])}}else r||(0,e.removeClass)(this.parent.ganttChartModule.scrollElement.querySelectorAll("."+ve),[Pe]);if(i&&t!==i){if(i.querySelector("."+X)&&((0,e.removeClass)([i.querySelector("."+X)],[ue]),(0,e.removeClass)([i.querySelector("."+Y)],[ce]),i.querySelector("."+Q)&&(0,e.removeClass)([i.querySelector("."+Q)],[ge])),(0,e.isNullOrUndefined)(this.parent.taskFields.dependency)||!i.querySelector("."+Se)&&!i.parentElement.querySelector("."+Se)){if(this.parent.isAdaptive){(s=this.parent.ganttChartModule.getRecordByTaskBar(i))&&s.hasChildRecords&&(0,e.removeClass)([i],[Ne])}}else{var h=(d=(0,e.isNullOrUndefined)(i.querySelector("."+Se))?i.parentElement:i).querySelector("."+Se),p=d.querySelector("."+Ce);h&&(0,e.removeClass)([h],[Re]),p&&(0,e.removeClass)([p],[Me])}this.editElement=null}}},i.prototype.getTaskBarAction=function(t){var i=this.getElementByPosition(t),r=this.taskBarEditRecord,a="";return i.classList.contains(X)?a="LeftResizing":i.classList.contains(Y)?a="RightResizing":(i.classList.contains(Q)||(0,e.closest)(i,"."+Q))&&this.parent.taskFields.progress?a="ProgressResizing":i.classList.contains(Se)?a="ConnectorPointLeftDrag":i.classList.contains(Ce)?a="ConnectorPointRightDrag":i.classList.contains(le)?a="ParentResizing":i.classList.contains(ne)||i.classList.contains(ae)||i.classList.contains(se)?a="ManualParentDrag":r&&(a=r.hasChildRecords?"ParentDrag":r.ganttProperties.isMilestone?"MilestoneDrag":"ChildDrag"),a},i.prototype.updateMouseDownProperties=function(e){var t=this.getCoordinate(e),i=this.parent.element.closest('[style*="zoom"]');if(i){var r=parseFloat(getComputedStyle(i).zoom);t.pageX=t.pageX/r,t.pageY=t.pageY/r}if(t.pageX||t.pageY){var a=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer);this.parent.enableRtl?this.mouseDownX=Math.abs(t.pageX-(a.left+Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left))):this.mouseDownX=t.pageX-a.left+this.parent.ganttChartModule.scrollObject.previousScroll.left,this.tooltipPositionX=this.mouseDownX,this.mouseDownY=this.dragMoveY=t.pageY-a.top+this.parent.ganttChartModule.scrollObject.previousScroll.top}"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||(this.fromPredecessorText="ConnectorPointLeftDrag"===this.taskBarEditAction?"start":"finish",this.parent.connectorLineModule.tooltipTable.innerHTML=this.parent.connectorLineModule.getConnectorLineTooltipInnerTd(this.taskBarEditRecord.ganttProperties.taskName,this.fromPredecessorText,"",""))},i.prototype.isMouseDragCheck=function(){if(!this.isMouseDragged&&this.taskBarEditAction&&(this.mouseDownX!==this.mouseMoveX&&(this.mouseDownX+3<this.mouseMoveX||this.mouseDownX-3>this.mouseMoveX)||this.mouseDownY!==this.mouseMoveY&&(this.mouseDownY+3<this.mouseMoveY||this.mouseDownY-3>this.mouseMoveY))){this.isMouseDragged=!0,this.parent.initiateEditAction(!0);var e=this.taskBarEditRecord.ganttProperties;this.previousItem=this.parent.timelineModule.extendFunction(e,this.previousItemProperty),"ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction||"ResourceView"===this.parent.viewType&&"ParentDrag"===this.taskBarEditAction||this.editTooltip.showHideTaskbarEditTooltip(!0,this.segmentIndex),this.taskBarEditElement.setAttribute("aria-grabbed","true")}},i.prototype.removeFirstBorder=function(e){var t="bottomSegment"===this.parent.rowDragAndDropModule.dropPosition;this.parent.element.getElementsByClassName("e-firstrow-border").length>0&&e&&(0!==e.getAttribute("data-rowindex")||t)&&this.parent.element.getElementsByClassName("e-firstrow-border")[0].remove()},i.prototype.removeLastBorder=function(e){var t,i=e&&(e.classList.contains("e-emptyrow")||e.classList.contains("e-columnheader")||e.classList.contains("e-detailrow")),r=(t=this.parent.enableVirtualization?e&&!i&&this.parent.treeGrid.getRows()[this.parent.treeGrid.getCurrentViewRecords().length-1].getAttribute("data-uid")!==e.getAttribute("data-uid"):e&&!i&&this.parent.treeGrid.getRowByIndex(this.parent.treeGrid.getCurrentViewRecords().length-1).getAttribute("data-uid")!==e.getAttribute("data-uid"))||"topSegment"===this.parent.rowDragAndDropModule.dropPosition;this.parent.element.getElementsByClassName("e-lastrow-border").length>0&&e&&(t||r)&&this.parent.element.getElementsByClassName("e-lastrow-border")[0].remove()},i.prototype.removetopOrBottomBorder=function(){var e=[].slice.call(this.parent.element.querySelectorAll(".e-dropbottom, .e-droptop"));e.length&&(this.addRemoveClasses(e,!1,"e-dropbottom"),this.addRemoveClasses(e,!1,"e-droptop"))},i.prototype.topOrBottomBorder=function(e){var t;if(this.parent.enableVirtualization){var i=this.parent.treeGrid.getRows().filter((function(t){return t.getAttribute("data-rowindex")===e.getAttribute("data-rowindex")}))[0],r=this.parent.treeGrid.getRows().indexOf(i);t=this.parent.getRowByIndex(r).children}else t=this.parent.getRowByIndex(parseInt(e.getAttribute("data-rowindex"),10)).children;t&&("above"===this.parent.rowDragAndDropModule.dropPosition&&(this.addRemoveClasses(t,!0,"e-droptop"),this.parent.element.getElementsByClassName("e-lastrow-dragborder").length>0&&this.parent.element.getElementsByClassName("e-lastrow-dragborder")[0].remove()),"below"===this.parent.rowDragAndDropModule.dropPosition&&this.addRemoveClasses(t,!0,"e-dropbottom"))},i.prototype.removeChildBorder=function(){var e=[].slice.call(this.parent.element.querySelectorAll(".e-childborder"));e.length>0&&this.addRemoveClasses(e,!1,"e-childborder")},i.prototype.addRemoveClasses=function(e,t,i){for(var r=0,a=e.length;r<a;r++)t?e[parseInt(r.toString(),10)].classList.add(i):e[parseInt(r.toString(),10)].classList.remove(i)},i.prototype.addErrorElem=function(){var t=document.getElementsByClassName("e-clone-taskbar")[0];if(!document.querySelectorAll(".e-errorelem").length){var i=document.createElement("div");(0,e.classList)(i,["e-errorcontainer"],[]),(0,e.classList)(i,["e-icons","e-errorelem"],[]),this.taskBarEditRecord.ganttProperties.segments&&this.taskBarEditRecord.ganttProperties.segments.length>0&&(i.style.paddingTop=this.parent.taskbarHeight+"px"),t.appendChild(i)}},i.prototype.removeErrorElem=function(){var e=document.querySelector(".e-errorelem");e&&e.remove()},i.prototype.ensurePosition=function(t,i){var r=this;t.filter((function(t){if(t.hasChildRecords&&!(0,e.isNullOrUndefined)(t.childRecords)){if(-1!==t.childRecords.indexOf(i))return r.parent.rowDragAndDropModule.dropPosition="Invalid",void r.addErrorElem();r.ensurePosition(t.childRecords,i)}}))},i.prototype.mouseMoveAction=function(t){var i=this;if(this.parent.isAdaptive){if(!this.canDrag)return;this.multipleSelectionEnabled()}var r=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),n=this.getCoordinate(t);this.parent.enableRtl?this.mouseMoveX=Math.abs(n.pageX-(r.left+Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left))):this.mouseMoveX=n.pageX-r.left+this.parent.ganttChartModule.scrollObject.previousScroll.left,this.mouseMoveY=n.pageY-r.top+this.parent.ganttChartModule.scrollObject.previousScroll.top,this.dragMouseLeave=!1;var s=!1;if("ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction){var o=void 0;if(this.parent.enableVirtualization){var l=this.parent.currentViewData.indexOf(this.taskBarEditRecord);o=this.parent.getRowByIndex(l)}else o=this.parent.getRowByIndex(this.taskBarEditRecord.index);var d={cancel:s,cloneElement:this.taskbarElement,data:this.taskBarEditRecord,target:t.target,rows:o};this.parent.trigger("rowDrag",d),s=d.cancel}if(s||this.isMouseDragCheck(),this.isMouseDragged&&this.taskBarEditAction){if(t.preventDefault(),!((0,e.isNullOrUndefined)(this.taskbarElement)||(0,e.isNullOrUndefined)(this.editElement)||"ConnectorPointRightDrag"===this.taskBarEditAction||"ConnectorPointLeftDrag"===this.taskBarEditAction||"ResourceView"===this.parent.viewType&&this.currentData.hasChildRecords)){var h=this.editElement.parentElement;if(this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?h.style.setProperty("position","relative"):h.style.setProperty("position","absolute"),"ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||(0,e.isNullOrUndefined)(this.currentIndex)||(0,e.isNullOrUndefined)(this.currentIndex)||0!==Number(this.currentIndex)?this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?this.parent.chartPane.getElementsByClassName("e-gantt-chart")[0].appendChild(this.taskbarElement):h.appendChild(this.taskbarElement):(this.taskbarElement.childNodes[0].childNodes[0].style.setProperty("top",h.parentElement.offsetTop+"px"),this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?this.parent.chartPane.getElementsByClassName("e-gantt-chart")[0].appendChild(this.taskbarElement):h.parentElement.appendChild(this.taskbarElement)),"ProgressResizing"!==this.taskBarEditAction)if(this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth)this.parent.ganttChartModule.chartBodyContainer.querySelectorAll(".e-chart-scroll-container")[0].appendChild(this.taskbarResizer);else this.parent.ganttChartModule.chartBodyContainer.querySelectorAll(".e-chart-rows-container")[0].appendChild(this.taskbarResizer)}if(this.parent.allowTaskbarDragAndDrop&&("ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction)){var p=this.parent.getOffsetRect(this.taskBarEditElement),u=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?12:0,c=3+this.parent.chartRowsModule.connectorPointWidth+u,g=void 0;g=this.parent.enableRtl?Math.abs(p.left+c+1):Math.abs(p.left-c-1),this.isClonedElement||this.parent.enableRtl||(g-=this.parent.ganttChartModule.scrollElement.scrollLeft,this.isClonedElement=!0);var f=0;this.parent.rowDragAndDropModule.dropPosition=void 0;var m=void 0,y=void 0;y="touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type?t.changedTouches[0].pageY:t.y,this.parent.enableRtl?(m=document.elementFromPoint(this.parent.ganttChartModule.chartBodyContainer.offsetWidth,y)).classList.contains("e-taskbar-resize-div")&&(m=document.elementFromPoint(this.parent.ganttChartModule.chartBodyContainer.offsetWidth-m.offsetWidth,y)):m=document.elementFromPoint(g,y);var D,v=void 0;if(this.parent.enableVirtualization){if(!this.draggedTreeGridRowElement)v=(h=this.editElement.parentElement).parentElement,this.draggedTreeGridRowElement=v,this.draggedTreeGridRowHeight=this.draggedTreeGridRowElement.offsetHeight}else if(v=this.parent.treeGrid.getRows()[this.parent.flatData.indexOf(this.taskBarEditRecord)],this.draggedTreeGridRowElement=v,this.parent.enableMultiTaskbar)if(this.taskBarEditRecord.parentItem&&!(0,e.isNullOrUndefined)(this.parent.getRowByID(this.taskBarEditRecord.parentItem.taskId))){if(this.draggedTreeGridRowHeight=this.parent.getRowByID(this.taskBarEditRecord.parentItem.taskId).offsetHeight,"ProjectView"===this.parent.viewType&&0===this.draggedTreeGridRowHeight)for(var k=this.parent.getRecordByID(this.taskBarEditRecord.parentItem.taskId);k.parentItem;)k=this.parent.getRecordByID(k.parentItem.taskId),this.draggedTreeGridRowHeight=this.parent.getRowByID(k.TaskID).offsetHeight}else{h=this.editElement.parentElement;this.draggedTreeGridRowElement=h.parentElement,this.draggedTreeGridRowHeight=this.draggedTreeGridRowElement.offsetHeight}else this.draggedTreeGridRowHeight=this.draggedTreeGridRowElement.offsetHeight;if(m&&(D=(0,e.closest)(m,"tr."+Z)),D){var w=void 0;w=this.parent.enableVirtualization?this.parent.treeGrid.getRows().filter((function(e){return e.getAttribute("data-rowindex")===D.getAttribute("data-rowindex")}))[0]:this.parent.treeGrid.getRows()[parseInt(D.getAttribute("data-rowindex"),10)],this.removeFirstBorder(w),this.removeLastBorder(w),((0,e.isNullOrUndefined)(w)||w.getAttribute("data-uid")!==this.draggedTreeGridRowElement.getAttribute("data-uid"))&&a(m,"e-chart-rows-container")||(this.parent.rowDragAndDropModule.dropPosition="Invalid",this.addErrorElem());var b=this.parent,T=0,P=b.toolbarModule?this.parent.toolbarModule.element.offsetHeight:0,S=this.parent.getOffsetRect(b.element),C=b.treeGrid.getHeaderContent().offsetHeight+S.top+P,R=b.treeGrid.getContent().firstElementChild.scrollTop;(0,e.isNullOrUndefined)(w)||(f=w.offsetTop-R);var M=((T=this.parent.enableVirtualization?this.parent.getOffsetRect(w).top:f+C)+this.draggedTreeGridRowHeight-T)/3,x=T+M,O=x+M,I=O+M,E="mousemove"===t.type?t.pageY:(0,e.isNullOrUndefined)(t.changedTouches)?null:t.changedTouches[0].pageY,F=E<=x,U=E>x&&E<=O,N=E>O&&E<=I;if(F||U||N){var L=void 0;if(this.parent.enableVirtualization){l=this.parent.treeGrid.getRows().indexOf(w);L=this.parent.getRowByIndex(l)}else L=this.parent.getRowByIndex(parseInt(w.getAttribute("data-rowindex"),10));var V=(0,e.getValue)("rowIndex",L),B=this.parent.flatData[V],A=!0;"ResourceView"!==this.parent.viewType||this.taskBarEditRecord.hasChildRecords||B.hasChildRecords||(0,e.isNullOrUndefined)(B.parentItem)||this.taskBarEditRecord.parentItem.taskId!==B.parentItem.taskId||(A=!1),B&&this.ensurePosition([this.taskBarEditRecord],B),A&&(F&&"Invalid"!==this.parent.rowDragAndDropModule.dropPosition&&(this.parent.rowDragAndDropModule.dropPosition="above",this.removeChildBorder(),this.removeErrorElem(),this.removetopOrBottomBorder(),this.topOrBottomBorder(L)),U&&"Invalid"!==this.parent.rowDragAndDropModule.dropPosition&&(this.parent.rowDragAndDropModule.dropPosition="child",this.removetopOrBottomBorder(),this.addRemoveClasses(L.children,!0,"e-childborder")),N&&"Invalid"!==this.parent.rowDragAndDropModule.dropPosition&&(this.parent.rowDragAndDropModule.dropPosition="below",this.removetopOrBottomBorder(),this.removeErrorElem(),this.removeChildBorder(),this.removeFirstBorder(w),this.topOrBottomBorder(w)))}}}var W={cancel:!1,requestType:"taskbarediting",taskBarEditAction:this.taskBarEditAction,data:this.taskBarEditRecord};-1!==this.segmentIndex&&(W.requestType="mergeSegment"),this.parent.trigger("actionBegin",W,(function(r){if(("ConnectorPointRightDrag"===W.taskBarEditAction||"ConnectorPointLeftDrag"===W.taskBarEditAction||"LeftResizing"===W.taskBarEditAction||"RightResizing"===W.taskBarEditAction||"ProgressResizing"===W.taskBarEditAction||"ChildDrag"===W.taskBarEditAction||"ParentDrag"===W.taskBarEditAction||"MilestoneDrag"===W.taskBarEditAction||"ManualParentDrag"===W.taskBarEditAction)&&(i.parent.showIndicator=!1,i.parent.undoRedoModule&&i.parent.isUndoRedoItemPresent("Edit"))){i.parent.undoRedoModule.redoEnabled&&i.parent.undoRedoModule.disableRedo();var a={};(0===i.parent.undoRedoModule.getUndoCollection.length||i.parent.editModule.createArray)&&(i.isDragged=!0,a.modifiedRecords=[],a.action=W.taskBarEditAction,i.parent.undoRedoModule.createUndoCollection(),i.parent.undoRedoModule.getUndoCollection[i.parent.undoRedoModule.getUndoCollection.length-1]=a,i.parent.editModule.createArray=!1,i.parent.undoRedoModule.changedRecords=[])}!(0,e.isNullOrUndefined)(i.parent.loadingIndicator)&&"Shimmer"===i.parent.loadingIndicator.indicatorType&&i.parent.showIndicator?i.parent.showMaskRow():i.parent.showIndicator&&i.parent.showSpinner(),!1===r.cancel&&i.taskBarEditingAction(t,!1)}))}else this.parent.isAdaptive||this.taskBarEditAction||this.updateTaskBarEditElement(t)},i.prototype.taskBarEditingAction=function(t,i){var r=this,a={},n=this.parent.ganttChartModule.getIndexByTaskBar(this.taskBarEditElement);if(null!==this.taskBarEditRecord){if(a.editingFields=this.taskBarEditRecord.ganttProperties,a.data=this.taskBarEditRecord,"ResourceView"===this.parent.viewType&&0===a.data.level)return;if(a.recordIndex=n,a.taskBarEditAction=this.taskBarEditAction,a.roundOffDuration=this.roundOffDuration,a.cancel=!1,a.previousData=this.previousItem,a.segmentIndex=this.segmentIndex,this.roundOffDuration=a.roundOffDuration,this.targetElement=a.target=(0,e.closest)(t.target,".e-gantt-child-taskbar"),this.updateMouseMoveProperties(t),this.oldData||(this.oldData=(0,e.extend)([],[],[this.taskBarEditRecord],!0)[0]),"ProgressResizing"===this.taskBarEditAction?this.performProgressResize(t):"LeftResizing"===this.taskBarEditAction?this.enableLeftResizing(t):"RightResizing"===this.taskBarEditAction||"ParentResizing"===this.taskBarEditAction?this.enableRightResizing(t):"ParentDrag"===this.taskBarEditAction||"ChildDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction?this.enableDragging(t):"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||(this.updateConnectorLineSecondProperties(t),this.triggerDependencyEvent(t),this.drawFalseLine()),this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction){var s=this.parent.getOffsetRect(this.parent.chartPane),o=this.getCoordinate(t),l={top:o.pageY,left:o.pageX},d={left:Math.abs(l.left-s.left),top:l.top-s.top};if("ResourceView"===this.parent.viewType&&this.parent.enableMultiTaskbar){var h=this.parent.getRecordByID(this.taskBarEditRecord.parentItem.taskId);if(!this.parent.allowTaskbarOverlap&&this.taskBarEditRecord.parentItem&&!h.expanded){var p=0;if(parseInt(this.editElement.style.marginTop,10)>this.parent.rowHeight){for(var u=0;u<h.childRecords.length&&h.childRecords[u].ganttProperties.taskId!==this.taskBarEditRecord.ganttProperties.taskId;u++)p+=this.parent.rowHeight;d.top=d.top-p}}}this.topValue=d.top;var c=void 0;c="touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type?t.changedTouches[0].pageX:t.pageX,this.parent.enableRtl?this.leftValue=d.left-Math.abs(c-this.parent.getOffsetRect(this.taskBarEditElement).left)-(0!==this.previousLeftValue?c-this.previousLeftValue:0):this.leftValue=d.left-(c-this.parent.getOffsetRect(this.taskBarEditElement).left)+(0!==this.previousLeftValue?c-this.previousLeftValue:0),0===this.previousLeftValue&&(this.parent.enableRtl?(this.leftValue=this.leftValue-this.parent.ganttChartModule.scrollObject.previousScroll.left,0===this.parent.ganttChartModule.scrollObject.previousScroll.left&&(this.leftValue=this.leftValue-60)):this.leftValue=this.leftValue-this.parent.ganttChartModule.scrollObject.previousScroll.left),this.previousLeftValue=c}else this.leftValue=this.taskBarEditRecord.ganttProperties.left;this.setItemPosition(),this.updateEditedItem(),this.tooltipValue="touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type?t.changedTouches[0].pageX:t.pageX,this.editTooltip.updateTooltip(this.segmentIndex),i&&this.taskBarEditedAction(t),this.parent.trigger("taskbarEditing",a,(function(t){t.cancel&&null!==r.taskBarEditRecord&&(r.tapPointOnFocus=!1,(0,e.merge)(r.taskBarEditRecord.ganttProperties,t.previousData))}))}},i.prototype.updateMouseMoveProperties=function(e){var t=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),i=this.getCoordinate(e),r=this.parent.element.closest('[style*="zoom"]');if(r){var a=parseFloat(getComputedStyle(r).zoom);i.pageX=i.pageX/a,i.pageY=i.pageY/a}(i.pageX||i.pageY)&&(this.parent.enableRtl?this.mouseMoveX=Math.abs(i.pageX-(t.left+Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left))):this.mouseMoveX=i.pageX-t.left+this.parent.ganttChartModule.scrollObject.previousScroll.left,this.tooltipPositionX=this.mouseMoveX,this.mouseMoveY=i.pageY-t.top+this.parent.ganttChartModule.scrollObject.previousScroll.top);var n="ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction;if((this.taskBarEditRecord.ganttProperties.width>3||this.taskBarEditRecord.ganttProperties.isMilestone)&&("ProgressResizing"!==this.taskBarEditAction||0!==this.taskBarEditRecord.ganttProperties.progress&&100!==this.taskBarEditRecord.ganttProperties.progress)||n){var s=0;s=this.parent.enableRtl?Math.abs(Math.abs(this.mouseMoveX)-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left)+t.left):this.mouseMoveX-this.parent.ganttChartModule.scrollObject.previousScroll.left+t.left;var o=this.mouseMoveY-this.parent.ganttChartModule.scrollObject.previousScroll.top+t.top;s+20>t.left+this.parent.ganttChartModule.chartBodyContainer.offsetWidth?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.left,this.startScrollTimer("right")):s+40>t.left+this.parent.ganttChartModule.chartBodyContainer.offsetWidth&&this.parent.enableRtl&&0===this.parent.ganttChartModule.scrollObject.previousScroll.left?(this.parent.ganttChartModule.scrollObject.previousScroll.left=-1,this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.left,this.startScrollTimer("right")):s-20<t.left?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.left,this.startScrollTimer("left")):o+80>t.top+this.parent.ganttChartModule.chartBodyContainer.offsetHeight?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.top,this.startScrollTimer("bottom")):o-20<t.top?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.top,this.startScrollTimer("top")):this.stopScrollTimer()}else this.stopScrollTimer()},i.prototype.startScrollTimer=function(e){var t=this;this.stopScrollTimer();var i=0;this.scrollTimer=window.setInterval((function(){if(-1===Math.sign(t.timerCount)&&(i=-1,t.timerCount=Math.abs(t.timerCount)),"right"===e){var r=t.parent.enableTimelineVirtualization?t.parent.timelineModule.wholeTimelineWidth:t.parent.timelineModule.totalTimelineWidth;t.timerCount=t.timerCount+1>=r?r:t.timerCount+1}else t.timerCount="bottom"===e?t.timerCount+1:t.timerCount-1<0?0:t.timerCount-1;"bottom"===e||"top"===e?t.parent.ganttChartModule.scrollObject.setScrollTop(t.timerCount):t.parent.ganttChartModule.scrollObject.setScrollLeft(t.timerCount,i),"ConnectorPointLeftDrag"!==t.taskBarEditAction&&"ConnectorPointRightDrag"!==t.taskBarEditAction||t.drawFalseLine()}),0)},i.prototype.stopScrollTimer=function(){window.clearInterval(this.scrollTimer),this.scrollTimer=null},i.prototype.enableDragging=function(t){var i=this.taskBarEditRecord.ganttProperties,r=this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth,a=0;if(this.taskBarEditElement.classList.contains("e-segmented-taskbar")&&!this.taskBarEditElement.classList.contains("e-segment-first")){var n=this.taskBarEditRecord.ganttProperties.segments.map((function(e){return yi({},e)})),s=n[this.segmentIndex];this.mouseDownX>this.mouseMoveX?(a=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,s.left=s.left-a):(a=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,s.left=s.left+a);var o=n[this.segmentIndex-1],l=n[this.segmentIndex+1],d=void 0;d=this.taskBarEditElement.classList.contains("e-segment-inprogress")?s.left<o.left+o.width?o.left+o.width:s.width+s.left>l.left?l.left-s.width:s.left:s.left<o.left+o.width?o.left+o.width:i.left+s.width+s.left>=r?r-s.width:s.left,s.left=d,this.parent.setRecordValue("segments",n,i,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")}else{this.mouseDownX>this.mouseMoveX?(a=this.mouseDownX-this.mouseMoveX)>0&&this.parent.setRecordValue("left",this.previousItem.left-a,i,!0):(a=this.mouseMoveX-this.mouseDownX,this.parent.setRecordValue("left",this.previousItem.left+a,i,!0));d=i.left<0?0:i.left+i.width>=r?r-i.width:i.left;this.parent.setRecordValue("left",d,i,!0)}},i.prototype.performProgressResize=function(e){var t=this.taskBarEditRecord.ganttProperties,i=0;this.mouseDownX>this.mouseMoveX?this.mouseMoveX>t.left&&this.mouseMoveX<t.left+t.width&&t.left>0?(i=this.mouseMoveX-t.left,this.parent.setRecordValue("progressWidth",i,t,!0)):this.mouseMoveX>=t.left+t.width?this.parent.setRecordValue("progressWidth",t.width,t,!0):this.parent.setRecordValue("progressWidth",0,t,!0):this.mouseMoveX>t.left&&this.mouseMoveX<t.left+t.width?(i=this.mouseMoveX-t.left,this.parent.setRecordValue("progressWidth",i,t,!0)):this.mouseMoveX<=t.left?this.parent.setRecordValue("progressWidth",0,t,!0):this.parent.setRecordValue("progressWidth",t.width,t,!0);var r=t.progressWidth>t.width?t.width:t.progressWidth;r=t.progressWidth<0?0:t.progressWidth,this.parent.setRecordValue("progressWidth",r,t,!0);var a=t.width-t.progressWidth;this.progressBorderRadius=a<=4?4-a:0},i.prototype.enableLeftResizing=function(e){var t=this.taskBarEditRecord.ganttProperties,i=0;this.taskBarEditElement.classList.contains("e-segmented-taskbar")?this.enableSplitTaskLeftResize(t):(this.mouseDownX>this.mouseMoveX?this.mouseMoveX<t.left+t.width?(i=this.mouseDownX-this.mouseMoveX,t.left>0&&(this.parent.setRecordValue("left",this.previousItem.left-i,t,!0),this.parent.setRecordValue("width",this.previousItem.width+i,t,!0))):this.mouseMoveX>t.left+t.width&&(i=this.mouseDownX-this.mouseMoveX,this.parent.setRecordValue("left",this.previousItem.left-i,t,!0),this.parent.setRecordValue("width",3,t,!0)):this.mouseMoveX<t.left+t.width?(i=this.mouseMoveX-this.mouseDownX,t.left<t.left+t.width&&this.previousItem.left+i<=this.previousItem.left+this.previousItem.width&&(this.parent.setRecordValue("left",this.previousItem.left+i,t,!0),this.parent.setRecordValue("width",this.previousItem.width-i,t,!0))):(i=this.mouseMoveX-this.mouseDownX,this.parent.setRecordValue("left",this.previousItem.left+i,t,!0),this.parent.setRecordValue("width",3,t,!0)),this.updateEditPosition(e,t),this.parent.setRecordValue("left",this.previousItem.left+this.previousItem.width-t.width,t,!0))},i.prototype.enableSplitTaskLeftResize=function(t){var i=this.taskBarEditRecord.ganttProperties.segments.map((function(e){return yi({},e)})),r=i[this.segmentIndex],a=0;if(this.mouseDownX>this.mouseMoveX)if(this.mouseMoveX<t.left+r.width+r.left){if(a=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,r.left>0){if(r.left=r.left-a,r.width=r.width+a,0!==this.segmentIndex){var n=i[this.segmentIndex-1];if(t.left+r.left<t.left+n.left+n.width){var s=t.left+n.left+n.width-(t.left+r.left);r.width-=s,r.left=r.left+s}}}else if(r.left<=0&&0===this.segmentIndex){this.parent.setRecordValue("left",t.left-a,t,!0),this.parent.setRecordValue("width",t.width+a,t,!0),r.width=r.width+a;for(var o=1;o<t.segments.length;o++){var l=i[o];l.left=l.left+a}}}else this.mouseMoveX>t.left+r.width+r.left&&(a=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,r.left=r.left-a,r.width=this.parent.perDayWidth);else if(this.mouseMoveX<t.left+r.width+r.left-this.parent.perDayWidth)if(a=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,0===this.segmentIndex&&r.left<=0){this.parent.setRecordValue("left",t.left+a,t,!0),this.parent.setRecordValue("width",t.width-a,t,!0),r.width=r.width-a;for(o=1;o<t.segments.length;o++){var d=i[o];d.left=d.left-a}}else r.left<r.left+r.width&&r.left+a<=r.left+r.width&&(r.left=r.left+a,r.width=r.width-a);else if(this.mouseMoveX<t.left+r.left+r.width&&r.width>this.parent.perDayWidth)if(a=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,a-=r.width-a<this.parent.perDayWidth?this.parent.perDayWidth>r.width?this.parent.perDayWidth-r.width:r.width-this.parent.perDayWidth:0,0===this.segmentIndex){this.parent.setRecordValue("width",t.width-a,t,!0),this.parent.setRecordValue("left",t.left+a,t,!0),r.width=r.width-a;for(o=1;o<t.segments.length;o++){var h=i[o];h.left=h.left-a}}else r.left=r.left+a,r.width=r.width-a;this.parent.setRecordValue("segments",i,t,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")},i.prototype.updateEditPosition=function(e,t){this.updateIsMilestone(t),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(t.width,t.progress),t,!0)},i.prototype.updateIsMilestone=function(t){t.width<=3?(this.parent.setRecordValue("width",3,t,!0),this.parent.setRecordValue("isMilestone",!0,t,!0),(0,e.isNullOrUndefined)(this.taskBarEditRecord[this.parent.taskFields.milestone])||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,this.taskBarEditRecord,!0)):(this.parent.setRecordValue("width",t.width,t,!0),this.parent.setRecordValue("isMilestone",!1,t,!0),(0,e.isNullOrUndefined)(this.taskBarEditRecord[this.parent.taskFields.milestone])||this.parent.setRecordValue(this.parent.taskFields.milestone,!1,this.taskBarEditRecord,!0))},i.prototype.enableRightResizing=function(t){var i=this.taskBarEditRecord.ganttProperties,r=0;if(this.taskBarEditElement.classList.contains("e-segmented-taskbar")){var a=this.taskBarEditRecord.ganttProperties.segments.map((function(e){return yi({},e)})),n=a[this.segmentIndex];if(this.mouseDownX>this.mouseMoveX){if(this.mouseMoveX>i.left+n.left&&this.mouseDownX-this.mouseMoveX>3)r=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,n.width=n.width-r;else if(this.mouseMoveX<i.left+n.left){var s=this.parent.timelineModule.isSingleTier&&("Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit||"Hour"===this.parent.timelineModule.customTimelineSettings.topTier.unit||"Minutes"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit||"Minutes"===this.parent.timelineModule.customTimelineSettings.topTier.unit)||"Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit||"Minutes"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit?this.parent.timelineModule.customTimelineSettings.timelineUnitSize:this.parent.perDayWidth;n.width=s}}else this.mouseMoveX>n.left&&(r=(0,e.isNullOrUndefined)(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,n.width=n.width+r);var o=void 0,l=this.segmentIndex!==a.length-1?a[this.segmentIndex+1]:null;(0,e.isNullOrUndefined)(l)||(this.taskBarEditElement.classList.contains("e-segment-last")||(o=n.left+n.width>l.left?l.left-n.left:n.width),n.width=o),this.segmentIndex===i.segments.length-1&&0===this.segmentIndex&&this.parent.setRecordValue("width",n.width,i,!0),this.parent.setRecordValue("segments",a,i,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")}else this.mouseDownX>this.mouseMoveX?this.mouseMoveX>i.left&&this.mouseDownX-this.mouseMoveX>3?(r=this.mouseDownX-this.mouseMoveX,this.parent.setRecordValue("width",this.previousItem.width-r,i,!0)):this.mouseMoveX<i.left&&this.parent.setRecordValue("width",3,i,!0):this.mouseMoveX>i.left&&(r=this.mouseMoveX-this.mouseDownX,this.parent.setRecordValue("width",this.previousItem.width+r,i,!0)),this.updateEditPosition(t,i)},i.prototype.updateEditedItem=function(){var t,i,r,a,n=this.taskBarEditRecord.ganttProperties;switch(this.taskBarEditAction){case"ProgressResizing":this.parent.setRecordValue("progress",this.getProgressPercent(n.width,n.progressWidth),n,!0);break;case"LeftResizing":-1===this.segmentIndex?(t=this.getRoundOffStartLeft(n,this.roundOffDuration),i=this.getDateByLeft(t),(0,e.isNullOrUndefined)(n.endDate)&&(r=this.parent.dateValidationModule.getValidEndDate(n),this.parent.setRecordValue("endDate",r,n,!0)),a=this.parent.dateValidationModule.checkStartDate(i,n,null),this.parent.setRecordValue("startDate",new Date(a.getTime()),n,!0),0===this.parent.dateValidationModule.compareDates(n.startDate,n.endDate)&&(0,e.isNullOrUndefined)(n.isMilestone)&&!1===n.isMilestone&&0===n.duration&&this.parent.setRecordValue("duration",1,n,!0),n.isMilestone&&this.parent.setRecordValue("endDate",new Date(a.getTime()),n,!0),this.parent.dateValidationModule.calculateDuration(this.taskBarEditRecord),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration")):this.updateSplitLeftResize(n);break;case"RightResizing":case"ParentResizing":if(-1===this.segmentIndex){t=this.getRoundOffEndLeft(n,this.roundOffDuration);var s=this.getDateByLeft(t);(0,e.isNullOrUndefined)(n.startDate)&&(a=this.parent.dateValidationModule.getValidStartDate(n),this.parent.setRecordValue("startDate",a,n,!0));var o=(0,e.isNullOrUndefined)(n.startDate)?a:n.startDate;r=n.isMilestone?o:this.parent.dateValidationModule.checkEndDate(s,this.taskBarEditRecord.ganttProperties),this.parent.setRecordValue("endDate",new Date(r.getTime()),n,!0),this.parent.dateValidationModule.calculateDuration(this.taskBarEditRecord),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration")}else this.updateSplitRightResizing(n);break;case"ParentDrag":case"ChildDrag":case"MilestoneDrag":case"ManualParentDrag":-1===this.segmentIndex||0===this.segmentIndex||-1!==this.segmentIndex&&this.parent.allowTaskbarDragAndDrop?this.updateChildDrag(n):this.setSplitTaskDrag(n)}(0,e.isNullOrUndefined)(this.taskBarEditRecord.ganttProperties.segments)||this.parent.chartRowsModule.updateSegment(this.taskBarEditRecord.ganttProperties.segments,this.taskBarEditRecord.ganttProperties.taskId)},i.prototype.updateChildDrag=function(t){var i,r=this.getRoundOffStartLeft(t,this.roundOffDuration),a=this.getDateByLeft(r,t.isMilestone,t);0===this.segmentIndex?(this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(a,t,null),t,!0),t.segments[0].startDate=a,t.segments[0].endDate=this.parent.dataOperation.getEndDate(t.segments[0].startDate,t.segments[0].duration,t.durationUnit,t,!1),this.parent.setRecordValue("segments",t.segments,t,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments"),this.parent.chartRowsModule.incrementSegments(t.segments,0,this.taskBarEditRecord),this.parent.setRecordValue("endDate",t.segments[t.segments.length-1].endDate,t,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,t.segments,this.taskBarEditRecord,!0)):!(0,e.isNullOrUndefined)(t.endDate)&&(0,e.isNullOrUndefined)(t.startDate)?(i=this.parent.dateValidationModule.checkStartDate(a,t,null),i=this.parent.dateValidationModule.checkEndDate(i,this.taskBarEditRecord.ganttProperties),this.parent.setRecordValue("endDate",i,t,!0)):(this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(a,t,null),t,!0),(0,e.isNullOrUndefined)(t.duration)||this.parent.dateValidationModule.calculateEndDate(this.taskBarEditRecord))},i.prototype.updateSplitLeftResize=function(t){var i=t.segments[this.segmentIndex],r=0===this.segmentIndex?this.getRoundOffStartLeft(t,this.roundOffDuration):this.getRoundOffStartLeft(i,this.roundOffDuration),a=this.getDateByLeft(r),n=this.parent.dataOperation.checkStartDate(a,t,!1),s=this.parent.dataOperation.getDuration(n,i.endDate,t.durationUnit,t.isAutoSchedule,t.isMilestone);if(i.startDate=new Date(n.getTime()),i.duration=s,this.parent.setRecordValue("duration",this.sumOfDuration(t.segments),t,!0),0===this.segmentIndex&&this.parent.setRecordValue("startDate",i.startDate,t,!0),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration"),!(0,e.isNullOrUndefined)(t.segments[this.segmentIndex-1])){var o=this.parent.dataOperation.getDuration(t.segments[this.segmentIndex-1].endDate,t.segments[this.segmentIndex].startDate,t.durationUnit,t.isAutoSchedule,t.isMilestone);i.offsetDuration=o}this.parent.setRecordValue("segments",t.segments,t,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")},i.prototype.updateSplitRightResizing=function(t){var i=t.segments[this.segmentIndex],r=this.getRoundOffEndLeft(t,this.roundOffDuration),a=this.getDateByLeft(r),n=this.parent.dataOperation.checkEndDate(a,t,!1),s=this.parent.dataOperation.getDuration(i.startDate,n,t.durationUnit,t.isAutoSchedule,t.isMilestone);if(i.endDate=new Date(n.getTime()),i.duration=s,!(0,e.isNullOrUndefined)(t.segments[this.segmentIndex+1])){var o=t.segments[this.segmentIndex+1],l=this.parent.dataOperation.getDuration(t.segments[this.segmentIndex].endDate,o.startDate,t.durationUnit,t.isAutoSchedule,t.isMilestone);i.offsetDuration=l}this.parent.setRecordValue("segments",t.segments,t,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments"),this.parent.setRecordValue("duration",this.sumOfDuration(t.segments),t,!0),this.parent.setRecordValue("endDate",t.segments[t.segments.length-1].endDate,t,!0),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration")},i.prototype.sumOfDuration=function(e){for(var t=0,i=0;i<e.length;i++){t+=e[i].duration}return t},i.prototype.setSplitTaskDrag=function(t){var i=t.segments[this.segmentIndex],r=this.getRoundOffStartLeft(i,this.roundOffDuration),a=this.getDateByLeft(r);a=this.parent.dateValidationModule.checkStartDate(a,t,null),i.startDate=a;var n=this.parent.dataOperation.getEndDate(i.startDate,i.duration,t.durationUnit,t,!1);if(t.segments[this.segmentIndex+1]&&n.getTime()>t.segments[this.segmentIndex+1].startDate.getTime()?i.endDate=t.segments[this.segmentIndex+1].startDate:i.endDate=n,i.duration=this.parent.dataOperation.getDuration(i.startDate,i.endDate,t.durationUnit,t.isAutoSchedule,t.isMilestone),this.parent.setRecordValue("duration",this.sumOfDuration(t.segments),t,!0),this.parent.setRecordValue("endDate",t.segments[t.segments.length-1].endDate,t,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.endDate)||this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"endDate"),!(0,e.isNullOrUndefined)(t.segments[this.segmentIndex-1])){var s=this.parent.dataOperation.getDuration(t.segments[this.segmentIndex-1].endDate,t.segments[this.segmentIndex].startDate,t.durationUnit,t.isAutoSchedule,t.isMilestone);1!==i.startDate.getDay()||0!==s||this.parent.includeWeekend||(s=1),i.offsetDuration=s}if(!(0,e.isNullOrUndefined)(t.segments[this.segmentIndex+1])){var o=t.segments[this.segmentIndex+1];s=this.parent.dataOperation.getDuration(t.segments[this.segmentIndex].endDate,o.startDate,t.durationUnit,t.isAutoSchedule,t.isMilestone);1!==o.startDate.getDay()||0!==s||this.parent.includeWeekend||(s=1),o.offsetDuration=s}this.parent.setRecordValue("segments",t.segments,t,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")},i.prototype.getRoundOffEndLeft=function(e,t){var i="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier,r=e.width+e.left;if(-1!==this.segmentIndex){var a=e.segments[this.segmentIndex];r=r-e.width+a.width+a.left}var n=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(r),1,"Day")/864e5),s=this.parent.perDayWidth-this.parent.perDayWidth/n,o=s/this.parent.perDayWidth;if(void 0===t&&(t=!1),t){if(t)if("Hour"===i){var l=this.parent.perDayWidth/24;n=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(r),1,"Hour")/36e5),0!==(s=this.parent.perDayWidth/24-this.parent.perDayWidth/24/n)&&(r=r-s+l)}else if("Minutes"===i){var d=this.parent.perDayWidth/1440;n=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(r),1,"Minutes")/6e4),0!==(s=this.parent.perDayWidth/1440-this.parent.perDayWidth/1440/n)&&(r=r-s+d)}else 0!==s&&(r=r-s+this.parent.perDayWidth)}else"Hour"!==i&&"Minutes"!==i&&(o>.5?r=r-s+this.parent.perDayWidth:o<.5&&(r=r-s+this.parent.perDayWidth/2));return r},i.prototype.getRoundOffStartLeft=function(t,i){var r=((0,e.isNullOrUndefined)(t),t.left);-1!==this.segmentIndex&&(0,e.isNullOrUndefined)(t.segments)&&(r=t.left+this.taskBarEditRecord.ganttProperties.left);var a="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier,n=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(r,(0,e.isNullOrUndefined)(t)?t.isMilestone:null,t),1,"Day")/864e5),s=this.parent.perDayWidth-this.parent.perDayWidth/n,o=s/this.parent.perDayWidth;return void 0===i&&(i=!1),i?i&&("Hour"===a?(n=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(r),1,"Hour")/36e5),r-=s=this.parent.perDayWidth/24-this.parent.perDayWidth/24/n):"Minutes"===a?(n=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(r),1,"Minutes")/6e4),r-=s=this.parent.perDayWidth/1440-this.parent.perDayWidth/1440/n):r-=s):"Hour"!==a&&"Minutes"!==a&&(o<=.5?r-=s:o>.5&&(r=r-s+this.parent.perDayWidth/2)),r},i.prototype.getDateByLeft=function(t,i,r){var a=new Date(this.parent.timelineModule.timelineStartDate.toString()),n=864e5/this.parent.perDayWidth;if(a.setTime(a.getTime()+t*n),i&&!(0,e.isNullOrUndefined)(r.predecessorsName)&&""!==r.predecessorsName){var s=this.parent.getCurrentDayEndTime(r.isAutoSchedule?r.autoEndDate:r.endDate);this.parent.dateValidationModule.setTime(s,a),a=this.parent.dateValidationModule.checkStartDate(a,r,!0)}var o="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.topTier:this.parent.timelineModule.bottomTier;return"Hour"!==o&&"Minutes"!==o&&this.parent.isInDst(new Date(this.parent.timelineModule.timelineStartDate.toString()))&&!this.parent.isInDst(a)&&a.setTime(a.getTime()+36e5),a},i.prototype.setItemPosition=function(){if(!(0,e.isNullOrUndefined)(this.editElement)){var t=this.editElement.parentElement;this.parent.allowTaskbarDragAndDrop&&"ChildDrag"===this.taskBarEditAction?t.style.position=null:this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?t.style.setProperty("position","relative"):t.style.setProperty("position","absolute")}var i,r=this.taskBarEditRecord.ganttProperties,a=this.parent.enableRtl?"right":"left",n=(0,e.isNullOrUndefined)(r.segments)?null:r.segments[this.segmentIndex],s="MilestoneDrag"===this.taskBarEditAction||r.isMilestone?this.parent.chartRowsModule.milestoneHeight:r.width,o=this.parent.isAdaptive?s-2:s-10;(0,e.isNullOrUndefined)(n)||(o=this.parent.isAdaptive?n.width-2:n.width-10),this.taskBarEditElement.style.setProperty("opacity",".75"),i=this.parent.allowTaskbarDragAndDrop&&!r.isAutoSchedule&&this.taskBarEditRecord.hasChildRecords||this.taskBarEditElement.classList.contains(V)?this.taskBarEditElement:"ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||0!==this.segmentIndex?(0,e.closest)(this.taskBarEditElement,"tr."+Z).querySelector("."+V):this.taskBarEditElement.parentElement;var l=!(!this.taskBarEditElement.classList.contains("e-segmented-taskbar")&&!this.taskBarEditElement.querySelector(".e-segmented-taskbar")),d=this.taskBarEditElement.querySelector("."+re),h=this.taskBarEditElement.querySelector("."+ie),p=this.taskBarEditElement.querySelector("."+Q),u=this.taskBarEditElement.querySelector("."+Y),c=this.taskBarEditElement.querySelector("."+de),g=this.taskBarEditElement.querySelector("."+he),f=this.taskBarEditElement.querySelector("."+xe),m=i.querySelector("."+xe),y=this.taskBarEditElement,D=this.taskBarEditElement.querySelector("."+ne),v=this.taskBarEditElement.querySelector("."+le),k=this.taskBarEditElement.querySelector(".e-gantt-manualparenttaskbar-left"),w=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-taskbar-resize-div");if(this.parent.allowTaskbarDragAndDrop&&!this.updatePosition&&(this.leftValue=this.leftValue+30,this.updatePosition=!0),"ConnectorPointRightDrag"!==this.taskBarEditAction&&"ConnectorPointLeftDrag"!==this.taskBarEditAction){if("ParentResizing"!==this.taskBarEditAction&&"ManualParentDrag"!==this.taskBarEditAction){if(!l||(0,e.isNullOrUndefined)(r.segments)||"RightResizing"!==this.taskBarEditAction&&0===this.segmentIndex||((0,e.isNullOrUndefined)(w)||(!this.parent.allowTaskbarDragAndDrop||this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"ChildDrag"!==this.taskBarEditAction&&"ParentDrag"!==this.taskBarEditAction)&&(w.style.width=n.width+"px"),this.taskBarEditElement.style.width=n.width+"px",this.parent.enableRtl?this.taskBarEditElement.style.right=n.left+"px":(this.taskBarEditElement.style.left=n.left+"px",(0,e.isNullOrUndefined)(w)||(!this.parent.allowTaskbarDragAndDrop||this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"ChildDrag"!==this.taskBarEditAction&&"ParentDrag"!==this.taskBarEditAction)&&(w.style.left=n.left+this.editElement.parentElement.offsetLeft+"px"))),i.style.setProperty(a,(this.parent.allowTaskbarDragAndDrop?this.leftValue:r.left)+"px"),i.style.width=s+"px",l&&m&&(m.style.left=(this.parent.isAdaptive?s+10:s+2)+"px"),this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction){var b=this.parent.taskbarHeight/2;i.style.setProperty("top",this.topValue+b+"px"),i.style.zIndex="4"}if("LeftResizing"===this.taskBarEditAction&&0===this.segmentIndex){this.taskBarEditElement.style.setProperty("opacity",".75");for(var T=this.taskBarEditElement.parentElement.getElementsByClassName("e-segmented-taskbar"),P=0;P<r.segments.length;P++){var S=r.segments[P],C=T[P];C.style.width=S.width+"px",0===P&&(w.style.width=S.width+"px",w.style.setProperty(a,S.left+r.left+"px")),this.parent.enableRtl?C.style.right=S.left+"px":C.style.left=S.left+"px"}}"ChildDrag"===this.taskBarEditAction&&(0===this.segmentIndex||-1!==this.segmentIndex&&this.parent.allowTaskbarDragAndDrop)&&(w.style.width=s+"px",w.style.setProperty(a,r.left+"px"),i.style.setProperty("opacity",".75"))}if(f&&(this.parent.enableRtl?f.style.left=(this.parent.isAdaptive?s+10:s-2)+"px":f.style.left=(this.parent.isAdaptive?s+10:s+2)+"px"),f&&"LeftResizing"===this.taskBarEditAction&&(f.style.left=s-2+"px"),p&&d&&("LeftResizing"===this.taskBarEditAction||"RightResizing"===this.taskBarEditAction||"ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction)&&(p.style.display="none",d.style.display="none"),f&&"ProgressResizing"===this.taskBarEditAction&&(f.style.display="none"),"MilestoneDrag"===this.taskBarEditAction||r.isMilestone)i.style.setProperty(a,(this.parent.allowTaskbarDragAndDrop?this.leftValue:r.left-s/2)+"px"),w.style.setProperty(a,r.left-s/2+"px"),w.style.width=s+"px";else if("ProgressResizing"===this.taskBarEditAction)if(-1===this.segmentIndex){if(h.style.setProperty(a,r.left+r.progressWidth-10+"px"),!(0,e.isNullOrUndefined)(d)){d.style.width=r.progressWidth+"px",d.style.borderBottomRightRadius=this.progressBorderRadius+"px",d.style.borderTopRightRadius=this.progressBorderRadius+"px";var R=this.parent.enableRtl?r.progressWidth+8:r.progressWidth-8;p.style.setProperty(a,R+"px")}}else{this.updateSegmentProgress(this.taskBarEditRecord.ganttProperties),d.style.width=r.segments[this.segmentIndex].progressWidth+"px",d.style.borderBottomRightRadius=this.progressBorderRadius+"px",d.style.borderTopRightRadius=this.progressBorderRadius+"px";var M=this.parent.enableRtl?r.segments[this.segmentIndex].progressWidth+8:r.segments[this.segmentIndex].progressWidth-8;p.style.setProperty(a,M+"px")}else"RightResizing"!==this.taskBarEditAction||(0,e.isNullOrUndefined)(h)?"ParentDrag"===this.taskBarEditAction?(w.style.setProperty(a,r.left+"px"),w.style.width=s+"px",w.style.width=r.width+"px",(0,e.isNullOrUndefined)(c)||(c.style.width=s+"px",w.style.width=r.width+"px"),(0,e.isNullOrUndefined)(d)||(g.style.width=r.progressWidth+"px")):"ParentResizing"===this.taskBarEditAction?(w.style.width=r.width+"px",w.style.setProperty(a,r.left+"px"),y.style.width=D.style.width=r.width+"px",v.style.setProperty(a,r.width-k.offsetLeft+"px")):"ManualParentDrag"===this.taskBarEditAction?(w.style.width=r.width+"px",w.style.setProperty(a,r.left+"px"),y.style.setProperty(a,r.left-r.autoLeft+"px"),this.parent.allowTaskbarDragAndDrop&&(y.style.setProperty(a,this.leftValue+"px"),y.style.setProperty("top",this.topValue+"px"),y.style.zIndex="4")):((0,e.isNullOrUndefined)(h)||l||(h.style.width=r.width+"px",h.style.left=r.left+"px",this.taskBarEditElement.style.width=r.width+"px",this.taskBarEditElement.style.left=(this.parent.allowTaskbarDragAndDrop?this.leftValue:r.left)+"px",w.style.setProperty(a,r.left+"px"),w.style.width=r.width+"px"),(0,e.isNullOrUndefined)(d)||(u.style.setProperty(a,o+"px"),d.style.width=r.progressWidth+"px",(0,e.isNullOrUndefined)(p)||p.style.setProperty(a,r.progressWidth-10+"px")),l&&(u.style.setProperty(a,o+"px"),d.style.width=n.width+"px",(0,e.isNullOrUndefined)(p)||p.style.setProperty(a,n.width-10+"px"))):(w.style.width=s+"px",h.style.width=s+"px",(0,e.isNullOrUndefined)(d)||(d.style.width=r.progressWidth+"px",u.style.setProperty(a,o+"px"),(0,e.isNullOrUndefined)(p)||p.style.setProperty(a,r.progressWidth-10+"px")))}if(this.parent.allowTaskbarDragAndDrop&&("ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction)){var x=this.parent.enableRtl?parseInt(w.style.right,10):parseInt(w.style.left,10);this.parent.enableRtl?w.style.right=x-30+"px":w.style.left=x+30+"px"}},i.prototype.mouseUpHandler=function(t){var i=this.isMouseDragged;if(this.previousMouseMove=null,this.editTooltip.showHideTaskbarEditTooltip(!1,this.segmentIndex),this.taskBarEditAction&&this.isMouseDragged)if(!this.dragMouseLeave&&this.taskBarEditedAction||this.parent.allowTaskbarDragAndDrop){if("touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type){var r=this.getCoordinate(t);this.droppedTarget=document.elementFromPoint(r.pageX,r.pageY)}else{if(this.taskBarEditRecord.hasChildRecords&&!this.taskBarEditRecord.ganttProperties.isAutoSchedule){var a=this.parent.getOffsetRect(this.taskBarEditElement),n=!(0,e.isNullOrUndefined)(document.body.className)&&document.body.className.includes("e-bigger")?12:0,s=3+this.parent.chartRowsModule.connectorPointWidth+n,o=void 0;o=this.parent.enableRtl?Math.abs(a.left+s+1):Math.abs(Math.abs(a.left-s-1)-this.parent.ganttChartModule.scrollElement.scrollLeft),this.droppedTarget=document.elementFromPoint(o,t.y)}else this.droppedTarget=document.elementFromPoint(t.x,t.y);this.droppedTarget&&this.droppedTarget.classList.contains("e-span-label")&&(this.droppedTarget=document.elementFromPoint(t.x+this.droppedTarget.offsetWidth,t.y))}this.previousIds=this.parent.ids.slice(),this.previousFlatData=this.parent.flatData.slice(),this.taskBarEditedAction(t),this.isMouseDragged=!1}else if(this.parent.isOnEdit=!1,this.cancelTaskbarEditActionInMouseLeave(),this.parent.enableCriticalPath&&this.parent.criticalPathModule){var l=this.parent.criticalPathModule;l.criticalConnectorLine(l.criticalPathCollection,l.detailPredecessorCollection,!0,l.predecessorCollectionTaskIds)}this.parent.enableMultiTaskbar&&!(0,e.isNullOrUndefined)(this.taskBarEditElement)&&((0,e.isNullOrUndefined)(this.taskBarEditElement.querySelector(".e-gantt-child-taskbar"))||this.taskBarEditElement.querySelector(".e-gantt-child-taskbar").classList.contains("e-collapsed-taskbar-drag")&&((0,e.removeClass)([this.taskBarEditElement.querySelector(".e-gantt-child-taskbar")],"e-collapsed-taskbar-drag"),this.taskBarEditElement.style.zIndex=this.prevZIndex,this.prevZIndex="")),this.parent.isAdaptive&&!i||this.initPublicProp(),this.stopScrollTimer()},i.prototype.taskBarEditedAction=function(t){var i={},r=this.mouseDownX,a=this.mouseDownY,n=this.taskBarEditRecord,s=this.parent.ganttChartModule.getIndexByTaskBar(this.taskBarEditElement),o=this.mouseMoveX,l=this.getCoordinate(t).pageY-this.parent.ganttChartModule.chartBodyContainer.offsetTop;"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||this.drawPredecessor||(this.dependencyCancel=!0);var d=[];("ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction)&&this.drawPredecessor&&(!this.connectorSecondRecord.hasChildRecords||this.connectorSecondRecord.hasChildRecords&&this.parent.allowParentDependency)?(d.push((0,e.extend)([],[],[this.taskBarEditRecord],!0)[0]),this.parent.undoRedoModule&&(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1].connectedRecords=d,this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0)),this.parent.connectorLineEditModule.updatePredecessor(this.connectorSecondRecord,this.finalPredecessor)):("ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction||this.oldData&&JSON.stringify(n.ganttProperties)===JSON.stringify(this.oldData.ganttProperties)?this.parent.undoRedoModule&&this.parent.undoRedoModule.getUndoCollection.length>0&&(this.parent.totalUndoAction--,this.parent.undoRedoModule.getUndoCollection.splice(this.parent.undoRedoModule.getUndoCollection.length-1,1),this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1)):this.parent.undoRedoModule&&this.parent.toolbarModule&&this.parent.undoRedoModule.getUndoCollection.length>0&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),(r!==o||Math.abs(a-l)>=(this.parent.rowHeight-this.parent.taskbarHeight)/2)&&null!==n&&(i.editingFields=n.ganttProperties,i.data=n,i.recordIndex=s,i.previousData=this.previousItem,i.taskBarEditAction=this.taskBarEditAction,i.action="TaskbarEditing",i.roundOffDuration=this.roundOffDuration,i.target=this.targetElement,this.taskbarEditedArgs=i,this.taskbarEdited(i))),this.parent.isProjectDateUpdated=!1},i.prototype.cancelTaskbarEditActionInMouseLeave=function(){this.parent.editModule.reUpdatePreviousRecords(!0)},i.prototype.updateSegmentProgress=function(e){for(var t=e.segments,i=!0,r=this.splitTasksDuration(t)*this.parent.perDayWidth,a=this.parent.dataOperation.getProgressWidth(r,e.progress),n=0;n<t.length;n++){var s=t[n];delete s.progressWidth,a>0&&a>s.width?(a-=s.width,s.progressWidth=s.width,s.showProgress=!1):i&&(s.progressWidth=a,s.showProgress=!0,a-=s.width,i=!1)}},i.prototype.taskbarEdited=function(t){var i=(0,e.extend)({},t),r=i.data,a=r.ganttProperties,n=this.parent.flatData.indexOf(r);if(this.parent.allowTaskbarDragAndDrop&&this.dragMoveY>0&&("ResourceView"===this.parent.viewType&&!r.hasChildRecords||"ProjectView"===this.parent.viewType)){if(this.parent.rowDragAndDropModule){var s=this.parent.currentViewData;this.taskBarEditRecord.parentItem&&s[this.taskBarEditRecord.parentItem.index]&&-1===this.parent.editedRecords.indexOf(s[this.taskBarEditRecord.parentItem.index])&&this.parent.editedRecords.push(s[this.taskBarEditRecord.parentItem.index]),this.removeChildBorder(),this.removeErrorElem(),this.removetopOrBottomBorder();var o=void 0;this.updatePosition=!1,this.draggedRecordMarginTop=this.taskBarEditElement.style.marginTop;var l=(0,e.closest)(this.droppedTarget,"tr."+Z);if(l){var d=parseInt(l.getAttribute("data-rowindex"),10);o=this.parent.flatData[d];var h=this.parent.getRootParent(o,0).index,p=this.parent.getRootParent(this.taskBarEditRecord,0).index,u={cancel:!1,data:this.taskBarEditRecord,fromIndex:this.taskBarEditRecord.index,dropIndex:o.index,dropPosition:this.parent.rowDragAndDropModule.dropPosition,dropRecord:o};if(this.parent.trigger("rowDrop",u),!u.cancel&&o&&d!==n&&(h!==p||this.taskBarEditRecord.hasChildRecords&&o.hasChildRecords||!this.taskBarEditRecord.hasChildRecords)){var c=this.parent.flatData.indexOf(o),g=void 0;g=("ProjectView"!==this.parent.viewType||(0,e.isNullOrUndefined)(this.parent.rowDragAndDropModule.dropPosition))&&(o.hasChildRecords||!o.parentItem&&0===o.childRecords.length)?"child":this.parent.rowDragAndDropModule.dropPosition,this.parent.rowDragAndDropModule&&("ResourceView"!==this.parent.viewType||"child"!==g||o.hasChildRecords||(0,e.isNullOrUndefined)(o.parentItem)||(g="Invalid",this.parent.rowDragAndDropModule.dropPosition="Invalid"),g&&this.parent.rowDragAndDropModule.reorderRows([n],c,g)),this.dragMoveY=0}}this.isClonedElement=!1}this.parent.showOverAllocation&&this.parent.ganttChartModule.renderOverAllocationContainer()}if("ProgressResizing"===i.taskBarEditAction)i.previousData.progress!==a.progress&&(this.parent.setRecordValue("progress",this.getProgressPercent(a.width,a.progressWidth),a,!0),r.parentItem&&this.parent.editModule.updateParentProgress(r.parentItem),(0,e.isNullOrUndefined)(a.segments)||this.updateSegmentProgress(a));else{var f=i.data.ganttProperties.segments;if(!(0,e.isNullOrUndefined)(f)&&f.length>0&&("LeftResizing"===this.taskBarEditAction&&0!==this.segmentIndex||"ChildDrag"===this.taskBarEditAction&&0!==this.segmentIndex||"RightResizing"===this.taskBarEditAction)){var m=f[this.segmentIndex],y=this.taskBarEditRecord.ganttProperties,D=0===this.segmentIndex?null:f[this.segmentIndex-1],v=this.segmentIndex===f.length-1?null:f[this.segmentIndex+1],k=(0,e.isNullOrUndefined)(v)?this.parent.cloneProjectEndDate:new Date(v.startDate.getTime()),w=(0,e.isNullOrUndefined)(D)?this.parent.cloneProjectStartDate:new Date(D.endDate.getTime()),b=new Date(m.startDate.getTime()),T=new Date(m.endDate.getTime());if("Day"===this.parent.timelineModule.topTier&&"Hour"===this.parent.timelineModule.bottomTier?(b.setHours(b.getHours()-1),T.setHours(T.getHours()+1)):(b.setDate(b.getDate()),T.setDate(T.getDate())),this.parent.includeWeekend){if(k.setHours(0,0,0,0),w.setHours(0,0,0,0),b.setDate(b.getDate()-1),T.setDate(T.getDate()+1),b.setHours(0,0,0,0),T.setHours(0,0,0,0),b.getTime()<=w.getTime()&&!(0,e.isNullOrUndefined)(D)&&!(0,e.isNullOrUndefined)(m)){var P=[{firstSegmentIndex:D.segmentIndex,secondSegmentIndex:m.segmentIndex}];this.parent.chartRowsModule.mergeTask(y.taskId,P)}else if(T.getTime()>=k.getTime()&&this.segmentIndex!==f.length-1){P=[{firstSegmentIndex:m.segmentIndex,secondSegmentIndex:v.segmentIndex}];this.parent.chartRowsModule.mergeTask(y.taskId,P)}else if(T.getTime()>=k.getTime()){m.endDate.setDate(this.parent.cloneProjectEndDate.getDate()-1),m.startDate=this.parent.dataOperation.getStartDate(m.endDate,m.duration,y.durationUnit,y);for(var S=f.length-2;S>=0;S++){var C=f[S],R=C.endDate;R.setDate(R.getDate()-C.offsetDuration),C.endDate=R,C.startDate=this.parent.dataOperation.getStartDate(C.endDate,C.duration,y.durationUnit,y)}}}else if(T.getTime()<=k.getTime()&&this.segmentIndex!==f.length-1&&!this.parent.includeWeekend&&0===this.parent.dataOperation.getDuration(this.parent.dataOperation.checkStartDate(T,a,!1),k,a.durationUnit,!1,!1)){P=[{firstSegmentIndex:m.segmentIndex,secondSegmentIndex:v.segmentIndex}];this.parent.chartRowsModule.mergeTask(y.taskId,P)}else if(b.getTime()>=w.getTime()&&!(0,e.isNullOrUndefined)(D)&&!(0,e.isNullOrUndefined)(m)&&!this.parent.includeWeekend&&0===this.parent.dataOperation.getDuration(this.parent.dataOperation.checkEndDate(b,a,!1),w,a.durationUnit,!1,!1)){P=[{firstSegmentIndex:D.segmentIndex,secondSegmentIndex:m.segmentIndex}];this.parent.chartRowsModule.mergeTask(y.taskId,P)}}this.parent.dataOperation.updateWidthLeft(i.data)}this.isDragged=!1,this.parent.dataOperation.updateTaskData(r),this.parent.editModule.initiateUpdateAction(i)},i.prototype.getProgressPercent=function(e,t){return Math.ceil(t/e*100)},i.prototype.drawFalseLine=function(){var t,i=this.mouseDownX,r=this.mouseDownY,a=this.mouseMoveX,n=this.mouseMoveY,s=Math.sqrt((i-a)*(i-a)+(r-n)*(r-n)),o=180*Math.atan2(n-r,a-i)/Math.PI,l="rotate("+(this.parent.enableRtl?-o:o)+"deg)",d=0;(0,e.isNullOrUndefined)(document.querySelectorAll(".e-chart-row")[0])||(d=document.querySelectorAll(".e-chart-row")[0].offsetWidth),"ConnectorPointLeftDrag"===this.taskBarEditAction&&(t=this.parent.enableRtl?d-(this.elementOffsetLeft+this.parent.chartRowsModule.connectorPointWidth/2)-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left):this.elementOffsetLeft-this.parent.chartRowsModule.connectorPointWidth/2-this.parent.ganttChartModule.scrollObject.previousScroll.left),"ConnectorPointRightDrag"===this.taskBarEditAction&&(t=this.parent.enableRtl?d-(this.elementOffsetLeft+this.elementOffsetWidth+this.parent.chartRowsModule.connectorPointWidth/2)-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left):this.elementOffsetLeft+this.elementOffsetWidth+this.parent.chartRowsModule.connectorPointWidth/2-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left));var h=this.elementOffsetTop+this.elementOffsetHeight/2+this.parent.ganttChartModule.chartBodyContainer.offsetTop-this.parent.ganttChartModule.scrollObject.previousScroll.top;this.removeFalseLine(!1),this.falseLine=(0,e.createElement)("div",{className:"e-gantt-false-line",id:"ganttfalseline"+this.parent.element.id,styles:"position: absolute;transform:"+l+";border-top-width: 1px;border-top-style: dashed;z-index: 5;width:"+(s-3)+"px;top:"+h+"px;"}),this.parent.enableRtl?(this.falseLine.style.left="auto",this.falseLine.style.right=t+"px",this.falseLine.style.transformOrigin="100% 0%"):(this.falseLine.style.right="auto",this.falseLine.style.left=t+"px",this.falseLine.style.transformOrigin="0% 100%"),this.parent.ganttChartModule.chartBodyContainer.appendChild(this.falseLine)},i.prototype.removeFalseLine=function(t){this.falseLine&&((0,e.remove)(this.falseLine),this.falseLine=null,t&&(this.elementOffsetLeft=0,this.elementOffsetTop=0,this.elementOffsetWidth=0,this.elementOffsetHeight=0,(0,e.removeClass)(this.parent.ganttChartModule.scrollElement.querySelectorAll("."+ve),[Pe])))},i.prototype.updateConnectorLineSecondProperties=function(t){var i=this.getElementByPosition(t),r=a(i,V),n=document.body.className.includes("e-bigger");this.connectorSecondAction=null;var s=0;if(a(i,Se)?(this.connectorSecondAction="ConnectorPointLeftDrag",this.toPredecessorText="Start"):a(i,Ce)?(this.connectorSecondAction="ConnectorPointRightDrag",this.toPredecessorText="Finish"):(this.connectorSecondAction=null,this.toPredecessorText=null),this.taskBarEditElement!==r&&this.taskBarEditElement!==this.highlightedSecondElement){if(this.parent.virtualScrollModule&&this.parent.enableVirtualization)s=this.parent.virtualScrollModule.getTopPosition();(this.parent.virtualScrollModule&&this.parent.enableVirtualization&&!this.elementOffsetLeft||!this.parent.enableVirtualization)&&(this.parent.allowParentDependency&&this.taskBarEditElement.children[0].classList.contains("e-manualparent-main-container")?(this.elementOffsetLeft=this.realTaskbarElement.children[0].offsetLeft+this.realTaskbarElement.offsetLeft-(n?10:0),this.elementOffsetTop=this.realTaskbarElement.parentElement.offsetTop+this.realTaskbarElement.offsetHeight/3-5+this.taskBarEditElement.children[0].offsetTop+s):(this.elementOffsetLeft=this.realTaskbarElement.offsetLeft-(n?10:0),this.elementOffsetTop=this.realTaskbarElement.parentElement.offsetTop+this.realTaskbarElement.offsetHeight/3+s),this.elementOffsetWidth=this.realTaskbarElement.offsetWidth+(n?20:0),this.elementOffsetHeight=this.realTaskbarElement.offsetHeight),this.showHideTaskBarEditingElements(r,this.highlightedSecondElement,!0)}(0,e.isNullOrUndefined)(this.connectorSecondAction)&&!(0,e.isNullOrUndefined)(this.connectorSecondElement)&&(!this.connectorSecondRecord.hasChildRecords||this.connectorSecondRecord.hasChildRecords&&this.parent.allowParentDependency)&&(this.editTooltip.showHideTaskbarEditTooltip(!1,this.segmentIndex),(0,e.removeClass)([this.connectorSecondElement.querySelector("."+Se)],[Oe]),(0,e.removeClass)([this.connectorSecondElement.querySelector("."+Ce)],[Oe])),this.connectorSecondElement=this.connectorSecondAction?r:null,this.highlightedSecondElement=r,this.connectorSecondRecord=(0,e.isNullOrUndefined)(this.connectorSecondElement)?null:this.parent.ganttChartModule.getRecordByTaskBar(this.connectorSecondElement)},i.prototype.triggerDependencyEvent=function(t,i){var r,a=this.parent.element.closest('[style*="zoom"]');if(a){var n=parseFloat(getComputedStyle(a).zoom);r=t.pageY/n}var s,o,l=this.taskBarEditRecord.ganttProperties,d=this.connectorSecondRecord?this.connectorSecondRecord.ganttProperties:null,h=this.getElementByPosition(t),p=h,u="ResourceView"===this.parent.viewType?l.taskId:l.rowUniqueID;if("ConnectorPointLeftDrag"===this.taskBarEditAction?s=u+(this.parent.enableRtl?"F":"S"):"ConnectorPointRightDrag"===this.taskBarEditAction&&(s=u+(this.parent.enableRtl?"S":"F")),this.connectorSecondAction&&("ConnectorPointLeftDrag"===this.connectorSecondAction?(s+=this.parent.enableRtl?"F":"S",o=this.parent.enableRtl?"finish":"start"):"ConnectorPointRightDrag"===this.connectorSecondAction&&(s+=this.parent.enableRtl?"S":"F",o=this.parent.enableRtl?"start":"finish")),(0,e.isNullOrUndefined)(d))this.drawPredecessor=!1;else{d.predecessorsName?this.finalPredecessor=d.predecessorsName+","+s:this.finalPredecessor=s;var c=this.parent.connectorLineEditModule.validatePredecessorRelation(this.connectorSecondRecord,this.finalPredecessor),g=this.parent.predecessorModule.calculatePredecessor(s,this.connectorSecondRecord),f={};if(f.fromItem=l,f.toItem=d,f.newPredecessorString=this.finalPredecessor,f.predecessor=g&&g[0],f.isValidLink=c,f.requestType="ValidateDependency",this.parent.trigger("actionBegin",f),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType||"ValidateDependency"===f.requestType?"ValidateDependency"!==f.requestType&&this.parent.showSpinner():this.parent.showMaskRow(),f.isValidLink=!(!c&&f.isValidLink)&&f.isValidLink,f.isValidLink){if(this.editTooltip.toolTipObj||this.parent.isAdaptive||this.editTooltip.showHideTaskbarEditTooltip(!0,this.segmentIndex),!(0,e.isNullOrUndefined)(this.editTooltip.toolTipObj)){this.parent.connectorLineModule.tooltipTable.innerHTML=this.parent.connectorLineModule.getConnectorLineTooltipInnerTd(this.parent.editModule.taskbarEditModule.taskBarEditRecord.ganttProperties.taskName,this.parent.editModule.taskbarEditModule.fromPredecessorText,"","");var m=this.parent.connectorLineModule.tooltipTable.querySelector("#toPredecessor").querySelectorAll("td");if(m[1].innerText=d.taskName,m[2].innerText=this.parent.localeObj.getConstant(o),!(0,e.isNullOrUndefined)(this.parent.connectorLineModule.tooltipTable.parentElement)&&!(0,e.isNullOrUndefined)(this.parent.connectorLineModule.tooltipTable.parentElement.parentElement)){var y=this.parent.connectorLineModule.tooltipTable.parentElement.parentElement;y.offsetTop+y.offsetHeight>r&&(y.style.top=t.pageY-y.offsetHeight-20+"px")}}this.drawPredecessor=!0}else this.parent.isAdaptive?(h.classList.contains(Se)||h.classList.contains(Ce))&&this.showHideActivePredecessors(!0):(0,e.addClass)([p],[Oe]),this.drawPredecessor=!1}},i.prototype.getCoordinate=function(e){var t={},i=e;if(t.pageX=i.pageX,t.pageY=i.pageY,e&&"click"!==e.type){var r=e;"touchmove"!==r.type&&"touchstart"!==r.type&&"touchend"!==r.type||(t.pageX=r.changedTouches[0].pageX,t.pageY=r.changedTouches[0].pageY)}return t},i.prototype.getElementByPosition=function(e){if(this.parent.isAdaptive){var t=this.getCoordinate(e);return document.elementFromPoint(t.pageX-window.pageXOffset,t.pageY-window.pageYOffset)}return e.target},i.prototype.multipleSelectionEnabled=function(){this.parent.selectionModule&&"Cell"!==this.parent.selectionSettings.mode&&"Multiple"===this.parent.selectionSettings.type&&this.parent.selectionModule.hidePopUp()},i.prototype.unWireEvents=function(){this.parent.isDestroyed||(this.parent.off("chartMouseDown",this.mouseDownHandler),this.parent.off("chartMouseUp",this.mouseUpHandler),this.parent.off("chartMouseLeave",this.mouseLeaveHandler),this.parent.off("chartMouseMove",this.mouseMoveAction),this.parent.off("chartMouseClick",this.mouseClickHandler))},i.prototype.destroy=function(){this.unWireEvents(),this.stopScrollTimer(),this.parent.editModule.taskbarEditModule=void 0},i}(w),vi=m(215),ki=m(674),wi=m(323),bi=m(741),Ti=m(570),Pi=m(778),Si=function(){return Si=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Si.apply(this,arguments)},Ci=function(){function a(e){this.taskFieldColumn=[],this.customFieldColumn=[],this.processedId=[],this.updatedEditFields=null,this.updatedAddFields=null,this.addedRecord=null,this.dialogEditValidationFlag=!1,this.ganttResources=[],this.isValidData=!0,this.isResourceTabUpdated=!1,this.previousResource=[],this.isResourceUpdate=!1,this.parent=e,this.localeObj=this.parent.localeObj,this.beforeOpenArgs={cancel:!1},this.types=this.getPredecessorType(),this.rowData={},this.editedRecord={},this.inputs={booleanedit:bi.CheckBox,dropdownedit:Pi.DropDownList,datepickeredit:Ti.DatePicker,datetimepickeredit:Ti.DateTimePicker,maskededit:wi.MaskedTextBox,numericedit:wi.NumericTextBox,stringedit:wi.TextBox,defaultedit:wi.TextBox},this.processDialogFields(),this.wireEvents()}return a.prototype.wireEvents=function(){this.parent.on("chartDblClick",this.dblClickHandler,this)},a.prototype.dblClickHandler=function(t){var i=this.parent.ganttChartModule.getRecordByTarget(t);!(0,e.isNullOrUndefined)(i)&&this.parent.editModule&&this.parent.editSettings.allowEditing&&this.openEditDialog(i)},a.prototype.processDialogFields=function(){(0,e.isNullOrUndefined)(this.parent.editDialogFields)||this.parent.editDialogFields&&0===this.parent.editDialogFields.length?(this.updatedEditFields=this.getDefaultDialogFields(),this.updatedEditFields=this.validateDialogFields(this.updatedEditFields)):this.updatedEditFields=this.validateDialogFields(this.parent.editDialogFields),(0,e.isNullOrUndefined)(this.parent.addDialogFields)||this.parent.addDialogFields&&0===this.parent.addDialogFields.length?(this.updatedAddFields=this.getDefaultDialogFields(),this.updatedAddFields=this.validateDialogFields(this.updatedAddFields)):this.updatedAddFields=this.validateDialogFields(this.parent.addDialogFields)},a.prototype.validateDialogFields=function(t){for(var r=[],a=0,n=0;n<t.length;n++){var s=(0,i.getActualProperties)(t[n]);"General"!==s.type||!(0,e.isNullOrUndefined)(s.fields)&&0!==s.fields.length||(s.fields=this.getGeneralColumnFields()),"Dependency"===s.type&&(0,e.isNullOrUndefined)(this.parent.taskFields.dependency)||"Resources"===s.type&&(0,e.isNullOrUndefined)(this.parent.taskFields.resourceInfo)||"Notes"===s.type&&(0,e.isNullOrUndefined)(this.parent.taskFields.notes)||("Custom"!==s.type||!(0,e.isNullOrUndefined)(s.fields)&&0!==s.fields.length||(a+=1,s.fields=this.getCustomColumnFields()),a>1||r.push(s))}return r},a.prototype.getGeneralColumnFields=function(){for(var e=[],t=0,i=Object.keys(this.parent.columnMapping);t<i.length;t++){var r=i[t];"dependency"!==r&&"resourceInfo"!==r&&"notes"!==r&&e.push(this.parent.columnMapping[r])}return e},a.prototype.getCustomColumnFields=function(){for(var e=[],t=0;t<this.parent.customColumns.length;t++)e.push(this.parent.customColumns[t]);return e},a.prototype.getDefaultDialogFields=function(){var t=[],i={},r=this.parent.taskFields,a=this.parent.columnMapping;return 0!==Object.keys(a).length&&(i.type="General",t.push(i)),(0,e.isNullOrUndefined)((0,e.getValue)("dependency",a))||(i={},!1!==this.parent.columnByField[a.dependency.valueOf()].visible&&(i.type="Dependency"),t.push(i)),(0,e.isNullOrUndefined)((0,e.getValue)("resourceInfo",a))||(i={},!1!==this.parent.columnByField[a.resourceInfo.valueOf()].visible&&(i.type="Resources"),t.push(i)),(0,e.isNullOrUndefined)((0,e.getValue)("notes",a))||(i={},!1!==this.parent.columnByField[a.notes.valueOf()].visible&&(i.type="Notes"),t.push(i)),(0,e.isNullOrUndefined)((0,e.getValue)("segments",r))||((i={}).type="Segments",t.push(i)),this.parent.customColumns.length>0&&((i={}).type="Custom",t.push(i)),t},a.prototype.openAddDialog=function(){this.isEdit=!1,this.editedRecord=this.composeAddRecord(),this.isFromAddDialog=!0,this.createDialog()},a.prototype.getMinimumStartDate=function(){var t=r.DataUtil.aggregates.min(this.parent.flatData,"ganttProperties.startDate");return t=(0,e.isNullOrUndefined)(t)?new Date(this.parent.timelineModule.timelineStartDate.getTime()):new Date(t.getTime()),t=this.parent.dateValidationModule.checkStartDate(t),new Date(t.getTime())},a.prototype.composeAddRecord=function(){for(var t={ganttProperties:{}},i=this.parent.ganttColumns,r=this.parent.taskFields,a=this.parent.editModule.getNewTaskId(),n=0;n<i.length;n++){var s=i[n].field;s===r.id?(t[s]=a,t.ganttProperties.rowUniqueID=t[s]):i[n].field===r.startDate?((0,e.isNullOrUndefined)(t[r.endDate])?t[s]=this.getMinimumStartDate():t[s]=new Date(t[r.endDate]),this.parent.timezone&&(t[s]=this.parent.dateValidationModule.remove(t[s],this.parent.timezone)),t.ganttProperties.startDate=new Date(t[s])):i[n].field===r.endDate?((0,e.isNullOrUndefined)(t[r.startDate])?t[s]=this.getMinimumStartDate():t[s]=new Date(t[r.startDate]),this.parent.timezone&&(t[s]=this.parent.dateValidationModule.remove(t[s],this.parent.timezone)),t.ganttProperties.endDate=new Date(t[s])):i[n].field===r.duration?(t[s]=1,t.ganttProperties.duration=t[s],t.ganttProperties.durationUnit=this.parent.durationUnit.toLocaleLowerCase()):i[n].field===r.name?(t[s]=this.localeObj.getConstant("addDialogTitle")+" "+a,t.ganttProperties.taskName=t[s]):i[n].field===r.progress?(t[s]=0,t.ganttProperties.progress=t[s]):i[n].field===r.work?(t[s]=0,t.ganttProperties.work=t[s]):i[n].field===r.type?(t[s]=this.parent.taskType,t.ganttProperties.taskType=t[s]):t[this.parent.ganttColumns[n].field]=""}return t.ganttProperties.isAutoSchedule="Auto"===this.parent.taskMode||"Manual"!==this.parent.taskMode&&!0!==t[r.manual],t},a.prototype.openToolbarEditDialog=function(){var t=this.parent;if(t.editModule&&t.editSettings.allowEditing){this.parent.ganttChartModule.focusedRowIndex>-1&&t.selectionModule&&t.selectionModule.selectRow(this.parent.ganttChartModule.focusedRowIndex,!1,!1);var i=t.selectionModule?"Row"!==t.selectionSettings.mode&&"Both"!==t.selectionSettings.mode||1!==t.selectionModule.selectedRowIndexes.length?"Cell"===t.selectionSettings.mode&&1===t.selectionModule.getSelectedRowCellIndexes().length?t.updatedRecords[t.selectionModule.getSelectedRowCellIndexes()[0].rowIndex].ganttProperties.rowUniqueID:null:t.updatedRecords[t.selectionModule.selectedRowIndexes[0]].ganttProperties.rowUniqueID:null;(0,e.isNullOrUndefined)(i)||this.openEditDialog(i)}},a.prototype.openEditDialog=function(t){var i=this.parent;(0,e.isNullOrUndefined)(t)||((0,e.isNullOrUndefined)(t.ganttProperties)||("string"==typeof t.ganttProperties.taskId?this.numericOrString="stringedit":this.numericOrString="numericedit"),(0,e.isNullOrUndefined)(t.ganttProperties)&&!(0,e.isNullOrUndefined)(t)&&(isNaN(Number(t))||"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType?this.numericOrString="stringedit":this.numericOrString="numericedit")),"object"!=typeof t||(0,e.isNullOrUndefined)(t)?(0,e.isNullOrUndefined)(t)?i.selectedRowIndex>-1&&(this.rowData=i.currentViewData[i.selectedRowIndex],this.rowIndex=i.selectedRowIndex):(this.rowIndex=i.ids.indexOf(t.toString()),this.rowIndex>-1&&(this.rowData=i.flatData[this.rowIndex])):(this.rowIndex=this.parent.currentViewData.indexOf(t),this.rowIndex>-1&&(this.rowData=t)),this.isEdit=!0,"ResourceView"===this.parent.viewType&&0===this.rowData.level||0!==Object.keys(this.rowData).length&&(this.editedRecord=(0,e.extend)({},{},this.rowData,!0),this.isFromEditDialog=!0,this.createDialog())},a.prototype.createDialog=function(){var t=this,i=this.parent,r={};this.beforeOpenArgs.dialogModel=r,this.beforeOpenArgs.rowData=this.editedRecord,this.beforeOpenArgs.rowIndex=this.rowIndex;var a=this.parent.isAdaptive?"":"600px",n=this.parent.createElement("div",{id:i.element.id+"_dialog",styles:"max-width:"+a});n.classList.add("e-gantt-dialog"),i.element.appendChild(n),r.animationSettings={effect:"None"},r.header=this.localeObj.getConstant(this.isEdit?"editDialogTitle":"addDialogTitle"),r.isModal=!0,r.enableRtl=this.parent.enableRtl,r.allowDragging=!this.parent.isAdaptive&&!this.parent.enableAdaptiveUI,r.showCloseIcon=!0;var s=this.parent.isAdaptive?{X:"top",Y:"left"}:{X:"center",Y:"center"};r.position=s,r.height=this.parent.isAdaptive?"100%":"auto",r.target=document.body,r.close=this.dialogClose.bind(this),r.closeOnEscape=!0,r.beforeClose=function(e){"escape"===e.closedBy&&"key-pressed"===e.event.name&&"INPUT"===e.event.target.nodeName&&(e.cancel=!0)},r.open=function(i){var r=(0,e.getValue)("element",i),a=r.querySelector("#"+t.parent.element.id+"GeneralTabContainer");a&&a.scrollHeight>a.offsetHeight&&a.classList.add("e-scroll"),0===t.tabObj.selectedItem&&t.tabObj.select(0),t.parent.isAdaptive&&(r.style.maxHeight="none"),t.parent.focusModule&&t.parent.focusModule.setActiveElement(r)},r.locale=this.parent.locale,r.buttons=[{buttonModel:{content:this.localeObj.getConstant("saveButton"),cssClass:"e-primary"},click:this.buttonClick.bind(this)},{buttonModel:{cssClass:"e-flat",content:this.localeObj.getConstant("cancel")},click:this.buttonClick.bind(this)}],this.createTab(r,n)},a.prototype.buttonClick=function(e){var t=e.target;if(t.style.pointerEvents="none",this.localeObj.getConstant("cancel").toLowerCase()===e.target.innerText.trim().toLowerCase())this.dialog&&!this.dialogObj.isDestroyed&&(this.CustomformObj=null,this.formObj=null,this.storeValidTab=null,this.customFieldColumn=[],this.taskFieldColumn=[],this.dialogObj.hide(),this.dialogClose());else{if(this.CustomformObj&&!this.CustomformObj.validate())return void(t.style.pointerEvents="");if(this.formObj)if(!this.formObj.validate())return void(t.style.pointerEvents="");if(this.storeDependencyTab||"Dependency"===this.firstOccuringTab){var i=void 0;if("Dependency"===this.firstOccuringTab)i=e.target.closest("#"+this.parent.element.id+"_dialog").querySelector(".e-gridform");else i=this.storeDependencyTab.querySelector(".e-gridform");if(i)if(!i.ej2_instances[0].validate())return void(t.style.pointerEvents="")}if(this.storeResourceTab||"Resources"===this.firstOccuringTab){var r=void 0;if("Resources"===this.firstOccuringTab)r=e.target.closest("#"+this.parent.element.id+"_dialog").querySelector(".e-gridform");else r=this.storeResourceTab.querySelector(".e-gridform");if(r)if(!r.ej2_instances[0].validate())return void(t.style.pointerEvents="")}this.initiateDialogSave(),this.CustomformObj=null,this.formObj=null,this.storeValidTab=null,this.customFieldColumn=[],this.taskFieldColumn=[],t.style.pointerEvents="auto"}},a.prototype.dialogClose=function(){this.dialog&&this.resetValues(),(0,e.isNullOrUndefined)(this.parent.focusModule)||(0,e.isNullOrUndefined)(this.parent.focusModule.getActiveElement(!0))||this.parent.focusModule.getActiveElement(!0).focus()},a.prototype.resetValues=function(){this.isEdit=!1,this.isAddNewResource=!1,this.editedRecord={},this.rowData={},this.rowIndex=-1,this.addedRecord=null,this.ganttResources=[],this.dialogEditValidationFlag=!1,this.dialog&&!this.dialogObj.isDestroyed&&(this.destroyDialogInnerElements(),this.dialogObj.destroy(),(0,e.remove)(this.dialog))},a.prototype.destroyDialogInnerElements=function(){for(var t=this.parent,i=this.beforeOpenArgs.tabModel.items,r=0;r<i.length;r++){var a=i[r].content,n=a.getAttribute("id");if(!(0,e.isNullOrUndefined)(n)||""!==n)if("General"===(n=(n=n.replace(t.element.id,"")).replace("TabContainer","")))this.destroyCustomField(a);else if("Dependency"===n){a.ej2_instances[0].destroy()}else if("Notes"===n){a.ej2_instances[0].destroy()}else if("Resources"===n){a.ej2_instances[0].destroy()}else-1!==n.indexOf("Custom")&&this.destroyCustomField(a)}},a.prototype.destroyCustomField=function(t){for(var r=t.childNodes,a=this.parent,n=0;n<r.length;n++){var s=r[n],o=s.querySelector('input[id^="'+a.element.id+'"]');if(o){var l=o.id.replace(a.element.id,""),d=s.querySelector("#"+a.element.id+l).ej2_instances[0];if(!(0,e.isNullOrUndefined)(d)){var h=a.columnByField[l];if((0,e.isNullOrUndefined)(h)||(0,e.isNullOrUndefined)(h.edit)||!(0,e.isNullOrUndefined)(h.edit.params))d.destroy();else{var p=h.edit.destroy;"string"==typeof p?(p=(0,i.getObject)(p,window))():h.edit.destroy()}}}}},a.prototype.destroy=function(){this.resetValues(),this.parent.isDestroyed||(this.parent.off("chartDblClick",this.dblClickHandler),this.parent.editModule.dialogModule=void 0)},a.prototype.getEditFields=function(){return this.isEdit?this.updatedEditFields:this.updatedAddFields},a.prototype.createTab=function(i,r){var a,n=this,s=this.parent,o={},l=[],d=this.getEditFields(),h=s.taskFields,p=d.length;o.items=l,o.locale=this.parent.locale,o.enableRtl=this.parent.enableRtl,this.beforeOpenArgs.tabModel=o;var u=0;if(p>0)for(var c=0;c<p;c++){var g=d[c],f={};if("General"===g.type){if(0===Object.keys(s.columnMapping).length)continue;(0,e.isNullOrUndefined)(g.headerText)&&(g.headerText=this.localeObj.getConstant("generalTab")),f.content="General",this.beforeOpenArgs[f.content]=this.getFieldsModel(g.fields)}else if("Segments"===g.type){if((0,e.isNullOrUndefined)(h.segments))continue;(0,e.isNullOrUndefined)(g.headerText)&&(g.headerText=this.localeObj.getConstant("segments")),f.content="Segments",this.beforeOpenArgs[f.content]=this.getSegmentsModel(g.fields)}else if("Dependency"===g.type){if((0,e.isNullOrUndefined)(h.dependency))continue;(0,e.isNullOrUndefined)(g.headerText)&&(g.headerText=this.localeObj.getConstant("dependency")),f.content="Dependency",this.beforeOpenArgs[f.content]=this.getPredecessorModel(g.fields)}else if("Resources"===g.type){if((0,e.isNullOrUndefined)(h.resourceInfo))continue;(0,e.isNullOrUndefined)(g.headerText)&&(g.headerText=this.localeObj.getConstant("resourceName")),f.content="Resources",this.beforeOpenArgs[f.content]=this.getResourcesModel(g.fields)}else if("Notes"===g.type){if((0,e.isNullOrUndefined)(h.notes))continue;(0,e.isNullOrUndefined)(g.headerText)&&(g.headerText=this.localeObj.getConstant("notes")),f.content="Notes",this.beforeOpenArgs[f.content]=this.getNotesModel(g.fields)}else{if((0,e.isNullOrUndefined)(g.fields)||0===g.fields.length)continue;(0,e.isNullOrUndefined)(g.headerText)&&(g.headerText=this.localeObj.getConstant("customTab")),f.content="Custom"+u++,this.beforeOpenArgs[f.content]=this.getFieldsModel(g.fields)}f.header={text:g.headerText},l.push(f)}this.beforeOpenArgs.requestType=this.isEdit?"beforeOpenEditDialog":"beforeOpenAddDialog",this.parent.trigger("actionBegin",this.beforeOpenArgs,(function(l){if((0,e.isNullOrUndefined)(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.showSpinner():n.parent.showMaskRow(),l.cancel)l.cancel=!1,(0,e.isNullOrUndefined)(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.hideSpinner():n.parent.hideMaskRow();else{n.renderTabItems(),o.selected=n.tabSelectedEvent.bind(n),o.height=n.parent.isAdaptive?"100%":"auto",o.overflowMode="Scrollable",n.tabObj=new vi.Tab(o),n.tabObj.isStringTemplate=!0,a=n.parent.createElement("div",{id:s.element.id+"_Tab"}),n.tabObj.appendTo(a),i.content=a,n.dialog=r,n.dialogObj=new t.Dialog(i),n.dialogObj.isStringTemplate=!0,n.dialogObj.appendTo(n.dialog);var d={action:"OpenDialog",requestType:n.isEdit?"openEditDialog":"openAddDialog",data:n.beforeOpenArgs.rowData,element:n.dialog,cancel:!1};n.parent.treeGrid.grid.getColumns().some((function(e){return e.validationRules}))&&(n.CustomformObj=null,n.formObj=null,n.storeValidTab=null,n.customFieldColumn=[],n.taskFieldColumn=[],n.changeFormObj(d.element)),n.parent.trigger("actionComplete",d,(function(t){(0,e.isNullOrUndefined)(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.hideSpinner():n.parent.hideMaskRow(),t.cancel&&n.resetValues()}))}}))},a.prototype.customComparator=function(e,t){var i=["General","Resources","Dependency","Custom"],r=e.type||"",a=t.type||"";return i.indexOf(r)-i.indexOf(a)},a.prototype.changeFormObj=function(e){if(this.storeColumn||(this.storeColumn=this.parent.treeGrid.grid.getColumns()),this.taskfields||(this.taskfields=this.parent.taskFields.properties),this.storeValidTab||(this.storeValidTab=this.getFilteredDialogFields()),this.storeValidTab&&this.storeValidTab.sort(this.customComparator),0!==this.customFieldColumn.length&&0!==this.taskFieldColumn.length||this.validateColumn(this.storeColumn,this.taskfields,this.storeValidTab),this.isFromAddDialog&&this.parent.addDialogFields&&this.parent.addDialogFields.length>0)"Resources"!==(t=this.parent.addDialogFields[0].type)&&"Dependency"!==t||(this.firstOccuringTab=t);else if(this.isFromEditDialog&&this.parent.editDialogFields&&this.parent.editDialogFields.length>0){var t;"Resources"!==(t=this.parent.editDialogFields[0].type)&&"Dependency"!==t||(this.firstOccuringTab=t)}if(!this.CustomformObj||!this.formObj){var i=this.customFieldColumn,r=this.taskFieldColumn;if(!this.CustomformObj&&i&&i.length>0){for(var a={},n=0;n<i.length;n++){var s=i[n];s.visible&&s.validationRules&&(a[s.field]=s.validationRules)}Object.keys(a).length>0&&(this.CustomformObj=e.querySelector("#"+this.parent.element.id+"Custom0TabContainer"),this.CustomformObj&&(this.CustomformObj=this.createFormObj(this.CustomformObj,a)))}if(!this.formObj&&r&&r.length>0){for(a={},n=0;n<r.length;n++){var o=r[n];o.visible&&o.validationRules&&(a[o.field]=o.validationRules)}Object.keys(a).length>0&&(this.formObj=e.querySelector("#"+this.parent.element.id+"GeneralTabContainer"),this.formObj&&(this.formObj=this.createFormObj(this.formObj,a)))}}this.isFromAddDialog=!1,this.isFromEditDialog=!1},a.prototype.getFilteredDialogFields=function(){var e=this.isFromAddDialog?this.parent.addDialogFields:this.parent.editDialogFields;return 0!==e.length?e.filter((function(e){return"General"===e.type||"Custom"===e.type})):null},a.prototype.validateColumn=function(e,t,i){var r=this;i?i.forEach((function(t){var i="General"===t.type?r.taskFieldColumn:r.customFieldColumn;t.fields.forEach((function(t){var a=r.parent.getColumnByField(t,e);null!==a?i.push(a):i.push(r.parent.columnByField[t])}))})):e.forEach((function(e){-1!==r.parent.customColumns.indexOf(e.field)?r.customFieldColumn.push(e):r.taskFieldColumn.push(e)}))},a.prototype.createFormObj=function(e,t){var i=this;return new wi.FormValidator(e,{rules:t,locale:this.parent.locale,validationComplete:function(e){i.validationComplete(e)},customPlacement:function(e,t){var r=e.getAttribute("name");if(r){var a=r;i.valErrorPlacement(e,t,a)}}})},a.prototype.valErrorPlacement=function(e,t,i){var r=i+"-tooltip",a=this.getElemTable(e);if(a){var n=a.querySelector(".e-tip-content");n&&(n.innerHTML=t.outerHTML)}else this.createTooltip(e,t,r)},a.prototype.createTooltip=function(e,t,i,r){void 0===r&&(r="block");var a=document.getElementById(i);a&&a.remove();var n=e.parentElement;n&&(n.style.position="relative");var s=document.createElement("div");s.className="e-tooltip-wrap e-lib e-control e-popup e-griderror",s.style.display=r,s.style.zIndex="1000";var o=i+"-label",l=document.createElement("div");l.id=o,l.className="sr-only";var d=document.createElement("div");d.className="e-tip-content";var h=document.createElement("div");h.className="error-message",h.appendChild(t.cloneNode(!0));var p=document.createElement("div");p.className="e-arrow-tip e-tip-top",p.appendChild(document.createElement("div")).className="e-arrow-tip-outer e-tip-top",p.appendChild(document.createElement("div")).className="e-arrow-tip-inner e-tip-top",s.setAttribute("aria-labelledby",o),d.appendChild(h),s.appendChild(d),s.appendChild(p),s.style.top="125%",s.style.left="50%",s.style.transform="translateX(-50%)",n&&(n.appendChild(l),n.appendChild(s))},a.prototype.getElemTable=function(e){var t=e.parentElement;return t?t.querySelector(".e-tooltip-wrap"):null},a.prototype.validationComplete=function(e){var t=this.getElemTable(e.element);t&&("failure"===e.status?t.style.display="":t.style.display="none")},a.prototype.tabSelectedEvent=function(t){var i=this.parent,r=t.selectedContent.childNodes[0].id,a=this.parent.editModule.dialogModule,n=a.dialog,s=n.getElementsByClassName("e-editedbatchcell").length>0,o=n.getElementsByClassName("e-editedrow").length>0||n.getElementsByClassName("e-addedrow").length>0;(a.storeResourceTab&&s?document.querySelector("#"+i.element.id+"ResourcesTabContainer_gridcontrol").ej2_instances[0].saveCell():a.storeDependencyTab&&o&&document.querySelector("#"+i.element.id+"DependencyTabContainer").ej2_instances[0].editModule.batchSave(),r===i.element.id+"DependencyTabContainer"&&(this.storeDependencyTab=t.selectedContent),r===i.element.id+"ResourcesTabContainer"&&(this.storeResourceTab=t.selectedContent),r===i.element.id+"Custom0TabContainer")&&(this.parent.treeGrid.grid.getColumns().some((function(e){return e.validationRules}))&&this.changeFormObj(t.selectedContent));r===i.element.id+"GeneralTabContainer"&&(this.parent.treeGrid.grid.getColumns().some((function(e){return e.validationRules}))&&this.changeFormObj(t.selectedContent));(this.parent.isAdaptive||this.parent.enableAdaptiveUI)&&this.responsiveTabContent(r,i),r===i.element.id+"ResourcesTabContainer"?this.resourceSelection(r):r===i.element.id+"NotesTabContainer"?document.getElementById(r).ej2_instances[0].refresh():r===i.element.id+"SegmentsTabContainer"&&((0,e.isNullOrUndefined)(this.beforeOpenArgs.rowData.ganttProperties.startDate)?document.getElementById(r).ej2_instances[0].enableToolbarItems([this.parent.element.id+"SegmentsTabContainer_add"],!1):document.getElementById(r).ej2_instances[0].enableToolbarItems([this.parent.element.id+"SegmentsTabContainer_add"],!0))},a.prototype.responsiveTabContent=function(e,t){var i=document.getElementById(t.element.id+"_dialog_dialog-content"),r=i.clientHeight;r-=i.querySelector(".e-tab-header").offsetHeight;var a=document.querySelector("#"+e);if(a.classList.contains("e-grid")){r-=a.ej2_instances[0].getHeaderContent().offsetHeight;var n=a.querySelector(".e-toolbar");n&&(r-=n.offsetHeight)}a.parentElement.style.height=r+"px"},a.prototype.getFieldsModel=function(t){for(var i={},r=this.parent.columnByField,a=0;a<t.length;a++)if(t[a]!==this.parent.taskFields.dependency&&t[a]!==this.parent.taskFields.resourceInfo&&t[a]!==this.parent.taskFields.notes&&!(0,e.isNullOrUndefined)(r[t[a]])){var n=t[a];this.createInputModel(r[n],i)}return i},a.prototype.createInputModel=function(t,i){var r=this,a=this.parent,n=this.parent.locale,s=this.parent.taskFields,o={placeholder:t.headerText,floatLabelType:"Auto"};switch((0,e.isNullOrUndefined)(this.parent.taskFields.id)||(0,e.isNullOrUndefined)(this.parent.columnMapping.id)||(0,e.isNullOrUndefined)(this.numericOrString)||s.id===t.field&&(t.editType=this.numericOrString),t.editType){case"booleanedit":var l={label:t.headerText,locale:n,enableRtl:this.parent.enableRtl};i[t.field]=l;break;case"defaultedit":case"stringedit":var d=o;d.enableRtl=this.parent.enableRtl,t.field!==a.columnMapping.duration&&t.field!==a.columnMapping.id&&t.field!==a.columnMapping.startDate&&t.field!==a.columnMapping.endDate||(d.change=function(e){r.validateScheduleFields(e,t,a)}),i[t.field]=o;break;case"numericedit":var h=o;h.enableRtl=this.parent.enableRtl,s.progress===t.field&&(h.min=0,h.max=100),h.change=function(e){r.validateScheduleFields(e,t,a)},i[t.field]=h;break;case"datepickeredit":var p=o;p.format=this.parent.getDateFormat(),p.enableRtl=this.parent.enableRtl,p.strictMode=!0,p.firstDayOfWeek=a.timelineModule.customTimelineSettings.weekStartDay,t.field!==a.columnMapping.startDate&&t.field!==a.columnMapping.endDate||(p.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent),p.change=function(e){r.validateScheduleFields(e,t,a)}),i[t.field]=p;break;case"datetimepickeredit":var u=o;u.format=this.parent.getDateFormat(),u.enableRtl=this.parent.enableRtl,u.strictMode=!0,u.firstDayOfWeek=a.timelineModule.customTimelineSettings.weekStartDay,t.field!==a.columnMapping.startDate&&t.field!==a.columnMapping.endDate||(u.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent),u.change=function(e){r.validateScheduleFields(e,t,a)}),i[t.field]=u;break;case"dropdownedit":if(t.field===a.columnMapping.type||t.field===a.columnMapping.manual){o.dataSource=[{ID:1,Value:"FixedUnit"},{ID:2,Value:"FixedWork"},{ID:3,Value:"FixedDuration"}],o.fields={value:"Value"};var c=o;c.enableRtl=this.parent.enableRtl,c.change=function(e){t.field===s.manual&&(r.editedRecord.ganttProperties.isAutoSchedule=!e.value),r.validateScheduleFields(e,t,a)}}i[t.field]=o;break;case"maskededit":i[t.field]=o}return(0,e.isNullOrUndefined)(t.edit)||(0,e.isNullOrUndefined)(t.edit.params)||(0,e.extend)(i[t.field],t.edit.params),i},a.prototype.validateScheduleFields=function(t,i,r){var a,n;(0,e.isNullOrUndefined)(r.editModule.dialogModule.dialog)||(n=r.editModule.dialogModule.dialog);var s,o=null,l=r.editModule.dialogModule.editedRecord,d=null,h=null,p="ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids,u=this.parent.viewType;if((0,e.isNullOrUndefined)(t.element)?(0,e.isNullOrUndefined)(t.container)?(0,e.isNullOrUndefined)(t.event)||(0,e.isNullOrUndefined)(t.event.path)||(0,e.isNullOrUndefined)(t.event.path)[1]||(o=(s=t.event.path[1]).querySelector("input").getAttribute("id"),s=s.querySelector("#"+o)):(o=(s=t.container).querySelector("input").getAttribute("id"),s=s.querySelector("#"+o)):o=(s=t.element).getAttribute("id"),(0,e.isNullOrUndefined)(s))d=t.value,h=i.field;else if(d=s.value,h=o.replace(r.element.id,""),"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType){var c={rules:(a={},a[this.parent.taskFields.id]={required:!0,minLength:[function(e){return"ResourceView"===u?-1===p.indexOf("T"+e.value)&&-1===p.indexOf("R"+e.value):-1===p.indexOf(e.value)},"ID is already present, please enter new value"]},a)};new wi.FormValidator("#"+this.parent.element.id+"GeneralTabContainer",c)}if(0===h.search("Segments"))return h=h.replace("SegmentsTabContainer",""),this.validateSegmentFields(r,h,d,t),!0;this.validateScheduleValuesByCurrentField(h,d,this.editedRecord);var g=l.ganttProperties,f=r.taskFields;return(0,e.isNullOrUndefined)(f.startDate)||f.startDate===h||this.updateScheduleFields(n,g,"startDate"),f.endDate===h&&!(0,e.isNullOrUndefined)(g.startDate)&&!(0,e.isNullOrUndefined)(t.value)&&g.startDate.getTime()>t.value&&this.updateScheduleFields(n,g,"endDate"),(0,e.isNullOrUndefined)(f.endDate)||f.endDate===h||this.updateScheduleFields(n,g,"endDate"),(!(0,e.isNullOrUndefined)(f.duration)&&f.duration!==h||g.duration>=0)&&this.updateScheduleFields(n,g,"duration"),(0,e.isNullOrUndefined)(f.work)||f.work===h&&"FixedWork"===g.taskType||this.updateScheduleFields(n,g,"work"),this.dialogEditValidationFlag=!1,!0},a.prototype.updateScheduleFields=function(t,i,r){var a,n=this.parent,s=n.element.id,o=(0,e.getValue)(r,n.columnMapping),l=n.columnByField[o],d=this.parent.taskFields;if("stringedit"===l.editType){if(p=t.querySelector("#"+s+o)){var h=p.ej2_instances[0];h&&(a=(0,e.isNullOrUndefined)(l.edit)||(0,e.isNullOrUndefined)(l.edit.read)?(0,e.isNullOrUndefined)(l.valueAccessor)?this.parent.dataOperation.getDurationString(i.duration,i.durationUnit):l.valueAccessor(o,n.editModule.dialogModule.editedRecord,l):l.edit.read(),h.value!==a.toString()&&d.duration===o?(h.value=a,h.dataBind()):d.startDate!==o&&d.endDate!==o||(h.value=d.startDate===o?i.startDate.toString():i.endDate.toString(),h.dataBind()))}}else if("datepickeredit"===l.editType||"datetimepickeredit"===l.editType){var p;if(p=t.querySelector("#"+s+o)){var u=(l.editType,p.ej2_instances[0]);u&&(a=i[r],((0,e.isNullOrUndefined)(u.value)&&!(0,e.isNullOrUndefined)(a)||(0,e.isNullOrUndefined)(a)&&!(0,e.isNullOrUndefined)(u.value)||u.value!==a&&!(0,e.isNullOrUndefined)(u.value)&&!(0,e.isNullOrUndefined)(a)&&u.value.toString()!==a.toString())&&(u.value=a,u.dataBind()))}}else if("numericedit"===l.editType){var c=t.querySelector("#"+s+o).ej2_instances[0];a=i[r],(0,e.isNullOrUndefined)(a)||c.value===a||(c.value=a,c.dataBind())}},a.prototype.validateDuration=function(t){var i=t.ganttProperties;if(!this.dialogEditValidationFlag){!(0,e.isNullOrUndefined)(i.duration)||n(i)||(0,e.isNullOrUndefined)(i.startDate)?n(i)||!(0,e.isNullOrUndefined)(i.startDate)?(t.ganttProperties.isMilestone&&0!==t.ganttProperties.duration&&this.parent.dateValidationModule.checkStartDate(i.startDate),this.parent.dateValidationModule.calculateEndDate(t)):n(i)||(0,e.isNullOrUndefined)(i.endDate)||this.parent.dateValidationModule.calculateStartDate(t):(this.parent.setRecordValue("endDate",null,i,!0),this.parent.setRecordValue("isMilestone",!1,i,!0));var r=0===i.duration;this.parent.setRecordValue("isMilestone",r,i,!0),this.dialogEditValidationFlag=!0}},a.prototype.validateStartDate=function(t){var i=t.ganttProperties,r=this.parent.taskFields;this.dialogEditValidationFlag||((0,e.isNullOrUndefined)(i.startDate)?(this.parent.setRecordValue("duration",null,i,!0),this.parent.setRecordValue("isMilestone",!1,i,!0),this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(r.endDate)&&this.parent.setRecordValue("endDate",null,i,!0)):n(i)?(0,e.isNullOrUndefined)(r.duration)?this.parent.dateValidationModule.calculateDuration(t):((0,e.isNullOrUndefined)(r.endDate),this.parent.dateValidationModule.calculateEndDate(t)):(0,e.isNullOrUndefined)(i.endDate)?(0,e.isNullOrUndefined)(i.duration)||this.parent.dateValidationModule.calculateEndDate(t):this.parent.dateValidationModule.calculateDuration(t),this.dialogEditValidationFlag=!0)},a.prototype.validateEndDate=function(t){var i=t.ganttProperties,r=this.parent.taskFields;this.dialogEditValidationFlag||((0,e.isNullOrUndefined)(i.endDate)?(this.parent.setRecordValue("duration",null,i,!0),this.parent.setRecordValue("isMilestone",!1,i,!0)):n(i)?(0,e.isNullOrUndefined)(r.duration)?this.parent.dateValidationModule.calculateDuration(t):(0,e.isNullOrUndefined)(i.startDate)?this.parent.dateValidationModule.calculateStartDate(t):(!(0,e.isNullOrUndefined)(i.segments)&&i.segments.length>0&&(i.segments=this.parent.editModule.cellEditModule.validateEndDateWithSegments(i)),this.parent.dateValidationModule.calculateDuration(t)):(0,e.isNullOrUndefined)(i.duration)?(0,e.isNullOrUndefined)(i.startDate)||this.parent.dateValidationModule.calculateDuration(t):this.parent.dateValidationModule.calculateStartDate(t),this.dialogEditValidationFlag=!0)},a.prototype.validateScheduleValuesByCurrentField=function(t,i,r){var a=this.parent,n=r.ganttProperties,s=a.taskFields;if(s.duration===t){if(!(0,e.isNullOrUndefined)(i)&&""!==i&&(parseInt(i,10)>=0||parseFloat(i)>=0)){if(a.dataOperation.updateDurationValue(i,n),this.parent.setRecordValue(s.duration,i,r),this.parent.setRecordValue("taskData."+s.duration,n.duration,r),n.isMilestone&&!(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule))(d={}).data=r,this.parent.editModule.cellEditModule.updateDates(d);this.validateDuration(r)}else if(a.allowUnscheduledTasks)if(n.startDate&&n.endDate&&n.startDate.getTime()>n.endDate.getTime()||-1!==i.indexOf("-"))this.parent.setRecordValue("duration",0,n,!0),n.endDate&&this.parent.setRecordValue("startDate",n.endDate,n,!0);else if(""===i)this.parent.setRecordValue("duration",null,n,!0),n.endDate&&n.startDate&&this.parent.setRecordValue("endDate",null,n,!0);else{if(/^[^\d.-]+$/.test(i)){var o="The provided value for the "+s.duration+" field is invalid. Please ensure the "+s.duration+" field contains only valid numeric values.";this.parent.trigger("actionFailure",{error:o})}this.parent.setRecordValue("duration",n.duration,n,!0)}this.parent.editModule.updateResourceRelatedFields(r,"duration")}if(s.startDate===t)if(""!==i){var l=this.parent.dateValidationModule.getDateFromFormat(i);l=this.parent.dateValidationModule.checkStartDate(l,n),this.parent.setRecordValue("startDate",l,n,!0),this.validateStartDate(r)}else a.allowUnscheduledTasks&&!r.hasChildRecords&&(this.parent.setRecordValue("startDate",null,n,!0),this.parent.setRecordValue("duration",null,n,!0),this.parent.setRecordValue("isMilestone",!1,n,!0));if(s.endDate===t)if(""!==i){var d,h=this.parent.dateValidationModule.getDateFromFormat(i),p=this.parent.getCurrentDayEndTime(h);if(0===h.getHours()&&86400!==p&&this.parent.dateValidationModule.setTime(p,h),!(0,e.isNullOrUndefined)(n.startDate)&&!(0,e.isNullOrUndefined)(n.endDate)&&!(0,e.isNullOrUndefined)(h)&&n.startDate.getTime()>h.getTime()&&(h=n.endDate),h=this.parent.dateValidationModule.checkEndDate(h,n),((0,e.isNullOrUndefined)(n.startDate)||h.getTime()>n.startDate.getTime())&&this.parent.setRecordValue("endDate",h,n,!0),this.validateEndDate(r),n.isMilestone&&!(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule))(d={}).data=r,this.parent.editModule.cellEditModule.updateDates(d)}else a.allowUnscheduledTasks&&(this.parent.setRecordValue("endDate",null,n,!0),this.parent.setRecordValue("duration",null,n,!0),this.parent.setRecordValue("isMilestone",!1,n,!0));return s.work===t&&((0,e.isNullOrUndefined)(i)||""===i||(this.parent.setRecordValue("work",i,n,!0),this.parent.editModule.updateResourceRelatedFields(r,"work"),this.validateDuration(r))),t===s.type&&this.parent.setRecordValue("taskType",i,n,!0),s.manual===t&&this.parent.editModule.updateTaskScheduleModes(r),!0},a.prototype.getSegmentsModel=function(t){var i=this,r=this.parent.taskFields;((0,e.isNullOrUndefined)(t)||0===t.length)&&(t=[],(0,e.isNullOrUndefined)(r.startDate)||t.push(this.parent.taskFields.startDate),(0,e.isNullOrUndefined)(r.endDate)||t.push(this.parent.taskFields.endDate),(0,e.isNullOrUndefined)(r.duration)||t.push(this.parent.taskFields.duration),(0,e.isNullOrUndefined)(r.id)||t.push(this.parent.taskFields.id));var a={editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,mode:"Normal",newRowPosition:"Bottom"}};a.locale=this.parent.locale,a.dataSource=[],a.rowHeight=this.parent.isAdaptive?48:null,a.toolbar=[{id:this.parent.element.id+"SegmentsTabContainer_add",prefixIcon:"e-add",tooltipText:this.localeObj.getConstant("add"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("add")},{id:this.parent.element.id+"SegmentsTabContainer_delete",prefixIcon:"e-delete",tooltipText:this.localeObj.getConstant("delete"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("delete")}];for(var n=[],s=function(r){var a={},s="General";switch(t[r]){case o.parent.taskFields.id:a={field:t[r],visible:!1,isPrimaryKey:!0},n.push(a);break;case o.parent.taskFields.startDate:case o.parent.taskFields.endDate:a={field:t[r],headerText:o.localeObj.getConstant(t[r]===o.parent.taskFields.startDate?"startDate":"endDate"),editType:"stringedit",width:"200px",edit:{write:function(a){var n;if((0,e.isNullOrUndefined)(i.beforeOpenArgs[s])){var o=i.getGeneralColumnFields();n=i.getFieldsModel(o)[t[r]]}else n=i.beforeOpenArgs[s][t[r]];var l=a.rowData[a.column.field];(0,e.setValue)("value",l,n),new i.inputs[i.parent.columnByField[t[r]].editType](n).appendTo(a.element)},read:function(e){return e.ej2_instances[0].value}},format:o.parent.getDateFormat()},"startDate"===t[r]&&(a.validationRules={required:!0}),n.push(a);break;case o.parent.taskFields.duration:a={field:t[r],headerText:o.localeObj.getConstant(t[r].toLocaleLowerCase()),editType:"stringedit",width:"100px",edit:{write:function(a){var n;if((0,e.isNullOrUndefined)(i.beforeOpenArgs[s])){var o=i.getGeneralColumnFields();n=i.getFieldsModel(o)[t[r]]}else n=i.beforeOpenArgs[s][t[r]];n.floatLabelType="Never";var l=a.rowData[a.column.field];(0,e.isNullOrUndefined)(l)?(0,e.setValue)("value",null,n):(0,e.setValue)("value",l,n),(0,e.setValue)("value",l,n),new wi.TextBox(n).appendTo(a.element)},read:function(e){return e.ej2_instances[0].value.toString()}}},n.push(a)}},o=this,l=0;l<t.length;l++)s(l);return a.columns=n,a.height=this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"153px",a},a.prototype.getGridColumnByField=function(e,t){for(var i,r=0;r<t.length;r++)t[r].field===e&&(i=t[r]);return i},a.prototype.updateSegmentField=function(t,i,r){var a,n=this.parent.editModule.dialogModule.dialog,s=(0,e.getValue)("Segments",this.beforeOpenArgs),o=this.getGridColumnByField(t,s.columns),l=this.parent.element.id,d=r[t];("stringedit"===o.editType||"datepickeredit"===o.editType)&&(a=n.querySelector("#"+l+"SegmentsTabContainer"+t).ej2_instances[0]),(0,e.isNullOrUndefined)(a.value)||(0,e.isNullOrUndefined)(d)||a.value.toString()===d.toString()||(a.value=d,a.dataBind())},a.prototype.validateSegmentFields=function(t,i,r,a){var n=this.parent.taskFields;if(!(0,e.isNullOrUndefined)(n.duration)&&n.duration.toLowerCase()===i.toLowerCase()&&!(0,e.isNullOrUndefined)(r)&&""!==r){this.selectedSegment[n.duration]=Number(r);var s=t.dataOperation.getEndDate(this.selectedSegment[n.startDate],Number(r),this.editedRecord.ganttProperties.durationUnit,this.editedRecord.ganttProperties,!1);s=t.dataOperation.checkEndDate(s,this.editedRecord.ganttProperties,!1),this.selectedSegment[n.endDate]=s}if(!(0,e.isNullOrUndefined)(n.startDate)&&n.startDate.toLowerCase()===i.toLowerCase()&&""!==r){var o=this.parent.dateValidationModule.getDateFromFormat(r);o=this.parent.dateValidationModule.checkStartDate(o),this.selectedSegment[n.startDate]=o,(0,e.isNullOrUndefined)(n.endDate)||(this.selectedSegment.endDate=this.parent.dataOperation.getEndDate(o,this.selectedSegment[n.duration],this.editedRecord.ganttProperties.durationUnit,this.editedRecord.ganttProperties,!1))}if(!(0,e.isNullOrUndefined)(n.endDate)&&n.endDate.toLowerCase()===i.toLowerCase()&&""!==r){s=this.parent.dateValidationModule.getDateFromFormat(r);var l=this.parent.getCurrentDayEndTime(s);0===s.getHours()&&86400!==l&&this.parent.dateValidationModule.setTime(l,s),s=this.parent.dateValidationModule.checkEndDate(s,this.editedRecord.ganttProperties),this.selectedSegment[n.endDate]=s,this.selectedSegment[n.duration]=this.parent.dataOperation.getDuration(this.selectedSegment[n.startDate],this.selectedSegment[n.endDate],this.editedRecord.ganttProperties.durationUnit,!0,!1,!0)}(0,e.isNullOrUndefined)(n.startDate)||this.updateSegmentField(n.startDate,a,this.selectedSegment),(0,e.isNullOrUndefined)(n.endDate)||this.updateSegmentField(n.endDate,a,this.selectedSegment),(0,e.isNullOrUndefined)(n.duration)||this.updateSegmentField(n.duration,a,this.selectedSegment)},a.prototype.getPredecessorModel=function(t){((0,e.isNullOrUndefined)(t)||0===t.length)&&(t=["ID","Name","Type","Offset","UniqueId"]);var i={editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,mode:"Normal"}};i.locale=this.parent.locale,i.dataSource=[],i.rowHeight=this.parent.isAdaptive?48:null,i.toolbar=[{id:this.parent.element.id+"DependencyTabContainer_add",prefixIcon:"e-add",tooltipText:this.localeObj.getConstant("add"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("add")},{id:this.parent.element.id+"DependencyTabContainer_delete",prefixIcon:"e-delete",tooltipText:this.localeObj.getConstant("delete"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("delete")}];for(var r=[],a=0;a<t.length;a++){var n={};"id"===t[a].toLowerCase()?(n={field:"id",headerText:this.localeObj.getConstant("id"),allowEditing:!1,width:"70px"},r.push(n)):"name"===t[a].toLowerCase()?(n={field:"name",headerText:this.localeObj.getConstant("name"),editType:"stringedit",width:"250px",validationRules:{required:!0}},r.push(n)):"type"===t[a].toLowerCase()?(n={field:"type",headerText:this.localeObj.getConstant("type"),editType:"dropdownedit",dataSource:this.types,foreignKeyField:"id",foreignKeyValue:"text",defaultValue:"FS",validationRules:{required:!0},width:"150px"},r.push(n)):"offset"===t[a].toLowerCase()?(n={field:"offset",headerText:this.localeObj.getConstant("offset"),editType:"stringedit",defaultValue:this.parent.dataOperation.getDurationString(0,this.beforeOpenArgs.rowData.ganttProperties.durationUnit),validationRules:{required:!0},width:"100px"},r.push(n)):"uniqueid"===t[a].toLowerCase()&&(n={field:"uniqueId",isPrimaryKey:!0,visible:!1,defaultValue:D().toString()},r.push(n))}return i.columns=r,i.height=this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"153px",i},a.prototype.getResourcesModel=function(t){var i=this.parent.resourceFields;((0,e.isNullOrUndefined)(t)||0===t.length)&&(t=[i.id,i.name,i.unit,i.group]);for(var r={allowFiltering:!0,treeColumnIndex:-1,childMapping:"",editSettings:{allowEditing:!0,mode:"Cell"},locale:this.parent.locale,allowSelection:!0,rowHeight:this.parent.isAdaptive?48:null,filterSettings:{type:"Menu"},selectionSettings:{checkboxOnly:!0,checkboxMode:"Default",persistSelection:!0,type:"Multiple"}},a=[{type:"checkbox",allowEditing:!1,allowSorting:!1,allowFiltering:!1,width:60}],n=0;n<t.length;n++){var s={};t[n]===i.id?(s={field:i.id,headerText:this.localeObj.getConstant("id"),isPrimaryKey:!0,width:"100px",allowEditing:!1},a.push(s)):t[n]===i.name?(s={field:i.name,headerText:this.localeObj.getConstant("name"),allowEditing:!1},a.push(s)):t[n]===i.unit?(s={field:i.unit,headerText:this.localeObj.getConstant("unit"),editType:"numericedit",edit:{params:{min:0}}},a.push(s)):t[n]!==i.group||(0,e.isNullOrUndefined)(i.group)||(s={field:i.group,headerText:this.localeObj.getConstant("group"),allowEditing:!1},a.push(s))}return r.columns=a,r.height=this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"196px",r},a.prototype.getNotesModel=function(t){return((0,e.isNullOrUndefined)(t)||0===t.length)&&(t=["Bold","Italic","Underline","StrikeThrough","FontName","FontSize","FontColor","BackgroundColor","LowerCase","UpperCase","|","Alignments","OrderedList","UnorderedList","Outdent","Indent","|","CreateTable","CreateLink","|","ClearFormat","Print","|","Undo","Redo"]),{placeholder:this.localeObj.getConstant("writeNotes"),toolbarSettings:{items:t},height:this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"auto",locale:this.parent.locale}},a.prototype.createDivElement=function(t,i){return(0,e.createElement)("div",{className:t,id:i})},a.prototype.createFormElement=function(t,i){return(0,e.createElement)("form",{className:t,id:i})},a.prototype.createInputElement=function(t,i,r,a){return(0,e.createElement)(a||"input",{className:t,attrs:{type:"text",id:i,name:r,title:r}})},a.prototype.renderTabItems=function(){for(var e=!1,t=this.beforeOpenArgs.tabModel.items,i=0,r=0;r<t.length;r++){var a=t[r];a.content instanceof HTMLElement||("General"===a.content?a.content=this.renderGeneralTab(a.content):"Dependency"===a.content?(this.editedRecord.hasChildRecords&&!this.parent.allowParentDependency&&(a.disabled=!0),a.content=this.renderPredecessorTab(a.content)):"Resources"===a.content?a.content=this.renderResourceTab(a.content):a.content==="Custom"+i?(e=!0,a.content=this.renderCustomTab(a.content,e),i++):"Notes"===a.content?a.content=this.renderNotesTab(a.content):"Segments"===a.content&&(this.editedRecord.hasChildRecords&&(a.disabled=!0),a.content=this.renderSegmentsTab(a.content)))}},a.prototype.segmentGridActionBegin=function(t){var i,r,a=this.parent.taskFields,n=this.beforeOpenArgs.Segments;if("add"===t.requestType||"beginEdit"===t.requestType||"save"===t.requestType){var s=n.dataSource,o=(0,e.getValue)("rowData",t),l=this.beforeOpenArgs.rowData.ganttProperties.startDate;if(!(0,e.isNullOrUndefined)(l)&&"add"===t.requestType){var d={},h=(0,e.getValue)(this.parent.taskFields.startDate,o),p=this.parent.taskFields.endDate?(0,e.getValue)(this.parent.taskFields.endDate,o):null,u=void 0;(0,e.isNullOrUndefined)(this.parent.taskFields.duration)||(u=(0,e.getValue)(this.parent.taskFields.duration,o));var c=!(0,e.isNullOrUndefined)(s)&&s.length>0?(0,e.isNullOrUndefined)(a.endDate)||(0,e.isNullOrUndefined)(s[0][a.endDate])?new Date((0,e.getValue)(a.startDate,s[0]).getTime()):new Date((0,e.getValue)(a.endDate,s[0]).getTime()):!(0,e.isNullOrUndefined)(this.beforeOpenArgs.rowData.ganttProperties.startDate)&&new Date(this.beforeOpenArgs.rowData.ganttProperties.startDate.getTime());c.setHours(0,0,0,0),!(0,e.isNullOrUndefined)(s)&&s.length>0&&c.setDate(c.getDate()+2),h=this.parent.dataOperation.checkStartDate(c),p=this.parent.dateValidationModule.getDateFromFormat(h);var g=this.parent.getCurrentDayEndTime(p);0===p.getHours()&&86400!==g&&this.parent.dateValidationModule.setTime(g,p),p=!(0,e.isNullOrUndefined)(a.endDate)&&!(0,e.isNullOrUndefined)(s)&&s.length<=0?this.beforeOpenArgs.rowData.ganttProperties.endDate:p;var f=this.beforeOpenArgs.rowData.ganttProperties;u=h.getTime()===p.getTime()?1:this.parent.dataOperation.getDuration(h,p,f.durationUnit,!0,!1,!0),(0,e.isNullOrUndefined)(a.duration)?((r={})[a.startDate]=h,r[a.endDate]=p,d=r):((i={})[a.startDate]=h,i[a.endDate]=p,i[a.duration]=u,d=i),t.rowData=d}this.selectedSegment=t.rowData}},a.prototype.getDialogTabIndex=function(e){var t;return this.isEdit?this.parent.editDialogFields.map((function(i,r){i.type===e&&(t=r)})):this.parent.addDialogFields.map((function(i,r){i.type===e&&(t=r)})),t},a.prototype.renderSegmentsTab=function(t){var r=this,a=this.parent,n=this.beforeOpenArgs[t];n.enableAdaptiveUI=this.parent.enableAdaptiveUI;var s=this.beforeOpenArgs.rowData,o=[];this.isEdit&&(o=(0,e.isNullOrUndefined)(s.taskData[this.parent.taskFields.segments])?[]:s.taskData[this.parent.taskFields.segments]),o.map((function(t,i){(0,e.isNullOrUndefined)(t[r.parent.taskFields.id])&&(t[r.parent.taskFields.id]=i)})),n.dataSource=o,n.actionBegin=this.segmentGridActionBegin.bind(this);var l,d,h=this.getDialogTabIndex("Segments");this.isEdit?this.isEdit&&(l=this.parent.editDialogFields[h]):l=this.parent.addDialogFields[h];var p=[],u=[];if(!(0,e.isNullOrUndefined)(l)&&!(0,e.isNullOrUndefined)(l.additionalParams))for(var c in d=l.additionalParams)if(Object.prototype.hasOwnProperty.call(d,c))switch(c){case"allowFiltering":i.Grid.Inject(i.Filter);break;case"allowSorting":i.Grid.Inject(i.Sort);break;case"allowPaging":i.Grid.Inject(i.Page);break;case"allowGrouping":i.Grid.Inject(i.Group);break;case"editSettings":i.Grid.Inject(i.Edit);break;case"aggregates":i.Grid.Inject(i.Aggregate);break;case"showColumnChooser":i.Grid.Inject(i.ColumnChooser);break;case"showColumnMenu":i.Grid.Inject(i.ColumnMenu);break;case"contextMenuItems":i.Grid.Inject(i.ContextMenu);break;case"allowResizing":i.Grid.Inject(i.Resize);break;case"allowReordering":i.Grid.Inject(i.Reorder);break;case"detailTemplate":i.Grid.Inject(i.DetailRow);break;case"allowRowDragAndDrop":i.Grid.Inject(i.RowDD);break;case"searchSettings":i.Grid.Inject(i.Search);break;case"selectionSettings":i.Grid.Inject(Selection);break;case"toolbar":d.toolbar.map((function(e){switch(e){case"Search":i.Grid.Inject(i.Search);break;case"Print":i.Grid.Inject(i.Print);break;case"PdfExport":i.Grid.Inject(i.PdfExport);break;case"ExcelExport":i.Grid.Inject(i.ExcelExport)}})),p=n.toolbar,i.Grid.Inject(i.Toolbar);break;case"enableVirtualization":i.Grid.Inject(_e.VirtualScroll);break;case"columns":u=n.columns}i.Grid.Inject(i.Edit,i.Page,i.Toolbar,i.ForeignKey),(n=Si({},n,d)).toolbar=p.concat(n.toolbar);var g=this.updateColumns(u,n.columns);n.columns=g;var f=new i.Grid(n),m=this.createDivElement("",a.element.id+""+t+"TabContainer");return f.appendTo(m),m},a.prototype.renderGeneralTab=function(t,i){var r,a,n,s=this.parent,o=[],l=this.beforeOpenArgs[t];r=i?this.createDivElement("e-edit-form-row",s.element.id+""+t+"TabContainer"):this.createFormElement("e-edit-form-row",s.element.id+""+t+"TabContainer"),this.parent.enableAdaptiveUI&&(r.style.height="100%",(a=(0,e.createElement)("table",{className:"e-table"})).style.width="100%",n=(0,e.createElement)("tbody"));for(var d=r.id,h=0,p=Object.keys(l);h<p.length;h++){var u=p[h];if(!1!==this.parent.columnByField[u].visible){var c=this.parent.columnByField[u],g=l[u];this.parent.enableAdaptiveUI?n.appendChild(this.renderInputElements(g,c)):r.appendChild(this.renderInputElements(g,c)),o.push(u)}}this.parent.enableAdaptiveUI&&(a.appendChild(n),r.appendChild(a)),d!==r.id&&(r.id=d);var f=this.getDialogTabIndex("General"),m=[];if(this.isEdit||(0,e.isNullOrUndefined)(this.parent.addDialogFields[f])||(0,e.isNullOrUndefined)(this.parent.addDialogFields[f].fields)?!this.isEdit||(0,e.isNullOrUndefined)(this.parent.editDialogFields[f])||(0,e.isNullOrUndefined)(this.parent.editDialogFields[f].fields)||(m=this.parent.editDialogFields[f].fields):m=this.parent.addDialogFields[f].fields,!(0,e.isNullOrUndefined)(m)){var y=m.filter((function(e){return!o.includes(e)}));if(!(0,e.isNullOrUndefined)(y))for(var D=y,v=0;v<=D.length-1;v++){var k=document.getElementById(D[v]);if(!(0,e.isNullOrUndefined)(k)){var w=k.innerHTML,b=(0,e.createElement)("div");b.innerHTML=w,r.appendChild(b.children[0])}}}return r},a.prototype.isCheckIsDisabled=function(t){var i,r=!1;if(!1===t.allowEditing||t.isPrimaryKey||this.parent.readOnly)if(-1!==this.parent.customColumns.indexOf(t.field))r=!0;else if(t.field===this.parent.taskFields.id||t.field===this.parent.taskFields.name||t.field===this.parent.taskFields.duration||t.field===this.parent.taskFields.progress||t.field===this.parent.taskFields.startDate||t.field===this.parent.taskFields.endDate||t.field===this.parent.taskFields.baselineStartDate||t.field===this.parent.taskFields.baselineEndDate||t.field===this.parent.taskFields.work||t.field===this.parent.taskFields.type){for(var a=0;a<this.parent.currentViewData.length;a++)if(!(0,e.isNullOrUndefined)(this.parent.currentViewData[a].ganttProperties.taskId)){i=this.parent.currentViewData[a].ganttProperties.taskId;break}r="string"!=typeof i}return this.isEdit&&(t.field===this.parent.taskFields.id&&(r=!0),this.editedRecord.hasChildRecords&&(t.field===this.parent.taskFields.endDate&&(!(0,e.isNullOrUndefined)(this.editedRecord.isManual)&&!1===this.editedRecord.isManual||"Auto"===this.parent.taskMode)||t.field===this.parent.taskFields.duration||t.field===this.parent.taskFields.progress||t.field===this.parent.taskFields.work||t.field===this.parent.taskFields.type)&&(r=!0)),r},a.prototype.isParentValid=function(e){if(e.length>0)for(var t=0;t<e.length;t++){if(e[t].uniqueID===this.beforeOpenArgs.rowData.uniqueID){this.isValidData=!1;break}if(e[t].hasChildRecords&&this.isParentValid(e[t].childRecords),!this.isValidData)break}return this.isValidData},a.prototype.renderPredecessorTab=function(t){var a=this,n=this.parent,s=this.beforeOpenArgs[t],o=this.parent.columnByField[this.parent.taskFields.dependency];(!1===o.allowEditing||o.isPrimaryKey||this.parent.readOnly)&&(s.editSettings.allowEditing=!1,s.editSettings.allowAdding=!1,s.editSettings.allowDeleting=!1);var l,d=this.beforeOpenArgs.rowData,h=[];this.taskNameCollection(),this.isEdit&&(h=this.predecessorEditCollection(d),this.updatePredecessorDropDownData(d)),d[this.parent.taskFields.dependency]&&(l=d[this.parent.taskFields.dependency].split(",").length),0!==this.preTableCollection.length&&this.preTableCollection.length!==l||(s.editSettings.allowAdding=!1),s.actionComplete=this.gridActionComplete.bind(this),s.dataSource=h,s.enableAdaptiveUI=this.parent.enableAdaptiveUI,s.actionBegin=this.gridActionBegin.bind(this),s.columns[1].edit={write:function(t){"add"===(0,e.getValue)("requestType",t)&&(0,e.setValue)("rowData.uniqueId",D(),t);new Pi.ComboBox({dataSource:new r.DataManager(a.idCollection),popupHeight:"180px",allowCustom:!1,enableRtl:a.parent.enableRtl,fields:{value:"text"},value:t.rowData.name,change:function(t){var i=(0,e.closest)(t.element,"tr").querySelector("#"+a.parent.element.id+"DependencyTabContainerid");i&&((0,e.isNullOrUndefined)(t.itemData)||(0,e.isNullOrUndefined)(t.item)?i.value="":i.value=t.itemData.id)},autofill:!0}).appendTo(t.element)},read:function(e){return e.ej2_instances[0].value}};var p,u=this.getDialogTabIndex("Dependency");this.isEdit?this.isEdit&&(p=this.parent.editDialogFields[u]):p=this.parent.addDialogFields[u];var c,g=[],f=[];if(!(0,e.isNullOrUndefined)(p)&&!(0,e.isNullOrUndefined)(p.additionalParams))for(var m in c=p.additionalParams)if(Object.prototype.hasOwnProperty.call(c,m))switch(m){case"allowFiltering":i.Grid.Inject(i.Filter);break;case"allowSorting":i.Grid.Inject(i.Sort);break;case"allowPaging":i.Grid.Inject(i.Page);break;case"allowGrouping":i.Grid.Inject(i.Group);break;case"editSettings":i.Grid.Inject(i.Edit);break;case"aggregates":i.Grid.Inject(i.Aggregate);break;case"showColumnChooser":i.Grid.Inject(i.ColumnChooser);break;case"showColumnMenu":i.Grid.Inject(i.ColumnMenu);break;case"contextMenuItems":i.Grid.Inject(i.ContextMenu);break;case"allowResizing":i.Grid.Inject(i.Resize);break;case"allowReordering":i.Grid.Inject(i.Reorder);break;case"detailTemplate":i.Grid.Inject(i.DetailRow);break;case"allowRowDragAndDrop":i.Grid.Inject(i.RowDD);break;case"searchSettings":i.Grid.Inject(i.Search);break;case"selectionSettings":i.Grid.Inject(Selection);break;case"toolbar":c.toolbar.map((function(e){switch(e){case"Search":i.Grid.Inject(i.Search);break;case"Print":i.Grid.Inject(i.Print);break;case"PdfExport":i.Grid.Inject(i.PdfExport);break;case"ExcelExport":i.Grid.Inject(i.ExcelExport)}})),g=s.toolbar,i.Grid.Inject(i.Toolbar);break;case"enableVirtualization":i.Grid.Inject(_e.VirtualScroll);break;case"columns":f=s.columns}i.Grid.Inject(i.Edit,i.Page,i.Toolbar,i.ForeignKey),(s=Si({},s,c)).toolbar=s.toolbar.concat(g);var y=this.updateColumns(f,s.columns);s.columns=y;var v=new i.Grid(s),k=this.createDivElement("e-dependent-div",n.element.id+""+t+"TabContainer");return v.appendTo(k),k},a.prototype.updateColumns=function(e,t){var i={};return e.forEach((function(e){"object"==typeof e&&(i[e.field]=e)})),t.forEach((function(t){if("object"==typeof t){var r=t.field;i[r]?Object.assign(i[r],t):e.push(t)}})),e},a.prototype.gridActionBegin=function(t){var i=this,r=this.beforeOpenArgs.Dependency;if("add"===t.requestType||"beginEdit"===t.requestType){var a="add"!==t.requestType;this.idCollection=(0,e.extend)([],[],this.preTableCollection,!0);for(var n=r.dataSource,s=function(r){o.idCollection.forEach((function(s,o){if(s.id===(0,e.getValue)("id",n[r])){var l=(0,e.getValue)("rowData",t);if(a&&(0,e.getValue)("id",l)===s.id)return;i.idCollection.splice(i.idCollection.indexOf(s),1)}}))},o=this,l=0;l<=n.length;l++)s(l)}},a.prototype.gridActionComplete=function(t){if("save"===t.requestType){var i=this.parent.editModule.dialogModule.dialog.querySelector("#"+this.parent.element.id+"DependencyTabContainer");if(!(0,e.isNullOrUndefined)(i)&&!(0,e.isNullOrUndefined)(t.rows)&&t.rows.length===this.preTableCollection.length){var r=i.ej2_instances[0];r&&(r.editSettings.allowAdding=!1)}}},a.prototype.updateResourceCollection=function(t,i){if(!(0,e.isNullOrUndefined)(t.data)&&Object.keys(t.data).length){var r=document.querySelector("#"+i).ej2_instances[0];if(!(0,e.isNullOrUndefined)(r)&&r.getSelectedRecords().length>0){var a=r.getSelectedRecords(),n=void 0,s=[];for(n=0;n<a.length;n++)s.push(a[n].taskData);this.ganttResources=(0,e.extend)([],s)}else this.ganttResources=[]}else this.ganttResources=[]},a.prototype.renderResourceTab=function(t){var r=this,a=this.parent,n=a.resourceFields,s=this.beforeOpenArgs.rowData;("beforeOpenEditDialog"===this.beforeOpenArgs.requestType&&!(0,e.isNullOrUndefined)(this.editedRecord[this.parent.taskFields.resourceInfo])||"beforeOpenAddDialog"===this.beforeOpenArgs.requestType&&!(0,e.isNullOrUndefined)(this.editedRecord[this.parent.taskFields.resourceInfo]))&&"object"==typeof this.editedRecord[this.parent.taskFields.resourceInfo]&&this.parent.setRecordValue("resourceInfo",this.parent.dataOperation.setResourceInfo(this.editedRecord),s.ganttProperties,!0);var o=s.ganttProperties.resourceInfo,l=this.beforeOpenArgs[t];l.enableAdaptiveUI=this.parent.enableAdaptiveUI;var d=a.element.id+""+t+"TabContainer",h=[];if("ResourceView"===this.parent.viewType)for(var p=0;p<a.currentViewData.length;p++)for(var u=0;u<a.resources.length;u++)a.currentViewData[p][a.taskFields.id]===a.resources[u][n.id]&&(a.currentViewData[p].hasChildRecords||(0,e.isNullOrUndefined)(a.currentViewData[p].parentItem))&&h.push(a.resources[u]);else h=(0,e.extend)([],[],a.resources,!0);if(this.parent.dataOperation.updateResourceUnit(h),!(0,e.isNullOrUndefined)(o)){var c=void 0,g=o.length,f=void 0,m=h.length;for(c=0;c<g;c++)for(f=0;f<m;f++)o[c][n.id]===h[f][n.id]&&(h[f][n.unit]=o[c][n.unit])}l.dataSource=h;var y=s.ganttProperties.resourceInfo;if(this.isEdit&&!(0,e.isNullOrUndefined)(y))for(p=0;p<y.length;p++)this.ganttResources.push(y[p]);else if(!this.isEdit&&!(0,e.isNullOrUndefined)(y))for(p=0;p<y.length;p++)this.ganttResources.push(y[p]);l.actionBegin=function(e){if(e.rowData&&e.columnName===r.parent.resourceFields.unit&&r.editedRecord.ganttProperties.resourceInfo)for(var t=0;t<r.editedRecord.ganttProperties.resourceInfo.length;t++)r.editedRecord.ganttProperties.resourceInfo[t][r.parent.resourceFields.id]===e.rowData[r.parent.resourceFields.id]&&(r.editedRecord.ganttProperties.resourceInfo[t][r.parent.resourceFields.unit]=e.value)},l.rowSelected=function(e){r.updateResourceCollection(e,d),r.currentResources=r.ganttResources},l.rowDeselected=function(e){r.updateResourceCollection(e,d),r.currentResources=r.ganttResources};var D,v,k=this.createDivElement("e-resource-div",d),w=this.getDialogTabIndex("Resources");this.isEdit?this.isEdit&&(D=this.parent.editDialogFields[w]):D=this.parent.addDialogFields[w];var b,T=[];if(!(0,e.isNullOrUndefined)(D)&&!(0,e.isNullOrUndefined)(D.additionalParams))for(var p in v=D.additionalParams)if(Object.prototype.hasOwnProperty.call(v,p))switch(p){case"allowFiltering":_e.TreeGrid.Inject(_e.Filter);break;case"allowSorting":_e.TreeGrid.Inject(_e.Sort);break;case"allowPaging":_e.TreeGrid.Inject(_e.Page);break;case"editSettings":_e.TreeGrid.Inject(_e.Edit);break;case"aggregates":case"showColumnChooser":_e.TreeGrid.Inject(_e.Aggregate);break;case"showColumnMenu":_e.TreeGrid.Inject(i.ColumnMenu);break;case"contextMenuItems":_e.TreeGrid.Inject(i.ContextMenu);break;case"allowResizing":_e.TreeGrid.Inject(_e.Resize);break;case"allowReordering":_e.TreeGrid.Inject(_e.Reorder);break;case"detailTemplate":_e.TreeGrid.Inject(i.DetailRow);break;case"allowRowDragAndDrop":_e.TreeGrid.Inject(_e.RowDD);break;case"searchSettings":_e.TreeGrid.Inject(i.Search);break;case"selectionSettings":_e.TreeGrid.Inject(_e.Selection);break;case"toolbar":(b=v.toolbar).map((function(e){switch(e){case"Search":_e.TreeGrid.Inject(i.Search);break;case"Print":_e.TreeGrid.Inject(i.Print);break;case"PdfExport":_e.TreeGrid.Inject(i.PdfExport);break;case"ExcelExport":_e.TreeGrid.Inject(i.ExcelExport)}})),(0,e.isNullOrUndefined)(b)||(l.toolbar=[],l.toolbar=l.toolbar.concat(b)),_e.TreeGrid.Inject(_e.Toolbar);break;case"enableVirtualization":_e.TreeGrid.Inject(_e.VirtualScroll);break;case"columns":T=l.columns}_e.TreeGrid.Inject(_e.Selection,_e.Filter,_e.Edit,_e.VirtualScroll,_e.Toolbar),l=Si({},l,v);var P=this.updateColumns(T,l.columns);l.columns=P;var S=new _e.TreeGrid(l),C=this.parent.columnByField[this.parent.taskFields.resourceInfo];return(!1===C.allowEditing||C.isPrimaryKey||this.parent.readOnly)&&(S.allowSelection=!1,S.allowFiltering=!1,S.editSettings.allowEditing=!1),S.dataBound=function(){if(r.parent.editDialogFields.length>=1&&"Resources"===r.parent.editDialogFields[0].type){var e=r.parent.element.id+"ResourcesTabContainer";r.resourceSelection(e)}},S.appendTo(k),k},a.prototype.resourceSelection=function(t){var i=this,r=document.querySelector("#"+t).ej2_instances[0],a=r.getCurrentViewRecords(),n=this.ganttResources;n&&n.length>0&&a.forEach((function(t,a){for(var s=0;s<n.length;s++)t.taskData[i.parent.resourceFields.id]!==n[s][i.parent.resourceFields.id]||(0,e.isNullOrUndefined)(r.selectionModule)||-1!==r.getSelectedRowIndexes().indexOf(a)||r.selectRow(a)}))},a.prototype.renderCustomTab=function(e,t){return this.renderGeneralTab(e,t)},a.prototype.renderNotesTab=function(t){var i=this.parent,r=this.beforeOpenArgs[t];r.enableHtmlSanitizer=this.parent.enableHtmlSanitizer;var a,n,s=this.editedRecord.ganttProperties,o=this.createDivElement("",i.element.id+""+t+"TabContainer"),l=this.getDialogTabIndex("Notes"),d=[];if(this.isEdit?this.isEdit&&(a=this.parent.editDialogFields[l]):a=this.parent.addDialogFields[l],!(0,e.isNullOrUndefined)(a)&&!(0,e.isNullOrUndefined)(a.additionalParams))for(var h in n=a.additionalParams)if(Object.prototype.hasOwnProperty.call(n,h))switch(h){case"toolbarSettings":for(var p in n.toolbarSettings.items)if(Object.prototype.hasOwnProperty.call(n.toolbarSettings.items,p))switch(p){case"Image":ki.RichTextEditor.Inject(ki.Image);break;case"CreateTable":ki.RichTextEditor.Inject(ki.Table);break;case"EmojiPicker":ki.RichTextEditor.Inject(ki.EmojiPicker);break;case"FileManager":ki.RichTextEditor.Inject(ki.FileManager);break;case"FormatPainter":ki.RichTextEditor.Inject(ki.FormatPainter)}(0,e.isNullOrUndefined)(n.toolbarSettings.items)||(d=r.toolbarSettings.items),ki.RichTextEditor.Inject(ki.Toolbar);break;case"editorMode":ki.RichTextEditor.Inject(ki.MarkdownEditor)}ki.RichTextEditor.Inject(ki.Toolbar,ki.Link,ki.HtmlEditor,ki.QuickToolbar,ki.Count,ki.Table),r.value=s.notes;var u=this.parent.columnByField[this.parent.taskFields.notes];return(!1===u.allowEditing||u.isPrimaryKey||this.parent.readOnly)&&(r.enabled=!1),(r=Si({},r,n)).toolbarSettings.items=d.concat(r.toolbarSettings.items),new ki.RichTextEditor(r).appendTo(o),o},a.prototype.renderInputElements=function(t,r){var a,n,s,o=this,l=this.parent.element.id,d=this.editedRecord,h=this.createDivElement("e-edit-form-column");this.parent.enableAdaptiveUI&&(n=(0,e.createElement)("tr"),s=(0,e.createElement)("td"),h.style.width="100%");var p={column:r,data:d};if(!(0,e.isNullOrUndefined)(r.edit)&&(0,e.isNullOrUndefined)(r.edit.params)){var u=r.edit.create;(a="string"==typeof u?(u=(0,i.getObject)(u,window))(p):r.edit.create(p)).className="",a.setAttribute("type","text"),a.setAttribute("id",l+""+r.field),a.setAttribute("name",r.field),a.setAttribute("title",r.field),h.appendChild(a)}else a=this.createInputElement("",l+""+r.field,r.field),h.appendChild(a);if(t.enabled=(0,e.isNullOrUndefined)(t.enabled)?!this.isCheckIsDisabled(r):t.enabled,r.field===this.parent.taskFields.duration)if((0,e.isNullOrUndefined)(r.valueAccessor)){if((0,e.isNullOrUndefined)(r.edit)){var c=d.ganttProperties;t.value=this.parent.dataOperation.getDurationString(c.duration,c.durationUnit)}}else if("string"==typeof r.valueAccessor){var g=(0,i.getObject)(r.valueAccessor,window);t.value=g(r.field,d,r)}else t.value=r.valueAccessor(r.field,d,r);else"booleanedit"===r.editType?!0===d[r.field]?t.checked=!0:t.checked=!1:this.parent.taskFields[r.field]||"numericedit"!==r.editType||""!==d[r.field]&&0!==d[r.field]?t.value=d[r.field]:t.value=0;if(!(0,e.isNullOrUndefined)(r.edit)&&(0,e.isNullOrUndefined)(r.edit.params)){var f=r.edit.write,m=void 0;m="string"==typeof f?(f=(0,i.getObject)(f,window))({column:r,rowData:d,element:a}):r.edit.write({column:r,rowData:d,element:a}),r.field===this.parent.taskFields.duration&&(m.change=function(e){o.validateScheduleFields(e,r,o.parent)})}else{(m=new this.inputs[r.editType](t)).appendTo(a)}return this.parent.enableAdaptiveUI?(s.appendChild(h),n.appendChild(s),n):h},a.prototype.taskNameCollection=function(){var e=this.parent.flatData;this.preTaskIds=[],this.preTableCollection=[];for(var t=0;t<e.length;t++){var i=e[t];if(this.parent.allowParentDependency){var r=i;if(i.parentUniqueID===this.beforeOpenArgs.rowData.uniqueID)this.isValidData=!1;else do{if(r.parentItem&&(r=this.parent.flatData[this.parent.ids.indexOf(r.parentItem.taskId)]).uniqueID===this.beforeOpenArgs.rowData.uniqueID){this.isValidData=!1;break}}while(r.parentItem);if(i.hasChildRecords&&this.isValidData&&(this.isValidData=this.isParentValid(i.childRecords)),!this.isValidData){this.isValidData=!0;continue}}else if(i.hasChildRecords)continue;var a="ResourceView"===this.parent.viewType?i.ganttProperties.taskId.toString():i.ganttProperties.rowUniqueID.toString(),n={id:a,text:a+"-"+i.ganttProperties.taskName,value:a};this.preTaskIds.push(n.id),this.preTableCollection.push(n)}},a.prototype.predecessorEditCollection=function(t){var i=[],r=t.ganttProperties;if(this.isEdit&&!(0,e.isNullOrUndefined)(this.parent.taskFields.dependency)&&!(0,e.isNullOrUndefined)(t)&&!(0,e.isNullOrUndefined)(r.predecessor))for(var a=r.predecessor,n=this.preTableCollection,s=0;s<a.length;s++){var o=a[s].from.toString(),l={};if(("ResourceView"===this.parent.viewType?r.taskId:r.rowUniqueID).toString()!==o){l.id=o;for(var d=0;d<n.length;d++)if(n[d].value===o){l.name=n[d].text;break}l.type=a[s].type;var h=a[s].offset,p=a[s].offsetUnit;l.offset=this.parent.dataOperation.getDurationString(h,p),l.uniqueId=D(),i.push(l)}}return i},a.prototype.updatePredecessorDropDownData=function(e){var t,i="ResourceView"===this.parent.viewType?e.ganttProperties.taskId.toString():e.ganttProperties.rowUniqueID.toString();t=this.preTaskIds.indexOf(i),this.preTableCollection.splice(t,1),this.preTaskIds.splice(t,1),this.validSuccessorTasks(e,this.preTaskIds,this.preTableCollection)},a.prototype.validSuccessorTasks=function(e,t,i){var r=this,a=e.ganttProperties;if(a.predecessor&&a.predecessor.length>0){var n=a.predecessor,s="ResourceView"===this.parent.viewType?a.taskId.toString():a.rowUniqueID.toString();n.forEach((function(e){if(e.from.toString()===s){var a,n=e.to;(a=t.indexOf(n))>-1&&(t.splice(a,1),i.splice(a,1));for(var o=r.parent.connectorLineModule.getRecordByID(n),l=!0,d=0,h=r.processedId;d<h.length;d++){var p=h[d];if(p.id===o.ganttProperties.taskId&&Array.isArray(p.value)&&Array.isArray(o.ganttProperties.predecessor)&&p.value.length===o.ganttProperties.predecessor.length){for(var u=!0,c=0;c<p.value.length;c++)if(p.value[c]!==o.ganttProperties.predecessor[c]){u=!1;break}if(u){l=!1;break}}}l&&(r.processedId.push({id:o.ganttProperties.taskId,value:o.ganttProperties.predecessor}),r.validSuccessorTasks(o,t,i))}}))}},a.prototype.getPredecessorType=function(){var e=[this.parent.getPredecessorTextValue("SS"),this.parent.getPredecessorTextValue("SF"),this.parent.getPredecessorTextValue("FS"),this.parent.getPredecessorTextValue("FF")];return[{id:"FS",text:e[2],value:e[2]},{id:"FF",text:e[3],value:e[3]},{id:"SS",text:e[0],value:e[0]},{id:"SF",text:e[1],value:e[1]}]},a.prototype.initiateDialogSave=function(){if(this.isEdit?this.parent.initiateEditAction(!0):this.addedRecord={},this.currentResources&&(this.currentResources=null),this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Edit")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.isEdit)){this.parent.undoRedoModule.createUndoCollection();var t={action:"DialogEdit",modifiedRecords:[]};if(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=t,"ResourceView"===this.parent.viewType){var i=!1;if(this.rowData.ganttProperties.resourceInfo){if(this.ganttResources.length!==this.rowData.ganttProperties.resourceInfo.length)i=!0;else for(var r=0;r<this.rowData.ganttProperties.resourceInfo.length;r++)if(this.ganttResources[r][this.parent.resourceFields.id]!==this.rowData.ganttProperties.resourceInfo[r][this.parent.resourceFields.id]){i=!0;break}}else this.ganttResources.length>0&&(i=!0);if(i){var a={deletedIndexes:[]},n="T"+this.rowData.ganttProperties.taskId,s=[];this.parent.taskIds.reduce(function(e,t){if(e===n)if(0===this.ganttResources.length)s.push(this.parent.flatData[t]);else for(var i=this.parent.getTaskByUniqueID(this.parent.flatData[t].parentUniqueID),r=0;r<this.ganttResources.length;r++)i.ganttProperties.taskId!==this.ganttResources[r][this.parent.resourceFields.id]&&-1===s.indexOf(this.parent.flatData[t])&&s.push(this.parent.flatData[t])}.bind(this),[]),this.parent.undoRedoModule.findPosition((0,e.extend)([],[],s,!0),a,"deletedIndexes"),this.indexes?this.indexes.deletedIndexes[this.indexes.deletedIndexes.length]=a.deletedIndexes[0]:this.indexes=a}}}var o=this.parent,l=this.beforeOpenArgs.tabModel.items;for(r=0;r<l.length;r++){var d=l[r].content,h=d.getAttribute("id");(0,e.isNullOrUndefined)(h)&&""===h||("General"===(h=(h=h.replace(o.element.id,"")).replace("TabContainer",""))?this.updateGeneralTab(d,!1):"Dependency"===h?this.updatePredecessorTab(d):"Notes"===h?this.updateNotesTab(d):"Resources"===h?this.updateResourceTab(d):-1!==h.indexOf("Custom")?this.updateCustomTab(d):"Segments"===h&&this.updateSegmentsData(d))}if(!this.disableUndo&&this.parent.undoRedoModule&&(this.parent.undoRedoModule.getUndoCollection.splice(this.parent.undoRedoModule.getUndoCollection.length-1,1),this.parent.toolbarModule&&0===this.parent.undoRedoModule.getUndoCollection.length&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1),this.parent.totalUndoAction--),this.isEdit){this.parent.editModule.editedRecord=this.rowData,this.parent.dataOperation.updateWidthLeft(this.rowData);var p={data:this.rowData,action:"DialogEditing"};this.parent.editModule.initiateUpdateAction(p)}else if(this.parent.editModule.editedRecord=this.addedRecord,"ResourceView"===this.parent.viewType){var u=(0,e.extend)({},this.addedRecord,!0);if(u[this.parent.taskFields.resourceInfo].length)for(r=0;r<u[this.parent.taskFields.resourceInfo].length;r++){h=u[this.parent.taskFields.resourceInfo][r].toString();var c=this.parent.getTaskIds().indexOf("R"+h.toString());if(-1!==c){this.parent.editModule.addRecord(this.addedRecord,"Child",c);break}}else this.parent.editModule.addRecord(this.addedRecord,"Bottom")}else this.parent.editModule.addRecord(this.addedRecord,this.parent.editSettings.newRowPosition,this.parent.selectedRowIndex);return!0},a.prototype.updateSegmentTaskData=function(e){var t=this.parent.taskFields;this.isEdit?(this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,e,this.rowData),this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(this.rowData,!0),this.rowData.ganttProperties,!0),this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(this.rowData,!1),this.rowData.ganttProperties,!0),e.length<=0&&this.validateDuration(this.rowData)):this.addedRecord[t.segments]=e},a.prototype.updateSegmentsData=function(e){var t,i=e.ej2_instances[0],r=i.isEdit;i.isEdit&&i.endEdit(),t=r&&i.currentViewData.length!==i.dataSource.length?i.dataSource:i.currentViewData,this.updateSegmentTaskData(t)},a.prototype.updateGeneralTab=function(t,r){var a=this.parent,n=t.childNodes,s={};this.isEdit||(s=this.addedRecord);for(var o=0;o<n.length;o++){var l=n[o],d=l.querySelector('input[id^="'+a.element.id+'"]')||l.querySelector('textarea[id^="'+a.element.id+'"]');if(d){var h=d.id.replace(a.element.id,""),p=l.querySelector("#"+a.element.id+h).ej2_instances[0];if("stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType&&h===this.parent.taskFields.id){var u=p.value.toString();p.value=u}var c=a.columnByField[h];if((h===this.parent.taskFields.duration?parseInt(this.rowData[h],10)!==parseInt(p.value,10):this.rowData[h]!==p.value)&&(this.disableUndo=!0),(0,e.isNullOrUndefined)(c)||(0,e.isNullOrUndefined)(c.edit)||!(0,e.isNullOrUndefined)(c.edit.params))if((0,e.isNullOrUndefined)(c)||"booleanedit"!==c.editType){if(h===this.parent.taskFields.duration){var g=parseFloat(String(p.value));s[h]=g}else if(this.parent.weekWorkingTime.length>0&&p.value&&(h===this.parent.taskFields.startDate||h===this.parent.taskFields.baselineStartDate)){var f=h===this.parent.taskFields.startDate?this.beforeOpenArgs.rowData.ganttProperties.startDate:this.beforeOpenArgs.rowData.ganttProperties.baselineStartDate;if(this.parent.getStartTime(f)/3600===f.getHours()){var m=this.parent.getStartTime(p.value);this.parent.dataOperation.setTime(m,p.value),s[h]=p.value}else s[h]=p.value}else s[h]=p.value;this.parent.enableHtmlSanitizer&&"string"==typeof p.value&&(p.value=e.SanitizeHtmlHelper.sanitize(p.value),s[h]=p.value)}else d instanceof HTMLInputElement&&!0===d.checked?s[h]=!0:s[h]=!1;else{var y=c.edit.read;"string"==typeof y?(y=(0,i.getObject)(y,window),s[h]=y(d,p.value)):s[h]=c.edit.read(d,p.value)}}}this.isEdit&&(r||this.updateScheduleProperties(this.editedRecord,this.rowData),a.editModule.validateUpdateValues(s,this.rowData,!0))},a.prototype.updateScheduleProperties=function(t,i){this.parent.setRecordValue("startDate",t.ganttProperties.startDate,i.ganttProperties,!0),this.parent.setRecordValue("endDate",t.ganttProperties.endDate,i.ganttProperties,!0),this.parent.setRecordValue("duration",t.ganttProperties.duration,i.ganttProperties,!0),this.parent.setRecordValue("durationUnit",t.ganttProperties.durationUnit,i.ganttProperties,!0),this.parent.setRecordValue("work",t.ganttProperties.work,i.ganttProperties,!0),this.parent.setRecordValue("type",t.ganttProperties.taskType,i.ganttProperties,!0),this.parent.setRecordValue("taskType",t.ganttProperties.taskType,i.ganttProperties,!0),this.parent.setRecordValue("resourceNames",t.ganttProperties.resourceNames,i.ganttProperties,!0),this.parent.setRecordValue("resourceInfo",t.ganttProperties.resourceInfo,i.ganttProperties,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.startDate)||this.parent.dataOperation.updateMappingData(i,this.parent.taskFields.startDate),(0,e.isNullOrUndefined)(this.parent.taskFields.endDate)||this.parent.dataOperation.updateMappingData(i,this.parent.taskFields.endDate),(0,e.isNullOrUndefined)(this.parent.taskFields.duration)||(this.parent.dataOperation.updateMappingData(i,this.parent.taskFields.duration),this.parent.setRecordValue("durationUnit",t.ganttProperties.durationUnit,this.rowData,!0),0===this.rowData.ganttProperties.duration?this.parent.setRecordValue("isMilestone",!0,i.ganttProperties,!0):this.parent.setRecordValue("isMilestone",!1,this.rowData.ganttProperties,!0)),(0,e.isNullOrUndefined)(this.parent.taskFields.work)||this.parent.dataOperation.updateMappingData(this.rowData,this.parent.taskFields.work),(0,e.isNullOrUndefined)(this.parent.taskFields.manual)||this.parent.dataOperation.updateMappingData(this.rowData,this.parent.taskFields.manual),(0,e.isNullOrUndefined)(this.parent.taskFields.type)||this.parent.dataOperation.updateMappingData(this.rowData,"type"),(0,e.isNullOrUndefined)(this.parent.taskFields.resourceInfo)||this.parent.dataOperation.updateMappingData(this.rowData,"resourceInfo")},a.prototype.updatePredecessorTab=function(t){var i=t.ej2_instances[0];i.isEdit&&i.endEdit();for(var r=i.dataSource,a=[],n=[],s="",o=[],l=[],d=0;d<r.length;d++){var h=r[d],p=h.name.split("-");if(((0,e.isNullOrUndefined)(h.id)||h.id!==p[0])&&(h.id=p[0]),-1===o.indexOf(h.id)){if("ProjectView"===this.parent.viewType){var u=this.parent.flatData[this.parent.ids.indexOf(h.id)];u.hasChildRecords&&-1===l.indexOf(u)&&l.push(u)}var c=h.id+h.type;h.offset&&-1!==h.offset.indexOf("-")?c+=h.offset:c+="+"+h.offset,a.push(c),o.push(h.id)}}this.isEdit?(a.length>0?(n=this.parent.predecessorModule.calculatePredecessor(a.join(","),this.rowData),this.parent.setRecordValue("predecessor",n,this.rowData.ganttProperties,!0),s=this.parent.predecessorModule.getPredecessorStringValue(this.rowData)):(n=[],this.parent.setRecordValue("predecessor",n,this.rowData.ganttProperties,!0),s=""),this.parent.undoRedoModule&&this.parent.undoRedoModule.getUndoCollection.length>0&&(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1].connectedRecords=l,this.disableUndo||this.rowData.ganttProperties.predecessorsName===s||(0,e.isNullOrUndefined)(this.rowData.ganttProperties.predecessorsName)&&""===s||(this.disableUndo=!0)),this.parent.setRecordValue("predecessorsName",s,this.rowData.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,s,this.rowData),this.parent.setRecordValue(this.parent.taskFields.dependency,s,this.rowData),this.parent.predecessorModule.updateUnscheduledDependency(this.rowData)):this.addedRecord[this.parent.taskFields.dependency]=a.length>0?a.join(","):""},a.prototype.updateResourceTab=function(t){var i=t.ej2_instances[0];i&&i.grid.endEdit();var r=this.ganttResources;"ResourceView"!==this.parent.viewType||(0,e.isNullOrUndefined)(this.rowData.ganttProperties)||(JSON.stringify(this.ganttResources)!==JSON.stringify(this.rowData.ganttProperties.resourceInfo)?(this.isResourceUpdate=!0,this.previousResource=(0,e.isNullOrUndefined)(this.rowData.ganttProperties.resourceInfo)?[]:this.rowData.ganttProperties.resourceInfo.slice()):this.isResourceUpdate=!1);var a=[];if(this.isEdit){if((this.rowData.ganttProperties.resourceInfo&&r.length!==this.rowData.ganttProperties.resourceInfo.length||(0,e.isNullOrUndefined)(this.rowData.ganttProperties.resourceInfo)&&r.length>0)&&(this.disableUndo=!0),!this.disableUndo)for(var n=0;n<r.length;n++)if(JSON.stringify(r[n])!==JSON.stringify(this.rowData.ganttProperties.resourceInfo[n])){this.disableUndo=!0;break}this.parent.setRecordValue("resourceInfo",r,this.editedRecord.ganttProperties,!0),this.parent.dataOperation.updateMappingData(this.editedRecord,"resourceInfo"),this.parent.editModule.updateResourceRelatedFields(this.editedRecord,"resource"),this.validateDuration(this.editedRecord),this.updateScheduleProperties(this.editedRecord,this.rowData)}else{for(n=0;n<r.length;n++)a.push(r[n][this.parent.resourceFields.id]),this.isAddNewResource=!0;this.addedRecord[this.parent.taskFields.resourceInfo]=a}},a.prototype.updateNotesTab=function(e){var t=this.parent,i=e.ej2_instances[0];this.isEdit?(!1===t.columnByField[t.taskFields.notes].disableHtmlEncode?(this.rowData.ganttProperties.notes===i.getHtml()||null===this.rowData.ganttProperties.notes&&"<p><br></p>"===i.getHtml()||this.disableUndo||(this.disableUndo=!0),this.parent.setRecordValue("notes",i.getHtml(),this.rowData.ganttProperties,!0)):(this.rowData.ganttProperties.notes===i.getText()||null===this.rowData.ganttProperties.notes&&""===i.getText()||this.disableUndo||(this.disableUndo=!0),i.getHtml().includes("href")?this.parent.setRecordValue("notes",i.getHtml(),this.rowData.ganttProperties,!0):this.parent.setRecordValue("notes",i.getText(),this.rowData.ganttProperties,!0)),t.dataOperation.updateMappingData(this.rowData,"notes")):this.addedRecord[this.parent.taskFields.notes]=i.getHtml()},a.prototype.updateCustomTab=function(e){this.updateGeneralTab(e,!0)},a}(),Ri=function(){return Ri=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ri.apply(this,arguments)},Mi=function(){function i(e){this.validationPredecessor=null,this.confirmPredecessorDialog=null,this.predecessorIndex=null,this.childRecord=null,this.validatedId=[],this.validatedOffsetIds=[],this.parent=e,this.dateValidateModule=this.parent.dateValidationModule,this.parent.on("initPredessorDialog",this.initPredecessorValidationDialog,this)}return i.prototype.updateConnectorLineEditElement=function(t){var i=this.getConnectorLineHoverElement(t.target);(0,e.getValue)("editModule.taskbarEditModule.taskBarEditAction",this.parent)||this.highlightConnectorLineElements(i)},i.prototype.getConnectorLineHoverElement=function(e){var t=a(e,ke),i=a(e,Te),r=a(e,we),n=a(e,be);return t||i||r||n?a(e,ve):null},i.prototype.highlightConnectorLineElements=function(e){e?e!==this.connectorLineElement&&(this.removeHighlight(),this.addHighlight(e)):this.removeHighlight()},i.prototype.addHighlight=function(e){this.connectorLineElement=e;var t=e.querySelector("."+ke);t&&t.setAttribute("stroke-width","2")},i.prototype.removeHighlight=function(){if(this.connectorLineElement){var e=this.connectorLineElement.querySelector("."+ke);e&&e.setAttribute("stroke-width","1"),this.connectorLineElement=null}},i.prototype.getEditedConnectorLineString=function(t){for(var i,r,a,n,s,o=[],l=[],d="",h=0;h<t.length;h++)if(i=t[h].ganttProperties.predecessor){for(var p=0;p<i.length;p++){r=i[p];var u="from";if(this.parent.connectorLineModule.removeConnectorLineById("parent"+r[u]+"child"+r.to),a=this.parent.connectorLineModule.getRecordByID(r[""+u]),n=this.parent.connectorLineModule.getRecordByID(r.to),(!this.parent.allowParentDependency&&a&&!0===a.expanded||n&&!0===n.expanded||this.parent.allowParentDependency&&(a||n))&&(s=this.parent.predecessorModule.updateConnectorLineObject(a,n,r),!(0,e.isNullOrUndefined)(s))){var c=o.indexOf(s.connectorLineId),g=this.parent.connectorLineModule.getConnectorLineTemplate(s);-1!==c?l[c]=g:(o.push(s.connectorLineId),l.push(g))}}d=l.join("")}return d},i.prototype.refreshEditedRecordConnectorLine=function(e){this.parent.connectorLineModule.removePreviousConnectorLines(this.parent.previousRecords),this.parent.connectorLineModule.expandedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.updatedRecords:this.parent.getExpandedRecords(this.parent.updatedRecords);var t=this.getEditedConnectorLineString(e);this.parent.connectorLineModule.svgObject.innerHTML=this.parent.connectorLineModule.svgObject.innerHTML+t},i.prototype.idFromPredecessor=function(t){for(var i=t.split(","),r=[],a=[],n=[],s=0;s<i.length;s++){var o=[],l=void 0,d=!1,h=void 0,p=!1,u=i[s].split("-"),c=void 0;if(6===u.length&&(u[4]=u[4]+"-"+u[5],u.pop()),5===u.length&&u[4].length>=12&&(c=i[s].substring(0,36),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(c)&&(p=!0)),i[s].includes("-")&&(i[s].includes("-")&&i[s].includes("days")&&(h=i[s].slice(-9).toString()),h=i[s].includes("-")&&i[s].includes("day")?i[s].slice(-8).toString():i[s].slice(-2).toString(),i[s].includes("-")&&/[A-Za-z]/.test(h))){var g=i[s].indexOf(h);-1!==g&&(l=i[s].substring(0,g)).includes("-")&&(d=!0)}if(p){var f=void 0,m=void 0;1===(f=u[4].split("+")).length?a[0]=i[s]:(m=f[1].length,a[0]=i[s].slice(0,-(m+1)),a[1]=f[1]),u[4].indexOf("-")>=0&&(1===(f=u[4].split("-")).length?a[0]=i[s]:(m=f[1].length,a[0]=i[s].slice(0,-(m+1)),a[1]=f[1]))}else d&&l.includes("-")?a[0]=l:(a=i[s].split("+"),i[s].indexOf("-")>=0&&(a=i[s].split("-")));if(!(0,e.isNullOrUndefined)(a[0]))-1===("ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids).indexOf(a[0])?-1!==a[0].indexOf(" ")?(1===(n=a[0].split(" ")).length&&(n=a[0].match(/(\d+|[A-z]+)/g)),o.push(n[0])):1===a[0].length||2===a[0].length?o.push(a[0]):o.push(a[0].slice(0,-2)):o.push(a[0]);r.push(o.join(""))}return r},i.prototype.predecessorValidation=function(t,i){for(var r,a,n=i.rowUniqueID,s=0;s<t.length;s++){r=t[s];var o=[];t.slice(0).splice(s,1);for(var l=function(){var t=[];return-1!==o.indexOf(r)?"break":(0,e.isNullOrUndefined)(d.parent.connectorLineModule.getRecordByID(r))?{value:!1}:(a=d.parent.connectorLineModule.getRecordByID(r).ganttProperties,!(0,e.isNullOrUndefined)(a.predecessor)&&a.predecessor.length>0&&a.predecessor.forEach((function(e){a.rowUniqueID.toString()!==e.from&&t.push(e.from.toString())})),n.toString()===a.rowUniqueID.toString()||-1!==t.indexOf(n.toString())?{value:!1}:(o.push(r),!(0,e.isNullOrUndefined)(a.predecessor)&&a.predecessor.length>0?void(r=a.predecessor[0].from):"break"))},d=this;null!==r;){var h=l();if("object"==typeof h)return h.value;if("break"===h)break}}return!0},i.prototype.getRootParent=function(e){var t=e;return e.parentItem?((t=this.parent.flatData.filter((function(t){return t.uniqueID===e.parentUniqueID}))[0]).parentItem&&(t=this.getRootParent(t)),t):t},i.prototype.validateParentPredecessor=function(e,t){if(e&&t)if(t.hasChildRecords&&!e.hasChildRecords){if(e.parentUniqueID===t.uniqueID)return!1;do{if(e.parentItem&&(e=this.parent.flatData[this.parent.ids.indexOf(e.parentItem.taskId)]).uniqueID===t.uniqueID)return!1}while(e.parentItem)}else if(!t.hasChildRecords&&e.hasChildRecords){if(t.parentUniqueID===e.uniqueID)return!1;do{if(t.parentItem&&(t=this.parent.flatData[this.parent.ids.indexOf(t.parentItem.taskId)]).uniqueID===e.uniqueID)return!1}while(t.parentItem)}else if(t.hasChildRecords&&e.hasChildRecords){if(t.parentItem&&e.parentItem){if(e.parentUniqueID===t.uniqueID||e.uniqueID===t.parentUniqueID)return!1}else if(!t.parentItem&&e.parentItem){if(this.parent.connectorLineEditModule.getRootParent(e).uniqueID===t.uniqueID)return!1}else if(t.parentItem&&!e.parentItem){if(this.parent.connectorLineEditModule.getRootParent(t).uniqueID===e.uniqueID)return!1}}return!0},i.prototype.validatePredecessorRelation=function(t,i){var r,a,n=!0,s="ResourceView"===this.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID;if(!(0,e.isNullOrUndefined)(i)&&i.length>0){r=this.idFromPredecessor(i);for(var o=function(i){if(l.parent.allowParentDependency){if(parseInt(r[r.length-1],10)!==t[l.parent.taskFields.id]){var o=l.parent.ids.indexOf(r[r.length-1]),d=l.parent.currentViewData[o];d&&t&&(n=l.validateParentPredecessor(d,t))}}else if(!l.checkParentRelation(t,r))return{value:!1};var h=r.slice(0),p=[],u=!0;if(h.forEach((function(e){-1===p.indexOf(e)?p.push(e):u=!1})),!u)return{value:!1};a=r[i];var c=[];r.slice(0).splice(i,1);for(var g=function(){var i,r,n=[];if(-1!==c.indexOf(a))return"break";if((0,e.isNullOrUndefined)(l.parent.connectorLineModule.getRecordByID(a.toString())))return{value:!1};if(r=l.parent.connectorLineModule.getRecordByID(a.toString()).ganttProperties,!(0,e.isNullOrUndefined)(r.predecessor)&&r.predecessor.length>0&&r.predecessor.forEach((function(e,t){r.rowUniqueID.toString()!==e.from&&(n.push(e.from.toString()),i=t)})),s.toString()===r.rowUniqueID.toString()||-1!==n.indexOf(s.toString()))return{value:!1};if(c.push(a),(0,e.isNullOrUndefined)(r.predecessor)||!(r.predecessor.length>0))return"break";var o=void 0;return n.length>1?o=l.predecessorValidation(n,t.ganttProperties):1===n.length&&(a=r.predecessor[i].from),!1===o?{value:!1}:void 0};null!==a;){var f=g();if("object"==typeof f)return f;if("break"===f)break}},l=this,d=0;d<r.length;d++){var h=o(d);if("object"==typeof h)return h.value}}return n},i.prototype.addPredecessor=function(t,i){var r=(0,e.isNullOrUndefined)(t.ganttProperties.predecessorsName)||""===t.ganttProperties.predecessorsName?i:t.ganttProperties.predecessorsName+","+i;this.updatePredecessorHelper(t,r)},i.prototype.removePredecessor=function(e){this.updatePredecessorHelper(e,null)},i.prototype.updatePredecessor=function(e,t,i){return this.updatePredecessorHelper(e,t,i)},i.prototype.updatePredecessorHelper=function(t,i,r){if((0,e.isUndefined)(i)||this.validatePredecessorRelation(t,i)){this.parent.isOnEdit=!0;var a=[];(0,e.isNullOrUndefined)(i)||""===i||(a=this.parent.predecessorModule.calculatePredecessor(i,t)),this.parent.setRecordValue("predecessor",a,t.ganttProperties,!0);var n=this.parent.predecessorModule.getPredecessorStringValue(t);this.parent.setRecordValue("predecessorsName",n,t.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,n,t),this.parent.setRecordValue(this.parent.taskFields.dependency,n,t);var s={};return s.action=r&&r.action&&"CellEditing"===r.action?r.action:"DrawConnectorLine",s.data=t,this.parent.editModule.initiateUpdateAction(s),!0}t.taskData[this.parent.taskFields.dependency]&&(t.taskData[this.parent.taskFields.dependency]=null);var o=i+" is an invalid relation for task "+this.parent.taskFields.id+". Kindly ensure the "+this.parent.taskFields.dependency+" field contains only valid predecessor relations.";return this.parent.trigger("actionFailure",{error:o}),!1},i.prototype.checkParentRelation=function(e,t){var i=e;if(i&&i.parentItem&&-1!==t.indexOf(i.parentItem.taskId.toString()))return!1;for(var r=function(e){var i=a.parent.currentViewData.filter((function(i){return i&&i.ganttProperties.rowUniqueID.toString()===t[e].toString()}));if(i[0]&&i[0].hasChildRecords)return{value:!1}},a=this,n=0;n<t.length;n++){var s=r(n);if("object"==typeof s)return s.value}return!0},i.prototype.initPredecessorValidationDialog=function(){if(this.parent.taskFields.dependency&&this.parent.isInPredecessorValidation){var t=(0,e.createElement)("div",{id:this.parent.element.id+"_dialogValidationRule"});this.parent.element.appendChild(t),this.renderValidationDialog()}},i.prototype.renderValidationDialog=function(){var e=new t.Dialog({header:"Validate Editing",isModal:!0,enableRtl:this.parent.enableRtl,visible:!1,width:"50%",showCloseIcon:!0,close:this.validationDialogClose.bind(this),content:"",buttons:[{click:this.validationDialogOkButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("okText"),isPrimary:!0}},{click:this.validationDialogCancelButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],target:this.parent.element,animationSettings:{effect:"None"}});document.getElementById(this.parent.element.id+"_dialogValidationRule").innerHTML="",e.isStringTemplate=!0,e.appendTo("#"+this.parent.element.id+"_dialogValidationRule"),this.parent.validationDialogElement=e},i.prototype.validationDialogOkButton=function(){var e=this.parent.currentEditedArgs;e.validateMode.preserveLinkWithEditing=document.getElementById(this.parent.element.id+"_ValidationAddlineOffset").checked,e.validateMode.removeLink=document.getElementById(this.parent.element.id+"_ValidationRemoveline").checked,e.validateMode.respectLink=document.getElementById(this.parent.element.id+"_ValidationCancel").checked,this.applyPredecessorOption(),this.parent.validationDialogElement.hide()},i.prototype.validationDialogCancelButton=function(){this.parent.currentEditedArgs.validateMode.respectLink=!0,this.applyPredecessorOption(),this.parent.validationDialogElement.hide()},i.prototype.validationDialogClose=function(t){(0,e.getValue)("isInteraction",t)&&(this.parent.currentEditedArgs.validateMode.respectLink=!0,this.applyPredecessorOption())},i.prototype.applyPredecessorOption=function(){var e=this.parent.currentEditedArgs,t=e.data;if(e.validateMode.respectLink)this.parent.editModule.reUpdatePreviousRecords(),this.parent.chartRowsModule.refreshRecords([e.data]);else if(e.validateMode.removeLink)this.checkChildRecords(t),this.parent.editModule.updateEditedTask(e.editEventArgs);else if(e.validateMode.preserveLinkWithEditing){var i;if(this.parent.updateOffsetOnTaskbarEdit){var r=t.ganttProperties.taskId;t.ganttProperties.predecessor&&t.ganttProperties.predecessor.forEach((function(e){r!==e.from||(i=e.to)}))}this.parent.editModule.updateEditedTask(e.editEventArgs),this.processPredecessors(i)}},i.prototype.compareArrays=function(e,t){return e.length===t.length&&JSON.stringify(e)===JSON.stringify(t)},i.prototype.processPredecessors=function(e){var t=this;if(e){var i=this.parent.getRecordByID(e);if(i&&i.ganttProperties&&i.ganttProperties.predecessor){this.parent.connectorLineEditModule.validatedOffsetIds=[],this.calculateOffset(i);var r=!0,a=this.validatedId.find((function(e){return e.id===i.ganttProperties.taskId}));if(a){var n=a.value;this.compareArrays(n,i.ganttProperties.predecessor)&&(r=!1)}i.ganttProperties.predecessor.forEach((function(e){i.ganttProperties.taskId===e.from&&r&&t.processPredecessors(e.to)}))}}},i.prototype.checkChildRecords=function(t){if(this.validationPredecessor=t.ganttProperties.predecessor,(0,e.isNullOrUndefined)(this.validationPredecessor)||this.removePredecessors(t,this.validationPredecessor),t.childRecords.length>0)for(var i=0;i<t.childRecords.length;i++){var r=t.childRecords[i];this.validationPredecessor=r.ganttProperties.predecessor,(0,e.isNullOrUndefined)(this.validationPredecessor)||this.removePredecessors(r,this.validationPredecessor),r.childRecords.length>0&&this.checkChildRecords(r)}else if(!(0,e.isNullOrUndefined)(t.parentItem)){var a=this.parent.getRecordByID(t.parentItem.taskId);this.validationPredecessor=a.ganttProperties.predecessor,this.removePredecessors(a,this.validationPredecessor)}},i.prototype.compareObjects=function(e,t){var i=Object.keys(e).filter((function(e){return"offset"!==e})),r=Object.keys(t).filter((function(e){return"offset"!==e}));return i.length===r.length&&i.every((function(i){return e[i]===t[i]}))},i.prototype.calculateOffset=function(t,i){var r=this;if(this.parent.autoCalculateDateScheduling&&(!this.parent.isLoad||this.parent.treeGrid.loadChildOnDemand||!this.parent.taskFields.hasChildMapping)&&t){var a=(0,e.extend)([],t.ganttProperties.predecessor,[],!0),s=this.parent.predecessorModule.getValidPredecessor(t);if(s.length>0){this.cumulativePredecessorChanges=a;for(var o=function(i){var r=s[parseInt(i.toString(),10)],o=l.parent.connectorLineModule.getRecordByID(r.from);l.parent.undoRedoModule&&l.parent.undoRedoModule.isUndoRedoPerformed&&"ProjectView"===l.parent.viewType&&(0===o.ganttProperties.predecessor.filter((function(e){return e.from===s[i].from&&e.to===s[i].to})).length&&o.ganttProperties.predecessor.push(s[i]));var d=void 0;if(n(o.ganttProperties)&&n(t.ganttProperties)){var h=void 0,p=void 0,c=void 0,g=void 0;switch(r.type){case"FS":h=new Date(o.ganttProperties.endDate.getTime()),p=new Date(t.ganttProperties.startDate.getTime());break;case"SS":h=new Date(o.ganttProperties.startDate.getTime()),p=new Date(t.ganttProperties.startDate.getTime());break;case"SF":h=new Date(o.ganttProperties.startDate.getTime()),p=new Date(t.ganttProperties.endDate.getTime());break;case"FF":h=new Date(o.ganttProperties.endDate.getTime()),p=new Date(t.ganttProperties.endDate.getTime())}if(h.getTime()<p.getTime())h=l.dateValidateModule.checkStartDate(h),p=l.dateValidateModule.checkEndDate(p,null),g=!1;else{var f=new Date(h.getTime());h=l.dateValidateModule.checkStartDate(p),p=l.dateValidateModule.checkEndDate(f,null),g=!0}h.getTime()<p.getTime()?(c=l.dateValidateModule.getDuration(h,p,r.offsetUnit,!0,!1),d=g?-1*c:c):d=0}else d=0;var m=u(r,"from",a,"to");-1!==m&&(a[m].offset=d);var y=(0,e.extend)([],o.ganttProperties.predecessor,[],!0),D=u(r,"from",y,"to");-1!==D&&(y[D].offset=d),l.parent.setRecordValue("predecessor",y,o.ganttProperties,!0)},l=this,d=0;d<s.length;d++)o(d)}else{var h=t.ganttProperties.predecessor;h&&h.length>0&&h.forEach((function(e){-1===r.validatedOffsetIds.indexOf(e.to)&&r.calculateOffset(r.parent.getRecordByID(e.to),!0)}))}if(i)this.parent.setRecordValue("predecessor",a,t.ganttProperties,!0);else if(a&&a.length>0&&this.cumulativePredecessorChanges&&this.cumulativePredecessorChanges.length>0){var p=a.map((function(e){var t=r.cumulativePredecessorChanges.find((function(t){return r.compareObjects(t,e)}));return t?Ri({},t):null})).filter((function(e){return null!==e}));this.parent.setRecordValue("predecessor",p,t.ganttProperties,!0)}var c=this.parent.predecessorModule.getPredecessorStringValue(t);if(this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,c,t),this.parent.setRecordValue(this.parent.taskFields.dependency,c,t),this.parent.setRecordValue("predecessorsName",c,t.ganttProperties,!0),-1===this.validatedOffsetIds.indexOf(t.ganttProperties.taskId.toString())&&this.validatedOffsetIds.push(t.ganttProperties.taskId.toString()),t.hasChildRecords)for(d=0;d<t.childRecords.length;d++)-1===this.validatedOffsetIds.indexOf(t.childRecords[d].ganttProperties.taskId.toString())&&t.childRecords[d].ganttProperties.predecessor&&t.childRecords[d].ganttProperties.predecessor.length>0&&this.calculateOffset(t.childRecords[d]);else if(t.parentItem){var g=this.parent.getRecordByID(t.parentItem.taskId);-1===this.validatedOffsetIds.indexOf(g.ganttProperties.taskId.toString())&&g.ganttProperties.predecessor&&g.ganttProperties.predecessor.length>0&&this.calculateOffset(g)}}},i.prototype.removePredecessors=function(t,i){var r=(0,e.extend)([],[],t.ganttProperties.predecessor,!0);if(!(0,e.isNullOrUndefined)(i)){for(var a=i.length,n=0;n<a;n++){var s=this.parent.connectorLineModule.getRecordByID(i[n].from),o=(0,e.extend)([],[],s.ganttProperties.predecessor,!0),l=u(i[n],"from",r,"to");r.splice(l,1);var d=u(i[parseInt(n.toString(),10)],"from",o,"to");o.splice(d,1),this.parent.setRecordValue("predecessor",o,s.ganttProperties,!0)}if(r.length!==t.ganttProperties.predecessor.length){this.parent.setRecordValue("predecessor",r,t.ganttProperties,!0);var h=this.parent.predecessorModule.getPredecessorStringValue(t);this.parent.setRecordValue("predecessorsName",h,t.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,h,t),this.parent.setRecordValue(this.parent.taskFields.dependency,h,t)}}},i.prototype.openValidationDialog=function(e){var t=this.validationDialogTemplate(e);this.parent.validationDialogElement.setProperties({content:t}),this.parent.validationDialogElement.show()},i.prototype.validationDialogTemplate=function(t){var i,r=this.parent.element.id,a=(0,e.createElement)("div",{className:"e-ValidationContent"}),n=(0,e.getValue)("task",t),s=(0,e.getValue)("parentTask",t),o=(0,e.getValue)("violationType",t),l=n.ganttProperties.taskName,d=this.parent.getFormatedDate(n.ganttProperties.startDate,"MM/dd/yyyy"),h=[l,s.ganttProperties.taskName];"taskBeforePredecessor_FS"===o?i=this.parent.localeObj.getConstant("taskBeforePredecessor_FS"):"taskAfterPredecessor_FS"===o?i=this.parent.localeObj.getConstant("taskAfterPredecessor_FS"):"taskBeforePredecessor_SS"===o?i=this.parent.localeObj.getConstant("taskBeforePredecessor_SS"):"taskAfterPredecessor_SS"===o?i=this.parent.localeObj.getConstant("taskAfterPredecessor_SS"):"taskBeforePredecessor_FF"===o?i=this.parent.localeObj.getConstant("taskBeforePredecessor_FF"):"taskAfterPredecessor_FF"===o?i=this.parent.localeObj.getConstant("taskAfterPredecessor_FF"):"taskBeforePredecessor_SF"===o?i=this.parent.localeObj.getConstant("taskBeforePredecessor_SF"):"taskAfterPredecessor_SF"===o&&(i=this.parent.localeObj.getConstant("taskAfterPredecessor_SF"));var u='<div id="'+r+'_ValidationText">'+(i=p(i,h))+"<div>",c='<table><tr><td><input type="radio" id="'+r+'_ValidationCancel" name="ValidationRule" checked/><label for="'+r+'_ValidationCancel" id= "'+r+'_cancelLink">Cancel, keep the existing link</label></td></tr><tr><td><input type="radio" id="'+r+'_ValidationRemoveline" name="ValidationRule"/><label for="'+r+'_ValidationRemoveline" id="'+r+'_removeLink">Remove the link and move <b>'+l+"</b> to start on <b>"+d+'</b>.</label></td></tr><tr><td><input type="radio" id="'+r+'_ValidationAddlineOffset" name="ValidationRule"/><label for="'+r+'_ValidationAddlineOffset" id="'+r+'_preserveLink">Move the <b>'+l+"</b> to start on <b>"+d+"</b> and keep the link.</label></td></tr></table>";return a.innerHTML=u+c,a},i.prototype.validateTypes=function(t,i){var r,a,n,s,o=this.parent.predecessorModule.getValidPredecessor(t);this.validationPredecessor=[];var l=this.parent.predecessorModule.getPredecessorDate(t,o);n=i?i.ganttProperties:t.ganttProperties;for(var d=this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(l)?n.endDate:this.dateValidateModule.getEndDate(l,n.duration,n.durationUnit,n,!1),h=0;h<o.length;h++){r=this.parent.connectorLineModule.getRecordByID(o[h].from);var p=null;if("FS"===o[h].type){if(0!==this.parent.dateValidationModule.getDuration(l,n.startDate,this.parent.durationUnit,n.isAutoSchedule,n.isMilestone,!0)){var u=new Date(n.endDate),c=new Date(l);n.startDate<l?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_FS"):(n.startDate>l||this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)>c.setHours(0,0,0,0)||this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)<c.setHours(0,0,0,0))&&(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_FS")}}else if("SS"===o[h].type){u=new Date(n.endDate),c=new Date(l);n.startDate<l?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_SS"):n.startDate>l?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_SS"):this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)<c.setHours(0,0,0,0)?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_SS"):this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)>c.setHours(0,0,0,0)&&(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_SS")}else if("FF"===o[h].type){if(0!==this.parent.dateValidationModule.getDuration(n.endDate,r.ganttProperties.endDate,this.parent.durationUnit,r.ganttProperties.isAutoSchedule,r.ganttProperties.isMilestone,!0)){u=new Date(d),c=new Date(n.startDate);n.endDate<r.ganttProperties.endDate?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_FF"):n.endDate>r.ganttProperties.endDate||this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.endDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)>c.setHours(0,0,0,0)||this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.endDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)<c.setHours(0,0,0,0)?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_FF"):d<n.endDate?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_FF"):d>n.endDate&&(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_FF")}}else if("SF"===o[h].type&&0!==this.parent.dateValidationModule.getDuration(n.endDate,r.ganttProperties.startDate,this.parent.durationUnit,r.ganttProperties.isAutoSchedule,r.ganttProperties.isMilestone,!0)){u=new Date(d),c=new Date(n.startDate);var g=new Date(l);n.endDate<r.ganttProperties.startDate?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_SF"):n.endDate>r.ganttProperties.startDate?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_SF"):this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.endDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)>c.setHours(0,0,0,0)?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_SF"):this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.endDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)<c.setHours(0,0,0,0)?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_SF"):this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)>g.setHours(0,0,0,0)?(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskBeforePredecessor_SF"):this.parent.allowUnscheduledTasks&&(0,e.isNullOrUndefined)(n.startDate)&&(0,e.isNullOrUndefined)(n.duration)&&u.setHours(0,0,0,0)<g.setHours(0,0,0,0)&&(this.validationPredecessor.push(o[parseInt(h.toString(),10)]),p="taskAfterPredecessor_SF")}!(0,e.isNullOrUndefined)(p)&&(0,e.isNullOrUndefined)(s)&&(a=r,s=p)}return{parentTask:a,task:t,violationType:s}},i.prototype.addRemovePredecessor=function(t){var i=this.parent.previousRecords[t.uniqueID],r=t.ganttProperties.predecessor.slice();if(i&&i.ganttProperties&&i.ganttProperties.hasOwnProperty("predecessor")){var a=i.ganttProperties.predecessor;if(!(0,e.isNullOrUndefined)(a))for(var n=function(i){var r=s.parent.connectorLineModule.getRecordByID(a[parseInt(i.toString(),10)].from);if(r===t){0===t.ganttProperties.predecessor.filter((function(e){return a[i].from===e.from&&a[i].to===e.to})).length&&(t.parentItem&&s.parent.taskFields.dependency&&t.ganttProperties.predecessor&&s.parent.allowParentDependency?a[i].from!==t.parentItem.taskId&&a[i].to!==t.parentItem.taskId&&t.ganttProperties.predecessor.push(a[parseInt(i.toString(),10)]):t.ganttProperties.predecessor.push(a[parseInt(i.toString(),10)]))}else{var n=(0,e.extend)([],[],r.ganttProperties.predecessor,!0),o=u(a[parseInt(i.toString(),10)],"from",n,"to");-1!==o&&(n.splice(o,1),s.parent.setRecordValue("predecessor",n,r.ganttProperties,!0))}},s=this,o=0;o<a.length;o++)n(o);if(!(0,e.isNullOrUndefined)(r))for(var l=function(t){var i=d.parent.connectorLineModule.getRecordByID(r[parseInt(t.toString(),10)].from),a=(0,e.extend)([],[],i.ganttProperties.predecessor,!0);0===a.filter((function(e){return r[t].from===e.from&&r[t].to===e.to})).length&&(a.push(r[parseInt(t.toString(),10)]),d.parent.setRecordValue("predecessor",a,i.ganttProperties,!0))},d=this,h=0;h<r.length;h++)l(h)}},i.prototype.removePredecessorByIndex=function(t,i){if(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed){this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection();var r={action:"DeleteDependency"};r.modifiedRecords=(0,e.extend)([],[t],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=r}var a=t.ganttProperties.predecessor,n=a.splice(i,1),s=this.parent.connectorLineModule.getRecordByID(n[0].from).ganttProperties.predecessor,o=u(n[0],"from",s,"to");s.splice(o,1);var l=this.parent.predecessorModule.getPredecessorStringValue(t);a.push(n[0]),this.parent.connectorLineEditModule.updatePredecessor(t,l)},i.prototype.renderPredecessorDeleteConfirmDialog=function(){this.confirmPredecessorDialog=new t.Dialog({width:"320px",isModal:!0,enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("confirmPredecessorDelete"),buttons:[{click:this.confirmOkDeleteButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("okText"),isPrimary:!0}},{click:this.confirmCloseDialog.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],target:this.parent.element,animationSettings:{effect:"None"}});var i=(0,e.createElement)("div",{id:this.parent.element.id+"_deletePredecessorConfirmDialog"});this.parent.element.appendChild(i),this.confirmPredecessorDialog.isStringTemplate=!0,this.confirmPredecessorDialog.appendTo(i)},i.prototype.confirmCloseDialog=function(){this.confirmPredecessorDialog.destroy()},i.prototype.confirmOkDeleteButton=function(){this.removePredecessorByIndex(this.childRecord,this.predecessorIndex),this.confirmPredecessorDialog.destroy()},i}(),xi=function(){return xi=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},xi.apply(this,arguments)},Oi=function(){function a(t){if(this.isFromDeleteMethod=!1,this.targetedRecords=[],this.isNewRecordAdded=!1,this.isValidatedEditedRecord=!1,this.createArray=!0,this.deletedRecord=[],this.updateParentRecords=[],this.isaddtoBottom=!1,this.confirmDialog=null,this.taskbarMoved=!1,this.predecessorUpdated=!1,this.isBreakLoop=!1,this.deletedTaskDetails=[],this.parent=t,this.parent.predecessorModule.validatedChildItems=[],this.parent.editSettings.allowEditing&&"Auto"===this.parent.editSettings.mode&&(this.cellEditModule=new gi(this.parent)),this.parent.taskFields.dependency&&(this.parent.connectorLineEditModule=new Mi(this.parent)),(this.parent.editSettings.allowAdding||this.parent.editSettings.allowEditing&&("Dialog"===this.parent.editSettings.mode||"Auto"===this.parent.editSettings.mode))&&(this.dialogModule=new Ci(this.parent)),this.parent.editSettings.allowTaskbarEditing&&(this.taskbarEditModule=new Di(this.parent)),this.parent.editSettings.allowDeleting){var i=(0,e.createElement)("div",{id:this.parent.element.id+"_deleteConfirmDialog"});this.parent.element.appendChild(i),this.renderDeleteConfirmDialog()}this.parent.treeGrid.recordDoubleClick=this.recordDoubleClick.bind(this),this.parent.treeGrid.editSettings.allowAdding=this.parent.editSettings.allowAdding,this.parent.treeGrid.editSettings.allowDeleting=this.parent.editSettings.allowDeleting,this.parent.treeGrid.editSettings.showDeleteConfirmDialog=this.parent.editSettings.showDeleteConfirmDialog,this.parent.treeGrid.editSettings.allowNextRowEdit=this.parent.editSettings.allowNextRowEdit,"Dialog"===this.parent.editSettings.mode&&_e.TreeGrid.Inject(_e.Edit),this.updateDefaultColumnEditors()}return a.prototype.getModuleName=function(){return"edit"},a.prototype.updateDefaultColumnEditors=function(){for(var t=[this.parent.taskFields.id,this.parent.taskFields.progress,this.parent.taskFields.resourceInfo,this.parent.taskFields.type,"taskType"],i=0;i<t.length;i++)if(!(0,e.isNullOrUndefined)(t[i])&&t[i].length>0){var r=this.parent.getColumnByField(t[parseInt(i.toString(),10)],this.parent.treeGridModule.treeGridColumns);r&&(r.field===this.parent.taskFields.id?this.updateIDColumnEditParams(r):r.field===this.parent.taskFields.progress&&(0,e.isNullOrUndefined)(r.edit)?this.updateProgessColumnEditParams(r):r.field===this.parent.taskFields.resourceInfo?this.updateResourceColumnEditor(r):r.field!==this.parent.taskFields.type&&"taskType"!==r.field||this.updateTaskTypeColumnEditor(r))}},a.prototype.updateIDColumnEditParams=function(e){var t={min:0,decimals:0,enableRtl:this.parent.enableRtl,validateDecimalOnType:!0,format:"n0",showSpinButton:!1};this.updateEditParams(e,t)},a.prototype.updateProgessColumnEditParams=function(e){var t={min:0,enableRtl:this.parent.enableRtl,decimals:0,validateDecimalOnType:!0,max:100,format:"n0"};this.updateEditParams(e,t)},a.prototype.updateEditParams=function(t,i){(0,e.isNullOrUndefined)(t.edit)?(t.edit={},t.edit.params={}):(0,e.isNullOrUndefined)(t.edit.params)&&(t.edit.params={}),(0,e.extend)(i,t.edit.params),t.edit.params=i,this.parent.getColumnByField(t.field,this.parent.ganttColumns).edit=t.edit},a.prototype.updateResourceColumnEditor=function(t){if(this.parent.editSettings.allowEditing&&(0,e.isNullOrUndefined)(t.edit)&&"Auto"===this.parent.editSettings.mode){t.editType="dropdownedit",t.edit=this.getResourceEditor();var i=this.parent.getColumnByField(t.field,this.parent.ganttColumns);i.editType="dropdownedit",i.edit=t.edit}},a.prototype.getResourceEditor=function(){var t,i=this,a=this.parent.resourceFields,n={};return Pi.MultiSelect.Inject(Pi.CheckBoxSelection),n.write=function(e){i.parent.treeGridModule.currentEditRow={},(t=new Pi.MultiSelect({dataSource:new r.DataManager(i.parent.resources),fields:{text:a.name,value:a.id},enableRtl:i.parent.enableRtl,mode:"CheckBox",showDropDownIcon:!0,popupHeight:"350px",delimiterChar:",",value:i.parent.treeGridModule.getResourceIds(e.rowData)})).appendTo(e.element)},n.read=function(t){var r=t.ej2_instances[0].value,n=[];(0,e.isNullOrUndefined)(r)&&(r=[]);for(var s=0;s<r.length;s++)for(var o=0;o<i.parent.resources.length;o++)if(i.parent.resources[o][a.id]===r[s]){n.push(i.parent.resources[o][a.name]);break}return i.parent.treeGridModule.currentEditRow[i.parent.taskFields.resourceInfo]=r,n.join(",")},n.destroy=function(){t&&t.destroy()},n},a.prototype.updateTaskTypeColumnEditor=function(t){if(this.parent.editSettings.allowEditing&&(0,e.isNullOrUndefined)(t.edit)&&"Auto"===this.parent.editSettings.mode){t.editType="dropdownedit",t.edit=this.getTaskTypeEditor();var i=this.parent.getColumnByField(t.field,this.parent.ganttColumns);i.editType="dropdownedit",i.edit=t.edit}},a.prototype.getTaskTypeEditor=function(){var t,i=this,a={},n=[{ID:1,Value:"FixedUnit"},{ID:2,Value:"FixedWork"},{ID:3,Value:"FixedDuration"}];return a.write=function(a){i.parent.treeGridModule.currentEditRow={},(t=new Pi.DropDownList({dataSource:new r.DataManager(n),enableRtl:i.parent.enableRtl,fields:{value:"Value"},popupHeight:"350px",value:(0,e.getValue)("taskType",a.rowData.ganttProperties)})).appendTo(a.element)},a.read=function(e){var t=e.ej2_instances[0].value,r=i.parent.taskFields.type||"taskType";return i.parent.treeGridModule.currentEditRow[r]=t,t},a.destroy=function(){t&&t.destroy()},a},a.prototype.reUpdateEditModules=function(){var t=this.parent.editSettings;if(t.allowEditing?(this.parent.editModule.cellEditModule&&"Dialog"===t.mode?(this.cellEditModule.destroy(),this.parent.treeGrid.recordDoubleClick=this.recordDoubleClick.bind(this)):(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule)&&"Auto"===t.mode&&(this.cellEditModule=new gi(this.parent)),this.parent.editModule.dialogModule&&"Auto"===t.mode?this.parent.treeGrid.recordDoubleClick=void 0:(0,e.isNullOrUndefined)(this.parent.editModule.dialogModule)&&(this.dialogModule=new Ci(this.parent))):(this.cellEditModule&&this.cellEditModule.destroy(),this.dialogModule&&this.dialogModule.destroy()),t.allowDeleting&&t.showDeleteConfirmDialog){if((0,e.isNullOrUndefined)(this.confirmDialog)){var i=(0,e.createElement)("div",{id:this.parent.element.id+"_deleteConfirmDialog"});this.parent.element.appendChild(i),this.renderDeleteConfirmDialog()}}else t.allowDeleting&&t.showDeleteConfirmDialog||this.confirmDialog&&!this.confirmDialog.isDestroyed&&this.confirmDialog.destroy();t.allowTaskbarEditing?(0,e.isNullOrUndefined)(this.parent.editModule.taskbarEditModule)&&(this.taskbarEditModule=new Di(this.parent)):this.taskbarEditModule&&this.taskbarEditModule.destroy()},a.prototype.recordDoubleClick=function(t){if(this.parent.editSettings.allowEditing&&"Dialog"===this.parent.editSettings.mode){var i=void 0;if(t.row){var r=(0,e.getValue)("rowIndex",t.row);i=this.parent.currentViewData[r]}(0,e.isNullOrUndefined)(i)||this.dialogModule.openEditDialog(i)}this.parent.ganttChartModule.recordDoubleClick(t)},a.prototype.destroy=function(){this.cellEditModule&&this.cellEditModule.destroy(),this.taskbarEditModule&&this.taskbarEditModule.destroy(),this.dialogModule&&this.dialogModule.destroy(),this.confirmDialog&&!this.confirmDialog.isDestroyed&&this.confirmDialog.destroy()},a.prototype.updateRecordByID=function(t){if(this.parent.enableImmutableMode&&this.parent.editSettings.allowEditing&&this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length>0&&this.parent.treeGrid.endEdit(),!this.parent.readOnly){var i=this.parent.taskFields;if((0,e.isNullOrUndefined)(t)||(0,e.isNullOrUndefined)(t[i.id]))return;var r="ResourceView"===this.parent.viewType?this.parent.flatData[this.parent.getTaskIds().indexOf("T"+t[i.id])]:this.parent.getRecordByID(t[i.id]);if((0,e.isNullOrUndefined)(r[i.milestone])||!0===r[i.milestone]&&(r[i.milestone]=!1),this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("Edit")&&r){this.parent.undoRedoModule.createUndoCollection();var a={};a.requestType=this.parent.contextMenuModule&&this.parent.contextMenuModule.item?this.parent.contextMenuModule.item:"methodUpdate",a.modifiedRecords=(0,e.extend)([],[r],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a}if(!(0,e.isNullOrUndefined)(this.parent.editModule)&&r){if(this.parent.isOnEdit=!0,this.validateUpdateValues(t,r,!0),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed){if("ProjectView"===this.parent.viewType&&t.ganttProperties.predecessor)for(var n=function(e){var i=r.ganttProperties.predecessor.filter((function(i){return i.from!==t.ganttProperties.predecessor[e].from&&i.from!==t.ganttProperties.predecessor[e].to}));if(i.length>0){for(var a=0;a<i.length;a++)for(var n=s.parent.flatData[s.parent.ids.indexOf(i[a].from)],o=0;o<n.ganttProperties.predecessor.length;o++)if(n.ganttProperties.predecessor[o].from===i[a].from&&n.ganttProperties.predecessor[o].to===i[a].to){n.ganttProperties.predecessor.splice(o,1);break}return"break"}},s=this,o=0;o<t.ganttProperties.predecessor.length;o++){if("break"===n(o))break}else if(!t.ganttProperties.predecessor&&r.ganttProperties.predecessor)for(o=0;o<r.ganttProperties.predecessor.length;o++){var l=void 0;l=r.ganttProperties.taskId.toString()===r.ganttProperties.predecessor[o].from?r.ganttProperties.predecessor[o].to:r.ganttProperties.predecessor[o].from;for(var d=this.parent.flatData[this.parent.ids.indexOf(l)],h=0;h<d.ganttProperties.predecessor.length;h++)d.ganttProperties.predecessor[h].from===r.ganttProperties.predecessor[o].from&&d.ganttProperties.predecessor[h].to===r.ganttProperties.predecessor[o].to&&d.ganttProperties.predecessor.splice(h,1)}r.ganttProperties.resourceInfo=t.ganttProperties.resourceInfo}t[this.parent.taskFields.resourceInfo]&&(0===r.ganttProperties.duration&&this.parent.dataOperation.updateWorkWithDuration(r),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.updateResourceRelatedFields(r,"resource"),this.parent.dateValidationModule.calculateEndDate(r));var p=Object.keys(t);if(-1===p.indexOf(i.startDate)&&-1===p.indexOf(i.endDate)&&-1===p.indexOf(i.duration)||this.parent.dataOperation.calculateScheduledValues(r,r.taskData,!1),this.parent.dataOperation.updateWidthLeft(r),(0,e.isUndefined)(t[this.parent.taskFields.dependency])||t[this.parent.taskFields.dependency]===r.ganttProperties.predecessorsName){var u={};u.data=r,"ResourceView"===this.parent.viewType&&(u.action="methodUpdate"),this.parent.editModule.initiateUpdateAction(u)}else this.parent.connectorLineEditModule.updatePredecessor(r,t[this.parent.taskFields.dependency])}}},a.prototype.validateUpdateValues=function(t,i,r){for(var a=this.parent,n=a.taskFields,s=o(a.columnMapping),l=[],d=!1,h=0,p=Object.keys(t);h<p.length;h++){var u=p[h];if(-1!==[n.startDate,n.endDate,n.duration].indexOf(u)){if((0,e.isNullOrUndefined)(t[""+u])&&!a.allowUnscheduledTasks)continue;if(r)if(n.duration===u)a.dataOperation.updateDurationValue(t[u],i.ganttProperties),i.ganttProperties.duration>0&&i.ganttProperties.isMilestone&&this.parent.setRecordValue("isMilestone",!1,i.ganttProperties,!0),a.dataOperation.updateMappingData(i,s[u]);else{var c="string"==typeof t[u]?new Date(t[u]):t[u];u===n.endDate&&(0,e.isNullOrUndefined)(i.ganttProperties.startDate)&&((0,e.isNullOrUndefined)(t[n.duration])||""===t[n.duration]||Number.isNaN(t[n.duration]))&&(c=i.ganttProperties.endDate),a.setRecordValue(s[u],c,i.ganttProperties,!0),a.dataOperation.updateMappingData(i,s[u])}else l.push(u),d=!0}else if(n.resourceInfo===u){var g=a.dataOperation.setResourceInfo(t);"ResourceView"===this.parent.viewType&&(JSON.stringify(g)!==JSON.stringify(i.ganttProperties.resourceInfo)?(this.parent.editModule.dialogModule.isResourceUpdate=!0,this.parent.editModule.dialogModule.previousResource=(0,e.isNullOrUndefined)(i.ganttProperties.resourceInfo)?[]:i.ganttProperties.resourceInfo.slice()):this.parent.editModule.dialogModule.isResourceUpdate=!1),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||(i.ganttProperties.resourceInfo=g),a.dataOperation.updateMappingData(i,"resourceInfo")}else if(n.dependency===u);else if(-1!==[n.progress,n.notes,n.durationUnit,n.expandState,n.milestone,n.name,n.baselineStartDate,n.baselineEndDate,n.id,n.segments,n.cssClass].indexOf(u)){var f=a.columnByField[u],m=t[u];(0,e.isNullOrUndefined)(f)||"datepickeredit"!==f.editType&&"datetimepickeredit"!==f.editType||(m=a.dataOperation.getDateFromFormat(m));var y=s[u];if(u===n.id)y="taskId";else if(u===n.name)y="taskName";else if(u===n.cssClass)y="cssClass";else if(u===n.milestone){if(y="isMilestone",!(0,e.isNullOrUndefined)(n.duration)){var D=i.ganttProperties,v=t[n.duration];v=m?0:v<=0?1:v,a.setRecordValue(n.duration,v,i,!0),a.setRecordValue("duration",v,D,!0),a.setRecordValue("taskData."+n.duration,v,i)}}else if(u===n.segments&&!(0,e.isNullOrUndefined)(i.ganttProperties.segments)&&(y="segments",t&&!(0,e.isNullOrUndefined)(t[this.parent.taskFields.segments])&&t[this.parent.taskFields.segments].length>0)){this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&(i.ganttProperties.segments=t.ganttProperties.segments);for(var k=0,w=0;w<i.ganttProperties.segments.length;w++)k+=i.ganttProperties.segments[w].duration;var b=i.ganttProperties.startDate,T=this.parent.dataOperation.getEndDate(b,k,i.ganttProperties.durationUnit,i.ganttProperties,!1);a.setRecordValue("endDate",a.dataOperation.getDateFromFormat(T),i.ganttProperties,!0)}if(!(0,e.isNullOrUndefined)(y)){var P=[];if("segments"===y&&m&&m.length>0){for(w=0;w<m.length;w++){var S={};m[w][this.parent.taskFields.startDate]&&(S.startDate=m[w][this.parent.taskFields.startDate]),m[w][this.parent.taskFields.endDate]&&(S.endDate=m[w][this.parent.taskFields.endDate]),m[w][this.parent.taskFields.duration]&&(S.duration=parseFloat(m[w][this.parent.taskFields.duration])),m[w][this.parent.taskFields.id]&&(S.id=m[w][this.parent.taskFields.id]),P.push(S)}a.setRecordValue(y,P,i.ganttProperties,!0)}else a.setRecordValue(y,m,i.ganttProperties,!0)}if((u===n.baselineStartDate||u===n.baselineEndDate)&&i.ganttProperties.baselineStartDate&&i.ganttProperties.baselineEndDate){a.setRecordValue("baselineStartDate",a.dataOperation.checkBaselineStartDate(i.ganttProperties.baselineStartDate,i.ganttProperties),i.ganttProperties,!0);var C=this.parent.getCurrentDayEndTime(i.ganttProperties.baselineEndDate);i.ganttProperties.baselineEndDate&&0===i.ganttProperties.baselineEndDate.getHours()&&86400!==C&&a.dataOperation.setTime(C,i.ganttProperties.baselineEndDate),(i.ganttProperties.baselineStartDate&&i.ganttProperties.baselineEndDate&&i.ganttProperties.baselineStartDate.getTime()>i.ganttProperties.baselineEndDate.getTime()||!(0,e.isNullOrUndefined)(i.ganttProperties.baselineStartDate)&&!(0,e.isNullOrUndefined)(i.ganttProperties.startDate)&&i.ganttProperties.baselineStartDate.getTime()===i.ganttProperties.startDate.getTime()&&!(0,e.isNullOrUndefined)(i.ganttProperties.baselineEndDate)&&!(0,e.isNullOrUndefined)(i.ganttProperties.endDate)&&i.ganttProperties.baselineEndDate.toLocaleDateString()===i.ganttProperties.endDate.toLocaleDateString()&&i.ganttProperties.isMilestone)&&(i.ganttProperties.baselineEndDate=i.ganttProperties.baselineStartDate),a.setRecordValue("baselineEndDate",a.dataOperation.checkBaselineEndDate(i.ganttProperties.baselineEndDate),i.ganttProperties,!0),a.setRecordValue("baselineLeft",a.dataOperation.calculateBaselineLeft(i.ganttProperties),i.ganttProperties,!0),a.setRecordValue("baselineWidth",a.dataOperation.calculateBaselineWidth(i.ganttProperties),i.ganttProperties,!0)}a.setRecordValue("taskData."+u,m,i),u===n.segments&&t&&!(0,e.isNullOrUndefined)(t[this.parent.taskFields.segments])&&t[this.parent.taskFields.segments].length>0&&(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&(i.ganttProperties.segments=t.ganttProperties.segments),a.dataOperation.setSegmentsInfo(i,!0)),a.setRecordValue(u,m,i)}else if(n.indicators===u){m=t[u];a.setRecordValue("indicators",m,i.ganttProperties,!0),a.setRecordValue("taskData."+u,m,i),a.setRecordValue(u,m,i)}else if(n.work===u)a.setRecordValue("work",t[u],i.ganttProperties,!0),this.parent.dataOperation.updateMappingData(i,"work"),this.parent.dataOperation.updateMappingData(i,"duration"),this.parent.dataOperation.updateMappingData(i,"endDate");else if(u===n.type)a.setRecordValue("taskType",t[u],i.ganttProperties,!0);else if(-1!==a.customColumns.indexOf(u)){f=a.columnByField[u],m=t[u];(0,e.isNullOrUndefined)(f.edit)&&("datepickeredit"!==f.editType&&"datetimepickeredit"!==f.editType||(m=a.dataOperation.getDateFromFormat(m))),a.setRecordValue("taskData."+u,m,i),a.setRecordValue(u,m,i)}else n.manual===u&&(a.setRecordValue("isAutoSchedule",!t[u],i.ganttProperties,!0),this.parent.setRecordValue(u,t[u],i),this.updateTaskScheduleModes(i))}d&&this.validateScheduleValues(l,i,t)},a.prototype.updateResourceRelatedFields=function(t,i){var r=t.ganttProperties,a=r.taskType,n=r.isAutoSchedule,s=this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.currentResources?this.parent.editModule.dialogModule.currentResources:t.ganttProperties.resourceInfo;if(!(0,e.isNullOrUndefined)(s))switch(a){case"FixedUnit":if(0===s.length)return;n&&s.length?"resource"===i?this.parent.dataOperation.updateWorkWithDuration(t):"work"===i?this.parent.dataOperation.updateDurationWithWork(t):"duration"===i&&(this.parent.dataOperation.updateWorkWithDuration(t),0===r.duration&&this.parent.setRecordValue("isMilestone",!0,r,!0)):n||"work"!==i?this.parent.dataOperation.updateWorkWithDuration(t):this.parent.dataOperation.updateUnitWithWork(t);break;case"FixedWork":if(0===s.length)return;n?"duration"===i||"endDate"===i?(this.parent.dataOperation.updateUnitWithWork(t),this.parent.dataOperation.updateDurationWithWork(t),0===r.duration&&(this.parent.setRecordValue("isMilestone",!0,r,!0),this.parent.setRecordValue("work",0,r,!0),(0,e.isNullOrUndefined)(this.parent.taskFields.work)||this.parent.dataOperation.updateMappingData(t,"work"))):this.parent.dataOperation.updateDurationWithWork(t):"work"===i?this.parent.dataOperation.updateUnitWithWork(t):this.parent.dataOperation.updateWorkWithDuration(t);break;case"FixedDuration":if(0===s.length)return;s.length&&"work"===i?("work"===i||this.parent.dataOperation.updateWorkWithDuration(t),this.parent.dataOperation.updateUnitWithWork(t)):this.parent.dataOperation.updateWorkWithDuration(t)}},a.prototype.validateScheduleValues=function(e,t,i){var r=this.parent;e.length>2?r.dataOperation.calculateScheduledValues(t,i,!1):e.length>1?this.validateScheduleByTwoValues(i,e,t):this.dialogModule.validateScheduleValuesByCurrentField(e[0],i[e[0]],t)},a.prototype.validateScheduleByTwoValues=function(e,t,i){var r,a,n,s=this.parent,o=s.taskFields,l=i.ganttProperties,d=s.allowUnscheduledTasks;-1!==t.indexOf(o.startDate)&&(r=e[o.startDate]),-1!==t.indexOf(o.endDate)&&(a=e[o.endDate]),-1!==t.indexOf(o.duration)&&(n=e[o.duration]),r&&a||d&&-1!==t.indexOf(o.startDate)&&-1!==t.indexOf(o.endDate)?(s.setRecordValue("startDate",s.dataOperation.getDateFromFormat(r),l,!0),s.setRecordValue("endDate",s.dataOperation.getDateFromFormat(a),l,!0),s.dataOperation.calculateDuration(i)):a&&n||d&&-1!==t.indexOf(o.endDate)&&-1!==t.indexOf(o.duration)?(s.setRecordValue("endDate",s.dataOperation.getDateFromFormat(a),l,!0),s.dataOperation.updateDurationValue(n,l)):(r&&n||d&&-1!==t.indexOf(o.startDate)&&-1!==t.indexOf(o.duration))&&(s.setRecordValue("startDate",s.dataOperation.getDateFromFormat(r),l,!0),s.dataOperation.updateDurationValue(n,l))},a.prototype.isTaskbarMoved=function(t){var i=!1,r=t.ganttProperties,a=this.parent.previousRecords&&this.parent.previousRecords[t.uniqueID];if(a&&a.ganttProperties){var n=(0,e.getValue)("ganttProperties.startDate",a),s=(0,e.getValue)("ganttProperties.endDate",a),o=(0,e.getValue)("ganttProperties.duration",a),l=(0,e.getValue)("ganttProperties.durationUnit",a),d=Object.keys(a.ganttProperties);-1===d.indexOf("startDate")&&-1===d.indexOf("endDate")&&-1===d.indexOf("duration")&&-1===d.indexOf("durationUnit")||((0,e.isNullOrUndefined)(n)&&!(0,e.isNullOrUndefined)(r.startDate)||(0,e.isNullOrUndefined)(s)&&!(0,e.isNullOrUndefined)(r.endDate)||(0,e.isNullOrUndefined)(r.startDate)&&!(0,e.isNullOrUndefined)(n)||(0,e.isNullOrUndefined)(r.endDate)&&!(0,e.isNullOrUndefined)(s)||n&&n.getTime()!==r.startDate.getTime()||s&&s.getTime()!==r.endDate.getTime()||!(0,e.isNullOrUndefined)(o)&&o!==r.duration||!(0,e.isNullOrUndefined)(o)&&o===r.duration&&l!==r.durationUnit)&&(i=!0)}return i},a.prototype.isPredecessorUpdated=function(e){var t=!1,i=this.parent.previousRecords[e.uniqueID];return i&&i.ganttProperties&&i.ganttProperties.hasOwnProperty("predecessor")&&(e.ganttProperties.predecessorsName!==i.ganttProperties.predecessorsName?t=!0:this.parent.setRecordValue("predecessor",i.ganttProperties.predecessor,e.ganttProperties,!0)),t},a.prototype.isCheckPredecessor=function(e){var t=!1;return this.parent.previousRecords[e.uniqueID]&&this.parent.taskFields.dependency&&this.parent.isInPredecessorValidation&&this.parent.predecessorModule.getValidPredecessor(e).length>0&&this.isTaskbarMoved(e)&&(t=!0),t},a.prototype.updateGanttProperties=function(e,t){var i=["taskId","uniqueID","rowUniqueID","parentId"];Object.keys(e.ganttProperties).forEach((function(r){-1===i.indexOf(r)&&(t.ganttProperties[r]=e.ganttProperties[r])}))},a.prototype.initiateUpdateAction=function(t){var i,r,a=this.isCheckPredecessor(t.data);if((0,e.isNullOrUndefined)(t.data.parentItem)||a){if(t.data.childRecords.length>0&&!a&&!(a=this.isCheckPredecessor(t.data))&&this.isTaskbarMoved(t.data))for(var n=0;n<t.data.childRecords.length;n++)this.parent.predecessorModule.getValidPredecessor(t.data.childRecords[n]).length>0&&(r=n,a=!0)}else i=this.parent.getRecordByID(t.data.parentItem.taskId),a=!!(this.isTaskbarMoved(t.data)&&this.parent.predecessorModule.getValidPredecessor(i).length>0&&this.parent.isInPredecessorValidation);(!this.parent.undoRedoModule||this.parent.undoRedoModule&&!this.parent.undoRedoModule.currentAction||this.parent.undoRedoModule.currentAction&&"indent"!==this.parent.undoRedoModule.currentAction.action&&"outdent"!==this.parent.undoRedoModule.currentAction.action)&&(this.taskbarMoved=this.isTaskbarMoved(t.data)),this.predecessorUpdated=this.isPredecessorUpdated(t.data),this.predecessorUpdated&&(this.parent.isConnectorLineUpdate=!0,this.parent.connectorLineEditModule.addRemovePredecessor(t.data));var s={};if(!a||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)this.taskbarMoved&&(this.parent.isConnectorLineUpdate=!0),this.updateEditedTask(t);else if(s=(0,e.isNullOrUndefined)(i)?(0,e.isNullOrUndefined)(r)?this.parent.connectorLineEditModule.validateTypes(t.data):this.parent.connectorLineEditModule.validateTypes(t.data.childRecords[r],t.data):this.parent.connectorLineEditModule.validateTypes(i,t.data),this.parent.isConnectorLineUpdate=!0,(0,e.isNullOrUndefined)((0,e.getValue)("violationType",s)))this.updateEditedTask(t);else{var o=this.validateTaskEvent(t);!1===o.validateMode.preserveLinkWithEditing&&!1===o.validateMode.removeLink&&!1===o.validateMode.respectLink?this.parent.connectorLineEditModule.openValidationDialog(s):(this.parent.editModule&&this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.isEdit&&this.predecessorUpdated&&(this.isValidatedEditedRecord=!0,this.parent.predecessorModule.validatePredecessor(t.data,[],"")),this.parent.connectorLineEditModule.applyPredecessorOption())}},a.prototype.validateTaskEvent=function(e){var t={};return this.resetValidateArgs(),this.parent.currentEditedArgs=t,t.cancel=!1,t.data=e.data,t.requestType="validateLinkedTask",t.validateMode=this.parent.dialogValidateMode,t.editEventArgs=e,this.parent.actionBeginTask(t),t},a.prototype.resetValidateArgs=function(){this.parent.dialogValidateMode.preserveLinkWithEditing=!0,this.parent.dialogValidateMode.removeLink=!1,this.parent.dialogValidateMode.respectLink=!1},a.prototype.updateEditedTask=function(t){var i=t.data;if(this.editedRecord=i,!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||this.updateParentChildRecord(i),this.parent.predecessorModule&&(this.parent.predecessorModule.isValidatedParentTaskID=""),(this.parent.isConnectorLineUpdate||this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)&&this.parent.autoCalculateDateScheduling&&(!this.parent.isLoad||this.parent.treeGrid.loadChildOnDemand||!this.parent.taskFields.hasChildMapping)){for(var r=0;r<this.parent.predecessorModule.validatedChildItems.length;r++){var a=this.parent.predecessorModule.validatedChildItems[r];a.ganttProperties.predecessor&&a.ganttProperties.predecessor.length>0&&(this.parent.editedTaskBarItem=a,this.isValidatedEditedRecord||(this.isFirstCall=!0),this.parent.predecessorModule.validatePredecessor(a,[],""))}if(i.ganttProperties.predecessor&&(this.parent.isMileStoneEdited=i.ganttProperties.isMilestone,this.taskbarMoved&&(this.parent.editedTaskBarItem=i),this.isValidatedEditedRecord||(this.isFirstCall=!0,this.parent.predecessorModule.validatePredecessor(i,[],""),this.parent.predecessorModule.isChildRecordValidated=[]),this.isValidatedEditedRecord=!1),this.parent.predecessorModule.isValidatedParentTaskID="",this.parent.allowParentDependency&&this.parent.predecessorModule.isValidatedParentTaskID!==i.ganttProperties.taskId&&i.hasChildRecords&&this.parent.previousRecords[i.uniqueID].ganttProperties.startDate&&"DrawConnectorLine"===t.action&&this.parent.predecessorModule.updateChildItems(i),this.parent.predecessorModule.isValidatedParentTaskID="",this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)for(r=0;r<i.childRecords.length;r++)i.childRecords[r].ganttProperties.predecessor&&this.parent.predecessorModule.validatePredecessor(i.childRecords[r],[],"");this.updateParentItemOnEditing(),this.parent.dataOperation.updateParentItems(i,!0)}if(i.parentItem){!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&!this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||this.parent.dataOperation.updateParentItems(i,!0);var n=this.parent.getRecordByID(i.parentItem.taskId);(0,e.isNullOrUndefined)(n)||n.ganttProperties.predecessorsName||(this.isFirstCall=!0,this.parent.predecessorModule.validatePredecessor(n,[],""),this.updateParentItemOnEditing())}this.parent.updateOffsetOnTaskbarEdit&&this.parent.connectorLineEditModule&&t.data&&(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.parent.connectorLineEditModule.calculateOffset(t.data)),this.parent.predecessorModule.validatedParentIds=[],this.initiateSaveAction(t)},a.prototype.updateParentItemOnEditing=function(){for(var t=this,i=(0,e.getValue)("parentRecord",this.parent.predecessorModule),r=0;r<i.length;r++)this.parent.dataOperation.updateParentItems(i[r]);this.parent.editModule.updateParentRecords&&this.parent.editModule.updateParentRecords.length>0&&this.parent.editModule.updateParentRecords.forEach((function(e){e.ganttProperties.predecessor&&e.ganttProperties.predecessor.length>0&&t.parent.predecessorModule.validatePredecessor(e,[],"")})),(0,e.setValue)("parentRecord",[],this.parent.predecessorModule),(0,e.setValue)("parentIds",[],this.parent.predecessorModule)},a.prototype.updateParentChildRecord=function(t){var i=t;!i.hasChildRecords||!this.taskbarMoved||!1!==i[this.parent.taskFields.manual]&&"Auto"!==this.parent.taskMode||(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule)||this.parent.editModule.cellEditModule.isResourceCellEdited||this.parent.predecessorModule.updateChildItems(i),(0,e.isNullOrUndefined)(this.parent.editModule.cellEditModule)||(this.parent.editModule.cellEditModule.isResourceCellEdited=!1)},a.prototype.updateTaskScheduleModes=function(e){var t=e[this.parent.taskFields.startDate],i=e.ganttProperties;if(e.hasChildRecords&&i.isAutoSchedule)this.parent.setRecordValue("startDate",i.autoStartDate,i,!0),this.parent.setRecordValue("endDate",i.autoEndDate,i,!0),this.parent.setRecordValue("StartDate",i.autoStartDate,e,!0),this.parent.setRecordValue("EndDate",i.autoEndDate,e,!0),this.parent.setRecordValue("taskData.StartDate",i.autoStartDate,e,!0),this.parent.setRecordValue("taskData.EndDate",i.autoEndDate,e,!0),this.parent.setRecordValue("width",this.parent.dataOperation.calculateWidth(e,!0),i,!0),this.parent.setRecordValue("left",this.parent.dataOperation.calculateLeft(i,!0),i,!0),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(i.width,i.progress),i,!0),this.parent.dataOperation.calculateDuration(e);else if(e.hasChildRecords&&!i.isAutoSchedule)this.parent.dataOperation.updateWidthLeft(e),this.parent.dataOperation.calculateDuration(e),this.parent.setRecordValue("autoStartDate",i.autoStartDate,i,!0),this.parent.setRecordValue("autoEndDate",i.autoEndDate,i,!0),this.parent.setRecordValue("autoDuration",this.parent.dataOperation.calculateAutoDuration(e),i,!0),this.parent.dataOperation.updateAutoWidthLeft(e);else{var r=this.parent.dateValidationModule.checkStartDate(t,e.ganttProperties);this.parent.setRecordValue("startDate",r,e.ganttProperties,!0),this.parent.dataOperation.updateMappingData(e,"startDate"),this.parent.dateValidationModule.calculateEndDate(e),this.parent.setRecordValue("taskData."+this.parent.taskFields.manual,e[this.parent.taskFields.manual],e),this.parent.dataOperation.updateWidthLeft(e)}},a.prototype.updateParentProgress=function(t){var i=0,r=this.parent.getParentTask(t),a=r.childRecords,s=a?a.length:0,o=0,l=0,d=0,h={};if(a){for(var p=0;p<s;p++)a[p].ganttProperties.isMilestone&&!a[p].hasChildRecords||!n(a[p].ganttProperties)?l+=1:(h=this.parent.dataOperation.getParentProgress(a[p]),o+=(0,e.getValue)("totalProgress",h),d+=(0,e.getValue)("totalDuration",h));i=s-l>0?Math.round(o/d):0,isNaN(i)&&(i=0),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(r.ganttProperties.isAutoSchedule?r.ganttProperties.width:r.ganttProperties.autoWidth,i),r.ganttProperties,!0),this.parent.setRecordValue("progress",Math.floor(i),r.ganttProperties,!0),this.parent.setRecordValue("totalProgress",o,r.ganttProperties,!0),this.parent.setRecordValue("totalDuration",d,r.ganttProperties,!0)}this.parent.dataOperation.updateTaskData(r),r.parentItem&&this.updateParentProgress(r.parentItem)},a.prototype.revertCellEdit=function(e){this.parent.editModule.reUpdatePreviousRecords(!1,!0),this.resetEditProperties()},a.prototype.reUpdatePreviousRecords=function(e,t){for(var i=this.parent.previousRecords,r=Object.keys(i),a=0;a<r.length;a++){var n=r[a],s=i[n],o=this.parent.getTaskByUniqueID(n);this.copyTaskData(o.taskData,s.taskData),delete s.taskData,this.copyTaskData(o.ganttProperties,s.ganttProperties),delete s.ganttProperties,this.copyTaskData(o,s);var l=this.parent.currentViewData.indexOf(o);if(e&&this.parent.chartRowsModule.refreshRow(l),t){var d="ProjectView"===this.parent.viewType?o.ganttProperties.taskId:o.ganttProperties.rowUniqueID;this.parent.treeGrid.grid.setRowData(d,o),this.parent.treeGrid.grid.getRowObjectFromUID(this.parent.treeGrid.grid.getDataRows()[l].getAttribute("data-uid")).data=o}}},a.prototype.copyTaskData=function(t,i){(0,e.isNullOrUndefined)(i)||(0,e.extend)(t,i)},a.prototype.updateScheduleDatesOnEditing=function(e){},a.prototype.initiateSaveAction=function(t){var i=this,a={requestType:"beforeSave"};a.data=t.data,a.cancel=!1,this.createArray=!0,this.parent.toolbarModule&&this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.undoRedoModule.getUndoCollection.length>0&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),a.modifiedRecords=this.parent.editedRecords,(0,e.isNullOrUndefined)(t.target)||(a.target=t.target),a.modifiedTaskData=d(this.parent.editedRecords,!0),t.action&&"DrawConnectorLine"===t.action&&(a.action="DrawConnectorLine");var n=this.parent,s=xi({},a.data.ganttProperties.baselineStartDate),o=xi({},a.data.ganttProperties.baselineEndDate),h=a.data.ganttProperties.progress,p=JSON.parse(JSON.stringify(a.data.ganttProperties));this.parent.trigger("actionBegin",a,(function(u){s===u.data.ganttProperties.baselineStartDate&&o===u.data.ganttProperties.baselineEndDate||(n.setRecordValue("baselineLeft",n.dataOperation.calculateBaselineLeft(u.data.ganttProperties),u.data.ganttProperties,!0),n.setRecordValue("baselineWidth",n.dataOperation.calculateBaselineWidth(u.data.ganttProperties),u.data.ganttProperties,!0)),p===u.data.ganttProperties||(0,e.isNullOrUndefined)(u.data.parentItem)||(i.updateParentItemOnEditing(),i.parent.dataOperation.updateParentItems(u.data,!0));var c=u.data.ganttProperties,g=c.startDate,f=c.endDate,m=c.segments,y=c.durationUnit,D=c.isAutoSchedule,v=c.isMilestone;g&&f&&!m&&(0!==i.parent.dateValidationModule.getDuration(g,f,y,D,v,!0)&&(c.isMilestone=!1,i.parent.dateValidationModule.calculateDuration(u.data)));if(i.parent.dataOperation.updateWidthLeft(u.data),!(0,e.isNullOrUndefined)(i.parent.taskFields.progress)&&h!==u.data.ganttProperties.progress){var k=u.data.ganttProperties.isAutoSchedule?u.data.ganttProperties.width:u.data.ganttProperties.autoWidth;i.parent.setRecordValue("progressWidth",i.parent.dataOperation.getProgressWidth(k,u.data.ganttProperties.progress),u.data.ganttProperties,!0)}if(i.parent.chartRowsModule.updateSegment(u.data.ganttProperties.segments,u.data.ganttProperties.taskId),(0,e.isNullOrUndefined)(i.parent.loadingIndicator)||"Shimmer"!==i.parent.loadingIndicator.indicatorType?i.parent.showSpinner():i.parent.showMaskRow(),u.cancel)i.reUpdatePreviousRecords(),i.parent.chartRowsModule.refreshRecords([t.data]),i.resetEditProperties(a);else{if(u.modifiedTaskData=d(u.modifiedRecords,null,null,i.parent),l(i.parent.dataSource)){var w=i.parent.dataSource,b={changedRecords:u.modifiedTaskData},T=i.parent.query instanceof r.Query?i.parent.query:new r.Query,P=null,S=w.adaptor;if(S instanceof r.WebApiAdaptor&&S instanceof r.ODataAdaptor&&!w.dataSource.batchUrl){P=w.update(i.parent.taskFields.id,b.changedRecords,null,T)}else P=w.saveChanges(b,i.parent.taskFields.id,null,T);P.then((function(e){return i.dmSuccess(e,t)})).catch((function(e){return i.dmFailure(e,t)}))}else i.saveSuccess(t);i.parent.enableVirtualization&&i.parent.enableTimelineVirtualization&&i.parent.ganttChartModule.setVirtualHeight(),i.parent.undoRedoModule&&(i.parent.previousFlatData=(0,e.extend)([],i.parent.flatData,[],!0))}})),this.parent.ganttChartModule.reRenderConnectorLines()},a.prototype.dmSuccess=function(e,t){var i,r;i=e.changedRecords?e.changedRecords.length:e.length;for(var a=0;a<i;a++){r=e.changedRecords?e.changedRecords[parseInt(a.toString(),10)]:e[parseInt(a.toString(),10)];for(var n=Object.keys(r).length,s=0,o=Object.keys(r);s<n;s++){var l=o[parseInt(s.toString(),10)];this.parent.editedRecords[parseInt(a.toString(),10)][""+l]=r[""+l],this.parent.editedRecords[parseInt(a.toString(),10)].taskData[""+l]=r[""+l]}this.updateEditedRecordFields(r,this.parent.editedRecords[parseInt(a.toString(),10)])}this.saveSuccess(t)},a.prototype.updateEditedRecordFields=function(e,t){var i=this.parent.taskFields;null!==i.id&&(t.ganttProperties.taskId=e[i.id]),null!==i.name&&(t.ganttProperties.taskName=e[i.name]),null!==i.startDate&&(t.ganttProperties.startDate=e[i.startDate]),null!==i.endDate&&(t.ganttProperties.endDate=e[i.endDate]),null!==i.duration&&(t.ganttProperties.duration=parseFloat(e[i.duration])),null!==i.durationUnit&&(t.ganttProperties.durationUnit=e[i.durationUnit]),null!==i.progress&&(t.ganttProperties.progress=e[i.progress]),null!==i.dependency&&(t.ganttProperties.dependency=e[i.dependency]),null!==i.parentID&&(t.ganttProperties.parentID=e[i.parentID]),null!==i.baselineEndDate&&(t.ganttProperties.baselineEndDate=e[i.baselineEndDate]),null!==i.baselineStartDate&&(t.ganttProperties.baselineStartDate=e[i.baselineStartDate]),null!==i.resourceInfo&&(t.ganttProperties.resources=e[i.resourceInfo])},a.prototype.dmFailure=function(e,t){if(this.deletedTaskDetails.length){for(var i=this.deletedTaskDetails,r=0;r<i.length;r++)i[r].isDelete=!1;this.deletedTaskDetails=[]}this.reUpdatePreviousRecords(!0,!0),this.resetEditProperties(),this.parent.trigger("actionFailure",{error:e})},a.prototype.updateSharedTask=function(t){for(var i=t.ganttProperties.sharedTaskUniqueIds,r=0;r<i.length;r++){var a=this.parent.flatData[this.parent.ids.indexOf(i[r].toString())];a&&a.uniqueID!==t.uniqueID&&(this.updateGanttProperties(t,a),this.parent.setRecordValue("taskData",t.taskData,a,!0),this.parent.dataOperation.updateTaskData(a),this.parent.dataOperation.updateResourceName(a),(0,e.isNullOrUndefined)(a.parentItem)||this.parent.dataOperation.updateParentItems(a.parentItem))}},a.prototype.saveSuccess=function(t){var i={};if(this.parent.timelineSettings.updateTimescaleView){var r=this.parent.editedRecords;this.parent.timelineModule.updateTimeLineOnEditing([r],t.action)}if("ResourceView"===this.parent.viewType){"TaskbarEditing"===t.action||"DrawConnectorLine"===t.action?this.updateSharedTask(t.data):"DialogEditing"!==t.action&&"CellEditing"!==t.action&&"methodUpdate"!==t.action||(this.parent.editModule.dialogModule.isResourceUpdate?(this.updateResoures(this.parent.editModule.dialogModule.previousResource,t.data.ganttProperties.resourceInfo,t.data),this.updateSharedTask(t.data),this.isTreeGridRefresh=!0):this.updateSharedTask(t.data));for(var a=0;a<this.updateParentRecords.length;a++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[a]);this.updateParentRecords=[],this.parent.editModule.dialogModule.isResourceUpdate=!1,this.parent.editModule.dialogModule.previousResource=[]}if(this.isTreeGridRefresh||(this.parent.editSettings.allowEditing&&this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length>0&&(this.parent.treeGrid.grid.element.querySelector("form").ej2_instances[0].validate()||((0,e.setValue)("isEdit",!1,this.parent.treeGrid.grid),this.parent.editModule.cellEditModule.isCellEdit=!1),this.parent.treeGrid.endEdit()),this.parent.chartRowsModule.refreshRecords(this.parent.editedRecords),!this.parent.allowTaskbarOverlap&&this.parent.showOverAllocation&&(this.parent.contentHeight=this.parent.element.getElementsByClassName("e-content")[0].children[0].offsetHeight,this.parent.ganttChartModule.chartBodyContent.style.height=this.parent.contentHeight+"px",this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData),this.parent.taskFields.dependency&&this.parent.ganttChartModule.reRenderConnectorLines()),(this.parent.isConnectorLineUpdate||this.parent.undoRedoModule&&this.parent.undoRedoModule.currentAction&&this.parent.undoRedoModule.currentAction.connectedRecords)&&!(0,e.isNullOrUndefined)(this.parent.connectorLineEditModule)&&(this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.connectorLineEditModule.refreshEditedRecordConnectorLine(this.parent.editedRecords),this.parent.ganttChartModule.reRenderConnectorLines(),this.updateScheduleDatesOnEditing(t))),this.parent.enableCriticalPath&&this.parent.criticalPathModule){var n=this.parent.criticalPathModule;n.showCriticalPath(!0),n.criticalConnectorLine(n.criticalPathCollection,n.detailPredecessorCollection,!0,n.predecessorCollectionTaskIds)}!this.parent.editSettings.allowTaskbarEditing||this.parent.editSettings.allowTaskbarEditing&&!this.taskbarEditModule.dependencyCancel?(i.requestType="save",i.data=t.data,i.modifiedRecords=this.parent.editedRecords,i.modifiedTaskData=d(this.parent.editedRecords,null,null,this.parent),(0,e.isNullOrUndefined)(t.action)||(0,e.setValue)("action",t.action,i),"TaskbarEditing"===t.action&&(i.taskBarEditAction=t.taskBarEditAction),this.endEditAction(t),this.parent.trigger("actionComplete",i),this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&this.parent.rowDragAndDropModule.draggedRecord&&(this.parent.rowDragAndDropModule.draggedRecord=null),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()):(this.taskbarEditModule.dependencyCancel=!1,this.resetEditProperties()),"ResourceView"===this.parent.viewType&&this.isTreeGridRefresh&&(this.parent.treeGrid.parentData=[],this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.predecessorModule.createConnectorLinesCollection(this.parent.flatData),this.parent.treeGrid.refresh(),this.isTreeGridRefresh=!1),this.parent.editedRecords=[]},a.prototype.updateResoures=function(t,i,r){var a=this.parent.flatData,n=i?i.length:0,s=t?t.length:0;if(0!==n||0!==s){for(var o=0;o<n;o++){var l=[];"NaN"===(f=parseInt(i[o][this.parent.resourceFields.id],10).toString())&&(f=i[o][this.parent.resourceFields.id]);for(var d=0;d<t.length;d++){var h=parseInt(t[d][this.parent.resourceFields.id],10).toString();if("NaN"===h&&(h=t[d][this.parent.resourceFields.id]),h===f){l.push(d);break}}if(0===l.length){var p=a[this.parent.getTaskIds().indexOf("R"+f)];p&&this.addNewRecord(r,p)}else{var u=parseInt(l[0].toString(),10);"NaN"===u.toString()&&(u=l[0].toString()),t.splice(u,1)}}var c=t?t.length:0;for(o=0;o<c;o++){var g=r.ganttProperties.taskId,f=t[o][this.parent.resourceFields.id],m=a[this.parent.getTaskIds().indexOf("R"+f)];if(!(0,e.isNullOrUndefined)(m))for(var y=0;y<m.childRecords.length;y++)m.childRecords[y].ganttProperties.taskId===g&&this.removeChildRecord(m.childRecords[y])}if(n>0){var D=this.parent.getParentTask(r.parentItem);D&&D.ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&this.removeChildRecord(r)}0===n&&this.checkWithUnassignedTask(r),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.flatData[this.parent.flatData.length-1].ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&(this.parent.flatData.splice(this.parent.flatData.length-1,1),this.parent.currentViewData.splice(this.parent.currentViewData.length-1,1),this.parent.taskIds.splice(this.parent.flatData.length-1,1),this.parent.ids.splice(this.parent.flatData.length-1,1))}},a.prototype.checkWithUnassignedTask=function(t){for(var i=null,r=0;r<this.parent.flatData.length;r++)this.parent.flatData[r].ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&(i=this.parent.flatData[r]);if((0,e.isNullOrUndefined)(i)){var a={};a[this.parent.taskFields.id]=0,a[this.parent.taskFields.name]=this.parent.localeObj.getConstant("unassignedTask");var n=this.parent.isOnEdit;this.parent.isOnEdit=!1;var s=this.parent.dataOperation.createRecord(a,0);this.parent.isOnEdit=n,this.addRecordAsBottom(s);var o=this.parent.flatData[this.parent.flatData.length-1];this.addNewRecord(t,o),this.parent.dataSource.push(t.taskData)}else this.addNewRecord(t,i);var l=this.parent.currentViewData.filter((function(e){return e.ganttProperties.taskId===t.ganttProperties.taskId&&e.hasChildRecords===t.hasChildRecords}))[0];t.parentItem=l.parentItem,t.parentUniqueID=l.parentUniqueID},a.prototype.addRecordAsBottom=function(e){var t=this.parent.flatData.length;this.parent.currentViewData.splice(t+1,0,e),this.parent.flatData.splice(t+1,0,e),this.parent.ids.splice(t+1,0,e.ganttProperties.rowUniqueID.toString());var i=0===e.level?"R"+e.ganttProperties.taskId:"T"+e.ganttProperties.taskId;this.parent.getTaskIds().splice(t+1,0,i),this.updateTreeGridUniqueID(e,"add")},a.prototype.addNewRecord=function(t,r){var a=null;a=(0,e.extend)({},{},t,!0),this.parent.setRecordValue("uniqueID",(0,i.getUid)(this.parent.element.id+"_data_"),a),this.parent.setRecordValue("uniqueID",a.uniqueID,a.ganttProperties,!0);var n=a.uniqueID.replace(this.parent.element.id+"_data_","");this.parent.setRecordValue("rowUniqueID",n,a),this.parent.setRecordValue("rowUniqueID",n,a.ganttProperties,!0),this.parent.setRecordValue("level",1,a),this.parent.taskFields.parentID&&this.parent.setRecordValue("parentId",r.ganttProperties.taskId,a.ganttProperties,!0),this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(r),a);var s=a.parentItem?a.parentItem.uniqueID:null;this.parent.setRecordValue("parentUniqueID",s,a),t.ganttProperties.sharedTaskUniqueIds.push(n),a.ganttProperties.sharedTaskUniqueIds=t.ganttProperties.sharedTaskUniqueIds,this.addRecordAsChild(r,a)},a.prototype.removeChildRecord=function(e){var t=this.parent,i=[];i=this.parent.dataSource instanceof r.DataManager&&this.parent.dataSource.dataSource.json.length>0?this.parent.dataSource.dataSource.json:this.parent.currentViewData;var a=this.parent.dataSource,n=e,s=this.parent.getParentTask(n.parentItem);if(n){if(n.parentItem){var o=s?s.childRecords:[],l=0;o&&o.length>0&&(1===o.length&&(this.parent.isOnDelete=!0,o[0].isDelete=!0,this.parent.dataOperation.updateParentItems(s),this.parent.isOnDelete=!1,o[0].isDelete=!1),l=o.indexOf(n),s.childRecords.splice(l,1),this.updateParentRecords.push(s))}if(n.ganttProperties.sharedTaskUniqueIds.length){var d=n.ganttProperties.sharedTaskUniqueIds.indexOf(n.ganttProperties.rowUniqueID);n.ganttProperties.sharedTaskUniqueIds.splice(d,1)}if(this.updateTreeGridUniqueID(n,"delete"),!this.parent.taskFields.parentID){var h=[];h.push(n.ganttProperties.rowUniqueID.toString()),"ProjectView"===this.parent.viewType&&this.parent.editModule.removeFromDataSource(h)}var p=this.parent.flatData.indexOf(n);if(t.taskFields.parentID){for(var u=void 0,c=this.parent.currentViewData,g=0;g<c.length;g++)c[g].ganttProperties.rowUniqueID===n.ganttProperties.rowUniqueID&&(u=g);-1!==u&&(a.length>0&&a.splice(u,1),i.splice(u,1),this.parent.flatData.splice(p,1),this.parent.ids.splice(p,1),this.parent.getTaskIds().splice(p,1))}var f=i.indexOf(n);if(!t.taskFields.parentID){var m=this.parent.editModule.getChildCount(n,0);i.splice(f,m+1),this.parent.flatData.splice(p,m+1),this.parent.ids.splice(p,m+1),this.parent.getTaskIds().splice(p,m+1)}n.parentItem&&s&&s.childRecords&&!s.childRecords.length&&(this.parent.setRecordValue("expanded",!1,s),this.parent.setRecordValue("hasChildRecords",!1,s))}},a.prototype.addRecordAsChild=function(t,i){var r,a,n=this.parent,s=this.parent.flatData.indexOf(t),o=this.parent.editModule.getChildCount(t,0),l=this.parent.getTaskByUniqueID(i.parentItem.uniqueID);if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.dialogModule.indexes&&this.dialogModule.indexes.deletedIndexes&&this.dialogModule.indexes.deletedIndexes.length>0)if(l.ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask"))r=this.parent.taskIds.length+1;else for(var d=0;d<this.dialogModule.indexes.deletedIndexes.length;d++){if(this.dialogModule.indexes.deletedIndexes[d].data.parentUniqueID===i.parentUniqueID&&i.ganttProperties.taskId===this.dialogModule.indexes.deletedIndexes[d].data.ganttProperties.taskId){var h=this.dialogModule.indexes.deletedIndexes[d].index;r="above"===this.dialogModule.indexes.deletedIndexes[d].position?h:h+1;for(var p=0;p<t.childRecords.length;p++)if("T"+t.childRecords[p].ganttProperties.taskId===this.dialogModule.indexes.deletedIndexes[d].id){a="above"===this.dialogModule.indexes.deletedIndexes[d].position?p:p+1;break}break}if(this.dialogModule.indexes.deletedIndexes[d].data.parentUniqueID!==i.parentUniqueID&&i.ganttProperties.taskId===this.dialogModule.indexes.deletedIndexes[d].data.ganttProperties.taskId){var u=this.parent.getTaskByUniqueID(i.parentItem.uniqueID);r=u.index+u.childRecords.length+1;break}}else if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&l.ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&this.parent.undoRedoModule.currentAction.deletedRecordsDetails){for(p=0;p<this.parent.undoRedoModule.currentAction.deletedRecordsDetails.length;p++)if(this.parent.undoRedoModule.currentAction.deletedRecordsDetails[p].data.ganttProperties.taskId===i.ganttProperties.taskId){l.index?a=(r=this.parent.undoRedoModule.currentAction.deletedRecordsDetails[p].data.index)-l.index-1:(r=(0,e.isNullOrUndefined)(o)||0===o?s+1:o+s+1,a=0);break}}else if(!(0,e.isNullOrUndefined)(this.addRowIndex)&&this.addRowPosition&&t.childRecords&&"Child"!==this.addRowPosition){var c=t.childRecords[this.addRowIndex],g="Above"===this.addRowPosition||"Below"===this.addRowPosition?this.addRowPosition:"Child";r=c?this.addRowIndex+s+1:o+s+1,r="Above"===g?r:r+1}else r=(0,e.isNullOrUndefined)(o)||0===o?s+1:o+s+1;this.parent.currentViewData.splice(r,0,i),this.parent.flatData.splice(r,0,i),this.parent.ids.splice(r,0,i.ganttProperties.rowUniqueID.toString()),this.updateTreeGridUniqueID(i,"add");var f=0===i.level?"R"+i.ganttProperties.taskId:"T"+i.ganttProperties.taskId;this.parent.getTaskIds().splice(r,0,f),t.hasChildRecords||(this.parent.setRecordValue("hasChildRecords",!0,t),this.parent.setRecordValue("expanded",!0,t),t.childRecords.length||(t.childRecords=[],!n.taskFields.parentID&&(0,e.isNullOrUndefined)(t.taskData[this.parent.taskFields.child])&&(t.taskData[this.parent.taskFields.child]=[]))),a>=0?t.childRecords.splice(a,0,i):t.childRecords.splice(t.childRecords.length,0,i),(0,e.isNullOrUndefined)(i)||this.parent.taskFields.parentID||(0,e.isNullOrUndefined)(t.taskData[this.parent.taskFields.child])||t.taskData[this.parent.taskFields.child].splice(t.childRecords.length,0,i.taskData),(0,e.isNullOrUndefined)(i.parentItem)||this.updateParentRecords.push(t)},a.prototype.resetEditProperties=function(t){this.parent.currentEditedArgs={},this.resetValidateArgs(),this.parent.editedTaskBarItem=null,this.parent.isOnEdit=!1,this.parent.predecessorModule.validatedChildItems=[],this.parent.isConnectorLineUpdate=!1,this.parent.editedTaskBarItem=null,this.taskbarMoved=!1,this.predecessorUpdated=!1,!(0,e.isNullOrUndefined)(this.dialogModule)&&((0,e.isNullOrUndefined)(t)||!(0,e.isNullOrUndefined)(t)&&"beforeSave"===t.requestType&&t.cancel)&&(this.dialogModule.dialog&&!this.dialogModule.dialogObj.isDestroyed&&this.dialogModule.dialogObj.hide(),this.dialogModule.dialogClose()),this.parent.hideSpinner(),this.parent.initiateEditAction(!1)},a.prototype.endEditAction=function(e){this.resetEditProperties(),"TaskbarEditing"===e.action?this.parent.trigger("taskbarEdited",e):"CellEditing"===e.action?this.parent.trigger("endEdit",e):"DialogEditing"===e.action&&(this.dialogModule.dialog&&!this.dialogModule.dialogObj.isDestroyed&&this.dialogModule.dialogObj.hide(),this.dialogModule.dialogClose())},a.prototype.saveFailed=function(e){this.reUpdatePreviousRecords(),this.parent.hideSpinner()},a.prototype.renderDeleteConfirmDialog=function(){var e=new t.Dialog({width:"320px",isModal:!0,visible:!1,enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("confirmDelete"),buttons:[{click:this.confirmDeleteOkButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("okText"),isPrimary:!0}},{click:this.closeConfirmDialog.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],target:this.parent.element,animationSettings:{effect:"None"}});e.appendTo("#"+this.parent.element.id+"_deleteConfirmDialog"),this.confirmDialog=e},a.prototype.closeConfirmDialog=function(){this.confirmDialog.hide()},a.prototype.confirmDeleteOkButton=function(){this.deleteSelectedItems(),this.confirmDialog.hide(),this.parent.element.querySelector(".e-treegrid").focus()},a.prototype.startDeleteAction=function(){this.parent.editSettings.allowDeleting&&!this.parent.readOnly&&(this.parent.editSettings.showDeleteConfirmDialog?this.confirmDialog.show():(this.deleteSelectedItems(),this.parent.element.querySelector(".e-treegrid").focus()))},a.prototype.deleteResourceRecords=function(e){for(var t=[],i=function(i){if(e[i].parentItem)if(1===e[i].ganttProperties.sharedTaskUniqueIds.length){for(var a=e[i],n=a.ganttProperties.sharedTaskUniqueIds,s=0;s<n.length;s++)-1!==r.parent.ids.indexOf(n[s].toString())?t.push(r.parent.flatData[r.parent.ids.indexOf(n[s].toString())]):r.parent.undoRedoModule&&r.parent.undoRedoModule.isUndoRedoPerformed&&r.parent.undoRedoModule.currentAction&&"Delete"===r.parent.undoRedoModule.currentAction.action&&t.push(r.parent.flatData[r.parent.taskIds.indexOf("T"+e[i].ganttProperties.taskId)]);-1!==r.parent.ids.indexOf(a.ganttProperties.rowUniqueID)&&-1===t.indexOf(r.parent.flatData[r.parent.ids.indexOf(a.ganttProperties.rowUniqueID)])&&t.push(r.parent.flatData[r.parent.ids.indexOf(a.ganttProperties.rowUniqueID)])}else r.parent.undoRedoModule&&r.parent.undoRedoModule.isUndoRedoPerformed&&e[i].ganttProperties.sharedTaskUniqueIds.length>1&&t.push(e[i]);else{var o=r.parent.flatData.filter((function(t){return t.ganttProperties.taskId===e[i].ganttProperties.taskId&&t.hasChildRecords}))[0];t.push(o)}},r=this,a=0;a<e.length;a++)i(a);this.deleteRow(t)},a.prototype.add=function(e,t){if(t.push(e),e.hasChildRecords)for(var i=e.childRecords,r=0;r<i.length;r++)this.add(i[r],t);else-1===t.indexOf(e)&&t.push(e)},a.prototype.deleteSelectedItems=function(){if(this.isFromDeleteMethod)this.targetedRecords.length&&("ResourceView"===this.parent.viewType?this.deleteResourceRecords(this.targetedRecords):this.deleteRow(this.targetedRecords)),this.isFromDeleteMethod=!1;else{var e=[];"Cell"!==this.parent.selectionSettings.mode?e=this.parent.selectionModule.getSelectedRecords():"Cell"===this.parent.selectionSettings.mode&&(e=this.parent.selectionModule.getCellSelectedRecords()),"ResourceView"===this.parent.viewType?this.deleteResourceRecords(e):this.deleteRow(e)}},a.prototype.deleteRecord=function(t){this.isFromDeleteMethod=!0;var i=typeof t;switch(this.targetedRecords=[],i){case"number":case"string":var r=t.toString();"ResourceView"===this.parent.viewType?(0,e.isNullOrUndefined)(r)||-1===this.parent.getTaskIds().indexOf("T"+r)||this.targetedRecords.push(this.parent.flatData[this.parent.getTaskIds().indexOf("T"+r)]):(0,e.isNullOrUndefined)(r)||-1===this.parent.ids.indexOf(r)||this.targetedRecords.push(this.parent.getRecordByID(r));break;case"object":Array.isArray(t)?this.updateTargetedRecords(t):this.targetedRecords.push(t.valueOf())}this.startDeleteAction()},a.prototype.updateTargetedRecords=function(t){if(t.length)if("object"===typeof t[0])this.targetedRecords=t;else for(var i=0;i<t.length;i++){var r=t[i].toString();"ResourceView"===this.parent.viewType?(0,e.isNullOrUndefined)(r)||-1===this.parent.getTaskIds().indexOf("T"+r)||this.targetedRecords.push(this.parent.flatData[this.parent.getTaskIds().indexOf("T"+r)]):(0,e.isNullOrUndefined)(r)||-1===this.parent.ids.indexOf(r)||this.targetedRecords.push(this.parent.getRecordByID(r))}},a.prototype.deleteRow=function(t){var i=t&&t.length?t:this.parent.selectionModule.getSelectedRecords();if(this.parent.addDeleteRecord=!0,i.length){if(this.parent.isOnDelete=!0,i.forEach((function(e){e.isDelete=!0})),"ResourceView"!==this.parent.viewType||t.length||(i=[]),this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("Delete")){this.parent.undoRedoModule.redoEnabled&&!this.parent.undoRedoModule.isUndoRedoPerformed&&(this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.getUndoCollection[0]=[]),this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.undoRedoModule.createUndoCollection();var r={action:"Delete",deletedRecordsDetails:[]};this.parent.undoRedoModule.findPosition((0,e.extend)([],[],i,!0),r,"deletedRecordsDetails"),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=r}for(var a=function(t){var r=i[t];if(-1!==n.deletedTaskDetails.indexOf(r))return"continue";var a=[r];if("ResourceView"===n.parent.viewType&&n.parent.undoRedoModule&&n.parent.undoRedoModule.isUndoRedoPerformed&&i[t].ganttProperties.resourceInfo&&i[t].ganttProperties.resourceInfo.length>1&&(a=[],!i[t].hasChildRecords)){var s="T"+i[t].ganttProperties.taskId;n.parent.taskIds.reduce(function(e,t){e===s&&a.push(this.parent.flatData[t])}.bind(n),[])}for(var o=0;o<a.length;o++){var l=n.parent.getParentTask(a[o].parentItem);if(a[o].parentItem){var d=void 0;if(!(0,e.isNullOrUndefined)(l))(1===(d=l.childRecords).length?d:d.filter((function(e){return!e.isDelete}))).length>0&&n.parent.dataOperation.updateParentItems(a[o].parentItem)}var h=a[o].ganttProperties.predecessor,p=!0;"ResourceView"===n.parent.viewType&&l&&l.ganttProperties.taskName!==n.parent.localeObj.getConstant("unassignedTask")&&(p=!1),h&&h.length&&p&&n.removePredecessorOnDelete(a[o]),n.deletedTaskDetails.push(a[o]),a[o].hasChildRecords&&n.deleteChildRecords(a[o])}},n=this,s=0;s<i.length;s++)a(s);this.parent.selectionModule&&this.parent.allowSelection&&this.parent.selectionModule.clearSelection();var o={};o.deletedRecordCollection=this.deletedTaskDetails,o.updatedRecordCollection=this.parent.editedRecords,o.cancel=!1,o.action="delete",this.initiateDeleteAction(o),this.parent.isOnDelete=!1}(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},a.prototype.removePredecessorOnDelete=function(t){for(var i=t.ganttProperties.predecessor,r=0;r<i.length;r++){var a=i[r],n="ResourceView"===this.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID;if(a.from.toString()===n.toString()){var s=this.parent.connectorLineModule.getRecordByID(a.to.toString());if(!(0,e.isNullOrUndefined)(s)){for(var o=(0,e.extend)([],[],s.ganttProperties.predecessor,!0),l=void 0,d=0;d<o.length;d++){var h="ResourceView"===this.parent.viewType?s.ganttProperties.taskId:s.ganttProperties.rowUniqueID;if(o[d].to.toString()===h.toString()&&o[d].from.toString()===n.toString()){l=d;break}}o.splice(l,1),this.updatePredecessorValues(s,o)}}else if(a.to.toString()===n.toString()){var p=this.parent.connectorLineModule.getRecordByID(a.from.toString());if(!(0,e.isNullOrUndefined)(p)){var u=(0,e.extend)([],[],p.ganttProperties.predecessor,!0);for(l=void 0,d=0;d<u.length;d++){var c="ResourceView"===this.parent.viewType?p.ganttProperties.taskId:p.ganttProperties.rowUniqueID;if(u[d].from.toString()===c.toString()&&u[d].to.toString()===n.toString()){l=d;break}}(t.uniqueID===p.parentUniqueID||t.parentUniqueID===p.uniqueID||this.parent.isOnDelete)&&(u.splice(l,1),this.updatePredecessorValues(p,u))}}}},a.prototype.updatePredecessorValues=function(e,t){this.parent.setRecordValue("predecessor",t,e.ganttProperties,!0);var i=this.parent.predecessorModule.getPredecessorStringValue(e);this.parent.setRecordValue("predecessorsName",i,e.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,i,e),this.parent.setRecordValue(this.parent.taskFields.dependency,i,e)},a.prototype.updateTaskId=function(t,i){if(!this.parent.readOnly){var r="number"==typeof t?t.toString():t,a="number"==typeof i?i.toString():i,n=this.parent.ids;if(!(0,e.isNullOrUndefined)(r)&&!(0,e.isNullOrUndefined)(a)){var s=n.indexOf(r),o=n.indexOf(a);if(-1===s||o>-1)return;var l=this.parent.flatData[s];if((0,e.isNullOrUndefined)(l)||(this.parent.setRecordValue("taskId",i,l.ganttProperties,!0),this.parent.setRecordValue("rowUniqueID",a,l.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.id,i,l,!0),this.parent.setRecordValue(this.parent.taskFields.id,i,l.taskData,!0)),n[s]=a,l.hasChildRecords&&this.parent.taskFields.parentID)for(var d=l.childRecords,h=0;h<d.length;h++){var p=d[h];p[this.parent.taskFields.parentID]=i,this.parent.chartRowsModule.refreshRecords([p])}if(this.parent.taskFields.dependency&&!(0,e.isNullOrUndefined)(l.ganttProperties.predecessor))for(var u=l.ganttProperties.predecessor,c=void 0,g=0;g<u.length;g++){var f=u[g];f.to===r?c=this.parent.flatData[n.indexOf(f.from)]:f.from===r&&(c=this.parent.flatData[n.indexOf(f.to)]),this.updatePredecessorOnUpdateId(c,r,a)}this.parent.treeGrid.parentData=[],this.parent.treeGrid.refresh()}}},a.prototype.updatePredecessorOnUpdateId=function(e,t,i){if(this.parent.flatData.indexOf(e)>-1)for(var r=e.ganttProperties.predecessor,a=0;a<r.length;a++){var n=r[a];n.to===t?n.to=i:n.from===t&&(n.from=i)}this.updatePredecessorValues(e,e.ganttProperties.predecessor)},a.prototype.deleteChildRecords=function(e){for(var t=e.childRecords,i=0;i<t.length;i++){var r=t[i];if(-1===this.deletedTaskDetails.indexOf(r)){var a=r.ganttProperties.predecessor,n=!0,s=this.parent.getParentTask(r.parentItem);"ResourceView"===this.parent.viewType&&s&&s.ganttProperties.taskName!==this.parent.localeObj.getConstant("unassignedTask")&&(n=!1),a&&a.length&&n&&this.removePredecessorOnDelete(r),this.deletedTaskDetails.push(r),r.hasChildRecords&&this.deleteChildRecords(r)}}},a.prototype.removeFromDataSource=function(e){var t;t=this.parent.dataSource instanceof r.DataManager?this.parent.dataSource.dataSource.json:this.parent.dataSource,this.removeData(t,e),this.isBreakLoop=!1},a.prototype.removeData=function(t,i){for(var r=0;r<t.length&&!this.isBreakLoop;r++)if(-1!==i.indexOf((0,e.getValue)(this.parent.taskFields.id,t[r]).toString())){if(t[r][this.parent.taskFields.child]){var a=t[r][this.parent.taskFields.child];this.removeData(a,i)}if(i.splice(i.indexOf((0,e.getValue)(this.parent.taskFields.id,t[r]).toString()),1),t.splice(r,1),0===i.length){this.isBreakLoop=!0;break}}else if(t[r][this.parent.taskFields.child]){a=t[r][this.parent.taskFields.child];this.removeData(a,i)}},a.prototype.initiateDeleteAction=function(t){var i=this;this.parent.showSpinner();var a={requestType:"beforeDelete"};a.data=t.deletedRecordCollection,a.modifiedRecords=t.updatedRecordCollection,a.modifiedTaskData=d(t.updatedRecordCollection,null,null,this.parent),this.parent.trigger("actionBegin",a,(function(a){if((0,e.isNullOrUndefined)(i.parent.loadingIndicator)||"Shimmer"!==i.parent.loadingIndicator.indicatorType?i.parent.showSpinner():i.parent.showMaskRow(),a.cancel){for(var n=i.deletedTaskDetails,s=0;s<n.length;s++)n[s].isDelete=!1;i.deletedTaskDetails=[],i.reUpdatePreviousRecords(),i.parent.initiateEditAction(!1),i.parent.hideSpinner()}else if(l(i.parent.dataSource)){var o=i.parent.dataSource;i.parent.timezone&&a.modifiedRecords.forEach((function(e){h(e,i.parent)}));var p={deletedRecords:d(a.data,null,null,i.parent),changedRecords:a.modifiedTaskData},u=o.adaptor,c=i.parent.query instanceof r.Query?i.parent.query:new r.Query;if(u instanceof r.WebApiAdaptor&&u instanceof r.ODataAdaptor&&!o.dataSource.batchUrl){for(var g="deletedRecords",f=null,m=0;m<p[g].length;m++)f=o.remove(i.parent.taskFields.id,p[g][m],null,c);f.then((function(){for(var e="changedRecords",r=function(t){p.deletedRecords.some((function(r){return r[i.parent.taskFields.id]===p[e][t].taskId}))&&p[e].splice(t,1)},a=p[e].length-1;a>=0;a--)r(a);o.update(i.parent.taskFields.id,p[e],null,c).then((function(){return i.deleteSuccess(t)})).catch((function(e){return i.dmFailure(e,t)}))})).catch((function(e){return i.dmFailure(e,t)}))}else{o.saveChanges(p,i.parent.taskFields.id,null,c).then((function(){return i.deleteSuccess(t)})).catch((function(e){return i.dmFailure(e,t)}))}}else i.deleteSuccess(t)}))},a.prototype.deleteSuccess=function(t){for(var i=this,r=this.parent.flatData,a=this.parent.currentViewData,n=[],s=0;s<t.deletedRecordCollection.length;s++)if("ProjectView"===this.parent.viewType){var o=this.parent.getRecordByID(t.deletedRecordCollection[s].ganttProperties.taskId);(0,e.isNullOrUndefined)(o)||n.push(o)}else{var l=void 0;l=t.deletedRecordCollection[s].hasChildRecords?"R"+t.deletedRecordCollection[s].ganttProperties.taskId:"T"+t.deletedRecordCollection[s].ganttProperties.taskId,this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed?n.push(this.parent.getTaskByUniqueID(t.deletedRecordCollection[s].uniqueID)):n.push(this.parent.flatData[this.parent.taskIds.indexOf(l.toString())])}var h=[];if(n.length>0){var p=this.parent.flatData.indexOf(n[n.length-1]);this.parent.staticSelectedRowIndex=this.parent.selectedRowIndex=p;o=this.parent.flatData[this.parent.selectedRowIndex+1];if((0,e.isNullOrUndefined)(o)){var u=this.parent.selectedRowIndex-1;u>=0&&(this.parent.currentSelection=this.parent.flatData[u])}else this.parent.currentSelection=o}this.deletedRecord=n;for(s=0;s<n.length;s++){var c=n[s],g=void 0,f=void 0;"ResourceView"===this.parent.viewType?c.hasChildRecords?(g=this.parent.taskIds.indexOf("R"+c.ganttProperties.taskId.toString()),f=this.parent.taskIds.indexOf("R"+c.ganttProperties.taskId.toString())):(g=this.parent.taskIds.indexOf("T"+c.ganttProperties.taskId.toString()),f=this.parent.taskIds.indexOf("T"+c.ganttProperties.taskId.toString())):(g=a.indexOf(c),f=r.indexOf(c));var m=this.parent.treeGrid.parentData.indexOf(c),y=(0,e.getValue)("dataOperation.dataArray",this.parent),D=y.indexOf(c.taskData),v=void 0;if(-1!==g&&a.splice(g,1),-1!==f&&r.splice(f,1),-1!==D&&y.splice(D,1),!(0,e.isNullOrUndefined)(c)){if(h.push(c.ganttProperties.taskId.toString()),-1!==f&&(this.parent.ids.splice(f,1),"ResourceView"===this.parent.viewType&&(this.parent.getTaskIds().splice(f,1),c.hasChildRecords||(c.ganttProperties.resourceInfo=null,delete c.ganttProperties.resourceNames,c[this.parent.taskFields.resourceInfo]=null,c.ganttProperties.sharedTaskUniqueIds=[],delete c.taskData[this.parent.taskFields.resourceInfo]))),0===c.level&&-1!==m&&this.parent.treeGrid.parentData.splice(m,1),c.parentItem){var k=this.parent.getParentTask(c.parentItem);if(k){var w=k.childRecords;-1!==(v=w.indexOf(c))&&w.splice(v,1),w.length||this.parent.setRecordValue("hasChildRecords",!1,k)}}this.updateTreeGridUniqueID(c,"delete")}}h.length>0&&this.removeFromDataSource(h);var b={};if(this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.predecessorModule.createConnectorLinesCollection(this.parent.flatData),this.parent.treeGrid.parentData=[],this.isAdded=!1,this.parent.treeGrid.refresh(),this.parent.enableImmutableMode&&this.refreshRecordInImmutableMode(),b.requestType="delete",b.data=t.deletedRecordCollection,b.modifiedRecords=t.updatedRecordCollection,b.modifiedTaskData=d(t.updatedRecordCollection,null,null,this.parent),(0,e.setValue)("action",t.action,b),this.parent.isOnDelete=!1,"ResourceView"===this.parent.viewType&&(!this.parent.undoRedoModule||this.parent.undoRedoModule&&(!this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.undoRedoModule.isUndoRedoPerformed&&"Delete"===this.parent.undoRedoModule.currentAction.action))){var T=b.data.filter((function(e){return!e.hasChildRecords})),P=function(e){var t=S.parent.flatData.filter((function(e){return e.ganttProperties.taskName===i.parent.localeObj.getConstant("unassignedTask")}))[0],r=[];t&&(r=t.childRecords.filter((function(t){return t.ganttProperties.taskId===T[e].ganttProperties.taskId})));var a=S.parent.getParentTask(T[e].parentItem);a&&a.ganttProperties.taskName!==S.parent.localeObj.getConstant("unassignedTask")&&0===r.length?S.checkWithUnassignedTask(T[e]):a||r&&0!==r.length||S.checkWithUnassignedTask(T[e]),t=S.parent.flatData.filter((function(e){return e.ganttProperties.taskName===i.parent.localeObj.getConstant("unassignedTask")}))[0];var n=S.parent.currentViewData.filter((function(i){return i.ganttProperties.taskId===T[e].ganttProperties.taskId&&!i.hasChildRecords&&i.parentItem&&t.uniqueID===i.parentItem.uniqueID?i:null}));n[0]&&S.parent.dataOperation.updateParentItems(n[0])},S=this;for(s=0;s<T.length;s++)P(s)}this.parent.trigger("actionComplete",b),this.deletedTaskDetails=[],this.parent.initiateEditAction(!1),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()},a.prototype.getNewTaskId=function(){var e="ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids,t=e.length+1;if("ResourceView"===this.parent.viewType){if((-1!==e.indexOf("T"+t)||-1!==e.indexOf("R"+t))&&(t+=1,-1!==e.indexOf("T"+t)||-1!==e.indexOf("R"+t)))do{t+=1}while(-1!==e.indexOf("T"+t)||-1!==e.indexOf("R"+t))}else if(-1!==e.indexOf(t.toString())&&(t+=1,-1!==e.indexOf(t.toString())))do{t+=1}while(-1!==e.indexOf(t.toString()));return"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType?t.toString():t},a.prototype.prepareNewlyAddedData=function(t,i){var r,a,n=this.parent.taskFields,s=this.parent.ids;if(t[n.id]&&(-1!==s.indexOf(t[n.id].toString())?t[n.id]=null:(a="string"==typeof t[n.id]?t[n.id]:parseInt(t[n.id],10),t[n.id]=(0,e.isNullOrUndefined)(a)?null:a)),t[n.id]||(r=this.getNewTaskId(),t[n.id]=r),this.parent.allowUnscheduledTasks||t[n.startDate]||(t[n.startDate]=this.parent.projectStartDate),!this.parent.allowUnscheduledTasks&&n.duration&&(0,e.isNullOrUndefined)(t[n.duration])&&(t[n.endDate]||(t[n.duration]="5")),n.progress&&(t[n.progress]=t[n.progress]?t[n.progress]>100?100:t[n.progress]:0),!this.parent.allowUnscheduledTasks&&!t[n.endDate]&&n.endDate&&!t[n.duration]){var o=this.parent.dataOperation.getDateFromFormat(this.parent.projectStartDate);(0,e.isNullOrUndefined)(o)||(o.setDate(o.getDate()+4),t[n.endDate]=this.parent.getFormatedDate(o,this.parent.getDateFormat()))}},a.prototype.updateNewlyAddedDataBeforeAjax=function(t,i,r,a){var n=this.parent.dataOperation.createRecord(t,i);if(n.index=parseInt(n.ganttProperties.rowUniqueID.toString(),10)-1,!(0,e.isNullOrUndefined)(a)){this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(a),n);var s=n.parentItem?n.parentItem.index:null;this.parent.setRecordValue("parentIndex",s,n);var o=n.parentItem?n.parentItem.uniqueID:null;this.parent.setRecordValue("parentUniqueID",o,n),(0,e.isNullOrUndefined)(this.parent.taskFields.id)||(0,e.isNullOrUndefined)(this.parent.taskFields.parentID)||!n.parentItem||("ProjectView"===this.parent.viewType&&this.parent.setRecordValue(this.parent.taskFields.parentID,n.parentItem.taskId,n.taskData,!0),this.parent.setRecordValue("parentId",n.parentItem.taskId,n.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.parentID,n.parentItem.taskId,n,!0))}if(this.parent.isOnEdit=!0,this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)if(t.hasChildRecords){for(var l=[],d=this.parent.undoRedoModule.currentAction.deletedRecordsDetails,h=0;h<t.childRecords.length;h++)this.add(t.childRecords[h],l);for(var p=0;p<d.length;p++)if(t.ganttProperties.taskId===d[p].data.ganttProperties.taskId){"child"===d[p].position?r="Child":"below"===d[p].position?r="Below":"above"===d[p].position&&(r="Above"),this.backUpAndPushNewlyAddedRecord(n,r,a);for(h=0;h<l.length;h++)"ProjectView"===this.parent.viewType?l[h].parentItem.taskId===n.ganttProperties.taskId&&(l[h].parentItem.index=n.index,l[h].parentItem.taskId=n.ganttProperties.taskId,l[h].parentItem.uniqueID=n.ganttProperties.uniqueID,l[h].parentUniqueID=n.ganttProperties.uniqueID):(l[h].parentItem.index=n.index,l[h].parentItem.taskId=n.ganttProperties.rowUniqueID,l[h].parentItem.uniqueID=n.ganttProperties.uniqueID,l[h].parentUniqueID=n.ganttProperties.uniqueID);break}this.addRowSelectedItem=n,n.taskData[this.parent.taskFields.child]=[];for(var u=0;u<l.length;u++){this.parent.isOnEdit=!1;var c=this.parent.dataOperation.createRecord(l[u],l[u].level);if(0===c.childRecords.length&&c.taskData[this.parent.taskFields.child]&&(c.taskData[this.parent.taskFields.child]=[]),a=this.parent.getRecordByID(l[u].parentItem.taskId),!(0,e.isNullOrUndefined)(a)){this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(a),c);s=c.parentItem?c.parentItem.index:null;this.parent.setRecordValue("parentIndex",s,c);o=c.parentItem?c.parentItem.uniqueID:null;this.parent.setRecordValue("parentUniqueID",o,c),(0,e.isNullOrUndefined)(this.parent.taskFields.id)||(0,e.isNullOrUndefined)(this.parent.taskFields.parentID)||!c.parentItem||("ProjectView"===this.parent.viewType&&this.parent.setRecordValue(this.parent.taskFields.parentID,c.parentItem.taskId,c.taskData,!0),this.parent.setRecordValue("parentId",c.parentItem.taskId,c.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.parentID,c.parentItem.taskId,c,!0))}this.parent.isOnEdit=!0,c.parentItem&&(r=0===a.childRecords.length?"Child":"Below"),this.parent.getParentTask(c.parentItem).childRecords.length>0&&(this.addRowSelectedItem=this.parent.getParentTask(c.parentItem).childRecords[this.parent.getParentTask(c.parentItem).childRecords.length-1]),this.backUpAndPushNewlyAddedRecord(c,r,a);for(h=0;h<l.length;h++)"ProjectView"===this.parent.viewType?l[h].parentItem.taskId===c.ganttProperties.taskId&&(l[h].parentItem.index=c.index,l[h].parentItem.taskId=c.ganttProperties.taskId,l[h].parentItem.uniqueID=c.ganttProperties.uniqueID,l[h].parentUniqueID=c.ganttProperties.uniqueID):(l[h].parentItem.index=n.index,l[h].parentItem.taskId=n.ganttProperties.rowUniqueID,l[h].parentItem.uniqueID=n.ganttProperties.uniqueID,l[h].parentUniqueID=n.ganttProperties.uniqueID)}}else this.backUpAndPushNewlyAddedRecord(n,r,a);else this.backUpAndPushNewlyAddedRecord(n,r,a);return this.parent.taskFields.dependency&&n.ganttProperties.predecessorsName&&(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.predecessorModule.ensurePredecessorCollectionHelper(n,n.ganttProperties),this.parent.predecessorModule.updatePredecessorHelper(n),this.parent.predecessorModule.validatePredecessorDates(n)),n.parentItem&&this.parent.getParentTask(n.parentItem).ganttProperties.isAutoSchedule&&this.parent.dataOperation.updateParentItems(n.parentItem),this.parent.isOnEdit=!1,n},a.prototype.getChildCount=function(e,t){var i;if(!e.hasChildRecords)return 0;for(var r=0;r<e.childRecords.length;r++)t++,(i=e.childRecords[r]).hasChildRecords&&(t=this.getChildCount(i,t));return t},a.prototype.getVisibleChildRecordCount=function(e,t,i){var r,a;if(e.hasChildRecords){a=(r=e.childRecords).length;for(var n=0;n<a;n++)-1!==i.indexOf(r[n])&&t++,r[n].hasChildRecords&&(t=this.getVisibleChildRecordCount(r[n],t,i))}else-1!==i.indexOf(e)&&t++;return t},a.prototype.updatePredecessorOnIndentOutdent=function(t){for(var i,r,a,n=t.ganttProperties.predecessor.length,s=t.ganttProperties,o=s.predecessor,l=0;l<n;l++){var d=this.parent.getRecordByID(o[l].from),h=this.parent.getRecordByID(o[l].to);if(!(a=this.parent.connectorLineEditModule.validateParentPredecessor(d,h))||!this.parent.allowParentDependency)if(o[l].to===s.rowUniqueID.toString()){i=this.parent.getRecordByID(o[l].from),r=u(o[l],"from",i.ganttProperties.predecessor,"to");var p=(0,e.extend)([],i.ganttProperties.predecessor,[],!0);p.splice(r,1),this.parent.setRecordValue("predecessor",p,i.ganttProperties,!0)}else if(o[l].from===s.rowUniqueID.toString()){var c=(i=this.parent.getRecordByID(o[l].to)).ganttProperties.predecessorsName.toString().split(","),g=o[l].from+o[l].type,f=c.indexOf(g);c.splice(f,1),this.parent.setRecordValue("predecessorsName",c.join(","),i.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.dependency,c.join(","),i),r=u(o[l],"from",i.ganttProperties.predecessor,"to");var m=(0,e.extend)([],i.ganttProperties.predecessor,[],!0);m.splice(r,1),this.parent.setRecordValue("predecessor",m,i.ganttProperties,!0),this.parent.predecessorModule.validatePredecessorDates(i)}}a&&this.parent.allowParentDependency||(this.parent.setRecordValue("predecessor",[],t.ganttProperties,!0),this.parent.setRecordValue("predecessorsName","",t.ganttProperties,!0))},a.prototype.predecessorToString=function(e,t){for(var i=[],r=0,a=e.length;r<a;r++)if(t.ganttProperties.rowUniqueID.toString()!==e[r].from){var n=e[r].from+e[r].type;e[r].offset=isNaN(e[r].offset)?0:e[r].offset,0!==e[r].offset&&(e[r].offset<0?n+=e[r].offset.toString()+"d":e[r].offset>0&&(n+="+"+e[r].offset.toString()+"d")),i.push(n)}return i.join(",")},a.prototype.backUpAndPushNewlyAddedRecord=function(t,i,r){var a,n,s,o,l=this.parent.flatData,d=this.parent.currentViewData,h=this.parent.ids;switch(i){case"Top":l.splice(0,0,t),d.splice(0,0,t),h.splice(0,0,t.ganttProperties.rowUniqueID.toString());break;case"Bottom":if(l.push(t),d.push(t),h.push(t.ganttProperties.rowUniqueID.toString()),"ResourceView"===this.parent.viewType){var p=0===t.level?"R"+t.ganttProperties.taskId:"T"+t.ganttProperties.taskId;this.parent.getTaskIds().push(p)}break;case"Above":n=l.indexOf(this.addRowSelectedItem),s=d.indexOf(this.addRowSelectedItem),this.recordCollectionUpdate(o,n,s,t,r,i);break;case"Below":if(a=l.indexOf(this.addRowSelectedItem),this.addRowSelectedItem.hasChildRecords)n=a+this.getChildCount(this.addRowSelectedItem,0)+1,s=d.indexOf(this.addRowSelectedItem)+this.getVisibleChildRecordCount(this.addRowSelectedItem,0,d)+1;else n=a+1,s=d.indexOf(this.addRowSelectedItem)+1;this.recordCollectionUpdate(NaN,n,s,t,r,i);break;case"Child":if(a=l.indexOf(this.addRowSelectedItem),this.addRowSelectedItem.hasChildRecords)n=a+this.getChildCount(this.addRowSelectedItem,0)+1,this.addRowSelectedItem.expanded||this.parent.enableMultiTaskbar||this.parent.expandByID(this.addRowSelectedItem.ganttProperties.rowUniqueID),s=d.indexOf(this.addRowSelectedItem)+this.getVisibleChildRecordCount(this.addRowSelectedItem,0,d)+1;else this.parent.setRecordValue("hasChildRecords",!0,this.addRowSelectedItem),this.parent.setRecordValue("isMilestone",!1,this.addRowSelectedItem.ganttProperties,!0),this.parent.setRecordValue("expanded",!0,this.addRowSelectedItem),this.parent.setRecordValue("childRecords",[],this.addRowSelectedItem),n=a+1,s=d.indexOf(this.addRowSelectedItem)+1,this.addRowSelectedItem.ganttProperties.predecessor&&this.updatePredecessorOnIndentOutdent(this.addRowSelectedItem),(0,e.isNullOrUndefined)(this.addRowSelectedItem.ganttProperties.segments)||(this.addRowSelectedItem.ganttProperties.segments=null);this.recordCollectionUpdate(NaN,n,s,t,r,i)}this.newlyAddedRecordBackup=t},a.prototype.recordCollectionUpdate=function(t,i,a,n,s,o){var l=this.parent.flatData,d=this.parent.currentViewData,h=this.parent.ids;if(l.splice(i,0,n),d.splice(a,0,n),h.splice(i,0,n.ganttProperties.rowUniqueID.toString()),"ResourceView"===this.parent.viewType){var p=0===n.level?"R"+n.ganttProperties.taskId:"T"+n.ganttProperties.taskId;this.parent.getTaskIds().splice(i,0,p)}if(!(0,e.isNullOrUndefined)(s)&&(t="Above"===o?s.childRecords.indexOf(this.addRowSelectedItem):"Below"===o?s.childRecords.indexOf(this.addRowSelectedItem)+1:s.childRecords.length,s.childRecords.splice(t,0,n),this.parent.taskFields.child||(this.parent.taskFields.child="Children"),this.parent.dataSource instanceof r.DataManager&&(0,e.isNullOrUndefined)(s.taskData[this.parent.taskFields.parentID])||!(0,e.isNullOrUndefined)(this.parent.dataSource))){var u=this.parent.taskFields.child;s.taskData[u]&&s.taskData[u].length>0?"Above"===o||"Below"===o?s.taskData[u].splice(t,0,n.taskData):s.taskData[u].push(n.taskData):(s.taskData[u]=[],s.taskData[u].push(n.taskData)),this.isNewRecordAdded=!0}},a.prototype.constructTaskAddedEventArgs=function(e,t,i){var r={};if(r.action=r.requestType=i,e.length>1){r.data=[],r.newTaskData=[],r.recordIndex=[];for(var a=0;a<e.length;a++)r.data[a]=e[a],r.newTaskData[a]=d([e[a]],r.data[a],r,this.parent),r.recordIndex[a]=e[a].index}else if(1===e.length)for(a=0;a<e.length;a++)r.data=e[a],r.newTaskData=d([e[a]],r.data,r,this.parent),r.recordIndex=e[a].index;return r.modifiedRecords=t,r.modifiedTaskData=d(t,null,null,this.parent),r},a.prototype.addSuccess=function(e){this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.predecessorModule.createConnectorLinesCollection(this.parent.flatData),this.parent.treeGrid.parentData=[],this.parent.addDeleteRecord=!0,this.parent.selectionSettings.persistSelection||(this.parent.selectedRowIndex=0),this.parent.treeGrid.isAddedFromGantt=!0,this.isAdded=!0,this.parent.treeGrid.refresh(),this.parent.enableImmutableMode&&(this.parent.modifiedRecords=e.modifiedRecords,this.parent.modifiedRecords.push(e.data),this.refreshRecordInImmutableMode())},a.prototype.refreshRecordInImmutableMode=function(t,i){if(!i&&!(0,e.isNullOrUndefined)(t))for(var r=t[0].index+1;r<this.parent.currentViewData.length&&t[0].level<this.parent.currentViewData[r].level;r++)this.parent.modifiedRecords.push(this.parent.currentViewData[r]);var a=function(e){var t=n.parent.modifiedRecords[e],i=n.parent.rowDragAndDropModule&&n.parent.allowRowDragAndDrop?1:0,r=n.parent.taskFields.id,a=n.parent.currentViewData.findIndex((function(e){return e[r]===t[r]}));if(n.parent.treeGrid.getRows()[a]){var s=n.parent.treeGrid.grid.getRowObjectFromUID(n.parent.treeGrid.grid.getDataRows()[a].getAttribute("data-uid"));n.parent.treeGrid.renderModule.cellRender({data:s.data,cell:n.parent.treeGrid.getRows()[a].cells[n.parent.treeColumnIndex+i],column:n.parent.treeGrid.grid.getColumns()[n.parent.treeColumnIndex],requestType:"rowDragAndDrop"}),n.parent.treeGrid.renderModule.RowModifier({data:t,row:n.parent.treeGrid.getRows()[a],rowHeight:n.parent.rowHeight})}},n=this;for(r=0;r<this.parent.modifiedRecords.length;r++)a(r)},a.prototype.updateRealDataSource=function(t,i){var a=this.parent.taskFields,n=s(this.parent)?(0,e.getValue)("result",this.parent.dataSource):this.parent.dataSource;this.parent.dataSource instanceof r.DataManager&&(n=this.parent.dataSource.dataSource.json);for(var o=0;o<t.length;o++)((0,e.isNullOrUndefined)(i)||(0,e.isNullOrUndefined)(this.addRowSelectedItem))&&(i="Bottom"===i?"Bottom":"Top"),"Top"===i?n.splice(0,0,t[o].taskData):"Bottom"===i?n.push(t[o].taskData):(0,e.isNullOrUndefined)(a.id)||(0,e.isNullOrUndefined)(a.parentID)||"Child"!==i?(this.isNewRecordAdded||this.addDataInRealDataSource(n,t[o].taskData,i),this.isNewRecordAdded=!1):n.push(t[o].taskData),this.isBreakLoop=!1},a.prototype.addDataInRealDataSource=function(t,i,r){for(var a=0;a<t.length;a++){var n=this.parent.taskFields.child;if(this.isBreakLoop)break;if((0,e.getValue)(this.parent.taskFields.id,t[a]).toString()===this.addRowSelectedItem.ganttProperties.rowUniqueID.toString()){var s=void 0;if(this.parent.rowDragAndDropModule&&this.parent.rowDragAndDropModule.droppedRecord&&"ResourceView"===this.parent.viewType)for(var o=0;o<t.length;o++)if(t[o][this.parent.taskFields.id]===this.parent.rowDragAndDropModule.droppedRecord.ganttProperties.taskId){s=o;break}"Above"===r?s?t.splice(s,0,i):t.splice(a,0,i):"Below"===r?s?t.splice(s+1,0,i):t.splice(a+1,0,i):"Child"===r&&(t[a][n]&&t[a][n].length>0||(t[a][n]=[]),t[a][n].push(i)),this.isBreakLoop=!0;break}if(t[a][n]){var l=t[a][n];this.addDataInRealDataSource(l,i,r)}}},a.prototype.updateClientDataFromServer=function(e,t){for(var i=e.addedRecords[0],r=Object.keys(i).length,a=0,n=Object.keys(i);a<r;a++){var s=n[parseInt(a.toString(),10)];t.data[""+s]=i[""+s]}null!==this.parent.taskFields.id&&(t.data.ganttProperties.taskId=i[this.parent.taskFields.id]),null!==this.parent.taskFields.name&&(t.data.ganttProperties.taskName=i[this.parent.taskFields.name]),null!==this.parent.taskFields.startDate&&(t.data.ganttProperties.startDate=i[this.parent.taskFields.startDate]),null!==this.parent.taskFields.endDate&&(t.data.ganttProperties.endDate=i[this.parent.taskFields.endDate]),null!==this.parent.taskFields.duration&&(t.data.ganttProperties.duration=parseFloat(i[this.parent.taskFields.duration])),null!==this.parent.taskFields.durationUnit&&(t.data.ganttProperties.durationUnit=i[this.parent.taskFields.durationUnit]),null!==this.parent.taskFields.progress&&(t.data.ganttProperties.progress=i[this.parent.taskFields.progress]),null!==this.parent.taskFields.dependency&&(t.data.ganttProperties.dependency=i[this.parent.taskFields.dependency]),null!==this.parent.taskFields.parentID&&(t.data.ganttProperties.parentID=i[this.parent.taskFields.parentID]),null!==this.parent.taskFields.baselineEndDate&&(t.data.ganttProperties.baselineEndDate=i[this.parent.taskFields.baselineEndDate]),null!==this.parent.taskFields.baselineStartDate&&(t.data.ganttProperties.baselineStartDate=i[this.parent.taskFields.baselineStartDate]),null!==this.parent.taskFields.resourceInfo&&(t.data.ganttProperties.resources=i[this.parent.taskFields.resourceInfo])},a.prototype.addRecord=function(t,i,a){var n=this,o=this.parent.taskFields.id;if(this.parent.editModule&&this.parent.editSettings.allowAdding){this.parent.isDynamicData=!0,this.parent.isOnAdded=!0;var d=[];if((0,e.isNullOrUndefined)(t))this.validateTaskPosition(t,i,a,d);else if(t instanceof Array)if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed){var h=t,p=a;"ResourceView"===this.parent.viewType&&("below"===t[0].position?i="Below":"above"===t[0].position?i="Above":"child"===t[0].position&&(i="Child"),p=this.parent.taskIds.indexOf(t[0].id.toString()),h=t[0].data),this.validateTaskPosition(h,i,p,d)}else for(var u=0;u<t.length;u++)this.validateTaskPosition(t[u],i,a,d);else{if("object"!=typeof t)return;this.validateTaskPosition(t,i,a,d)}var c;c=this.constructTaskAddedEventArgs(d,this.parent.editedRecords,"beforeAdd"),this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("Add")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection()),this.parent.trigger("actionBegin",c,(function(t){n.parent.previousRecords={},(0,e.isNullOrUndefined)(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.showSpinner():n.parent.showMaskRow();var a,h=n.parent.taskFields;if(a="ResourceView"===n.parent.viewType?t.data.childRecords.length>0?n.parent.flatData[n.parent.getTaskIds().indexOf("R"+t.data[h.id])]:n.parent.flatData[n.parent.getTaskIds().indexOf("T"+t.data[h.id])]:n.parent.getRecordByID(t.data[h.id]),(0,e.isNullOrUndefined)(a)||(n.validateUpdateValues(t.newTaskData,a,!0),n.parent.dateValidationModule.calculateEndDate(a),n.parent.dataOperation.updateWidthLeft(a),n.parent.dataOperation.updateParentItems(a)),!(0,e.isNullOrUndefined)(t.data[""+o])&&t.data[o]!==t.data.ganttProperties.taskId){for(var p=0,u=Object.keys(n.parent.ids);p<u.length;p++){var c=u[p];if(n.parent.ids[c]===t.data.ganttProperties.taskId.toString()){n.parent.ids[c]=t.data[o].toString();break}}t.data.ganttProperties.taskId=t.data[o],t.newTaskData[o]=t.data[o],t.data.ganttProperties.rowUniqueID=t.data[o].toString()}if(t.cancel)n.removeAddedRecord(),n.reUpdatePreviousRecords(),n._resetProperties();else{var g={};if(l(n.parent.dataSource)){var f=n.parent.dataSource,m={addedRecords:[t.newTaskData],changedRecords:t.modifiedTaskData},y=n.parent.query instanceof r.Query?n.parent.query:new r.Query,D=f.adaptor;if(!(D instanceof r.WebApiAdaptor||D instanceof r.ODataAdaptor||D instanceof r.ODataV4Adaptor)||f.dataSource.batchUrl){f.saveChanges(m,n.parent.taskFields.id,null,y).then((function(i){i.addedRecords[0][n.parent.taskFields.id].toString()!==t.data.ganttProperties.taskId&&(t.data.ganttProperties.taskId=i.addedRecords[0][n.parent.taskFields.id].toString(),t.newTaskData[o]=i.addedRecords[0][n.parent.taskFields.id].toString(),t.data.ganttProperties.rowUniqueID=i.addedRecords[0][n.parent.taskFields.id].toString(),n.parent.ids.push(i.addedRecords[0][n.parent.taskFields.id].toString()));var r=t.data.ganttProperties.taskId.toString();if(n.parent.taskFields.id&&!(0,e.isNullOrUndefined)(i.addedRecords[0][n.parent.taskFields.id])&&i.addedRecords[0][n.parent.taskFields.id].toString()===r){n.parent.setRecordValue("taskId",i.addedRecords[0][n.parent.taskFields.id],t.data.ganttProperties,!0),n.parent.setRecordValue("taskData",i.addedRecords[0],t.data),n.parent.setRecordValue(n.parent.taskFields.id,i.addedRecords[0][n.parent.taskFields.id],t.data),n.parent.setRecordValue("rowUniqueID",i.addedRecords[0][n.parent.taskFields.id].toString(),t.data.ganttProperties,!0),n.updateClientDataFromServer(i,t);var a=n.parent.ids.indexOf(r);-1!==a&&(n.parent.ids[a]=i.addedRecords[0][n.parent.taskFields.id].toString())}n.updateNewRecord(d,t)})).catch((function(e){n.removeAddedRecord(),n.dmFailure(e,t),n._resetProperties()}))}else{f.insert(m.addedRecords,null,y).then((function(i){var r;r=(0,e.isNullOrUndefined)(i[0])?m.addedRecords[0]:i[0],d.forEach((function(t){(0,e.isNullOrUndefined)(t)||(n.updateEditedRecordFields(r,t),n.parent.dataOperation.updateTaskData(t))})),n.updateNewRecord(d,t)})).catch((function(e){n.removeAddedRecord(),n.dmFailure(e,t),n._resetProperties()}))}}else{if("ProjectView"===n.parent.viewType){if("Top"===i||"Bottom"===i||"Above"===i||"Below"===i||"Child"===i||(0,e.isNullOrUndefined)(i)&&!t.data.parentItem)if(t.data instanceof Array)n.updateRealDataSource(t.data,i);else{var v=[];v.push(t.data),n.updateRealDataSource(v,i),n.parent.currentSelection=d[0]}}else(s(n.parent)?(0,e.getValue)("result",n.parent.dataSource):n.parent.dataSource).push(t.data.taskData);if(0===d.level&&n.parent.treeGrid.parentData.splice(0,0,d),n.updateTreeGridUniqueID(d,"add"),"ResourceView"===n.parent.viewType&&n.parent.undoRedoModule&&n.parent.undoRedoModule.currentAction){var k=!1;if(t.data.hasChildRecords)k=!0;else if(t.data.parentItem)n.parent.getTaskByUniqueID(t.data.parentItem.uniqueID).ganttProperties.taskName!==n.parent.localeObj.getConstant("unassignedTask")&&(k=!0);if(-1!==n.parent.taskIds.indexOf("R0")&&n.parent.undoRedoModule&&n.parent.undoRedoModule.isUndoRedoPerformed&&"Delete"===n.parent.undoRedoModule.currentAction.action&&k){var w=n.parent.flatData[n.parent.taskIds.indexOf("R0")],b=w.childRecords.filter((function(e){return e.ganttProperties.taskId===t.data.ganttProperties.taskId}));t.data.hasChildRecords&&(b=t.data.childRecords);for(var T=function(e){if(1===w.childRecords.length)n.parent.flatData.splice(n.parent.taskIds.indexOf("R0"),2),n.parent.ids.splice(n.parent.taskIds.indexOf("R0"),2),n.parent.taskIds.splice(n.parent.taskIds.indexOf("R0"),2);else{var t=n.parent.taskIds.indexOf("T"+b[e].ganttProperties.taskId),i="T"+b[e].ganttProperties.taskId,r=n.parent.taskIds.reduce((function(e,t,r){return t===i&&e.push(r),e}),[]);t=r[r.length-1],n.parent.taskIds.splice(t,1),n.parent.flatData.splice(t,1),n.parent.ids.splice(t,1)}},P=0;P<b.length;P++)T(P);if(w&&"ResourceView"===n.parent.viewType)n.parent.flatData[n.parent.taskIds.indexOf("R0")+1]||(n.parent.flatData.splice(n.parent.taskIds.indexOf("R0"),1),n.parent.ids.splice(n.parent.taskIds.indexOf("R0"),1),n.parent.taskIds.splice(n.parent.taskIds.indexOf("R0"),1))}}if(n.refreshNewlyAddedRecord(t,d),"ResourceView"===n.parent.viewType&&n.parent.taskFields.work&&a&&n.parent.dataOperation.updateParentItems(a,!0),n.parent.undoRedoModule&&(!n.parent.undoRedoModule.isUndoRedoPerformed||n.parent.undoRedoModule.isUndoRedoPerformed&&"Add"===n.parent.undoRedoModule.currentAction.action&&"ResourceView"===n.parent.viewType)&&n.parent.isUndoRedoItemPresent("Add")){g.action="Add";for(var S=t.data.length>0?(0,e.extend)([],[],t.data,!0):[t.data],C=[],R=function(e){C=n.parent.flatData.filter((function(t){return S[e].index===t.index&&S[e].ganttProperties.taskId===t.ganttProperties.taskId}))},M=0;M<S.length;M++)R(M);g.addedRecords=(0,e.extend)([],[],C,!0),n.parent.undoRedoModule.getUndoCollection[n.parent.undoRedoModule.getUndoCollection.length-1]=g}n._resetProperties()}n.parent.isOnAdded=!1}}))}},a.prototype.createNewRecord=function(){for(var t={},i=this.parent.ganttColumns,r=this.parent.taskFields,a=this.parent.editModule.getNewTaskId(),n=0;n<i.length;n++){var s=i[n].field;s===r.id?t[s]=a:i[n].field===r.startDate?((0,e.isNullOrUndefined)(t[r.endDate])?t[s]=this.parent.editModule.dialogModule.getMinimumStartDate():t[s]=new Date(t[r.endDate]),this.parent.timezone&&(t[s]=this.parent.dateValidationModule.remove(t[s],this.parent.timezone))):i[n].field===r.endDate?((0,e.isNullOrUndefined)(t[r.startDate])?t[s]=this.parent.editModule.dialogModule.getMinimumStartDate():t[s]=new Date(t[r.startDate]),this.parent.timezone&&(t[s]=this.parent.dateValidationModule.remove(t[s],this.parent.timezone))):i[n].field===r.duration?t[s]=1:i[n].field===r.name?t[s]=this.parent.editModule.dialogModule.localeObj.getConstant("addDialogTitle")+" "+a:i[n].field===r.progress||i[n].field===r.work?t[s]=0:i[n].field===r.type||"taskType"===i[n].field?t[s]=this.parent.taskType:i[n].field===r.milestone?t[s]=null:t[this.parent.ganttColumns[n].field]=""}return t},a.prototype.validateTaskPosition=function(t,i,r,a){var n=(0,e.isNullOrUndefined)(r)||isNaN(parseInt(r.toString(),10))?this.parent.selectionModule?"Row"!==this.parent.selectionSettings.mode&&"Both"!==this.parent.selectionSettings.mode||1!==this.parent.selectionModule.selectedRowIndexes.length?"Cell"===this.parent.selectionSettings.mode&&1===this.parent.selectionModule.getSelectedRowCellIndexes().length?this.parent.selectionModule.getSelectedRowCellIndexes()[0].rowIndex:null:this.parent.selectionModule.selectedRowIndexes[0]:null:r;this.addRowSelectedItem=(0,e.isNullOrUndefined)(n)?null:this.parent.updatedRecords[n],i=(0,e.isNullOrUndefined)(i)?this.parent.editSettings.newRowPosition:i,t=(0,e.isNullOrUndefined)(t)?this.createNewRecord():t,(((0,e.isNullOrUndefined)(n)||n<0||(0,e.isNullOrUndefined)(this.addRowSelectedItem))&&("Above"===i||"Below"===i||"Child"===i)||!i||"Above"!==i&&"Below"!==i&&"Child"!==i&&"Top"!==i&&"Bottom"!==i)&&(i="Top");var s,o=0;switch(i){case"Top":case"Bottom":o="ResourceView"===this.parent.viewType?1:0;break;case"Above":case"Below":o=this.addRowSelectedItem.level,s=this.parent.getParentTask(this.addRowSelectedItem.parentItem);break;case"Child":o=this.addRowSelectedItem.level+1,s=this.addRowSelectedItem}this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.prepareNewlyAddedData(t,i);var l=this.updateNewlyAddedDataBeforeAjax(t,o,i,s);a.push(l)},a.prototype.updateNewRecord=function(t,i){var r=this;t.forEach((function(t){0===t.level&&(r.parent.treeGrid.parentData.splice(0,0,t),(0,e.getValue)("dataOperation.dataArray",r.parent).splice(0,0,t.taskData));r.updateTreeGridUniqueID(t,"add")})),this.refreshNewlyAddedRecord(i,t),this._resetProperties()},a.prototype._resetProperties=function(){this.parent.isOnEdit=!1,this.parent.hideSpinner(),this.addRowSelectedItem=null,this.newlyAddedRecordBackup=null,this.isBreakLoop=!1,this.parent.element.tabIndex=0,this.parent.initiateEditAction(!1)},a.prototype.updateTreeGridUniqueID=function(t,i){"add"===i?(0,e.setValue)("uniqueIDCollection."+t.uniqueID,t,this.parent.treeGrid):"delete"===i&&(0,e.deleteObject)((0,e.getValue)("uniqueIDCollection",this.parent.treeGrid),t.uniqueID)},a.prototype.refreshNewlyAddedRecord=function(t,i){if(this.parent.selectionModule&&this.parent.allowSelection&&("Row"===this.parent.selectionSettings.mode||"Both"===this.parent.selectionSettings.mode)&&(this.parent.staticSelectedRowIndex=this.parent.currentViewData.indexOf(t.data)),this.parent.timelineSettings.updateTimescaleView){var r=[];t.modifiedRecords.length>0?(r=t.data.length>0?(0,e.extend)([],[],t.data,!0):[t.data]).push.apply(r,t.modifiedRecords):r=t.data.length>0?(0,e.extend)([],[],t.data,!0):[t.data],this.parent.timelineModule.updateTimeLineOnEditing([r],t.action)}if(this.addSuccess(t),t=this.constructTaskAddedEventArgs(i,t.modifiedRecords,"add"),this.dialogModule.isAddNewResource&&!this.parent.isEdit&&this.parent.taskFields.work&&this.parent.dataOperation.updateWorkWithDuration(i[0]),this.parent.trigger("actionComplete",t),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.dialogModule.dialog&&!this.dialogModule.dialogObj.isDestroyed&&this.dialogModule.dialogObj.hide(),this.dialogModule.dialogClose(),"ResourceView"===this.parent.viewType)if(i.length>1)for(var a=0;a<i.length;a++){if(t.data[a].ganttProperties.sharedTaskUniqueIds.push(t.data[a].ganttProperties.rowUniqueID),t.data[a].ganttProperties.resourceInfo)(s=(0,e.extend)([],[],t.data[a].ganttProperties.resourceInfo,!0)).splice(0,1),this.updateResoures([],s,t.data[a]);else(!this.parent.undoRedoModule||this.parent.undoRedoModule&&!t.data[a].hasChildRecords&&this.parent.undoRedoModule.isUndoRedoPerformed||!this.parent.undoRedoModule.isUndoRedoPerformed)&&(this.removeChildRecord(t.data[a]),this.parent.editModule.checkWithUnassignedTask(t.data[a]));for(var n=0;n<this.updateParentRecords.length;n++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[n]);this.updateParentRecords=[]}else{var s;if(t.data.ganttProperties.sharedTaskUniqueIds.push(t.data.ganttProperties.rowUniqueID),t.data.ganttProperties.resourceInfo&&t.data.ganttProperties.resourceInfo.length){if(t.data.ganttProperties.resourceInfo.length>1)(s=(0,e.extend)([],[],t.data.ganttProperties.resourceInfo,!0)).splice(0,1),this.updateResoures([],s,t.data)}else(!this.parent.undoRedoModule||this.parent.undoRedoModule&&!t.data.hasChildRecords&&this.parent.undoRedoModule.isUndoRedoPerformed||!this.parent.undoRedoModule.isUndoRedoPerformed)&&(this.removeChildRecord(t.data),this.parent.editModule.checkWithUnassignedTask(t.data));for(n=0;n<this.updateParentRecords.length;n++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[n]);this.updateParentRecords=[]}},a.prototype.removeAddedRecord=function(){var t=this.parent.flatData,i=this.parent.currentViewData,r=this.parent.ids,a=t.indexOf(this.newlyAddedRecordBackup),n=i.indexOf(this.newlyAddedRecordBackup),s=r.indexOf(this.newlyAddedRecordBackup.ganttProperties.rowUniqueID.toString());if((0,e.deleteObject)(this.parent.previousRecords,t[a].uniqueID),this.newlyAddedRecordBackup.parentItem){var o=this.parent.getParentTask(this.newlyAddedRecordBackup.parentItem),l=o.childRecords.indexOf(this.newlyAddedRecordBackup);o.childRecords.splice(l,1)}t.splice(a,1),i.splice(n,1),r.splice(s,1)},a.prototype.getPrevRecordIndex=function(){var e=this.parent.updatedRecords[this.parent.selectionModule.getSelectedRowIndexes()[0]-1],t=this.parent.selectionModule.getSelectedRecords()[0],i=this.parent.getRootParent(e,t.level);return this.parent.updatedRecords.indexOf(i)},a.prototype.indent=function(){var e,t=this.parent.selectedRowIndex,i=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length),r=this.parent.updatedRecords[this.parent.selectionModule.getSelectedRowIndexes()[0]-1],a=this.parent.selectionModule.getSelectedRecords()[0];this.parent.editSettings.allowEditing&&0!==t&&-1!==t&&i&&"ResourceView"!==this.parent.viewType&&this.parent.updatedRecords[t].level-r.level!=1&&(e=r.level-a.level==0?this.parent.selectionModule.getSelectedRowIndexes()[0]-1:this.getPrevRecordIndex(),this.indentOutdentRow([this.parent.selectionModule.getSelectedRowIndexes()[0]],e,"child"))},a.prototype.outdent=function(){var e,t=this.parent.selectionModule.getSelectedRowIndexes()[0],i=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length);if(this.parent.editSettings.allowEditing&&-1!==t&&0!==t&&i&&"ResourceView"!==this.parent.viewType&&0!==this.parent.updatedRecords[t].level){var r=this.parent.getTaskByUniqueID(this.parent.selectionModule.getSelectedRecords()[0].parentItem.uniqueID);e=this.parent.updatedRecords.indexOf(r),this.indentOutdentRow([t],e,"below")}},a.prototype.indentOutdentRow=function(t,i,r){var a=this;t[0],"above"===r&&(this.dropPosition="topSegment"),"below"===r&&(this.dropPosition="bottomSegment"),"child"===r&&(this.dropPosition="middleSegment");for(var n=void 0,s=[],o=0;o<t.length;o++)this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.undoRedoModule.currentAction?this.parent.undoRedoModule.currentAction.modifiedRecord?s[o]=this.parent.undoRedoModule.currentAction.modifiedRecord[o].data:s[o]=this.parent.undoRedoModule.currentAction.data[o]:s[o]=this.parent.updatedRecords[t[o]];var l={data:s,dropIndex:i,dropPosition:this.dropPosition};"middleSegment"===this.dropPosition?n="indenting":"bottomSegment"===this.dropPosition&&(n="outdenting");var d={action:n,data:s[0],cancel:!1};this.parent.trigger("actionBegin",d,(function(t){(0,e.isNullOrUndefined)(a.parent.loadingIndicator)||"Shimmer"!==a.parent.loadingIndicator.indicatorType?a.parent.showSpinner():a.parent.showMaskRow(),t.cancel||a.reArrangeRows(l,true)}))},a.prototype.reArrangeRows=function(t,i){var r=this;if(this.dropPosition=t.dropPosition,"Invalid"!==t.dropPosition&&this.parent.editModule){var a=this.parent,n=void 0;this.droppedRecord=a.updatedRecords[t.dropIndex];var s="middleSegment"===t.dropPosition?"Indent":"Outdent";if(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent(s))(g={}).action=s,g.modifiedRecord=[],g.selectedRowIndexes=(0,e.extend)([],[],this.parent.selectionModule.selectedRowIndexes,!0),this.parent.undoRedoModule.findPosition((0,e.extend)([],[],[t.data],!0)[0],g,"modifiedRecord"),g.droppedRecord=(0,e.extend)([],[],this.droppedRecord,!0),this.parent.undoRedoModule.redoEnabled&&(this.parent.undoRedoModule.redoEnabled=!1,this.parent.undoRedoModule.getUndoCollection=[],this.parent.undoRedoModule.getRedoCollection=[],this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!1),this.parent.undoRedoModule.getUndoCollection[0]=[]),this.parent.undoRedoModule.createUndoCollection(),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=g;var o=[],l=this.droppedRecord;t.data[0]?o=t.data:o.push(t.data);for(var d=0,h=o.length,p=0;p<h;p++){if(this.parent.isOnEdit=!0,n=o[p],this.draggedRecord=n,"Invalid"!==this.dropPosition){i&&this.deleteDragRow();var u=this.treeGridData.indexOf(l);if("bottomSegment"===this.dropPosition){if(l.hasChildRecords){d=this.parent.editModule.getChildCount(l,0),this.parent.taskFields.parentID&&this.ganttData.length>0&&this.ganttData.splice(u+d+1,0,this.draggedRecord.taskData),this.treeGridData.splice(u+d+1,0,this.draggedRecord),this.parent.ids.splice(u+d+1,0,this.draggedRecord.ganttProperties.rowUniqueID.toString());var c=this.parent.ids.indexOf(this.draggedRecord[this.parent.taskFields.id].toString());c!==u+d+1&&(this.parent.ids.splice(c,1),this.parent.ids.splice(u+d+1,0,this.draggedRecord[this.parent.taskFields.id].toString()))}else this.parent.taskFields.parentID&&this.ganttData.length>0&&this.ganttData.splice(u+1,0,this.draggedRecord.taskData),this.treeGridData.splice(u+1,0,this.draggedRecord),this.parent.ids.splice(u+1,0,this.draggedRecord.ganttProperties.rowUniqueID.toString());if(this.parent.setRecordValue("parentItem",this.treeGridData[u].parentItem,n),this.parent.setRecordValue("parentUniqueID",this.treeGridData[u].parentUniqueID,n),this.parent.setRecordValue("level",this.treeGridData[u].level,n),n.hasChildRecords){this.updateChildRecordLevel(n,1),this.updateChildRecord(n,u+d+1)}if(l.parentItem){var g,f=g=this.parent.getParentTask(l.parentItem).childRecords,m=f.indexOf(l)+1;f.splice(m,0,n)}}"middleSegment"===this.dropPosition&&this.dropMiddle(u),(0,e.isNullOrUndefined)(n.parentItem&&-1!==this.updateParentRecords.indexOf(n.parentItem))||this.updateParentRecords.push(this.parent.getTaskByUniqueID(n.parentItem.uniqueID))}if((0,e.isNullOrUndefined)(n.parentItem)){var y=this.parent.treeGrid.parentData,D=y.indexOf(this.droppedRecord);"bottomSegment"===this.dropPosition&&y.splice(D+1,0,n)}this.refreshDataSource()}if("middleSegment"===this.dropPosition){if(!(0,e.isNullOrUndefined)(l.ganttProperties.predecessor))for(var v=l.ganttProperties.predecessor.length-1;v>=0;v--)if(!(0,e.isNullOrUndefined)(l.ganttProperties.predecessor)){var k=this.parent.getRecordByID(l.ganttProperties.predecessor[v].from),w=this.parent.getRecordByID(l.ganttProperties.predecessor[v].to),b=this.parent.connectorLineEditModule.validateParentPredecessor(k,w);!l.ganttProperties.predecessor||b&&this.parent.allowParentDependency||(this.parent.editModule.removePredecessorOnDelete(l),l.ganttProperties.predecessor.splice(v,1),l.ganttProperties.predecessorsName=null,l[this.parent.taskFields.dependency]=null,l.taskData[this.parent.taskFields.dependency]=null)}l.ganttProperties.isMilestone&&(this.parent.setRecordValue("isMilestone",!1,l.ganttProperties,!0),(0,e.isNullOrUndefined)(l.taskData[this.parent.taskFields.milestone])||!0===l.taskData[this.parent.taskFields.milestone]&&(l.taskData[this.parent.taskFields.milestone]=!1))}for(var T=0;T<this.updateParentRecords.length;T++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[T]);this.parent.editedRecords.forEach((function(e){r.isFirstCall=!0,r.parent.predecessorModule.validatePredecessor(e,[],"")}));for(T=0;T<this.updateParentRecords.length;T++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[T]);this.updateParentRecords=[],this.parent.isOnEdit=!1}this.refreshRecord(t)},a.prototype.refreshRecord=function(e,t){var i=this;if(l(this.parent.dataSource)){var a=this.parent.dataSource,n={changedRecords:d(this.parent.editedRecords,null,null,this.parent)},s=this.parent.query instanceof r.Query?this.parent.query:new r.Query,o=null,h=a.adaptor;if(h instanceof r.WebApiAdaptor&&h instanceof r.ODataAdaptor&&!a.dataSource.batchUrl){o=a.update(this.parent.taskFields.id,n.changedRecords,null,s)}else o=a.saveChanges(n,this.parent.taskFields.id,null,s);o.then((function(r){return i.indentSuccess(r,e,t)})).catch((function(e){return i.indentFailure(e)}))}else this.indentOutdentSuccess(e,t)},a.prototype.indentSuccess=function(e,t,i){this.indentOutdentSuccess(t,i)},a.prototype.indentFailure=function(e){this.parent.trigger("actionFailure",{error:e})},a.prototype.indentOutdentSuccess=function(t,i){if(this.parent.treeGrid.parentData=[],this.parent.treeGrid.refresh(),this.parent.enableImmutableMode&&(this.refreshRecordInImmutableMode(t.data,i),this.parent.chartRowsModule.refreshRecords(this.parent.editedRecords)),i?t.requestType="rowDropped":"middleSegment"===this.dropPosition?t.requestType="indented":"bottomSegment"===this.dropPosition&&(t.requestType="outdented"),t.modifiedRecords=this.parent.editedRecords,this.parent.timezone)for(var r=0;r<t.modifiedRecords.length;r++)h(t.modifiedRecords[r],this.parent);this.parent.trigger("actionComplete",t),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.rowDragAndDropModule&&(this.parent.rowDragAndDropModule.draggedRecord=null)},a.prototype.refreshDataSource=function(){var t,i,a=this.draggedRecord,n=this.droppedRecord,s=this.parent;if((t=this.parent.dataSource instanceof r.DataManager?(0,e.getValue)("dataOperation.dataArray",this.parent):s.dataSource).length>0&&!(0,e.isNullOrUndefined)(n)&&!n.parentItem){for(var o=0;o<Object.keys(t).length;o++)t[o][this.parent.taskFields.child]===n.taskData[this.parent.taskFields.child]&&(i=o);"topSegment"===this.dropPosition?this.parent.taskFields.parentID||t.splice(i,0,a.taskData):"bottomSegment"===this.dropPosition&&(this.parent.taskFields.parentID||t.splice(i+1,0,a.taskData))}else if(!this.parent.taskFields.parentID&&!(0,e.isNullOrUndefined)(n)&&n.parentItem&&("topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition)){var l="topSegment"===this.dropPosition?"Above":"Below";this.parent.editModule.addRowSelectedItem=n;var d=[];Array.isArray(a)?d=a:d[0]=a,this.parent.editModule.updateRealDataSource(d,l),delete this.parent.editModule.addRowSelectedItem}this.parent.taskFields.parentID&&(a.parentItem?"topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition?(a[this.parent.taskFields.parentID]=n[this.parent.taskFields.parentID],a.taskData[this.parent.taskFields.parentID]=n[this.parent.taskFields.parentID],a.ganttProperties.parentId=n[this.parent.taskFields.parentID]):(a[this.parent.taskFields.parentID]=n[this.parent.taskFields.id],a.taskData[this.parent.taskFields.parentID]=n[this.parent.taskFields.id],a.ganttProperties.parentId=n[this.parent.taskFields.id]):(a[this.parent.taskFields.parentID]=null,a.taskData[this.parent.taskFields.parentID]=null,a.ganttProperties.parentId=null))},a.prototype.deleteDragRow=function(){this.parent.dataSource instanceof r.DataManager?this.ganttData=(0,e.getValue)("dataOperation.dataArray",this.parent):this.ganttData=s(this.parent)?(0,e.getValue)("result",this.parent.dataSource):this.parent.dataSource,this.treeGridData=s(this.parent)?(0,e.getValue)("result",this.parent.treeGrid.dataSource):this.parent.treeGrid.dataSource;var t=this.parent.getTaskByUniqueID(this.draggedRecord.uniqueID);this.removeRecords(t)},a.prototype.updateIndentedChildRecords=function(e){for(var t={uniqueID:e.uniqueID,expanded:e.expanded,level:e.level,index:e.index,taskId:e.ganttProperties.rowUniqueID},i=0;i<e.childRecords.length;i++)this.parent.setRecordValue("parentItem",t,e.childRecords[i]),this.parent.setRecordValue("parentUniqueID",e.uniqueID,e.childRecords[i]);if(e.hasChildRecords){e=e.childRecords;for(var r=0;r<e.length;r++)this.updateIndentedChildRecords(e[r])}},a.prototype.dropMiddle=function(t){var i,r,a=this.parent;if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.undoRedoModule.currentAction.modifiedRecord&&"child"!==this.parent.undoRedoModule.currentAction.modifiedRecord[0].position?"above"===this.parent.undoRedoModule.currentAction.modifiedRecord[0].position?r=this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.modifiedRecord[0].id.toString()):"below"===this.parent.undoRedoModule.currentAction.modifiedRecord[0].position&&(r=this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.modifiedRecord[0].id.toString())+1):(i=this.parent.editModule.getChildCount(this.droppedRecord,0),r=(0,e.isNullOrUndefined)(i)||0===i?t+1:i+t+1),"middleSegment"===this.dropPosition){if(a.taskFields.parentID&&this.ganttData.length>0&&this.ganttData.splice(r,0,this.draggedRecord.taskData),this.treeGridData.splice(r,0,this.draggedRecord),this.parent.ids.splice(r,0,this.draggedRecord[this.parent.taskFields.id].toString()),this.recordLevel(),this.draggedRecord.hasChildRecords&&(this.updateChildRecord(this.draggedRecord,r,this.droppedRecord.expanded),this.parent.enableImmutableMode)){var n=this.draggedRecord;this.updateIndentedChildRecords(n)}(0,e.isNullOrUndefined)(this.draggedRecord.parentItem&&-1!==this.updateParentRecords.indexOf(this.draggedRecord.parentItem))&&this.updateParentRecords.push(this.draggedRecord.parentItem)}},a.prototype.updateChildRecordLevel=function(e,t){var i,r;if(t++,!e.hasChildRecords)return 0;i=e.childRecords.length;for(var a=0;a<i;a++){r=e.childRecords[a];var n=void 0;if(e.parentItem){n=this.parent.treeGrid.uniqueIDCollection[e.parentItem.uniqueID]}r.level=e.parentItem?n.level+t:e.level+1,r.hasChildRecords&&(t--,t=this.updateChildRecordLevel(r,t))}return t},a.prototype.updateChildRecord=function(e,t,i){var r,a,n=this.parent;if(!e.hasChildRecords)return 0;a=e.childRecords.length;for(var s=0;s<a;s++)r=e.childRecords[s],t++,n.flatData.splice(t,0,r),this.parent.ids.splice(t,0,r.ganttProperties.rowUniqueID.toString()),n.taskFields.parentID&&this.ganttData.length>0&&this.ganttData.splice(t,0,r.taskData),r.hasChildRecords&&(t=this.updateChildRecord(r,t));return t},a.prototype.removeRecords=function(t){var i,a=this.parent;i=this.parent.dataSource instanceof r.DataManager?(0,e.getValue)("dataOperation.dataArray",this.parent):this.parent.dataSource;var n=t;if(n){var s=this.parent.getParentTask(n.parentItem);if(n.parentItem){var o=s?s.childRecords:[],l=0;o&&o.length>0&&(l=o.indexOf(n),s.childRecords.splice(l,1),this.parent.taskFields.parentID||s.taskData[this.parent.taskFields.child].splice(l,1),this.updateParentRecords.push(s))}if(a.taskFields.parentID){n.hasChildRecords&&n.childRecords.length>0&&this.removeChildItem(n);for(var d=void 0,h=i.length>0?i:this.parent.currentViewData,p=0;p<h.length;p++)h[p][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(d=p);if(-1!==d){i.length>0&&i.splice(d,1);var u=void 0;for(p=0;p<this.treeGridData.length;p++)this.treeGridData[p][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(u=p);this.treeGridData.splice(u,1),this.parent.ids.splice(u,1),-1!==this.parent.treeGrid.parentData.indexOf(n)&&this.parent.treeGrid.parentData.splice(this.parent.treeGrid.parentData.indexOf(n),1)}}var c=this.treeGridData.indexOf(n);if(!a.taskFields.parentID){var g=this.getChildCount(n,0);this.treeGridData.splice(c,g+1),this.parent.ids.splice(c,g+1);var f=this.ganttData.indexOf(n.taskData);-1!==f&&(this.ganttData.splice(f,1),this.parent.treeGrid.parentData.splice(f,1))}n.parentItem&&s&&s.childRecords&&!s.childRecords.length&&(this.parent.setRecordValue("expanded",!1,s),this.parent.setRecordValue("hasChildRecords",!1,s))}},a.prototype.removeChildItem=function(t){for(var i,a,n=0;n<t.childRecords.length;n++){i=t.childRecords[n];var s=void 0;s=this.parent.dataSource instanceof r.DataManager?(0,e.getValue)("dataOperation.dataArray",this.parent):this.parent.dataSource;for(var o=0;o<s.length;o++)s[o][this.parent.taskFields.id]===i.taskData[this.parent.taskFields.id]&&(a=o);if(-1!==a){s.length>0&&s.splice(a,1);for(var l=void 0,d=0;d<this.treeGridData.length;d++)this.treeGridData[d][this.parent.taskFields.id]===i.taskData[this.parent.taskFields.id]&&(l=d);this.treeGridData.splice(l,1),this.parent.ids.splice(l,1)}i.hasChildRecords&&this.removeChildItem(i)}},a.prototype.recordLevel=function(){var t=this.parent,i=this.draggedRecord,r=this.droppedRecord,a=t.taskFields.child;if(r.hasChildRecords||(r.hasChildRecords=!0,r.childRecords.length||(r.childRecords=[],!t.taskFields.parentID&&(0,e.isNullOrUndefined)(r.taskData[a])&&(r.taskData[a]=[]))),"middleSegment"===this.dropPosition){var n=(0,e.extend)({},r);delete n.childRecords;var s={uniqueID:n.uniqueID,expanded:n.expanded,level:n.level,index:n.index,taskId:n.ganttProperties.rowUniqueID};if(this.parent.setRecordValue("parentItem",s,i),this.parent.setRecordValue("parentUniqueID",r.uniqueID,i),r.childRecords.splice(r.childRecords.length,0,i),(0,e.isNullOrUndefined)(i)||t.taskFields.parentID||(0,e.isNullOrUndefined)(r.taskData[a])||r.taskData[t.taskFields.child].splice(r.childRecords.length,0,i.taskData),!(0,e.isNullOrUndefined)(r.ganttProperties.segments)&&r.ganttProperties.segments.length>0&&(r.ganttProperties.segments=null,r.taskData[t.taskFields.segments]=null),i.hasChildRecords){i.level=r.level+1,this.updateChildRecordLevel(i,1)}else i.level=r.level+1;r.expanded=!0}},a}(),Ii=function(){function e(e){this.parent=e,_e.TreeGrid.Inject(_e.Reorder),this.parent.treeGrid.allowReordering=this.parent.allowReordering,this.bindEvents()}return e.prototype.getModuleName=function(){return"reorder"},e.prototype.bindEvents=function(){var e=this;this.parent.treeGrid.columnDragStart=function(t){e.parent.trigger("columnDragStart",t)},this.parent.treeGrid.columnDrag=function(t){e.parent.trigger("columnDrag",t)},this.parent.treeGrid.columnDrop=function(t){e.parent.trigger("columnDrop",t)}},e.prototype.destroy=function(){},e}(),Ei=function(){return Ei=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ei.apply(this,arguments)},Fi=function(){function e(e){this.parent=e,_e.TreeGrid.Inject(_e.Resize),this.parent.treeGrid.allowResizing=this.parent.allowResizing,this.bindEvents()}return e.prototype.getModuleName=function(){return"resize"},e.prototype.bindEvents=function(){var e=this;this.parent.treeGrid.resizeStart=function(t){if(e.parent.undoRedoModule&&e.parent.isUndoRedoItemPresent("ColumnResize")){e.parent.undoRedoModule.createUndoCollection();var i={action:"ColumnResize"};i.resizedColumn=Ei({},t.column),e.parent.undoRedoModule.getUndoCollection[e.parent.undoRedoModule.getUndoCollection.length-1]=i}e.parent.trigger("resizeStart",t)},this.parent.treeGrid.resizing=function(t){e.parent.trigger("resizing",t)},this.parent.treeGrid.resizeStop=function(t){e.parent.trigger("resizeStop",t)}},e.prototype.destroy=function(){},e}(),Ui=function(){function t(e){this.parent=e,_e.TreeGrid.Inject(_e.Filter),this.parent.treeGrid.allowFiltering=this.parent.allowFiltering,this.updateCustomFilters(),this.parent.treeGrid.filterSettings=(0,i.getActualProperties)(this.parent.filterSettings),this.addEventListener()}return t.prototype.getModuleName=function(){return"filter"},t.prototype.updateCustomFilters=function(){for(var e=this.parent.taskFields,t=0;t<this.parent.ganttColumns.length;t++){var i=this.parent.ganttColumns[t];("datepickeredit"!==i.editType&&"datetimepickeredit"!==i.editType||i.field!==e.startDate&&i.field!==e.endDate&&i.field!==e.baselineStartDate&&i.field!==e.baselineEndDate)&&(i.field!==e.duration||"stringedit"!==i.editType)||this.initiateFiltering(this.parent.ganttColumns[t])}},t.prototype.updateModel=function(){this.parent.filterSettings=this.parent.treeGrid.filterSettings},t.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this),this.parent.on("actionBegin",this.actionBegin,this),this.parent.on("actionComplete",this.actionComplete,this),this.parent.on("columnMenuOpen",this.columnMenuOpen,this)},t.prototype.wireEvents=function(t){e.EventHandler.add(document.getElementById(t),"click",this.mouseClickHandler,this)},t.prototype.initiateFiltering=function(e){var t=this.parent.getColumnByField(e.field,this.parent.treeGridModule.treeGridColumns);e.allowFiltering=!1!==e.allowFiltering,!e.allowFiltering||"Menu"!==this.parent.filterSettings.type&&"Excel"!==this.parent.filterSettings.type||e.filter||(e.filter={ui:this.getCustomFilterUi(e)}),t&&(t.allowFiltering=e.allowFiltering,t.filter=e.allowFiltering?e.filter:{})},t.prototype.getCustomFilterUi=function(e){var t=this.parent.taskFields,i={};return"datepickeredit"!==e.editType||e.field!==t.startDate&&e.field!==t.endDate&&e.field!==t.baselineStartDate&&e.field!==t.baselineEndDate?"datetimepickeredit"!==e.editType||e.field!==t.startDate&&e.field!==t.endDate&&e.field!==t.baselineStartDate&&e.field!==t.baselineEndDate?e.field===t.duration&&"stringedit"===e.editType&&(i=this.getDurationFilter()):i=this.getDateTimePickerFilter():i=this.getDatePickerFilter(e.field),i},t.prototype.mouseClickHandler=function(t){(0,e.closest)(t.target,".e-excelfilter")&&this.parent.treeGrid.grid.notify("click",t)},t.prototype.unWireEvents=function(){e.EventHandler.remove(this.parent.element,"click",this.mouseClickHandler)},t.prototype.getDatePickerFilter=function(t){var r,a=this,n=this.parent,s=t===n.taskFields.startDate||t===n.taskFields.baselineStartDate?n.defaultStartTime:n.defaultEndTime;return{create:function(t){var n=(0,i.getCustomDateFormat)(t.column.format,t.column.type),s=(0,e.createElement)("input",{className:"flm-input"});t.target.appendChild(s),(r=new Ti.DatePicker({placeholder:a.parent.localeObj.getConstant("enterValue"),format:n})).enableRtl=a.parent.enableRtl,r.appendTo(s)},write:function(e){r.value=e.filteredValue},read:function(e){r.value&&r.value.setSeconds(s),e.fltrObj.filterByColumn(e.column.field,e.operator,r.value)}}},t.prototype.getDateTimePickerFilter=function(){var t,r=this;return{create:function(a){var n=(0,i.getCustomDateFormat)(a.column.format,a.column.type),s=(0,e.createElement)("input",{className:"flm-input"});a.target.appendChild(s),(t=new Ti.DateTimePicker({placeholder:r.parent.localeObj.getConstant("enterValue"),format:n})).enableRtl=r.parent.enableRtl,t.appendTo(s)},write:function(e){t.value=e.filteredValue},read:function(e){e.fltrObj.filterByColumn(e.column.field,e.operator,t.value)}}},t.prototype.getDurationFilter=function(){var t,i=this,r=this.parent,a="";return{create:function(r){var a=(0,e.createElement)("input",{className:"e-input"});a.setAttribute("placeholder",i.parent.localeObj.getConstant("enterValue")),r.target.appendChild(a),(t=new wi.TextBox).enableRtl=i.parent.enableRtl,t.appendTo(a)},write:function(e){t.value=e.filteredValue?a:""},read:function(n){var s=i.parent.dataOperation.getDurationValue(t.value),o=(0,e.getValue)("duration",s),l=(0,e.getValue)("durationUnit",s);if(o>=0){var d=void 0;"minute"===l?d=60*o/r.secondsPerDay:"hour"===l?d=60*o*60/r.secondsPerDay:(d=o,l="day"),n.fltrObj.filterByColumn(n.column.field,n.operator,d),a=i.parent.dataOperation.getDurationString(o,l)}else n.fltrObj.filterByColumn(n.column.field,n.operator,null),a=null}}},t.prototype.columnMenuOpen=function(t){this.filterMenuElement&&document.body.contains(this.filterMenuElement)&&(0,e.remove)(this.filterMenuElement),this.filterMenuElement=null},t.prototype.actionBegin=function(e){},t.prototype.closeFilterOnContextClick=function(t){var i=document.querySelector("body > div.e-datepicker"),r=document.querySelector("body > div.e-datetimepicker");if(this.filterMenuElement&&document.body.contains(this.filterMenuElement)){var a=(0,e.closest)(t,"#"+this.parent.element.id)||t.querySelector("#"+this.parent.element.id);(this.filterMenuElement.contains(t)||(0,e.isNullOrUndefined)(a))&&(this.filterMenuElement.contains(t)||!(0,e.isNullOrUndefined)(i)||!(0,e.isNullOrUndefined)(r)||"DIV"!==t.nodeName&&"HTML"!==t.nodeName&&"SPAN"!==t.nodeName&&"BUTTON"!==t.nodeName||t.classList.contains("e-dropdownbase"))||((0,e.remove)(this.filterMenuElement),this.parent.treeGrid.grid.notify("filter-menu-close",{isOpen:!1}),this.filterMenuElement=null)}},t.prototype.actionComplete=function(t){if((0,e.isNullOrUndefined)(t.filterModel)||(0,e.isNullOrUndefined)(t.filterModel.dialogObj)||(0,e.isNullOrUndefined)(t.filterModel.dialogObj.element)||"Excel"===this.parent.filterSettings.type&&this.wireEvents(t.filterModel.dialogObj.element.id),t.requestType===i.filterAfterOpen){"Menu"===this.parent.treeGrid.filterSettings.type?this.filterMenuElement=(0,e.getValue)("filterModel.dlgObj.element",t):this.filterMenuElement=(0,e.getValue)("filterModel.dialogObj.element",t),this.updateFilterMenuPosition(this.filterMenuElement,t);var r=this.parent.taskFields.id,a=this.parent.taskFields.dependency,n=this.parent.taskFields.resourceInfo,s=this.parent.treeGrid.grid.filterModule,o=(0,e.getValue)("values",s);if(t.columnName===a&&(0,e.isNullOrUndefined)((0,e.getValue)(a,o))||t.columnName===n&&(0,e.isNullOrUndefined)((0,e.getValue)(n,o))){var l=this.filterMenuElement.querySelector(".e-dropdownlist"),d=void 0;(0,e.isNullOrUndefined)(l)||((d=(0,e.getValue)("ej2_instances[0]",l)).index=2,d.dataBind())}else if(t.columnName===r&&(0,e.isNullOrUndefined)((0,e.getValue)(r,o))&&"Menu"===this.parent.treeGrid.filterSettings.type){l=this.filterMenuElement.querySelector(".e-flmenu-input"),d=(0,e.getValue)("ej2_instances[0]",l);!(0,e.isNullOrUndefined)(d)&&(0,e.isNullOrUndefined)(this.parent.columnByField[t.columnName].format)&&(d.format="n")}}},t.prototype.setPosition=function(t,i){var r,a,n,s,o,l,d,h=this.parent.element.getBoundingClientRect(),p=h.top,u=h.left,c=!1;if(!(0,e.isNullOrUndefined)(this.parent.element.parentNode)&&"BODY"!==this.parent.element.parentNode.tagName){for(c=!0,a=(r=this.parent.element.parentNode).getBoundingClientRect().top,l=r.style.marginTop;;){if(Math.abs(p)>Math.abs(a)){s=p-a;break}if(!(0,e.isNullOrUndefined)(this.parent.element.parentNode)){if(r.parentNode instanceof HTMLDocument)break;(r=r.parentNode).parentNode&&r.parentNode.style&&(l=r.parentNode.style.marginTop)}a=r.getBoundingClientRect().top}for(n=r.getBoundingClientRect().left,d=r.style.marginLeft;;){if(Math.abs(u)>Math.abs(n)){o=u-n;break}if(!(0,e.isNullOrUndefined)(this.parent.element.parentNode)){if(r.parentNode instanceof HTMLDocument)break;d=(r=r.parentNode).style.marginLeft}n=r.getBoundingClientRect().left}}var g=t.getBoundingClientRect(),f=g.right+window.scrollX,m=c?g.top-p:g.top+window.scrollY;h.right<f+i.offsetWidth?g.left-i.offsetWidth>h.left?f=g.left-i.offsetWidth:f-=f+i.offsetWidth-h.right:(0,e.isNullOrUndefined)(s)&&(0,e.isNullOrUndefined)(o)||!c||(f=Math.abs(g.right-h.left),m=Math.abs(g.top-h.top)),(0,e.isNullOrUndefined)(s)||(0,e.isNullOrUndefined)(o)?(i.style.top=m+"px",i.style.left=f+"px"):(i.style.top="string"==typeof parseInt(l,10)?m+s+parseInt(l,10)+"px":m+s+"px",i.style.left="string"==typeof parseInt(d,10)?f+o+parseInt(d,10)+8+"px":f+o+"px")},t.prototype.updateFilterMenuPosition=function(t,r){var a;((0,e.addClass)([t],"e-gantt"),this.parent.enableAdaptiveUI||document.querySelector("#"+this.parent.controlId).appendChild(t),this.parent.showColumnMenu?(a=document.querySelector("#treeGrid"+this.parent.controlId+"_gridcontrol_colmenu_Filter"),t.style.zIndex=a.parentElement.style.zIndex,"Menu"===this.parent.treeGrid.filterSettings.type?this.setPosition(a,(0,e.getValue)("filterModel.dlgObj.element",r)):this.setPosition(a,(0,e.getValue)("filterModel.dialogObj.element",r))):(a=this.parent.treeGrid.grid.getColumnHeaderByField(r.columnName).querySelector(".e-filtermenudiv"),"Menu"===this.parent.treeGrid.filterSettings.type?(0,i.getFilterMenuPostion)(a,(0,e.getValue)("filterModel.dlgObj",r)):(0,i.getFilterMenuPostion)(a,(0,e.getValue)("filterModel.dialogObj",r))),"Menu"===this.parent.treeGrid.filterSettings.type&&t.querySelector(".e-valid-input").focus(),"Excel"===this.parent.treeGrid.filterSettings.type)&&document.querySelector(".e-searchinput").focus()},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateModel",this.updateModel),this.parent.off("actionBegin",this.actionBegin),this.parent.off("actionComplete",this.actionComplete),this.parent.off("columnMenuOpen",this.columnMenuOpen))},t.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents()},t}(),Ni=function(){function e(e){this.parent=e,_e.TreeGrid.Inject(_e.Sort),this.parent.treeGrid.allowSorting=this.parent.allowSorting,this.parent.treeGrid.sortSettings=(0,i.getActualProperties)(this.parent.sortSettings),this.addEventListener()}return e.prototype.getModuleName=function(){return"sort"},e.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("updateModel",this.updateModel)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.sortColumn=function(e,t,i){this.parent.treeGrid.sortByColumn(e,t,i)},e.prototype.clearSorting=function(){this.parent.treeGrid.clearSorting()},e.prototype.updateModel=function(){this.parent.sortSettings=this.parent.treeGrid.sortSettings},e.prototype.removeSortColumn=function(e){this.parent.treeGrid.grid.removeSortColumn(e)},e}(),Li=function(){function t(e){this.isSelectionFromChart=!1,this.multipleIndexes=[],this.selectedRowIndexes=[],this.enableSelectMultiTouch=!1,this.openPopup=!1,this.parent=e,this.bindEvents(),this.parent.treeGrid.selectedRowIndex=this.parent.selectedRowIndex,this.parent.treeGrid.allowSelection=this.parent.allowSelection,this.parent.treeGrid.grid.selectionSettings.enableToggle=this.parent.selectionSettings.enableToggle,this.parent.treeGrid.selectionSettings=(0,i.getActualProperties)(this.parent.selectionSettings),this.wireEvents()}return t.prototype.getModuleName=function(){return"selection"},t.prototype.wireEvents=function(){this.parent.on("selectRowByIndex",this.selectRowByIndex,this),this.parent.isAdaptive?(this.parent.on("chartMouseClick",this.mouseUpHandler,this),this.parent.on("treeGridClick",this.popUpClickHandler,this)):this.parent.on("chartMouseUp",this.mouseUpHandler,this)},t.prototype.selectRowByIndex=function(){-1===this.parent.selectedRowIndex&&-1===this.parent.staticSelectedRowIndex||(this.selectRow(-1!==this.parent.staticSelectedRowIndex?this.parent.staticSelectedRowIndex:this.parent.selectedRowIndex),this.parent.staticSelectedRowIndex=-1)},t.prototype.bindEvents=function(){this.parent.treeGrid.rowSelecting=this.rowSelecting.bind(this),this.parent.treeGrid.rowSelected=this.rowSelected.bind(this),this.parent.treeGrid.rowDeselecting=this.rowDeselecting.bind(this),this.parent.treeGrid.rowDeselected=this.rowDeselected.bind(this),this.parent.treeGrid.cellSelecting=this.cellSelecting.bind(this),this.parent.treeGrid.cellSelected=this.cellSelected.bind(this),this.parent.treeGrid.cellDeselecting=this.cellDeselecting.bind(this),this.parent.treeGrid.cellDeselected=this.cellDeselected.bind(this)},t.prototype.rowSelecting=function(t){this.parent.isGanttChartRendered?(t.isCtrlPressed=this.isMultiCtrlRequest,t.isShiftPressed=this.isMultiShiftRequest,t.target=this.actualTarget,(0,e.isNullOrUndefined)(t.foreignKeyData)||0!==Object.keys(t.foreignKeyData).length||delete t.foreignKeyData,this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&(this.parent.treeGrid.grid.selectionModule.checkSelectAllClicked=!0),this.parent.trigger("rowSelecting",t)):t.cancel=!0},t.prototype.rowSelected=function(t){var i="rowIndexes",r="Multiple"!==this.parent.selectionSettings.type||(0,e.isNullOrUndefined)(t[i])?[t.rowIndex]:t[i];if(this.addRemoveClass(r,t.name),this.selectedRowIndexes=(0,e.extend)([],this.getSelectedRowIndexes(),[],!0),this.parent.setProperties({selectedRowIndex:this.parent.treeGrid.grid.selectedRowIndex},!0),this.isMultiShiftRequest&&(this.selectedRowIndexes=r),this.parent.autoFocusTasks)if(this.parent.enableTimelineVirtualization&&(this.parent.isRowSelected=!0),t.data&&!(0,e.isNullOrUndefined)(t.data.length))for(var a=0;a<t.data.length;a++)this.parent.ganttChartModule.updateScrollLeft(t.data[a].ganttProperties.left);else this.parent.ganttChartModule.updateScrollLeft((0,e.getValue)("data.ganttProperties.left",t));t.target=this.actualTarget,(0,e.isNullOrUndefined)(t.foreignKeyData)||0!==Object.keys(t.foreignKeyData).length||delete t.foreignKeyData,this.prevRowIndex=t.rowIndex,(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(t),this.parent.trigger("rowSelected",t)},t.prototype.rowDeselecting=function(e){e.target=this.actualTarget,e.isInteracted=this.isInteracted,this.parent.trigger("rowDeselecting",e)},t.prototype.rowDeselected=function(t){var i,r;if(0!==this.multipleIndexes.length)i=this.multipleIndexes;else if((0,e.isNullOrUndefined)(t.rowIndexes))i=[t.rowIndex];else{for(var a=0;a<t.rowIndexes.length;a++)t.rowIndexes[a]===t.rowIndex&&(r=!0);i=r?t.rowIndexes:[t.rowIndex]}this.addRemoveClass(i),this.selectedRowIndexes=(0,e.extend)([],this.getSelectedRowIndexes(),[],!0),this.parent.setProperties({selectedRowIndex:-1},!0),1===this.selectedRowIndexes.length&&this.parent.setProperties({selectedRowIndex:this.selectedRowIndexes[0]},!0),(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(),"Multiple"===this.parent.selectionSettings.type&&this.parent.isAdaptive&&0===this.selectedRowIndexes.length&&this.hidePopUp(),t.target=this.actualTarget,t.isInteracted=this.isInteracted,this.parent.trigger("rowDeselected",t),this.isInteracted=!1,this.multipleIndexes=[]},t.prototype.cellSelecting=function(e){var t=new r.Deferred;return this.parent.trigger("cellSelecting",e,(function(e){t.resolve(e)})),t},t.prototype.cellSelected=function(t){this.parent.trigger("cellSelected",t),(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},t.prototype.cellDeselecting=function(e){this.parent.trigger("cellDeselecting",e)},t.prototype.cellDeselected=function(t){this.parent.trigger("cellDeselected",t),(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},t.prototype.selectCell=function(e,t){this.parent.treeGrid.selectCell(e,t)},t.prototype.selectCells=function(e){this.parent.treeGrid.grid.selectCells(e)},t.prototype.selectRow=function(t,i,r){var a=[].slice.call(this.parent.ganttChartModule.chartBodyContent.querySelector("tbody").children);this.parent.enableVirtualization&&this.parent.treeGridModule.addedRecord&&(t=this.parent.flatData.indexOf(this.parent.currentViewData[t]),this.parent.treeGridModule.addedRecord=!1);var n,s=a.filter((function(e){return parseInt(e.getAttribute("data-rowindex"),10)===t}))[0];-1===t||(0,e.isNullOrUndefined)(s)&&!this.parent.enableVirtualization||"Cell"===this.parent.selectionSettings.mode||(!this.parent.showActiveElement||(0,e.isNullOrUndefined)(r)&&!this.parent.enableVirtualization||r?this.parent.treeGrid.grid.selectionModule.preventFocus=!1:this.parent.treeGrid.grid.selectionModule.preventFocus=!0,(0,e.isNullOrUndefined)(this.selectedClass)||this.selectedClass!==s||i||(n=!0),!0!==n&&this.parent.treeGrid.selectRow(t,i),this.parent.treeGrid.grid.selectionModule.preventFocus=!0!==this.parent.treeGrid.grid.selectionModule.preventFocus&&this.parent.treeGrid.grid.selectionModule.preventFocus,this.prevRowIndex=t,this.selectedClass=s)},t.prototype.selectRows=function(t){!(0,e.isNullOrUndefined)(t)&&t.length>0&&this.parent.treeGrid.selectRows(t)},t.prototype.getSelectedRowIndexes=function(){return this.parent.treeGrid.getSelectedRowIndexes()},t.prototype.getSelectedRowCellIndexes=function(){return this.parent.treeGrid.getSelectedRowCellIndexes()},t.prototype.getSelectedRecords=function(){if(!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping){for(var e=[],t=this.parent.selectionModule.getSelectedRowIndexes(),i=function(i){var a=r.parent.currentViewData.filter((function(e){return e.index===t[i]}))[0];e.push(a)},r=this,a=0;a<t.length;a++)i(a);return e}return this.parent.treeGrid.getSelectedRecords()},t.prototype.getCellSelectedRecords=function(){for(var e=this.parent.selectionModule.getSelectedRowCellIndexes(),t=[],i=0;i<e.length;i++)t.push(this.parent.currentViewData[e[i].rowIndex]);return t},t.prototype.getSelectedRows=function(){return this.parent.treeGrid.getSelectedRows()},t.prototype.clearSelection=function(){this.addRemoveClass(this.selectedRowIndexes),this.parent.treeGrid.clearSelection(),this.parent.selectedRowIndex=-1,this.selectedRowIndexes=[],this.selectedClass=null,(0,e.isNullOrUndefined)(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(),this.isInteracted=!1},t.prototype.highlightSelectedRows=function(t,i){if(this.isMultiCtrlRequest=t.ctrlKey||this.enableSelectMultiTouch,this.isMultiShiftRequest=t.shiftKey,this.actualTarget=t.target,this.isInteracted=!0,this.isSelectionFromChart=i,i){var r=(0,e.closest)(t.target,"tr.e-chart-row"),a=parseInt(r.getAttribute("data-rowindex"),10),n=this.parent.selectionSettings.enableToggle;if("Single"===this.parent.selectionSettings.type||!this.isMultiCtrlRequest&&!this.isMultiShiftRequest)this.parent.selectionSettings.persistSelection&&this.addRemoveClass(this.selectedRowIndexes,t.name),(!this.parent.allowTaskbarDragAndDrop||this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&!this.parent.rowDragAndDropModule.draggedRecord)&&this.selectRow(a,n);else if(this.isMultiShiftRequest)this.selectRowsByRange((0,e.isNullOrUndefined)(this.prevRowIndex)?a:this.prevRowIndex,a);else(0,e.setValue)("isMultiCtrlRequest",!0,this.parent.treeGrid.grid.selectionModule),this.parent.treeGrid.grid.selectionModule.addRowsToSelection([a]),this.selectedRowIndexes.indexOf(a)>-1&&this.addRemoveClass([a],t.name)}},t.prototype.getselectedrowsIndex=function(e,t){for(var i=[],r=e<t?{i:e,max:t}:{i:t,max:e},a=r.i,n=r.max;a<=n;a++)i.push(a);e>t&&i.reverse(),this.selectedRowIndexes=i},t.prototype.selectRowsByRange=function(e,t){this.isSelectionFromChart=!0,this.getselectedrowsIndex(e,t),this.selectRows(this.selectedRowIndexes)},t.prototype.addRemoveClass=function(t,i){"number"==typeof t&&(t=[t]);for(var r=[].slice.call(this.parent.ganttChartModule.chartBodyContent.querySelector("tbody").children),a=function(a){var s=r.filter((function(e){return parseInt(e.getAttribute("data-rowindex"),10)===t[parseInt(a.toString(),10)]}))[0];if(!(0,e.isNullOrUndefined)(s)){var o=!1,l=n.getSelectedRowIndexes().indexOf(t[parseInt(a.toString(),10)]),d=n.getSelectedRecords().length;n.parent.selectionSettings.persistSelection&&n.parent.selectionSettings.enableToggle&&!(0,e.isNullOrUndefined)(i)&&"Multiple"!==n.parent.selectionSettings.type&&d>0&&(o=!0),n.parent.selectionSettings.enableToggle&&n.parent.selectionSettings.persistSelection&&l>-1&&"Single"===n.parent.selectionSettings.type&&o||l>-1&&!(0,e.isNullOrUndefined)(i)&&"Multiple"===n.parent.selectionSettings.type?n.addClass(s):(0,e.isNullOrUndefined)(i)?n.removeClass(s):l>-1&&n.addClass(s),("Single"===n.parent.selectionSettings.type||!n.isMultiCtrlRequest&&!n.isMultiShiftRequest)&&l>-1&&n.parent.selectionSettings.persistSelection&&"chartMouseUp"===i&&n.isSelectionFromChart&&n.removeClass(s)}},n=this,s=0;s<t.length;s++)a(s)},t.prototype.addClass=function(t){(0,e.addClass)([t],"e-active"),t.setAttribute("aria-selected","true")},t.prototype.removeClass=function(t){(0,e.removeClass)([t],"e-active"),t.removeAttribute("aria-selected")},t.prototype.showPopup=function(e){this.isSelectionFromChart?((0,i.setCssInGridPopUp)(this.parent.element.querySelector(".e-ganttpopup"),e,"e-rowselect e-icons e-icon-rowselect"+(this.enableSelectMultiTouch&&(this.getSelectedRecords().length>1||this.getSelectedRowCellIndexes().length>1)?" e-spanclicked":"")),document.getElementsByClassName("e-gridpopup")[0].style.display="none",this.openPopup=!0):0===this.selectedRowIndexes.length&&this.hidePopUp()},t.prototype.hidePopUp=function(){this.openPopup?(document.getElementsByClassName("e-ganttpopup")[0].style.display="none",this.openPopup=!1):document.getElementsByClassName("e-gridpopup")[0].style.display="none"},t.prototype.popUpClickHandler=function(t){var i=t.target,r=this.parent.treeGrid.grid,a=(0,e.closest)(i,".e-ganttpopup")?(0,e.closest)(i,".e-ganttpopup"):(0,e.closest)(i,".e-gridpopup");if(a){var n=a.querySelector(".e-rowselect");(0,e.closest)(i,".e-ganttpopup")&&!n.classList.contains("e-spanclicked")?(this.enableSelectMultiTouch=!0,n.classList.add("e-spanclicked")):(0,e.closest)(i,".e-gridpopup")&&n.classList.contains("e-spanclicked")?(this.openPopup=!0,this.enableSelectMultiTouch=!0):(this.hidePopUp(),this.enableSelectMultiTouch=!1,(0,e.closest)(i,".e-ganttpopup")&&n.classList.remove("e-spanclicked"))}else if("Multiple"===this.parent.selectionSettings.type&&this.parent.isAdaptive){(0,e.closest)(i,".e-rowcell")&&0===this.selectedRowIndexes.length&&this.hidePopUp()}r&&(0,e.setValue)("enableSelectMultiTouch",this.enableSelectMultiTouch,r.selectionModule)},t.prototype.mouseUpHandler=function(t){var r=!1,a=document.querySelectorAll(".e-drag-item"),n=null;if(t.target.closest(".e-rowcell")?n=t.target:t.target.closest(".e-chart-row")&&(n=t.target.closest(".e-left-label-container")||t.target.closest(".e-taskbar-main-container")||t.target.closest(".e-right-label-container")),this.parent.focusModule&&this.parent.focusModule.setActiveElement(n),this.parent.editModule&&this.parent.editSettings.allowTaskbarEditing&&this.parent.editModule.taskbarEditModule){var s=this.parent.editModule.taskbarEditModule;(s.isMouseDragged||s.tapPointOnFocus)&&(r=!0)}if(!r&&this.parent.element.contains(t.target)&&1!==a.length){var o=(0,i.parentsUntil)(t.target,"e-chart-row"),l=t.target.classList.contains("e-rowcell")||t.target.classList.contains("e-row")||t.target.classList.contains("e-treegridexpand")||t.target.classList.contains("e-treegridcollapse")||!(0,e.isNullOrUndefined)(o);this.popUpClickHandler(t),"Cell"!==this.parent.selectionSettings.mode&&l?((0,e.closest)(t.target,"tr.e-chart-row")?(this.parent.enableVirtualization&&(this.parent.treeGrid.grid.selectionModule.isInteracted=!0),this.highlightSelectedRows(t,!0)):this.highlightSelectedRows(t,!1),"Multiple"===this.parent.selectionSettings.type&&this.parent.isAdaptive&&(this.selectedRowIndexes.length>0?this.showPopup(t):this.hidePopUp())):this.isSelectionFromChart=!1}},t.prototype.maintainSelectedRecords=function(e){this.parent.selectionModule.getSelectedRowIndexes().indexOf(e)>-1&&this.addRemoveClass([e])},t.prototype.destroy=function(){this.parent.isDestroyed||(this.parent.off("selectRowByIndex",this.selectRowByIndex),this.parent.isAdaptive?(this.parent.off("chartMouseClick",this.mouseUpHandler),this.parent.off("treeGridClick",this.popUpClickHandler)):this.parent.off("chartMouseUp",this.mouseUpHandler))},t}(),Vi=function(){function t(e){this.predefinedItems={},this.items=["Add","Edit","Update","Delete","Cancel","ExpandAll","CollapseAll","Search","PrevTimeSpan","NextTimeSpan","ZoomIn","ZoomOut","ZoomToFit","ExcelExport","CsvExport","PdfExport","Indent","Outdent","CriticalPath"],this.parent=e,this.id=this.parent.element.id,this.parent.on("ui-toolbarupdate",this.propertyChanged,this)}return t.prototype.getModuleName=function(){return"toolbar"},t.prototype.renderToolbar=function(){if((this.parent.toolbar||[]).length>0){this.element=(0,e.createElement)("div",{id:this.parent.controlId+"_Gantt_Toolbar",className:"e-gantt-toolbar"}),this.parent.treeGrid.grid.headerModule?this.parent.element.insertBefore(this.element,this.parent.treeGridPane.offsetParent):this.parent.element.appendChild(this.element);for(var t=0,i=["Add","Edit","Update","Delete","Cancel","ExpandAll","CollapseAll","PrevTimeSpan","NextTimeSpan","ZoomIn","ZoomOut","ZoomToFit","ExcelExport","CsvExport","PdfExport","Indent","Outdent","CriticalPath","Undo","Redo"];t<i.length;t++){var r=i[t],a=void 0,n=void 0;"CriticalPath"===r?(a="critical-path",n="criticalPath"):(a=r.toLowerCase(),n=r[0].toLowerCase()+r.slice(1)),this.predefinedItems[r]={id:this.parent.element.id+"_"+a,prefixIcon:"e-"+a,text:this.parent.isAdaptive?"":this.parent.localeObj.getConstant(n),tooltipText:this.parent.localeObj.getConstant(n)+("add"===n||"edit"===n||"delete"===n?this.parent.localeObj.getConstant("task"):"expandAll"===n||"collapseAll"===n?this.parent.localeObj.getConstant("tasks"):""),align:this.parent.isAdaptive?"Right":"Left"},this.parent.enableRtl&&("PrevTimeSpan"===r&&(this.predefinedItems[r].prefixIcon="e-nexttimespan"),"NextTimeSpan"===r&&(this.predefinedItems[r].prefixIcon="e-prevtimespan"))}var s=this.parent.localeObj.getConstant("search");this.parent.isAdaptive?this.predefinedItems.Search={id:this.id+"_searchbutton",prefixIcon:"e-search-icon",tooltipText:s,align:"Right"}:this.predefinedItems.Search={id:this.id+"_search",template:'<div class="e-input-group e-search" role="search"><input id="'+this.id+'_searchbar" class="e-input" name="input" type="search"placeholder= "'+s+'"/><span id="'+this.id+'_searchbutton" class="e-input-group-icon e-search-icon e-icons"tabindex="-1" title="'+s+'" aria-label= "search" role="button"></span></div>',tooltipText:s,align:"Right",cssClass:"e-search-wrapper"},this.createToolbar()}},t.prototype.addReactToolbarPortals=function(e){this.parent.isReact&&e&&(this.parent.portals=this.parent.portals.concat(e),this.parent.renderTemplates())},t.prototype.createToolbar=function(){var t=this.getItems();this.toolbar=new vi.Toolbar({items:t,enableRtl:this.parent.enableRtl,clicked:this.toolbarClickHandler.bind(this),height:this.parent.isAdaptive?48:"auto"}),this.toolbar.isStringTemplate=!0,this.toolbar.isReact=this.parent.isReact,this.toolbar.on("render-react-toolbar-template",this.addReactToolbarPortals,this),this.toolbar.appendTo(this.element),this.parent.treeGrid.grid&&this.parent.isReact&&(this.parent.treeGrid.grid.portals=this.parent.portals);var i=this.element.querySelector("#"+this.parent.element.id+"_cancel"),r=this.element.querySelector("#"+this.parent.element.id+"_update");i&&(0,e.addClass)([i],M),r&&(0,e.addClass)([r],M);var a=!1;(this.parent.toolbar.map((function(e){"Search"===e&&(a=!0)})),this.parent.isAdaptive&&a)?(this.element.insertBefore(this.getSearchBarElement(),this.element.childNodes[0]),this.searchElement=this.element.querySelector("#"+this.parent.element.id+"_searchbar"),new wi.TextBox({placeholder:this.parent.localeObj.getConstant("search"),enableRtl:this.parent.enableRtl,floatLabelType:"Never",showClearButton:!0}).appendTo(this.searchElement)):this.searchElement=this.element.querySelector("#"+this.parent.element.id+"_searchbar");this.parent.filterModule&&(this.wireEvent(),this.parent.searchSettings&&this.updateSearchTextBox()),this.enableItems([this.parent.controlId+"_redo",this.parent.controlId+"_undo"],!1),this.parent.readOnly&&this.enableItems([this.parent.element.id+"_add",this.parent.element.id+"_update",this.parent.element.id+"_delete",this.parent.element.id+"_cancel",this.parent.element.id+"_indent",this.parent.element.id+"_outdent"],!1)},t.prototype.getSearchBarElement=function(){var t=this,i=(0,e.createElement)("div",{className:"e-adaptive-searchbar",styles:"display: none"}),r=(0,e.createElement)("input",{attrs:{type:"text"},id:this.parent.element.id+"_searchbar"}),a=(0,e.createElement)("span",{className:"e-backarrowspan e-icons"});return a.onclick=function(){i.style.display="none",t.element.childNodes[1].style.display="block"},i.appendChild(a),i.appendChild(r),i},t.prototype.wireEvent=function(){this.searchElement&&(e.EventHandler.add(this.searchElement,"keyup",this.keyUpHandler,this),e.EventHandler.add(this.searchElement,"focus",this.focusHandler,this),e.EventHandler.add(this.searchElement,"blur",this.blurHandler,this))},t.prototype.propertyChanged=function(t){(0,e.getValue)("module",t)===this.getModuleName()&&this.parent.toolbar&&(this.element&&this.element.parentNode&&(0,e.remove)(this.element),this.renderToolbar(),this.refreshToolbarItems())},t.prototype.unWireEvent=function(){this.searchElement&&(e.EventHandler.remove(this.searchElement,"keyup",this.keyUpHandler),e.EventHandler.remove(this.searchElement,"focus",this.focusHandler),e.EventHandler.remove(this.searchElement,"blur",this.blurHandler),this.searchElement=null),this.parent.off("ui-toolbarupdate",this.propertyChanged)},t.prototype.keyUpHandler=function(e){13===e.keyCode&&this.parent.searchSettings.key!==this.searchElement.value&&(this.parent.searchSettings.key=this.searchElement.value,this.parent.dataBind())},t.prototype.focusHandler=function(e){e.target.parentElement.classList.add("e-input-focus")},t.prototype.blurHandler=function(e){e.target.parentElement.classList.remove("e-input-focus")},t.prototype.updateSearchTextBox=function(){this.searchElement&&this.searchElement.value!==this.parent.searchSettings.key&&(this.searchElement.value=this.parent.searchSettings.key)},t.prototype.getItems=function(){var e=[],t=this.parent.toolbar,i=-1;if(t.forEach((function(e,t){("string"==typeof e&&"Search"===e||"object"==typeof e&&"Search"===e.text)&&(i=t)})),i>-1){var r=t.splice(i,1);t.push(r[0])}for(var a=0,n=t;a<n.length;a++){var s=n[a];"string"==typeof s?e.push(this.getItemObject(s)):e.push(this.getItem(s))}return e},t.prototype.getItem=function(t){var i=this.predefinedItems[t.text];return i?(0,e.extend)(i,i,t):t},t.prototype.getItemObject=function(e){return this.predefinedItems[e]||{text:e,id:this.id+"_"+e}},t.prototype.toolbarClickHandler=function(t){var i=this,r=this.parent,a=this.id;this.parent.isToolBarClick=!1,(0,e.extend)(t,{cancel:!1}),t.item.properties.id!==this.parent.element.id+"_pdfexport"&&t.item.properties.id!==this.parent.element.id+"_critical-path"||((0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow()),r.trigger(ui,t,(function(t){if(!t.cancel)switch(!0===i.parent.isAdaptive&&(t.item.id!==a+"_edit"&&t.item.id!==a+"_add"&&t.item.id!==a+"_delete"&&t.item.id!==a+"_searchbutton"&&t.item.id!==a+"_expandall"&&t.item.id!==a+"_collapseall"||i.parent.selectionModule&&"Multiple"===i.parent.selectionSettings.type&&(i.parent.selectionModule.hidePopUp(),document.getElementsByClassName("e-gridpopup")[0].style.display="none")),!(0,e.isNullOrUndefined)(t.item)&&t.item.id){case a+"_edit":r.editModule&&r.editSettings.allowEditing&&r.editModule.dialogModule.openToolbarEditDialog();break;case a+"_indent":r.editModule&&r.selectionModule.getSelectedRecords().length&&r.indent();break;case a+"_critical-path":r.enableCriticalPath?r.enableCriticalPath=!1:r.enableCriticalPath=!0;break;case a+"_outdent":r.editModule&&r.selectionModule.getSelectedRecords().length&&r.outdent();break;case a+"_update":r.editModule.cellEditModule.isCellEdit=!1,r.treeGrid.grid.saveCell();break;case a+"_cancel":r.cancelEdit();break;case a+"_add":r.editModule&&r.editSettings.allowAdding&&r.editModule.dialogModule.openAddDialog();break;case a+"_delete":i.parent.selectionModule&&i.parent.editModule&&("Cell"!==i.parent.selectionSettings.mode&&i.parent.selectionModule.selectedRowIndexes.length||"Cell"===i.parent.selectionSettings.mode&&i.parent.selectionModule.getSelectedRowCellIndexes().length)&&i.parent.editModule.startDeleteAction();break;case a+"_search":if((0,e.getValue)("originalEvent.target.id",t)===i.parent.element.id+"_searchbutton"&&i.parent.filterModule){var n=i.element.querySelector("#"+i.parent.element.id+"_searchbar").value;i.parent.searchSettings.key!==n&&(i.parent.searchSettings.key=n,i.parent.dataBind())}break;case a+"_searchbutton":var s=i.element.querySelector(".e-adaptive-searchbar");s.parentElement.childNodes[1].style.display="none",s.style.display="block";break;case a+"_expandall":i.parent.ganttChartModule.expandCollapseAll("expand"),i.parent.isCollapseAll=!1;break;case a+"_collapseall":i.parent.ganttChartModule.expandCollapseAll("collapse"),i.parent.isCollapseAll=!0;break;case a+"_prevtimespan":i.parent.previousTimeSpan();break;case a+"_nexttimespan":i.parent.nextTimeSpan();break;case a+"_zoomin":i.zoomIn();break;case a+"_zoomout":i.zoomOut();break;case a+"_zoomtofit":i.zoomToFit();break;case a+"_undo":i.parent.undo();break;case a+"_redo":i.parent.redo()}}))},t.prototype.zoomIn=function(){this.parent.timelineModule.processZooming(!0),this.parent.timelineModule.isZooming=!1},t.prototype.zoomToFit=function(){this.parent.timelineModule.isZoomIn&&(this.parent.timelineModule.isZoomIn=!1),this.parent.timelineModule.processZoomToFit(),this.parent.ganttChartModule.updateScrollLeft(0),this.parent.timelineModule.isZoomToFit=!1},t.prototype.zoomOut=function(){this.parent.timelineModule.processZooming(!1),this.parent.timelineModule.isZooming=!1},t.prototype.refreshToolbarItems=function(t){var i,r=this.parent,a=[],n=[],s=r.editSettings,o=this.id,l=r.selectedRowIndex;if(!this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)for(var d=0;d<r.updatedRecords.length;d++)if(r.updatedRecords[d].index===l){l=d;break}var h=!1;r.selectionModule&&(1!==r.selectionModule.getSelectedRecords().length&&1!==r.selectionModule.getSelectedRowCellIndexes().length||(h=!0)),r.selectionModule&&"Multiple"===r.selectionSettings.type&&r.selectionModule.selectedRowIndexes.length>1&&(h=!1);var p=!1;if(r.selectionModule&&r.selectionSettings.persistSelection){var u=r.selectionModule.getSelectedRecords().length;if(r.selectionSettings.persistSelection&&1===u)for(var c=0;c<u;c++){-1===r.currentViewData.indexOf(r.selectionModule.getSelectedRecords()[c])&&(p=!0)}p&&(h=!1)}var g=this.toolbar?this.toolbar.items:[],f=[o+"_add",o+"_edit",o+"_delete",o+"_update",o+"_cancel",o+"_indent",o+"_outdent"],m="ResourceView"===this.parent.viewType&&0!==(0,e.getValue)("data.level",t)||"ProjectView"===this.parent.viewType;if((0,e.isNullOrUndefined)(this.parent.editModule))n.push(o+"_delete"),n.push(o+"_add"),n.push(o+"_edit"),n.push(o+"_update"),n.push(o+"_cancel"),n.push(o+"_indent"),n.push(o+"_outdent");else{var y=!!r.editModule.taskbarEditModule&&r.editModule.taskbarEditModule.touchEdit,D=r.flatData&&r.flatData.length;s.allowAdding&&!y?a.push(o+"_add"):n.push(o+"_add"),s.allowEditing&&m&&D&&h&&!y?a.push(o+"_edit"):n.push(o+"_edit"),s.allowEditing&&0!==l&&-1!==l&&D&&h&&"ResourceView"!==this.parent.viewType?(0,e.isNullOrUndefined)(r.updatedRecords[l])||0!==r.updatedRecords[l].level||!D||y?(i=r.updatedRecords[l-1],(0,e.isNullOrUndefined)(r.updatedRecords[l])||r.updatedRecords[l].level-i.level!=1||-1===l?-1!==l&&(a.push(o+"_indent"),a.push(o+"_outdent")):(n.push(o+"_indent"),a.push(o+"_outdent"))):(a.push(o+"_indent"),n.push(o+"_outdent")):(n.push(o+"_indent"),n.push(o+"_outdent"));var v=!!r.selectionModule&&(r.selectionModule.getSelectedRecords().length>0||r.selectionModule.getSelectedRowCellIndexes().length>0);if(r.selectionModule&&r.selectionSettings.persistSelection){p&&(v=!1);var k=(u=r.selectionModule.getSelectedRecords()).length;if(r.selectionSettings.persistSelection&&k>1)for(var w=0;w<k;w++){if(r.currentViewData.indexOf(u[w])>-1){v=!0;break}v=!1}}if(s.allowDeleting&&D&&v&&!y?a.push(o+"_delete"):n.push(o+"_delete"),"Auto"===r.editSettings.mode&&!(0,e.isNullOrUndefined)(r.editModule.cellEditModule)&&r.editModule.cellEditModule.isCellEdit){(a=[]).push(o+"_update",o+"_cancel"),n=[];for(var b=0;b<g.length;b++)g[b].id!==o+"_update"&&g[b].id!==o+"_cancel"&&-1!==f.indexOf(g[b].id)&&n.push(g[b].id)}else{n.push(o+"_update",o+"_cancel");for(b=0;b<g.length;b++)-1===a.indexOf(g[b].id)&&-1===n.indexOf(g[b].id)&&a.push(g[b].id)}}for(var T=0;T<a.length;T++){var P=void 0;for(b=0;b<g.length;b++)if(g[b].id===a[T]){P=b;break}g.length>0&&this.toolbar.hideItem(P,!1)}for(var S=0;S<n.length;S++){var C=void 0;for(b=0;b<g.length;b++)if(g[b].id===n[S]){C=b;break}g.length>0&&this.toolbar.hideItem(C,!0)}},t.prototype.enableItems=function(e,t){for(var i=0,r=e;i<r.length;i++){var a=r[i],n=this.element.querySelector("#"+a);n&&this.toolbar.enableItems(n.parentElement,t)}},t.prototype.destroy=function(){this.parent.isDestroyed||(this.toolbar.off("render-react-toolbar-template",this.addReactToolbarPortals),this.toolbar.destroy(),this.parent.filterModule&&this.unWireEvent(),(0,e.remove)(this.element))},t}(),Bi=function(){function t(e){this.weekendWidthUpdated=!1,this.parent=e,this.nonworkingContainer=null,this.holidayContainer=null,this.weekendContainer=null}return t.prototype.createNonworkingContainer=function(){this.parent.ganttChartModule.chartBodyContent.contains(this.nonworkingContainer)||(this.nonworkingContainer=(0,e.createElement)("div",{className:"e-nonworking-day-container"}),this.parent.enableTimelineVirtualization&&(this.nonworkingContainer.style.height="100%"),this.parent.ganttChartModule.chartBodyContent.insertBefore(this.nonworkingContainer,this.parent.ganttChartModule.chartBodyContent.lastChild))},t.prototype.renderHolidays=function(){this.parent.holidays&&this.parent.holidays.length>0?(this.createNonworkingContainer(),this.nonworkingContainer.contains(this.holidayContainer)||(this.holidayContainer=(0,e.createElement)("div",{className:"e-holiday-container"}),this.parent.enableTimelineVirtualization&&(this.holidayContainer.style.height="100%",this.holidayContainer.style.zIndex="-1"),this.nonworkingContainer.appendChild(this.holidayContainer)),this.holidayContainer.innerHTML=this.getHolidaysElement().innerHTML):this.holidayContainer&&this.holidayContainer.parentNode&&((0,e.remove)(this.holidayContainer),this.nonworkingContainer&&0===this.nonworkingContainer.childNodes.length&&(0,e.remove)(this.nonworkingContainer))},t.prototype.getHolidaysElement=function(){var t,i,r=(0,e.createElement)("div"),a=this.parent.contentHeight,n=0;(0,e.isNullOrUndefined)(this.parent.toolbarModule)||(0,e.isNullOrUndefined)(this.parent.toolbarModule.element)||(n=this.parent.toolbarModule.element.offsetHeight);for(var s=this.parent.ganttHeight-n-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight,o=0;o<this.parent.holidays.length;o++){this.parent.holidays[o].from&&this.parent.holidays[o].to?(t=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[o].from),(i=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[o].to)).setDate(i.getDate()+1),t.setHours(0,0,0,0),i.setHours(0,0,0,0)):this.parent.holidays[o].from?(t=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[o].from)).setHours(0,0,0,0):this.parent.holidays[o].to&&(t=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[o].to)).setHours(0,0,0,0);var l=this.parent.holidays[o].from&&this.parent.holidays[o].to?this.parent.dataOperation.getTaskWidth(t,i):this.parent.perDayWidth,d=this.parent.dataOperation.getTaskLeft(t,!1,!0),h=this.parent.enableRtl?"right:"+d+"px;":"left:"+d+"px;",p=(0,e.createElement)("div",{className:"e-holiday",styles:h+" width:"+l+"px; height:100%;"}),u=s<a?s/2:a/2,c=(0,e.createElement)("span",{className:me,styles:"top:"+u+"px;left:"+l/2+"px;"}),g=this.parent.disableHtmlEncode?"textContent":"innerHTML";c[g]=this.parent.holidays[o].label?this.parent.holidays[o].label:"",this.parent.enableHtmlSanitizer&&"string"==typeof c[g]&&(c[g]=e.SanitizeHtmlHelper.sanitize(c[g])),p.appendChild(c),this.parent.holidays[o].cssClass&&p.classList.add(this.parent.holidays[o].cssClass),r.appendChild(p)}return r},t.prototype.renderWeekends=function(){this.parent.highlightWeekends?(this.createNonworkingContainer(),this.nonworkingContainer.contains(this.weekendContainer)||(this.weekendContainer=(0,e.createElement)("div",{className:"e-weekend-container"}),this.parent.enableTimelineVirtualization&&(this.weekendContainer.style.height="100%",this.weekendContainer.style.zIndex="-1"),this.nonworkingContainer.appendChild(this.weekendContainer)),this.weekendContainer.innerHTML=this.getWeekendElements().innerHTML):this.weekendContainer&&((0,e.remove)(this.weekendContainer),this.nonworkingContainer&&0===this.nonworkingContainer.childNodes.length&&(0,e.remove)(this.nonworkingContainer))},t.prototype.getWeekendElements=function(){var t=(0,e.createElement)("div"),i=this.parent.enableTimelineVirtualization&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():null,r=this.parent.enableTimelineVirtualization&&!(0,e.isNullOrUndefined)(i)?new Date(this.parent.timelineModule.dateByLeftValue(i).getTime()):new Date(this.parent.timelineModule.timelineStartDate.getTime()),a=this.parent.enableTimelineVirtualization?new Date(this.parent.timelineModule.weekendEndDate.getTime()):new Date(this.parent.timelineModule.timelineEndDate.getTime()),n=this.parent.nonWorkingDayIndex,s=!0,o=!0;this.weekendWidthUpdated=!1;do{if(-1!==n.indexOf(r.getDay())){var l=this.parent.dataOperation.getTaskLeft(r,!1,!0),d=this.parent.perDayWidth;if(s){var h=new Date(r.getTime()),p=new Date(h.getTime());p.setDate(p.getDate()+1),p.setHours(0,0,0,0),d=this.parent.dataOperation.getTaskWidth(h,p),s=!1}var u=new Date(r),c=new Date(r);u.setDate(u.getDate()+1);var g=u.getTimezoneOffset(),f=c.getTimezoneOffset();o?o=!1:g===this.parent.timelineModule.timelineStartDate.getTimezoneOffset()||this.weekendWidthUpdated||"Hour"===this.parent.timelineModule.bottomTier&&1===this.parent.timelineModule.customTimelineSettings.bottomTier.count&&g<f&&(d-=this.parent.perDayWidth/24,this.weekendWidthUpdated=!0);var m=this.parent.enableRtl?"right:"+l+"px;":"left:"+l+"px;",y=(0,e.createElement)("div",{className:"e-weekend",styles:m+" width:"+d+"px;height:100%;"});t.appendChild(y)}r.setDate(r.getDate()+1),r.setHours(0,0,0,0)}while(r<a);return t},t.prototype.updateHolidayLabelHeight=function(){var t=this.parent.getContentHeight(),i=document.getElementById(this.parent.element.id),r=0;(0,e.isNullOrUndefined)(this.parent.toolbarModule)||(0,e.isNullOrUndefined)(this.parent.toolbarModule.element)||(r=this.parent.toolbarModule.element.offsetHeight);for(var a="auto"===this.parent.height?i.offsetHeight-r-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight:this.parent.ganttHeight-r-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight,n=a<t?a/2:t/2,s=this.holidayContainer.querySelectorAll("."+me),o=0;o<s.length;o++)s[o].style.top=(0,e.formatUnit)(n)},t.prototype.updateContainerHeight=function(){var t=this.parent.getContentHeight();this.holidayContainer&&(this.holidayContainer.style.height=(0,e.formatUnit)(t),this.updateHolidayLabelHeight()),this.weekendContainer&&(this.weekendContainer.style.height=(0,e.formatUnit)(t))},t.prototype.removeContainers=function(){this.holidayContainer&&(0,e.remove)(this.holidayContainer),this.weekendContainer&&(0,e.remove)(this.weekendContainer),this.nonworkingContainer&&(0,e.remove)(this.nonworkingContainer)},t}(),Ai=function(){function t(e){this.parent=e,this.eventMarkersContainer=null}return t.prototype.renderEventMarkers=function(){this.parent.eventMarkers&&this.parent.eventMarkers.length>0?(this.parent.ganttChartModule.chartBodyContent.contains(this.eventMarkersContainer)||(this.eventMarkersContainer=(0,e.createElement)("div",{className:"e-event-markers-container"}),this.eventMarkersContainer.setAttribute("role","term"),this.parent.ganttChartModule.chartBodyContent.appendChild(this.eventMarkersContainer)),this.eventMarkersContainer.innerHTML="",this.getEventMarkersElements(this.eventMarkersContainer)):this.removeContainer()},t.prototype.removeContainer=function(){this.eventMarkersContainer&&((0,e.remove)(this.eventMarkersContainer),this.eventMarkersContainer=null)},t.prototype.getEventMarkersElements=function(t){for(var i,r,a,n,s=[],o=0;o<this.parent.eventMarkers.length;o++)if(!(0,e.isNullOrUndefined)(this.parent.eventMarkers[o].day)){i=this.parent.dataOperation.getTaskLeft(this.parent.dateValidationModule.getDateFromFormat(this.parent.eventMarkers[o].day,!0),!1,!0),s.push({id:o,left:i,label:this.parent.eventMarkers[o].label,date:this.parent.dateValidationModule.getDateFromFormat(this.parent.eventMarkers[o].day,!0)});var l=void 0;if(l=this.parent.enableRtl?"right:"+i+"px;":"left:"+i+"px;",r=(0,e.createElement)("div",{className:"e-event-markers",styles:l+"  height:100%;",id:"stripline"+o}),this.parent.eventMarkers[o].label){a=(0,e.createElement)("div",{className:"e-span-label"});var d=this.parent.disableHtmlEncode?"textContent":"innerHTML";a[d]=this.parent.eventMarkers[o].label,this.parent.enableHtmlSanitizer&&"string"==typeof a[d]&&(a[d]=e.SanitizeHtmlHelper.sanitize(a[d])),this.parent.enableRtl?a.style.right="5px":a.style.left="5px",r.appendChild(a),n=(0,e.createElement)("div",{className:"e-gantt-right-arrow"}),r.appendChild(n)}this.parent.eventMarkers[o].cssClass&&r.classList.add(this.parent.eventMarkers[o].cssClass),r.setAttribute("tabindex","-1"),r.setAttribute("aria-label",this.parent.localeObj.getConstant("eventMarkers")+" "+("string"==typeof this.parent.eventMarkers[o].day?this.parent.eventMarkers[o].day:this.parent.getFormatedDate(this.parent.eventMarkers[o].day))+" "+this.parent.eventMarkers[o].label),t.appendChild(r)}this.parent.eventMarkerColloction=s},t.prototype.updateContainerHeight=function(){this.eventMarkersContainer&&(this.eventMarkersContainer.style.height=(0,e.formatUnit)(this.parent.getContentHeight()))},t}(),Wi=function(){function t(e){this.parent=e,this.nonworkingDayRender=new Bi(this.parent),this.eventMarkerRender=new Ai(this.parent),this.wireEvents()}return t.prototype.wireEvents=function(){this.parent.on("refreshDayMarkers",this.refreshMarkers,this),this.parent.on("updateHeight",this.updateHeight,this),this.parent.on("ui-update",this.propertyChanged,this)},t.prototype.propertyChanged=function(t){for(var i=Object.keys((0,e.getValue)("properties",t)),r=0;r<i.length;r++){switch(i[r]){case"eventMarkers":this.eventMarkerRender.renderEventMarkers(),this.updateHeight();break;case"highlightWeekends":this.nonworkingDayRender.renderWeekends(),this.updateHeight();break;case"holidays":this.nonworkingDayRender.renderHolidays(),this.updateHeight()}}},t.prototype.refreshMarkers=function(){this.nonworkingDayRender.renderWeekends(),this.nonworkingDayRender.renderHolidays(),"Vertical"!==this.parent.gridLines&&"Both"!==this.parent.gridLines||this.parent.renderChartVerticalLines(),this.eventMarkerRender.renderEventMarkers()},t.prototype.updateHeight=function(){this.nonworkingDayRender.updateContainerHeight(),this.eventMarkerRender.updateContainerHeight()},t.prototype.getModuleName=function(){return"dayMarkers"},t.prototype.destroy=function(){this.parent.isDestroyed||(this.nonworkingDayRender.removeContainers(),this.eventMarkerRender.removeContainer(),this.parent.off("refreshDayMarkers",this.refreshMarkers),this.parent.off("updateHeight",this.updateHeight),this.parent.off("ui-update",this.propertyChanged))},t}(),Hi=function(){function t(e){this.validatedids=[],this.resourceCollectionIds=[],this.criticalTasks=[],this.parent=e}return t.prototype.getCriticalTasks=function(){return this.criticalTasks},t.prototype.showCriticalPath=function(e){var t=this.parent.ids,i=this.parent.flatData;if(e&&this.parent.flatData.length>0){this.parent.enableCriticalPath=!0;var r,a=this.parent.treeGrid.parentData,n=a[0].ganttProperties.endDate,s=0,o=[],l=[],d=[],h=0,p=[],u=[],c=[],g=[],f=[];this.criticalTasks=[],a[0].ganttProperties.autoEndDate>a[0].ganttProperties.endDate&&!a[0].ganttProperties.isAutoSchedule&&(n=a[0].ganttProperties.autoEndDate);for(var m=1;m<a.length;m++)a[m].ganttProperties.endDate>=n&&(n=a[m].ganttProperties.endDate),a[m].ganttProperties.isAutoSchedule||a[m].ganttProperties.autoEndDate>=n&&(n=a[m].ganttProperties.autoEndDate);this.maxEndDate=n;for(var y=0;y<i.length;y++)i[y].isCritical=!1,i[y].ganttProperties.isCritical=!1,s=this.parent.dataOperation.getDuration(i[y].ganttProperties.endDate,n,i[y].ganttProperties.durationUnit,i[y].ganttProperties.isAutoSchedule,i[y].ganttProperties.isMilestone),i[y].slack=s+" "+i[y].ganttProperties.durationUnit,i[y].ganttProperties.slack=s+" "+i[y].ganttProperties.durationUnit,i[y].ganttProperties.endDate>=n&&o.push(i[y].ganttProperties.taskId),i[y].ganttProperties.predecessor&&0!==i[y].ganttProperties.predecessor.length&&(l.push(i[y]),d.push(i[y].ganttProperties.taskId));if("ResourceView"===this.parent.viewType)for(m=0;m<this.parent.taskIds.length;m++)this.resourceCollectionIds[m]=this.parent.taskIds[m].slice(1);for(var D=function(e){if(-1===d.indexOf(o[e])){if("ProjectView"===v.parent.viewType)h=t.indexOf(o[e].toString());else for(var r=v.parent.currentViewData.filter((function(t){return parseInt(t.ganttProperties.taskId,10)===o[e]})),a=0;a<r.length;a++)!r[a].hasChildRecords&&r[a].ganttProperties.endDate>=v.maxEndDate&&(h=r[a].index);i[h].ganttProperties.progress<100&&(i[h].isCritical=!0,i[h].ganttProperties.isCritical=!0),i[h].slack="0 "+i[h].ganttProperties.durationUnit,p.push(o[e])}else u.push(o[e])},v=this,k=0;k<o.length;k++)D(k);for(var w=l.length,b=[],T=0;T<w;T++){for(var P=-1,S=-1,C=-1,R=-1,M=T,x=l[T].ganttProperties.predecessor,O=l[T].ganttProperties.predecessor.length,I=l[T].ganttProperties.taskId,E=0;E<O;E++)(isNaN(Number(x[E].from))||"string"==typeof I?(isNaN(Number(x[E].from)),x[E].from):parseInt(x[E].from,10))===I&&(-1===P?x[E].offset?(P=x[E].to+":"+x[E].offset+x[E].offsetUnit,C=x[E].type):(P=x[E].to,C=x[E].type):x[E].offset?(P=P+","+x[E].to+":"+x[E].offset+x[E].offsetUnit,C=C+","+x[E].type):(P=P+","+x[E].to,C=C+","+x[E].type)),(isNaN(Number(x[E].to))||"string"==typeof I?(isNaN(Number(x[E].to)),x[E].to):parseInt(x[E].to,10))===I&&(-1===S?x[E].offset?(S=x[E].from+":"+x[E].offset+x[E].offsetUnit,R=x[E].type):(S=x[E].from,R=x[E].type):x[E].offset?(S=S+","+x[E].from+":"+x[E].offset+x[E].offsetUnit,R=R+","+x[E].type):(S=S+","+x[E].from,R=R+","+x[E].type));-1===S&&(S=null,R=null),-1===P&&(P=null,C=null),c.push({from:S,fromPredecessor:R,taskid:I,to:P,toPredecessor:C,currentIndex:M,slack:null,enddate:null}),g.push(I)}for(var F=c.length,U=0,N=void 0,L=0;L<F;L++)if(!c[L].to){N=c[L].taskid,U="ProjectView"===this.parent.viewType?t.indexOf(N.toString()):this.resourceCollectionIds.indexOf(N.toString());var V=i[U].ganttProperties;s=this.parent.dataOperation.getDuration(V.endDate,n,"minute",V.isAutoSchedule,V.isMilestone),c[L].slack=s,c[L].fs=-1,c[L].enddate=V.endDate,b.push({fromdata:c[L].from,todateID:c[L].taskid,fromDataPredecessor:c[L].fromPredecessor})}for(k=0;k<b.length;k++)f.push(b[k]),this.slackCalculation(f,c,g,n,i,t);r=this.finalCriticalPath(c,p,i,t,n),this.validatedids=[],this.criticalPathCollection=r,this.detailPredecessorCollection=c,this.predecessorCollectionTaskIds=g}if(!1===e&&this.parent.flatData.length>0){var B=void 0;this.parent.enableCriticalPath=!1;for(L=0;L<this.criticalPathCollection.length;L++)B=t.indexOf(this.criticalPathCollection[L].toString()),i[B].isCritical=!1;this.criticalPathCollection=[],this.detailPredecessorCollection=[],this.predecessorCollectionTaskIds=[]}},t.prototype.slackCalculation=function(t,i,r,a,n,s){var o=t[0].fromdata.split(","),l=t[0].fromDataPredecessor.split(",");r=(r=r.toString()).split(",");for(var d,h,p,u,c,g,f,m,y=[],D=0;D<o.length;D++){y=o[D].split(":"),d=r.indexOf(y[0].toString()),u=r.indexOf(t[0].todateID.toString()),"ProjectView"===this.parent.viewType?(h=s.indexOf(y[0].toString()),p=s.indexOf(t[0].todateID.toString())):(h=this.resourceCollectionIds.indexOf(y[0].toString()),p=this.resourceCollectionIds.indexOf(t[0].todateID.toString()));var v=void 0;-1!==h&&(v=n[h].ganttProperties);var k=n[p].ganttProperties;y.length>1&&(f=-1!==y[1].indexOf("hour")?60*parseFloat(y[1]):-1!==y[1].indexOf("day")?parseFloat(y[1])*(this.parent.secondsPerDay/3600)*60:parseFloat(y[1])),v&&("FS"===l[D]&&(c=v.endDate>k.startDate?-this.parent.dataOperation.getDuration(k.startDate,v.endDate,"minute",v.isAutoSchedule,v.isMilestone):this.parent.dataOperation.getDuration(v.endDate,k.startDate,"minute",v.isAutoSchedule,v.isMilestone),(0,e.isNullOrUndefined)(i[d].slack)?y.length<=1&&(i[u].slack+c<0?i[d].slack=0:i[d].slack=i[u].slack+c):i[d].slack>c&&0!==i[d].slack&&y.length<=1&&(i[u].slack+c<0?i[d].slack=0:i[d].slack=i[u].slack+c),y.length>1&&(i[d].slack=i[u].slack+c,i[d].slack=i[d].slack-f,i[d].slack<0&&(i[d].slack=0)),i[d].fs=1,i[d].fsslack=i[d].slack,i[d].enddate=v.startDate,v.endDate>=a&&v.endDate<=a&&(i[d].slack=0)),"SS"===l[D]&&(v.isAutoSchedule?(c=v.startDate>k.startDate?-this.parent.dataOperation.getDuration(k.endDate,v.startDate,"minute",v.isAutoSchedule,v.isMilestone):this.parent.dataOperation.getDuration(v.startDate,k.startDate,"minute",v.isAutoSchedule,v.isMilestone),(0,e.isNullOrUndefined)(i[d].slack)?y.length<=1&&(i[u].slack+c<0?i[d].slack=0:i[d].slack=i[u].slack+c):i[d].slack>c&&0!==i[d].slack&&y.length<=1&&(i[u].slack+c<0?i[d].slack=0:i[d].slack=i[u].slack+c),y.length>1&&(i[d].slack=i[u].slack+c,i[d].slack=i[d].slack-f,i[d].slack<0&&(i[d].slack=0)),i[d].fs=1,i[d].fsslack=i[d].slack,i[d].enddate=v.startDate):v.isAutoSchedule||(c=this.getSlackDuration(v.endDate,a,"minute",n[h]),((0,e.isNullOrUndefined)(i[d].slack)||i[d].slack>c&&0!==i[d].slack)&&(i[d].slack=c)),v.endDate>=a&&v.endDate<=a&&(i[d].slack=0)),"FF"===l[D]&&(1!==i[u].fs&&1!==i[u].ff&&-1!==i[u].fs||(1!==i[u].fs&&1!==i[u].ff||(g=k.endDate,m=i[u].slack),-1===i[u].fs&&(g=i[u].enddate,m=i[u].slack),c=g>v.endDate?-this.getSlackDuration(v.endDate,g,"minute",n[h]):this.getSlackDuration(g,v.endDate,"minute",n[h]),(0,e.isNullOrUndefined)(i[d].slack)?y.length<=1&&(i[d].slack=m-c<0?0:m-c):i[d].slack>c&&0!==i[d].slack&&y.length<=1&&(i[d].slack=m-c<0?0:m-c),y.length>1&&(i[d].slack=i[u].slack-c,i[d].slack=i[d].slack-f,i[d].slack<0&&(i[d].slack=0)),i[d].ff=1,i[d].enddate=g,i[d].fsslack=m),v.endDate>=a&&v.endDate<=a&&(i[d].slack=0)),"SF"===l[D]&&(v.isAutoSchedule?(0,e.isNullOrUndefined)(i[d].slack)?(y.length<=1?(0,e.isNullOrUndefined)(i[u].to)?(c=this.getSlackDuration(v.endDate,a,"minute",n[h]),i[d].slack=c):(0,e.isNullOrUndefined)(i[u].to)||(c=k.endDate>v.startDate?-this.parent.dataOperation.getDuration(v.startDate,k.endDate,"minute",v.isAutoSchedule,v.isMilestone):this.getSlackDuration(k.endDate,v.startDate,"minute",n[h]),i[u].slack+c<0?i[d].slack=0:i[d].slack=i[u].slack+c):y.length>1&&(c=k.endDate>=v.endDate?v.startDate>k.endDate?-this.getSlackDuration(k.endDate,v.startDate,"minute",n[h]):this.parent.dataOperation.getDuration(v.startDate,k.endDate,"minute",v.isAutoSchedule,v.isMilestone):this.getSlackDuration(v.endDate,a,"minute",n[h]),i[d].slack=i[u].slack+c,i[d].slack=i[d].slack-f,i[d].slack<0&&(i[d].slack=0)),i[d].fs=1,i[d].fsslack=i[d].slack,i[d].enddate=v.startDate):(y.length<=1?((0,e.isNullOrUndefined)(i[u].to)?c=this.getSlackDuration(v.endDate,a,"minute",n[h]):(0,e.isNullOrUndefined)(i[u].to)||(c=k.endDate>v.startDate?-this.parent.dataOperation.getDuration(v.startDate,k.endDate,"minute",v.isAutoSchedule,v.isMilestone):this.getSlackDuration(k.endDate,v.startDate,"minute",n[h])),i[d].slack>c&&0!==i[d].slack&&((0,e.isNullOrUndefined)(i[u].to)?i[d].slack=c:(0,e.isNullOrUndefined)(i[u].to)||(i[u].slack+c<0?i[d].slack=0:i[d].slack=i[u].slack+c))):y.length>1&&(c=k.endDate>v.endDate?v.startDate>k.endDate?-this.getSlackDuration(k.endDate,v.startDate,"minute",n[h]):this.parent.dataOperation.getDuration(v.startDate,k.endDate,"minute",v.isAutoSchedule,v.isMilestone):this.getSlackDuration(v.endDate,a,"minute",n[h]),i[d].slack>c&&0!==i[d].slack&&(i[d].slack=i[u].slack+c,i[d].slack=i[d].slack-f,i[d].slack<0&&(i[d].slack=0))),i[d].fs=1,i[d].fsslack=i[d].slack,i[d].enddate=v.startDate):v.isAutoSchedule||(c=this.getSlackDuration(v.endDate,a,"minute",n[h]),((0,e.isNullOrUndefined)(i[d].slack)||i[d].slack>c&&0!==i[d].slack)&&(i[d].slack=c)),v.endDate>=a&&v.endDate<=a&&(i[d].slack=0)),i[d].from&&t.push({fromdata:i[d].from,todateID:i[d].taskid,fromDataPredecessor:i[d].fromPredecessor}))}t&&(t.splice(0,1),t.length>0&&this.slackCalculation(t,i,r,a,n,s))},t.prototype.getSlackDuration=function(e,t,i,r){var a=this.parent.dateValidationModule.checkStartDate(new Date(e)),n=this.parent.dateValidationModule.checkEndDate(new Date(t));return this.parent.dataOperation.getTimeDifference(a,n,!0)<=0?0:this.parent.dataOperation.getDuration(a,n,i,r.ganttProperties.isAutoSchedule,!0)},t.prototype.updateCriticalTasks=function(e,t){for(var i=0;i<e.ganttProperties.predecessor.length;i++){var r=void 0;if("ProjectView"===this.parent.viewType)r=this.parent.getRecordByID(e.ganttProperties.predecessor[i].from);else{var a=this.resourceCollectionIds.indexOf(e.ganttProperties.predecessor[i].from.toString());r=this.parent.flatData[a]}var n=void 0;e.ganttProperties.endDate.getTime()>=this.maxEndDate.getTime()&&(e.ganttProperties.slack=e.slack="0 "+e.ganttProperties.durationUnit,e.ganttProperties.progress<100&&(e.isCritical=!0,e.ganttProperties.isCritical=!0,-1===t.indexOf(e.ganttProperties.taskId)&&t.push(e.ganttProperties.taskId))),r&&("FS"===e.ganttProperties.predecessor[i].type?n=this.parent.dataOperation.getDuration(r.ganttProperties.endDate,e.ganttProperties.startDate,r.ganttProperties.durationUnit,r.ganttProperties.isAutoSchedule,!0):"SS"===e.ganttProperties.predecessor[i].type?n=this.parent.dataOperation.getDuration(r.ganttProperties.startDate,e.ganttProperties.startDate,r.ganttProperties.durationUnit,r.ganttProperties.isAutoSchedule,!0):"FF"===e.ganttProperties.predecessor[i].type?n=this.parent.dataOperation.getDuration(r.ganttProperties.endDate,e.ganttProperties.endDate,r.ganttProperties.durationUnit,r.ganttProperties.isAutoSchedule,!0):"SF"===e.ganttProperties.predecessor[i].type&&(n=this.parent.dataOperation.getDuration(e.ganttProperties.endDate,r.ganttProperties.startDate,r.ganttProperties.durationUnit,r.ganttProperties.isAutoSchedule,!0)),n>=0&&-1===this.validatedids.indexOf(parseInt(r.ganttProperties.taskId,10))&&r.ganttProperties.taskId!==e.ganttProperties.taskId&&(r.ganttProperties.slack=n<=0?e.ganttProperties.slack:n+e.ganttProperties.durationUnit,r.slack=n<=0?e.slack:n+e.ganttProperties.durationUnit,r.isCritical=n<=0&&e.ganttProperties.isCritical,r.ganttProperties.isCritical=n<=0&&e.ganttProperties.isCritical,-1===t.indexOf(r.ganttProperties.taskId)&&r.ganttProperties.isCritical&&r.ganttProperties.progress<100&&(t.push(r.ganttProperties.taskId),this.validatedids.push(parseInt(r.ganttProperties.taskId,10)),-1===this.criticalTasks.indexOf(r)&&this.criticalTasks.push(r)),r.ganttProperties.predecessorsName&&this.updateCriticalTasks(r,t)))}},t.prototype.finalCriticalPath=function(e,t,i,r,a){for(var n,s=[],o=e.length-1;o>=0;o--){for(var l=i[n="ProjectView"===this.parent.viewType?r.indexOf(e[o].taskid.toString()):this.resourceCollectionIds.indexOf(e[o].taskid.toString())].ganttProperties.predecessor,d="0 "+i[n].ganttProperties.durationUnit,h=l.length-1;h>=0;h--){var p=void 0;p="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(l[h].to):this.resourceCollectionIds.indexOf(l[h].to);var u=void 0,c=i[n].ganttProperties;-1!==p&&("FS"===l[h].type?(l[h].to!==c.taskId.toString()||"ResourceView"===this.parent.viewType?u=this.parent.dataOperation.getDuration(c.endDate,i[p].ganttProperties.startDate,c.durationUnit,c.isAutoSchedule,c.isMilestone):-1!==(p=this.parent.ids.indexOf(l[h].from))&&0===(u=this.parent.dataOperation.getDuration(i[p].ganttProperties.endDate,c.startDate,c.durationUnit,c.isAutoSchedule,c.isMilestone))&&n!==p&&i[n].slack===d&&(i[p].slack=i[n].slack,i[p].ganttProperties.slack=i[n].slack),-1!==p&&(0===u&&n!==p&&i[n].slack!==d?(i[n].slack=i[p].slack,i[n].ganttProperties.slack=i[p].slack):0!==u&&n!==p&&i[p].isCritical&&(i[n].slack=u+" "+i[n].ganttProperties.durationUnit,i[n].ganttProperties.slack=u+" "+i[n].ganttProperties.durationUnit))):u="SF"===l[h].type?this.parent.dataOperation.getDuration(c.startDate,i[p].ganttProperties.endDate,c.durationUnit,c.isAutoSchedule,c.isMilestone):"SS"===l[h].type?this.parent.dataOperation.getDuration(c.startDate,i[p].ganttProperties.startDate,c.durationUnit,c.isAutoSchedule,c.isMilestone):this.parent.dataOperation.getDuration(c.endDate,i[p].ganttProperties.endDate,c.durationUnit,c.isAutoSchedule,c.isMilestone),("number"==typeof i[n][this.parent.taskFields.id]?parseInt(l[h].from,10):l[h].from)===i[n][this.parent.taskFields.id]&&i[p].slack===d&&u<=0&&(i[n].slack=d,i[n].ganttProperties.slack=d))}i[n].slack===d&&i[n].ganttProperties.progress<100&&(i[n].isCritical=!0,i[n].ganttProperties.isCritical=!0,-1===this.criticalTasks.indexOf(i[n])&&this.criticalTasks.push(i[n]),-1===s.indexOf(e[o].taskid)&&s.push(e[o].taskid)),i[n].ganttProperties.predecessor.length>0&&this.updateCriticalTasks(i[n],s)}if(t.length>0)for(h=0;h<t.length;h++)-1!==(n="ProjectView"===this.parent.viewType?r.indexOf(t[h].toString()):this.resourceCollectionIds.indexOf(t[h].toString()))&&i[n].ganttProperties.progress<100&&(this.criticalTasks.push(i[n]),-1===s.indexOf(t[h])&&(s=s.concat(t[h])));return s},t.prototype.criticalConnectorLine=function(t,i,r,a){this.parent.removeCriticalPathStyles();for(var n=function(i){var r;if("ProjectView"===s.parent.viewType)r=s.parent.flatData[s.parent.ids.indexOf(t[i].toString())];else for(var a=s.parent.flatData.filter((function(e){return e.ganttProperties.taskId.toString()===t[i].toString()})),n=0;n<a.length;n++)(a[n].ganttProperties.isCritical||a[n].ganttProperties.endDate>=s.maxEndDate)&&(r=a[n]);var o=s.parent.currentViewData.indexOf(r),l=s.parent.getRowByIndex(o),d=void 0,h=s.parent.taskFields;if(r&&r.parentItem){var p=s.parent.currentViewData.filter((function(e){return r.parentItem.uniqueID===e.uniqueID})),u=s.parent.flatData.indexOf(p[0]),c=s.parent.getRowByIndex(u);if(c)for(var g=c.querySelectorAll(".e-taskbar-main-container"),f=0;f<g.length;f++)g[f].getAttribute("rowuniqueid")===r.rowUniqueID&&(0,e.addClass)(g[f].querySelectorAll(".e-gantt-child-taskbar-inner-div"),H)}d=s.parent.allowUnscheduledTasks&&r&&!r[h.startDate]&&!r[h.endDate]&&r[h.duration]?"e-gantt-critical-unscheduled-taskbar":j,l&&("ProjectView"===s.parent.viewType||"ResourceView"===s.parent.viewType&&!r.hasChildRecords)&&(l.getElementsByClassName("e-gantt-milestone")[0]&&(0,e.addClass)(l.querySelectorAll(".e-gantt-milestone"),G),l.getElementsByClassName("e-gantt-child-taskbar-inner-div").length>0&&(0,e.addClass)(l.querySelectorAll(".e-gantt-child-taskbar-inner-div"),H),l.getElementsByClassName("e-gantt-child-progressbar-inner-div").length>0&&(0,e.addClass)(l.querySelectorAll(".e-gantt-child-progressbar-inner-div"),d))},s=this,o=0;o<t.length;o++)n(o);if(0!==i.length){var l=0,d=void 0,h=[],p=void 0,u=void 0;for(o=0;o<this.criticalPathCollection.length;o++)if(d=i[l=a.indexOf(this.criticalPathCollection[o])],-1!==l&&d.to){h=d.to.split(",");for(var c=0;c<h.length;c++){if(u=h[c].split("+"),h[c].indexOf("-")>=0&&(u=h[c].split("-")),p=u[0].replace(":",""),"number"==typeof t[c]&&(p=parseInt(u[0],10)),-1!==t.indexOf(p))this.parent.element.querySelectorAll("#ConnectorLineparent"+d.taskid+"child"+p).length>0&&((0,e.addClass)(this.parent.element.querySelectorAll("#ConnectorLineparent"+d.taskid+"child"+p)[0].querySelectorAll(".e-connector-line"),we),(0,e.addClass)(this.parent.element.querySelectorAll("#ConnectorLineparent"+d.taskid+"child"+p)[0].querySelectorAll(".e-connector-line-arrow"),be))}}}},t.prototype.getModuleName=function(){return"criticalPath"},t.prototype.destroy=function(){!this.parent.enableCriticalPath&&this.parent.criticalPathModule&&(this.parent.criticalPathModule=void 0)},t}(),ji=function(){return ji=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ji.apply(this,arguments)},Gi=function(){function t(e){this.isUndoRedoPerformed=!1,this.changedRecords=[],this.getRedoCollection=[],this.getUndoCollection=[],this.redoEnabled=!1,this.previousSortedColumns=[],this.searchString="",this.isFromUndoRedo=!1,this.canUpdateIndex=!0,this.sortedColumnsLength=0,this.parent=e}return t.prototype.undoAction=function(){var t=this;if(this.getUndoCollection.length>0){var i=this.getUndoCollection[this.getUndoCollection.length-1],r={};if("ZoomIn"===i.action||"ZoomOut"===i.action||"ZoomToFit"===i.action)r.action=i.action,r.previousZoomingLevel=(0,e.extend)({},{},this.parent.currentZoomingLevel,!0);else if("NextTimeSpan"===i.action||"PreviousTimeSpan"===i.action)r.action=i.action,r.previousTimelineStartDate=(0,e.extend)([],[this.parent.timelineModule.timelineStartDate],[],!0)[0],r.previousTimelineEndDate=(0,e.extend)([],[this.parent.timelineModule.timelineEndDate],[],!0)[0];else if("Sorting"===i.action)r.action="Sorting",r.sortColumns=this.previousSortedColumns;else if("Filtering"===i.action)r.action="Filtering",r.filteredColumns=i.filteredColumns;else if("ColumnReorder"===i.action)r.action=i.action,r.toColumn=i.fromColumn,r.fromColumn=i.toColumn,r.fromIndex=i.toIndex,r.toIndex=i.fromIndex;else if("Search"===i.action)r.action=i.action,r.searchString=this.searchString;else if("ColumnState"===i.action)r.action=i.action,r.showhideColumns=i.showhideColumns;else if("ColumnResize"===i.action)r.action=i.action,r.resizedColumn=ji({},this.parent.treeGrid.columns[i.resizedColumn.index]);else if("RowDragAndDrop"===i.action||"TaskbarDragAndDrop"===i.action){for(var a=[],n=0;n<i.beforeDrop.length;n++)"ProjectView"===this.parent.viewType?a.push(this.parent.getRecordByID(i.beforeDrop[n].data.ganttProperties.taskId)):i.beforeDrop[n].data.ganttProperties.hasChildRecords?a.push(this.parent.flatData[this.parent.taskIds.indexOf("R"+i.beforeDrop[n].data.ganttProperties.taskId.toString())]):a.push(this.parent.flatData[this.parent.taskIds.indexOf("T"+i.beforeDrop[n].data.ganttProperties.taskId.toString())]);r.action=i.action,r.beforeDrop=[];var s={},o=(0,e.extend)([],[],[this.parent.getRecordByID(i.afterDrop.dropRecord.ganttProperties.taskId)],!0)[0];s.data=[];for(n=0;n<i.afterDrop.data.length;n++)"ProjectView"===this.parent.viewType?s.data.push((0,e.extend)([],[],[this.parent.getRecordByID(i.afterDrop.data[n].ganttProperties.taskId)],!0)[0]):s.data.push((0,e.extend)([],[],this.parent.flatData[this.parent.taskIds.indexOf("T"+i.afterDrop.data[n].ganttProperties.taskId)],!0)[0]);s.dropRecord=(0,e.extend)([],[],[o],!0)[0],s.dropPosition=i.afterDrop.dropPosition,r.afterDrop=s,this.findPosition(a,r,"beforeDrop")}else if("Indent"===i.action||"Outdent"===i.action)r.selectedRowIndexes=i.selectedRowIndexes,r.droppedRecord=(0,e.extend)([],[],[this.parent.flatData[this.parent.ids.indexOf(i.droppedRecord.ganttProperties.taskId.toString())]],!0)[0],r.modifiedRecord=[],this.findPosition((0,e.extend)([],[],[this.parent.flatData[this.parent.ids.indexOf(i.modifiedRecord[0].data.ganttProperties.taskId.toString())]],!0),r,"modifiedRecord"),r.action=i.action;else if("Delete"===i.action){r.action="Delete",r.deleteRecords=[];for(n=0;n<i.deletedRecordsDetails.length;n++)r.deleteRecords.push(i.deletedRecordsDetails[n].data)}else if("Add"===i.action){r.action="Add",r.deletedRecordsDetails=[];a=i.addedRecords;this.findPosition(a,r,"deletedRecordsDetails")}else{r.action=i.action,r.modifiedRecords=[];for(n=0;n<i.modifiedRecords.length;n++){var l=void 0;l="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(i.modifiedRecords[n].ganttProperties.taskId.toString()):i.modifiedRecords[n].hasChildRecords?this.parent.taskIds.indexOf("R"+i.modifiedRecords[n].ganttProperties.taskId):this.parent.taskIds.indexOf("T"+i.modifiedRecords[n].ganttProperties.taskId),r.modifiedRecords.push((0,e.extend)([],[this.parent.flatData[l]],[],!0)[0])}}if(this.getRedoCollection.push(r),this.isUndoRedoPerformed=!0,this.changedRecords=[],this.currentAction=i,"ZoomIn"===i.action||"ZoomOut"===i.action||"ZoomToFit"===i.action)this.parent.timelineSettings.timelineViewMode=i.previousZoomingLevel.timelineViewMode,this.parent.timelineSettings.timelineUnitSize=i.previousZoomingLevel.timelineUnitSize,this.parent.timelineSettings.updateTimescaleView=i.previousZoomingLevel.updateTimescaleView,this.parent.timelineSettings.topTier.unit=i.previousZoomingLevel.topTier.unit,this.parent.timelineSettings.topTier.count=i.previousZoomingLevel.topTier.count,this.parent.timelineSettings.topTier.format=i.previousZoomingLevel.topTier.format,this.parent.timelineSettings.bottomTier.unit=i.previousZoomingLevel.bottomTier.unit,this.parent.timelineSettings.bottomTier.count=i.previousZoomingLevel.bottomTier.count,this.parent.timelineSettings.bottomTier.format=i.previousZoomingLevel.bottomTier.format,this.parent.timelineSettings.weekStartDay=i.previousZoomingLevel.weekStartDay,this.parent.timelineSettings.weekendBackground=i.previousZoomingLevel.weekendBackground,"ZoomToFit"===i.action&&this.parent.timelineModule.refreshTimeline();else if("NextTimeSpan"===i.action||"PreviousTimeSpan"===i.action)this.parent.updateProjectDates(i.previousTimelineStartDate,i.previousTimelineEndDate,!1);else if("Sorting"===i.action)if(this.isFromUndoRedo=!0,this.sortedColumnsLength=0,i.sortColumns.length>0)for(n=0;n<i.sortColumns.length;n++)this.parent.treeGrid.sortByColumn(i.sortColumns[n].field,i.sortColumns[n].direction);else this.parent.clearSorting();else if("Filtering"===i.action){this.isFromUndoRedo=!0;for(n=this.getUndoCollection.length-1;n>=0&&this.getUndoCollection[n].filteredColumns;n--){for(var d=[],h=0;h<this.getUndoCollection[n].filteredColumns.length;h++)d.push(this.getUndoCollection[n].filteredColumns[h].field);this.parent.clearFiltering(d)}}else if("ColumnReorder"===i.action){this.isFromUndoRedo=!0;var p=this.parent.treeGrid.columns[i.fromIndex].field,u=this.parent.treeGrid.columns[i.toIndex].field;this.parent.reorderColumns(p,u)}else if("Search"===i.action)this.isFromUndoRedo=!0,this.parent.search(i.searchString);else if("ColumnState"===i.action){this.isFromUndoRedo=!0;for(n=0;n<i.showhideColumns.length;n++)i.showhideColumns[n].visible?this.parent.hideColumn(i.showhideColumns[n].field,"field"):this.parent.showColumn(i.showhideColumns[n].field,"field")}else if("ColumnResize"===i.action)this.parent.treeGrid.columns[i.resizedColumn.index].width=i.resizedColumn.width,this.parent.treeGrid.refreshColumns();else if("RowDragAndDrop"===i.action||"TaskbarDragAndDrop"===i.action)for(n=0;n<i.beforeDrop.length;n++){var c=void 0,g=void 0;"ProjectView"===this.parent.viewType?(c=this.parent.ids.indexOf(i.beforeDrop[n].data.ganttProperties.taskId.toString()),g=this.parent.ids.indexOf(i.beforeDrop[n].id.toString())):(c=i.beforeDrop[n].data.ganttProperties.hasChildRecords?this.parent.ids.indexOf("R"+i.beforeDrop[n].data.ganttProperties.taskId.toString()):this.parent.ids.indexOf("T"+i.beforeDrop[n].data.ganttProperties.taskId.toString()),g=this.parent.taskIds.indexOf(i.beforeDrop[n].id.toString())),this.parent.reorderRows([c],g,i.beforeDrop[n].position),this.parent.updateRecordByID(i.beforeDrop[n].data),"child"===i.afterDrop.dropPosition&&this.parent.updateRecordByID(i.afterDrop.dropRecord)}else if("Indent"===i.action||"Outdent"===i.action)this.parent.selectRow(this.parent.ids.indexOf(i.modifiedRecord[0].data.ganttProperties.taskId.toString())),"Indent"===i.action?this.parent.outdent():this.parent.indent(),setTimeout((function(){t.isUndoRedoPerformed=!0,t.parent.updateRecordByID(i.droppedRecord),t.isUndoRedoPerformed=!1}));else if("Delete"===i.action){var f=void 0;for(n=0;n<i.deletedRecordsDetails.length;n++){f="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(i.deletedRecordsDetails[n].id.toString()):this.parent.taskIds.indexOf(i.deletedRecordsDetails[n].id.toString());var m=void 0;"above"===i.deletedRecordsDetails[n].position&&(m="Above"),"below"===i.deletedRecordsDetails[n].position&&(m="Below"),"child"===i.deletedRecordsDetails[n].position&&(m="Child"),this.parent.addRecord(i.deletedRecordsDetails[n].data,m,f)}}else if("Add"===i.action){var y=(0,e.extend)([],[this.parent.editSettings.showDeleteConfirmDialog],[],!0)[0];this.parent.editSettings.showDeleteConfirmDialog=!1;var D=i.addedRecords;if("ResourceView"===this.parent.viewType&&1===i.addedRecords.length&&i.addedRecords[0].parentItem){var v=this.parent.getTaskByUniqueID(i.addedRecords[0].parentItem.uniqueID);1===v.childRecords.length&&"Unassigned Task"===v.ganttProperties.taskName&&(D=v)}this.parent.deleteRecord(D),this.parent.editSettings.showDeleteConfirmDialog=y}else if(this.parent.updateRecordByID(this.getUndoCollection[this.getUndoCollection.length-1].modifiedRecords[0]),i.connectedRecords&&"ProjectView"===this.parent.viewType)for(n=0;n<i.connectedRecords.length;n++)this.parent.updateRecordByID(i.connectedRecords[n]);var k={};(k=(0,e.extend)([],[],[this.getUndoCollection[this.getUndoCollection.length-1]],!0)[0]).requestType="afterUndoAction",this.parent.trigger("onAfterUndo",k),this.isUndoRedoPerformed=!1,this.getRedoCollection.length>0&&(this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!0),this.redoEnabled=!0),this.getUndoCollection.splice(this.getUndoCollection.length-1,1),0===this.getUndoCollection.length&&this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1)}else this.getUndoCollection.splice(this.getUndoCollection.length-1,1),0===this.getUndoCollection.length&&this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1)},t.prototype.redoAction=function(){if(this.getRedoCollection.length>0){var t=this.getRedoCollection[this.getRedoCollection.length-1],i={};if("ZoomIn"===t.action||"ZoomOut"===t.action||"ZoomToFit"===t.action)i.action=t.action,i.previousZoomingLevel=(0,e.extend)({},{},this.parent.currentZoomingLevel,!0);else if("NextTimeSpan"===t.action||"PreviousTimeSpan"===t.action)i.action=t.action,i.previousTimelineStartDate=(0,e.extend)([],[this.parent.timelineModule.timelineStartDate],[],!0)[0],i.previousTimelineEndDate=(0,e.extend)([],[this.parent.timelineModule.timelineEndDate],[],!0)[0];else if("Sorting"===t.action)i.action="Sorting",i.sortColumns=(0,e.extend)([],this.parent.sortSettings.columns,[],!0);else if("Filtering"===t.action)i.action="Filtering",i.filteredColumns=t.filteredColumns;else if("ColumnReorder"===t.action)i.action=t.action,i.toColumn=t.fromColumn,i.fromColumn=t.toColumn,i.fromIndex=t.toIndex,i.toIndex=t.fromIndex;else if("Search"===t.action)i.action=t.action,i.searchString=(0,e.extend)([],[this.parent.searchSettings.key],[],!0)[0];else if("ColumnState"===t.action)i.action=t.action,i.showhideColumns=t.showhideColumns;else if("ColumnResize"===t.action)i.action=t.action,i.resizedColumn=ji({},this.parent.treeGrid.columns[t.resizedColumn.index]);else if("RowDragAndDrop"===t.action||"TaskbarDragAndDrop"===t.action){for(var r=[],a=0;a<t.beforeDrop.length;a++)"ProjectView"===this.parent.viewType?r.push(this.parent.getRecordByID(t.beforeDrop[a].data.ganttProperties.taskId)):t.beforeDrop[a].data.ganttProperties.hasChildRecords?r.push(this.parent.flatData[this.parent.taskIds.indexOf("R"+t.beforeDrop[a].data.ganttProperties.taskId.toString())]):r.push(this.parent.flatData[this.parent.taskIds.indexOf("T"+t.beforeDrop[a].data.ganttProperties.taskId.toString())]);i.action=t.action,i.beforeDrop=[];var n={},s=(0,e.extend)([],[],[this.parent.getRecordByID(t.afterDrop.dropRecord.ganttProperties.taskId)],!0)[0];n.data=[];for(a=0;a<t.afterDrop.data.length;a++)"ProjectView"===this.parent.viewType?n.data.push((0,e.extend)([],[],[this.parent.getRecordByID(t.afterDrop.data[a].ganttProperties.taskId)],!0)[0]):n.data.push((0,e.extend)([],[],this.parent.flatData[this.parent.taskIds.indexOf("T"+t.afterDrop.data[a].ganttProperties.taskId)],!0)[0]);n.dropRecord=(0,e.extend)([],[],[s],!0)[0],n.dropPosition=t.afterDrop.dropPosition,i.afterDrop=n,this.findPosition(r,i,"beforeDrop")}else if("Indent"===t.action||"Outdent"===t.action)i.selectedRowIndexes=t.selectedRowIndexes,i.droppedRecord=(0,e.extend)([],[],[this.parent.flatData[this.parent.ids.indexOf(t.droppedRecord.ganttProperties.taskId.toString())]],!0)[0],i.modifiedRecord=[],this.findPosition((0,e.extend)([],[],[this.parent.flatData[this.parent.ids.indexOf(t.modifiedRecord[0].data.ganttProperties.taskId.toString())]],!0),i,"modifiedRecord"),i.action=t.action;else if("Delete"===t.action)i.action="Delete",i.deletedRecordsDetails=[],this.findPosition((0,e.extend)([],[],t.deleteRecords,!0),i,"deletedRecordsDetails");else if("Add"===t.action)i.action="Add",i.addedRecords=[t.deletedRecordsDetails[0].data];else{i.action=t.action,i.modifiedRecords=[];for(a=0;a<t.modifiedRecords.length;a++){var o=void 0;o="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(t.modifiedRecords[a].ganttProperties.taskId.toString()):t.modifiedRecords[a].hasChildRecords?this.parent.taskIds.indexOf("R"+t.modifiedRecords[a].ganttProperties.taskId):this.parent.taskIds.indexOf("T"+t.modifiedRecords[a].ganttProperties.taskId),i.modifiedRecords.push((0,e.extend)([],[this.parent.flatData[o]],[],!0)[0])}}if(this.getUndoCollection.push(i),this.isUndoRedoPerformed=!0,this.currentAction=t,"ZoomIn"===t.action||"ZoomOut"===t.action||"ZoomToFit"===t.action)"ZoomToFit"===t.action?this.parent.fitToProject():(this.parent.timelineSettings.timelineViewMode=t.previousZoomingLevel.timelineViewMode,this.parent.timelineSettings.timelineUnitSize=t.previousZoomingLevel.timelineUnitSize,this.parent.timelineSettings.updateTimescaleView=t.previousZoomingLevel.updateTimescaleView,this.parent.timelineSettings.topTier.unit=t.previousZoomingLevel.topTier.unit,this.parent.timelineSettings.topTier.count=t.previousZoomingLevel.topTier.count,this.parent.timelineSettings.topTier.format=t.previousZoomingLevel.topTier.format,this.parent.timelineSettings.bottomTier.unit=t.previousZoomingLevel.bottomTier.unit,this.parent.timelineSettings.bottomTier.count=t.previousZoomingLevel.bottomTier.count,this.parent.timelineSettings.bottomTier.format=t.previousZoomingLevel.bottomTier.format,this.parent.timelineSettings.weekStartDay=t.previousZoomingLevel.weekStartDay,this.parent.timelineSettings.weekendBackground=t.previousZoomingLevel.weekendBackground);else if("NextTimeSpan"===t.action||"PreviousTimeSpan"===t.action)this.parent.updateProjectDates(t.previousTimelineStartDate,t.previousTimelineEndDate,!1);else if("Sorting"===t.action)if(this.isFromUndoRedo=!0,this.sortedColumnsLength=0,0===t.sortColumns.length)this.parent.clearSorting();else for(a=0;a<t.sortColumns.length;a++)this.parent.treeGrid.sortByColumn(t.sortColumns[a].field,t.sortColumns[a].direction,t.sortColumns.length>1);else if("ColumnState"===t.action){this.isFromUndoRedo=!0;for(a=0;a<t.showhideColumns.length;a++)t.showhideColumns[a].visible?this.parent.hideColumn(t.showhideColumns[a].field,"field"):this.parent.showColumn(t.showhideColumns[a].field,"field")}else if("Filtering"===t.action)for(var l=0;l<t.filteredColumns.length;l++)this.isFromUndoRedo=!0,this.parent.filterByColumn(t.filteredColumns[l].field,t.filteredColumns[l].operator,t.filteredColumns[l].value,t.filteredColumns[l].predicate,t.filteredColumns[l].matchCase,t.filteredColumns[l].ignoreAccent);else if("ColumnReorder"===t.action){this.isFromUndoRedo=!0;var d=this.parent.treeGrid.columns[t.fromIndex].field,h=this.parent.treeGrid.columns[t.toIndex].field;this.parent.reorderColumns(d,h)}else if("Search"===t.action)this.isFromUndoRedo=!0,this.parent.search(t.searchString);else if("ColumnResize"===t.action)this.parent.treeGrid.columns[t.resizedColumn.index].width=t.resizedColumn.width,this.parent.treeGrid.refreshColumns();else if("RowDragAndDrop"===t.action||"TaskbarDragAndDrop"===t.action)for(a=0;a<t.beforeDrop.length;a++){var p=void 0,u=void 0;"ProjectView"===this.parent.viewType?(p=this.parent.ids.indexOf(t.beforeDrop[a].data.ganttProperties.taskId.toString()),u=this.parent.ids.indexOf(t.beforeDrop[a].id.toString())):(p=t.beforeDrop[a].data.ganttProperties.hasChildRecords?this.parent.ids.indexOf("R"+t.beforeDrop[a].data.ganttProperties.taskId.toString()):this.parent.ids.indexOf("T"+t.beforeDrop[a].data.ganttProperties.taskId.toString()),u=this.parent.taskIds.indexOf(t.beforeDrop[a].id.toString())),this.parent.reorderRows([p],u,t.beforeDrop[a].position)}else if("Indent"===t.action||"Outdent"===t.action)this.parent.selectRow(t.selectedRowIndexes[0]),"Indent"===t.action&&this.parent.indent(),"Outdent"===t.action&&this.parent.outdent();else if("Delete"===t.action){if("ResourceView"===this.parent.viewType)for(a=0;a<t.deleteRecords.length;a++)if(t.deleteRecords[a].parentItem&&!this.parent.getParentTask(t.deleteRecords[a].parentItem)){var c=this.parent.flatData[t.deleteRecords[a].parentItem.index];t.deleteRecords[a].parentItem.uniqueID=c.uniqueID,t.deleteRecords[a].parentItem.taskId=c.ganttProperties.rowUniqueID,t.deleteRecords[a].parentItem.expanded=c.expanded}var g=(0,e.extend)([],[this.parent.editSettings.showDeleteConfirmDialog],[],!0)[0];this.parent.editSettings.showDeleteConfirmDialog=!1,this.parent.deleteRecord(t.deleteRecords),this.parent.editSettings.showDeleteConfirmDialog=g}else if("Add"===t.action)if("ResourceView"===this.parent.viewType&&t.deletedRecordsDetails.length>1)this.parent.editModule.addRecord((0,e.extend)([],[],t.deletedRecordsDetails,!0));else{var f=void 0;for(a=0;a<t.deletedRecordsDetails.length;a++){f="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(t.deletedRecordsDetails[a].id.toString()):this.parent.taskIds.indexOf(t.deletedRecordsDetails[a].id.toString());var m=void 0;"above"===t.deletedRecordsDetails[a].position&&(m="Above"),"below"===t.deletedRecordsDetails[a].position&&(m="Below"),"child"===t.deletedRecordsDetails[a].position&&(m="Child"),"bottom"===t.deletedRecordsDetails[a].position&&(m="Bottom"),this.parent.editModule.addRecord(t.deletedRecordsDetails[a].data,m,f)}}else this.parent.updateRecordByID(t.modifiedRecords[0]);this.isUndoRedoPerformed=!1,0===this.getRedoCollection.length&&(this.redoEnabled=!1),this.getUndoCollection.length>0&&this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),this.getRedoCollection.splice(this.getRedoCollection.length-1,1),0===this.getRedoCollection.length&&this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!1)}},t.prototype.createUndoCollection=function(){this.parent.totalUndoAction+1>this.parent.undoRedoStepsCount&&this.getUndoCollection.length===this.parent.totalUndoAction&&(this.getUndoCollection.splice(0,1),this.disableRedo()),this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),0===this.getUndoCollection.length?(this.getUndoCollection[0]=[],this.parent.totalUndoAction+1<=this.parent.undoRedoStepsCount&&this.parent.totalUndoAction++):Object.keys(this.getUndoCollection[this.getUndoCollection.length-1]).length>0&&(this.getUndoCollection[this.getUndoCollection.length]=[],this.parent.totalUndoAction+1<=this.parent.undoRedoStepsCount&&this.parent.totalUndoAction++)},t.prototype.disableRedo=function(){this.redoEnabled=!1,this.getRedoCollection=[],this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!1)},t.prototype.findPosition=function(t,i,r){for(var a=function(a){var s={};if(s.data=t[a],"ProjectView"===n.parent.viewType)if(!t[a].hasChildRecords&&t[a].parentItem)if((p=n.parent.getRecordByID(t[a].parentItem.taskId)).childRecords.length>1){var o=n.parent.ids.indexOf(t[a].ganttProperties.taskId.toString());if((v=n.parent.flatData[o-1]).parentItem&&v.parentItem.taskId===p.ganttProperties.taskId)s.position="below",s.id=(0,e.extend)([],[n.parent.flatData[n.parent.ids.indexOf(t[a].ganttProperties.taskId.toString())-1].ganttProperties.taskId],[],!0)[0];else{s.position="above";var l=n.parent.flatData[n.parent.ids.indexOf(t[a].ganttProperties.taskId.toString())+1],d=n.parent.ids.indexOf(t[a].ganttProperties.taskId.toString())+1,h=a;do{!(b=t[h+1])||b&&l.ganttProperties.taskId!==b.ganttProperties.taskId?l.parentItem?s.id=(0,e.extend)([],[l.ganttProperties.taskId],[],!0)[0]:(s.id=(0,e.extend)([],[t[a].parentItem.taskId],[],!0)[0],s.position="child"):(h++,d++,l=n.parent.flatData[d])}while(!s.id)}}else s.position="child",s.id=(0,e.extend)([],[p.ganttProperties.taskId],[],!0)[0];else if(t[a].hasChildRecords||t[a].parentItem){if(t[a].hasChildRecords&&!t[a].parentItem){for(c=void 0,l=void 0,g=void 0,f=0;f<n.parent.treeGrid.parentData.length;f++)if(n.parent.treeGrid.parentData[f].ganttProperties.taskId===t[a].ganttProperties.taskId){c=f,l=n.parent.treeGrid.parentData[f+1],g=f+1;break}if(-1!==c)if(0===c){s.position="above";h=a;do{!(b=t[h+1])||b&&l.ganttProperties.taskId!==b.ganttProperties.taskId?s.id=(0,e.extend)([],[l.ganttProperties.taskId],[],!0)[0]:(h++,g++,l=n.parent.treeGrid.parentData[g])}while(!s.id)}else s.position="below",s.id=(0,e.extend)([],[n.parent.treeGrid.parentData[c-1].ganttProperties.taskId],[],!0)[0]}else if(t[a].hasChildRecords&&t[a].parentItem){var p;if(1===(p=n.parent.getRecordByID(t[a].parentItem.taskId)).childRecords.length)s.position="child",s.id=(0,e.extend)([],[t[a].parentItem.taskId],[],!0)[0];else{var u=void 0;for(f=0;f<p.childRecords.length;f++)if(p.childRecords[a].ganttProperties.taskId===t[a].ganttProperties.taskId){u=f;break}(0,e.isNullOrUndefined)(u)||(0===u?(s.position="above",s.id=(0,e.extend)([],[p.childRecords[u+1].ganttProperties.taskId],[],!0)[0]):(s.position="below",s.id=(0,e.extend)([],[p.childRecords[u-1].ganttProperties.taskId],[],!0)[0]))}}}else{n.parent.ids.indexOf(t[a].ganttProperties.taskId.toString())===n.parent.ids.length-1?s.position="below":s.position="above";for(var c=void 0,l=void 0,g=void 0,f=0;f<n.parent.treeGrid.parentData.length;f++)if(n.parent.treeGrid.parentData[f].ganttProperties.taskId===t[a].ganttProperties.taskId){c=f,l=n.parent.treeGrid.parentData[f+1],g=f+1;break}var h=a;do{!(b=t[h+1])||b&&l.ganttProperties.taskId!==b.ganttProperties.taskId?(l||(l=n.parent.treeGrid.parentData[c-1]),s.id=(0,e.extend)([],[l.ganttProperties.taskId],[],!0)[0]):(h++,g++,l=n.parent.treeGrid.parentData[g])}while(!s.id)}else if(t[a].parentItem){var m=void 0;if(1===(m=t[a].parentItem.index?n.parent.flatData[t[a].parentItem.index]:n.parent.flatData[n.parent.ids.indexOf(t[a].parentItem.taskId)]).childRecords.length)s.position="bottom",s.id="R"+m.ganttProperties.taskId,"deletedIndexes"===r&&(s.position="child",s.index=m.index);else{for(var y=void 0,D=0;D<m.childRecords.length;D++)if(m.childRecords[D].ganttProperties.taskId===t[a].ganttProperties.taskId){y=D;break}var v;if((v=m.childRecords[y-1])&&v.parentItem&&v.parentUniqueID===m.uniqueID)s.position="below",s.id=(0,e.extend)([],["T"+n.parent.flatData[n.parent.taskIds.indexOf("T"+t[a].ganttProperties.taskId.toString())-1].ganttProperties.taskId],[],!0)[0],"deletedIndexes"===r&&(s.index=n.parent.taskIds.indexOf("T"+t[a].ganttProperties.taskId.toString())-1);else{d=void 0;if(y!==m.childRecords.length-1){s.position="above",0===y&&m.childRecords[1]?d=m.childRecords[1].index:m.childRecords[y-1]&&(d=m.childRecords[y-1].index);l=n.parent.flatData[d],o=d,h=a;do{!(b=t[h+1])||b&&l.ganttProperties.taskId!==b.ganttProperties.taskId?l.parentItem?(s.id=(0,e.extend)([],["T"+l.ganttProperties.taskId],[],!0)[0],"deletedIndexes"===r&&(s.index=(0,e.extend)([],[l.index],[],!0)[0],0===y&&m.childRecords[1].ganttProperties.taskId===l.ganttProperties.taskId&&(s.index=s.index-1))):(s.id=(0,e.extend)([],["R"+t[a].parentItem.taskId],[],!0)[0],s.position="child","deletedIndexes"===r&&(s.index=t[a].parentItem.index)):(h++,o++,l=n.parent.flatData[o])}while(!s.id)}else y===m.childRecords.length-1?s.position="below":s.position="above",s.id="T"+m.childRecords[y-1].ganttProperties.taskId,"deletedIndexes"===r&&(s.index=m.childRecords[y-1].index)}}}else{var k=n.parent.treeGrid.parentData.filter((function(e){return e.ganttProperties.taskId===t[a].ganttProperties.taskId}))[0],w=n.parent.treeGrid.parentData.indexOf(k);if(0===w){s.position="above";for(l=void 0,g=void 0,f=0;f<n.parent.treeGrid.parentData.length;f++)if(n.parent.treeGrid.parentData[f].ganttProperties.taskId===t[a].ganttProperties.taskId){l=n.parent.treeGrid.parentData[f+1],g=f+1;break}h=a;do{var b;!(b=t[h+1])||b&&l.ganttProperties.taskId!==b.ganttProperties.taskId?(s.id="R"+l.ganttProperties.taskId,"deletedIndexes"===r&&(s.index=l.index)):(h++,g++,l=n.parent.treeGrid.parentData[g])}while(!s.id)}else s.position="below",s.id="R"+n.parent.treeGrid.parentData[w-1].ganttProperties.taskId,"deletedIndexes"===r&&(s.index=n.parent.treeGrid.parentData[w-1].index)}if("deletedIndexes"===r){var T=n.parent.getTaskByUniqueID(s.data.parentUniqueID);if(0===n.parent.editModule.dialogModule.ganttResources.length&&-1===i[r].indexOf(s))i[r].push(s);else for(D=0;D<n.parent.editModule.dialogModule.ganttResources.length;D++)n.parent.editModule.dialogModule.ganttResources[D][n.parent.resourceFields.id]!==T.ganttProperties.taskId&&-1===i[r].indexOf(s)&&i[r].push(s)}else i[r].push(s)},n=this,s=0;s<t.length;s++)a(s)},t.prototype.getModuleName=function(){return"undoRedo"},t.prototype.destroy=function(){!this.parent.enableUndoRedo&&this.parent.undoRedoModule&&(this.parent.undoRedoModule=void 0)},t}(),zi=function(){function t(t){var i=this;this.segmentIndex=-1,this.headerContextMenuClick=function(t){var r=(0,e.closest)(t.event.target,".e-row"),a=(0,e.closest)(t.event.target,".e-chart-row");(0,e.isNullOrUndefined)(r)&&(0,e.isNullOrUndefined)(a)&&(t.type="Header",i.parent.trigger("contextMenuClick",t))},this.headerContextMenuOpen=function(t){var r=(0,e.closest)(t.event.target,".e-row"),a=(0,e.closest)(t.event.target,".e-chart-row");(0,e.isNullOrUndefined)(r)&&(0,e.isNullOrUndefined)(a)?(t.type="Header",i.parent.trigger("contextMenuOpen",t)):t.cancel=!0},this.parent=t,this.ganttID=t.element.id,_e.TreeGrid.Inject(_e.ContextMenu),this.parent.treeGrid.contextMenuClick=this.headerContextMenuClick.bind(this),this.parent.treeGrid.contextMenuOpen=this.headerContextMenuOpen.bind(this),this.addEventListener(),this.resetItems()}return t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on("initiate-contextMenu",this.render,this),this.parent.on("reRender-contextMenu",this.reRenderContextMenu,this),this.parent.on("contextMenuClick",this.contextMenuItemClick,this),this.parent.on("contextMenuOpen",this.contextMenuBeforeOpen,this))},t.prototype.reRenderContextMenu=function(t){t.module===this.getModuleName()&&t.enable&&(this.contextMenu&&(this.contextMenu.destroy(),(0,e.remove)(this.element)),this.resetItems(),this.render())},t.prototype.render=function(){this.element=this.parent.createElement("ul",{id:this.ganttID+"_contextmenu",className:M}),this.parent.element.appendChild(this.element);var e="#"+this.ganttID;this.contextMenu=new vi.ContextMenu({items:this.getMenuItems(),locale:this.parent.locale,enableRtl:this.parent.enableRtl,target:e,animationSettings:{effect:"None"},select:this.contextMenuItemClick.bind(this),beforeOpen:this.contextMenuBeforeOpen.bind(this),onOpen:this.contextMenuOpen.bind(this),onClose:this.contextMenuOnClose.bind(this),cssClass:"e-gantt"}),this.contextMenu.appendTo(this.element),this.parent.treeGrid.contextMenuItems=this.headerMenuItems},t.prototype.contextMenuItemClick=function(t){var i,r,a;this.item=this.getKeyFromId(t.item.id);var n=(0,e.getValue)("parentObj",t.item),s=-1;switch(n&&!(0,e.isNullOrUndefined)(n.id)&&"DeleteDependency"===this.getKeyFromId(n.id)&&(s=n.items.indexOf(t.item)),this.parent.isAdaptive&&("TaskInformation"!==this.item&&"Above"!==this.item&&"Below"!==this.item&&"Child"!==this.item&&"DeleteTask"!==this.item||this.parent.selectionModule&&"Multiple"===this.parent.selectionSettings.type&&(this.parent.selectionModule.hidePopUp(),document.getElementsByClassName("e-gridpopup")[0].style.display="none")),this.item){case"TaskInformation":(0,e.isNullOrUndefined)(this.rowData)||("string"==typeof this.rowData.ganttProperties.taskId?this.parent.openEditDialog(this.rowData.ganttProperties.rowUniqueID):this.parent.openEditDialog(Number(this.rowData.ganttProperties.rowUniqueID)));break;case"Above":case"Below":case"Child":if((0,e.isNullOrUndefined)(this.rowData))0===this.parent.flatData.length&&this.parent.addRecord();else if(i=this.item,(r=(0,e.extend)({},{},this.rowData.taskData,!0))[(a=this.parent.taskFields).startDate]&&this.parent.setRecordValue(a.startDate,this.rowData.ganttProperties.startDate,r,!0),r[a.endDate]&&this.parent.setRecordValue(a.endDate,this.rowData.ganttProperties.endDate,r,!0),(0,e.isNullOrUndefined)(a.dependency)||(r[a.dependency]=null),!(0,e.isNullOrUndefined)(a.child)&&r[a.child]&&delete r[a.child],!(0,e.isNullOrUndefined)(a.parentID)&&r[a.parentID]&&(r[a.parentID]=null),this.rowData){var o=this.parent.updatedRecords.indexOf(this.rowData);this.parent.addRecord(r,i,o)}break;case"Milestone":case"ToMilestone":if((0,e.isNullOrUndefined)(this.rowData)){if(0===this.parent.flatData.length&&"Milestone"===this.item){var l=this.parent.editModule.createNewRecord(),d=this.parent.taskFields;this.parent.taskFields.duration&&(l[d.duration]=0),this.parent.taskFields.milestone&&(l[d.milestone]=!0),this.parent.addRecord(l)}}else this.parent.convertToMilestone(this.rowData.ganttProperties.rowUniqueID);break;case"DeleteTask":"Cell"!==this.parent.selectionSettings.mode&&this.parent.selectionModule.selectedRowIndexes.length>1||"Cell"===this.parent.selectionSettings.mode&&this.parent.selectionModule.getSelectedRowCellIndexes().length?this.parent.editModule.startDeleteAction():this.parent.editModule.deleteRecord(this.rowData);break;case"ToTask":if(!(0,e.isNullOrUndefined)(this.rowData)){if(r=(0,e.extend)({},{},this.rowData.taskData,!0),a=this.parent.taskFields,(0,e.isNullOrUndefined)(a.duration)){r[a.startDate]=new Date(this.rowData.taskData[a.startDate]);var h=new Date(this.rowData.taskData[a.startDate]);h.setDate(h.getDate()+1),r[a.endDate]=h}else r[a.duration]=parseInt(r[a.duration],10)<=0?1:r[a.duration];(0,e.isNullOrUndefined)(r[a.milestone])||!0===r[a.milestone]&&(r[a.milestone]=!1),r[a.startDate]&&this.parent.setRecordValue(a.startDate,this.rowData.ganttProperties.startDate,r,!0),this.parent.updateRecordByID(r)}break;case"Cancel":this.parent.cancelEdit();break;case"Save":this.parent.editModule.cellEditModule.isCellEdit=!1,this.parent.treeGrid.grid.saveCell();break;case"Dependency"+s:this.parent.connectorLineEditModule.removePredecessorByIndex(this.rowData,s);break;case"Auto":case"Manual":this.parent.changeTaskMode(this.rowData);break;case"Indent":this.parent.indent();break;case"Outdent":this.parent.outdent();break;case"Left":case"Right":this.mergeCall(this.item);break;case"SplitTask":this.splitTaskCall(t)}t.type="Content",t.rowData=this.rowData,this.parent.trigger("contextMenuClick",t)},t.prototype.splitTaskCall=function(t){var i=this;this.isEdit=!0;var r=this.parent.taskFields,a=this.getClickedDate(t.element);(0,e.isNullOrUndefined)(this.parent.timelineSettings.bottomTier)&&"Hour"!==this.parent.timelineSettings.bottomTier.unit&&a.setHours(0,0,0,0);var n={rowData:this.rowData,requestType:"splitTaskbar",splitDate:a,cancel:!1,target:this.targetElement};this.parent.trigger("actionBegin",n,(function(t){(0,e.isNullOrUndefined)(i.parent.loadingIndicator)||"Shimmer"!==i.parent.loadingIndicator.indicatorType?i.parent.showSpinner():i.parent.showMaskRow(),i.parent.chartRowsModule.splitTask(i.rowData[r.id],a),i.parent.chartRowsModule.updateSegment(i.rowData.ganttProperties.segments,i.rowData.ganttProperties.taskId),i.parent.projectEndDate>=i.rowData.ganttProperties.endDate&&i.parent.nextTimeSpan()}))},t.prototype.mergeCall=function(t){var i=this;this.isEdit=!0;var r=this.parent.taskFields,a=this.rowData.ganttProperties.segments,n=[{firstSegmentIndex:"Right"===t?this.segmentIndex:a[this.segmentIndex-1].segmentIndex,secondSegmentIndex:"Left"===t?this.segmentIndex:a[this.segmentIndex+1].segmentIndex}],s={rowData:this.rowData,mergeSegmentIndexes:n,requestType:"mergeSegment",cancel:!1,target:this.targetElement};this.parent.trigger("actionBegin",s,(function(t){(0,e.isNullOrUndefined)(i.parent.loadingIndicator)||"Shimmer"!==i.parent.loadingIndicator.indicatorType?i.parent.showSpinner():i.parent.showMaskRow(),!1===t.cancel&&i.parent.chartRowsModule.mergeTask(i.rowData[r.id],n)}))},t.prototype.getClickedDate=function(t){var i,r,a;if(this.parent.enableRtl){var n=this.parent.element.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,o=document.documentElement.clientLeft||document.body.clientLeft||0;i=n.left+s-o}else i=this.parent.getOffsetRect(this.parent.element).left;this.parent.enableRtl?(r=Math.abs(i+this.parent.ganttChartModule.chartElement.offsetWidth-this.rowData.ganttProperties.left-this.parent.ganttChartModule.scrollElement.scrollLeft),a=Math.abs(this.clickedPosition-r)):(r=i+this.parent.ganttChartModule.chartElement.offsetLeft+this.rowData.ganttProperties.left-this.parent.ganttChartModule.scrollElement.scrollLeft,a=this.clickedPosition-r);var l=Math.ceil(a/this.parent.perDayWidth),d=this.rowData.ganttProperties.startDate;return(0,e.isNullOrUndefined)(this.parent.timelineSettings.bottomTier)||"Hour"!==this.parent.timelineSettings.bottomTier.unit||(l=Math.ceil(a/this.parent.timelineSettings.timelineUnitSize),l-=1),this.parent.dataOperation.getEndDate(d,l,l>1?this.rowData.ganttProperties.durationUnit:"None"!==this.parent.timelineSettings.bottomTier.unit?this.parent.timelineSettings.bottomTier.unit.toLocaleLowerCase():this.parent.timelineSettings.topTier.unit.toLocaleLowerCase(),this.rowData,!1)},t.prototype.contextMenuBeforeOpen=function(t){var i=this,a=t.event?t.event.target:this.parent.focusModule?this.parent.ganttChartModule.targetElement:this.parent.focusModule.getActiveElement();(!(0,e.isNullOrUndefined)(this.parent.editModule)&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit&&a.parentElement.classList.contains("e-row")||a.parentElement.classList.contains("e-treecolumn-container"))&&this.parent.treeGrid.closeEdit(),(0,e.isNullOrUndefined)(t.element)||t.element.id!==this.parent.element.id+"_contextmenu"||(this.clickedPosition=(0,e.getValue)("event",t).clientX);var n=(0,e.closest)(a,".e-gantt-child-taskbar");n&&(this.targetElement=t.target=n),t.gridRow=(0,e.closest)(a,".e-row"),t.chartRow=(0,e.closest)(a,".e-chart-row");var s=(0,e.closest)(a,".e-gantt");if(!(0,e.closest)(a,Fe)&&this.parent.editModule&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit&&this.parent.editModule.dialogModule.dialogObj&&!this.parent.editModule.dialogModule.dialogObj.open&&(this.parent.treeGrid.grid.saveCell(),this.parent.editModule.cellEditModule.isCellEdit=!1),this.parent.readOnly&&this.contextMenu.enableItems(["Add","Save","Convert","Delete Dependency","Delete Task","TaskMode","Indent","Outdent","SplitTask","MergeTask"],!1),((0,e.isNullOrUndefined)(t.gridRow)&&(0,e.isNullOrUndefined)(t.chartRow)||0===this.contentMenuItems.length)&&(((0,e.isNullOrUndefined)(t.parentItem)||(0,e.isNullOrUndefined)(s))&&(0,e.isNullOrUndefined)((0,e.closest)(a,".e-content"))?t.cancel=!0:t.cancel=!1),!t.cancel){var o=-1;t.gridRow?o=parseInt(t.gridRow.getAttribute("data-rowindex"),0):t.chartRow&&(o=parseInt(t.chartRow.getAttribute("data-rowindex"),0)),this.parent.selectionModule&&this.parent.allowSelection&&!t.parentItem&&!(0,e.isNullOrUndefined)(t.chartRow)&&this.parent.selectionModule.selectRow(o),t.parentItem||(this.rowData=this.parent.updatedRecords[parseInt(o.toString(),10)]);for(var l=0,d=t.items;l<d.length;l++){var h=d[l];h.separator||(!a.classList.contains("e-gantt-unscheduled-taskbar")||h.text!==this.getLocale("splitTask")&&h.text!==this.getLocale("mergeTask")?this.updateItemStatus(h,a,o):this.hideItems.push(h.text))}if(t.rowData=this.rowData,t.type="Content",t.disableItems=this.disableItems,t.hideItems=this.hideItems,t.hideChildItems=[],!(0,e.isNullOrUndefined)(t.rowData)&&0===t.rowData.level&&"ResourceView"===this.parent.viewType)return void(t.cancel=!0);var p=new r.Deferred;return this.parent.trigger("contextMenuOpen",t,(function(e){p.resolve(e),i.hideItems=e.hideItems,i.disableItems=e.disableItems,e.parentItem||e.hideItems.length!==e.items.length||(i.revertItemStatus(),e.cancel=!0),i.hideItems.length>0&&i.contextMenu.hideItems(i.hideItems),i.disableItems.length>0&&i.contextMenu.enableItems(i.disableItems,!1),t.hideChildItems.length>0&&i.contextMenu.hideItems(t.hideChildItems)})),p}},t.prototype.updateItemStatus=function(t,i,r){var a=this.getKeyFromId(t.id),n=(0,e.closest)(i,Fe),s=[],o=(0,e.closest)(i,".e-gantt-child-taskbar")||(0,e.closest)(i,"e-taskbar-right-resizer")||(0,e.closest)(i,"e-taskbar-left-resizer");if(n)"Save"!==a&&"Cancel"!==a&&this.hideItems.push(t.text);else switch(a){case"TaskInformation":this.parent.editSettings.allowEditing&&this.parent.editModule||this.updateItemVisibility(t.text),0===this.parent.flatData.length&&this.hideItems.push(t.text);break;case"Add":this.parent.editSettings.allowAdding&&this.parent.editModule||this.updateItemVisibility(t.text);break;case"Save":case"Cancel":this.hideItems.push(t.text);break;case"Convert":!(0,e.isNullOrUndefined)(this.rowData)&&this.rowData.hasChildRecords?this.hideItems.push(t.text):this.parent.editSettings.allowEditing&&this.parent.editModule?((0,e.isNullOrUndefined)(this.rowData)||this.rowData.ganttProperties.isMilestone?s.push(this.createItemModel(Ee,"ToTask",this.getLocale("toTask"))):s.push(this.createItemModel(Ee,"ToMilestone",this.getLocale("toMilestone"))),t.items=s):this.updateItemVisibility(t.text),0===this.parent.flatData.length&&this.hideItems.push(t.text);break;case"DeleteDependency":var l=this.getPredecessorsItems();(0,e.isNullOrUndefined)(this.rowData)||!this.rowData.hasChildRecords||this.parent.allowParentDependency?this.parent.editSettings.allowDeleting&&0!==l.length&&this.parent.editModule?l.length>0&&(t.items=l):this.updateItemVisibility(t.text):this.hideItems.push(t.text);break;case"DeleteTask":this.parent.editSettings.allowDeleting&&this.parent.editModule||this.updateItemVisibility(t.text),0===this.parent.flatData.length&&this.hideItems.push(t.text);break;case"TaskMode":"Custom"!==this.parent.taskMode?this.updateItemVisibility(t.text):(this.rowData.ganttProperties.isAutoSchedule?s.push(this.createItemModel(Ee,"Manual",this.getLocale("manual"))):s.push(this.createItemModel(Ee,"Auto",this.getLocale("auto"))),t.items=s);break;case"Indent":if(this.parent.allowSelection&&this.parent.editModule&&this.parent.editSettings){var d=this.parent.selectedRowIndex,h=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length),p=this.parent.updatedRecords[this.parent.selectionModule.getSelectedRowIndexes()[0]-1];this.parent.editSettings.allowEditing&&0!==d&&-1!==d&&h&&"ResourceView"!==this.parent.viewType&&this.parent.updatedRecords[parseInt(d.toString(),10)].level-p.level!=1||this.updateItemVisibility(t.text)}else this.hideItems.push(t.text);break;case"Outdent":if(this.parent.allowSelection&&this.parent.editModule&&this.parent.editSettings){var u=this.parent.selectionModule.getSelectedRowIndexes()[0],c=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length);this.parent.editSettings.allowEditing&&-1!==u&&0!==u&&c&&"ResourceView"!==this.parent.viewType&&0!==this.parent.updatedRecords[parseInt(u.toString(),10)].level||this.updateItemVisibility(t.text)}else this.hideItems.push(t.text);break;case"SplitTask":var g=this.parent.taskFields;(this.parent.readOnly||!o||(0,e.isNullOrUndefined)(g.segments)||this.parent.currentViewData[parseInt(r.toString(),10)].hasChildRecords)&&this.updateItemVisibility(t.text);break;case"MergeTask":this.parent.readOnly||!o?this.updateItemVisibility(t.text):this.mergeItemVisiblity(i,t)}},t.prototype.mergeItemVisiblity=function(t,i){var r=[],a=this.parent.taskFields,n=this.getClickedDate(t);this.segmentIndex=this.parent.chartRowsModule.getSegmentIndex(n,this.rowData);var s=this.rowData.ganttProperties.segments;!(0,e.isNullOrUndefined)(s)&&s.length>0?(0,e.isNullOrUndefined)(a.segments)&&-1===this.segmentIndex?this.updateItemVisibility(i.text):(0===this.segmentIndex?r.push(this.createItemModel(Ee,"Right",this.getLocale("right"))):(this.segmentIndex===s.length-1||r.push(this.createItemModel(Ee,"Right",this.getLocale("right"))),r.push(this.createItemModel(Ee,"Left",this.getLocale("left")))),i.items=r):this.hideItems.push(i.text)},t.prototype.updateItemVisibility=function(t){!!(0,e.isNullOrUndefined)(this.parent.contextMenuItems)?this.hideItems.push(t):this.disableItems.push(t)},t.prototype.contextMenuOpen=function(t){this.isOpen=!0;var i=this.parent.args=t.element.querySelectorAll("li:not(.e-menu-hide):not(.e-disabled)")[0];(0,e.isNullOrUndefined)(i)||(0,e.addClass)([i],"e-focused")},t.prototype.getMenuItems=function(){for(var t=0,i=(0,e.isNullOrUndefined)(this.parent.contextMenuItems)?this.getDefaultItems():this.parent.contextMenuItems;t<i.length;t++){var r=i[t];"string"==typeof r&&-1!==this.getDefaultItems().indexOf(r)?this.buildDefaultItems(r):"string"!=typeof r&&(-1!==this.getDefaultItems().indexOf(r.text)?this.buildDefaultItems(r.text,r.iconCss):".e-gridheader"===r.target?this.headerMenuItems.push(r):this.contentMenuItems.push(r))}return this.contentMenuItems},t.prototype.createItemModel=function(e,t,i,r){return{text:i,id:this.generateID(t),target:e,iconCss:r?"e-icons "+r:null}},t.prototype.getLocale=function(e){return this.parent.localeObj.getConstant(e)},t.prototype.buildDefaultItems=function(e,t){var i;switch(e){case"AutoFitAll":case"AutoFit":case"SortAscending":case"SortDescending":this.headerMenuItems.push(e);break;case"TaskInformation":i=this.createItemModel(Ee,e,this.getLocale("taskInformation"),this.getIconCSS(Ue,t));break;case"Indent":i=this.createItemModel(Ee,e,this.getLocale("indent"),this.getIconCSS("e-indent",t));break;case"Outdent":i=this.createItemModel(Ee,e,this.getLocale("outdent"),this.getIconCSS("e-outdent",t));break;case"Save":i=this.createItemModel(Ue,e,this.getLocale("save"),this.getIconCSS("e-save",t));break;case"Cancel":i=this.createItemModel(Ue,e,this.getLocale("cancel"),this.getIconCSS("e-cancel",t));break;case"Add":(i=this.createItemModel(Ee,e,this.getLocale("add"),this.getIconCSS("e-add",t))).items=[],i.items.push(this.createItemModel(Ee,"Above",this.getLocale("above"),this.getIconCSS("e-add-above",t))),i.items.push(this.createItemModel(Ee,"Below",this.getLocale("below"),this.getIconCSS("e-add-below",t))),"ResourceView"!==this.parent.viewType&&i.items.push(this.createItemModel(Ee,"Child",this.getLocale("child"))),i.items.push(this.createItemModel(Ee,"Milestone",this.getLocale("milestone")));break;case"DeleteTask":i=this.createItemModel(Ee,e,this.getLocale("deleteTask"),this.getIconCSS("e-delete",t));break;case"DeleteDependency":(i=this.createItemModel(Ee,e,this.getLocale("deleteDependency"))).items=[],i.items.push({});break;case"Convert":(i=this.createItemModel(Ee,e,this.getLocale("convert"))).items=[],i.items.push({});break;case"TaskMode":(i=this.createItemModel(Ee,e,this.getLocale("changeScheduleMode"))).items=[],i.items.push({});break;case"SplitTask":i=this.createItemModel(Ee,e,this.getLocale("splitTask"));break;case"MergeTask":(i=this.createItemModel(Ee,e,this.getLocale("mergeTask"))).items=[],i.items.push({})}i&&this.contentMenuItems.push(i)},t.prototype.getIconCSS=function(t,i){return(0,e.isNullOrUndefined)(i)?t:i},t.prototype.getPredecessorsItems=function(){this.predecessors=this.parent.predecessorModule.getValidPredecessor(this.rowData);for(var e,t=[],i=0,r=0,a=this.predecessors;r<a.length;r++){var n=a[r],s=this.parent.getRecordByID(n.from).ganttProperties,o=s.rowUniqueID+" - "+s.taskName,l="Dependency"+i++;e=this.createItemModel(Ee,l,o),t.push(e)}return t},t.prototype.getDefaultItems=function(){return["AutoFitAll","AutoFit","TaskInformation","DeleteTask","Save","Cancel","SortAscending","SortDescending","Add","DeleteDependency","Convert","TaskMode","Indent","Outdent","SplitTask","MergeTask"]},t.prototype.getModuleName=function(){return"contextMenu"},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiate-contextMenu",this.render),this.parent.off("reRender-contextMenu",this.reRenderContextMenu),this.parent.off("contextMenuClick",this.contextMenuItemClick),this.parent.off("contextMenuOpen",this.contextMenuOpen))},t.prototype.contextMenuOnClose=function(e){e.items.length>0&&e.items[0].parentObj instanceof vi.ContextMenu&&this.revertItemStatus()},t.prototype.revertItemStatus=function(){this.contextMenu.showItems(this.hideItems),this.contextMenu.enableItems(this.disableItems),this.hideItems=[],this.disableItems=[],this.isOpen=!1},t.prototype.resetItems=function(){this.hideItems=[],this.disableItems=[],this.headerMenuItems=[],this.contentMenuItems=[],this.item=null},t.prototype.generateID=function(e){return this.ganttID+"_contextMenu_"+e},t.prototype.getKeyFromId=function(e){var t=this.ganttID+"_contextMenu_";return e.indexOf(t)>-1?e.replace(t,""):"Custom"},t.prototype.destroy=function(){this.contextMenu.destroy(),(0,e.remove)(this.element),this.removeEventListener(),this.contextMenu=null,this.element=null},t}(),qi=function(){function t(e){this.parent=e,_e.TreeGrid.Inject(_e.ExcelExport),this.parent.treeGrid.allowExcelExport=this.parent.allowExcelExport,this.bindEvents()}return t.prototype.getModuleName=function(){return"excelExport"},t.prototype.destroy=function(){},t.prototype.bindEvents=function(){var t=this;this.parent.treeGrid.beforeExcelExport=function(i){t.parent.trigger("beforeExcelExport",i),(0,e.isNullOrUndefined)(t.parent.loadingIndicator)||"Shimmer"!==t.parent.loadingIndicator.indicatorType?t.parent.showSpinner():t.parent.showMaskRow()},this.parent.treeGrid.excelQueryCellInfo=function(e){t.parent.trigger("excelQueryCellInfo",e)},this.parent.treeGrid.excelHeaderQueryCellInfo=function(e){t.parent.trigger("excelHeaderQueryCellInfo",e)},this.parent.treeGrid.excelExportComplete=function(i){t.parent.trigger("excelExportComplete",i),(0,e.isNullOrUndefined)(t.parent.loadingIndicator)||"Shimmer"!==t.parent.loadingIndicator.indicatorType?t.parent.hideSpinner():t.parent.hideMaskRow()}},t}(),_i=function(){function e(e){_e.TreeGrid.Inject(_e.ColumnMenu),this.parent=e}return e.prototype.getColumnMenu=function(){return this.parent.treeGrid.columnMenuModule.getColumnMenu()},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"columnMenu"},e}(),Zi=function(){function t(e){this.isTest=!1,this.updateParentRecords=[],this.isaddtoBottom=!1,this.updateCollection={},this.isSharedTask=!1,this.canDrop=!0,this.parent=e,_e.TreeGrid.Inject(_e.RowDD),this.parent.treeGrid.allowRowDragAndDrop=this.parent.allowRowDragAndDrop,this.bindEvents()}return t.prototype.getModuleName=function(){return"rowDragAndDrop"},t.prototype.destroy=function(){},t.prototype.bindEvents=function(){this.parent.treeGrid.rowDragStart=this.rowDragStart.bind(this),this.parent.treeGrid.rowDragStartHelper=this.rowDragStartHelper.bind(this),this.parent.treeGrid.rowDrag=this.rowDrag.bind(this),this.parent.treeGrid.rowDrop=this.rowDrop.bind(this)},t.prototype.rowDragStart=function(e){this.parent.trigger("rowDragStart",e),this.parent.element.style.position="relative"},t.prototype.addErrorElem=function(){var t=document.getElementsByClassName("e-ganttdrag")[0];if(!t.querySelectorAll(".e-errorelem").length){var i=document.createElement("div");(0,e.classList)(i,["e-errorcontainer"],[]),(0,e.classList)(i,["e-icons","e-errorelem"],[]);var r=t.querySelector(".errorValue"),a=t.querySelector(".e-rowcell").innerHTML;r&&(a=r.innerHTML,r.parentNode.removeChild(r)),t.querySelector(".e-rowcell").innerHTML="";var n=document.createElement("span");n.className="errorValue",n.style.paddingLeft="16px",n.innerHTML=a,t.querySelector(".e-rowcell").appendChild(i),t.querySelector(".e-rowcell").appendChild(n)}},t.prototype.removeErrorElem=function(){var e=document.querySelector(".e-errorelem");e&&e.remove()},t.prototype.rowDrag=function(t){var i=this.parent.element.querySelector(".e-cloneproperties");i.style.display="none";var r=i.cloneNode(!0);r.classList.add("e-ganttdrag"),r.style.display="",this.parent.element.querySelectorAll(".e-cloneproperties").length<=1?this.parent.element.appendChild(r):document.getElementsByClassName("e-cloneproperties")[0].querySelectorAll(".e-errorelem").length?this.addErrorElem():this.removeErrorElem(),"Both"===this.parent.gridLines&&(0,e.addClass)(this.parent.element.querySelectorAll(".e-ganttdrag .e-rowcell"),["e-bothganttlines"]);var a,n,s=this.parent.element.querySelector(".e-ganttdrag"),o=this.parent.element.getClientRects()[0].top,l=this.parent.element.getClientRects()[0].left;this.parent.isAdaptive?(a=t.originalEvent.event.touches[0].clientX-l,n=t.originalEvent.event.touches[0].clientY-o):(a=(0,e.getValue)("event",t.originalEvent).clientX-l,n=(0,e.getValue)("event",t.originalEvent).clientY-o),s.style.left=a+20+"px",s.style.top=n+20+"px",this.parent.trigger("rowDrag",t)},t.prototype.rowDragStartHelper=function(t){this.parent.trigger("rowDragStartHelper",t),this.parent.readOnly&&(t.cancel=!0),"ResourceView"===this.parent.viewType&&0===(0,e.getValue)("level",t.data[0])&&(t.cancel=!0)},t.prototype.rowDrop=function(t){var i=document.querySelector(".e-ganttdrag");i&&i.remove();var r=(0,e.closest)(t.target,".e-row"),a=r?parseInt(r.getAttribute("data-rowindex"),10):t.dropIndex;t.dropIndex=a,t.dropRecord=this.parent.updatedRecords[t.dropIndex],this.parent.trigger("rowDrop",t),"ResourceView"===this.parent.viewType&&("middleSegment"===t.dropPosition&&(1!==t.dropRecord.level&&t.dropRecord.uniqueID!==(0,e.getValue)("parentItem",t.data[0]).uniqueID||(t.cancel=!0)),"middleSegment"!==t.dropPosition&&(0!==t.dropRecord.level&&(0,e.getValue)("parentItem",t.data[0]).uniqueID!==t.dropRecord.parentItem.uniqueID||(t.cancel=!0))),t.cancel||(t.requestType="beforeDrop",this.parent.trigger("actionBegin",t),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),t.cancel||(this.dropRows(t,!0),t.cancel=!0))},t.prototype.dropRows=function(t,i){if(!this.parent.readOnly){if(this.dropPosition=t.dropPosition,"Invalid"!==t.dropPosition&&this.parent.editModule){var r=this.parent;if(this.droppedRecord=r.updatedRecords[t.dropIndex],this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("RowDragAndDrop")){if(!this.parent.undoRedoModule.isUndoRedoPerformed){this.parent.undoRedoModule.redoEnabled&&(this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection()),!t.target&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.taskBarEditAction?this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=[]:this.parent.undoRedoModule.createUndoCollection();for(var a=[],n=function(e){a.push(s.parent.flatData.filter((function(i){return t.data[e].ganttProperties.taskId===i.ganttProperties.taskId}))[0])},s=this,o=0;o<t.data.length;o++)n(o);var l=(0,e.extend)([],[],a,!0),d={};t.name?d.action="RowDragAndDrop":d.action="TaskbarDragAndDrop",d.beforeDrop=[];var h={};h.dropRecord=(0,e.extend)([],[],[t.dropRecord?t.dropRecord:this.droppedRecord],!0)[0],h.data=(0,e.extend)([],[],t.data,!0),"middleSegment"===t.dropPosition?h.dropPosition="child":"topSegment"===t.dropPosition?h.dropPosition="above":"bottomSegment"===t.dropPosition&&(h.dropPosition="below"),d.afterDrop=h,this.parent.undoRedoModule.findPosition(l,d,"beforeDrop"),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=d}this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0)}var p=void 0,u=[],c=this.droppedRecord;t.data[0]?u=t.data:u.push(t.data);var g=0,f=u.length,m=function(t){if(y.parent.isOnEdit=!0,p=u[t],y.draggedRecord=p,"Invalid"!==y.dropPosition){if("ResourceView"===y.parent.viewType&&(y.checkisSharedTask(),y.previousParent=y.draggedRecord.parentItem.uniqueID),y.isSharedTask)return{value:void 0};i&&y.deleteDragRow();var a=y.treeGridData.indexOf(c);if("topSegment"===y.dropPosition&&y.dropAtTop(a),"bottomSegment"===y.dropPosition&&!y.isSharedTask){if(c.hasChildRecords){if(g=y.parent.editModule.getChildCount(c,0),y.parent.taskFields.parentID&&y.ganttData.length>0&&y.ganttData.splice(a+g+1,0,y.draggedRecord.taskData),y.treeGridData.splice(a+g+1,0,y.draggedRecord),y.parent.ids.splice(a+g+1,0,y.draggedRecord.ganttProperties.rowUniqueID.toString()),"ResourceView"===y.parent.viewType){var n=0===y.draggedRecord.level?"R"+y.draggedRecord.ganttProperties.taskId:"T"+y.draggedRecord.ganttProperties.taskId;y.parent.getTaskIds().splice(a+g+1,0,n)}}else if(y.parent.taskFields.parentID&&y.ganttData.length>0&&y.ganttData.splice(a+1,0,y.draggedRecord.taskData),y.treeGridData.splice(a+1,0,y.draggedRecord),y.parent.ids.splice(a+1,0,y.draggedRecord.ganttProperties.rowUniqueID.toString()),"ResourceView"===y.parent.viewType){var s=0===y.draggedRecord.level?"R"+y.draggedRecord.ganttProperties.taskId:"T"+y.draggedRecord.ganttProperties.taskId;y.parent.getTaskIds().splice(a+1,0,s)}if(y.parent.setRecordValue("parentItem",y.treeGridData[a].parentItem,p),y.parent.setRecordValue("parentUniqueID",y.treeGridData[a].parentUniqueID,p),y.parent.setRecordValue("level",y.treeGridData[a].level,p),p.hasChildRecords){y.updateChildRecordLevel(p,1),y.updateChildRecord(p,a+g+1)}if(c.parentItem){var o=y.parent.getParentTask(c.parentItem).childRecords,l=o.indexOf(c)+1;o.splice(l,0,p)}}if("middleSegment"===y.dropPosition&&(y.dropMiddle(a),c.childRecords.length>0&&(delete c.ganttProperties.segments,delete c.taskData[y.parent.taskFields.segments])),0!==y.treeGridData.length)for(var d=0;d<y.treeGridData.length;d++)if(y.treeGridData[parseInt(d.toString(),10)].index=d,!(0,e.isNullOrUndefined)(y.treeGridData[parseInt(d.toString(),10)].parentItem)){var h=(0,e.getValue)("uniqueIDCollection."+y.treeGridData[parseInt(d.toString(),10)].parentUniqueID,y.parent.treeGrid);y.treeGridData[parseInt(d.toString(),10)].parentItem.index=h.index}(0,e.isNullOrUndefined)(p.parentItem&&-1!==y.updateParentRecords.indexOf(p.parentItem))||y.updateParentRecords.push(p.parentItem)}if(!y.parent.enableVirtualization){var f=r.flatData,m=void 0,D=void 0,v=y.parent.dataSource,k=y.parent.taskFields.id;if(p.index<c.index){m=p.index;for(var w=function(e){var t=y.parent.currentViewData.filter((function(t){return t[k]===v[e][k]}))[0];if(t&&t.index>c.index)return D=t.index,"break"},b=0;b<v.length;b++){if("break"===w(b))break}}else{m=c.index;for(var T=function(e){var t=y.parent.currentViewData.filter((function(t){return t[k]===v[e][k]}))[0];if(t&&t.index>p.index)return D=t.index,"break"},P=0;P<v.length;P++){if("break"===T(P))break}}for(var S=function(t){if(!(0,e.isNullOrUndefined)(f[t])&&(f[t].index=t,!(0,e.isNullOrUndefined)(f[t].parentItem))){var i=f.filter((function(e){return e.uniqueID===f[t].parentUniqueID}))[0];f[t].parentItem.index=i.index}},C=m;C<=D;C++)S(C)}r.rowDragAndDropModule.refreshDataSource()},y=this;for(o=0;o<f;o++){var D=m(o);if("object"==typeof D)return D.value}if("middleSegment"===this.dropPosition){if(c.ganttProperties.predecessor)for(var v=c.ganttProperties.predecessor.length,k=0;k<v;k++)if(c.ganttProperties.predecessor&&c.ganttProperties.predecessor[k]){var w=this.parent.getRecordByID(c.ganttProperties.predecessor[k].from),b=this.parent.getRecordByID(c.ganttProperties.predecessor[k].to),T=this.parent.connectorLineEditModule.validateParentPredecessor(w,b);if(c.ganttProperties.predecessor&&(!T||!this.parent.allowParentDependency)&&(this.parent.editModule.removePredecessorOnDelete(c),c.ganttProperties.predecessor.splice(0,1),c.ganttProperties.predecessorsName)){var P=c.ganttProperties.predecessorsName.split(",");for(o=0;o<P.length;o++)-1!==P[o].indexOf(p.ganttProperties.taskId+"")&&P.splice(o,1);var S=P.join();c.ganttProperties.predecessorsName=S,c[this.parent.taskFields.dependency]=S,c.taskData[this.parent.taskFields.dependency]=S}}c.ganttProperties.isMilestone&&(this.parent.setRecordValue("isMilestone",!1,c.ganttProperties,!0),(0,e.isNullOrUndefined)(c.taskData[this.parent.taskFields.milestone])||!0===c.taskData[this.parent.taskFields.milestone]&&(c.taskData[this.parent.taskFields.milestone]=!1))}if("ResourceView"===this.parent.viewType&&!this.isSharedTask){var C=void 0;C="middleSegment"===this.dropPosition?this.droppedRecord.uniqueID:this.droppedRecord.parentItem?this.droppedRecord.parentItem.uniqueID:this.droppedRecord.uniqueID;var R=this.parent.getTaskByUniqueID(C),M={};M[this.parent.taskFields.resourceInfo]=[],M[this.parent.taskFields.resourceInfo].push(R.ganttProperties.taskId),this.removeExistingResources();var x=this.parent.dataOperation.setResourceInfo(M),O=this.draggedRecord;(0,e.isNullOrUndefined)(O.ganttProperties.resourceInfo)&&(O.ganttProperties.resourceInfo=[]),"Unassigned Task"===R.ganttProperties.taskName?(O.ganttProperties.resourceInfo=[],O.ganttProperties.sharedTaskUniqueIds=[O.ganttProperties.rowUniqueID]):O.ganttProperties.resourceInfo.push(x[0]),this.updateCurrentTask(O),"Unassigned Task"===R.ganttProperties.taskName?this.deleteSharedResourceTask():this.updateSharedResourceTask()}if(this.parent.taskFields.dependency&&this.parent.allowParentDependency){var I,E=void 0;E=p.parentItem?this.parent.flatData[this.parent.ids.indexOf(p.parentItem.taskId)]:p,I=c.parentItem?this.parent.flatData[this.parent.ids.indexOf(c.parentItem.taskId)]:c;var F=void 0;if(I.uniqueID===E.uniqueID||E.parentItem&&I.uniqueID===this.parent.flatData[this.parent.ids.indexOf(E.parentItem.taskId)].uniqueID){F=this.parent.currentViewData.filter((function(e){if(e.ganttProperties.predecessor&&e.ganttProperties.predecessor.length>0)for(var t=0;t<e.ganttProperties.predecessor.length;t++)return parseInt(e.ganttProperties.predecessor[t].to,10)===parseInt(I.ganttProperties.taskId,10)||parseInt(e.ganttProperties.predecessor[t].from,10)===parseInt(I.ganttProperties.taskId,10);return null}));var U=[];for(o=0;o<F.length;o++){if(U=[],F[o].ganttProperties.predecessor)for(var N=0;N<F[o].ganttProperties.predecessor.length;N++)parseInt(F[o].ganttProperties.taskId,10)!==parseInt(F[o].ganttProperties.predecessor[N].from,10)?U.push(F[o].ganttProperties.predecessor[N].from):U.push(F[o].ganttProperties.predecessor[N].to);for(var L=function(e){var t=U[e].replace(/\D/g,""),i=V.parent.currentViewData.filter((function(e){return parseInt(e.ganttProperties.taskId,10)===parseInt(t,10)}));V.parent.connectorLineEditModule.validateParentPredecessor(F[o],i[0])||(V.parent.dataOperation.resetDependency(F[o]),V.parent.dataOperation.resetDependency(i[0]))},V=this,B=0;B<U.length;B++)L(B)}}}for(B=0;B<this.updateParentRecords.length;B++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[B]);if("ProjectView"===this.parent.viewType&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.predecessorModule&&"TaskbarDragAndDrop"===this.parent.undoRedoModule.currentAction.action&&"child"!==this.parent.undoRedoModule.currentAction.beforeDrop[0].position){var A=this.parent.flatData[this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.afterDrop.dropRecord.ganttProperties.taskId.toString())];this.parent.editModule.taskbarEditModule.taskBarEditRecord=A,this.parent.editModule.taskbarEditModule.taskBarEditAction="ChildDrag",this.parent.predecessorModule.validatePredecessor(A,[],""),this.parent.editModule.taskbarEditModule.taskBarEditAction=null}this.updateParentRecords=[],this.parent.isOnEdit=!1}(0,e.isNullOrUndefined)(this.parent.editModule)||this.parent.editModule.refreshRecord(t,!0),(!this.parent.undoRedoModule||this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)&&(this.parent.previousFlatData=(0,e.extend)([],[],this.parent.flatData,!0))}},t.prototype.updateCurrentTask=function(e){this.parent.dataOperation.updateMappingData(e,"resourceInfo"),this.parent.editModule.updateResourceRelatedFields(e,"resource"),this.parent.editModule.dialogModule.dialogEditValidationFlag=!1,this.parent.editModule.dialogModule.validateDuration(e),this.parent.dataOperation.updateWidthLeft(e),this.parent.dataOperation.updateTaskData(e)},t.prototype.deleteSharedResourceTask=function(){for(var t=0;t<this.parent.getTaskIds().length;t++)this.parent.getTaskIds()[t]==="T"+this.draggedRecord.ganttProperties.taskId&&("Unassigned Task"!==this.parent.getTaskByUniqueID(this.parent.flatData[t].parentItem.uniqueID).ganttProperties.taskName&&this.removeRecords(this.parent.flatData[t]),(0,e.isNullOrUndefined)(this.parent.flatData[parseInt(t.toString(),10)].parentItem&&-1!==this.updateParentRecords.indexOf(this.parent.flatData[parseInt(t.toString(),10)].parentItem))||this.updateParentRecords.push(this.parent.flatData[t].parentItem))},t.prototype.removeExistingResources=function(){var e=this.parent.getTaskByUniqueID(this.previousParent);if(this.draggedRecord.ganttProperties.resourceInfo)for(var t=0;t<this.draggedRecord.ganttProperties.resourceInfo.length;t++)if(this.draggedRecord.ganttProperties.resourceInfo[parseInt(t.toString(),10)][this.parent.resourceFields.id]===e.ganttProperties.taskId){this.draggedRecord.ganttProperties.resourceInfo.splice(t,1);break}},t.prototype.updateSharedResourceTask=function(){for(var t=0;t<this.parent.getTaskIds().length;t++)this.parent.getTaskIds()[t]==="T"+this.draggedRecord.ganttProperties.taskId&&(this.parent.editModule.updateGanttProperties(this.draggedRecord,this.parent.flatData[t]),this.parent.dataOperation.updateTaskData(this.parent.flatData[t]),(0,e.isNullOrUndefined)(this.parent.flatData[parseInt(t.toString(),10)].parentItem&&-1!==this.updateParentRecords.indexOf(this.parent.flatData[parseInt(t.toString(),10)].parentItem))||this.updateParentRecords.push(this.parent.flatData[t].parentItem))},t.prototype._getExistingTaskWithID=function(e){for(var t=[],i=0;i<this.parent.getTaskIds().length;i++)this.parent.getTaskIds()[i]==="T"+e.ganttProperties.taskId&&t.push(this.parent.flatData[i]);return t},t.prototype.removeResourceInfo=function(t){var i=this.parent.getTaskByUniqueID(this.draggedRecord.parentItem.uniqueID);if(t.ganttProperties.resourceInfo&&t.ganttProperties.resourceInfo.length>1){var r=this._getExistingTaskWithID(t),a=void 0;if(null===r)return;for(var n=0;n<r.length;n++)for(var s=(a=r[n]).ganttProperties.resourceInfo,o=0;o<s.length;o++)if(s[o][this.parent.resourceFields.id]===i.ganttProperties.taskId){s.splice(o,1),this.parent.setRecordValue("resourceInfo",s,a.ganttProperties,!0),this.updateCurrentTask(a),(0,e.isNullOrUndefined)(a.parentItem&&-1!==this.updateParentRecords.indexOf(a.parentItem))||this.updateParentRecords.push(a.parentItem);break}}},t.prototype.refreshDataSource=function(){var t,i,a=this.draggedRecord,n=this.droppedRecord,s=this.parent,o=this.parent.taskFields;if((t=this.parent.dataSource instanceof r.DataManager?(0,e.getValue)("dataOperation.dataArray",this.parent):s.dataSource).length>0&&!(0,e.isNullOrUndefined)(n)&&!n.parentItem){for(var l=0;l<Object.keys(t).length;l++)(0,e.isNullOrUndefined)(n.taskData[o.child])||t[l][o.child]!==n.taskData[o.child]?(0,e.isNullOrUndefined)(n.taskData[o.child])&&n.taskData[o.id]===t[l][o.id]&&(i=l):i=l;"topSegment"===this.dropPosition?this.parent.taskFields.parentID||t.splice(i,0,a.taskData):"bottomSegment"===this.dropPosition&&(this.parent.taskFields.parentID||t.splice(i+1,0,a.taskData))}else if(!this.parent.taskFields.parentID&&!(0,e.isNullOrUndefined)(n)&&n.parentItem&&("topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition)){var d="topSegment"===this.dropPosition?"Above":"Below";this.parent.editModule.addRowSelectedItem=n,this.parent.editModule.updateRealDataSource([a],d),delete this.parent.editModule.addRowSelectedItem}if(this.parent.taskFields.parentID)if(a.parentItem){var h="middleSegment"===this.dropPosition?this.parent.taskFields.id:this.parent.taskFields.parentID;a[this.parent.taskFields.parentID]=n[h],a.ganttProperties.parentId=n[h],("ResourceView"===this.parent.viewType&&"middleSegment"!==this.dropPosition||"ProjectView"===this.parent.viewType)&&(a.taskData[this.parent.taskFields.parentID]=n.taskData[h])}else a[this.parent.taskFields.parentID]=null,a.taskData[this.parent.taskFields.parentID]=null,a.ganttProperties.parentId=null;if("ProjectView"===this.parent.viewType&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.predecessorModule&&"TaskbarDragAndDrop"===this.parent.undoRedoModule.currentAction.action){var p=this.parent.flatData[this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.afterDrop.data[0].ganttProperties.taskId.toString())];this.parent.editModule.taskbarEditModule.taskBarEditRecord=p,this.parent.editModule.taskbarEditModule.taskBarEditAction="ChildDrag",this.parent.predecessorModule.validatePredecessor(p,[],""),this.parent.editModule.taskbarEditModule.taskBarEditAction=null}},t.prototype.dropMiddle=function(t){var i=this.parent,r=this.parent.editModule.getChildCount(this.droppedRecord,0),a=(0,e.isNullOrUndefined)(r)||0===r?t+1:r+t+1;if("middleSegment"===this.dropPosition&&!this.isSharedTask){if(i.taskFields.parentID&&this.ganttData.length>0&&this.ganttData.splice(a,0,this.draggedRecord.taskData),this.treeGridData.splice(a,0,this.draggedRecord),this.parent.ids.splice(a,0,this.draggedRecord.ganttProperties.rowUniqueID.toString()),"ResourceView"===this.parent.viewType){var n=0===this.draggedRecord.level?"R"+this.draggedRecord.ganttProperties.taskId:"T"+this.draggedRecord.ganttProperties.taskId;this.parent.getTaskIds().splice(a,0,n)}this.draggedRecord.hasChildRecords&&this.updateChildRecord(this.draggedRecord,a,this.droppedRecord.expanded),this.recordLevel(),(0,e.isNullOrUndefined)(this.draggedRecord.parentItem&&-1!==this.updateParentRecords.indexOf(this.draggedRecord.parentItem))&&this.updateParentRecords.push(this.draggedRecord.parentItem)}},t.prototype.recordLevel=function(){var t=this.parent,i=this.draggedRecord,r=this.droppedRecord,a=t.taskFields.child;if(r.hasChildRecords||(r.hasChildRecords=!0,r.childRecords.length||(r.childRecords=[],!t.taskFields.parentID&&(0,e.isNullOrUndefined)(r.taskData[a])&&(r.taskData[a]=[]))),"middleSegment"===this.dropPosition){var n=(0,e.extend)({},r);delete n.childRecords;var s={uniqueID:n.uniqueID,expanded:n.expanded,level:n.level,index:n.index,taskId:n.ganttProperties.rowUniqueID};if(this.parent.setRecordValue("parentItem",s,i),this.parent.setRecordValue("parentUniqueID",r.uniqueID,i),r.childRecords.splice(r.childRecords.length,0,i),(0,e.isNullOrUndefined)(i)||t.taskFields.parentID||(0,e.isNullOrUndefined)(r.taskData[a])||r.taskData[t.taskFields.child].splice(r.childRecords.length,0,i.taskData),i.hasChildRecords){i.level=r.level+1,this.parent.setRecordValue("level",this.draggedRecord.level,this.draggedRecord),this.updateChildRecordLevel(i,1)}else i.level=r.level+1;r.expanded=!0}},t.prototype.deleteDragRow=function(){var t;this.treeGridData=s(this.parent)?(0,e.getValue)("result",this.parent.treeGrid.dataSource):this.parent.treeGrid.dataSource,this.parent.dataSource instanceof r.DataManager?this.ganttData=(0,e.getValue)("dataOperation.dataArray",this.parent):this.ganttData=s(this.parent)?(0,e.getValue)("result",this.parent.dataSource):this.parent.dataSource,t=this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed?"ProjectView"===this.parent.viewType?this.parent.flatData[this.parent.ids.indexOf(this.draggedRecord.ganttProperties.taskId.toString())]:this.draggedRecord.hasChildRecords?this.parent.flatData["R"+this.parent.taskIds.indexOf(this.draggedRecord.ganttProperties.taskId)]:this.parent.flatData["T"+this.parent.taskIds.indexOf(this.draggedRecord.ganttProperties.taskId)]:this.parent.getTaskByUniqueID(this.draggedRecord.uniqueID),this.removeRecords(t)},t.prototype.checkisSharedTask=function(){this.isSharedTask=!1;for(var e=null,t=0===this.droppedRecord.level?this.droppedRecord.uniqueID:this.droppedRecord.parentItem.uniqueID,i=this.parent.getTaskByUniqueID(t).childRecords,r=0;r<i.length;r++)"T"+this.draggedRecord.ganttProperties.taskId=="T"+i[r].ganttProperties.taskId&&(this.isSharedTask=!0,e=i[r]);this.isSharedTask&&this.removeResourceInfo(e)},t.prototype.dropAtTop=function(t){var i=this.parent;if(!this.isSharedTask){if(i.taskFields.parentID&&this.ganttData.length>0&&this.ganttData.splice(t,0,this.draggedRecord.taskData),this.treeGridData.splice(t,0,this.draggedRecord),this.parent.ids.splice(t,0,this.draggedRecord.ganttProperties.rowUniqueID.toString()),this.parent.setRecordValue("parentItem",this.droppedRecord.parentItem,this.draggedRecord),this.parent.setRecordValue("parentUniqueID",this.droppedRecord.parentUniqueID,this.draggedRecord),this.parent.setRecordValue("level",this.droppedRecord.level,this.draggedRecord),"ResourceView"===this.parent.viewType){var r=0===this.draggedRecord.level?"R"+this.draggedRecord.ganttProperties.taskId:"T"+this.draggedRecord.ganttProperties.taskId;this.parent.getTaskIds().splice(t,0,r)}if(this.draggedRecord.hasChildRecords){this.updateChildRecord(this.draggedRecord,t),this.updateChildRecordLevel(this.draggedRecord,1)}if(this.droppedRecord.parentItem){var a=this.parent.getParentTask(this.droppedRecord.parentItem).childRecords,n=a.indexOf(this.droppedRecord);a.splice(n,0,this.draggedRecord)}(0,e.isNullOrUndefined)(this.draggedRecord.parentItem&&-1!==this.updateParentRecords.indexOf(this.draggedRecord.parentItem))||this.updateParentRecords.push(this.draggedRecord.parentItem)}},t.prototype.updateChildRecordLevel=function(e,t){var i,r;if(t++,!e.hasChildRecords)return 0;i=e.childRecords.length;for(var a=0;a<i;a++){r=e.childRecords[a];var n=void 0;if(e.parentItem){n=this.parent.treeGrid.uniqueIDCollection[e.parentItem.uniqueID]}r.level=e.parentItem?n.level+t:e.level+1,this.parent.setRecordValue("level",r.level,r),r.hasChildRecords&&(t--,t=this.updateChildRecordLevel(r,t))}return t},t.prototype.updateChildRecord=function(e,t,i){var r,a,n=this.parent;if(!e.hasChildRecords)return 0;a=e.childRecords.length;for(var s=0;s<a;s++)r=e.childRecords[s],t++,n.flatData.splice(t,0,r),this.parent.ids.splice(t,0,r.ganttProperties.rowUniqueID.toString()),n.taskFields.parentID&&n.dataSource.length>0&&this.ganttData.splice(t,0,r.taskData),r.hasChildRecords&&(t=this.updateChildRecord(r,t));return t},t.prototype.removeRecords=function(t){var i,a=this.parent;i=this.parent.dataSource instanceof r.DataManager?(0,e.getValue)("dataOperation.dataArray",this.parent):this.parent.dataSource;var n=t,s=n.parentItem?this.parent.getParentTask(n.parentItem):null;if(n){if(n.parentItem){var o=s?s.childRecords:[],l=0;o&&o.length>0&&("ResourceView"===this.parent.viewType&&1===o.length&&(this.parent.isOnDelete=!0,o[0].isDelete=!0,this.parent.dataOperation.updateParentItems(s),this.parent.isOnDelete=!1,o[0].isDelete=!1),l=o.indexOf(n),s.childRecords.splice(l,1),!this.parent.taskFields.parentID&&s.taskData[this.parent.taskFields.child]&&s.taskData[this.parent.taskFields.child].splice(l,1),this.updateParentRecords.push(s))}if(!this.parent.taskFields.parentID){var d=[];d.push(n.ganttProperties.taskId.toString()),("ProjectView"===this.parent.viewType||"ResourceView"===this.parent.viewType&&"middleSegment"!==this.dropPosition)&&this.parent.editModule.removeFromDataSource(d)}if(a.taskFields.parentID){n.hasChildRecords&&n.childRecords.length>0&&this.removeChildItem(n);for(var h=void 0,p=i.length>0&&"ResourceView"!==this.parent.viewType?i:this.parent.updatedRecords,u=0;u<p.length;u++)"ResourceView"===this.parent.viewType?p[u].ganttProperties.rowUniqueID===n.ganttProperties.rowUniqueID&&(h=u):p[u][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(h=u);if(-1!==h){i.length>0&&i.splice(h,1);var c=this.treeGridData.indexOf(n);this.treeGridData.splice(c,1),this.parent.ids.splice(c,1),-1!==this.parent.treeGrid.parentData.indexOf(n)&&this.parent.treeGrid.parentData.splice(this.parent.treeGrid.parentData.indexOf(n),1),"ResourceView"===this.parent.viewType&&this.parent.getTaskIds().splice(h,1)}}var g=this.treeGridData.indexOf(n);if(!a.taskFields.parentID){var f=this.parent.editModule.getChildCount(n,0);this.treeGridData.splice(g,f+1),this.parent.ids.splice(g,f+1);var m=this.ganttData.indexOf(n.taskData);-1!==m&&(this.ganttData.splice(m,1),this.parent.treeGrid.parentData.splice(m,1)),"ResourceView"===this.parent.viewType&&this.parent.getTaskIds().splice(g,f+1)}n.parentItem&&s&&s.childRecords&&!s.childRecords.length&&(s.expanded=!1,s.hasChildRecords=!1)}},t.prototype.removeChildItem=function(t){for(var i,a,n=0;n<t.childRecords.length;n++){i=t.childRecords[n];var s=void 0;s=this.parent.dataSource instanceof r.DataManager?(0,e.getValue)("dataOperation.dataArray",this.parent):this.parent.dataSource;for(var o=0;o<s.length;o++)s[o][this.parent.taskFields.id]===i.taskData[this.parent.taskFields.id]&&(a=o);if(-1!==a){s.length>0&&s.splice(a,1);var l=this.treeGridData.indexOf(i);this.treeGridData.splice(l,1),this.parent.ids.splice(l,1),"ResourceView"===this.parent.viewType&&this.parent.getTaskIds().splice(a,1)}i.hasChildRecords&&this.removeChildItem(i)}},t.prototype.reorderRows=function(t,i,r){if(!this.parent.readOnly){t[0],"above"===r&&(this.dropPosition="topSegment"),"below"===r&&(this.dropPosition="bottomSegment"),"child"===r&&(this.dropPosition="middleSegment");var a=void 0;this.parent.undoRedoModule&&(a=(0,e.extend)([],[],[this.parent.undoRedoModule.currentAction],!0)[0]);for(var n=[],s=0;s<t.length;s++)this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&("RowDragAndDrop"===a.action||"TaskbarDragAndDrop"===a.action)?n[s]=a.beforeDrop[s].data:n[s]=this.parent.flatData[t[s]];var o={data:n,dropIndex:i,dropPosition:this.dropPosition};this.dropRows(o,!0)}},t}(),Xi=m(461),Yi=function(){function e(e){this.theme=e,this.ganttStyle={},this.setTheme(this.ganttStyle,this.theme)}return Object.defineProperty(e.prototype,"style",{get:function(){return this.ganttStyle},enumerable:!0,configurable:!0}),e.prototype.setTheme=function(e,t){switch(this.initStyles(e),e.columnHeader.fontSize=9.5,e.columnHeader.fontColor=new Xi.PdfColor(0,0,0),e.columnHeader.fontColor.gray=.2,e.columnHeader.backgroundColor=new Xi.PdfColor(255,255,255),e.columnHeader.borderColor=new Xi.PdfColor(234,234,234),e.columnHeader.format.lineAlignment=1,e.columnHeader.format.alignment=0,e.fontFamily=Xi.PdfFontFamily.Helvetica,e.cell.fontSize=9.5,e.cell.backgroundColor=new Xi.PdfColor(255,255,255),e.cell.borderColor=new Xi.PdfColor(234,234,234),e.cell.fontColor=new Xi.PdfColor(0,0,0),e.cell.fontColor.gray=.2,e.cell.format.lineAlignment=1,e.cell.format.alignment=0,e.footer.fontSize=9.5,e.footer.fontStyle=0,e.footer.format.alignment=1,e.footer.format.lineAlignment=1,e.timeline.fontSize=9.5,e.timeline.fontStyle=0,e.timeline.backgroundColor=new Xi.PdfColor(252,252,252),e.timeline.fontColor=new Xi.PdfColor(40,40,39),e.chartGridLineColor=new Xi.PdfColor(206,206,206),e.timeline.borderColor=new Xi.PdfColor(206,206,206),t){case"Bootstrap":e.taskbar.taskColor=new Xi.PdfColor(49,122,185),e.taskbar.progressColor=new Xi.PdfColor(33,82,125),e.taskbar.criticalTaskColor=new Xi.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new Xi.PdfColor(255,85,85),e.taskbar.baselineColor=new Xi.PdfColor(240,173,78),e.taskbar.baselineBorderColor=new Xi.PdfColor(240,173,78),e.criticalConnectorLineColor=new Xi.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new Xi.PdfColor(255,85,85),e.taskbar.parentTaskColor=new Xi.PdfColor(119,119,119),e.taskbar.parentProgressColor=new Xi.PdfColor(85,85,85),e.taskbar.taskBorderColor=new Xi.PdfColor(33,82,125),e.taskbar.parentTaskBorderColor=new Xi.PdfColor(85,85,85),e.taskbar.milestoneColor=new Xi.PdfColor(85,85,85),e.footer.fontColor=new Xi.PdfColor(0,0,0),e.footer.fontColor.gray=.2,e.connectorLineColor=new Xi.PdfColor(33,82,125),e.footer.backgroundColor=new Xi.PdfColor(255,255,255),e.taskbar.progressFontColor=new Xi.PdfColor(255,255,255),e.label.fontColor=new Xi.PdfColor(0,0,0),e.taskbar.splitLineBackground=new Xi.PdfColor(51,51,51),e.taskbar.unscheduledTaskBarColor=new Xi.PdfColor(49,122,185),e.taskbar.manualParentBackground=new Xi.PdfColor(119,119,119),e.taskbar.manualParentProgress=new Xi.PdfColor(85,85,85),e.taskbar.manualChildBackground=new Xi.PdfColor(117,56,201),e.taskbar.manualChildProgress=new Xi.PdfColor(87,42,150),e.taskbar.manualLineColor=new Xi.PdfColor(152,154,156),e.taskbar.manualParentBorder=new Xi.PdfColor(85,85,85),e.taskbar.manualChildBorder=new Xi.PdfColor(87,42,150);break;case"Bootstrap 4":e.taskbar.taskColor=new Xi.PdfColor(0,123,255),e.taskbar.progressColor=new Xi.PdfColor(0,86,179),e.taskbar.criticalTaskColor=new Xi.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new Xi.PdfColor(255,85,85),e.taskbar.baselineColor=new Xi.PdfColor(255,193,7),e.taskbar.baselineBorderColor=new Xi.PdfColor(255,193,7),e.criticalConnectorLineColor=new Xi.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new Xi.PdfColor(255,85,85),e.taskbar.parentTaskColor=new Xi.PdfColor(108,117,125),e.taskbar.parentProgressColor=new Xi.PdfColor(73,80,87),e.taskbar.taskBorderColor=new Xi.PdfColor(0,86,179),e.taskbar.parentTaskBorderColor=new Xi.PdfColor(73,80,87),e.taskbar.milestoneColor=new Xi.PdfColor(73,80,87),e.footer.fontColor=new Xi.PdfColor(0,0,0),e.footer.fontColor.gray=.2,e.connectorLineColor=new Xi.PdfColor(0,86,179),e.footer.backgroundColor=new Xi.PdfColor(255,255,255),e.taskbar.progressFontColor=new Xi.PdfColor(255,255,255),e.label.fontColor=new Xi.PdfColor(33,37,41),e.taskbar.splitLineBackground=new Xi.PdfColor(0,0,0),e.taskbar.unscheduledTaskBarColor=new Xi.PdfColor(0,123,255),e.taskbar.manualParentBackground=new Xi.PdfColor(108,117,125),e.taskbar.manualParentProgress=new Xi.PdfColor(73,80,87),e.taskbar.manualChildBackground=new Xi.PdfColor(133,83,241),e.taskbar.manualChildProgress=new Xi.PdfColor(102,40,238),e.taskbar.manualLineColor=new Xi.PdfColor(152,154,156),e.taskbar.manualParentBorder=new Xi.PdfColor(73,80,87),e.taskbar.manualChildBorder=new Xi.PdfColor(102,40,238);break;case"Fabric":e.columnHeader.fontColor=new Xi.PdfColor(102,102,102),e.cell.fontColor=new Xi.PdfColor(51,51,51),e.taskbar.taskColor=new Xi.PdfColor(0,120,214),e.taskbar.progressColor=new Xi.PdfColor(0,91,163),e.taskbar.criticalTaskColor=new Xi.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new Xi.PdfColor(255,85,85),e.taskbar.baselineColor=new Xi.PdfColor(216,59,1),e.taskbar.baselineBorderColor=new Xi.PdfColor(216,59,1),e.criticalConnectorLineColor=new Xi.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new Xi.PdfColor(255,85,85),e.taskbar.parentTaskColor=new Xi.PdfColor(118,118,118),e.taskbar.parentProgressColor=new Xi.PdfColor(80,80,80),e.taskbar.taskBorderColor=new Xi.PdfColor(0,91,163),e.taskbar.parentTaskBorderColor=new Xi.PdfColor(80,80,80),e.taskbar.milestoneColor=new Xi.PdfColor(80,80,80),e.footer.fontColor=new Xi.PdfColor(51,51,51),e.footer.fontColor.gray=.2,e.connectorLineColor=new Xi.PdfColor(0,69,122),e.footer.backgroundColor=new Xi.PdfColor(255,255,255),e.taskbar.progressFontColor=new Xi.PdfColor(255,255,255),e.label.fontColor=new Xi.PdfColor(51,51,51),e.taskbar.splitLineBackground=new Xi.PdfColor(0,0,0),e.taskbar.unscheduledTaskBarColor=new Xi.PdfColor(0,120,214),e.taskbar.manualParentBackground=new Xi.PdfColor(118,118,118),e.taskbar.manualParentProgress=new Xi.PdfColor(80,80,80),e.taskbar.manualChildBackground=new Xi.PdfColor(154,56,186),e.taskbar.manualChildProgress=new Xi.PdfColor(109,24,136),e.taskbar.manualLineColor=new Xi.PdfColor(152,154,156),e.taskbar.manualParentBorder=new Xi.PdfColor(80,80,80),e.taskbar.manualChildBorder=new Xi.PdfColor(109,24,136);break;default:e.taskbar.taskColor=new Xi.PdfColor(88,105,197),e.taskbar.progressColor=new Xi.PdfColor(63,81,181),e.taskbar.criticalTaskColor=new Xi.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new Xi.PdfColor(255,85,85),e.taskbar.baselineColor=new Xi.PdfColor(193,87,0),e.taskbar.baselineBorderColor=new Xi.PdfColor(193,87,0),e.criticalConnectorLineColor=new Xi.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new Xi.PdfColor(255,85,85),e.taskbar.parentTaskColor=new Xi.PdfColor(132,132,132),e.taskbar.parentProgressColor=new Xi.PdfColor(97,97,97),e.taskbar.taskBorderColor=new Xi.PdfColor(63,81,181),e.taskbar.parentTaskBorderColor=new Xi.PdfColor(51,51,51),e.taskbar.milestoneColor=new Xi.PdfColor(97,97,97),e.footer.fontColor=new Xi.PdfColor(0,0,0),e.footer.fontColor.gray=.2,e.connectorLineColor=new Xi.PdfColor(63,81,181),e.footer.backgroundColor=new Xi.PdfColor(255,255,255),e.taskbar.progressFontColor=new Xi.PdfColor(255,255,255),e.label.fontColor=new Xi.PdfColor(51,51,51),e.taskbar.splitLineBackground=new Xi.PdfColor(0,0,0),e.taskbar.unscheduledTaskBarColor=new Xi.PdfColor(63,81,181),e.taskbar.manualParentBackground=new Xi.PdfColor(97,97,97),e.taskbar.manualParentProgress=new Xi.PdfColor(97,97,97),e.taskbar.manualChildBackground=new Xi.PdfColor(0,135,134),e.taskbar.manualChildProgress=new Xi.PdfColor(0,135,134),e.taskbar.manualLineColor=new Xi.PdfColor(152,154,156),e.taskbar.manualParentBorder=new Xi.PdfColor(97,97,97),e.taskbar.manualChildBorder=new Xi.PdfColor(0,135,134)}},e.prototype.initStyles=function(e){e.columnHeader={},e.columnHeader.format=new Xi.PdfStringFormat,e.cell={},e.cell.format=new Xi.PdfStringFormat,e.timeline={},e.footer={},e.footer.format=new Xi.PdfStringFormat,e.label={},e.taskbar={}},e}(),Qi=function(){function e(){this.mKeys=[],this.mValues=[]}return e.prototype.size=function(){return this.mKeys.length},e.prototype.add=function(e,t){if(null==e||null==t)throw new ReferenceError("Provided key or value is not valid.");if(this.mKeys.indexOf(e)<0)return this.mKeys.push(e),this.mValues.push(t),1;throw new RangeError("An item with the same key has already been added.")},e.prototype.keys=function(){return this.mKeys},e.prototype.values=function(){return this.mValues},e.prototype.getValue=function(e){if(null==e)throw new ReferenceError("Provided key is not valid.");var t=this.mKeys.indexOf(e);if(t<0)throw new RangeError("No item with the specified key has been added.");return this.mValues[t]},e.prototype.setValue=function(e,t){if(null==e)throw new ReferenceError("Provided key is not valid.");var i=this.mKeys.indexOf(e);i<0?(this.mKeys.push(e),this.mValues.push(t)):this.mValues[i]=t},e.prototype.remove=function(e){if(null==e)throw new ReferenceError("Provided key is not valid.");var t=this.mKeys.indexOf(e);if(t<0)throw new RangeError("No item with the specified key has been added.");return this.mKeys.splice(t,1),this.mValues.splice(t,1),!0},e.prototype.containsKey=function(e){if(null==e)throw new ReferenceError("Provided key is not valid.");return!(this.mKeys.indexOf(e)<0)},e.prototype.clear=function(){this.mKeys=[],this.mValues=[]},e}(),Ki=function(){function e(){var e=new Xi.PdfPen(new Xi.PdfColor(0,0,0));e.dashStyle=Xi.PdfDashStyle.Solid;var t=new Xi.PdfPen(new Xi.PdfColor(0,0,0));t.dashStyle=Xi.PdfDashStyle.Solid;var i=new Xi.PdfPen(new Xi.PdfColor(0,0,0));i.dashStyle=Xi.PdfDashStyle.Solid;var r=new Xi.PdfPen(new Xi.PdfColor(0,0,0));r.dashStyle=Xi.PdfDashStyle.Solid,this.leftPen=e,this.rightPen=t,this.topPen=i,this.bottomPen=r}return Object.defineProperty(e.prototype,"left",{get:function(){return this.leftPen},set:function(e){this.leftPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.rightPen},set:function(e){this.rightPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.topPen},set:function(e){this.topPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.bottomPen},set:function(e){this.bottomPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"all",{set:function(e){this.leftPen=this.rightPen=this.topPen=this.bottomPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAll",{get:function(){return this.leftPen===this.rightPen&&this.leftPen===this.topPen&&this.leftPen===this.bottomPen},enumerable:!0,configurable:!0}),Object.defineProperty(e,"default",{get:function(){return new e},enumerable:!0,configurable:!0}),e}(),Ji=function(){function e(e,t,i,r){this.hasLeftPad=!1,this.hasRightPad=!1,this.hasTopPad=!1,this.hasBottomPad=!1,void 0===e?(this.leftPad=this.rightPad=5.76,this.bottomPad=this.topPad=.5):(this.leftPad=e,this.rightPad=t,this.topPad=i,this.bottomPad=r,this.hasLeftPad=!0,this.hasRightPad=!0,this.hasTopPad=!0,this.hasBottomPad=!0)}return Object.defineProperty(e.prototype,"left",{get:function(){return this.leftPad},set:function(e){this.leftPad=e,this.hasLeftPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.rightPad},set:function(e){this.rightPad=e,this.hasRightPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.topPad},set:function(e){this.topPad=e,this.hasTopPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.bottomPad},set:function(e){this.bottomPad=e,this.hasBottomPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"all",{set:function(e){this.leftPad=this.rightPad=this.topPad=this.bottomPad=e,this.hasLeftPad=!0,this.hasRightPad=!0,this.hasTopPad=!0,this.hasBottomPad=!0},enumerable:!0,configurable:!0}),e}(),$i=function(){},er=function(){this.cellSpacing=0,this.borderOverlapStyle=Xi.PdfBorderOverlapStyle.Overlap,this.allowHorizontalOverflow=!1,this.horizontalOverflowType=k.LastPage,this.cellPadding=new Ji},tr=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ir=function(t){function i(e){var i=t.call(this,e)||this;return i.columnRanges=[],i.repeatRowIndex=-1,i.currentBounds=new Xi.RectangleF(0,0,0,0),i}return tr(i,t),Object.defineProperty(i.prototype,"treegrid",{get:function(){return this.elements},enumerable:!0,configurable:!0}),i.prototype.layoutInternal=function(t){if((0,e.isNullOrUndefined)(t))throw Error("Argument Null Expection");this.currentPage=t.page;var i=t.format;if(null!==this.currentPage&&(this.currentPageBounds=this.currentPage.getClientSize()),this.currentGraphics=this.currentPage.graphics,null!==i&&i.break===Xi.PdfLayoutBreakType.FitColumnsToPage?this.currentBounds=new Xi.RectangleF(new Xi.PointF(t.bounds.x,t.bounds.y),new Xi.SizeF(this.treegrid.columns.width,this.currentGraphics.clientSize.height)):this.currentBounds=new Xi.RectangleF(new Xi.PointF(t.bounds.x,t.bounds.y),this.currentGraphics.clientSize),0===this.treegrid.rows.count)throw Error("Please add row or header into grid");return this.currentBounds.width=t.bounds.width>0?t.bounds.width:this.currentBounds.width-this.treegrid.rows.getRow(0).cells.getCell(0).style.borders.left.width/2,this.startLocation=new Xi.PointF(t.bounds.x,t.bounds.y),t.bounds.height>0&&(this.currentBounds.height=t.bounds.height),this.treegrid.style.allowHorizontalOverflow||this.treegrid.isFitToWidth?(this.treegrid.measureColumnsWidth(this.currentBounds),this.columnRanges.push([0,this.treegrid.columns.count-1])):(this.treegrid.measureColumnsWidth(),this.determineColumnDrawRanges()),this.layoutOnPage(t)},i.prototype.determineColumnDrawRanges=function(){for(var e=0,t=0,i=0,r=this.treegrid.taskbar.isAutoFit()?g(this.currentGraphics.clientSize.width)-this.currentBounds.x:this.currentGraphics.clientSize.width-this.currentBounds.x,a=0;a<this.treegrid.columns.count;a++)if((i+=this.treegrid.columns.getColumn(a).width)>=r){for(var n=0,s=e;s<=a&&!((n+=this.treegrid.columns.getColumn(s).width)>r);s++)t=s;this.columnRanges.push([e,t]),e=t+1,i=t<=a?this.treegrid.columns.getColumn(a).width:0}this.columnRanges.push([e,this.treegrid.columns.count-1])},i.prototype.getFormat=function(e){return e},i.prototype.layoutOnPage=function(e){for(var t,i=this.getFormat(e.format),r=new Qi,a=e.page,n=0;n<this.columnRanges.length;n++){var s=this.columnRanges[n];this.cellStartIndex=s[0],this.cellEndIndex=s[1];for(var o=this.treegrid.rows.count,l=0,d=!1,h=0;h<o;h++){var p=this.treegrid.rows.getRow(h);l++;var u=this.currentBounds.y;null===this.currentPage||r.containsKey(this.currentPage)||r.add(this.currentPage,s);var c=this.drawRow(p);for(u===this.currentBounds.y?(d=!0,this.repeatRowIndex=this.treegrid.rows.rowCollection.indexOf(p)):(d=!1,this.repeatRowIndex=-1);!c.isFinish&&null!==a;)if(this.treegrid.allowRowBreakAcrossPages)this.currentPage=this.getNextPageFormat(i),this.treegrid.enableHeader&&this.drawHeader(),this.checkBounds(i),c=this.drawRow(p);else{if(!this.treegrid.allowRowBreakAcrossPages&&l<length){this.currentPage=this.getNextPageFormat(i),this.treegrid.enableHeader&&this.drawHeader();break}if(l>=length)break}!c.isFinish&&null!==a&&i.layout!==Xi.PdfLayoutType.OnePage&&d&&(this.startLocation.x=this.currentBounds.x,this.currentPage=this.getNextPageFormat(i),this.treegrid.enableHeader&&this.drawHeader(),this.startLocation.y=this.currentBounds.y,i.paginateBounds===new Xi.RectangleF(0,0,0,0)&&(this.currentBounds.x+=this.startLocation.x),this.currentBounds.x===Ki.default.left.width/2&&(this.currentBounds.y+=this.startLocation.x),this.drawRow(p),null===this.currentPage||r.containsKey(this.currentPage)||r.add(this.currentPage,s))}this.columnRanges.indexOf(s)<this.columnRanges.length-1&&null!==a&&i.layout!==Xi.PdfLayoutType.OnePage&&(this.currentPage=this.getNextPageFormat(i),this.checkBounds(i))}return t=this.getLayoutResult(),this.treegrid.style.allowHorizontalOverflow&&this.treegrid.style.horizontalOverflowType===k.NextPage&&this.reArrangePages(r),t},i.prototype.checkBounds=function(e){var t=new Xi.PointF(Ki.default.right.width/2,Ki.default.top.width/2);e.paginateBounds===new Xi.RectangleF(0,0,0,0)&&this.startLocation===t&&(this.currentBounds.x+=this.startLocation.x,this.currentBounds.y+=this.startLocation.y)},i.prototype.drawHeader=function(){this.drawRow(this.treegrid.rows.getRow(0))},i.prototype.reArrangePages=function(e){for(var t=this.currentPage.document,i=[],r=e.keys(),a=0;a<r.length;a++){(o=r[a]).section=null,i.push(o),t.pages.remove(o)}for(a=0;a<e.size();a++)for(var n=e.size()/this.columnRanges.length,s=a;s<e.size();s+=n){var o=i[s];-1===t.pages.indexOf(o)&&t.pages.add(o)}},i.prototype.getNextPageFormat=function(e){var t=this.currentPage.section,i=null,r=t.indexOf(this.currentPage);return i=r===t.count-1?t.add():t.getPages()[r+1],this.currentGraphics=i.graphics,this.currentBounds=new Xi.RectangleF(new Xi.PointF(0,0),i.getClientSize()),i},i.prototype.getLayoutResult=function(){var e=new Xi.RectangleF(this.startLocation,new Xi.SizeF(this.currentBounds.width,this.currentBounds.y-this.startLocation.y));return new rr(this.currentPage,e)},i.prototype.checkIfDefaultFormat=function(e){var t=new Xi.PdfStringFormat;return e.alignment===t.alignment&&e.characterSpacing===t.characterSpacing&&e.clipPath===t.clipPath&&e.firstLineIndent===t.firstLineIndent&&e.horizontalScalingFactor===t.horizontalScalingFactor&&e.lineAlignment===t.lineAlignment&&e.lineLimit===t.lineLimit&&e.lineSpacing===t.lineSpacing&&e.measureTrailingSpaces===t.measureTrailingSpaces&&e.noClip===t.noClip&&e.paragraphIndent===t.paragraphIndent&&e.rightToLeft===t.rightToLeft&&e.subSuperScript===t.subSuperScript&&e.wordSpacing===t.wordSpacing&&e.wordWrap===t.wordWrap},i.prototype.drawRow=function(t,i,r){if((0,e.isNullOrUndefined)(i)){var a=new Xi.RowLayoutResult;return(r=t.rowBreakHeight>0?t.rowBreakHeight:t.height)>this.currentPageBounds.height?this.treegrid.allowRowBreakAcrossPages?(a.isFinish=!0,this.drawRowWithBreak(a,t,r)):(a.isFinish=!1,this.drawRow(t,a,r)):this.currentBounds.y+r>this.currentPageBounds.height||this.currentBounds.y+r>this.currentBounds.height?this.repeatRowIndex>-1&&this.repeatRowIndex===t.rowIndex?this.treegrid.allowRowBreakAcrossPages?(a.isFinish=!0,this.drawRowWithBreak(a,t,r)):(a.isFinish=!1,this.drawRow(t,a,r)):a.isFinish=!1:(a.isFinish=!0,this.drawRow(t,a,r)),a}var n=new Xi.PointF(this.currentBounds.x,this.currentBounds.y);i.bounds=new Xi.RectangleF(n,new Xi.SizeF(0,0));var s=0;r=this.reCalculateHeight(t,r);for(var o=this.cellStartIndex;o<=this.cellEndIndex;o++){var l=t.cells.getCell(o),d=this.treegrid.columns.getColumn(o);d.isTreeColumn&&(s=10*t.level);var h=o>this.cellEndIndex+1&&l.columnSpan>1;if(!h)for(var p=1;p<l.columnSpan;p++)t.cells.getCell(o+p).isCellMergeContinue=!0;var u=new Xi.SizeF(d.width,r);l.columnSpan>1&&(u=new Xi.SizeF(l.width,r),o+=l.columnSpan),!this.checkIfDefaultFormat(d.format)&&this.checkIfDefaultFormat(l.style.format)&&(l.style.format=d.format),l.draw(this.currentGraphics,new Xi.RectangleF(n,u),h,s),t.treegrid.style.allowHorizontalOverflow&&(l.columnSpan>this.cellEndIndex||o+l.columnSpan>this.cellEndIndex+1)&&this.cellEndIndex<t.cells.count-1&&(t.rowOverflowIndex=this.cellEndIndex),n.x+=d.width,s=0}return this.currentBounds.y+=r,i.bounds=new Xi.RectangleF(new Xi.PointF(i.bounds.x,i.bounds.y),new Xi.SizeF(n.x,n.y)),null},i.prototype.drawRowWithBreak=function(e,t,i){var r=new Xi.PointF(this.currentBounds.x,this.currentBounds.y);e.bounds=new Xi.RectangleF(r,new Xi.SizeF(0,0));var a=0;this.treegridHeight=this.currentBounds.height,t.rowBreakHeight=this.currentBounds.y+i-this.currentBounds.height;for(var n=0;n<t.cells.count;n++){(l=t.cells.getCell(n)).measureHeight()===i&&null===l.value&&(t.rowBreakHeight=this.currentBounds.y+i-this.currentBounds.height)}for(var s=this.cellStartIndex;s<=this.cellEndIndex;s++){var o=this.treegrid.columns.getColumn(s);o.isTreeColumn&&(a=10*t.level);var l,d=(l=t.cells.getCell(s)).columnSpan+s>this.cellEndIndex+1&&l.columnSpan>1;if(!d)for(var h=1;h<l.columnSpan;h++)t.cells.getCell(s+h).isCellMergeContinue=!0;var p=this.treegridHeight>0?this.treegridHeight:this.currentBounds.height,u=new Xi.SizeF(o.width,p);!this.checkIfDefaultFormat(o.format)&&this.checkIfDefaultFormat(l.style.format)&&(l.style.format=o.format),l.draw(this.currentGraphics,new Xi.RectangleF(r,u),d,a),e.isFinish=e.isFinish?l.finishedDrawingCell:e.isFinish,r.x+=o.width,a=0,this.currentBounds.y+=this.treegridHeight>0?this.treegridHeight:i,e.bounds=new Xi.RectangleF(new Xi.PointF(e.bounds.x,e.bounds.y),new Xi.SizeF(r.x,r.y))}},i.prototype.reCalculateHeight=function(t,i){for(var r=0,a=this.cellStartIndex;a<=this.cellEndIndex;a++)(0,e.isNullOrUndefined)(t.cells.getCell(a).remainingString)&&""!==t.cells.getCell(a).remainingString||(r=Math.max(r,t.cells.getCell(a).measureHeight()));return Math.max(i,r)},i}(Xi.ElementLayouter),rr=function(e){function t(t,i){return e.call(this,t,i)||this}return tr(t,e),t}(Xi.PdfLayoutResult),ar=function(e){function t(t){return void 0===t?e.call(this)||this:e.call(this,t)||this}return tr(t,e),t}(Xi.PdfLayoutFormat),nr=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),sr=function(e){function t(){var t=e.call(this)||this;return t.treeGridSize=new Xi.SizeF(0,0),t.treeColumnIndex=0,t.allowRowBreakAcrossPages=!0,t.enableHeader=!0,t.isFitToWidth=!1,t.columns=new cr(t),t.rows=new hr(t),t.headers=new pr(t),t.style=new er,t.rowHeight=0,t}return nr(t,e),Object.defineProperty(t.prototype,"raiseBeginCellDraw",{get:function(){return void 0!==this.beginCellDraw&&null!==typeof this.beginCellDraw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"raiseEndCellDraw",{get:function(){return void 0!==this.endCellDraw&&null!==typeof this.endCellDraw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return 0===this.treeGridSize.width&&0===this.treeGridSize.height&&(this.treeGridSize=this.calculateTreeGridSize()),this.treeGridSize},set:function(e){this.treeGridSize=e},enumerable:!0,configurable:!0}),t.prototype.draw=function(e,t,i,r){if(t instanceof Xi.PointF&&void 0===t.width&&void 0===i)return this.drawHelper(e,t.x,t.y);if("number"==typeof t&&"number"==typeof i&&void 0===r)return this.drawHelper(e,t,i,null);if(t instanceof Xi.RectangleF&&void 0!==t.width&&void 0===i)return this.drawHelper(e,t,null);if(t instanceof Xi.PointF&&void 0===t.width&&i instanceof Xi.PdfLayoutFormat)return this.drawHelper(e,t.x,t.y,i);if("number"==typeof t&&"number"==typeof i&&(r instanceof Xi.PdfLayoutFormat||null===r)){var a=e.graphics.clientSize.width-t,n=new Xi.RectangleF(t,i,a,0);return this.drawHelper(e,n,r)}return t instanceof Xi.RectangleF&&void 0!==t.width&&"boolean"==typeof i?this.drawHelper(e,t,null):this.drawHelper(e,t,i)},t.prototype.measureColumnsWidth=function(e){if(void 0!==e)for(var t=this.columns.getDefaultWidths(e.width-e.x),i=0;i<this.columns.count;i++)this.columns.getColumn(i).width<0&&(this.columns.getColumn(i).width=t[i]);else{t=[];var r=0,a=0,n=this.columns.count;for(i=0;i<n;i++){for(var s=this.rows.count,o=0;o<s;o++){var l=this.rows.getRow(o).cells.getCell(i).width,d=this.initialWidth>0?Math.min(this.initialWidth,l):l;r=Math.max(r,d),r=Math.max(this.columns.getColumn(i).width,r),this.columns.getColumn(i).isTreeColumn&&(a=Math.max(a,this.rows.getRow(o).level))}this.columns.getColumn(i).isTreeColumn?t.push(r+10*a):t.push(r),r=0}for(i=0;i<this.columns.count;i++)this.columns.getColumn(i).width<0&&(this.columns.getColumn(i).width=t[i])}},t.prototype.calculateTreeGridSize=function(){for(var e=0,t=this.columns.width,i=0;i<this.headers.count;i++){e+=this.headers.getHeader(i).height}for(i=0;i<this.rows.count;i++){e+=this.rows.getRow(i).height}return new Xi.SizeF(t,e)},t.prototype.drawGrid=function(e,t,i,r){this.initialWidth=e.graphics.clientSize.width;var a=new Xi.RectangleF(0,0,e.getClientSize().height,0);return this.draw(e,a,r)},t.prototype.layout=function(e){if(0!==this.rows.count){var t=this.rows.getRow(0).cells.getCell(0).style;if(1!==t.borders.left.width){var i=t.borders.left.width/2,r=t.borders.top.width/2;if(e.bounds.x===Ki.default.right.width/2&&e.bounds.y===Ki.default.right.width/2){var a=new Xi.RectangleF(new Xi.PointF(i,r),new Xi.SizeF(this.size.width,this.size.height));e.bounds=a}}}return this.setSpan(),this.layouter=new ir(this),this.layouter.layoutInternal(e)},t.prototype.onBeginCellDraw=function(e){this.raiseBeginCellDraw&&this.beginCellDraw(this,e)},t.prototype.onEndCellDraw=function(e){this.raiseEndCellDraw&&this.endCellDraw(this,e)},t.prototype.setSpan=function(){for(var e=1,t=1,i=0,r=0,a=0,n=this.headers.count,s=0;s<n;s++){a=0;for(var o=(p=this.headers.getHeader(s)).cells.count,l=0;l<o;l++){var d=p.cells.getCell(l);if(a=Math.max(a,d.rowSpan),!d.isCellMergeContinue&&!d.isRowMergeContinue&&(d.columnSpan>1||d.rowSpan>1)){if(d.columnSpan+l>p.cells.count)throw new Error("Invalid span specified at row "+l.toString()+" column "+s.toString());if(d.rowSpan+s>this.headers.count)throw new Error("Invalid span specified at Header "+l.toString()+" column "+s.toString());if(d.columnSpan>1&&d.rowSpan>1){for(e=d.columnSpan,t=d.rowSpan,i=l,r=s,d.isCellMergeStart=!0,d.isRowMergeStart=!0;e>1;)i++,p.cells.getCell(i).isCellMergeContinue=!0,p.cells.getCell(i).isRowMergeContinue=!0,p.cells.getCell(i).rowSpan=t,e--;for(i=l,e=d.columnSpan;t>1;){for(r++,this.headers.getHeader(r).cells.getCell(l).isRowMergeContinue=!0,this.headers.getHeader(r).cells.getCell(i).isRowMergeContinue=!0,t--;e>1;)i++,this.headers.getHeader(r).cells.getCell(i).isCellMergeContinue=!0,this.headers.getHeader(r).cells.getCell(i).isRowMergeContinue=!0,e--;e=d.columnSpan,i=l}}else if(d.columnSpan>1&&1===d.rowSpan){e=d.columnSpan,i=l,d.isCellMergeStart=!0;for(var h=this.columns.columns[i].width;e>1;)i++,p.cells.getCell(i).isCellMergeContinue=!0,e--,h+=this.columns.columns[i].width;d.width=h}else if(1===d.columnSpan&&d.rowSpan>1)for(t=d.rowSpan,r=s;t>1;)r++,this.headers.getHeader(r).cells.getCell(l).isRowMergeContinue=!0,t--}}p.maximumRowSpan=a}e=t=1,i=r=0,n=this.rows.count;for(s=0;s<n;s++){var p,u=(p=this.rows.getRow(s)).cells.count;for(l=0;l<u;l++){if(!(d=p.cells.getCell(l)).isCellMergeContinue&&!d.isRowMergeContinue&&(d.columnSpan>1||d.rowSpan>1)){if(d.columnSpan+l>p.cells.count)throw new Error("Invalid span specified at row {0} column {1} "+l.toString());if(d.rowSpan+s>this.rows.count)throw new Error("Invalid span specified at row {0} column {1} "+l.toString());if(d.columnSpan>1&&d.rowSpan>1){for(e=d.columnSpan,t=d.rowSpan,i=l,r=s,d.isCellMergeStart=!0,d.isRowMergeStart=!0;e>1;)i++,p.cells.getCell(i).isCellMergeContinue=!0,e--;for(i=l,e=d.columnSpan;t>1;){for(r++,this.rows.getRow(r).cells.getCell(l).isRowMergeContinue=!0,t--;e>1;)i++,this.rows.getRow(r).cells.getCell(i).isCellMergeContinue=!0,e--;e=d.columnSpan,i=l}}else if(d.columnSpan>1&&1===d.rowSpan)for(e=d.columnSpan,i=l,d.isCellMergeStart=!0;e>1;)i++,p.cells.getCell(i).isCellMergeContinue=!0,e--;else if(1===d.columnSpan&&d.rowSpan>1)for(t=d.rowSpan,r=s;t>1;)r++,this.rows.getRow(r).cells.getCell(l).isRowMergeContinue=!0,t--}}}},t}(Xi.PdfLayoutElement),or=function(){function t(t){this.cellWidth=0,this.cellHeight=0,this.finishedDrawingCell=!0,(0,e.isNullOrUndefined)(t)?(this.rowSpan=1,this.columnSpan=1):this.row=t,this.style={}}return Object.defineProperty(t.prototype,"height",{get:function(){return 0===this.cellHeight&&(this.cellHeight=this.measureHeight()),this.cellHeight},set:function(e){this.cellHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return 0===this.cellWidth&&(this.cellWidth=this.measureWidth()),Math.round(this.cellWidth)},set:function(e){this.cellWidth=e},enumerable:!0,configurable:!0}),t.prototype.measureWidth=function(){var e=0,t=new Xi.PdfStringLayouter;if("string"==typeof this.value){var i=new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle);i=this.row.isParentRow?new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,Xi.PdfFontStyle.Bold):new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),this.row.treegrid.ganttStyle.font&&(i=this.row.treegrid.ganttStyle.font),e+=t.layout(this.value,i,this.style.format,new Xi.SizeF(Number.MAX_VALUE,Number.MAX_VALUE),!1,new Xi.SizeF(0,0)).actualSize.width,e+=2*(this.style.borders.left.width+this.style.borders.right.width)}return void 0!==this.row.treegrid.style.cellPadding.left&&this.row.treegrid.style.cellPadding.hasLeftPad&&(e+=this.row.treegrid.style.cellPadding.left),void 0!==this.row.treegrid.style.cellPadding.right&&this.row.treegrid.style.cellPadding.hasRightPad&&(e+=this.row.treegrid.style.cellPadding.right),e+=this.row.treegrid.style.cellSpacing},t.prototype.measureHeight=function(){var t=this.row.treegrid.rowHeight,i=0,r=this.calculateWidth();r-=this.row.treegrid.style.cellPadding.right+this.row.treegrid.style.cellPadding.left,r-=this.style.borders.left.width+this.style.borders.right.width;var a=new Xi.PdfStringLayouter;if("string"==typeof this.value||"string"==typeof this.remainingString){var n=this.value;this.finishedDrawingCell||(n=(0,e.isNullOrUndefined)(this.remainingString)||""===this.remainingString?this.value:this.remainingString);var s=null;s=this.row.isParentRow?new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,Xi.PdfFontStyle.Bold):new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),this.row.treegrid.ganttStyle.font&&(s=this.row.treegrid.ganttStyle.font);var o=a.layout(n,s,this.style.format,new Xi.SizeF(r-10,0),!1,new Xi.SizeF(0,0)),l=Math.max(o.lineHeight,o.actualSize.height);n.length>80?i+=l+20:i+=l+o.size.height/2,i+=2*(this.style.borders.top.width+this.style.borders.bottom.width)}return i+=this.row.treegrid.style.cellPadding.top+this.row.treegrid.style.cellPadding.bottom,(i+=this.row.treegrid.style.cellSpacing)>t?i:t},t.prototype.calculateWidth=function(){for(var e=this.row.cells.indexOf(this),t=this.columnSpan,i=0,r=0;r<t;r++)i+=this.row.treegrid.columns.getColumn(e+r).width;return this.row.treegrid.columns.getColumn(e).isTreeColumn&&(i-=10*this.row.level),i},t.prototype.draw=function(e,t,i,r){var a=null;if(i){for(var n=this.row.cells.indexOf(this),s=n+1;s<=n+this.columnSpan;s++)this.row.cells.getCell(s).isCellMergeContinue=!1,this.row.cells.getCell(s).isRowMergeContinue=!1;this.columnSpan=1}if((this.isCellMergeContinue||this.isRowMergeContinue)&&this.isCellMergeContinue&&this.row.treegrid.style.allowHorizontalOverflow)return this.row.rowOverflowIndex>0&&this.row.cells.indexOf(this)!==this.row.rowOverflowIndex+1||0===this.row.rowOverflowIndex&&this.isCellMergeContinue,a;this.drawCellBackground(e,t);var o=null,l=new Xi.PdfSolidBrush(this.style.fontColor),d=null;d=this.row.isParentRow?new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,Xi.PdfFontStyle.Bold):new Xi.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),this.row.treegrid.ganttStyle.font&&(d=this.row.treegrid.ganttStyle.font);var h=t;if(this.isHeaderCell||(h.x=h.x,h.width=h.width),h.height>=e.clientSize.height&&(this.row.treegrid.allowRowBreakAcrossPages?(h.height-=h.y,t.height-=t.y):(h.height=e.clientSize.height,t.height=e.clientSize.height)),h=this.adjustContentLayoutArea(h),this.image&&this.value){var p=void 0;p=this.image.width<=h.width?new Xi.RectangleF(h.x,h.y,this.image.width,this.image.height):h,e.drawImage(this.image,p.x,p.y-10,p.width,p.height);var u=null,c=void 0,g=new Xi.PdfStandardFont(this.fontStyle.fontFamily,this.fontStyle.fontSize,this.fontStyle.fontStyle);c=this.fontStyle.fontFamily?g:d;var f=void 0;f=this.fontStyle.fontBrush?new Xi.PdfSolidBrush(this.fontStyle.fontBrush):l,this.finishedDrawingCell?(u=""===this.remainingString?this.remainingString:this.value,e.drawString(u,c,o,f,h.x+r+this.image.width,this.isHeaderCell?h.y-16:h.y,h.width-r-10,h.height-10,this.style.format)):e.drawString(this.remainingString,c,o,f,h.x+r,this.isHeaderCell?h.y-16:h.y,this.style.format),a=e.stringLayoutResult}else if("string"==typeof this.value||"string"==typeof this.remainingString){u=null,c=void 0,g=new Xi.PdfStandardFont(this.style.fontFamily,this.style.fontSize,this.style.fontStyle);c=this.style.fontFamily?g:d;f=void 0;f=this.style.fontBrush?new Xi.PdfSolidBrush(this.style.fontBrush):l,this.finishedDrawingCell?(u=""===this.remainingString?this.remainingString:this.value,e.drawString(u,c,o,f,h.x+r,this.isHeaderCell?h.y-16:h.y-3,h.width-r-10,h.height-10,this.style.format)):e.drawString(this.remainingString,c,o,f,h.x+r,this.isHeaderCell?h.y-16:h.y,this.style.format),a=e.stringLayoutResult}else if(this.value instanceof Xi.PdfImage||this.value instanceof Xi.PdfBitmap){p=void 0;p=this.value.width<=h.width?new Xi.RectangleF(h.x,h.y,this.value.width,h.height):h,e.drawImage(this.value,p.x,p.y-10,p.width,p.height)}else this.value instanceof Xi.PdfTextWebLink&&this.value.draw(e.currentPage,h);return null!==this.style.borders&&this.drawCellBorder(e,t),a},t.prototype.drawCellBackground=function(e,t){var i=new Xi.PdfSolidBrush(this.style.backgroundColor);null!==i&&(e.save(),e.drawRectangle(i,t.x,t.y,t.width,t.height),e.restore())},t.prototype.adjustContentLayoutArea=function(e){var t=new Xi.RectangleF(new Xi.PointF(e.x,e.y),new Xi.SizeF(e.width,e.height)),i=this.style.padding;if(this.value instanceof sr){var r=this.value.size;this.style.format.alignment===Xi.PdfTextAlignment.Center?(t.x+=i.left+(t.width-r.width)/2,t.y+=i.top+(t.height-r.height)/2):this.style.format.alignment===Xi.PdfTextAlignment.Left?(t.x+=i.left,t.y+=i.top):this.style.format.alignment===Xi.PdfTextAlignment.Right&&(t.x+=i.left+(t.width-r.width),t.y+=i.top)}else t.x+=i.left,t.y+=i.top;return t},t.prototype.drawCellBorder=function(e,t){if(this.row.treegrid.style.borderOverlapStyle===Xi.PdfBorderOverlapStyle.Inside&&(t.x+=this.style.borders.left.width,t.y+=this.style.borders.top.width,t.width-=this.style.borders.right.width,t.height-=this.style.borders.bottom.width),this.style.borders.isAll&&this.isHeaderCell)return e.drawRectangle(this.style.borders.left,t.x,t.y,t.width,t.height),void e.restore();var i=new Xi.PointF(t.x,t.y+t.height),r=new Xi.PointF(t.x,t.y),a=this.style.borders.left;this.style.borders.left.dashStyle===Xi.PdfDashStyle.Solid&&(a.lineCap=Xi.PdfLineCap.Square),e.drawLine(a,i,r),e.restore(),i=new Xi.PointF(t.x+t.width,t.y),r=new Xi.PointF(t.x+t.width,t.y+t.height),a=this.style.borders.right,t.x+t.width>e.clientSize.width-a.width/2&&(i=new Xi.PointF(e.clientSize.width-a.width/2,t.y),r=new Xi.PointF(e.clientSize.width-a.width/2,t.y+t.height)),this.style.borders.right.dashStyle===Xi.PdfDashStyle.Solid&&(a.lineCap=Xi.PdfLineCap.Square),e.drawLine(a,i,r),e.restore(),i=new Xi.PointF(t.x,t.y),r=new Xi.PointF(t.x+t.width,t.y),a=this.style.borders.top,this.style.borders.top.dashStyle===Xi.PdfDashStyle.Solid&&(a.lineCap=Xi.PdfLineCap.Square),e.drawLine(a,i,r),e.restore(),i=new Xi.PointF(t.x+t.width,t.y+t.height),r=new Xi.PointF(t.x,t.y+t.height),a=this.style.borders.bottom,t.y+t.height>e.clientSize.height-a.width/2&&(i=new Xi.PointF(t.x+t.width,e.clientSize.height-a.width/2),r=new Xi.PointF(t.x,e.clientSize.height-a.width/2)),this.style.borders.bottom.dashStyle===Xi.PdfDashStyle.Solid&&(a.lineCap=Xi.PdfLineCap.Square),e.drawLine(a,i,r),e.restore()},t}(),lr=function(){function e(e){this.treegridRow=e,this.cells=[]}return e.prototype.getCell=function(e){if(e<0||e>=this.count)throw new Error("IndexOutOfRangeException");return this.cells[e]},Object.defineProperty(e.prototype,"count",{get:function(){return this.cells.length},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(void 0===e){var t=new or;return this.add(t),e}e.row=this.treegridRow,this.cells.push(e)},e.prototype.indexOf=function(e){return this.cells.indexOf(e)},e}(),dr=function(){function t(e){this.treegridRowOverflowIndex=0,this.rowHeight=0,this.rowWidth=0,this._isParentRow=!1,this.intendLevel=0,this.pdfTreeGrid=e}return Object.defineProperty(t.prototype,"cells",{get:function(){return(0,e.isNullOrUndefined)(this.treegridCells)&&(this.treegridCells=new lr(this)),this.treegridCells},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isParentRow",{get:function(){return this._isParentRow},set:function(e){this._isParentRow=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"treegrid",{get:function(){return this.pdfTreeGrid},set:function(e){this.pdfTreeGrid=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowBreakHeight",{get:function(){return void 0===this.treegridRowBreakHeight&&(this.treegridRowBreakHeight=0),this.treegridRowBreakHeight},set:function(e){this.treegridRowBreakHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowOverflowIndex",{get:function(){return this.treegridRowOverflowIndex},set:function(e){this.treegridRowOverflowIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.intendLevel},set:function(e){this.intendLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 0===this.rowHeight&&(this.rowHeight=this.measureHeight()),this.rowHeight},set:function(e){this.rowHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return 0===this.rowWidth&&(this.rowWidth=this.measureWidth()),this.rowWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowIndex",{get:function(){return this.treegrid.rows.rowCollection.indexOf(this)},enumerable:!0,configurable:!0}),t.prototype.measureWidth=function(){for(var e=this.treegrid.columns.columns,t=0,i=0;i<e.length;i++){t+=e[i].width}return t},t.prototype.measureHeight=function(){for(var e=this.cells.getCell(0).height,t=0;t<this.cells.count;t++){var i=this.cells.getCell(t);e=1===i.columnSpan||1===i.rowSpan?Math.max(e,i.height):Math.min(e,i.height),i.height=e}return e},t}(),hr=function(){function e(e){this.rows=[],this.treegrid=e}return Object.defineProperty(e.prototype,"count",{get:function(){return this.rows.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rowCollection",{get:function(){return this.rows},enumerable:!0,configurable:!0}),e.prototype.addRow=function(e){if(void 0===e){var t=new dr(this.treegrid);return this.addRow(t),t}if(0===e.cells.count)for(var i=0;i<this.treegrid.columns.count;i++)e.cells.add(new or);this.rows.push(e)},e.prototype.getRow=function(e){return this.rows[e]},e}(),pr=function(){function e(e){this.rows=[],this.treegrid=e,this.rows=[]}return e.prototype.getHeader=function(e){return this.rows[e]},Object.defineProperty(e.prototype,"count",{get:function(){return this.rows.length},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this.rows.push(e)},e.prototype.indexOf=function(e){return this.rows.indexOf(e)},e}(),ur=function(){function t(e){this.columnWidth=0,this.treeColumnIndex=!1,this._headerText="",this._field="",this.treegrid=e}return Object.defineProperty(t.prototype,"headerText",{get:function(){return this._headerText},set:function(e){this._headerText=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field",{get:function(){return this._field},set:function(e){this._field=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.columnWidth},set:function(e){this.columnWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTreeColumn",{get:function(){return this.treeColumnIndex},set:function(e){this.treeColumnIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return(0,e.isNullOrUndefined)(this.stringFormat)&&(this.stringFormat=new Xi.PdfStringFormat),this.stringFormat},set:function(e){this.stringFormat=e},enumerable:!0,configurable:!0}),t}(),cr=function(){function e(e){this.internalColumns=[],this.columnWidth=0,this.treegrid=e,this.internalColumns=[]}return e.prototype.add=function(e){for(var t=0;t<e;t++){this.internalColumns.push(new ur(this.treegrid));for(var i=0;i<this.treegrid.rows.count;i++){var r=this.treegrid.rows.getRow(i),a=new or;a.value="",r.cells.add(a)}}},Object.defineProperty(e.prototype,"count",{get:function(){return this.internalColumns.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return 0===this.columnWidth&&(this.columnWidth=this.measureColumnsWidth()),this.columnWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this.internalColumns},enumerable:!0,configurable:!0}),e.prototype.getColumn=function(e){if(e>=0&&e<=this.columns.length)return this.columns[e];throw Error("can not get the column from the index: "+e)},e.prototype.measureColumnsWidth=function(){var e=0;this.treegrid.measureColumnsWidth();for(var t=0,i=this.internalColumns.length;t<i;t++)e+=this.internalColumns[t].width;return e},e.prototype.getDefaultWidths=function(e){for(var t=[],i=this.count,r=0;r<this.count;r++)t[r]=this.internalColumns[r].width,this.internalColumns[r].width>0?(e-=this.internalColumns[r].width,i--):t[r]=0;for(r=0;r<this.count;r++){var a=e/i;t[r]<=0&&(t[r]=a)}return t},e}(),gr=function(){return gr=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},gr.apply(this,arguments)},fr=function(){function t(e){this.totalColumnWidth=0,this.beforeSinglePageExport={},this.baselineHeight=8,this.parent=e}return t.prototype.processToFit=function(){this.beforeSinglePageExport.zoomingProjectStartDate=this.parent.zoomingProjectStartDate,this.beforeSinglePageExport.zoomingProjectEndDate=this.parent.zoomingProjectEndDate,this.beforeSinglePageExport.cloneProjectStartDate=this.parent.cloneProjectStartDate,this.beforeSinglePageExport.cloneProjectEndDate=this.parent.cloneProjectEndDate,this.beforeSinglePageExport.customTimelineSettings=(0,e.extend)({},this.parent.timelineModule.customTimelineSettings,null,!0),this.beforeSinglePageExport.isTimelineRoundOff=this.parent.isTimelineRoundOff,this.beforeSinglePageExport.topTier=this.parent.timelineModule.topTier,this.beforeSinglePageExport.topTierCellWidth=this.parent.timelineModule.topTierCellWidth,this.beforeSinglePageExport.topTierCollection=this.parent.timelineModule.topTierCollection,this.beforeSinglePageExport.bottomTier=this.parent.timelineModule.bottomTier,this.beforeSinglePageExport.bottomTierCellWidth=this.parent.timelineModule.bottomTierCellWidth,this.beforeSinglePageExport.bottomTierCollection=this.parent.timelineModule.bottomTierCollection,this.beforeSinglePageExport.totalTimelineWidth=this.parent.timelineModule.totalTimelineWidth,this.beforeSinglePageExport.timelineStartDate=this.parent.timelineModule.timelineStartDate,this.beforeSinglePageExport.timelineEndDate=this.parent.timelineModule.timelineEndDate,this.beforeSinglePageExport.timelineRoundOffEndDate=this.parent.timelineModule.timelineRoundOffEndDate,this.beforeSinglePageExport.perDayWidth=this.parent.perDayWidth,this.beforeSinglePageExport.updatedConnectorLineCollection=(0,e.extend)([],this.parent.updatedConnectorLineCollection,null,!0),this.parent.timelineModule.isZoomToFit=!0,this.parent.timelineModule.isZooming=!1,this.parent.zoomingProjectStartDate||(this.parent.zoomingProjectStartDate=this.parent.cloneProjectStartDate,this.parent.zoomingProjectEndDate=this.parent.cloneProjectEndDate),this.parent.zoomingProjectStartDate>this.parent.cloneProjectStartDate&&(this.parent.cloneProjectStartDate=new Date(this.parent.allowUnscheduledTasks?this.parent.zoomingProjectStartDate:this.parent.cloneProjectStartDate)),this.parent.dataOperation.calculateProjectDates();var t,i,r=(this.parent.cloneProjectEndDate.getTime()-this.parent.cloneProjectStartDate.getTime())/864e5;this.exportProps.fitToWidthSettings.gridWidth&&(i=parseInt(this.exportProps.fitToWidthSettings.gridWidth.split("%")[0],10)),t=this.exportProps.fitToWidthSettings.chartWidth?parseInt(this.exportProps.fitToWidthSettings.chartWidth.split("%")[0],10):this.exportProps.fitToWidthSettings.gridWidth?100-i:70;var a,n,s,o=this.parent.pdfExportModule.pdfPageDimensions.width*t/100,l=o/r,d=this.parent.zoomingLevels.slice().sort((function(e,t){return e.perDayWidth||t.perDayWidth?e.perDayWidth<t.perDayWidth?1:-1:0}));if(0!==l){for(var h=0;h<d.length;h++){if(n=d[h],h===d.length-1){a=d[h];break}if(s=d[h+1],l>=n.perDayWidth){a=d[h];break}if(l<n.perDayWidth&&l>s.perDayWidth){a=d[h+1];break}}var p=(0,e.extend)({},{},a,!0);this.parent.timelineModule.roundOffDateToZoom(this.parent.cloneProjectStartDate,!0,l,p.bottomTier.unit,a),this.parent.timelineModule.roundOffDateToZoom(this.parent.cloneProjectEndDate,!1,l,p.bottomTier.unit,a);var u=this.parent.timelineModule.calculateNumberOfTimelineCells(p),c=this.parent.pdfExportModule.pdfPageDimensions.height<=0?0:17;p.timelineUnitSize=Math.abs(o-c)/u,this.parent.timelineModule.changeTimelineSettings(p),this.parent.timelineModule.isZoomToFit=!1,this.parent.timelineModule.isZooming=!1}},t.prototype.processGridExport=function(e,t,i){this.flatData=e,this.gantt=t,this.exportValueFormatter=new mr(this.parent.locale),this.exportProps=i,this.rowIndex=0,this.colIndex=0,this.columns=this.parent.treeGrid.columns,this.gantt.treeColumnIndex=this.parent.treeColumnIndex,this.gantt.rowHeight=c(this.parent.rowHeight),this.gantt.style.cellPadding.left=0,this.gantt.style.cellPadding.right=0,this.ganttStyle=this.gantt.ganttStyle,this.gantt.borderColor=this.ganttStyle.chartGridLineColor,this.parent.pdfExportModule.isPdfExport=!0,this.exportProps.fitToWidthSettings&&this.exportProps.fitToWidthSettings.isFitToWidth&&this.processToFit(),this.processHeaderContent(),this.processGanttContent(),this.processTimeline(),this.processTaskbar(),this.processPredecessor(),this.parent.pdfExportModule.isPdfExport=!1},t.prototype.processHeaderContent=function(){var e=this;this.rowIndex++,this.row=this.gantt.rows.addRow();var t=0;this.columns.forEach((function(i){e.isColumnVisible(i)&&(e.processColumnHeader(i,t),t++)}))},t.prototype.processColumnHeader=function(e,t){this.gantt.columns.add(1);var i=this.gantt.columns.getColumn(t);this.parent.treeColumnIndex===t&&(i.isTreeColumn=!0);var r=parseInt(e.width,10);i.width=c(r),this.totalColumnWidth+=i.width,i.headerText=e.headerText,i.field=e.field;var a=this.row.cells.getCell(t);a.value=e.headerText,a.isHeaderCell=!0;var n=this.parent.timelineModule.isSingleTier?45:60;this.copyStyles(this.ganttStyle.columnHeader,a,!1),this.row.height=c(n),e.headerTextAlign&&(a.style.format.alignment=Xi.PdfTextAlignment[e.headerTextAlign]);a.fontStyle={fontSize:9};var s={cell:a,style:a.style,value:a.value,column:e,image:null,headerTemplate:{image:null,value:null,fontStyle:{fontBrush:null}}};this.parent.pdfColumnHeaderQueryCellInfo&&this.parent.trigger("pdfColumnHeaderQueryCellInfo",s),s.headerTemplate.image&&s.headerTemplate.value?(s.image=new Xi.PdfBitmap(s.headerTemplate.image[0].base64),s.image.height=s.headerTemplate.image[0].height||s.image.height,s.image.width=s.headerTemplate.image[0].width||s.image.width,a.image=s.image,a.value=s.headerTemplate.value,a.fontStyle.fontSize=s.headerTemplate.fontStyle.fontSize,a.fontStyle.fontFamily=s.headerTemplate.fontStyle.fontFamily,a.fontStyle.fontBrush=s.headerTemplate.fontStyle.fontColor):a.value=s.value},t.prototype.isColumnVisible=function(e){return e.visible||this.exportProps.includeHiddenColumn},t.prototype.processGanttContent=function(){var e=this;0===this.flatData.length?this.renderEmptyGantt():this.flatData.forEach((function(t){e.row=e.gantt.rows.addRow(),t.hasChildRecords?(e.gantt.rows.getRow(e.rowIndex).isParentRow=!0,e.processRecordRow(t)):e.processRecordRow(t),e.rowIndex++}))},t.prototype.processTimeline=function(){this.parent.enableTimelineVirtualization&&this.parent.timelineModule.createTimelineSeries();var t=this.parent.timelineModule;if(this.gantt.chartHeader.topTierHeight=this.gantt.chartHeader.bottomTierHeight=this.parent.timelineModule.isSingleTier?45:30,this.gantt.chartHeader.topTierCellWidth=t.topTierCellWidth,this.gantt.chartHeader.bottomTierCellWidth=t.bottomTierCellWidth,this.gantt.chartHeader.topTier=(0,e.extend)([],[],this.parent.enableTimelineVirtualization?t.pdfExportTopTierCollection:t.topTierCollection,!0),this.gantt.chartHeader.bottomTier=(0,e.extend)([],[],this.parent.enableTimelineVirtualization?t.pdfExportBottomTierCollection:t.bottomTierCollection,!0),this.exportProps&&this.exportProps.fitToWidthSettings&&this.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.enableTimelineVirtualization){var i="None"===t.topTier?"bottomTier":"topTier";this.gantt.chartHeader.width=t.calculateWidthBetweenTwoDate(i,t.timelineStartDate,t.timelineEndDate)}else this.gantt.chartHeader.width=this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:t.totalTimelineWidth;this.gantt.chartHeader.height=this.gantt.rows.getRow(0).height,this.gantt.timelineStartDate=new Date(t.timelineStartDate.getTime())},t.prototype.processPredecessor=function(){var t=this;((0,e.isNullOrUndefined)(this.exportProps.showPredecessorLines)||this.exportProps.showPredecessorLines)&&(this.parent.pdfExportModule.isPdfExport=!0,this.parent.predecessorModule.createConnectorLinesCollection(),this.parent.updatedConnectorLineCollection.forEach((function(e){var i=t.gantt.predecessor.add();i.parentLeft=e.parentLeft,i.childLeft=e.childLeft,i.parentWidth=e.parentWidth,i.childWidth=e.childWidth,i.parentIndex=e.parentIndex,i.childIndex=e.childIndex,i.rowHeight=e.rowHeight,i.type=e.type,i.milestoneParent=e.milestoneParent,i.milestoneChild=e.milestoneChild,i.parentEndPoint=e.parentEndPoint,i.lineWidth=t.parent.connectorLineWidth>5?c(5):c(t.parent.connectorLineWidth),e.isCritical?i.connectorLineColor=t.ganttStyle.criticalConnectorLineColor:i.connectorLineColor=t.ganttStyle.connectorLineColor,t.ganttStyle.connectorLineColor=i.connectorLineColor,t.gantt.predecessorCollection.push(i)})),this.parent.pdfExportModule.isPdfExport=!1)},t.prototype.processRecordRow=function(e){var t=this;this.colIndex=0,this.row.level=e.level,this.columns.forEach((function(i){t.isColumnVisible(i)&&(t.processRecordCell(e,i,t.row),t.colIndex++)}))},t.prototype.processRecordCell=function(t,i,r){var a=r.cells.getCell(this.colIndex),n=this.parent.taskFields,s=t.ganttProperties;"datepickeredit"===i.editType||"datetimepickeredit"===i.editType?a.value=t[i.field]:i.field===n.duration?a.value=this.parent.getDurationString(s.duration,s.durationUnit):i.field===n.resourceInfo?a.value=s.resourceNames:i.field===n.work?a.value=this.parent.getWorkString(s.work,s.workUnit):a.value=(0,e.isNullOrUndefined)(t[i.field])?"":t[i.field].toString();var o=(0,e.isNullOrUndefined)(a.value)?"":a.value.toString(),l=(0,e.isNullOrUndefined)(o)?"":o;a.isHeaderCell=!1,a.style.padding=new Ji,this.copyStyles(this.ganttStyle.cell,a,r.isParentRow),this.colIndex!==this.parent.treeColumnIndex?a.style.format.alignment=Xi.PdfTextAlignment[i.textAlign]:a.style.format.paragraphIndent=10*a.row.level;var d={data:t,value:l,column:i,style:a.style,cell:a};if(d.value=this.exportValueFormatter.formatCellValue(d),this.parent.pdfQueryCellInfo){if(this.parent.trigger("pdfQueryCellInfo",d),d.style.backgroundColor&&(a.style.backgroundColor=d.style.backgroundColor),d.style.borderColor&&(a.style.borderColor=d.style.borderColor),d.style.fontBrush&&(a.style.fontBrush=d.style.fontBrush),d.style.fontColor&&(a.style.fontColor=d.style.fontColor),d.style.fontFamily){var h=d.style.fontFamily,p=this.getFontFamily(h);a.style.fontFamily=p}if(d.style.fontSize&&(a.style.fontSize=d.style.fontSize),d.style.fontStyle){var u=d.style.fontStyle,c=this.getFontStyle(u);a.style.fontStyle=c}d.style.format&&(a.style.format=d.style.format),d.style.padding&&(a.style.padding=d.style.padding)}(0,e.isNullOrUndefined)(d.image)||(0,e.isNullOrUndefined)(d.image.base64)||(d.value=new Xi.PdfBitmap(d.image.base64),d.value.height=d.image.height||d.value.height,d.value.width=d.image.width||d.value.width),a.value=d.value,(0,e.isNullOrUndefined)(d.hyperLink)||(0,e.isNullOrUndefined)(d.hyperLink.displayText)&&(0,e.isNullOrUndefined)(d.hyperLink.target)||(a.value=this.setHyperLink(d))},t.prototype.setHyperLink=function(e){var t=new Xi.PdfTextWebLink;return t.url=e.hyperLink.target,t.text=e.hyperLink.displayText||e.hyperLink.target,t.font=new Xi.PdfStandardFont(Xi.PdfFontFamily.Helvetica,9.75),t.brush=new Xi.PdfSolidBrush(new Xi.PdfColor(51,102,187)),t},t.prototype.processTaskbar=function(){var t=this;this.flatData.forEach((function(i){var r=t.gantt.taskbar.add(),a=i.ganttProperties;r.left=a.left,r.width=a.width,r.left<0&&(r.width=r.width+r.left,r.left=0),r.progress=a.progress,r.isScheduledTask=n(a),n&&((0,e.isNullOrUndefined)(a.endDate)&&(0,e.isNullOrUndefined)(a.duration)?r.unscheduledTaskBy="startDate":(0,e.isNullOrUndefined)(a.startDate)&&(0,e.isNullOrUndefined)(a.duration)?r.unscheduledTaskBy="endDate":(r.unscheduledTaskBy="duration",r.unscheduleStarteDate=t.parent.dateValidationModule.getValidStartDate(i.ganttProperties),r.unscheduleEndDate=t.parent.dateValidationModule.getValidEndDate(i.ganttProperties))),r.startDate=a.startDate,r.endDate=a.endDate,r.height=t.parent.chartRowsModule.taskBarHeight,r.indicators=a.indicators,r.autoStartDate=a.autoStartDate,r.autoEndDate=a.autoEndDate,r.isAutoSchedule=a.isAutoSchedule,r.autoWidth=a.autoWidth,r.autoLeft=a.autoLeft,r.segment=a.segments,r.isSpliterTask=!(0,e.isNullOrUndefined)(a.segments)&&0!==a.segments.length,r.isSpliterTask&&(r.segmentCollection=r.segment.map((function(e){return gr({},e)}))),r.baselineTop=t.parent.chartRowsModule.baselineTop,r.isMilestone=a.isMilestone,r.baselineStartDate=a.baselineStartDate,r.baselineEndDate=a.baselineEndDate,r.baselineLeft=a.baselineLeft,r.baselineWidth=a.baselineWidth,r.milestoneColor=new Xi.PdfColor(t.ganttStyle.taskbar.milestoneColor),r.isParentTask=i.hasChildRecords,a.isMilestone&&(r.height=a.width),i[t.parent.labelSettings.leftLabel]&&(r.leftTaskLabel.value=i[t.parent.labelSettings.leftLabel].toString()),i[t.parent.labelSettings.rightLabel]&&(r.rightTaskLabel.value=i[t.parent.labelSettings.rightLabel].toString()),(0,e.isNullOrUndefined)(i[t.parent.labelSettings.taskLabel])||(r.taskLabel=i[t.parent.labelSettings.taskLabel].toString());var s=a.isMilestone?Math.floor(t.parent.chartRowsModule.taskBarHeight/2)+33:33;r.rightTaskLabel.left=a.left+a.width+s,r.fontFamily=t.ganttStyle.fontFamily,r.progressWidth=a.progressWidth,r.labelColor=new Xi.PdfColor(t.ganttStyle.label.fontColor),r.progressFontColor=new Xi.PdfColor(t.ganttStyle.taskbar.progressFontColor),r.isParentTask?(r.taskColor=new Xi.PdfColor(t.ganttStyle.taskbar.parentTaskColor),r.taskBorderColor=new Xi.PdfColor(t.ganttStyle.taskbar.parentTaskBorderColor),r.progressColor=new Xi.PdfColor(t.ganttStyle.taskbar.parentProgressColor)):i.isCritical?(r.taskColor=new Xi.PdfColor(t.ganttStyle.taskbar.criticalTaskColor),r.progressColor=new Xi.PdfColor(t.ganttStyle.taskbar.criticalProgressColor),r.taskBorderColor=new Xi.PdfColor(t.ganttStyle.taskbar.criticalTaskBorderColor),r.milestoneColor=new Xi.PdfColor(t.ganttStyle.taskbar.criticalTaskColor)):(r.taskColor=new Xi.PdfColor(t.ganttStyle.taskbar.taskColor),r.progressColor=new Xi.PdfColor(t.ganttStyle.taskbar.progressColor),r.taskBorderColor=new Xi.PdfColor(t.ganttStyle.taskbar.taskBorderColor)),r.manualParentBorder=new Xi.PdfColor(t.ganttStyle.taskbar.manualParentBorder),r.manualChildBorder=new Xi.PdfColor(t.ganttStyle.taskbar.manualChildBorder),r.manuallineColor=new Xi.PdfColor(t.ganttStyle.taskbar.manualLineColor),r.unscheduledTaskBarColor=new Xi.PdfColor(t.ganttStyle.taskbar.unscheduledTaskBarColor),r.manualParentBackground=new Xi.PdfColor(t.ganttStyle.taskbar.manualParentBackground),r.manualParentProgress=new Xi.PdfColor(t.ganttStyle.taskbar.manualParentProgress),r.manualChildBackground=new Xi.PdfColor(t.ganttStyle.taskbar.manualChildBackground),r.manualChildProgress=new Xi.PdfColor(t.ganttStyle.taskbar.manualChildProgress),r.splitLineBackground=new Xi.PdfColor(t.ganttStyle.taskbar.splitLineBackground),r.baselineColor=new Xi.PdfColor(t.ganttStyle.taskbar.baselineColor),r.baselineBorderColor=new Xi.PdfColor(t.ganttStyle.taskbar.baselineBorderColor),r.gridLineColor=new Xi.PdfColor(t.ganttStyle.chartGridLineColor);var o={leftLabel:{value:null,image:null,fontStyle:{fontBrush:null}},rightLabel:{value:null,image:null,fontStyle:{fontBrush:null}},taskLabel:{value:null,image:null,fontStyle:{fontBrush:null}}};r.labelSettings=o;var l={value:null,image:null,fontStyle:{fontBrush:null}};r.taskbarTemplate=l,t.gantt.taskbarCollection.push(r);var d={};d.progressFontColor=r.progressFontColor,d.taskColor=r.taskColor,d.taskBorderColor=r.taskBorderColor,d.progressColor=r.progressColor,d.milestoneColor=r.milestoneColor,d.baselineColor=r.baselineColor,d.baselineBorderColor=r.baselineBorderColor;var h={taskbar:d,data:i,indicators:i.ganttProperties.indicators,labelSettings:o,taskbarTemplate:l};if(t.parent.pdfQueryTaskbarInfo){t.parent.trigger("pdfQueryTaskbarInfo",h),r.progressFontColor=h.taskbar.progressFontColor,r.taskColor=h.taskbar.taskColor,r.taskBorderColor=h.taskbar.taskBorderColor,r.progressColor=h.taskbar.progressColor,r.milestoneColor=h.taskbar.milestoneColor,r.baselineColor=h.taskbar.baselineColor,r.baselineBorderColor=h.taskbar.baselineBorderColor,r.indicators=h.indicators,r.labelSettings.leftLabel.value=h.labelSettings.leftLabel.value;var p=h.labelSettings.leftLabel.image;r.labelSettings.rightLabel.value=h.labelSettings.rightLabel.value;var u=h.labelSettings.rightLabel.image;if((0,e.isNullOrUndefined)(h.labelSettings.taskLabel.value)||(r.taskLabel=h.labelSettings.taskLabel.value),!(0,e.isNullOrUndefined)(h.labelSettings.leftLabel.image)&&Array.isArray(h.labelSettings.leftLabel.image[0].base64)&&h.labelSettings.leftLabel.image[0].base64.length>0){var c=h.labelSettings.leftLabel.image[0].base64.length;r.labelSettings.leftLabel.image=[];for(var g=0;g<c;g++)r.labelSettings.leftLabel.image.push({base64:p[0].base64[g],width:p[0].width,height:p[0].height})}else(0,e.isNullOrUndefined)(h.labelSettings.leftLabel.image)||(r.labelSettings.leftLabel.image=h.labelSettings.leftLabel.image);if(!(0,e.isNullOrUndefined)(h.labelSettings.rightLabel.image)&&Array.isArray(h.labelSettings.rightLabel.image[0].base64)&&h.labelSettings.rightLabel.image[0].base64.length>0){c=h.labelSettings.rightLabel.image[0].base64.length;r.labelSettings.rightLabel.image=[];for(g=0;g<c;g++)r.labelSettings.rightLabel.image.push({base64:u[0].base64[g],width:u[0].width,height:u[0].height})}else(0,e.isNullOrUndefined)(h.labelSettings.rightLabel.image)||(r.labelSettings.rightLabel.image=h.labelSettings.rightLabel.image);var f=function(i,a){if(i.progressFontColor=a.taskbar.progressFontColor,i.taskColor=new Xi.PdfColor(a.taskbar.taskColor),i.taskBorderColor=a.taskbar.taskBorderColor,i.progressColor=a.taskbar.progressColor,i.milestoneColor=a.taskbar.milestoneColor,!(0,e.isNullOrUndefined)(a.taskbarTemplate.image)&&!(0,e.isNullOrUndefined)(a.taskbarTemplate.image[0].base64)){var n=a.taskbarTemplate.image[0].width,s=r.isMilestone&&a.taskbarTemplate.image[0].height<.7*t.parent.chartRowsModule.taskBarHeight?a.taskbarTemplate.image[0].height:.7*t.parent.chartRowsModule.taskBarHeight-2,o=(0,e.isNullOrUndefined)(a.taskbarTemplate.image[0].height)?r.height-2:a.taskbarTemplate.image[0].height<r.height?a.taskbarTemplate.image[0].height:r.height-2,l=r.isMilestone?s:o;i.taskbarTemplate.image=a.taskbarTemplate.image,i.taskbarTemplate.image[0].width=n,i.taskbarTemplate.image[0].height=l}(0,e.isNullOrUndefined)(a.taskbarTemplate.value)||(i.taskbarTemplate.value=a.taskbarTemplate.value,i.taskbarTemplate.value=a.taskbarTemplate.value,i.taskbarTemplate.fontStyle.fontColor=a.taskbarTemplate.fontStyle.fontColor,i.taskbarTemplate.fontStyle.fontSize=a.taskbarTemplate.fontStyle.fontSize,i.taskbarTemplate.fontStyle.fontFamily=a.taskbarTemplate.fontStyle.fontFamily,i.taskbarTemplate.fontStyle.fontStyle=a.taskbarTemplate.fontStyle.fontStyle,i.taskbarTemplate.fontStyle.fontBrush=a.taskbarTemplate.fontStyle.fontBrush)};h.data.hasChildRecords||0===h.data.ganttProperties.duration?(h.data.hasChildRecords&&0!==h.data.ganttProperties.duration||0===h.data.ganttProperties.duration)&&f(r,h):f(r,h)}}))},t.prototype.getHorizontalAlignment=function(e,t){switch(void 0===t&&(t=new Xi.PdfStringFormat),e){case"Right":t.alignment=Xi.PdfTextAlignment.Right;break;case"Center":t.alignment=Xi.PdfTextAlignment.Center;break;case"Justify":t.alignment=Xi.PdfTextAlignment.Justify;break;case"Left":t.alignment=Xi.PdfTextAlignment.Left}return t},t.prototype.getVerticalAlignment=function(e,t,i){switch(void 0===t&&(t=new Xi.PdfStringFormat,t=this.getHorizontalAlignment(i,t)),e){case"Bottom":t.lineAlignment=Xi.PdfVerticalAlignment.Bottom;break;case"Middle":t.lineAlignment=Xi.PdfVerticalAlignment.Middle;break;case"Top":t.lineAlignment=Xi.PdfVerticalAlignment.Top}return t},t.prototype.getFontFamily=function(e){switch(e){case"TimesRoman":return 2;case"Courier":return 1;case"Symbol":return 3;case"ZapfDingbats":return 4;default:return 0}},t.prototype.getFontStyle=function(e){switch(e){case"Strikeout":return 8;case"Underline":return 4;case"Italic":return 2;case"Bold":return 1;default:return 0}},t.prototype.getFont=function(t){if(t.font)return t.font;var i=(0,e.isNullOrUndefined)(t.style.fontSize)?9.75:.75*t.style.fontSize,r=(0,e.isNullOrUndefined)(t.style.fontFamily)?Xi.PdfFontFamily.TimesRoman:this.getFontFamily(t.style.fontFamily),a=Xi.PdfFontStyle.Regular;return new Xi.PdfStandardFont(r,i,a)},t.prototype.renderEmptyGantt=function(){var e=this.gantt.rows.addRow();e.cells.getCell(0).isHeaderCell=!1,e.height=c(this.parent.rowHeight),this.copyStyles(this.ganttStyle.columnHeader,e.cells.getCell(0),e.isParentRow);var t=this.columns.length;e.cells.getCell(0).value=this.parent.localeObj.getConstant("emptyRecord"),this.mergeCells(1,0,t)},t.prototype.mergeCells=function(e,t,i){this.gantt.rows.getRow(e).cells.getCell(t).columnSpan=i},t.prototype.copyStyles=function(e,t,i){t.style.fontColor=new Xi.PdfColor(e.fontColor),t.style.backgroundColor=new Xi.PdfColor(e.backgroundColor),t.style.borderColor=new Xi.PdfColor(e.borderColor),t.style.fontSize=e.fontSize,t.style.fontStyle=e.fontStyle,t.style.format=Object.assign(new Xi.PdfStringFormat,e.format),t.style.borders=new Ki,t.style.borders.all=new Xi.PdfPen(t.style.borderColor),t.style.padding=new Ji;var r=0;r=t.isHeaderCell?this.parent.timelineModule.isSingleTier?22.5:30:this.parent.rowHeight/2,t.style.padding.top=r-e.fontSize,t.style.padding.bottom=r-e.fontSize,t.style.padding.left=10,t.style.padding.right=10,e.padding&&(t.style.padding=e.padding),e.borders&&(t.style.borders=e.borders)},t.prototype.initializePdf=function(t){this.pdfDoc=t;var i=[],r=this.pdfDoc.pageSettings.width-82;if(this.exportProps&&this.exportProps.fitToWidthSettings&&this.exportProps.fitToWidthSettings.isFitToWidth){var a=void 0;if(this.exportProps.fitToWidthSettings.gridWidth)a=parseInt(this.exportProps.fitToWidthSettings.gridWidth.split("%")[0],10);else if(this.exportProps.fitToWidthSettings.chartWidth)a=100-parseInt(this.exportProps.fitToWidthSettings.chartWidth.split("%")[0],10);else a=30;for(var n=this.parent.pdfExportModule.pdfPageDimensions.width*a/100/this.gantt.columns.columns.length,s=0;s<this.gantt.columns.columns.length;s++)this.gantt.columns.getColumn(s).width=n}var o=this.parent.pdfExportModule.pdfPage;if(this.totalColumnWidth>this.pdfDoc.pageSettings.width-82&&this.totalColumnWidth<o.getClientSize().width?this.gantt.style.allowHorizontalOverflow=!0:r/this.columns.length<i[0]&&(this.gantt.columns.getColumn(0).width=i[0]),this.exportProps.enableFooter||(0,e.isNullOrUndefined)(this.exportProps.enableFooter)){var l=new Xi.RectangleF(0,0,t.pageSettings.width,35),d=new Xi.PdfPen(this.ganttStyle.chartGridLineColor),h=new Xi.PdfPageTemplateElement(l),p=new Xi.PdfSolidBrush(this.ganttStyle.footer.backgroundColor);h.graphics.drawRectangle(d,p,0,0,t.pageSettings.width,35);var u=new Xi.PdfStandardFont(this.ganttStyle.fontFamily,this.ganttStyle.footer.fontSize,this.ganttStyle.footer.fontStyle);this.ganttStyle.font&&(u=this.ganttStyle.font);var c=new Xi.PdfSolidBrush(this.ganttStyle.footer.fontColor),g=new Xi.PdfPageNumberField(u),f=new Xi.PdfPageCountField(u,c),m=new Xi.PdfCompositeField(u,c,"Page {0}",g,f);m.stringFormat=this.ganttStyle.footer.format,m.bounds=l,m.draw(h.graphics,new Xi.PointF(0,0)),t.template.bottom=h}var y=o.size,D=(0,e.isNullOrUndefined)(y)?this.pdfDoc.pageSettings.size:y;if(!(0,e.isNullOrUndefined)(this.exportProps.header)){var v=this.exportProps.header,k=new Xi.PointF(0,v.fromTop),w=new Xi.SizeF(1.1*D.width,v&&v.height?.75*v.height:50);l=new Xi.RectangleF(k,w);t.template.top=this.drawPageTemplate(new Xi.PdfPageTemplateElement(l),v)}if(!this.exportProps.enableFooter&&!(0,e.isNullOrUndefined)(this.exportProps.footer)){h=this.exportProps.footer,k=new Xi.PointF(0,D.width-80-(h&&h.fromBottom?.75*h.fromBottom:0)),w=new Xi.SizeF(1.1*D.width,h&&h.height?.75*h.height:50),l=new Xi.RectangleF(k,w);this.pdfDoc.template.bottom=this.drawPageTemplate(new Xi.PdfPageTemplateElement(l),h)}},t.prototype.drawPageTemplate=function(e,t){for(var i=0,r=t.contents;i<r.length;i++){var a=r[i];switch(a.type){case"Text":if(""===a.value||void 0===a.value||null===a.value||"string"!=typeof a.value)throw new Error("please enter the valid input value in text content...");this.drawText(e,a);break;case"PageNumber":this.drawPageNumber(e,a);break;case"Image":if(void 0===a.src||null===a.src||""===a.src)throw new Error("please enter the valid base64 string in image content...");this.drawImage(e,a);break;case"Line":this.drawLine(e,a);break;default:throw new Error("Please set valid content type...")}}return e},t.prototype.drawText=function(t,i){var r=this.getFont(i),a=this.getBrushFromContent(i),n=null;if(!(0,e.isNullOrUndefined)(i.style.textPenColor)){var s=this.hexToRgb(i.style.textPenColor);n=new Xi.PdfPen(new Xi.PdfColor(s.r,s.g,s.b))}null===a&&null===n&&(a=new Xi.PdfSolidBrush(new Xi.PdfColor(0,0,0)));var o=i.value.toString(),l=.75*i.position.x,d=.75*i.position.y,h=new Xi.PdfStringFormat;(0,e.isNullOrUndefined)(i.style.stringFormat)||(h.alignment=i.style.stringFormat.alignment);var p=this.setContentFormat(i,h);null===p||(0,e.isNullOrUndefined)(p.format)||(0,e.isNullOrUndefined)(p.size)?t.graphics.drawString(o,r,n,a,l,d,h):t.graphics.drawString(o,r,n,a,l,d,p.size.width,p.size.height,p.format)},t.prototype.drawPageNumber=function(t,i){var r=this.getFont(i),a=null;if((0,e.isNullOrUndefined)(i.style.textBrushColor))a=new Xi.PdfSolidBrush(new Xi.PdfColor(0,0,0));else{var n=this.hexToRgb(i.style.textBrushColor);a=new Xi.PdfSolidBrush(new Xi.PdfColor(n.r,n.g,n.b))}var s,o,l=new Xi.PdfPageNumberField(r,a);if(l.numberStyle=this.getPageNumberStyle(i.pageNumberType),(0,e.isNullOrUndefined)(i.format))o="{0}",s=new Xi.PdfCompositeField(r,a,o,l);else{var d="$total",h="$current";if(-1!==i.format.indexOf(d)&&-1!==i.format.indexOf(h))(p=new Xi.PdfPageCountField(r)).numberStyle=this.getPageNumberStyle(i.pageNumberType),o=i.format.indexOf(d)>i.format.indexOf(h)?(o=i.format.replace(h,"0")).replace(d,"1"):(o=i.format.replace(h,"1")).replace(d,"0"),s=new Xi.PdfCompositeField(r,a,o,l,p);else if(-1!==i.format.indexOf(h)&&-1===i.format.indexOf(d))o=i.format.replace(h,"0"),s=new Xi.PdfCompositeField(r,a,o,l);else{var p=new Xi.PdfPageCountField(r);o=i.format.replace(d,"0"),s=new Xi.PdfCompositeField(r,a,o,p)}}var u=.75*i.position.x,c=.75*i.position.y,g=this.setContentFormat(i,s.stringFormat);null===g||(0,e.isNullOrUndefined)(g.format)||(0,e.isNullOrUndefined)(g.size)||(s.stringFormat=g.format,s.bounds=new Xi.RectangleF(u,c,g.size.width,g.size.height)),s.draw(t.graphics,u,c)},t.prototype.drawImage=function(t,i){var r=.75*i.position.x,a=.75*i.position.y,n=(0,e.isNullOrUndefined)(i.size)||(0,e.isNullOrUndefined)(i.size.width)?void 0:.5*i.size.width,s=(0,e.isNullOrUndefined)(i.size)||(0,e.isNullOrUndefined)(i.size.height)?void 0:.75*i.size.height,o=new Xi.PdfBitmap(i.src);(0,e.isNullOrUndefined)(n)?t.graphics.drawImage(o,r,a):t.graphics.drawImage(o,r,a,n,s)},t.prototype.drawLine=function(t,i){var r=.75*i.points.x1,a=.75*i.points.y1,n=.75*i.points.x2,s=.75*i.points.y2,o=this.getPenFromContent(i);(0,e.isNullOrUndefined)(i.style)||((0,e.isNullOrUndefined)(i.style.penSize)||"number"!=typeof i.style.penSize||(o.width=.75*i.style.penSize),o.dashStyle=this.getDashStyle(i.style.dashStyle)),t.graphics.drawLine(o,r,a,n,s)},t.prototype.getPenFromContent=function(t){var i=new Xi.PdfPen(new Xi.PdfColor(0,0,0));if(!(0,e.isNullOrUndefined)(t.style)&&null!==t.style&&!(0,e.isNullOrUndefined)(t.style.penColor)){var r=this.hexToRgb(t.style.penColor);i=new Xi.PdfPen(new Xi.PdfColor(r.r,r.g,r.b))}return i},t.prototype.getDashStyle=function(e){switch(e){case"Dash":return 1;case"Dot":return 2;case"DashDot":return 3;case"DashDotDot":return 4;default:return 0}},t.prototype.getBrushFromContent=function(t){var i=null;if(!(0,e.isNullOrUndefined)(t.style.textBrushColor)){var r=this.hexToRgb(t.style.textBrushColor);i=new Xi.PdfSolidBrush(new Xi.PdfColor(r.r,r.g,r.b))}return i},t.prototype.hexToRgb=function(e){if(null===e||""===e||7!==e.length)throw new Error("please set valid hex value for color...");e=e.substring(1);var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},t.prototype.setContentFormat=function(t,i){var r=t.size?.75*t.size.width:this.pdfDoc.pageSettings.size.width,a=t.size?.75*t.size.height:(0,e.isNullOrUndefined)(this.exportProps.footer)?0:.5*this.exportProps.footer.height;if(i=new Xi.PdfStringFormat(Xi.PdfTextAlignment.Left,Xi.PdfVerticalAlignment.Middle),!(0,e.isNullOrUndefined)(t.style.hAlign))switch(t.style.hAlign){case"Right":i.alignment=Xi.PdfTextAlignment.Right;break;case"Center":i.alignment=Xi.PdfTextAlignment.Center;break;case"Justify":i.alignment=Xi.PdfTextAlignment.Justify;break;default:i.alignment=Xi.PdfTextAlignment.Left}return(0,e.isNullOrUndefined)(t.style.vAlign)||(i=this.getVerticalAlignment(t.style.vAlign,i)),{format:i,size:new Xi.SizeF(r,a)}},t.prototype.getPageNumberStyle=function(e){switch(e){case"LowerLatin":return 2;case"LowerRoman":return 3;case"UpperLatin":return 4;case"UpperRoman":return 5;default:return 1}},t}(),mr=function(){function t(t){this.valueFormatter=new i.ValueFormatter(t),this.internationalization=new e.Internationalization(t)}return t.prototype.returnFormattedValue=function(t,i){return!(0,e.isNullOrUndefined)(t.value)&&t.value?this.valueFormatter.getFormatFunction(i)(t.value):""},t.prototype.formatCellValue=function(t){if(t.isForeignKey&&(t.value=(0,e.getValue)(t.column.foreignKeyValue,(0,i.getForeignData)(t.column,{},t.value)[0])),"number"===t.column.type&&void 0!==t.column.format&&""!==t.column.format)return t.value?this.internationalization.getNumberFormat({format:t.column.format})(t.value):"";if("boolean"===t.column.type)return t.value?"true":"false";if("date"!==t.column.type&&"datetime"!==t.column.type&&"time"!==t.column.type||void 0===t.column.format)return((0,e.isNullOrUndefined)(t.column.type)||(0,e.isNullOrUndefined)(t.value))&&(0,e.isNullOrUndefined)(t.value)?"":t.value.toString();if("string"==typeof t.value&&(t.value=new Date(t.value)),"string"==typeof t.column.format){var r=void 0;return r="date"===t.column.type?{type:"date",format:t.column.format}:"time"===t.column.type?{type:"time",format:t.column.format}:{type:"dateTime",format:t.column.format},this.returnFormattedValue(t,r)}if(t.column.format instanceof Object&&void 0===t.column.format.type)return t.value.toString();var a=void 0;return a="date"===t.column.type?{type:t.column.format.type,format:t.column.format.format,skeleton:t.column.format.skeleton}:"time"===t.column.type?{type:"time",format:t.column.format.format,skeleton:t.column.format.skeleton}:{type:"dateTime",format:t.column.format.format,skeleton:t.column.format.skeleton},this.returnFormattedValue(t,a)},t}(),yr=function(){return yr=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},yr.apply(this,arguments)},Dr=function(){function t(e){this.baselineHeight=8,this.segment=[],this.segmentCollection=[],this.leftTaskLabel={},this.rightTaskLabel={},this.startPage=-1,this.endPage=-1,this.parent=e}return t.prototype.add=function(){return new t(this.parent)},t.prototype.GetNextPage=function(e){var t=e.section,i=t.indexOf(e);return i===t.count-1?t.add():t.getPages()[i+1]},t.prototype.isAutoFit=function(){return!!(this.parent.pdfExportModule&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth||this.parent.timelineModule.isZoomedToFit)},t.prototype.drawTaskbar=function(t,i,r,a,n,s,o){var l=this,d=t.graphics,h=!1,p=t.getClientSize();if(i.y+n>p.height){(t=this.GetNextPage(t)).contentWidth=this.isAutoFit()?g(r.endPoint-r.startPoint):r.endPoint-r.startPoint,d=t.graphics,i.y=0,this.parent.pdfExportModule.gantt.enableHeader&&(this.parent.pdfExportModule.gantt.chartHeader.drawPageTimeline(t,i,r),i.y=c(this.parent.timelineModule.isSingleTier?45:60)),h=!0;var u=t.graphics,f=new Xi.PdfPen(new Xi.PdfColor(206,206,206));!t.contentWidth||"Both"!==this.parent.gridLines&&"Horizontal"!==this.parent.gridLines||u.drawRectangle(f,i.x,i.y,this.isAutoFit()&&"Day"!==this.parent.timelineModule.bottomTier?t.contentWidth+.5:o,n)}this.drawLeftLabel(t,i,r,a,s);var m,y,D,v,k,w=new Xi.PdfStandardFont(this.fontFamily,9,Xi.PdfFontStyle.Regular),b=null,T=new Xi.PdfSolidBrush(this.progressFontColor);(m=!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)&&s.taskbarTemplate.fontStyle&&s.taskbarTemplate.fontStyle.fontFamily&&s.taskbarTemplate.fontStyle.fontSize?new Xi.PdfStandardFont(s.taskbarTemplate.fontStyle.fontFamily,s.taskbarTemplate.fontStyle.fontSize,s.taskbarTemplate.fontStyle.fontStyle):w,y=!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)&&s.taskbarTemplate.fontStyle&&s.taskbarTemplate.fontStyle.fontColor?new Xi.PdfSolidBrush(s.taskbarTemplate.fontStyle.fontColor):T,D=!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)&&s.taskbarTemplate.fontStyle&&s.taskbarTemplate.fontStyle.fontBrush?new Xi.PdfPen(s.taskbarTemplate.fontStyle.fontBrush):b,!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(w=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),s.labelSettings.taskLabel.fontStyle.fontSize)?v=new Xi.PdfStandardFont(s.labelSettings.taskLabel.fontStyle.fontFamily,s.labelSettings.taskLabel.fontStyle.fontSize,s.labelSettings.taskLabel.fontStyle.fontStyle):v=w;k=s.labelSettings.taskLabel.fontStyle.fontColor?new Xi.PdfSolidBrush(s.labelSettings.taskLabel.fontStyle.fontColor):T;var P=new Xi.PdfStringFormat;P.lineAlignment=Xi.PdfVerticalAlignment.Middle,P.alignment=Xi.PdfTextAlignment.Right;var S,C=!1;!(0,e.isNullOrUndefined)(this.taskLabel)&&/^[a-zA-Z0-9]/.test(this.taskLabel)&&("0"!==this.taskLabel&&"0%"!==this.taskLabel||(S=this.width,P.alignment=Xi.PdfTextAlignment.Left)),(!(0,e.isNullOrUndefined)(this.taskLabel)&&/^[a-zA-Z]/.test(this.taskLabel)||!(0,e.isNullOrUndefined)(s.taskbarTemplate.value))&&(C=!0,P.alignment=Xi.PdfTextAlignment.Left);var R=-1,M=new Xi.PdfPen(s.baselineBorderColor),x=new Xi.PdfSolidBrush(s.baselineColor),O=s.taskbarTemplate;if(s.isMilestone)this.drawMilestone(t,i,r,a,s),this.parent.renderBaseline&&s.baselineStartDate&&s.baselineEndDate&&this.drawMilestone(t,i,r,a,s);else{var I=new Xi.PdfPen(s.taskBorderColor),E=new Xi.PdfSolidBrush(s.taskColor),F=new Xi.PdfPen(s.manualParentBorder),U=new Xi.PdfPen(s.manualChildBorder),N=new Xi.PdfPen(s.manuallineColor),L=(new Xi.PdfPen(s.manualParentProgress),new Xi.PdfPen(s.manuallineColor)),V=new Xi.PdfSolidBrush(s.manuallineColor),B=new Xi.PdfPen(s.splitLineBackground),A=new Xi.PdfSolidBrush(s.manualParentBackground),W=new Xi.PdfSolidBrush(s.manualChildBackground),H=new Xi.PdfSolidBrush(s.manualChildProgress),j=new Xi.PdfSolidBrush(s.manualParentProgress),G=new Xi.PdfPen(s.progressColor),z=new Xi.PdfSolidBrush(s.progressColor),q=c((this.parent.rowHeight-this.height)/2),_=c((this.parent.rowHeight-this.height)/4.5),Z=this.parent.renderBaseline?_:q;R=t.section.indexOf(t);var X=(0,e.isNullOrUndefined)(this.unscheduleStarteDate)?this.startDate:this.unscheduleStarteDate,Y=(0,e.isNullOrUndefined)(this.unscheduleEndDate)?this.endDate:this.unscheduleEndDate,Q=10;if(r.startDate<=X&&Y<=r.endDate){if(this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.isScheduledTask||"duration"!==this.unscheduledTaskBy)if(this.isScheduledTask||"endDate"!==this.unscheduledTaskBy)if(this.isScheduledTask||"duration"===this.unscheduledTaskBy){if(s.isSpliterTask)B.dashStyle=Xi.PdfDashStyle.Dot,this.isAutoFit()?d.drawLine(B,new Xi.PointF(i.x+(this.left-a)+.5,i.y+Z+c(s.height/2)),new Xi.PointF(s.width+i.x+(this.left-a)+.5,i.y+Z+c(s.height/2))):d.drawLine(B,new Xi.PointF(i.x+c(this.left-a)+.5,i.y+Z+c(s.height/2)),new Xi.PointF(c(s.width)+i.x+c(this.left-a)+.5,i.y+Z+c(s.height/2))),s.segment.map((function(t){if(l.isAutoFit()){if(d.drawRectangle(I,E,i.x+(l.left+t.left-a)+.5,i.y+Z,t.width,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){var r=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage(r,i.x+(l.left+t.left-a)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}var n=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(l.left+t.left-a)+.5+n,i.y+Z,c(t.width),c(s.height),P)}}else if(d.drawRectangle(I,E,i.x+c(l.left+t.left-a)+.5,i.y+Z,c(t.width),c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){r=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage(r,i.x+c(l.left+t.left-a)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}n=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(l.left+t.left-a)+.5+n,i.y+Z,c(t.width),c(s.height),P)}}));else if(!s.isAutoSchedule&&s.isParentTask){d.save(),(ae=new Xi.PdfPath).addEllipse(0,0,5,5),this.isAutoFit()?d.translateTransform(i.x+(this.left-a)+.5,i.y+Z-2):d.translateTransform(i.x+c(this.left-a)+.5,i.y+Z-2),d.drawPath(N,V,ae),d.restore(),(pe=new Xi.PdfPath).addEllipse(0,0,5,5),d.save(),this.isAutoFit()?d.translateTransform(i.x+(this.left-a)+.5+this.width,i.y+Z-2):d.translateTransform(i.x+c(this.left-a)+.5+c(this.width),i.y+Z-2),d.drawPath(N,V,pe),d.restore(),L.dashStyle=Xi.PdfDashStyle.Solid,this.isAutoFit()?d.drawLine(L,new Xi.PointF(i.x+(this.left-a)+.5,i.y+Z),new Xi.PointF(s.width+i.x+(this.left-a)+.5,i.y+Z)):d.drawLine(L,new Xi.PointF(i.x+c(this.left-a)+.5,i.y+Z),new Xi.PointF(c(s.width)+i.x+c(this.left-a)+.5,i.y+Z))}else if(s.isAutoSchedule||s.isParentTask)if(this.isAutoFit())if((0,e.isNullOrUndefined)(O.value)&&(0,e.isNullOrUndefined)(O.image))d.drawRectangle(I,E,i.x+(this.left-a)+.5,i.y+Z,s.width,c(s.height));else{if(d.drawRectangle(I,E,i.x+(this.left-a)+.5,i.y+Z,s.width,c(s.height)),!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+(this.left-a)+.5,i.y+Z+(s.height-s.taskbarTemplate.image[0].height)/2,s.taskbarTemplate.image[0].width/2,s.taskbarTemplate.image[0].height/2)}if(s.taskbarTemplate.value){C&&(S=this.width);ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width/2;d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(this.left-a)+ee,i.y+Z,S,c(this.height),P)}}else if((0,e.isNullOrUndefined)(O.value)&&(0,e.isNullOrUndefined)(O.image))d.drawRectangle(I,E,i.x+c(this.left-a)+.5,i.y+Z,c(s.width),c(s.height));else{if(d.drawRectangle(I,E,i.x+c(this.left-a)+.5,i.y+Z,c(s.width),c(s.height)),!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+c(this.left-a)+1,i.y+Z+1+c((s.height-s.taskbarTemplate.image[0].height)/2),c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(this.left-a)+ee,i.y+Z,c(S),c(this.height),P)}else d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(U,W,i.x+(this.left-a)+.5,i.y+Z,s.width,c(s.height)):d.drawRectangle(U,W,i.x+c(this.left-a)+.5,i.y+Z,c(s.width),c(s.height)),d.restore(),this.isAutoFit()?d.drawRectangle(null,H,i.x+(this.left-a)+.5,i.y+Z,s.progressWidth,c(this.height)):d.drawRectangle(null,H,i.x+c(this.left-a)+.5,i.y+Z,c(s.progressWidth),c(this.height));this.isScheduledTask&&s.isAutoSchedule&&!s.isSpliterTask?(0,e.isNullOrUndefined)(O.image)&&(0,e.isNullOrUndefined)(O.value)&&(this.isAutoFit()?d.drawRectangle(G,z,i.x+(this.left-a)+.5,i.y+Z,s.progressWidth,c(s.height)):d.drawRectangle(G,z,i.x+c(this.left-a)+.5,i.y+Z,c(s.progressWidth),c(s.height)),(0,e.isNullOrUndefined)(this.parent.labelSettings.taskLabel)||(0,e.isNullOrUndefined)(this.taskLabel)||("0"!==this.taskLabel&&"0%"!==this.taskLabel&&(S=this.progressWidth),C&&(S=this.width),this.isAutoFit()?d.drawString(this.taskLabel.toString(),v,b,k,i.x+(this.left-a),i.y+Z,S,c(this.height),P):d.drawString(this.taskLabel.toString(),v,b,k,i.x+c(this.left-a),i.y+Z,c(S),c(this.height),P))):s.isSpliterTask&&s.segment.map((function(e){l.isAutoFit()?d.drawRectangle(G,z,i.x+(l.left+e.left-a)+.5,i.y+Z,e.progressWidth,c(s.height)):d.drawRectangle(G,z,i.x+c(l.left+e.left-a)+.5,i.y+Z,c(e.progressWidth),c(s.height))}))}else this.drawUnscheduledTask(d,i,a,Z);else this.drawUnscheduledTask(d,i,a,Z);else{var K=void 0,J=void 0;if(this.isAutoFit()){if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+(this.left-a)+.5+s.width/2,0),new Xi.PointF(i.x+(this.left-a),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+(this.left-a)+.5,i.y+Z,s.width,c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+(this.left-a)+.5+s.width,0),new Xi.PointF(i.x+(this.left-a)+s.width/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+(this.left-a)+.5+s.width/2,i.y+Z,s.width/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){var $=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+(this.left-a)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}var ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(this.left-a)+.5+ee,i.y+Z,c(s.width),c(this.height),P)}}else if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(this.left-a)+.5+c(s.width)/2,0),new Xi.PointF(i.x+c(this.left-a),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+c(this.left-a)+.5,i.y+Z,c(s.width),c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(this.left-a)+.5+c(s.width),0),new Xi.PointF(i.x+c(this.left-a)+c(s.width)/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+c(this.left-a)+.5+c(s.width)/2,i.y+Z,c(s.width)/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){var $=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+c(this.left-a)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}var ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(this.left-a)+.5+ee,i.y+Z,c(s.width),c(this.height),P)}}this.isCompleted=!0,this.startPage=R,this.endPage=R}else if(r.startDate<=X&&r.endDate>=X&&Y>=r.endDate){this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0);var te,ie=0,re=0;if(this.width=this.width-(r.totalWidth-(this.left-a)),te=r.totalWidth-(this.left-a),ie=r.totalWidth-(this.left-a),re=te,this.isScheduledTask||"duration"!==this.unscheduledTaskBy)if(this.isScheduledTask||"duration"===this.unscheduledTaskBy)if(!s.isAutoSchedule&&s.isParentTask){var ae;d.save(),(ae=new Xi.PdfPath).addEllipse(0,0,5,5),this.isAutoFit()?d.translateTransform(i.x+(this.left-a)+.5,i.y+Z-2):d.translateTransform(i.x+c(this.left-a)+.5,i.y+Z-2),d.drawPath(N,V,ae),d.restore(),L.dashStyle=Xi.PdfDashStyle.Solid,this.isAutoFit()?d.drawLine(L,new Xi.PointF(i.x+(this.left-a)+.5,i.y+Z),new Xi.PointF(te+i.x+(this.left-a)+.5,i.y+Z)):d.drawLine(L,new Xi.PointF(i.x+c(this.left-a)+.5,i.y+Z),new Xi.PointF(c(te)+i.x+c(this.left-a)+.5,i.y+Z))}else if(s.isAutoSchedule||s.isParentTask)if(this.isScheduledTask||"duration"===this.unscheduledTaskBy)if(this.isScheduledTask||"endDate"!==this.unscheduledTaskBy){if(s.isSpliterTask){var ne=0,se=!0,oe=0;s.segment.map((function(e){oe=e.left+e.width})),B.dashStyle=Xi.PdfDashStyle.Dot,this.isAutoFit()?d.drawLine(B,new Xi.PointF(i.x+(this.left-a)+.5,i.y+Z+c(s.height/2)),new Xi.PointF(oe+(this.left-a)+i.x,i.y+Z+c(s.height/2))):d.drawLine(B,new Xi.PointF(i.x+c(this.left-a)+.5,i.y+Z+c(s.height/2)),new Xi.PointF(c(oe)+c(this.left-a)+i.x,i.y+Z+c(s.height/2))),s.segment.map((function(t,r){if(l.isAutoFit()){if(d.drawRectangle(I,E,i.x+(l.left-a)+.5+t.left,i.y+Z,t.width,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){var n=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage(n,i.x+(l.left-a)+.5+t.left,i.y+Z,s.taskbarTemplate.image[0].width,s.taskbarTemplate.image[0].height)}var o=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(l.left-a)+.5+t.left+o,i.y+Z,t.width,s.height,P)}}else if(d.drawRectangle(I,E,i.x+c(l.left-a)+.5+c(t.left),i.y+Z,c(t.width),c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){n=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage(n,i.x+c(l.left-a)+.5+c(t.left),i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}o=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(l.left-a)+.5+c(t.left)+o,i.y+Z,c(t.width),c(s.height),P)}ne=t.left+t.width,te>=ne?(l.segmentCollection[parseInt(r.toString(),10)].width=0,l.segmentCollection[parseInt(r.toString(),10)].left=0):(te>=ne-t.width?l.segmentCollection[parseInt(r.toString(),10)].left=0:l.segmentCollection[parseInt(r.toString(),10)].left=re-t.left,te>=ne?l.segmentCollection[parseInt(r.toString(),10)].width=0:se&&(l.segmentCollection[parseInt(r.toString(),10)].width=ne-te,se=!1)),re=re+t.width+t.left}))}else{if(this.isAutoFit())if((0,e.isNullOrUndefined)(O.value)&&(0,e.isNullOrUndefined)(O.image))d.drawRectangle(I,E,i.x+(this.left-a)+.5,i.y+Z,te,c(s.height));else{if(d.drawRectangle(I,E,i.x+(this.left-a)+.5,i.y+Z,te,c(s.height)),!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+(this.left-a)+.5,i.y+Z+c((s.height-s.taskbarTemplate.image[0].height)/.5),s.taskbarTemplate.image[0].width/2,s.taskbarTemplate.image[0].height/2)}if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)){ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(this.left-a)+ee,i.y+Z,c(S),c(this.height),P)}}else if((0,e.isNullOrUndefined)(O.value)&&(0,e.isNullOrUndefined)(O.image))d.drawRectangle(I,E,i.x+c(this.left-a)+.5,i.y+Z,c(te),c(s.height));else{if(d.drawRectangle(I,E,i.x+c(this.left-a)+.5,i.y+Z,c(te),c(s.height)),!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+c(this.left-a)+1,i.y+Z+1+c((s.height-s.taskbarTemplate.image[0].height)/2),c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)){ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;this.stringLeft=c(this.left);var le=this.getWidth(s.taskbarTemplate.value,r.endPoint-this.stringLeft,15);d.drawString(le.lines[0].text,m,D,y,i.x+c(this.left-a)+ee,i.y+Z,c(S),c(this.height),P),(0,e.isNullOrUndefined)(le.remainder)||(this.remainString=le.remainder,this.stringLeft=r.endPoint)}}if(s.isAutoSchedule&&!s.isSpliterTask){var de=0;if(de=this.progressWidth<=te?this.progressWidth:te,(0,e.isNullOrUndefined)(O.image)&&(0,e.isNullOrUndefined)(O.value)&&(this.isAutoFit()?d.drawRectangle(G,z,i.x+(this.left-a)+.5,i.y+Z,de,c(s.height)):d.drawRectangle(G,z,i.x+c(this.left-a)+.5,i.y+Z,c(de),c(s.height))),this.progressWidth-=de,this.parent.labelSettings.taskLabel&&!(0,e.isNullOrUndefined)(this.taskLabel))if(S=de,C&&(S=te),this.stringLeft=this.left,(0,e.isNullOrUndefined)(s.taskbarTemplate.value)){var he=this.getWidth(this.taskLabel.toString(),r.endPoint-this.stringLeft,15);d.drawString(he.lines[0].text,v,b,k,i.x+c(this.left-a),i.y+Z,c(S),c(this.height),P),(0,e.isNullOrUndefined)(he.remainder)||(this.remainString=he.remainder,this.stringLeft=r.endPoint)}else this.isAutoFit()?d.drawString(this.taskLabel.toString(),v,b,k,i.x+(this.left-a),i.y+Z,S,c(this.height),P):d.drawString(this.taskLabel.toString(),v,b,k,i.x+c(this.left-a),i.y+Z,c(S),c(this.height),P)}}if(s.isSpliterTask&&s.isAutoSchedule&&!s.isSpliterTask){de=0;de=this.progressWidth<=te?this.progressWidth:te,(0,e.isNullOrUndefined)(O.image)&&(0,e.isNullOrUndefined)(O.value)&&(this.isAutoFit()?d.drawRectangle(G,z,i.x+(this.left-a)+.5,i.y+Z,de,c(s.height)):d.drawRectangle(G,z,i.x+c(this.left-a)+.5,i.y+Z,c(de),c(s.height))),this.progressWidth-=de,this.parent.labelSettings.taskLabel&&!(0,e.isNullOrUndefined)(this.taskLabel)&&(S=de,C&&(S=this.width),this.isAutoFit()?d.drawString(this.taskLabel.toString(),v,b,k,i.x+(this.left-a),i.y+Z,S,c(this.height),P):d.drawString(this.taskLabel.toString(),v,b,k,i.x+c(this.left-a),i.y+Z,c(S),c(this.height),P))}else s.isSpliterTask&&s.segment.map((function(e,t){l.isAutoFit()?d.drawRectangle(G,z,i.x+(l.left+e.left-a)+.5,i.y+Z,e.progressWidth,c(s.height)):d.drawRectangle(G,z,i.x+c(l.left+e.left-a)+.5,i.y+Z,c(e.progressWidth),c(s.height)),0===l.segmentCollection[parseInt(t.toString(),10)].width?l.segmentCollection[parseInt(t.toString(),10)].progressWidth=0:e.width-l.segmentCollection[parseInt(t.toString(),10)].width<e.progressWidth&&e.width!==l.segmentCollection[t].width&&(l.segmentCollection[parseInt(t.toString(),10)].progressWidth=e.progressWidth-(e.width-l.segmentCollection[t].width))}))}else this.drawUnscheduledTask(d,i,a,Z);else this.drawUnscheduledTask(d,i,a,Z);else this.isAutoFit()?d.drawRectangle(U,null,i.x+(this.left-a)+.5,i.y+Z,te,c(s.height)):d.drawRectangle(U,null,i.x+c(this.left-a)+.5,i.y+Z,c(te),c(s.height)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,W,i.x+(this.left-a)+.5,i.y+Z,te,c(s.height)):d.drawRectangle(null,W,i.x+c(this.left-a)+.5,i.y+Z,c(te),c(s.height)),d.restore(),this.isAutoFit()?d.drawRectangle(null,H,i.x+(this.left-a)+.5,i.y+Z,ie,c(s.height)):d.drawRectangle(null,H,i.x+c(this.left-a)+.5,i.y+Z,c(ie),c(s.height)),s.progressWidth=s.progressWidth-ie;else this.drawUnscheduledTask(d,i,a,Z);else{K=void 0,J=void 0;if(this.isAutoFit()){if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+(this.left-a)+.5+te/2,0),new Xi.PointF(i.x+(this.left-a),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+(this.left-a)+.5,i.y+Z,te,c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+(this.left-a)+.5+te,0),new Xi.PointF(i.x+(this.left-a)+te/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+(this.left-a)+.5+te/2,i.y+Z,te/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){var $=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+(this.left-a)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}var ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(this.left-a)+.5+ee,i.y+Z,c(s.width),c(this.height),P)}}else if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(this.left-a)+.5+c(te)/2,0),new Xi.PointF(i.x+c(this.left-a),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+c(this.left-a)+.5,i.y+Z,c(te),c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(this.left-a)+.5+c(te),0),new Xi.PointF(i.x+c(this.left-a)+c(te)/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+c(this.left-a)+.5+c(te)/2,i.y+Z,c(te)/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+c(this.left-a)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(this.left-a)+.5+ee,i.y+Z,c(s.width),c(this.height),P)}}this.left=0,this.isCompleted=!1,this.startPage=R}else if(Y<=r.endDate&&r.startDate<=Y&&!this.isCompleted){if(this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.isScheduledTask||"duration"!==this.unscheduledTaskBy)if(!s.isAutoSchedule&&s.isParentTask){var pe;(pe=new Xi.PdfPath).addEllipse(0,0,5,5),d.save(),this.isAutoFit()?d.translateTransform(i.x+this.width,i.y+Z-2):d.translateTransform(i.x+c(this.width)-5,i.y+Z-2),d.drawPath(N,V,pe),d.restore(),L.dashStyle=Xi.PdfDashStyle.Solid,this.isAutoFit()?d.drawLine(L,new Xi.PointF(i.x,i.y+Z),new Xi.PointF(s.width,i.y+Z)):d.drawLine(L,new Xi.PointF(i.x,i.y+Z),new Xi.PointF(c(s.width),i.y+Z))}else if(s.isAutoSchedule||s.isParentTask)if(this.isScheduledTask||"endDate"!==this.unscheduledTaskBy){if(s.isSpliterTask)B.dashStyle=Xi.PdfDashStyle.Dot,this.isAutoFit()?d.drawLine(B,new Xi.PointF(i.x+this.left+.5,i.y+Z+c(s.height/2)),new Xi.PointF(s.width+i.x+this.left,i.y+Z+c(s.height/2))):d.drawLine(B,new Xi.PointF(i.x+c(this.left)+.5,i.y+Z+c(s.height/2)),new Xi.PointF(c(s.width)+i.x+c(this.left),i.y+Z+c(s.height/2))),s.segmentCollection.map((function(t){if(0!==t.width)if(l.isAutoFit()){if(d.drawRectangle(I,E,i.x+(s.left+.5+t.left),i.y+Z,t.width,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){var r=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage(r,i.x+(s.left+.5+t.left),i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}var a=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(s.left+.5+t.left)+a,i.y+Z,c(t.width),c(s.height),P)}}else if(d.drawRectangle(I,E,i.x+c(s.left+.5+t.left),i.y+Z,c(t.width),c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){r=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage(r,i.x+c(s.left+.5+t.left),i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}a=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(s.left+.5+t.left)+a,i.y+Z,c(t.width),c(s.height),P)}}));else if(this.isAutoFit()){if(d.drawRectangle(I,E,i.x+(s.left+.5),i.y+Z,s.width,c(s.height)),!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)&&!(0,e.isNullOrUndefined)(this.remainString)){var ue=this.getWidth(this.remainString,r.endPoint-this.stringLeft,15);d.drawString(ue.lines[0].text,m,D,y,i.x+this.left,i.y+Z,S,this.height,P)}}else if(d.drawRectangle(I,E,i.x+c(s.left+.5),i.y+Z,c(s.width),c(s.height)),!(0,e.isNullOrUndefined)(this.remainString)){var ce=this.getWidth(this.remainString,s.width-s.left,15);d.drawString(ce.lines[0].text,m,D,y,i.x+c(s.left),i.y+Z,ce.actualSize.width,c(this.height),P)}}else this.drawUnscheduledTask(d,i,a,Z);else this.isAutoFit()?d.drawRectangle(U,null,i.x+s.left+.5,i.y+Z,s.width,s.height):d.drawRectangle(U,null,i.x+c(s.left+.5),i.y+Z,c(s.width),c(s.height)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,W,i.x+s.left+.5,i.y+Z,s.width,s.height):d.drawRectangle(null,W,i.x+c(s.left+.5),i.y+Z,c(s.width),c(s.height)),d.restore(),this.isAutoFit()?d.drawRectangle(null,H,i.x+s.left+.5,i.y+Z,s.progressWidth,s.height):d.drawRectangle(null,H,i.x+c(s.left+.5),i.y+Z,c(s.progressWidth),c(s.height));else{K=void 0,J=void 0;if(this.isAutoFit()){if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+(s.left+.5)+s.width/2,0),new Xi.PointF(i.x+(s.left+.5),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+(s.left+.5),i.y+Z,s.width,c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+(s.left+.5)+s.width,0),new Xi.PointF(i.x+(s.left+.5)+s.width/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+(s.left+.5)+s.width/2,i.y+Z,s.width/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+(s.left+.5),i.y+Z,s.taskbarTemplate.image[0].width,c(s.taskbarTemplate.image[0].height))}ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+(s.left+.5)+ee,i.y+Z,s.width,c(this.height),P)}}else if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(s.left+.5)+c(s.width)/2,0),new Xi.PointF(i.x+c(s.left+.5),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+c(s.left+.5),i.y+Z,c(s.width),c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(s.left+.5)+c(s.width),0),new Xi.PointF(i.x+c(s.left+.5)+c(s.width)/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+c(s.left+.5)+c(s.width)/2,i.y+Z,c(s.width)/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+c(s.left+.5),i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(s.left+.5)+ee,i.y+Z,c(s.width),c(this.height),P)}}if(this.isScheduledTask&&s.isAutoSchedule&&!s.isSpliterTask){if((0,e.isNullOrUndefined)(O.image)&&(0,e.isNullOrUndefined)(O.value)&&(this.isAutoFit()?d.drawRectangle(G,z,i.x+(s.left+.5),i.y+Z,s.progressWidth,c(s.height)):d.drawRectangle(G,z,i.x+c(s.left+.5),i.y+Z,c(s.progressWidth),c(s.height))),!(0,e.isNullOrUndefined)(this.taskLabel)){if(S=this.progressWidth,C&&(S=this.width),(0,e.isNullOrUndefined)(s.taskbarTemplate.value))if(this.isAutoFit())d.drawString(this.taskLabel.toString(),v,b,k,i.x+this.left,i.y+Z,S,c(this.height),P);else if((0,e.isNullOrUndefined)(s.taskbarTemplate.value)&&!(0,e.isNullOrUndefined)(this.remainString)){var ge=this.getWidth(this.remainString,r.endPoint-this.stringLeft,15);d.drawString(ge.lines[0].text,w,b,T,i.x+c(this.left),i.y+Z,c(S),c(this.height),P)}(0,e.isNullOrUndefined)(this.taskLabel)||(S=this.progressWidth,C&&(S=this.width),this.isAutoFit()?d.drawString(this.taskLabel.toString(),w,b,T,i.x+this.left,i.y+Z,S,c(this.height),P):d.drawString(this.taskLabel.toString(),w,b,T,i.x+c(this.left),i.y+Z,c(S),c(this.height),P))}}else s.isSpliterTask&&s.segmentCollection.map((function(e){l.isAutoFit()?d.drawRectangle(G,z,i.x+(s.left+.5+e.left),i.y+Z,e.progressWidth,c(s.height)):d.drawRectangle(G,z,i.x+c(s.left+.5+e.left),i.y+Z,c(e.progressWidth),c(s.height))}));this.isCompleted=!0,this.endPage=R}else if(X<r.startDate&&Y>r.endDate){if(this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.isScheduledTask||"duration"!==this.unscheduledTaskBy)if(this.isScheduledTask||"endDate"!==this.unscheduledTaskBy)if(!s.isAutoSchedule&&s.isParentTask)L.dashStyle=Xi.PdfDashStyle.Solid,this.isAutoFit()?d.drawLine(L,new Xi.PointF(i.x,i.y+Z),new Xi.PointF(r.totalWidth,i.y+Z)):d.drawLine(L,new Xi.PointF(i.x,i.y+Z),new Xi.PointF(c(r.totalWidth),i.y+Z));else if(s.isAutoSchedule||s.isParentTask){if(this.isAutoFit())d.drawRectangle(I,E,i.x+s.left+.5,i.y+Z,r.totalWidth,c(s.height));else if(d.drawRectangle(I,E,i.x+c(s.left)+.5,i.y+Z,c(r.totalWidth),c(s.height)),!(0,e.isNullOrUndefined)(s.taskbarTemplate.value)&&!(0,e.isNullOrUndefined)(this.remainString)){var fe=this.getWidth(this.remainString,r.endPoint-this.stringLeft,15);d.drawString(fe.lines[0].text,m,D,y,i.x+c(s.left)+.5,i.y+Z,c(r.totalWidth),c(this.height),P)}}else this.isAutoFit()?d.drawRectangle(U,null,i.x+s.left+.5,i.y+Z,r.totalWidth,s.height):d.drawRectangle(U,null,i.x+c(s.left)+.5,i.y+Z,c(r.totalWidth),c(s.height)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,W,i.x+s.left+.5,i.y+Z,r.totalWidth,s.height):d.drawRectangle(null,W,i.x+c(s.left)+.5,i.y+Z,c(r.totalWidth),c(s.height)),d.restore(),this.isAutoFit()?d.drawRectangle(null,H,i.x+s.left+.5,i.y+Z,r.totalWidth,s.height):d.drawRectangle(null,H,i.x+c(s.left)+.5,i.y+Z,c(r.totalWidth),c(s.height));else this.drawUnscheduledTask(d,i,a,Z);else{K=void 0,J=void 0;if(this.isAutoFit())K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+s.left+.5+r.totalWidth/2,0),new Xi.PointF(i.x+s.left,0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+s.left+.5,i.y+Z,r.totalWidth,c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+s.left+.5+r.totalWidth,0),new Xi.PointF(i.x+s.left+r.totalWidth/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+s.left+.5+r.totalWidth/2,i.y+Z,r.totalWidth/2,c(s.height));else if(K=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(s.left)+.5+c(r.totalWidth)/2,0),new Xi.PointF(i.x+c(s.left),0),new Xi.PdfColor(s.unscheduledTaskBarColor),new Xi.PdfColor(255,255,255)),d.drawRectangle(K,i.x+c(s.left)+.5,i.y+Z,c(r.totalWidth),c(s.height)),J=new Xi.PdfLinearGradientBrush(new Xi.PointF(i.x+c(s.left)+.5+c(r.totalWidth),0),new Xi.PointF(i.x+c(s.left)+c(r.totalWidth)/2,0),new Xi.PdfColor(255,255,255),new Xi.PdfColor(s.unscheduledTaskBarColor)),d.drawRectangle(J,i.x+c(s.left)+.5+c(r.totalWidth)/2,i.y+Z,c(r.totalWidth)/2,c(s.height)),O.value||O.image){if(!(0,e.isNullOrUndefined)(s.taskbarTemplate.image)){$=new Xi.PdfBitmap(s.taskbarTemplate.image[0].base64);d.drawImage($,i.x+c(s.left)+.5,i.y+Z,c(s.taskbarTemplate.image[0].width),c(s.taskbarTemplate.image[0].height))}ee=(0,e.isNullOrUndefined)(s.taskbarTemplate.image)?0:s.taskbarTemplate.image[0].width;(0,e.isNullOrUndefined)(s.taskbarTemplate.value)||d.drawString(s.taskbarTemplate.value,m,D,y,i.x+c(s.left+.5)+ee,i.y+Z,c(s.width),c(this.height),P)}}if(this.isScheduledTask){de=0;de=this.progressWidth<=r.totalWidth?this.progressWidth:r.totalWidth,(0,e.isNullOrUndefined)(O.image)&&(0,e.isNullOrUndefined)(O.value)&&(this.isAutoFit()?d.drawRectangle(G,z,i.x+s.left+.5,i.y+Z,de,c(s.height)):d.drawRectangle(G,z,i.x+c(s.left)+.5,i.y+Z,c(de),c(s.height))),this.progressWidth-=de,(0,e.isNullOrUndefined)(this.taskLabel)||(S=de,C&&(S=this.width),this.isAutoFit()?d.drawString(this.taskLabel.toString(),v,b,k,i.x+this.left,i.y+Z,S,c(this.height),P):d.drawString(this.taskLabel.toString(),v,b,k,i.x+c(this.left),i.y+Z,c(S),c(this.height),P))}this.isCompleted=!1,this.width-=r.totalWidth}if(this.parent.renderBaseline&&s.baselineStartDate&&s.baselineEndDate)if(r.startDate<=s.baselineStartDate&&s.baselineEndDate<=r.endDate)this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.parent.renderBaseline&&s.baselineStartDate&&s.baselineEndDate&&(this.isAutoFit()?d.drawRectangle(M,x,i.x+(s.baselineLeft-a)+.5,i.y+Z+c(s.height+3),s.baselineWidth,c(this.baselineHeight)):d.drawRectangle(M,x,i.x+c(s.baselineLeft-a)+.5,i.y+Z+c(s.height+3),c(s.baselineWidth),c(this.baselineHeight))),this.isCompletedBaseline=!0,this.startPage=R,this.endPage=R;else if(r.startDate<=s.baselineStartDate&&r.endDate>=s.baselineStartDate&&s.baselineEndDate>=r.endDate){this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0);var me=0;me=r.totalWidth-(s.baselineLeft-a),this.parent.renderBaseline&&s.baselineStartDate&&s.baselineEndDate&&(this.isAutoFit()?d.drawRectangle(M,x,i.x+(s.baselineLeft-a)+.5,i.y+Z+c(s.height+3),me,c(this.baselineHeight)):d.drawRectangle(M,x,i.x+c(s.baselineLeft-a)+.5,i.y+Z+c(s.height+3),c(me),c(this.baselineHeight))),s.baselineWidth=s.baselineWidth-me,this.baselineLeft=0,this.isCompletedBaseline=!1,this.startPage=R}else s.baselineEndDate<=r.endDate&&r.startDate<=s.baselineEndDate&&!this.isCompletedBaseline?(this.isStartPoint?this.parent.renderBaseline&&s.baselineStartDate&&s.baselineEndDate&&(this.isAutoFit()?d.drawRectangle(M,x,i.x+(s.baselineLeft+.5),i.y+Z+c(s.height+3),s.baselineWidth,c(this.baselineHeight)):d.drawRectangle(M,x,i.x+c(s.baselineLeft+.5),i.y+Z+c(s.height+3),c(s.baselineWidth),c(this.baselineHeight))):(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.isCompletedBaseline=!0,this.endPage=R):s.baselineStartDate<r.startDate&&s.baselineEndDate>r.endDate&&(this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.parent.renderBaseline&&s.baselineStartDate&&s.baselineEndDate&&(this.isAutoFit()?d.drawRectangle(M,x,i.x+s.baselineLeft+.5,i.y+Z+c(s.height+3),r.totalWidth,c(s.baselineHeight)):d.drawRectangle(M,x,i.x+c(s.baselineLeft)+.5,i.y+Z+c(s.height+3),c(r.totalWidth),c(s.baselineHeight))),this.isCompletedBaseline=!1,this.baselineWidth-=r.totalWidth);if(!this.isAutoSchedule&&s.isParentTask)if(r.startDate<=s.autoStartDate&&s.autoEndDate<=r.endDate)this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),!s.isAutoSchedule&&s.isParentTask&&(this.isAutoFit()?d.drawRectangle(F,null,i.x+(this.autoLeft-a)+.5,i.y+Z+10,this.autoWidth,c(12)):d.drawRectangle(F,null,i.x+c(this.autoLeft-a)+.5,i.y+Z+10,c(this.autoWidth),c(12)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,A,i.x+(this.autoLeft-a)+.5,i.y+Z+10,this.autoWidth,c(12)):d.drawRectangle(null,A,i.x+c(this.autoLeft-a)+.5,i.y+Z+10,c(this.autoWidth),c(12)),d.restore(),this.isAutoFit()?d.drawRectangle(null,j,i.x+(this.autoLeft-a)+.5,i.y+Z+10,s.progressWidth,c(12)):d.drawRectangle(null,j,i.x+c(this.autoLeft-a)+.5,i.y+Z+10,c(s.progressWidth),c(12))),this.isCompletedAutotask=!0,this.startPage=R,this.endPage=R;else if(r.startDate<=s.autoStartDate&&r.endDate>=s.autoStartDate&&s.autoEndDate>=r.endDate){this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0);me=0,ie=0;me=r.totalWidth-(this.autoLeft-a),ie=r.totalWidth-(this.autoLeft-a),!s.isAutoSchedule&&s.isParentTask&&(this.isAutoFit()?d.drawRectangle(F,null,i.x+(this.autoLeft-a)+.5,i.y+Z+10,me,c(12)):d.drawRectangle(F,null,i.x+c(this.autoLeft-a)+.5,i.y+Z+10,c(me),c(12)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,A,i.x+(this.autoLeft-a)+.5,i.y+Z+10,me,c(12)):d.drawRectangle(null,A,i.x+c(this.autoLeft-a)+.5,i.y+Z+10,c(me),c(12)),d.restore(),this.isAutoFit()?d.drawRectangle(null,j,i.x+(this.autoLeft-a)+.5,i.y+Z+10,s.progressWidth,c(12)):d.drawRectangle(null,j,i.x+c(this.autoLeft-a)+.5,i.y+Z+10,c(ie),c(12)),s.autoWidth=s.autoWidth-me,s.progressWidth=s.progressWidth-ie),this.autoLeft=0,this.isCompletedAutotask=!1,this.startPage=R}else s.autoEndDate<=r.endDate&&r.startDate<=s.autoEndDate&&!this.isCompletedAutotask?(this.isStartPoint?!s.isAutoSchedule&&s.isParentTask&&(this.isAutoFit()?d.drawRectangle(F,null,i.x+(this.autoLeft+.5),i.y+Z+10,s.autoWidth,c(12)):d.drawRectangle(F,null,i.x+c(this.autoLeft+.5),i.y+Z+10,c(s.autoWidth),c(12)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,A,i.x+(this.autoLeft+.5),i.y+Z+10,s.autoWidth,c(12)):d.drawRectangle(null,A,i.x+c(this.autoLeft+.5),i.y+Z+10,c(s.autoWidth),c(12)),d.restore(),this.isAutoFit()?d.drawRectangle(null,j,i.x+(this.autoLeft+.5),i.y+Z+10,s.progressWidth,c(12)):d.drawRectangle(null,j,i.x+c(this.autoLeft+.5),i.y+Z+10,c(s.progressWidth),c(12))):(this.taskStartPoint=yr({},i),this.isStartPoint=!0),this.isCompletedAutotask=!0,this.endPage=R):s.autoStartDate<r.startDate&&s.autoEndDate>r.endDate&&(this.isStartPoint||(this.taskStartPoint=yr({},i),this.isStartPoint=!0),!s.isAutoSchedule&&s.isParentTask&&(this.isAutoFit()?d.drawRectangle(null,j,i.x+(this.autoLeft+.5),i.y+Z+10,s.progressWidth,c(12)):0!==s.progressWidth&&d.drawRectangle(null,j,i.x+c(this.autoLeft+.5),i.y+Z+10,c(s.progressWidth),c(12)),this.isAutoFit()?d.drawRectangle(F,null,i.x+this.autoLeft+.5,i.y+Z+10,r.totalWidth,c(12)):d.drawRectangle(F,null,i.x+c(this.autoLeft)+.5,i.y+Z+10,c(r.totalWidth),c(12)),d.save(),d.setTransparency(.87),this.isAutoFit()?d.drawRectangle(null,A,i.x+(this.autoLeft-a)+.5,i.y+Z+10,r.totalWidth,c(12)):d.drawRectangle(null,A,i.x+c(this.autoLeft)+.5,i.y+Z+10,c(r.totalWidth),c(12)),d.restore()),this.isCompletedAutotask=!1,this.autoWidth-=r.totalWidth);!(0,e.isNullOrUndefined)(s.indicators)&&s.indicators.length>0&&s.indicators.map((function(t,n){var s=l.parent.dateValidationModule.getDateFromFormat(t.date,!0);if(r.startDate<=s&&s<=r.endDate){var o=l.parent.chartRowsModule.getIndicatorleft(t.date);if(!(0,e.isNullOrUndefined)(t.base64)){var h=new Xi.PdfBitmap(t.base64);l.isAutoFit()?(d.drawImage(h,i.x+(o-a)+.5+10,i.y+Z,Q,Q),d.drawString(t.name,w,null,Xi.PdfBrushes.Black,i.x+(o-a)+.5+15+Q,i.y+Z,null)):(d.drawImage(h,i.x+c(o-a)+.5+10,i.y+Z,Q,Q),d.drawString(t.name,w,null,Xi.PdfBrushes.Black,i.x+c(o-a)+.5+15+Q,i.y+Z,null))}}}))}return this.drawRightLabel(t,i,r,a),h},t.prototype.drawRightLabel=function(t,i,r,a){var n,s=t.graphics;if((0,e.isNullOrUndefined)(this.rightTaskLabel.value))if((0,e.isNullOrUndefined)(this.labelSettings.rightLabel.image))this.labelSettings.rightLabel.value&&this.drawRightLabelValue(t,i,r,a,this.labelSettings.rightLabel.value);else{this.previousWidthofRightImage=0,this.previousWidthofRightValue=0;for(var o=0;o<this.labelSettings.rightLabel.image.length;o++)if(this.drawRigthlabelImage(t,i,r,a,this.labelSettings.rightLabel.image[o]),this.labelSettings.rightLabel.value){var l=this.labelSettings.rightLabel.value.split(",");l&&(this.rightTaskLabel.isCompleted=!1,this.drawRightLabelValue(t,i,r,a,l[o]))}}else{n=this.rightTaskLabel.isLeftCalculated||this.isAutoFit()?this.rightTaskLabel.left:c(this.rightTaskLabel.left);var d=void 0;if(d=this.isAutoFit()?n-a+i.x:n-c(a)+i.x,r.startPoint<=n&&n<r.endPoint&&!(0,e.isNullOrUndefined)(this.rightTaskLabel.value)&&!this.rightTaskLabel.isCompleted){var h=this.getWidth(this.rightTaskLabel.value,r.endPoint-n,15),p=new Xi.PdfStandardFont(this.fontFamily,9);!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(p=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var u=(c(this.parent.rowHeight)-h.actualSize.height)/2,g=new Xi.PointF(d,i.y+u),f=new Xi.SizeF(h.actualSize.width,h.actualSize.height),m=new Xi.RectangleF(g,f),y=new Xi.PdfStringFormat;if(y.alignment=Xi.PdfTextAlignment.Right,y.lineAlignment=Xi.PdfVerticalAlignment.Middle,h.actualSize.width>0){var D=new Xi.PdfSolidBrush(this.labelColor);s.drawString(h.lines[0].text,p,null,D,m.x,m.y,h.actualSize.width,h.actualSize.height,y),null!==h.remainder?(this.rightTaskLabel.value=h.remainder,this.rightTaskLabel.left=r.endPoint,this.rightTaskLabel.isLeftCalculated=!0):this.rightTaskLabel.isCompleted=!0}else this.rightTaskLabel.left=r.endPoint}}},t.prototype.drawRigthlabelImage=function(t,i,r,a,n){var s,o,l=t.graphics;if(!(0,e.isNullOrUndefined)(this.labelSettings.rightLabel)&&!(0,e.isNullOrUndefined)(this.labelSettings.rightLabel.image)){if(this.labelSettings.isLeftCalculated)s=this.rightTaskLabel.left;else if(this.isAutoFit())this.labelSettings.rightLabel.image.length>1?(s=this.rightTaskLabel.left+ +this.previousWidthofRightValue,this.previousWidthofRightImage=n.width):s=this.rightTaskLabel.left;else{var d=void 0;(0,e.isNullOrUndefined)(this.labelSettings.rightLabel.value)||(d=this.labelSettings.rightLabel.value.split(",")),this.labelSettings.rightLabel.image.length>1&&d.length>1?(s=c(this.rightTaskLabel.left)+this.previousWidthofRightValue,this.previousWidthofRightImage=n.width):this.labelSettings.rightLabel.image.length>1?(s=c(this.rightTaskLabel.left)+this.previousWidthofRightImage,this.previousWidthofRightImage=n.width):s=c(this.rightTaskLabel.left)}var h=void 0;if(h=this.isAutoFit()?s-a+i.x:s-c(a)+i.x,r.startPoint<=s&&s<r.endPoint&&!(0,e.isNullOrUndefined)(this.labelSettings.rightLabel)&&!this.rightTaskLabel.isCompleted){var p=new Xi.SizeF(n.width,n.height),u=(c(this.parent.rowHeight)-p.height)/2,g=new Xi.PointF(h,i.y+u),f=new Xi.SizeF(p.width,p.height);o=new Xi.RectangleF(g,f);var m=new Xi.PdfBitmap(n.base64);p.width>0?(l.drawImage(m,o.x,o.y,p.width,p.height),null!==this.labelSettings.rightLabel.value?this.rightTaskLabel.isLeftCalculated=!0:(0,e.isNullOrUndefined)(this.labelSettings.rightLabel.value)&&(this.rightTaskLabel.isCompleted=!0)):this.rightTaskLabel.left=r.endPoint}}},t.prototype.drawRightLabelValue=function(t,i,r,a,n){var s,o=t.graphics;if(!(0,e.isNullOrUndefined)(this.labelSettings.rightLabel.value)){if(this.labelSettings.isLeftCalculated)s=this.rightTaskLabel.left;else if(this.isAutoFit())if(this.labelSettings.rightLabel.image)if(this.labelSettings.rightLabel.image.length>1){if(s=this.rightTaskLabel.left+this.previousWidthofRightImage+this.previousWidthofRightValue,!(0,e.isNullOrUndefined)(n)){var l=this.getWidthofrightLabel(n,r.endPoint-s,15);this.previousWidthofRightValue+=l.actualSize.width+this.previousWidthofRightImage}}else s=this.rightTaskLabel.left+this.labelSettings.rightLabel.image[0].width;else s=this.rightTaskLabel.left;else if(this.labelSettings.rightLabel.image)if(this.labelSettings.rightLabel.image.length>1){if(s=c(this.rightTaskLabel.left)+this.previousWidthofRightImage+this.previousWidthofRightValue,!(0,e.isNullOrUndefined)(n)){l=this.getWidthofrightLabel(n,r.endPoint-s,15);this.previousWidthofRightValue+=l.actualSize.width+this.previousWidthofRightImage}}else s=c(this.rightTaskLabel.left)+this.labelSettings.rightLabel.image[0].width;else s=c(this.rightTaskLabel.left);var d=void 0;if(d=this.isAutoFit()?s-a+i.x:s-c(a)+i.x,r.startPoint<=s&&s<r.endPoint&&!(0,e.isNullOrUndefined)(n)&&!this.rightTaskLabel.isCompleted){l=this.getWidthofrightLabel(n,r.endPoint-s,15);var h=new Xi.PdfStandardFont(this.fontFamily,9);!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(h=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var p=(c(this.parent.rowHeight)-l.actualSize.height)/2,u=new Xi.PointF(d,i.y+p),g=new Xi.SizeF(l.actualSize.width,l.actualSize.height),f=new Xi.RectangleF(u,g),m=new Xi.PdfStringFormat;if(m.alignment=Xi.PdfTextAlignment.Right,m.lineAlignment=Xi.PdfVerticalAlignment.Middle,l.actualSize.width>0){var y=new Xi.PdfSolidBrush(this.labelColor),D=this.labelSettings.rightLabel.fontStyle.fontSize?new Xi.PdfStandardFont(this.labelSettings.rightLabel.fontStyle.fontFamily,this.labelSettings.rightLabel.fontStyle.fontSize,this.labelSettings.rightLabel.fontStyle.fontStyle):h,v=this.labelSettings.rightLabel.fontStyle.fontColor?new Xi.PdfSolidBrush(this.labelSettings.rightLabel.fontStyle.fontColor):y;o.drawString(n,D,null,v,f.x,f.y,l.actualSize.width,l.actualSize.height,m),(0,e.isNullOrUndefined)(l.remainder)||null===l.remainder?(0,e.isNullOrUndefined)(this.labelSettings.rightLabel.value)&&(this.rightTaskLabel.isCompleted=!0):(this.rightTaskLabel.value=l.remainder,this.rightTaskLabel.left=r.endPoint,this.rightTaskLabel.isLeftCalculated=!0)}else this.rightTaskLabel.left=r.endPoint}}},t.prototype.drawLeftLabel=function(t,i,r,a,n){var s,o=t.graphics;if((0,e.isNullOrUndefined)(this.leftTaskLabel.value))if((0,e.isNullOrUndefined)(this.labelSettings.leftLabel)||(0,e.isNullOrUndefined)(this.labelSettings.leftLabel.image))(0,e.isNullOrUndefined)(this.labelSettings.leftLabel)||(0,e.isNullOrUndefined)(this.labelSettings.leftLabel.value)||this.drawLeftLabelValue(t,i,r,a,this.labelSettings.leftLabel.value);else{this.previousWidthofLeftImage=0,this.previousWidthofLeftValue=0,this.totalLeftWidth=0;for(var l=0;l<this.labelSettings.leftLabel.image.length;l++){var d=void 0;u=void 0;(0,e.isNullOrUndefined)(this.labelSettings.leftLabel.value)||(d=this.labelSettings.leftLabel.value.split(","),u=this.getWidth(d[l],Number.MAX_VALUE,15));var h=(0,e.isNullOrUndefined)(u)?0:u.actualSize.width;this.totalLeftWidth+=this.labelSettings.leftLabel.image[l].width+h}for(l=0;l<this.labelSettings.leftLabel.image.length;l++){if(this.drawLeftLabelImage(t,i,r,a,this.labelSettings.leftLabel.image[l]),this.labelSettings.leftLabel.value)(d=this.labelSettings.leftLabel.value.split(","))&&this.drawLeftLabelValue(t,i,r,a,d[l])}}else{var p;if(p=this.left,this.leftTaskLabel.isLeftCalculated)s=this.leftTaskLabel.left;else{var u=this.getWidth(this.leftTaskLabel.value,Number.MAX_VALUE,15),g=this.isMilestone?Math.floor(this.parent.chartRowsModule.taskBarHeight/2)+33:33;s=this.isAutoFit()?p-g-u.actualSize.width:c(p-g)-u.actualSize.width,this.leftTaskLabel.left=s,this.leftTaskLabel.isLeftCalculated=!0}var f=void 0;if(this.isAutoFit()){if(f=s-c(a)+i.x,!n.isAutoSchedule&&n.isParentTask){var m=n.left-n.autoLeft;f=n.left<n.autoLeft?s-a+i.x:s-a+i.x-m}}else if(f=s-c(a)+i.x,!n.isAutoSchedule&&n.isParentTask){m=c(n.left)-c(n.autoLeft);f=n.left<n.autoLeft?s-c(a)+i.x:s-c(a)+i.x-m}if(r.startPoint<=s&&s<r.endPoint&&!(0,e.isNullOrUndefined)(this.leftTaskLabel.value)&&!this.leftTaskLabel.isCompleted){var u=this.getWidth(this.leftTaskLabel.value,r.endPoint-s,15),y=new Xi.PdfStandardFont(this.fontFamily,9);!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(y=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var D=(c(this.parent.rowHeight)-u.actualSize.height)/2,v=new Xi.PointF(f,i.y+D),k=new Xi.SizeF(u.actualSize.width,u.actualSize.height),w=new Xi.RectangleF(v,k),b=new Xi.PdfStringFormat;if(b.alignment=Xi.PdfTextAlignment.Right,b.lineAlignment=Xi.PdfVerticalAlignment.Middle,u.actualSize.width>0){var T=new Xi.PdfSolidBrush(this.labelColor);o.drawString(u.lines[0].text,y,null,T,w.x,w.y,u.actualSize.width,u.actualSize.height,b),null!==u.remainder?(this.leftTaskLabel.value=u.remainder,this.leftTaskLabel.left=r.endPoint):this.leftTaskLabel.isCompleted=!0}else this.leftTaskLabel.left=r.endPoint}}},t.prototype.drawLeftLabelImage=function(t,i,r,a,n){var s,o,l=t.graphics;if(o=this.left,!(0,e.isNullOrUndefined)(this.labelSettings.leftLabel)&&!(0,e.isNullOrUndefined)(this.labelSettings.leftLabel.image)){if(this.leftTaskLabel.isLeftCalculated)s=this.labelSettings.leftLabel.image.length>1?this.leftTaskLabel.left+this.previousWidthofLeftValue:this.leftTaskLabel.left;else{var d=new Xi.SizeF(n.width,n.height),h=this.isMilestone?Math.floor(this.parent.chartRowsModule.taskBarHeight/2)+33:33,p=this.labelSettings.leftLabel.value.split(",");this.isAutoFit()?this.labelSettings.leftLabel.image.length>0&&p.length>0?(s=o-this.totalLeftWidth-d.width,this.previousWidthofLeftImage+=d.width):s=o-h-d.width:this.labelSettings.leftLabel.image.length>0&&p.length>0?(s=c(o)-this.totalLeftWidth-d.width,this.previousWidthofLeftImage+=d.width):s=c(o-h)-d.width,this.leftTaskLabel.left=s,this.leftTaskLabel.isLeftCalculated=!0}var u=void 0;if(u=(this.isAutoFit(),s-c(a)+i.x),r.startPoint<=s&&s<r.endPoint&&!(0,e.isNullOrUndefined)(n)&&!this.leftTaskLabel.isCompleted){d=new Xi.SizeF(n.width,n.height);var g=(c(this.parent.rowHeight)-d.height)/2,f=new Xi.PointF(u,i.y+g),m=new Xi.SizeF(d.width,d.height),y=new Xi.RectangleF(f,m),D=new Xi.PdfBitmap(n.base64);d.width>0?(l.drawImage(D,y.x,y.y,d.width,d.height),this.totalLeftWidth=this.totalLeftWidth-d.width):this.leftTaskLabel.left=r.endPoint}}},t.prototype.drawLeftLabelValue=function(t,i,r,a,n){var s,o=t.graphics;if(!(0,e.isNullOrUndefined)(n)){var l;if(l=this.left,this.leftTaskLabel.isLeftCalculated){if(1===(p=this.labelSettings.leftLabel.value.split(",")).length){s=this.leftTaskLabel.left+this.previousWidthofLeftImage,this.labelSettings.left=s;d=this.getWidthofLeftLabel(n,Number.MAX_VALUE,15);this.previousWidthofLeftValue+=this.previousWidthofLeftImage+d.actualSize.width}else if(p.length>1){m=0!==this.previousWidthofLeftValue?this.previousWidthofLeftValue+this.previousWidthofLeftImage:this.previousWidthofLeftImage;s=this.leftTaskLabel.left+m,this.labelSettings.left=s;d=this.getWidthofLeftLabel(n,Number.MAX_VALUE,15);this.previousWidthofLeftValue+=this.previousWidthofLeftImage+d.actualSize.width}else s=this.leftTaskLabel.left}else{var d=this.getWidthofLeftLabel(n,Number.MAX_VALUE,15),h=this.isMilestone?Math.floor(this.parent.chartRowsModule.taskBarHeight/2)+33:33,p=this.labelSettings.leftLabel.value.split(",");if(this.isAutoFit()){var u=!(0,e.isNullOrUndefined)(this.labelSettings.leftLabel.image),g=u?this.labelSettings.leftLabel.image.length:0;if(1===p.length&&u&&1===g){s=this.leftTaskLabel.left+this.previousWidthofLeftImage,this.labelSettings.left=s;var f=this.getWidthofLeftLabel(n,Number.MAX_VALUE,15);this.previousWidthofLeftValue+=this.previousWidthofLeftImage+f.actualSize.width}else if(p.length>1&&u&&g>1){var m=0!==this.previousWidthofLeftValue?this.previousWidthofLeftValue+this.previousWidthofLeftImage:this.previousWidthofLeftImage;s=this.leftTaskLabel.left+m,this.labelSettings.left=s;var y=this.getWidthofLeftLabel(n,Number.MAX_VALUE,15);this.previousWidthofLeftValue+=this.previousWidthofLeftImage+y.actualSize.width}else s=l-h-d.actualSize.width}else s=c(l-h)-d.actualSize.width;this.leftTaskLabel.left=s,this.leftTaskLabel.isLeftCalculated=!0}var D=void 0;if(D=(this.isAutoFit(),s-c(a)+i.x),r.startPoint<=s&&s<r.endPoint&&!(0,e.isNullOrUndefined)(n)&&!this.leftTaskLabel.isCompleted){d=this.getWidthofLeftLabel(n,r.endPoint-s,15);var v=new Xi.PdfStandardFont(this.fontFamily,9);!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(v=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var k=(c(this.parent.rowHeight)-d.actualSize.height)/2,w=new Xi.PointF(D,i.y+k),b=new Xi.SizeF(d.actualSize.width,d.actualSize.height),T=new Xi.RectangleF(w,b),P=new Xi.PdfStringFormat;if(P.alignment=Xi.PdfTextAlignment.Right,P.lineAlignment=Xi.PdfVerticalAlignment.Middle,d.actualSize.width>0){var S=new Xi.PdfSolidBrush(this.labelColor),C=this.labelSettings.leftLabel.fontStyle.fontSize?new Xi.PdfStandardFont(this.labelSettings.leftLabel.fontStyle.fontFamily,this.labelSettings.leftLabel.fontStyle.fontSize,this.labelSettings.leftLabel.fontStyle.fontStyle):v,R=this.labelSettings.leftLabel.fontStyle.fontColor?new Xi.PdfSolidBrush(this.labelSettings.leftLabel.fontStyle.fontColor):S;o.drawString(n,C,null,R,T.x,T.y,d.actualSize.width,d.actualSize.height,P);p=this.labelSettings.leftLabel.value.split(",");(0,e.isNullOrUndefined)(d.remainder)||null===d.remainder?(0,e.isNullOrUndefined)(this.labelSettings.leftLabel.image)||1!==this.labelSettings.leftLabel.image.length||1!==p.length||(this.leftTaskLabel.isCompleted=!0):(this.leftTaskLabel.value=d.remainder,this.leftTaskLabel.left=r.endPoint)}else this.leftTaskLabel.left=r.endPoint}}},t.prototype.getWidth=function(t,i,r){var a=new Xi.PdfStandardFont(this.fontFamily,9);!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(a=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var n=new Xi.PdfStringLayouter,s=new Xi.PdfStringFormat;return s.alignment=Xi.PdfTextAlignment.Left,s.wordWrap=Xi.PdfWordWrapType.Character,s.lineAlignment=Xi.PdfVerticalAlignment.Middle,n.layout(t,a,s,new Xi.SizeF(i,r),!1,new Xi.SizeF(i,r))},t.prototype.getWidthofLeftLabel=function(t,i,r){var a,n=new Xi.PdfStandardFont(this.labelSettings.leftLabel.fontStyle.fontFamily,this.labelSettings.leftLabel.fontStyle.fontSize);a=this.labelSettings.leftLabel.fontStyle.fontSize?n:new Xi.PdfStandardFont(this.fontFamily,9),!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(a=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var s=new Xi.PdfStringLayouter,o=new Xi.PdfStringFormat;return o.alignment=Xi.PdfTextAlignment.Left,o.wordWrap=Xi.PdfWordWrapType.Character,o.lineAlignment=Xi.PdfVerticalAlignment.Middle,s.layout(t,a,o,new Xi.SizeF(i,r),!1,new Xi.SizeF(i,r))},t.prototype.getWidthofrightLabel=function(t,i,r){var a,n=new Xi.PdfStandardFont(this.labelSettings.rightLabel.fontStyle.fontFamily,this.labelSettings.rightLabel.fontStyle.fontSize);a=this.labelSettings.rightLabel.fontStyle.fontSize?n:new Xi.PdfStandardFont(this.fontFamily,9),!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(a=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font);var s=new Xi.PdfStringLayouter,o=new Xi.PdfStringFormat;return o.alignment=Xi.PdfTextAlignment.Left,o.wordWrap=Xi.PdfWordWrapType.Character,o.lineAlignment=Xi.PdfVerticalAlignment.Middle,s.layout(t,a,o,new Xi.SizeF(i,r),!1,new Xi.SizeF(i,r))},t.prototype.drawUnscheduledTask=function(e,t,i,r){var a=new Xi.PdfSolidBrush(this.taskColor);this.isAutoFit()?e.drawRectangle(a,t.x+(this.left-i),t.y+r,c(3),c(this.height)):e.drawRectangle(a,t.x+c(this.left-i),t.y+r,c(3),c(this.height))},t.prototype.drawMilestone=function(t,i,r,a,n){if(r.startDate<=this.startDate&&this.startDate<=r.endDate){var s=t.graphics,o=t.section.indexOf(t);this.taskStartPoint=yr({},i);var l=new Xi.PdfPen(this.milestoneColor),d=c((this.parent.rowHeight-this.height)/3),h=c((this.parent.rowHeight-this.height)/2),p=this.parent.renderBaseline?d:h,u=new Xi.PdfSolidBrush(this.milestoneColor),g=new Xi.PdfPen(this.baselineBorderColor),f=new Xi.PdfSolidBrush(this.baselineColor);s.save();var m=Math.floor(.8*this.parent.chartRowsModule.taskBarHeight);if(this.isAutoFit()?s.translateTransform(i.x+(this.left-a),i.y+p-.7*this.parent.chartRowsModule.taskBarHeight/2):s.translateTransform(i.x+c(this.left-a),i.y+p-.7*this.parent.chartRowsModule.taskBarHeight/2),s.rotateTransform(45),this.parent.renderBaseline&&this.baselineStartDate&&this.baselineEndDate&&s.drawRectangle(g,f,2,2,c(m),c(m)),s.drawRectangle(l,u,0,0,c(m),c(m)),s.restore(),this.isAutoFit()){if(!(0,e.isNullOrUndefined)(n.taskbarTemplate.image)){var y=new Xi.PdfBitmap(n.taskbarTemplate.image[0].base64),D=i.x+(this.left-a)-.7*this.parent.chartRowsModule.taskBarHeight/2+(.7*this.parent.chartRowsModule.taskBarHeight-n.taskbarTemplate.image[0].height)/1,v=n.taskbarTemplate.image[0].width/2,k=n.taskbarTemplate.image[0].height/2;s.drawImage(y,D,i.y+p-.7*this.parent.chartRowsModule.taskBarHeight/2+(.7*this.parent.chartRowsModule.taskBarHeight-n.taskbarTemplate.image[0].height)/.5,v,k)}}else if(!(0,e.isNullOrUndefined)(n.taskbarTemplate.image)){y=new Xi.PdfBitmap(n.taskbarTemplate.image[0].base64),D=i.x+c(this.left-a)-.7*this.parent.chartRowsModule.taskBarHeight/2+c(.7*this.parent.chartRowsModule.taskBarHeight-n.taskbarTemplate.image[0].height)/1;s.drawImage(y,D,i.y+p-.7*this.parent.chartRowsModule.taskBarHeight/2+c((.7*this.parent.chartRowsModule.taskBarHeight-n.taskbarTemplate.image[0].height)/.5),c(n.taskbarTemplate.image[0].width),c(n.taskbarTemplate.image[0].height-2))}this.endPage=this.startPage=o}},t}(),vr=function(){function t(e){this.holidayCompleted=!1,this.fitHolidayCompleted=!1,this.timelineWidth=0,this.lastWidth=0,this.width=0,this.gantt=e,this.parent=e.parent,this.topTierPoint=new Xi.PointF,this.bottomTierPoint=new Xi.PointF,this.topTierIndex=0,this.bottomTierIndex=0,this.prevTopTierIndex=0,this.prevBottomTierIndex=0}return t.prototype.drawTimeline=function(e,t,i){this.detailsTimeline=i;var r=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?g(Math.floor(i.totalWidth)):Math.round(i.totalWidth),a=0;for(this.topTierPoint.x=t.x,this.topTierPoint.y=t.y,this.prevTopTierIndex=this.topTierIndex,this.prevBottomTierIndex=this.bottomTierIndex;r>0;){var n=this.topTier[this.topTierIndex];if(this.topTier.length>this.topTierIndex){var s=!1;this.topTier[this.topTierIndex].isFinished||(r>=n.width?(a=n.width,n.isFinished=!0,n.completedWidth=a,s=!0):(a=r,s=!1,n.isFinished=!1,n.width=n.width-r,n.completedWidth=a)),this.triggerQueryTimelinecell(e,this.topTierPoint.x,this.topTierPoint.y,this.topTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?a:c(a),n.value,!0,this.parent.timelineModule.isSingleTier&&"Day"===this.parent.timelineSettings.topTier.unit?n.startDate:null),this.topTierPoint.x+=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?a:c(a),r-=a,s&&this.topTierIndex++}else r=0}r=Math.round(i.totalWidth);var o=this.parent.timelineModule.isSingleTier?0:this.topTierHeight;for(this.bottomTierPoint=new Xi.PointF(t.x,c(t.y+o));r>0;){var l=this.bottomTier[this.bottomTierIndex];if(this.bottomTier.length>this.bottomTierIndex){s=!0;var d=l.width;r<d&&(d=r,s=!1,l.completedWidth=d),this.triggerQueryTimelinecell(e,this.bottomTierPoint.x,this.bottomTierPoint.y,this.bottomTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?d:c(d),l.value,!1,l.startDate),this.bottomTierPoint.x=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?this.bottomTierPoint.x+d:this.bottomTierPoint.x+c(d),r-=d,l.completedWidth=d,this.bottomTierIndex++,r>0&&r<d&&(r=l.width-1)}else r=0}this.timelineWidth=this.lastWidth},t.prototype.drawPageTimeline=function(t,i,r){this.topTierPoint=(0,e.extend)({},{},i,!0);for(var a=this.prevTopTierIndex;a<=this.topTierIndex;a++)if(this.topTier.length>a){var n=this.topTier[a];n.completedWidth>0&&(this.triggerQueryTimelinecell(t,this.topTierPoint.x,this.topTierPoint.y,this.topTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?n.completedWidth:c(n.completedWidth),n.value,!0,this.parent.timelineModule.isSingleTier&&"Day"===this.parent.timelineSettings.topTier.unit?n.startDate:null),this.topTierPoint.x+=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?n.completedWidth:c(n.completedWidth))}this.bottomTierPoint.x=i.x,this.bottomTierPoint.y=c(i.y+this.topTierHeight);for(a=this.prevBottomTierIndex;a<=this.bottomTierIndex;a++)if(this.bottomTier.length>a){var s=this.bottomTier[a];s.completedWidth>0&&(this.triggerQueryTimelinecell(t,this.bottomTierPoint.x,this.bottomTierPoint.y,this.bottomTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?s.width:c(s.width),s.value,!1,s.startDate),this.bottomTierPoint.x=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?this.bottomTierPoint.x+s.width:this.bottomTierPoint.x+c(s.width))}},t.prototype.triggerQueryTimelinecell=function(t,i,r,a,n,s,o,l){var d=this,h=new Date(l).getDay(),p=t.graphics,u={},g=this.gantt.ganttStyle;u.borderColor=new Xi.PdfColor(g.timeline.borderColor),u.fontColor=new Xi.PdfColor(g.timeline.fontColor),u.fontSize=g.timeline.fontSize,u.fontStyle=g.timeline.fontStyle,u.backgroundColor=new Xi.PdfColor(g.timeline.backgroundColor),g.timeline.padding&&(u.padding=g.timeline.padding);var f=new Xi.PdfStringFormat;(0,e.isNullOrUndefined)(g.timeline.format)?o?(f.lineAlignment=Xi.PdfVerticalAlignment.Middle,f.alignment=Xi.PdfTextAlignment.Left):(f.lineAlignment=Xi.PdfVerticalAlignment.Middle,f.alignment=Xi.PdfTextAlignment.Center,f.wordWrap=Xi.PdfWordWrapType.Character):f=g.timeline.format,u.format=f;var m={timelineCell:u,value:s};this.parent.pdfQueryTimelineCellInfo&&this.parent.trigger("pdfQueryTimelineCellInfo",m);var y,D=m.timelineCell,v=new Xi.PdfSolidBrush(m.timelineCell.backgroundColor),k=this.parent.nonWorkingDayIndex;this.parent.highlightWeekends&&-1!==k.indexOf(h)&&("Day"===this.parent.timelineModule.bottomTier||"None"===this.parent.timelineModule.bottomTier&&"Day"===this.parent.timelineModule.topTier)&&(v=new Xi.PdfSolidBrush(new Xi.PdfColor(238,238,238))),this.parent.holidays.map((function(e){var t=new Date(e.from),r=new Date(e.to),a=new Date(l);if(t<=a&&r>=a&&("Day"===d.parent.timelineModule.bottomTier||"None"===d.parent.timelineModule.bottomTier&&"Day"===d.parent.timelineModule.topTier)){if(v=new Xi.PdfSolidBrush(new Xi.PdfColor(238,238,238)),t.getTime()===a.getTime()&&(d.holidayWidth=i),r.getTime()===a.getTime()){d.holidayLabel=e.label;var s=new Date(e.to);s.setDate(s.getDate()+1);var o=d.parent.dataOperation.getTaskWidth(t,s);d.holidayNumberOfDays=o/n,d.holidayCompleted=!0}}else"Day"!==d.parent.timelineModule.bottomTier&&d.detailsTimeline.startDate<=t&&d.detailsTimeline.endDate>=t&&d.parent.timelineModule.bottomTierCollection.map((function(i){i.startDate<=t&&i.endDate>=t&&i.startDate===l&&(d.fitHolidayCompleted=!0,d.fromDataHoliday=e.from,d.holidayLabel=e.label)}))}));var w=new Xi.PdfPen(m.timelineCell.borderColor);if(this.parent.pdfExportModule.gantt.taskbar.isAutoFit()||(this.lastWidth=i+n),p.drawRectangle(w,v,i,r,n,c(a)),y=o||"Both"!==this.parent.gridLines&&"Vertical"!==this.parent.gridLines?null:new Xi.PdfPen(m.timelineCell.borderColor),p.drawRectangle(y,v,i,r+c(a),n,t.getClientSize().height),this.holidayCompleted){var b=p.save(),T=(S=new Xi.PdfStandardFont(Xi.PdfFontFamily.Helvetica,10)).height,P=S.size;p.translateTransform(this.holidayWidth+n-P/2*this.holidayNumberOfDays-T+T/2+n*this.holidayNumberOfDays/2,40),p.rotateTransform(-90),p.translateTransform(-t.getClientSize().height/2,-40),p.drawString(this.holidayLabel,S,null,Xi.PdfBrushes.Black,10,10,null),p.restore(b),this.holidayCompleted=!1}if(this.fitHolidayCompleted){var S,C=new Xi.PdfSolidBrush(new Xi.PdfColor(238,238,238));P=(S=new Xi.PdfStandardFont(Xi.PdfFontFamily.Helvetica,10)).size;p.drawRectangle(null,C,i+n/2-P,r+c(a),P,t.getClientSize().height);var R=p.save();p.translateTransform(i+n+n/2-P,40),p.rotateTransform(-90),p.translateTransform(-t.getClientSize().height/2,-40),p.drawString(this.holidayLabel,S,null,Xi.PdfBrushes.Black,10,10,null),p.restore(R),this.fitHolidayCompleted=!1}var M=new Xi.PdfStandardFont(g.fontFamily,D.fontSize,D.fontStyle);g.font&&(M=g.font);var x=new Xi.PdfSolidBrush(m.timelineCell.fontColor),O=g.timeline.padding?m.timelineCell.padding.left:0,I=g.timeline.padding?m.timelineCell.padding.top:0,E=p.save();p.setClip(new Xi.RectangleF(i,r,n,c(a))),o?i=i+O+4:i+=O,p.drawString(m.value,M,null,x,i,r+I,c(n),c(a),D.format),p.restore(E)},t}(),kr=function(){return kr=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},kr.apply(this,arguments)},wr=function(){function t(e,t){this.parent=e,this.pdfGantt=t}return t.prototype.add=function(){return new t(this.parent)},t.prototype.findindex=function(e){var t;return this.parent.enableVirtualization?(this.parent.flatData.map((function(i,r){i.index===e&&(t=r)})),t):(this.parent.currentViewData.map((function(i,r){i.index===e&&(t=r)})),t)},t.prototype.drawPredecessor=function(e){this.pdfGantt=e;var t,i,r,a,n=e.result.page.section.getPages(),s=e.taskbarCollection[this.findindex(this.parentIndex)],o=e.taskbarCollection[this.findindex(this.childIndex)],l=new Xi.PdfPage,d=new Xi.PdfPage,h="";switch(this.type){case"FS":if(!(o.startPage>-1&&s.endPage>-1))return;l=n[s.endPage],d=n[o.startPage],t=e.pdfPageDetail[s.endPage-e.chartPageIndex],i=e.pdfPageDetail[o.startPage-e.chartPageIndex],h=this.parentIndex<this.childIndex?this.parentLeft<this.childLeft&&this.childLeft>this.parentLeft+this.parentWidth+25?"FSType1":"FSType2":this.parentLeft<this.childLeft&&this.childLeft>this.parentLeft+this.parentWidth+25?"FSType3":"FSType4";break;case"SF":if(!(o.endPage>-1&&s.startPage>-1))return;l=n[s.startPage],d=n[o.endPage],t=e.pdfPageDetail[s.endPage-e.chartPageIndex],i=e.pdfPageDetail[o.startPage-e.chartPageIndex],h=this.parentIndex<this.childIndex?this.parentLeft>this.childLeft+this.childWidth?"SFType1":"SFType2":this.parentLeft>this.childLeft+this.childWidth?"SFType3":"SFType4";break;case"FF":if(!(o.endPage>-1&&s.endPage>-1))return;l=n[s.endPage],d=n[o.endPage],t=e.pdfPageDetail[s.endPage-e.chartPageIndex],i=e.pdfPageDetail[o.endPage-e.chartPageIndex],h=this.parentIndex<this.childIndex?this.childLeft+this.childWidth>=this.parentLeft+this.parentWidth?"FFType1":"FFType2":this.childLeft+this.childWidth>=this.parentLeft+this.parentWidth?"FFType3":"FFType4";break;case"SS":if(!(o.startPage>-1&&s.startPage>-1))return;l=n[s.startPage],d=n[o.startPage],t=e.pdfPageDetail[s.startPage-e.chartPageIndex],i=e.pdfPageDetail[o.startPage-e.chartPageIndex],h=this.parentIndex<this.childIndex?this.parentLeft>=this.childLeft?"SSType1":"SSType2":this.parentLeft>=this.childLeft?"SSType3":"SSType4"}var p,u,g,f,m,y,D=Math.round((this.parent.rowHeight-15)/2),v=Math.round((this.parent.rowHeight-1)/2),k=Math.round((this.parent.rowHeight-10)/2),w=this.parent.renderBaseline?k:!s.isAutoSchedule&&s.isParentTask||!o.isAutoSchedule&&o.isParentTask?D:v;w=c(w),p=u=g=f=m=y=new Xi.PointF;var b,T,P,S,C,R=kr({},s.taskStartPoint),M=kr({},o.taskStartPoint);switch(r=R.y+t.startPoint.y,a=M.y+i.startPoint.y,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(b=new Xi.PointF(this.parentLeft+this.parentWidth,r+w),T=new Xi.PointF(this.parentLeft-1,r+w),P=new Xi.PointF(this.childLeft-20,a+w),S=new Xi.PointF(this.childLeft-6-this.lineWidth-1,a+w),C=new Xi.PointF(this.childLeft+this.childWidth+6+this.lineWidth+1,a+w)):(b=new Xi.PointF(c(this.parentLeft+this.parentWidth),r+w),T=new Xi.PointF(c(this.parentLeft)-1,r+w),P=new Xi.PointF(c(this.childLeft-20),a+w),S=new Xi.PointF(c(this.childLeft-6-this.lineWidth)-1,a+w),C=new Xi.PointF(c(this.childLeft+this.childWidth+6+this.lineWidth)+1,a+w)),h){case"FSType1":case"FSType3":p=b,u=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new Xi.PointF(this.childLeft-20,r+w):new Xi.PointF(c(this.childLeft-20),r+w),g=P,f=S,this.connectLines(l,d,p,u,g,f,o,w);break;case"FSType2":p=b,u=new Xi.PointF(p.x+10,r+w),g=new Xi.PointF(p.x+10,a+2),f=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new Xi.PointF(this.childLeft-20,a+2):new Xi.PointF(c(this.childLeft-20),a+2),m=P,y=S,this.connectLines(l,d,p,u,g,f,o,w,m,y);break;case"FSType4":p=b,u=new Xi.PointF(p.x+10,r+w),g=new Xi.PointF(p.x+10,r+2),f=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new Xi.PointF(this.childLeft-20,r+2):new Xi.PointF(c(this.childLeft-20),r+2),m=P,y=S,this.connectLines(l,d,p,u,g,f,o,w,m,y);break;case"FFType1":case"FFType3":this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(p=new Xi.PointF(this.parentLeft+this.parentWidth+1,r+w),u=new Xi.PointF(this.childLeft+this.childWidth+20,r+w)):(p=new Xi.PointF(c(this.parentLeft+this.parentWidth)+1,r+w),u=new Xi.PointF(c(this.childLeft+this.childWidth+20),r+w)),g=new Xi.PointF(u.x,a+w),f=C,this.connectLines(l,d,p,u,g,f,o,w);break;case"FFType2":case"FFType4":this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(p=new Xi.PointF(this.parentLeft+this.parentWidth+1,r+w),u=new Xi.PointF(this.parentLeft+this.parentWidth+20,r+w)):(p=new Xi.PointF(c(this.parentLeft+this.parentWidth)+1,r+w),u=new Xi.PointF(c(this.parentLeft+this.parentWidth+20),r+w)),g=new Xi.PointF(u.x,a+w),f=C,this.connectLines(l,d,p,u,g,f,o,w);break;case"SSType1":case"SSType3":p=T,u=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new Xi.PointF(this.childLeft-20,r+w):new Xi.PointF(c(this.childLeft-20),r+w),g=new Xi.PointF(u.x,a+w),f=S,this.connectLines(l,d,p,u,g,f,o,w);break;case"SSType2":case"SSType4":p=T,u=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new Xi.PointF(this.parentLeft-20,r+w):new Xi.PointF(c(this.parentLeft-20),r+w),g=new Xi.PointF(u.x,a+w),f=S,this.connectLines(l,d,p,u,g,f,o,w);break;case"SFType1":case"SFType3":p=T,u=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new Xi.PointF(this.childLeft+this.childWidth+20,r+w):new Xi.PointF(c(this.childLeft+this.childWidth+20),r+w),g=new Xi.PointF(u.x,a+w),f=C,this.connectLines(l,d,p,u,g,f,o,w);break;case"SFType2":p=T,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(u=new Xi.PointF(this.parentLeft-20,r+w),f=new Xi.PointF(this.childLeft+this.childWidth+20,a+2)):(u=new Xi.PointF(c(this.parentLeft-20),r+w),f=new Xi.PointF(c(this.childLeft+this.childWidth+20),a+2)),g=new Xi.PointF(u.x,a+2),m=new Xi.PointF(f.x,a+w),y=C,this.connectLines(l,d,p,u,g,f,o,w,m,y);break;case"SFType4":p=T,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(u=new Xi.PointF(this.parentLeft-20,r+w),f=new Xi.PointF(this.childLeft+this.childWidth+20,r+2)):(u=new Xi.PointF(c(this.parentLeft-20),r+w),f=new Xi.PointF(c(this.childLeft+this.childWidth+20),r+2)),g=new Xi.PointF(u.x,r+2),m=new Xi.PointF(f.x,a+w),y=C,this.connectLines(l,d,p,u,g,f,o,w,m,y)}},t.prototype.connectLines=function(t,i,r,a,n,s,o,l,d,h){this.drawLine(t,r,a),this.drawLine(t,a,n),this.drawLine(t,n,s),(0,e.isNullOrUndefined)(d)||(0,e.isNullOrUndefined)(h)||(this.drawLine(t,s,d),this.drawLine(t,d,h)),this.drawArrow(i,o,l)},t.prototype.contains=function(e,t,i){return e.x<=t&&t<e.x+e.width&&e.y<=i&&i<e.y+e.height},t.prototype.findPageIndex=function(e){for(var t=-1,i=0;i<this.pdfGantt.pdfPageDetail.length;i++){var r=this.pdfGantt.pdfPageDetail[i],a=new Xi.RectangleF(r.startPoint.x,r.startPoint.y,r.width,r.height);if(this.contains(a,e.x,e.y)){t=i;break}}return t},t.prototype.drawLine=function(e,t,i){var r=this.pdfGantt.result.page.section.getPages(),a=e.graphics,n=kr({},i),s=kr({},i),o=kr({},i),l=this.pdfGantt.pdfPageDetail[e.section.indexOf(e)-this.pdfGantt.chartPageIndex],d=new Xi.RectangleF(l.startPoint.x,l.startPoint.y,l.width,l.height),h=this.contains(d,t.x,t.y),p=this.contains(d,i.x,i.y),u=-1;if(t=new Xi.PointF(t.x,t.y),i=new Xi.PointF(i.x,i.y),!h&&!p||p&&!h)(u=this.findPageIndex(t))>-1&&(l=this.pdfGantt.pdfPageDetail[u],s=t,n=i,this.drawLine(r[u+this.pdfGantt.chartPageIndex],s,n));else if(!p&&h){var g=d.x,f=d.x+d.width,m=d.y+d.height,y=d.y;g>i.x?(o.x=i.x=g-1,s.x=g-1):f<i.x?(o.x=i.x=f,s.x=f,o.x+=1):m<i.y?(o.y=i.y=m,s.y=m,o.y+=1,this.pdfGantt.enableHeader&&(s.y+=this.parent.timelineModule.isSingleTier?c(45):c(62))):y>i.y&&(s.y=o.y=y-1,i.y=y,this.pdfGantt.enableHeader&&(o.y+=this.parent.timelineModule.isSingleTier?c(45):c(62),i.y+=this.parent.timelineModule.isSingleTier?c(45):c(62))),-1!==(u=this.findPageIndex(o))&&this.drawLine(r[u+this.pdfGantt.chartPageIndex],s,n)}if(h){t=new Xi.PointF(t.x,t.y),i=new Xi.PointF(i.x,i.y),t.x=t.x+l.pageStartX-l.startPoint.x,t.y=t.y-l.startPoint.y,i.x=i.x+l.pageStartX-l.startPoint.x,i.y=i.y-l.startPoint.y;var D=new Xi.PdfSolidBrush(this.connectorLineColor),v=new Xi.PdfPen(D,c(this.lineWidth));a.drawLine(v,t,i)}},t.prototype.drawArrow=function(e,t,i){var r,a=this.pdfGantt.pdfPageDetail[e.section.indexOf(e)-this.pdfGantt.chartPageIndex],n=new Xi.RectangleF(new Xi.PointF(a.startPoint.x,a.startPoint.y),new Xi.SizeF(a.width,a.height)),s=new Xi.PointF,o=e.section.getPages(),l=6+this.lineWidth;if(s=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?"FS"===this.type||"SS"===this.type?new Xi.PointF(this.childLeft-1,t.taskStartPoint.y+a.startPoint.y):new Xi.PointF(this.childLeft+this.childWidth+1,t.taskStartPoint.y+a.startPoint.y):"FS"===this.type||"SS"===this.type?new Xi.PointF(c(this.childLeft)-1,t.taskStartPoint.y+a.startPoint.y):new Xi.PointF(c(this.childLeft+this.childWidth)+1,t.taskStartPoint.y+a.startPoint.y),!this.contains(n,s.x,s.y)){var d=this.findPageIndex(s);d>-1&&(a=this.pdfGantt.pdfPageDetail[d],e=o[d+this.pdfGantt.chartPageIndex])}var h=e.graphics;s.x=s.x-a.startPoint.x+a.pageStartX,s.y=s.y-a.startPoint.y;var p=new Xi.PointF(s.x,s.y+i);r=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?"FS"===this.type||"SS"===this.type?new Xi.PointF(p.x-l,p.y-l):new Xi.PointF(p.x+l,p.y-l):"FS"===this.type||"SS"===this.type?new Xi.PointF(p.x-c(l),p.y-c(l)):new Xi.PointF(p.x+c(l),p.y-c(l));var u,g,f=new Xi.PdfSolidBrush(this.connectorLineColor);this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(u=new Xi.PointF(r.x,r.y+2*l),g=new Xi.PdfPen(f,this.lineWidth)):(u=new Xi.PointF(r.x,r.y+c(2*l)),g=new Xi.PdfPen(f,c(this.lineWidth))),h.drawLine(g,p,r),h.drawLine(g,r,u),h.drawLine(g,u,p)},t}(),br=function(){function t(e){this.parent=e}return t.prototype.drawEventMarker=function(t,i,r,a,n,s){var o,l=t.graphics,d=t.getClientSize(),h=new Xi.PdfStandardFont(Xi.PdfFontFamily.Helvetica,10);!(0,e.isNullOrUndefined)(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(h=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),(0,e.isNullOrUndefined)(n.label)||(o=h.measureString(n.label));var p=new Xi.PdfPen(new Xi.PdfColor(0,0,0));if(p.dashStyle=Xi.PdfDashStyle.Dash,a.startDate<=n.date&&n.date<=a.endDate){var u=new Xi.PdfStringFormat;u.alignment=Xi.PdfTextAlignment.Center;var g=new Xi.PdfSolidBrush(new Xi.PdfColor(253,191,100)),f=this.parent.dataOperation.getTaskLeft(this.parent.dateValidationModule.getDateFromFormat(n.date,!0),!1,!0),m=10;this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(l.drawLine(p,new Xi.PointF(i.x+(f-r)+m,s),new Xi.PointF(i.x+(f-r)+m,d.height)),!(0,e.isNullOrUndefined)(n.label)&&n.label.length>0&&(l.save(),l.translateTransform(i.x+(f-r)+7+m,s+c(50)+o.height/2),l.rotateTransform(45),l.drawRectangle(null,g,0,0,8,8),l.restore(),l.drawRectangle(null,g,i.x+(f-r)+7+m,s+c(50),o.width+10,2*o.height),l.drawString(n.label,h,null,Xi.PdfBrushes.Black,i.x+(f-r)+12+m,s+c(50)+c(o.height/2),o.width,o.height,u))):(l.drawLine(p,new Xi.PointF(i.x+c(f-r)+m,s),new Xi.PointF(i.x+c(f-r)+m,d.height)),!(0,e.isNullOrUndefined)(n.label)&&n.label.length>0&&(l.save(),l.translateTransform(i.x+c(f-r)+7+m,s+c(50)+o.height/2),l.rotateTransform(45),l.drawRectangle(null,g,0,0,8,8),l.restore(),l.drawRectangle(null,g,i.x+c(f-r)+7+m,s+c(50),o.width+10,2*o.height),l.drawString(n.label,h,null,Xi.PdfBrushes.Black,i.x+c(f-r)+12+m,s+c(50)+c(o.height/2),o.width,o.height,u)))}},t}(),Tr=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Pr=function(){return Pr=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Pr.apply(this,arguments)},Sr=function(t){function i(e){var i=t.call(this)||this;return i.exportProps={},i.changeCloneProjectDates=!1,i.parent=e,i.chartHeader=new vr(i),i.eventMarker=new br(e),i.predecessor=new wr(e,i),i.headerDetails=[],i.pdfPageDetail=[],i.taskbarCollection=[],i.predecessorCollection=[],i}return Tr(i,t),Object.defineProperty(i.prototype,"taskbar",{get:function(){return(0,e.isNullOrUndefined)(this.taskbars)&&(this.taskbars=new Dr(this.parent)),this.taskbars},enumerable:!0,configurable:!0}),i.prototype.drawChart=function(e){this.result=e,this.totalPages=this.result.page.section.count,this.perColumnPages=this.totalPages/this.layouter.columnRanges.length,this.calculateRange(),this.drawGantttChart(),this.drawPageBorder()},i.prototype.calculateRange=function(){for(var t=this.layouter.columnRanges[this.layouter.columnRanges.length-1],i=0,r=!0,a=0,n=0,s=0,o=c(this.chartHeader.width),l=this.parent.timelineModule,d=t[0];d<=t[1];d++)i+=this.layouter.treegrid.columns.getColumn(d).width;for((i+=.5)+100<this.result.page.getClientSize().width?(n=this.result.page.getClientSize().width-i,this.chartPageIndex=this.startPageIndex=this.totalPages-this.perColumnPages,r=!1,this.startPoint=new Xi.PointF(i,0)):(this.result.page.section.add(),this.chartPageIndex=this.startPageIndex=this.totalPages,r=!0,this.startPoint=new Xi.PointF(s,0));Math.round(s)<Math.round(o);){r?a=this.result.page.getClientSize().width:(a=n,r=!0);var h={},p=[],u=c(this.chartHeader.bottomTierCellWidth),f=0;0!==this.chartHeader.bottomTierCellWidth&&(f=Math.floor(a/u)*u),p[0]=s,o-s<=f?(p[1]=o,h.totalWidth=g(o-s)):(p[1]=s+f,h.totalWidth=g(f)),h.startPoint=p[0],h.endPoint=p[1],0===this.parent.cloneProjectStartDate.getHours()&&0===this.parent.cloneProjectStartDate.getMinutes()&&0===this.parent.cloneProjectStartDate.getSeconds()&&(this.changeCloneProjectDates=!0,this.parent.cloneProjectStartDate.setHours(8));var m=this.parent.dataOperation.getDateFromFormat(this.parent.timelineModule.timelineStartDate),y=(0,e.isNullOrUndefined)(l.customTimelineSettings.bottomTier.count)?l.customTimelineSettings.topTier.count:l.customTimelineSettings.bottomTier.count;switch("None"===l.customTimelineSettings.bottomTier.unit?l.customTimelineSettings.topTier.unit:l.customTimelineSettings.bottomTier.unit){case"Minutes":h.startDate=new Date(m.getTime());var D=Math.floor(g(h.startPoint)/this.chartHeader.bottomTierCellWidth);h.startDate.setMinutes(h.startDate.getMinutes()+D*y),h.startDate.setSeconds(h.startDate.getSeconds()+1),h.endDate=new Date(h.startDate.getTime());var v=Math.floor(g(h.endPoint-h.startPoint)/this.chartHeader.bottomTierCellWidth);h.endDate.setMinutes(h.endDate.getMinutes()+v*y);break;case"Hour":h.startDate=new Date(m.getTime());var k=Math.floor(g(h.startPoint)/this.chartHeader.bottomTierCellWidth);h.startDate.setHours(h.startDate.getHours()+k*y),h.startDate.setMinutes(h.startDate.getMinutes()+1),h.endDate=new Date(h.startDate.getTime());var w=Math.floor(g(h.endPoint-h.startPoint)/this.chartHeader.bottomTierCellWidth);h.endDate.setHours(h.endDate.getHours()+w*y);break;case"Day":h.startDate=new Date(m.getTime());var b=Math.round(h.startPoint/c(this.chartHeader.bottomTierCellWidth));h.startDate.setDate(h.startDate.getDate()+b*y);var T=Math.round((h.endPoint-h.startPoint)/c(this.chartHeader.bottomTierCellWidth))-1;h.endDate=new Date(h.startDate.getTime()),h.endDate.setDate(h.startDate.getDate()+T*y);break;case"Week":h.startDate=new Date(m.getTime());var P=h.startPoint/c(this.chartHeader.bottomTierCellWidth)*7;h.startDate.setDate(h.startDate.getDate()+P*y);var S=7*Math.round((h.endPoint-h.startPoint)/c(this.chartHeader.bottomTierCellWidth))-1;h.endDate=new Date(h.startDate.getTime()),h.endDate.setDate(h.startDate.getDate()+S*y);break;case"Month":h.startDate=new Date(m.getTime());var C=h.startPoint/c(this.chartHeader.bottomTierCellWidth)*31;h.startDate.setDate(h.startDate.getDate()+C*y);var R=31*Math.round((h.endPoint-h.startPoint)/c(this.chartHeader.bottomTierCellWidth))-1;h.endDate=new Date(h.startDate.getTime()),h.endDate.setDate(h.startDate.getDate()+R*y);break;case"Year":h.startDate=new Date(m.getTime());var M=h.startPoint/c(this.chartHeader.bottomTierCellWidth)*365;h.startDate.setDate(h.startDate.getDate()+M*y);var x=365*Math.round((h.endPoint-h.startPoint)/c(this.chartHeader.bottomTierCellWidth))-1;h.endDate=new Date(h.startDate.getTime()),h.endDate.setDate(h.startDate.getDate()+x*y)}this.headerDetails.push(h),s+=f}},i.prototype.drawPageBorder=function(){for(var e=this.result.page.section.getPages(),t=0;t<e.length;t++){var i=e[t],r=i.graphics,a=i.getClientSize(),n=new Xi.PdfPen(new Xi.PdfColor(206,206,206));r.drawRectangle(n,0,0,a.width,a.height)}},i.prototype.drawGantttChart=function(){var e,t=this,i=this.startPoint,r=new Xi.PointF,a=0,n=0,s=0;this.headerDetails.forEach((function(o,l){var d=t.result.page.section.getPages()[t.startPageIndex];d.contentWidth=t.parent.pdfExportModule.gantt.taskbar.isAutoFit()?g(t.headerDetails[l].endPoint-t.headerDetails[l].startPoint):t.headerDetails[l].endPoint-t.headerDetails[l].startPoint,t.chartHeader.drawTimeline(d,t.startPoint,o),i.y=i.y+c(t.parent.timelineModule.isSingleTier?45:60),a=i.x,s=c(t.parent.timelineModule.isSingleTier?45:60),t.headerDetails[t.headerDetails.indexOf(o)].startIndex=t.startPageIndex,t.headerDetails[t.headerDetails.indexOf(o)].pageStartPoint=i,t.parent.eventMarkerColloction.map((function(e){var r=c(t.parent.timelineModule.isSingleTier?45:60),a=t.result.page.section.getPages()[t.startPageIndex];t.eventMarker.drawEventMarker(a,i,n,o,e,r)}));for(var h=0;h<t.taskbarCollection.length;h++){var p=t.taskbarCollection[h],u=t.rows.getRow(h+1).height,f=t.result.page.section.getPages()[t.startPageIndex],m=f.graphics,y=new Xi.PdfPen(new Xi.PdfColor(206,206,206)),D=void 0;!d.contentWidth||"Both"!==t.parent.gridLines&&"Horizontal"!==t.parent.gridLines||(D=t.chartHeader.timelineWidth,m.drawRectangle(y,a,i.y,t.parent.pdfExportModule.gantt.taskbar.isAutoFit()&&"Day"!==t.parent.timelineModule.bottomTier?d.contentWidth+.5:D,u)),p.drawTaskbar(f,i,o,n,u,t.taskbarCollection[parseInt(h.toString(),10)],D)&&(t.enableHeader?i.y=c(t.parent.timelineModule.isSingleTier?45:60):i.y=0,t.startPageIndex++,(e={}).height=s,e.pageStartX=a,e.startPoint=Pr({},r),t.parent.pdfExportModule.gantt.taskbar.isAutoFit(),e.width=o.totalWidth,t.pdfPageDetail.push(e),r.y+=e.height,t.enableHeader?s=t.chartHeader.height:(i.y=0,s=0)),i.y+=u,s+=u,t.parent.eventMarkerColloction.map((function(e){var r=c(t.parent.timelineModule.isSingleTier?45:60),a=t.result.page.section.getPages()[t.startPageIndex];t.eventMarker.drawEventMarker(a,i,n,o,e,r)}))}t.headerDetails[l].endIndex=t.startPageIndex,n+=o.totalWidth,(e={}).height=s,e.pageStartX=a,e.startPoint=Pr({},r),t.parent.pdfExportModule.gantt.taskbar.isAutoFit()?e.width=o.totalWidth:e.width=c(o.totalWidth),t.pdfPageDetail.push(e),r.x+=e.width,r.y=0,t.enableHeader?s=t.chartHeader.height:i.y=0,t.headerDetails.indexOf(o)!==t.headerDetails.length-1&&(t.result.page.section.add(),t.startPageIndex=t.result.page.section.count-1,i=t.startPoint=new Xi.PointF(0,0))}));for(var o=0;o<this.predecessorCollection.length;o++){this.predecessorCollection[o].drawPredecessor(this)}},i}(sr),Cr=function(){function t(e){this.isPdfExport=!1,this.parent=e,this.helper=new fr(this.parent),this.pdfDocument=void 0}return t.prototype.getModuleName=function(){return"pdfExport"},t.prototype.destroy=function(){},t.prototype.initGantt=function(){this.pdfDocument=void 0,this.gantt=new Sr(this.parent)},t.prototype.export=function(t,i,r,a){var n=this;this.isBlob=a;var s={requestType:"beforePdfExport",ganttObject:this.parent,cancel:!1};return this.parent.trigger("beforePdfExport",s),(0,e.isNullOrUndefined)(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),(0,e.getValue)("cancel",s)?new Promise((function(e,t){return e()})):new Promise((function(e,a){n.exportWithData(r,e,t,i)}))},t.prototype.exportWithData=function(t,i,r,a){var n=this,s=[];(0,e.isNullOrUndefined)(r)&&(r={}),r.fitToWidthSettings&&r.fitToWidthSettings.isFitToWidth?("CurrentViewData"===r.exportType?this.helper.beforeSinglePageExport.cloneFlatData=(0,e.extend)([],this.parent.currentViewData,null,!0):"AllData"===r.exportType?this.helper.beforeSinglePageExport.cloneFlatData=(0,e.extend)([],this.parent.flatData,null,!0):this.helper.beforeSinglePageExport.cloneFlatData=(0,e.extend)([],this.parent.updatedRecords,null,!0),this.helper.beforeSinglePageExport.cloneCurrentViewData=(0,e.extend)([],this.parent.currentViewData,null,!0),s=this.helper.beforeSinglePageExport.cloneFlatData):s=(0,e.isNullOrUndefined)(r.exportType)?this.parent.updatedRecords:"CurrentViewData"===r.exportType?this.parent.currentViewData:this.parent.flatData,this.initGantt(),(0,e.isNullOrUndefined)(t)?this.pdfDocument=new Xi.PdfDocument:this.pdfDocument=t,this.processExport(s,r,a).then((function(){n.parent.trigger("pdfExportComplete",n.isBlob?{promise:n.blobPromise}:{}),(0,e.isNullOrUndefined)(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.hideSpinner():n.parent.hideMaskRow(),i(n.pdfDocument)}))},t.prototype.processExport=function(t,i,r){var a=this,n=this.pdfDocument.sections.add();return this.processSectionExportProperties(n,i),this.pdfPage=n.pages.add(),this.pdfPageDimensions=this.pdfPage.getClientSize(),new Promise((function(e,r){a.helper.processGridExport(t,a.gantt,i),a.helper.initializePdf(a.pdfDocument),e()})).then((function(){var t=new ar;t.break=Xi.PdfLayoutBreakType.FitElement;var n=a.gantt.drawGrid(a.pdfPage,0,0,t);return a.gantt.drawChart(n),a.helper.exportProps&&a.helper.exportProps.fitToWidthSettings&&a.helper.exportProps.fitToWidthSettings.isFitToWidth&&(a.parent.zoomingProjectStartDate=a.helper.beforeSinglePageExport.zoomingProjectStartDate,a.parent.zoomingProjectEndDate=a.helper.beforeSinglePageExport.zoomingProjectEndDate,a.parent.cloneProjectStartDate=a.helper.beforeSinglePageExport.cloneProjectStartDate,a.parent.cloneProjectEndDate=a.helper.beforeSinglePageExport.cloneProjectEndDate,a.parent.timelineModule.customTimelineSettings=a.helper.beforeSinglePageExport.customTimelineSettings,a.parent.isTimelineRoundOff=a.helper.beforeSinglePageExport.isTimelineRoundOff,a.parent.timelineModule.topTier=a.helper.beforeSinglePageExport.topTier,a.parent.timelineModule.topTierCellWidth=a.helper.beforeSinglePageExport.topTierCellWidth,a.parent.timelineModule.topTierCollection=a.helper.beforeSinglePageExport.topTierCollection,a.parent.timelineModule.bottomTier=a.helper.beforeSinglePageExport.bottomTier,a.parent.timelineModule.bottomTierCellWidth=a.helper.beforeSinglePageExport.bottomTierCellWidth,a.parent.timelineModule.bottomTierCollection=a.helper.beforeSinglePageExport.bottomTierCollection,a.parent.timelineModule.totalTimelineWidth=a.helper.beforeSinglePageExport.totalTimelineWidth,a.parent.timelineModule.timelineStartDate=a.helper.beforeSinglePageExport.timelineStartDate,a.parent.timelineModule.timelineEndDate=a.helper.beforeSinglePageExport.timelineEndDate,a.parent.timelineModule.timelineRoundOffEndDate=a.helper.beforeSinglePageExport.timelineRoundOffEndDate,a.parent.perDayWidth=a.helper.beforeSinglePageExport.perDayWidth,a.parent.updatedConnectorLineCollection=a.helper.beforeSinglePageExport.updatedConnectorLineCollection),a.gantt.changeCloneProjectDates&&(a.parent.cloneProjectStartDate.setHours(0),a.gantt.changeCloneProjectDates=!1),r||(a.isBlob?a.blobPromise=a.pdfDocument.save():!(0,e.isNullOrUndefined)(i)&&i.fileName?a.pdfDocument.save(i.fileName):a.pdfDocument.save("Export.pdf"),a.pdfDocument.destroy()),a.pdfDocument}))},t.prototype.processSectionExportProperties=function(t,i){if((0,e.isNullOrUndefined)(i))this.gantt.ganttStyle=new Yi(i.theme).style;else{var r=new Xi.PdfPageSettings;if((0,e.isNullOrUndefined)(i.pageOrientation)||"Portrait"!==i.pageOrientation?r.orientation=Xi.PdfPageOrientation.Landscape:r.orientation=Xi.PdfPageOrientation.Portrait,(0,e.isNullOrUndefined)(i.pageSize)||(r.size=this.getPageSize(i.pageSize)),t.setPageSettings(r),(0,e.isNullOrUndefined)(i.ganttStyle))this.gantt.ganttStyle=new Yi(i.theme).style;else{var a=new Yi(i.theme).style;this.gantt.ganttStyle=(0,e.extend)({},a,i.ganttStyle,!0)}}},t.prototype.getPageSize=function(e){switch(e){case"Letter":return new Xi.SizeF(612,792);case"Note":return new Xi.SizeF(540,720);case"Legal":return new Xi.SizeF(612,1008);case"A0":return new Xi.SizeF(2380,3368);case"A1":return new Xi.SizeF(1684,2380);case"A2":return new Xi.SizeF(1190,1684);case"A3":return new Xi.SizeF(842,1190);case"A5":return new Xi.SizeF(421,595);case"A6":return new Xi.SizeF(297,421);case"A7":return new Xi.SizeF(210,297);case"A8":return new Xi.SizeF(148,210);case"A9":return new Xi.SizeF(105,148);case"B0":return new Xi.SizeF(2836,4008);case"B1":return new Xi.SizeF(2004,2836);case"B2":return new Xi.SizeF(1418,2004);case"B3":return new Xi.SizeF(1002,1418);case"B4":return new Xi.SizeF(709,1002);case"B5":return new Xi.SizeF(501,709);case"Archa":return new Xi.SizeF(648,864);case"Archb":return new Xi.SizeF(864,1296);case"Archc":return new Xi.SizeF(1296,1728);case"Archd":return new Xi.SizeF(1728,2592);case"Arche":return new Xi.SizeF(2592,3456);case"Flsa":return new Xi.SizeF(612,936);case"HalfLetter":return new Xi.SizeF(396,612);case"Letter11x17":return new Xi.SizeF(792,1224);case"Ledger":return new Xi.SizeF(1224,792);default:return new Xi.SizeF(595,842)}},t}(),Rr=function(){function e(e){this.parent=e,this.bindTreeGridProperties()}return e.prototype.getModuleName=function(){return"virtualScroll"},e.prototype.bindTreeGridProperties=function(){this.parent.treeGrid.enableVirtualization=this.parent.enableVirtualization,_e.TreeGrid.Inject(_e.VirtualScroll)},e.prototype.getTopPosition=function(){var e,t=this.parent.ganttChartModule.scrollElement.querySelector(".e-virtualtable"),i=t.style.transform.split(",");if(i.length>1)e=i[1].trim().split(")")[0];else{var r=t.style.transform;e=r.substring(r.lastIndexOf("(")+1,r.lastIndexOf(")"))}return parseFloat(e)},e.prototype.destroy=function(){},e}()})(),y})()));