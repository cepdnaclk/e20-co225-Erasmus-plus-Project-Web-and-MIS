/*!
*  filename: ej2-treegrid.umd.min.js
*  version : 26.2.14
*  Copyright Syncfusion Inc. 2001 - 2023. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-grids"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-popups")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-grids","@syncfusion/ej2-buttons","@syncfusion/ej2-data","@syncfusion/ej2-popups"],t):t((e=e||self).ej={},e.ej2Base,e.ej2Grids,e.ej2Buttons,e.ej2Data,e.ej2Popups)}(this,function(r,C,I,T,b,V){"use strict";B=function(e,t){return(B=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var B,z=function(e,t){function i(){this.constructor=e}B(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},L=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},j=(F.prototype.setProperties=function(e){for(var t=Object.keys(e),i=0;i<t.length;i++)this[t[parseInt(i.toString(),10)]]=e[t[parseInt(i.toString(),10)]],this.parent&&this.parent.isReact&&"template"===t[parseInt(i.toString(),10)]&&this.parent.clipboardModule.treeGridParent.renderModule.refreshReactColumnTemplateByUid(this.uid)},F);function F(e){this.allowEditing=!0,this.edit={},this.disableHtmlEncode=!0,this.allowReordering=!0,this.showColumnMenu=!0,this.allowFiltering=!0,this.allowSorting=!0,this.allowResizing=!0,this.filter={},C.merge(this,e)}z(H,_=j),L([C.Property(null)],H.prototype,"columns",void 0);var _,L=H;function H(){return null!==_&&_.apply(this,arguments)||this}z(Q,G=L);var G,z=Q;function Q(){return null!==G&&G.apply(this,arguments)||this}K=function(e,t){return(K=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var K,W,Y=function(e,t){function i(){this.constructor=e}K(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},J=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},Y=(W=C.ChildProperty,Y(X,W),J([C.Property("Spinner")],X.prototype,"indicatorType",void 0),X);function X(){return null!==W&&W.apply(this,arguments)||this}$=function(e,t){return($=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var $,Z,J=function(e,t){function i(){this.constructor=e}$(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},e=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},ee=(Z=C.ChildProperty,J(t,Z),e([C.Property()],t.prototype,"field",void 0),e([C.Property()],t.prototype,"operator",void 0),e([C.Property()],t.prototype,"value",void 0),e([C.Property()],t.prototype,"matchCase",void 0),e([C.Property()],t.prototype,"ignoreAccent",void 0),e([C.Property()],t.prototype,"predicate",void 0),e([C.Property({})],t.prototype,"actualFilterValue",void 0),e([C.Property({})],t.prototype,"actualOperator",void 0),e([C.Property()],t.prototype,"type",void 0),e([C.Property()],t.prototype,"ejpredicate",void 0),e([C.Property()],t.prototype,"uid",void 0),e([C.Property()],t.prototype,"isForeignKey",void 0),t);function t(){return null!==Z&&Z.apply(this,arguments)||this}te=C.ChildProperty,J(ie,te),e([C.Collection([],ee)],ie.prototype,"columns",void 0),e([C.Property("FilterBar")],ie.prototype,"type",void 0),e([C.Property()],ie.prototype,"mode",void 0),e([C.Property(!0)],ie.prototype,"showFilterBarStatus",void 0),e([C.Property(1500)],ie.prototype,"immediateModeDelay",void 0),e([C.Property()],ie.prototype,"operators",void 0),e([C.Property(!1)],ie.prototype,"ignoreAccent",void 0),e([C.Property("Parent")],ie.prototype,"hierarchyMode",void 0);var te,J=ie;function ie(){return null!==te&&te.apply(this,arguments)||this}re=function(e,t){return(re=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var re,ne,e=function(e,t){function i(){this.constructor=e}re(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},oe=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},e=(ne=C.ChildProperty,e(ae,ne),oe([C.Property("Both")],ae.prototype,"wrapMode",void 0),ae);function ae(){return null!==ne&&ne.apply(this,arguments)||this}var se,de,oe=function(e,t){function i(){this.constructor=e}se(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},le="https://ej2.syncfusion.com/documentation/treegrid",pe="https://ej2.syncfusion.com/documentation",he=!(se=function(e,t){return(se=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)}),ce=(de=I.Logger,oe(ue,de),ue.prototype.getModuleName=function(){return"logger"},ue.prototype.log=function(e,t){for(var i=e=e instanceof Array?e:[e],r=0;r<i.length;r++){var n,o=I.detailLists[i[parseInt(r.toString(),10)]],a=o.check(t,this.parent);a.success&&(a=(a=o.generateMessage(t,this.parent,a.options)).replace("EJ2Grid","EJ2TreeGrid").replace("* Hierarchy Grid","").replace("* Grouping",""),he&&"primary_column_missing"===i[parseInt(r.toString(),10)]&&(a=a.replace("Editing","Row DragAndDrop"),he=!1),n=a.indexOf("https"),n=a.substring(n),"module_missing"===i[parseInt(r.toString(),10)]?a=a.replace(n,le+"/modules"):"primary_column_missing"===i[parseInt(r.toString(),10)]||"selection_key_missing"===i[parseInt(r.toString(),10)]?a=a.replace(n,pe+"/api/treegrid/column/#isprimarykey"):"grid_remote_edit"===i[parseInt(r.toString(),10)]?a=a.replace(n,le+"/edit"):"virtual_height"===i[parseInt(r.toString(),10)]?a=a.replace(n,le+"/virtual"):"check_datasource_columns"===i[parseInt(r.toString(),10)]?a=a.replace(n,le+"/columns"):"locale_missing"===i[parseInt(r.toString(),10)]&&(a=a.replace(n,le+"/global-local/#localization")),"datasource_syntax_mismatch"===i[parseInt(r.toString(),10)]&&(C.isNullOrUndefined(this.treeGridObj)||C.isNullOrUndefined(this.treeGridObj.dataStateChange))||console[o.logType](a))}},ue.prototype.treeLog=function(e,t,i){this.treeGridObj=i;var r=e=e instanceof Array?e:[e];i.allowRowDragAndDrop&&!i.columns.filter(function(e){return e.isPrimaryKey}).length&&(he=!0,this.log("primary_column_missing",t));for(var n=0;n<r.length;n++){var o=me[r[parseInt(n.toString(),10)]],a=o.check(t,i);a.success&&(a=o.generateMessage(t,i,a.options),console[o.logType](a))}},ue);function ue(e){return I.Grid.Inject(I.Logger),de.call(this,e)||this}var ge,fe,me={mapping_fields_missing:{type:"mapping_fields_missing",logType:"error",check:function(e,t){var i={success:!1};return i=C.isNullOrUndefined(t.idMapping)&&C.isNullOrUndefined(t.childMapping)&&C.isNullOrUndefined(t.parentIdMapping)||!C.isNullOrUndefined(t.idMapping)&&C.isNullOrUndefined(t.parentIdMapping)||C.isNullOrUndefined(t.idMapping)&&!C.isNullOrUndefined(t.parentIdMapping)?{success:!0}:i},generateMessage:function(){return"[EJ2TreeGrid.Error]: MAPPING FIELDS MISSING \nOne of the following fields is missing. It is required for the hierarchical relationship of records in TreeGrid:\n* childMapping\n* idMapping\n* parentIdMapping\nRefer to the following documentation links for more details.\n"+pe+"/api/treegrid#childmapping\n"+pe+"/api/treegrid#idmapping\n"+pe+"/api/treegrid#$parentidmapping"}}},ye="load",Se="rowDataBound",we="dataBound",Ie="queryCellInfo",Re="beforeDataBound",ve="actionBegin",xe="dataStateChange",Ce="actionComplete",be="rowSelecting",De="rowSelected",Me="checkboxChange",Oe="rowDeselected",Pe="toolbarClick",Ee="beforeExcelExport",Ne="beforePdfExport",Ae="resizeStop",Ue="expanded",ke="expanding",qe="collapsed",Te="collapsing",Ve="remoteExpand",Be="localPagedExpandCollapse",ze="pagingActions",Le="printGrid-Init",je="contextMenuOpen",Fe="contextMenuClick",_e="beforeCopy",He="beforePaste",Ge="crudAction",Qe="beginEdit",Ke="beginAdd",We="recordDoubleClick",Ye="cellSave",Je="cellSaved",Xe="cellEdit",$e="batchDelete",Ze="batchCancel",et="batchAdd",tt="beforeBatchDelete",it="beforeBatchAdd",rt="beforeBatchSave",nt="batchSave",ot="key-pressed",at="double-tap",st="virtual-action-args",dt="destroy",lt="data-listener",pt="index-modifier",ht="edit-form",ct="before-batch-cancel",ut="detailDataBound",gt="rowDrag",ft="rowDragStartHelper",mt="rowDrop",yt="rowDragStart",St="rows-add",wt="rows-remove",It="row-draging",Rt="row-dropped",vt="auto-col",xt="rowDeselecting",Ct="e-movablecontent",bt="e-frozencontent",Dt="data-rowindex",d="actionFailure",oe=(ge=function(e,t){return(ge=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)},function(e,t){function i(){this.constructor=e}ge(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Mt=(fe=I.Clipboard,oe(Ot,fe),Ot.prototype.setCopyData=function(e){var t="copyContent",i="getCopyData",r=this.treeGridParent.getCurrentViewRecords();if(""===window.getSelection().toString()){this.clipBoardTextArea.value=this[t]="";var n=this.treeGridParent.grid.getRows();if("Cell"!==this.treeGridParent.selectionSettings.mode){for(var o,a,s=this.treeGridParent.getSelectedRowIndexes().sort(function(e,t){return e-t}),d=0;d<s.length;d++)0<d&&(this.treeCopyContent+="\n"),n[s[parseInt(d.toString(),10)]].classList.contains("e-summaryrow")||(o=[].slice.call(n[s[parseInt(d.toString(),10)]].querySelectorAll(".e-rowcell")),a=this.treeGridParent.getSelectedRecords()[parseInt(d.toString(),10)].uniqueID,-1===this.copiedUniqueIdCollection.indexOf(a)&&("Parent"!==this.treeGridParent.copyHierarchyMode&&"Both"!==this.treeGridParent.copyHierarchyMode||this.parentContentData(r,s[parseInt(d.toString(),10)],n,e,d),this[i](o,!1,"\t",e),this.treeCopyContent+=this[t],this.copiedUniqueIdCollection.push(a),this[t]="","Child"!==this.treeGridParent.copyHierarchyMode&&"Both"!==this.treeGridParent.copyHierarchyMode||this.childContentData(r,s[parseInt(d.toString(),10)],n,e)));if(e){for(var l=[],d=0;d<this.treeGridParent.getVisibleColumns().length;d++)l[parseInt(d.toString(),10)]=this.treeGridParent.getVisibleColumns()[parseInt(d.toString(),10)].headerText;this[i](l,!1,"\t",e),this.treeCopyContent=this[t]+"\n"+this.treeCopyContent}var p={data:this.treeCopyContent,cancel:!1};this.treeGridParent.trigger(_e,p),p.cancel||(this.clipBoardTextArea.value=this[t]=p.data,C.Browser.userAgent.match(/ipad|ipod|iphone/i)?this.clipBoardTextArea.setSelectionRange(0,this.clipBoardTextArea.value.length):this.clipBoardTextArea.select(),this.isSelect=!0,this.copiedUniqueIdCollection=[],this.treeCopyContent="")}else fe.prototype.setCopyData.call(this,e)}},Ot.prototype.parentContentData=function(e,t,i,r,n){var o="copyContent",a="parentItem",s="uniqueID";if(!C.isNullOrUndefined(e[parseInt(t.toString(),10)][a]))for(var d=e[parseInt(t.toString(),10)][a].level,l=0;l<d+1;l++)for(var p=0;p<e.length;p++)if(!C.isNullOrUndefined(e[parseInt(t.toString(),10)][a])&&e[parseInt(p.toString(),10)][s]===e[parseInt(t.toString(),10)][a][s]){t=p;var h=[].slice.call(i[parseInt(t.toString(),10)].querySelectorAll(".e-rowcell")),c=e[parseInt(p.toString(),10)][s];if(-1===this.copiedUniqueIdCollection.indexOf(c)){this.getCopyData(h,!1,"\t",r),this.treeCopyContent=0<n?this.treeCopyContent+this[o]+"\n":this[o]+"\n"+this.treeCopyContent,this.copiedUniqueIdCollection.push(c),this[o]="";break}}},Ot.prototype.copy=function(e){fe.prototype.copy.call(this,e)},Ot.prototype.paste=function(e,t,i){fe.prototype.paste.call(this,e,t,i)},Ot.prototype.getModuleName=function(){return"clipboard"},Ot.prototype.destroy=function(){fe.prototype.destroy.call(this)},Ot.prototype.childContentData=function(e,t,i,r){var n="copyContent",o="uniqueID";if(e[parseInt(t.toString(),10)].hasChildRecords)for(var a=e[parseInt(t.toString(),10)].childRecords,s=0;s<a.length;s++)for(var d,l,p=0;p<e.length;p++)if(!C.isNullOrUndefined(a[parseInt(s.toString(),10)][o])&&e[parseInt(p.toString(),10)][o]===a[parseInt(s.toString(),10)][o]){C.isNullOrUndefined(i[parseInt(p.toString(),10)])||i[parseInt(p.toString(),10)].classList.contains("e-summaryrow")||(d=[].slice.call(i[parseInt(p.toString(),10)].querySelectorAll(".e-rowcell")),l=e[parseInt(p.toString(),10)][o],-1===this.copiedUniqueIdCollection.indexOf(l)&&(this.getCopyData(d,!1,"\t",r),this.treeCopyContent+="\n"+this[n],this[n]="",this.copiedUniqueIdCollection.push(l),this.childContentData(e,p,i,r)));break}},Ot);function Ot(e,t){var i=fe.call(this,e.grid,t)||this;return i.treeCopyContent="",i.copiedUniqueIdCollection=[],i.treeGridParent=e,i.serviceLocator=t,i}function S(e){return e.dataSource instanceof b.DataManager&&((e=e.dataSource.adaptor)instanceof b.ODataAdaptor||e instanceof b.WebApiAdaptor||e instanceof b.WebMethodAdaptor||e instanceof b.CacheAdaptor||e instanceof b.UrlAdaptor)}function w(e){return!!(e.dataSource&&"result"in e.dataSource)}function Pt(e){for(var t=0;t<e.columns.length;t++)if(e.columns[parseInt(t.toString(),10)].showCheckbox)return!0;return!1}function Et(e){return!((C.isNullOrUndefined(e.grid.searchSettings.key)||""===e.grid.searchSettings.key||"Child"!==e.searchSettings.hierarchyMode&&"None"!==e.searchSettings.hierarchyMode)&&(!e.allowFiltering||!e.grid.filterSettings.columns.length||"Child"!==e.filterSettings.hierarchyMode&&"None"!==e.filterSettings.hierarchyMode))}function Nt(e){for(var t=[],i=0,r=Object.keys(e).length;i<r;i++)I.getObject("hasChildRecords",e[parseInt(i.toString(),10)])&&t.push(e[parseInt(i.toString(),10)]);return t}function y(e,t,i){var r,t=C.isNullOrUndefined(t.parentItem)?null:x(e,t.parentItem.uniqueID);return null==t||(!e.initialRender||C.isNullOrUndefined(t[e.expandStateMapping])||t[e.expandStateMapping]?!1!==t.expanded&&(!t.parentItem||((r=x(e,t.parentItem.uniqueID))&&e.initialRender&&!C.isNullOrUndefined(r[e.expandStateMapping])&&!r[e.expandStateMapping]?r.expanded=!1:(!r||!1!==r.expanded)&&(!r||y(e,r)))):t.expanded=!1)}function R(e){var t=[];if(C.isNullOrUndefined(e)||!e.hasChildRecords&&!C.isNullOrUndefined(e.childRecords)&&!e.childRecords.length)return[];if(!C.isNullOrUndefined(e.childRecords))for(var i=e.childRecords.filter(function(e){return!e.isSummaryRow}),r=0,n=Object.keys(i).length;r<n;r++)t.push(i[parseInt(r.toString(),10)]),(i[parseInt(r.toString(),10)].hasChildRecords||!C.isNullOrUndefined(i[parseInt(r.toString(),10)].childRecords)&&i[parseInt(r.toString(),10)].childRecords.length)&&(t=t.concat(R(i[parseInt(r.toString(),10)])));return t}function v(e){return!S(e)||(e=e.dataSource,!C.isNullOrUndefined(e.ready))}function D(e){for(var t=[],i=0;e&&i<e.length;i++){for(var r=Object.keys(e[parseInt(i.toString(),10)]),n={},o=0;o<r.length;o++)n[r[parseInt(o.toString(),10)]]=e[parseInt(i.toString(),10)][r[parseInt(o.toString(),10)]];t.push(n)}return t}function At(e){return delete e.hasChildRecords,delete e.childRecords,delete e.index,delete e.parentItem,delete e.level,delete e.taskData,delete e.uniqueID,e}function x(e,t,i){return(i?e.uniqueIDFilterCollection:e.uniqueIDCollection)[""+t]}function Ut(e){e=window.getComputedStyle(e);return"none"===e.display||"hidden"===e.visibility}i.prototype.getModuleName=function(){return"selection"},i.prototype.addEventListener=function(){this.parent.on("dataBoundArg",this.headerCheckbox,this),this.parent.on("columnCheckbox",this.columnCheckbox,this),this.parent.on("updateGridActions",this.updateGridActions,this),this.parent.grid.on("colgroup-refresh",this.headerCheckbox,this),this.parent.on("checkboxSelection",this.checkboxSelection,this)},i.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("dataBoundArg",this.headerCheckbox),this.parent.off("columnCheckbox",this.columnCheckbox),this.parent.grid.off("colgroup-refresh",this.headerCheckbox),this.parent.off("checkboxSelection",this.checkboxSelection),this.parent.off("updateGridActions",this.updateGridActions))},i.prototype.destroy=function(){this.removeEventListener()},i.prototype.checkboxSelection=function(e){var t,i,e=I.getObject("target",e),r=I.parentsUntil(e,"e-checkbox-wrapper");r&&0<r.querySelectorAll(".e-treecheckselect").length?(t=r.querySelector('input[type="checkbox"]'),(i=[]).push(e.closest("tr").rowIndex),this.selectCheckboxes(i),this.triggerChkChangeEvent(t,t.nextElementSibling.classList.contains("e-check"),e.closest("tr"))):r&&0<r.querySelectorAll(".e-treeselectall").length&&this.parent.autoCheckHierarchy&&(i=!r.querySelector(".e-frame").classList.contains("e-check")&&!r.querySelector(".e-frame").classList.contains("e-stop"),this.headerSelection(i),t=r.querySelector('input[type="checkbox"]'),this.triggerChkChangeEvent(t,i,e.closest("tr"))),!C.isNullOrUndefined(this.parent.parentQuery)&&this.parent.selectionSettings.persistSelection&&0<this.parent.columnModel.filter(function(e){return"checkbox"===e.type}).length&&S(this.parent)&&0<this.parent.parentQuery.length&&((r=this.parent.query.queries).push.apply(r,this.parent.parentQuery),this.parent.parentQuery=[])},i.prototype.triggerChkChangeEvent=function(e,t,i){var r=this.parent.getCurrentViewRecords()[i.rowIndex],t={checked:t,target:e,rowElement:i,rowData:e.classList.contains("e-treeselectall")?this.parent.getCheckedRecords():r};this.parent.trigger(Me,t)},i.prototype.getCheckboxcolumnIndex=function(){for(var e,t,i=this.parent.stackedHeader?this.parent.columnModel:this.parent.columns,r=0;r<i.length;r++)i[parseInt(r.toString(),10)].showCheckbox&&(e=i[parseInt(r.toString(),10)].uid);for(var n=this.parent.getHeaderContent().querySelectorAll(".e-headercelldiv").length,o=0;o<n;o++)this.parent.getHeaderContent().querySelectorAll(".e-headercelldiv")[parseInt(o.toString(),10)].getAttribute("e-mappinguid")===e&&(t=o);return t},i.prototype.headerCheckbox=function(){var e,t,i;this.columnIndex=this.getCheckboxcolumnIndex(),-1<this.columnIndex&&0===this.parent.getHeaderContent().querySelectorAll(".e-treeselectall").length?(e=this.parent.getHeaderContent().querySelectorAll(".e-headercelldiv")[this.columnIndex],i=this.parent.createElement("input",{className:"e-treeselectall",attrs:{type:"checkbox"}}),(t=T.createCheckBox(this.parent.createElement,!1,{checked:!1,label:" "})).classList.add("e-hierarchycheckbox"),t.insertBefore(i.cloneNode(),t.firstChild),C.isNullOrUndefined(e)||e.insertBefore(t,e.firstChild),this.parent.autoCheckHierarchy&&this.headerSelection()):-1<this.columnIndex&&0<this.parent.getHeaderContent().querySelectorAll(".e-treeselectall").length&&(i=(t=this.parent.getHeaderContent().querySelectorAll(".e-checkbox-wrapper")[0]).querySelector(".e-frame").classList.contains("e-check"),this.parent.autoCheckHierarchy)&&i&&this.headerSelection(i)},i.prototype.renderColumnCheckbox=function(e){var t=this.parent.createElement("input",{className:"e-treecheckselect",attrs:{type:"checkbox","aria-label":"checkbox"}}),i=e.data,e=(e.cell.classList.add("e-treegridcheckbox"),e.cell.setAttribute("aria-label","checkbox"),!C.isNullOrUndefined(i.checkboxState)&&"uncheck"!==i.checkboxState),e=T.createCheckBox(this.parent.createElement,!1,{checked:e,label:" "});return e.classList.add("e-hierarchycheckbox"),this.parent.allowTextWrap&&(e.querySelector(".e-frame").style.width="18px"),"indeterminate"===i.checkboxState&&(i=e.querySelectorAll(".e-frame")[0],C.removeClass([i],["e-check","e-stop","e-uncheck"]),e.querySelector(".e-frame").classList.add("e-stop")),e.insertBefore(t.cloneNode(),e.firstChild),e},i.prototype.columnCheckbox=function(e){var t,i,r=this.renderColumnCheckbox(e),n=e.cell.querySelector(".e-treecolumn-container");C.isNullOrUndefined(n)?(t=this.parent.createElement("span",{className:"e-treecheckbox"}),i=e.cell.innerHTML,e.cell.innerHTML="",t.innerHTML=i,(i=this.parent.createElement("div",{className:"e-treecheckbox-container"})).appendChild(r),i.appendChild(t),e.cell.appendChild(i)):e.cell.querySelector(".e-hierarchycheckbox")||n.insertBefore(r,n.querySelectorAll(".e-treecell")[0])},i.prototype.selectCheckboxes=function(e){C.isNullOrUndefined(e)&&this.parent.trigger(d,{error:"The provided value for the rowIndexes is undefined. Please ensure the rowIndexes contains number."});for(var t=0;t<e.length;t++){for(var i=this.parent.getCurrentViewRecords()[e[parseInt(t.toString(),10)]],r=x(this.parent,i.uniqueID),n="uncheck"===(i=r).checkboxState?"check":"uncheck",o=(i.checkboxState=n,Object.keys(i)),a=0;a<o.length;a++)Object.prototype.hasOwnProperty.call(r,o[parseInt(a.toString(),10)])&&(r[o[parseInt(a.toString(),10)]]=i[o[parseInt(a.toString(),10)]]);this.traverSelection(i,n,!1),this.parent.autoCheckHierarchy&&this.headerSelection()}},i.prototype.traverSelection=function(e,t,i){if(this.updateSelectedItems(e,t),!i&&e.parentItem&&this.parent.autoCheckHierarchy&&this.updateParentSelection(e.parentItem),e.childRecords&&this.parent.autoCheckHierarchy)for(var r=e.childRecords,n=(r=!C.isNullOrUndefined(this.parent.filterModule)&&0<this.parent.filterModule.filteredResult.length&&this.parent.autoCheckHierarchy?this.getFilteredChildRecords(r):r).length,o=0;o<n;o++)r[parseInt(o.toString(),10)].isSummaryRow||(r[parseInt(o.toString(),10)].hasChildRecords?this.traverSelection(r[parseInt(o.toString(),10)],t,!0):this.updateSelectedItems(r[parseInt(o.toString(),10)],t))},i.prototype.getFilteredChildRecords=function(e){var t=this;return e.filter(function(e){return-1<t.parent.filterModule.filteredResult.indexOf(e)})},i.prototype.updateParentSelection=function(e){var t,i=[],e=x(this.parent,e.uniqueID),r=(e&&e.childRecords&&(i=e.childRecords),t=(i=!C.isNullOrUndefined(this.parent.filterModule)&&0<this.parent.filterModule.filteredResult.length&&this.parent.autoCheckHierarchy?this.getFilteredChildRecords(i):i)&&i.length,0),n=0;if(!C.isNullOrUndefined(e)){for(var o=0;o<i.length;o++){var a=x(this.parent,i[parseInt(o.toString(),10)].uniqueID);C.isNullOrUndefined(a)||("indeterminate"===a.checkboxState?r++:"check"===a.checkboxState&&n++)}0<r||0<n&&n!==t?e.checkboxState="indeterminate":(0!==n||e.hasFilteredChildRecords&&!C.isNullOrUndefined(e.hasFilteredChildRecords)||C.isNullOrUndefined(this.parent.dataResults.actionArgs)||"searching"!==this.parent.dataResults.actionArgs.requestType&&"filtering"!==this.parent.dataResults.actionArgs.requestType||"check"!==e.checkboxState)&&(0===n&&0===r||0===n&&e.hasFilteredChildRecords&&!C.isNullOrUndefined(this.parent.dataResults.actionArgs)&&("searching"===this.parent.dataResults.actionArgs.requestType||"filtering"===this.parent.dataResults.actionArgs.requestType)&&"check"===e.checkboxState)?e.checkboxState="uncheck":e.checkboxState="check",this.updateSelectedItems(e,e.checkboxState),e.parentItem&&this.updateParentSelection(e.parentItem)}},i.prototype.headerSelection=function(e){var t,i=this,r=!1;if(!C.isNullOrUndefined(this.parent.filterModule)&&0<this.parent.filterModule.filteredResult.length&&(o=this.parent.filterModule.filteredResult,0===this.filteredList.length&&(this.filteredList=o),this.parent.grid.searchSettings.key.length?this.searchingRecords=o:r=this.filteredList!==o&&(this.filteredList=o,!0)),0<this.filteredList.length&&(this.parent.filterSettings.columns.length||!this.filteredList.length||this.parent.grid.searchSettings.key.length||(this.filteredList=[]),this.searchingRecords.length)&&!C.isNullOrUndefined(e)&&(this.filteredList=this.searchingRecords),t=!C.isNullOrUndefined(this.parent.filterModule)&&0===this.parent.filterModule.filteredResult.length&&0===this.parent.getCurrentViewRecords().length&&0<this.parent.filterSettings.columns.length||!C.isNullOrUndefined(this.parent.filterModule)&&0<this.filteredList.length?this.filteredList:this.parent.flatData,t=S(this.parent)?this.parent.getCurrentViewRecords():t,!C.isNullOrUndefined(e))for(var n=0;n<t.length;n++)e?"check"===t[parseInt(n.toString(),10)].checkboxState||r||(t[parseInt(n.toString(),10)].checkboxState="check",this.updateSelectedItems(t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)].checkboxState)):-1<this.selectedItems.indexOf(t[parseInt(n.toString(),10)])&&(t[parseInt(n.toString(),10)].checkboxState="uncheck",this.updateSelectedItems(t[parseInt(n.toString(),10)],t[parseInt(n.toString(),10)].checkboxState),this.parent.autoCheckHierarchy)&&this.updateParentSelection(t[parseInt(n.toString(),10)]);!1===e&&this.parent.enableVirtualization&&(this.selectedItems=[],this.selectedIndexes=[],t.filter(function(e){e.checkboxState="uncheck",i.updateSelectedItems(e,e.checkboxState)}));var o=this.selectedItems.length,a=this.parent.getHeaderContent().querySelectorAll(".e-frame")[0];0<o&&0<t.length?o===t.length||e?(C.removeClass([a],["e-stop"]),a.classList.add("e-check")):(C.removeClass([a],["e-check"]),a.classList.add("e-stop")):C.removeClass([a],["e-check","e-stop"])},i.prototype.updateSelectedItems=function(t,e){var i,r=this.parent.grid.currentViewData.filter(function(e){return e.uniqueID===t.uniqueID}),r=this.parent.grid.currentViewData.indexOf(r[0]),n=x(this.parent,t.uniqueID),o=this.parent.getRows()[parseInt(r.toString(),10)],n=(-1<r&&(i=void 0,(this.parent.frozenRows||this.parent.getFrozenColumns())&&(i=this.parent.getDataRows()[parseInt(r.toString(),10)]),i=(o.querySelectorAll(".e-hierarchycheckbox .e-frame")[0]?o:i).querySelectorAll(".e-hierarchycheckbox .e-frame")[0],C.isNullOrUndefined(i)||C.removeClass([i],["e-check","e-stop","e-uncheck"])),"check"===((n=C.isNullOrUndefined(n=n)?t:n).checkboxState=e)&&C.isNullOrUndefined(t.isSummaryRow)?(-1!==r&&-1===this.selectedIndexes.indexOf(r)&&this.selectedIndexes.push(r),-1===this.selectedItems.indexOf(n)&&-1!==r&&!C.isNullOrUndefined(this.parent.filterModule)&&0<this.parent.filterModule.filteredResult.length&&this.selectedItems.push(n),-1===this.selectedItems.indexOf(n)&&(this.parent.enableVirtualization||this.parent.allowPaging)&&!C.isNullOrUndefined(this.parent.filterModule)&&0<this.parent.filterModule.filteredResult.length&&this.selectedItems.push(n),-1!==this.selectedItems.indexOf(n)||C.isNullOrUndefined(this.parent.filterModule)||0!==this.parent.filterModule.filteredResult.length||this.selectedItems.push(n),-1===this.selectedItems.indexOf(n)&&C.isNullOrUndefined(this.parent.filterModule)&&this.selectedItems.push(n)):"uncheck"!==e&&"indeterminate"!==e||!C.isNullOrUndefined(t.isSummaryRow)||(-1!==(n=this.selectedItems.indexOf(n))&&this.selectedItems.splice(n,1),-1!==this.selectedIndexes.indexOf(r)&&(n=this.selectedIndexes.indexOf(r),this.selectedIndexes.splice(n,1))),"indeterminate"===e?"e-stop":"e-"+e);-1<r&&(C.isNullOrUndefined(i)||(i.classList.add(n),o.querySelector(".e-treecheckselect").setAttribute("aria-checked","check"===e?"true":"uncheck"===e?"false":"mixed")))},i.prototype.updateGridActions=function(e){var r=this,t=e.requestType;if(Pt(this.parent)&&this.parent.autoCheckHierarchy)if("sorting"===t||"paging"===t){var i,n=this.parent.grid.getRows(),o=(i=this.parent.getCurrentViewRecords()).length;this.selectedIndexes=[];for(var a=0;a<o;a++)n[parseInt(a.toString(),10)].classList.contains("e-summaryrow")||this.updateSelectedItems(i[parseInt(a.toString(),10)],i[parseInt(a.toString(),10)].checkboxState)}else if("delete"===t||"add"===e.action){var s=[];"delete"===t?s=e.data:s.push(e.data);for(var d,a=0;a<s.length;a++)"delete"===t&&(d=this.parent.flatData.indexOf(s[parseInt(a.toString(),10)]),d=this.selectedIndexes.indexOf(d),this.selectedIndexes.splice(d,1),this.updateSelectedItems(s[parseInt(a.toString(),10)],"uncheck")),C.isNullOrUndefined(s[parseInt(a.toString(),10)].parentItem)||this.updateParentSelection(s[parseInt(a.toString(),10)].parentItem)}else"add"===e.requestType&&this.parent.autoCheckHierarchy?e.data.checkboxState="uncheck":"filtering"!==t&&"searching"!==t&&("refresh"!==t||S(this.parent))||(this.selectedItems=[],this.selectedIndexes=[],(i=!C.isNullOrUndefined(this.parent.filterModule)&&0<this.parent.filterModule.filteredResult.length?this.parent.filterModule.filteredResult:this.parent.flatData).forEach(function(e){if(r.parent.enableVirtualization){e.hasChildRecords&&0<e.childRecords.length?r.updateParentSelection(e):r.updateSelectedItems(e,e.checkboxState);for(var t=R(e),t=r.getFilteredChildRecords(t),i=0;i<t.length;i++)t[parseInt(i.toString(),10)].hasChildRecords?r.updateParentSelection(t[parseInt(i.toString(),10)]):t[parseInt(i.toString(),10)].hasChildRecords||C.isNullOrUndefined(t[parseInt(i.toString(),10)])||r.updateSelectedItems(t[parseInt(i.toString(),10)],t[parseInt(i.toString(),10)].checkboxState)}else e.hasChildRecords?r.updateParentSelection(e):r.updateSelectedItems(e,e.checkboxState)}),this.headerSelection())},i.prototype.getCheckedrecords=function(){return this.selectedItems},i.prototype.getCheckedRowIndexes=function(){return this.selectedIndexes};var kt=i;function i(e){this.parent=e,this.selectedItems=[],this.selectedIndexes=[],this.filteredList=[],this.searchingRecords=[],this.addEventListener()}Tt.prototype.getModuleName=function(){return"print"},Tt.prototype.addEventListener=function(){this.parent.grid.on(Le,this.printTreeGrid,this)},Tt.prototype.removeEventListener=function(){this.parent.grid.off(Le,this.printTreeGrid)},Tt.prototype.printTreeGrid=function(e){var t=I.getObject("printgrid",e),e=I.getObject("element",e);t.addEventListener(Ie,this.parent.grid.queryCellInfo),t.addEventListener(Se,this.parent.grid.rowDataBound),t.addEventListener(Re,this.parent.grid.beforeDataBound),C.addClass([e],"e-treegrid")},Tt.prototype.print=function(){this.parent.grid.print()},Tt.prototype.destroy=function(){this.removeEventListener()};var qt=Tt;function Tt(e){this.parent=e,I.Grid.Inject(I.Print),this.addEventListener()}Vt=function(e,t){return(Vt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Vt,Bt,oe=function(e,t){function i(){this.constructor=e}Vt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},zt=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},oe=(Bt=C.ChildProperty,oe(Lt,Bt),zt([C.Property()],Lt.prototype,"fields",void 0),zt([C.Property(!1)],Lt.prototype,"ignoreCase",void 0),zt([C.Property("contains")],Lt.prototype,"operator",void 0),zt([C.Property()],Lt.prototype,"key",void 0),zt([C.Property()],Lt.prototype,"hierarchyMode",void 0),Lt);function Lt(){return null!==Bt&&Bt.apply(this,arguments)||this}jt=function(e,t){return(jt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var jt,Ft,zt=function(e,t){function i(){this.constructor=e}jt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},n=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},zt=(Ft=C.ChildProperty,zt(_t,Ft),n([C.Property("Row")],_t.prototype,"mode",void 0),n([C.Property("Flow")],_t.prototype,"cellSelectionMode",void 0),n([C.Property("Single")],_t.prototype,"type",void 0),n([C.Property(!1)],_t.prototype,"persistSelection",void 0),n([C.Property("Default")],_t.prototype,"checkboxMode",void 0),n([C.Property(!1)],_t.prototype,"checkboxOnly",void 0),n([C.Property(!0)],_t.prototype,"enableToggle",void 0),_t);function _t(){return null!==Ft&&Ft.apply(this,arguments)||this}Gt.prototype.RowModifier=function(t){var i,r,e,n;t.data&&(e=(i=t.data).parentItem,C.isNullOrUndefined(i.parentItem)||Et(this.parent)||this.parent.allowPaging&&"Root"!==this.parent.pageSettings.pageSizeMode&&(!S(this.parent)||v(this.parent))||(!this.parent.initialRender||(C.isNullOrUndefined(e[this.parent.expandStateMapping])||e[this.parent.expandStateMapping])&&!this.parent.enableCollapseAll)&&y(this.parent,t.data,this.parent.grid.getCurrentViewRecords())||C.isNullOrUndefined(t.row)||(t.row.style.display="none",e=this.parent.grid.getRowsObject(),this.parent.grid.isFrozenGrid())||C.isNullOrUndefined(t.row.getAttribute("data-uid"))||(e.filter(function(e){return e.uid===t.row.getAttribute("data-uid")})[0].visible=!1),S(this.parent)&&!v(this.parent)&&(r=this.parent,0<(e=this.parent.getCurrentViewRecords().filter(function(e){return C.getValue(r.idMapping,e)===C.getValue(r.parentIdMapping,i)})).length)&&!e[0].isSummaryRow&&!C.isNullOrUndefined(t.row)&&(e=e[0].expanded?"table-row":"none",t.row.setAttribute("style","display: "+e+";")),I.getObject("isSummaryRow",t.data)&&C.addClass([t.row],"e-summaryrow"),C.isNullOrUndefined(t.row)||(t.row.querySelector(".e-treegridexpand")?t.row.setAttribute("aria-expanded","true"):t.row.querySelector(".e-treegridcollapse")&&t.row.setAttribute("aria-expanded","false"),this.parent.enableCollapseAll&&this.parent.initialRender&&(C.isNullOrUndefined(i.parentItem)||(t.row.style.display="none"))),this.parent.rowDragAndDropModule&&this.parent.grid.rowDragAndDropModule&&(this.parent.grid.rowDragAndDropModule.dragStartData||this.parent.rowDragAndDropModule.draggedRecord)&&this.parent.getContentTable().scrollHeight<=this.parent.getContent().clientHeight&&(this.parent.getVisibleRecords()[this.parent.getVisibleRecords().length-1].uniqueID!==t.data.uniqueID||C.isNullOrUndefined(t.row)||t.row.cells[0].classList.contains("e-lastrowcell")||this.parent.lastRowBorder(t.row,!0)),this.parent.isReact?(n=this).parent.renderReactTemplates(function(){n.parent.trigger(Se,t)}):this.parent.trigger(Se,t))},Gt.prototype.cellRender=function(e){if(e.data){var t,i=this.parent.grid,r=e.data,n=C.isNullOrUndefined(r.filterLevel)?r.level:r.filterLevel,o=0,a=this.parent.getColumnByUid(e.column.uid),s=r.isSummaryRow,d=this.parent.getFrozenColumns(),l=(C.isNullOrUndefined(r.parentItem)?r:r.parentItem).index,p=this.parent.enableColumnVirtualization&&!this.parent.initialRender?this.parent.getVirtualColIndexByUid(e.column.uid):i.getColumnIndexByUid(e.column.uid);if(p!==this.parent.treeColumnIndex||"add"!==e.requestType&&"rowDragAndDrop"!==e.requestType&&"delete"!==e.requestType&&!C.isNullOrUndefined(e.cell.querySelector(".e-treecell")))this.templateResult&&(this.templateResult=null);else{for(var h=C.createElement("div",{className:"e-treecolumn-container"}),c=C.createElement("span",{className:"e-icons e-none",styles:"width: 10px; display: inline-block"}),u=0;u<n;u++)o+=10,h.appendChild(c.cloneNode());var g,p=C.isNullOrUndefined(r.hasFilteredChildRecords)?r.hasChildRecords:r.hasFilteredChildRecords;(p=p&&!C.isNullOrUndefined(r.childRecords)?this.parent.isFromGantt&&!this.parent.loadChildOnDemand?r.hasChildRecords:!(0===r.childRecords.length):p)?(C.addClass([e.cell],"e-treerowcell"),e.cell.setAttribute("aria-expanded",r.expanded?"true":"false"),p=C.createElement("span",{className:"e-icons"}),g=void 0,g=this.parent.initialRender?r.expanded&&(C.isNullOrUndefined(r[this.parent.expandStateMapping])||r[this.parent.expandStateMapping])&&!this.parent.enableCollapseAll:!(!r.expanded||!y(this.parent,r,this.parent.grid.getCurrentViewRecords())),C.addClass([p],g?"e-treegridexpand":"e-treegridcollapse"),o+=18,h.appendChild(p),c.style.width="4px",o+=7,h.appendChild(c.cloneNode())):!n&&r.level||(o+=20,h.appendChild(c.cloneNode()),h.appendChild(c.cloneNode())),g=C.createElement("span",{className:"e-treecell"}),this.parent.allowTextWrap&&(g.style.width="Calc(100% - "+o+"px)"),C.addClass([e.cell],"e-gridrowindex"+l+"level"+r.level),this.updateTreeCell(e,g),h.appendChild(g),e.cell.appendChild(h)}0<i.getFrozenLeftColumnsCount()||0<i.getFrozenRightColumnsCount()?(p=i.getFrozenRightColumns(),t=i.getFrozenLeftColumns(),m=i.getMovableColumns(),(0<p.length&&p[0].field===e.column.field||0<t.length&&t[0].field===e.column.field||0<m.length&&m[0].field===e.column.field)&&C.addClass([e.cell],"e-gridrowindex"+l+"level"+r.level)):(d>this.parent.treeColumnIndex&&0<d&&i.getColumnIndexByUid(e.column.uid)===d||d<this.parent.treeColumnIndex&&0<d&&(i.getColumnIndexByUid(e.column.uid)===d||i.getColumnIndexByUid(e.column.uid)===d-1)||d===this.parent.treeColumnIndex&&0<d&&i.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex-1)&&C.addClass([e.cell],"e-gridrowindex"+l+"level"+r.level),!C.isNullOrUndefined(a)&&a.showCheckbox&&(this.parent.notify("columnCheckbox",e),this.parent.allowTextWrap)&&(p=e.cell.querySelectorAll(".e-frame")[0],o=o+parseInt(p.style.width,16)+10,(g=i.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex?e.cell.querySelector(".e-treecell"):e.cell.querySelector(".e-treecheckbox")).style.width="Calc(100% - "+o+"px)"),s&&(C.addClass([e.cell],"e-summarycell"),t=I.getObject(e.column.field,e.data),t=C.isNullOrUndefined(t)?null:t,null!=e.cell.querySelector(".e-treecell")?e.cell.querySelector(".e-treecell").innerHTML=t:e.column.template?e.cell.innerHTML=null:e.cell.innerHTML=t),this.parent.args=e;var f,m=C.getValue("columnModel",this.parent)[this.parent.treeColumnIndex];C.isNullOrUndefined(this.parent.rowTemplate)&&!this.parent.isReact||this.parent.isReact&&!e.column.template?this.parent.trigger(Ie,e):this.parent.isReact&&m.field!==e.column.field&&(f=this).parent.renderReactTemplates(function(){f.parent.trigger(Ie,e)})}},Gt.prototype.updateTreeCell=function(e,t){var i=C.getValue("columnModel",this.parent)[this.parent.treeColumnIndex],r="templateFn",n=e.column.index,n=(C.isNullOrUndefined(i.field)&&e.cell.setAttribute("data-colindex",n+""),i.field!==e.column.field||C.isNullOrUndefined(i.template)||(e.column.template=i.template,e.column[r]=I.templateCompiler(e.column.template),e.cell.classList.add("e-templatecell")),(null!=e.cell.querySelector(".e-treecell")?e.cell.querySelector(".e-treecell"):e.cell).innerHTML);if("object"==typeof e.column.template&&this.templateResult)I.appendChildren(t,this.templateResult),this.templateResult=null,e.cell.innerHTML="";else if(e.cell.classList.contains("e-templatecell")){var o=e.cell.children.length,a=this.parent.element.id+e.column.uid;if(i.field!==e.column.field||C.isNullOrUndefined(i.template))for(;0<o;o=e.cell.children.length)t.appendChild(e.cell.children[parseInt(0..toString(),10)]);else{var s,i="portals";this.parent.isReact&&"string"!=typeof e.column.template?(e.column[r](e.data,this.parent,"columnTemplate",a,null,null,t),C.isNullOrUndefined(this.parent.grid[i])&&(this.parent.grid[i]=this.parent[i]),this.parent.notify("renderReactTemplate",this.parent[i]),(s=this).parent.renderReactTemplates(function(){s.parent.trigger(Ie,e)})):(i=e.column[r](I.extend({index:""},e.data),this.parent,"template",a,this.parent.isStringTemplate),I.appendChildren(t,i)),delete e.column.template,delete e.column[r],e.cell.innerHTML=""}}else t.innerHTML=n,e.cell.innerHTML=""},Gt.prototype.refreshReactColumnTemplateByUid=function(d){var l=this;this.parent.isReact&&this.parent.clearTemplate(["columnTemplate"],void 0,function(){var e=l.parent.grid.getRowsObject(),t=l.parent.getDataRows(),i=l.parent.grid.getIndentCount(),r=l.parent.grid.getNormalizedColumnIndex(d);if(0!==t.length)for(var n,o,a,s=0;s<e.length;s++)e[parseInt(s.toString(),10)].isDataRow&&!C.isNullOrUndefined(e[parseInt(s.toString(),10)].index)&&(n=e[parseInt(s.toString(),10)].cells[parseInt(r.toString(),10)],a=new I.CellRenderer(l.parent.grid,l.parent.grid.serviceLocator),o=t.length>=e.length?l.parent.getCellFromIndex(e[parseInt(s.toString(),10)].index,r-i):l.parent.getRows()[e[parseInt(s.toString(),10)].index].querySelector(".e-templatecell"),a.refreshTD(o,n,e[parseInt(s.toString(),10)].data,{index:e[parseInt(s.toString(),10)].index}),a=l.parent.getRows()[parseInt(s.toString(),10)].cells[parseInt(r.toString(),10)],l.cellRender({data:e[parseInt(s.toString(),10)].data,cell:a,column:n.column}))})},Gt.prototype.columnTemplateResult=function(e){this.templateResult=e.template},Gt.prototype.reactTemplateRender=function(e,t){var i="portals";this.parent[i]=e,this.parent.notify("renderReactTemplate",this.parent[i]),this.parent.renderReactTemplates(t)},Gt.prototype.destroy=function(){this.parent.grid.off("template-result",this.columnTemplateResult),this.parent.grid.off("reactTemplateRender",this.reactTemplateRender)};var Ht=Gt;function Gt(e){this.parent=e,this.templateResult=null,this.parent.grid.on("template-result",this.columnTemplateResult,this),this.parent.grid.on("reactTemplateRender",this.reactTemplateRender,this)}o.prototype.addEventListener=function(){this.parent.on("updateRemoteLevel",this.updateParentRemoteData,this),this.parent.grid.on("sorting-begin",this.beginSorting,this),this.parent.on("updateAction",this.updateData,this),this.parent.on(Ve,this.collectExpandingRecs,this),this.parent.on("dataProcessor",this.dataProcessor,this)},o.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ve,this.collectExpandingRecs),this.parent.off("updateRemoteLevel",this.updateParentRemoteData),this.parent.off("updateAction",this.updateData),this.parent.off("dataProcessor",this.dataProcessor),this.parent.grid.off("sorting-begin",this.beginSorting))},o.prototype.destroy=function(){this.removeEventListener()},o.prototype.isRemote=function(){return this.parent.dataSource instanceof b.DataManager},o.prototype.convertToFlatData=function(e){var t,i,r=this;this.parent.flatData=C.isNullOrUndefined(e)||0!==Object.keys(e).length||this.parent.dataSource instanceof b.DataManager?[]:this.parent.dataSource,this.parent.parentData=[],S(this.parent)&&!v(this.parent)&&e instanceof b.DataManager&&!(e instanceof Array)?(t=this.parent.dataSource,this.parent.parentIdMapping&&(this.parent.query=C.isNullOrUndefined(this.parent.query)?new b.Query:this.parent.query,this.parent.parentIdMapping&&(i=this.parent.query.params.filter(function(e){return"IdMapping"===e.key}),this.parent.initialRender)&&!i.length&&(this.parent.query.where(this.parent.parentIdMapping,"equal",null),this.parent.query.addParams("IdMapping",this.parent.idMapping)),this.parent.hasChildMapping||((i=this.parent.query.clone()).queries=[],(i=i.select([this.parent.parentIdMapping])).isCountRequired=!0,t.executeQuery(i).then(function(e){r.parentItems=b.DataUtil.distinct(e.result,r.parent.parentIdMapping,!1),0===(e.result?0:1)&&(C.setValue("grid.contentModule.isLoaded",!0,r.parent),C.isNullOrUndefined(r.zerothLevelData)||(C.setValue("cancel",!1,r.zerothLevelData),C.getValue("grid.renderModule",r.parent).dataManagerSuccess(r.zerothLevelData),r.zerothLevelData=null),r.parent.grid.hideSpinner())})))):e instanceof Array&&this.convertJSONData(e)},o.prototype.convertJSONData=function(e){if(this.hierarchyData=[],this.taskIds=[],this.parent.idMapping)for(var t=Object.keys(e),i=0;i<t.length;i++){var r=e[parseInt(i.toString(),10)];this.hierarchyData.push(C.extend({},r)),C.isNullOrUndefined(r[this.parent.idMapping])||this.taskIds.push(r[this.parent.idMapping])}else this.hierarchyData=e;if(this.isSelfReference){for(var n=[],o=new b.DataManager(this.hierarchyData).executeLocal((new b.Query).group(this.parent.parentIdMapping)),i=0;i<o.length;i++){var a,s=o[parseInt(i.toString(),10)],d=this.taskIds.indexOf(s.key);!C.isNullOrUndefined(s.key)&&-1<d?(a=s.items,this.hierarchyData[parseInt(d.toString(),10)][this.parent.childMapping]=a):n.push.apply(n,s.items)}this.hierarchyData=this.selfReferenceUpdate(n)}var l;Object.keys(this.hierarchyData).length?this.createRecords(this.hierarchyData):(l=!(this.parent.dataSource instanceof b.DataManager)&&this.parent.isGantt,this.parent.flatData=l?this.parent.dataSource:[]),this.storedIndex=-1},o.prototype.selfReferenceUpdate=function(e){for(var t=[];0<this.hierarchyData.length&&0<e.length;){var i=e.indexOf(this.hierarchyData[0]);-1===i?this.hierarchyData.shift():(t.push(this.hierarchyData.shift()),e.splice(i,1))}return t},o.prototype.updateParentRemoteData=function(e){var t="actionArgs",n=(S(this.parent)&&this.parent.enableVirtualization&&"virtualscroll"===e[t].requestType&&this.parent.hideSpinner(),e.result);if(S(this.parent)&&this.parent.enableVirtualization&&("virtualscroll"===e[t].requestType||"clearFilter"===e[t].action||""===e[t].searchString)&&(this.parent.query.expands=[]),this.parent.hasChildMapping||this.parentItems.length||this.parent.loadChildOnDemand)if(this.parent.loadChildOnDemand)C.isNullOrUndefined(n)||this.parent.loadChildOnDemand&&w(this.parent)&&!C.isNullOrUndefined(this.parent.dataResults.expandRecord)||S(this.parent)&&this.parent.loadChildOnDemand&&e[t].isExpandCollapse&&this.parent.enableVirtualization||this.convertToFlatData(n);else for(var o=this,i=0;i<n.length;i++)!function(t){var i,r;w(o.parent)&&n[parseInt(t.toString(),10)].hasChildRecords&&o.parent.initialRender&&(n[parseInt(t.toString(),10)].expanded=!1),S(o.parent)&&o.parent.enableVirtualization&&(i=[],r=o.parent,n.filter(function(e){e[""+r.parentIdMapping]===n[parseInt(t.toString(),10)][""+r.idMapping]&&i.push(e)}),i.length?n[parseInt(t.toString(),10)].expanded=!0:n[parseInt(t.toString(),10)].hasChildRecords&&(n[parseInt(t.toString(),10)].expanded=!1)),C.isNullOrUndefined(n[parseInt(t.toString(),10)].index)&&(n[parseInt(t.toString(),10)].taskData=C.extend({},n[parseInt(t.toString(),10)]),n[parseInt(t.toString(),10)].uniqueID=I.getUid(o.parent.element.id+"_data_"),C.setValue("uniqueIDCollection."+n[parseInt(t.toString(),10)].uniqueID,n[parseInt(t.toString(),10)],o.parent),n[parseInt(t.toString(),10)].level=0,S(o.parent)&&o.parent.enableVirtualization&&n[parseInt(t.toString(),10)][""+o.parent.parentIdMapping]&&0===n[parseInt(t.toString(),10)].level&&(n[parseInt(t.toString(),10)].level=n[parseInt(t.toString(),10)].level+1),n[parseInt(t.toString(),10)].index=Math.ceil(1e3*Math.random()),!n[parseInt(t.toString(),10)][o.parent.hasChildMapping]&&-1===o.parentItems.indexOf(n[parseInt(t.toString(),10)][o.parent.idMapping])||(n[parseInt(t.toString(),10)].hasChildRecords=!0),n[parseInt(t.toString(),10)].checkboxState="uncheck")}(i);else this.zerothLevelData=e,C.setValue("cancel",!0,e);S(this.parent)&&this.parent.loadChildOnDemand&&e[t].isExpandCollapse&&this.parent.enableVirtualization||S(this.parent)&&this.parent.enableVirtualization&&!this.parent.loadChildOnDemand?e.result=n:e.result=this.parent.loadChildOnDemand?this.parent.flatData:n,S(this.parent)&&this.parent.enableVirtualization&&this.parent.loadChildOnDemand&&this.parent.grid.aggregates.length&&0===this.parent.grid.sortSettings.columns.length&&0===this.parent.grid.filterSettings.columns.length&&!this.parent.grid.searchSettings.key.length&&(t=e.query.queries.filter(function(e){return"onAggregates"===e.fn}),e.result=this.parent.summaryModule.calculateSummaryValue(t,this.parent.flatData,!0)),this.parent.notify("updateResults",e)},o.prototype.collectExpandingRecs=function(e,t){var i,r=this.parent.getRows();if(this.parent.rowTemplate&&(i=this.parent.getContentTable().rows,r=[].slice.call(i)),0<e.rows.length){t||(e.record.expanded=!0);for(var n=0;n<e.rows.length;n++){e.rows[parseInt(n.toString(),10)].style.display="table-row",this.parent.loadChildOnDemand&&(a=e.rows[parseInt(n.toString(),10)].getElementsByClassName("e-treegridcollapse")[0],o=this.parent.rowTemplate?this.parent.grid.getCurrentViewRecords()[e.rows[parseInt(n.toString(),10)].rowIndex]:this.parent.grid.getRowObjectFromUID(e.rows[parseInt(n.toString(),10)].getAttribute("data-Uid")).data,!C.isNullOrUndefined(a)&&o.expanded&&(C.addClass([a],"e-treegridexpand"),C.removeClass([a],"e-treegridcollapse")),a=[],(a=r.filter(function(e){return e.querySelector(".e-gridrowindex"+o.index+"level"+(o.level+1))})).length)&&o.expanded&&this.collectExpandingRecs({record:o,rows:a,parentRow:e.parentRow},!0);var o,a=e.rows[parseInt(n.toString(),10)].querySelector(".e-detailrowcollapse");C.isNullOrUndefined(a)||this.parent.grid.detailRowModule.expand(a)}}else this.fetchRemoteChildData({action:e.name,record:e.record,rows:e.rows,parentRow:e.parentRow})},o.prototype.fetchRemoteChildData=function(f){var e,m=this,y={row:f.parentRow,data:f.record},t=this.parent.dataSource,i=this.parent.grid.getDataModule().generateQuery(),r=i.queries.filter(function(e){return"onPage"!==e.fn&&"onWhere"!==e.fn}),r=(i.queries=r,i.isCountRequired=!0,parseInt(f.record[this.parent.idMapping],10));isNaN(r)&&(r=f.record[this.parent.idMapping].toString()),this.parent.enableVirtualization&&"remoteExpand"===f.action?(i.take(this.parent.pageSettings.pageSize),(e=[]).push("ExpandingAction",r.toString()),i.expand(e)):this.parent.enableVirtualization&&"collapse"===f.action&&(i.take(this.parent.grid.pageSettings.pageSize),(e=[]).push("CollapsingAction",r.toString()),i.expand(e)),i.where(this.parent.parentIdMapping,"equal",f.record[this.parent.idMapping]),"remoteExpand"===f.action&&this.parent.grid.filterModule&&this.parent.grid.filterModule.value&&(r=this.parent.grid.getDataModule().generateQuery().queries.filter(function(e){return"onPage"!==e.fn&&void 0!==e.e.predicates}),i.queries.push(r[0])),V.showSpinner(this.parent.element),t.executeQuery(i).then(function(e){var t,i="remoteExpandedData",r="remoteCollapsedData",n=m.parent.grid.currentViewData.slice(),o=m.parent.idMapping;if(m.parent.isGantt&&!m.parent.loadChildOnDemand&&m.parent.hasChildMapping){for(var a=0;a<m.parent.grid.currentViewData.length;a++)if(f.record[o]===m.parent.grid.currentViewData[a][o]){t=a;break}}else t=n.indexOf(f.record);if(m.parent.enableVirtualization&&("collapse"===f.action||"remoteExpand"===f.action))for(n=[],a=0;a<t;a++)n.push(m.parent.grid.currentViewData[parseInt(a.toString(),10)]);-1===t&&m.parent.grid.getRowsObject().forEach(function(e){e.data.uniqueID===f.record.uniqueID&&(t=e.index)});var s=I.getObject("actual.nextLevel",e),d=e.result,l=[];if("remoteExpand"===f.action&&m.parent.grid.filterModule&&m.parent.grid.filterModule.value){for(a=0;a<n.length;a++)Object.prototype.hasOwnProperty.call(n[parseInt(a.toString(),10)],m.parent.parentIdMapping)&&null!==n[parseInt(a.toString(),10)][""+m.parent.parentIdMapping]&&0===n[parseInt(a.toString(),10)].level&&(n.splice(a,1),a--);for(a=0;a<d.length;a++)f.record[""+m.parent.idMapping]!==d[parseInt(a.toString(),10)][""+m.parent.idMapping]&&f.record[""+m.parent.idMapping]===d[parseInt(a.toString(),10)][""+m.parent.parentIdMapping]&&Object.prototype.hasOwnProperty.call(d,a)&&l.push(d[parseInt(a.toString(),10)]);d=l}if(m.parent.enableVirtualization&&"remoteExpand"===f.action){f.record.childRecords=[];for(a=0;a<d.length;a++)f.record[""+m.parent.idMapping]!==d[parseInt(a.toString(),10)][""+m.parent.idMapping]&&f.record[""+m.parent.idMapping]===d[parseInt(a.toString(),10)][""+m.parent.parentIdMapping]&&Object.prototype.hasOwnProperty.call(d,a)&&f.record.childRecords.push(d[parseInt(a.toString(),10)])}else f.record.childRecords=d;for(var p=0;p<d.length;p++){if(m.parent.enableVirtualization&&d[parseInt(p.toString(),10)][""+m.parent.idMapping]===f.record[""+m.parent.idMapping]&&"remoteExpand"===f.action)m.parent[i].push(f.record);else if(m.parent.enableVirtualization&&d[parseInt(p.toString(),10)][""+m.parent.idMapping]===f.record[""+m.parent.idMapping]&&"collapse"===f.action)for(a=0;a<m.parent[i].length;a++)f.record[""+m.parent.idMapping]===m.parent[i][parseInt(a.toString(),10)][""+m.parent.idMapping]&&m.parent[i].splice(a,1);if(d[parseInt(p.toString(),10)].taskData=C.extend({},d[parseInt(p.toString(),10)]),d[parseInt(p.toString(),10)][""+m.parent.parentIdMapping]&&m.parent.enableVirtualization&&m.parent[i].length)for(var h,a=0;a<m.parent[i].length;a++)d[parseInt(p.toString(),10)][""+m.parent.parentIdMapping]===m.parent[i][parseInt(a.toString(),10)][""+m.parent.idMapping]&&(d[parseInt(p.toString(),10)].level=m.parent[i][parseInt(a.toString(),10)].level+1,delete(h=m.parent[i][parseInt(a.toString(),10)]).childRecords,d[parseInt(p.toString(),10)].parentItem=h,d[parseInt(p.toString(),10)].parentUniqueID=f.record.uniqueID);else m.parent.enableVirtualization?!d[parseInt(p.toString(),10)][""+m.parent.hasChildMapping]&&-1===m.parentItems.indexOf(d[parseInt(p.toString(),10)][""+m.parent.idMapping])||s&&!s[parseInt(p.toString(),10)]?(delete(h=C.extend({},f.record)).childRecords,d[parseInt(p.toString(),10)].parentItem=h,d[parseInt(p.toString(),10)].parentUniqueID=f.record.uniqueID):C.isNullOrUndefined(d[parseInt(p.toString(),10)][""+m.parent.parentIdMapping])?(d[parseInt(p.toString(),10)].level=0,"remoteExpand"===f.action&&(d[parseInt(p.toString(),10)].childRecords=[],d[parseInt(p.toString(),10)].childRecords=f.record.childRecords)):d[parseInt(p.toString(),10)].level=f.record.level:(d[parseInt(p.toString(),10)].level=f.record.level+1,delete(h=C.extend({},f.record)).childRecords,d[parseInt(p.toString(),10)].parentItem=h,d[parseInt(p.toString(),10)].parentUniqueID=f.record.uniqueID);if(d[parseInt(p.toString(),10)].index=Math.ceil(1e3*Math.random()),d[parseInt(p.toString(),10)].uniqueID=I.getUid(m.parent.element.id+"_data_"),d[parseInt(p.toString(),10)].checkboxState="uncheck",m.parent.enableVirtualization&&C.isNullOrUndefined(d[parseInt(p.toString(),10)].level))for(var c=0;c<m.parent.grid.currentViewData.length;c++)m.parent.grid.currentViewData[parseInt(c.toString(),10)][""+m.parent.idMapping]===d[parseInt(p.toString(),10)][""+m.parent.parentIdMapping]&&(d[parseInt(p.toString(),10)].level=m.parent.grid.currentViewData[parseInt(c.toString(),10)].level+1);if(C.setValue("uniqueIDCollection."+d[parseInt(p.toString(),10)].uniqueID,d[parseInt(p.toString(),10)],m.parent),(d[parseInt(p.toString(),10)][""+m.parent.hasChildMapping]||-1!==m.parentItems.indexOf(d[parseInt(p.toString(),10)][""+m.parent.idMapping]))&&(!s||s[parseInt(p.toString(),10)]))if(d[parseInt(p.toString(),10)].hasChildRecords=!0,m.parent.enableVirtualization&&m.parent.loadChildOnDemand){for(a=0;a<m.parent[r].length;a++)d[parseInt(p.toString(),10)][""+m.parent.idMapping]===m.parent[r][parseInt(a.toString(),10)][""+m.parent.idMapping]&&(d[parseInt(p.toString(),10)].expanded=m.parent[r][parseInt(a.toString(),10)].expanded);if("collapse"===f.action&&d[parseInt(p.toString(),10)][""+m.parent.idMapping]!==f.record[""+m.parent.idMapping]&&!1!==d[parseInt(p.toString(),10)].expanded)d[parseInt(p.toString(),10)].expanded=!0;else if("collapse"===f.action&&d[parseInt(p.toString(),10)][""+m.parent.idMapping]===f.record[""+m.parent.idMapping])d[parseInt(p.toString(),10)].expanded=!1,m.parent[r].push(f.record);else if("remoteExpand"===f.action){for(a=0;a<m.parent.grid.currentViewData.length;a++)m.parent.grid.currentViewData[parseInt(a.toString(),10)][""+m.parent.idMapping]===d[parseInt(p.toString(),10)][""+m.parent.idMapping]&&d.splice(p,1,m.parent.grid.currentViewData[parseInt(a.toString(),10)]);if(d[parseInt(p.toString(),10)][m.parent.idMapping]===f.record[""+m.parent.idMapping])for(a=0;a<m.parent[r].length;a++)f.record[""+m.parent.idMapping]===m.parent[r][parseInt(a.toString(),10)][""+m.parent.idMapping]&&m.parent[r].splice(a,1);!1!==d[parseInt(p.toString(),10)].expanded&&(d[parseInt(p.toString(),10)].expanded=!0)}}else m.parent.enableVirtualization&&d[parseInt(p.toString(),10)][""+m.parent.idMapping]===f.record[""+m.parent.idMapping]&&"collapse"!==f.action?d[parseInt(p.toString(),10)].expanded=!0:m.parent.enableVirtualization&&m.parent.loadChildOnDemand||(d[parseInt(p.toString(),10)].expanded=!1);n.splice(t+p+1,0,d[parseInt(p.toString(),10)])}C.setValue("result",n,e),C.setValue("action","beforecontentrender",e),m.parent.trigger(Ce,e),V.hideSpinner(m.parent.element),0<m.parent.grid.aggregates.length&&!m.parent.enableVirtualization&&(u=I.getObject("query",e),C.isNullOrUndefined(u)&&(u=C.getValue("grid.renderModule.data",m.parent).aggregateQuery(new b.Query)),C.isNullOrUndefined(u)||(u=u.queries.filter(function(e){return"onAggregates"===e.fn}),e.result=m.parent.summaryModule.calculateSummaryValue(u,e.result,!0))),"remoteExpand"===f.action&&m.parent.allowPaging&&"All"===m.parent.pageSettings.pageSizeMode&&(m.parent.grid.pageSettings.totalRecordsCount=m.parent.grid.currentViewData.length+d.length),m.parent.enableVirtualization&&(m.parent.grid.pageSettings.totalRecordsCount=e.count),e.count=m.parent.grid.pageSettings.totalRecordsCount;var u={},g=(m.parent.enableVirtualization&&m.remoteVirtualAction(u),{index:t,childData:d});m.parent.enableInfiniteScrolling?m.parent.notify("infinite-remote-expand",g):C.getValue("grid.renderModule",m.parent).dataManagerSuccess(e,u),m.parent.trigger(Ue,y)})},o.prototype.remoteVirtualAction=function(e){e.requestType="refresh",C.setValue("isExpandCollapse",!0,e);var e=C.getValue("grid.contentModule",this.parent),t=C.getValue("currentInfo",e),e=C.getValue("prevInfo",e);t.loadNext&&this.parent.grid.pageSettings.currentPage===t.nextInfo.page&&(this.parent.grid.pageSettings.currentPage=e.page)},o.prototype.beginSorting=function(){var e;this.isSortAction=!0,S(this.parent)&&this.parent.enableVirtualization&&(-1!==(e=this.parent.query.queries.indexOf(this.parent.query.queries.filter(function(e){return"onSortBy"===e.fn})[0]))&&this.parent.query.queries.splice(e,1),0===this.parent.grid.sortSettings.columns.length)&&this.parent.query.sortBy(null,null)},o.prototype.createRecords=function(e,t){for(var i=[],r=0,n=Object.keys(e).length;r<n;r++){var o,a=C.extend({},e[parseInt(r.toString(),10)]),s=(a.taskData=e[parseInt(r.toString(),10)],0),d=(this.storedIndex++,Object.prototype.hasOwnProperty.call(a,"index")||(a.index=this.storedIndex),(!C.isNullOrUndefined(a[this.parent.childMapping])&&!w(this.parent)||a[this.parent.hasChildMapping]&&w(this.parent))&&(C.isNullOrUndefined(a[this.parent.childMapping])||0<a[this.parent.childMapping].length?a.hasChildRecords=!0:a.hasChildRecords=!1,this.parent.enableCollapseAll||!C.isNullOrUndefined(this.parent.dataStateChange)&&C.isNullOrUndefined(a[this.parent.childMapping])?a.expanded=!1:a.expanded=!!C.isNullOrUndefined(a[this.parent.expandStateMapping])||a[this.parent.expandStateMapping]),Object.prototype.hasOwnProperty.call(a,"index")||(a.index=(a.hasChildRecords,this.storedIndex)),this.isSelfReference&&C.isNullOrUndefined(a[this.parent.parentIdMapping])&&this.parent.parentData.push(a),a.uniqueID=I.getUid(this.parent.element.id+"_data_"),C.setValue("uniqueIDCollection."+a.uniqueID,a,this.parent),C.isNullOrUndefined(t)||(delete(o=C.extend({},t)).childRecords,delete o[this.parent.childMapping],this.isSelfReference&&delete o.taskData[this.parent.childMapping],a.parentItem=o,a.parentUniqueID=o.uniqueID,s=t.level+1),Object.prototype.hasOwnProperty.call(a,"level")||(a.level=s),a.checkboxState="uncheck","remoteCollapsedData");if(this.parent.enableVirtualization&&this.parent.loadChildOnDemand&&S(this.parent)&&!this.parent.initialRender){if(!a.hasChildRecords&&C.isNullOrUndefined(a[""+this.parent.parentIdMapping])){a.hasChildRecords=!0;for(var l=0;l<this.parent[d].length;l++)this.parent[d][parseInt(l.toString(),10)][""+this.parent.idMapping]===a[""+this.parent.idMapping]&&(a.expanded=!1)}else 0===a.level&&C.isNullOrUndefined(t)&&!a.hasChildRecords&&(a.level=a.level+1);a[""+this.parent.hasChildMapping]&&!C.isNullOrUndefined(a[""+this.parent.expandStateMapping])&&(a.expanded=a[""+this.parent.expandStateMapping],a.hasChildRecords=!0),this.parent.flatData.push(a)}else(C.isNullOrUndefined(a[""+this.parent.parentIdMapping])||a.parentItem)&&(this.parent.flatData.push(a),this.parent.infiniteScrollData.push(a));this.isSelfReference||0!==a.level||this.parent.parentData.push(a),C.isNullOrUndefined(a[this.parent.childMapping]&&a[this.parent.childMapping].length)||(o=this.createRecords(a[this.parent.childMapping],a),a.childRecords=o),i.push(a)}return i},o.prototype.dataProcessor=function(e){var t=I.getObject("isExport",e),i=I.getObject("expresults",e),r=I.getObject("exportType",e),n=I.getObject("isPrinting",e),o=I.getObject("actionArgs",e),a=I.getObject("requestType",e),s=I.getObject("data",e),d=I.getObject("action",e),l=o,p=this.parent.getPrimaryKeyFieldNames()[0],h=I.getObject("data",l),l=(C.isNullOrUndefined(l)||C.isNullOrUndefined(l.action)||"add"!==l.action||C.isNullOrUndefined(l.data)||!C.isNullOrUndefined(l.data[""+p])||(l.data[""+p]=e.result[l.index][""+p],h.taskData[""+p]=e.result[l.index][""+p]),(!C.isNullOrUndefined(o)&&Object.keys(o).length||"save"===a)&&(a=a||o.requestType,s=s||I.getObject("data",o),d=d||I.getObject("action",o),"Batch"===this.parent.editSettings.mode&&(this.batchChanges=this.parent.grid.editModule.getBatchChanges()),this.parent.isLocalData)&&this.updateAction(s,d,a),(h=t&&!C.isNullOrUndefined(i)?i:w(this.parent)?C.getValue("result",this.parent.grid.dataSource):this.parent.grid.dataSource)instanceof b.DataManager?h.dataSource.json:h),p=(w(this.parent)?C.getValue("count",this.parent.dataSource):l.length,new b.Query),o=I.getObject("query",e);if(C.isNullOrUndefined(o)||(S=o.queries.filter(function(e){return"onWhere"===e.fn}),m=o.queries.filter(function(e){return"onSearch"===e.fn})),(this.parent.grid.allowFiltering&&this.parent.grid.filterSettings.columns.length||0<this.parent.grid.searchSettings.key.length||!C.isNullOrUndefined(o)&&(S.length||m.length)&&this.parent.isLocalData)&&(C.isNullOrUndefined(o)&&(o=new b.Query,o=C.getValue("grid.renderModule.data",this.parent).filterQuery(o),o=C.getValue("grid.renderModule.data",this.parent).searchQuery(o)),s=o.queries.filter(function(e){return"onWhere"===e.fn}),d=o.queries.filter(function(e){return"onSearch"===e.fn}),p.queries=s.concat(d),a=new b.DataManager(l).executeLocal(p),this.parent.notify("updateFilterRecs",{data:a}),l=this.dataResults.result,this.dataResults.result=null,0<this.parent.grid.aggregates.length)&&(c=I.getObject("query",e),C.isNullOrUndefined(o)&&(o=C.getValue("grid.renderModule.data",this.parent).aggregateQuery(new b.Query)),C.isNullOrUndefined(c)||(y=c.queries.filter(function(e){return"onAggregates"===e.fn}),l=this.parent.summaryModule.calculateSummaryValue(y,l,!0))),this.parent.grid.aggregates.length&&0===this.parent.grid.sortSettings.columns.length&&0===this.parent.grid.filterSettings.columns.length&&!this.parent.grid.searchSettings.key.length&&(i=I.getObject("query",e),y=(i=C.isNullOrUndefined(i)?C.getValue("grid.renderModule.data",this.parent).aggregateQuery(new b.Query):i).queries.filter(function(e){return"onAggregates"===e.fn}),l=this.parent.summaryModule.calculateSummaryValue(y,this.parent.flatData,!0)),0<this.parent.grid.sortSettings.columns.length||this.isSortAction){this.isSortAction=!1;for(var h=this.parent.parentData,c=I.getObject("query",e),u=new b.Query,g=this.parent.grid.sortSettings.columns.length-1;0<=g;g--){var f=this.parent.grid.renderModule.data.getColumnByField(this.parent.grid.sortSettings.columns[parseInt(g.toString(),10)].field),f=f.sortComparer&&v(this.parent)?f.sortComparer.bind(f):this.parent.grid.sortSettings.columns[parseInt(g.toString(),10)].direction;u.sortBy(this.parent.grid.sortSettings.columns[parseInt(g.toString(),10)].field,f)}var m,y,S=new b.DataManager(h).executeLocal(u),d=(this.parent.allowRowDragAndDrop&&!C.isNullOrUndefined(this.parent.rowDragAndDropModule.draggedRecord)&&this.parent.rowDragAndDropModule.droppedRecord.hasChildRecords&&"middleSegment"!==this.parent.rowDragAndDropModule.dropPosition&&(m=S.indexOf(this.parent.rowDragAndDropModule.draggedRecord),S.splice(m,1),s=S.indexOf(this.parent.rowDragAndDropModule.droppedRecord),this.parent.rowDragAndDropModule.droppedRecord.hasChildRecords&&"topSegment"===this.parent.rowDragAndDropModule.dropPosition?S.splice(s,0,this.parent.rowDragAndDropModule.draggedRecord):"bottomSegment"===this.parent.rowDragAndDropModule.dropPosition&&S.splice(s+1,0,this.parent.rowDragAndDropModule.draggedRecord)),{modifiedData:S,filteredData:l,srtQry:u});this.parent.notify("createSort",d),l=d.modifiedData,this.dataResults.result=null,this.sortedData=l,this.parent.notify("updateModel",{}),0<this.parent.grid.aggregates.length&&!C.isNullOrUndefined(c)&&(y=I.getObject("query",e).queries.filter(function(e){return"onAggregates"===e.fn}),l=this.parent.summaryModule.calculateSummaryValue(y,this.sortedData,!1))}p=w(this.parent)?C.getValue("count",this.parent.dataSource):l.length,a=this.paging(l,p,t,n,r,e);l=a.result,p=a.count,e.result=l,e.count=p,this.parent.notify("updateResults",e)},o.prototype.paging=function(e,t,i,r,n,o){!this.parent.allowPaging||i&&"CurrentPage"!==n||r&&"CurrentPage"!==this.parent.printMode?!this.parent.enableVirtualization&&!this.parent.enableInfiniteScrolling||i&&"CurrentPage"!==n||"save"===C.getValue("requestType",o)||(i=this.parent.enableInfiniteScrolling?o:C.getValue("actionArgs",o),this.parent.notify(ze,{result:e,count:t,actionArgs:i}),e=this.dataResults.result,t=this.dataResults.count):(this.parent.notify(ze,{result:e,count:t,actionArgs:o}),e=this.dataResults.result,t=w(this.parent)?C.getValue("count",this.parent.dataSource):this.dataResults.count);n="isCollapsedStatePersist";if((!0===r||o.isPdfExport&&(C.isNullOrUndefined(o[n])||o[n]))&&"AllPages"===this.parent.printMode){for(var a=[],s=0;s<e.length;s++)y(this.parent,e[parseInt(s.toString(),10)],this.parent.parentData)&&a.push(e[parseInt(s.toString(),10)]);t=(e=a).length}return{result:e,count:t}},o.prototype.updateData=function(e){this.dataResults=e},o.prototype.updateAction=function(e,t,i){"delete"!==i&&"save"!==i||this.parent.notify(Ge,{value:e,action:t||i}),"batchsave"===i&&"Batch"===this.parent.editSettings.mode&&this.parent.notify(nt,{})};var Qt=o;function o(e){this.addedRecords="addedRecords",this.parent=e,this.parentItems=[],this.taskIds=[],this.hierarchyData=[],this.storedIndex=-1,this.sortedData=[],this.isSortAction=!1,this.addEventListener(),this.dataResults={},this.isSelfReference=!C.isNullOrUndefined(this.parent.parentIdMapping)}(n=r.ToolbarItem||(r.ToolbarItem={}))[n.Add=0]="Add",n[n.Edit=1]="Edit",n[n.Update=2]="Update",n[n.Delete=3]="Delete",n[n.Cancel=4]="Cancel",n[n.Search=5]="Search",n[n.ExpandAll=6]="ExpandAll",n[n.CollapseAll=7]="CollapseAll",n[n.ExcelExport=8]="ExcelExport",n[n.PdfExport=9]="PdfExport",n[n.CsvExport=10]="CsvExport",n[n.Print=11]="Print",n[n.RowIndent=12]="RowIndent",n[n.RowOutdent=13]="RowOutdent",(n=r.ContextMenuItems||(r.ContextMenuItems={}))[n.AutoFit=0]="AutoFit",n[n.AutoFitAll=1]="AutoFitAll",n[n.SortAscending=2]="SortAscending",n[n.SortDescending=3]="SortDescending",n[n.Edit=4]="Edit",n[n.Delete=5]="Delete",n[n.Save=6]="Save",n[n.Cancel=7]="Cancel",n[n.PdfExport=8]="PdfExport",n[n.ExcelExport=9]="ExcelExport",n[n.CsvExport=10]="CsvExport",n[n.FirstPage=11]="FirstPage",n[n.PrevPage=12]="PrevPage",n[n.LastPage=13]="LastPage",n[n.NextPage=14]="NextPage",n[n.AddRow=15]="AddRow",n[n.RowIndent=16]="RowIndent",n[n.RowOutdent=17]="RowOutdent";Kt=function(e,t){return(Kt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Kt,Wt,n=function(e,t){function i(){this.constructor=e}Kt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},a=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},n=(Wt=C.ChildProperty,n(Yt,Wt),a([C.Property(12)],Yt.prototype,"pageSize",void 0),a([C.Property(8)],Yt.prototype,"pageCount",void 0),a([C.Property(1)],Yt.prototype,"currentPage",void 0),a([C.Property()],Yt.prototype,"totalRecordsCount",void 0),a([C.Property(!1)],Yt.prototype,"enableQueryString",void 0),a([C.Property(!1)],Yt.prototype,"pageSizes",void 0),a([C.Property(null)],Yt.prototype,"template",void 0),a([C.Property("All")],Yt.prototype,"pageSizeMode",void 0),Yt);function Yt(){return null!==Wt&&Wt.apply(this,arguments)||this}Jt=function(e,t){return(Jt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Jt,Xt,a=function(e,t){function i(){this.constructor=e}Jt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},s=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},$t=(Xt=C.ChildProperty,a(l,Xt),l.prototype.setFormatter=function(e){this.format&&(this.format.skeleton||this.format.format)&&(this.formatFn=this.getFormatFunction(this.format))},l.prototype.getFormatFunction=function(e){return e.type?this.intl.getDateFormat(e):this.intl.getNumberFormat(e)},l.prototype.getFormatter=function(){return this.formatFn},l.prototype.setTemplate=function(e){void 0===e&&(e={}),void 0!==this.footerTemplate&&(this.templateFn[C.getEnumValue(I.CellType,I.CellType.Summary)]={fn:C.compile(this.footerTemplate,e),property:"footerTemplate"})},l.prototype.getTemplate=function(e){return this.templateFn[C.getEnumValue(I.CellType,e)]},l.prototype.setPropertiesSilent=function(e){this.setProperties(e,!0)},s([C.Property()],l.prototype,"type",void 0),s([C.Property()],l.prototype,"footerTemplate",void 0),s([C.Property()],l.prototype,"field",void 0),s([C.Property()],l.prototype,"format",void 0),s([C.Property()],l.prototype,"columnName",void 0),s([C.Property()],l.prototype,"customAggregate",void 0),l);function l(){var e=null!==Xt&&Xt.apply(this,arguments)||this;return e.intl=new C.Internationalization,e.templateFn={},e}Zt=C.ChildProperty,a(ei,Zt),s([C.Collection([],$t)],ei.prototype,"columns",void 0),s([C.Property(!0)],ei.prototype,"showChildSummary",void 0);var Zt,a=ei;function ei(){return null!==Zt&&Zt.apply(this,arguments)||this}ti=function(e,t){return(ti=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var ti,ii,s=function(e,t){function i(){this.constructor=e}ti(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},p=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},s=(ii=C.ChildProperty,s(h,ii),p([C.Property(!1)],h.prototype,"allowAdding",void 0),p([C.Property(!1)],h.prototype,"allowEditing",void 0),p([C.Property(!1)],h.prototype,"allowDeleting",void 0),p([C.Property("Cell")],h.prototype,"mode",void 0),p([C.Property("Top")],h.prototype,"newRowPosition",void 0),p([C.Property(!0)],h.prototype,"allowEditOnDblClick",void 0),p([C.Property(!0)],h.prototype,"showConfirmDialog",void 0),p([C.Property(!1)],h.prototype,"showDeleteConfirmDialog",void 0),p([C.Property("")],h.prototype,"template",void 0),p([C.Property({})],h.prototype,"dialog",void 0),p([C.Property(!1)],h.prototype,"allowNextRowEdit",void 0),h);function h(){return null!==ii&&ii.apply(this,arguments)||this}ri=function(e,t){return(ri=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var ri,ni,p=function(e,t){function i(){this.constructor=e}ri(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},oi=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},ai=(ni=C.ChildProperty,p(si,ni),oi([C.Property()],si.prototype,"field",void 0),oi([C.Property()],si.prototype,"direction",void 0),si);function si(){return null!==ni&&ni.apply(this,arguments)||this}di=C.ChildProperty,p(li,di),oi([C.Collection([],ai)],li.prototype,"columns",void 0),oi([C.Property(!0)],li.prototype,"allowUnsort",void 0);var di,p=li;function li(){return null!==di&&di.apply(this,arguments)||this}function pi(e,o,a,s,t,d,i){var l,p,r=e.value,h=e.action,c=o.grid.getPrimaryKeyFieldNames()[0],u=o.dataSource instanceof b.DataManager?o.dataSource.dataSource.json:o.dataSource,g=[],f=r,n=!1;if("Batch"===o.editSettings.mode&&(p=o.grid.editModule.getBatchChanges()),("add"===h||"batchsave"===h&&"Batch"===o.editSettings.mode&&p.addedRecords.length)&&(r=(e=function(e,t,i,r,n,o){var a,s=!1,d=i.grid.getCurrentViewRecords();switch(a=At(a=C.extend({},e.value)),i.editSettings.newRowPosition){case"Top":t.unshift(a),s=!0;break;case"Bottom":t.push(a),s=!0;break;case"Above":a=C.isNullOrUndefined(o)?At(a=C.extend({},d[r+1])):At(a=C.extend({},o));break;case"Below":case"Child":var l,p;C.isNullOrUndefined(o)?(l=i.grid.getPrimaryKeyFieldNames()[0],p=d[parseInt(r.toString(),10)],a=At(a=!C.isNullOrUndefined(p)&&p[""+l]===e.value[""+l]||-1!==n?C.extend({},p):C.extend({},e.value)),i.editModule.internalProperties.taskData=a):a=At(a=C.extend({},o)),-1===n&&(t.unshift(a),s=!0)}return{value:a,isSkip:s}}(e,u,o,s,t,i)).value,n=e.isSkip),r instanceof Array?g=D(r):g.push(C.extend({},r)),!n&&("add"!==h||"Top"!==o.editSettings.newRowPosition&&"Bottom"!==o.editSettings.newRowPosition))for(var m=0;m<g.length;m++){"object"==typeof g[parseInt(m.toString(),10)][""+c]&&(g[parseInt(m.toString(),10)]=g[parseInt(m.toString(),10)][""+c]);for(var y=g[parseInt(m.toString(),10)].taskData?Object.keys(g[parseInt(m.toString(),10)].taskData):Object.keys(g[parseInt(m.toString(),10)]),S=u.length,w=function(){if(u[parseInt(S.toString(),10)][""+c]===g[parseInt(m.toString(),10)][""+c]){if("delete"!==h){var e;if("edit"===h)for(l=0;l<y.length;l++)Object.prototype.hasOwnProperty.call(u[parseInt(S.toString(),10)],y[parseInt(l.toString(),10)])&&("Cell"!==o.editSettings.mode||!C.isNullOrUndefined(p)&&0===p.changedRecords.length||y[parseInt(l.toString(),10)]===d)&&(e=x(o,g[parseInt(m.toString(),10)].uniqueID),u[parseInt(S.toString(),10)][y[parseInt(l.toString(),10)]]=g[parseInt(m.toString(),10)][y[parseInt(l.toString(),10)]],e)&&e.taskData&&(e.taskData[y[parseInt(l.toString(),10)]]=e[y[parseInt(l.toString(),10)]]=u[parseInt(S.toString(),10)][y[parseInt(l.toString(),10)]]);else"add"!==h&&"batchsave"!==h||("Child"===o.editSettings.newRowPosition?a?(f.taskData[""+o.parentIdMapping]=u[parseInt(S.toString(),10)][""+o.idMapping],u.splice(S+1,0,f.taskData)):(Object.prototype.hasOwnProperty.call(u[parseInt(S.toString(),10)],o.childMapping)||(u[parseInt(S.toString(),10)][""+o.childMapping]=[]),u[parseInt(S.toString(),10)][""+o.childMapping].push(f.taskData),M(c,u[parseInt(S.toString(),10)],h,o,a,f)):"Below"===o.editSettings.newRowPosition?(u.splice(S+1,0,f.taskData),C.isNullOrUndefined(f.parentItem)||M(c,u[S+1],h,o,a,f)):s?"Above"===o.editSettings.newRowPosition&&(u.splice(S,0,f.taskData),C.isNullOrUndefined(f.parentItem)||M(c,u[parseInt(S.toString(),10)],h,o,a,f)):u.splice(0,0,f.taskData));return"break"}var t=u[parseInt(S.toString(),10)];if(u.splice(S,1),a){if(!C.isNullOrUndefined(t[""+o.parentIdMapping]))for(var i=o.flatData.filter(function(e){return e[""+o.idMapping]===t[""+o.parentIdMapping]})[0],r=i?i[""+o.childMapping]:[],n=r.length-1;0<=n;n--)if(r[parseInt(n.toString(),10)][""+o.idMapping]===t[""+o.idMapping]){o.enableImmutableMode||i.childRecords.length!==i.Children.length||i.childRecords.splice(n,1),r.splice(n,1),r.length||(i.hasChildRecords=!1,M(c,i,h,o,a));break}return"break"}}else!C.isNullOrUndefined(u[parseInt(S.toString(),10)][""+o.childMapping])&&function e(t,i,r,n,o,a,s,d){var l=!1;var p=t.length;for(;p--&&0<=p;)if(t[parseInt(p.toString(),10)][""+n]===i[""+n]||a&&t[parseInt(p.toString(),10)][o.parentIdMapping]===i[o.idMapping]){if("edit"===r){for(var h,c=Object.keys(i),u=x(o,i.uniqueID),g=0;g<c.length;g++)!Object.prototype.hasOwnProperty.call(t[parseInt(p.toString(),10)],c[parseInt(g.toString(),10)])||"Cell"===o.editSettings.mode&&c[parseInt(g.toString(),10)]!==d||(u[c[parseInt(g.toString(),10)]]=u.taskData[c[parseInt(g.toString(),10)]]=t[parseInt(p.toString(),10)][c[parseInt(g.toString(),10)]]=i[c[parseInt(g.toString(),10)]],"Normal"!==o.grid.editSettings.mode)||"Cell"!==o.editSettings.mode||C.isNullOrUndefined(o.grid.editModule)||(h="editModule",o.grid.editModule[h].editRowIndex=i.index,o.grid.editModule[h].updateCurrentViewData(i));break}"add"===r||"batchsave"===r?"Child"===o.editSettings.newRowPosition?(a?(s[""+o.parentIdMapping]=t[parseInt(p.toString(),10)][o.idMapping],t.splice(p+1,0,s)):(Object.prototype.hasOwnProperty.call(t[parseInt(p.toString(),10)],o.childMapping)||(t[parseInt(p.toString(),10)][o.childMapping]=[]),t[parseInt(p.toString(),10)][o.childMapping].push(s.taskData)),M(n,t[parseInt(p.toString(),10)],r,o,a,s)):"Above"===o.editSettings.newRowPosition?(t.splice(p,0,s.taskData),C.isNullOrUndefined(s.parentItem)||M(n,t[parseInt(p.toString(),10)],r,o,a,s)):"Below"===o.editSettings.newRowPosition&&(t.splice(p+1,0,s.taskData),C.isNullOrUndefined(s.parentItem)||M(n,t[parseInt(p.toString(),10)],r,o,a,s)):(t.splice(p,1),t.length||(l=!0))}else C.isNullOrUndefined(t[parseInt(p.toString(),10)][o.childMapping])||e(t[parseInt(p.toString(),10)][o.childMapping],i,r,n,o,a,s,d)&&M(n,t[parseInt(p.toString(),10)],r,o,a);return l}(u[parseInt(S.toString(),10)][""+o.childMapping],g[parseInt(m.toString(),10)],h,c,o,a,f,d)&&M(c,u[parseInt(S.toString(),10)],h,o,a)};S--&&0<=S;)if("break"===w())break}}function M(i,r,e,t,n,o){if("Above"!==t.editSettings.newRowPosition&&"Below"!==t.editSettings.newRowPosition||"add"!==e&&"batchsave"!==e||C.isNullOrUndefined(o.parentItem)){for(var a,s=t.grid.getCurrentViewRecords(),d=(s.map(function(e,t){e[""+i]===r[""+i]&&(a=t)}),t.enableVirtualization&&C.isNullOrUndefined(a)&&(h=C.getValue("uniqueIDCollection."+o.parentUniqueID,t),r=h),C.isNullOrUndefined(a)||(r=s[parseInt(a.toString(),10)]),t.enableVirtualization&&C.isNullOrUndefined(r)&&!C.isNullOrUndefined(o)&&(r=C.getValue("uniqueIDCollection."+o.parentUniqueID,t)),n||C.isNullOrUndefined(r.childRecords)||!r.childRecords.length?r.hasChildRecords=!1:r.hasChildRecords=!0,"add"!==e&&"batchsave"!==e||(r.expanded=!0,r.hasChildRecords=!0,h=(o=t.sortSettings.columns.length&&C.isNullOrUndefined(o)?s.filter(function(e){return e.parentUniqueID===r.uniqueID?e:null}):o)?o instanceof Array?o[0]:o:s[a+1],"Below"!==t.editSettings.newRowPosition&&(Object.prototype.hasOwnProperty.call(r,"childRecords")?C.isNullOrUndefined(o)||r[""+i]===o[""+i]||r.childRecords.push(o):r.childRecords=[],-1===r.childRecords.indexOf(h)&&r[""+i]!==o[""+i]&&r.childRecords.unshift(h),n)&&(Object.prototype.hasOwnProperty.call(r,t.childMapping)||(r[t.childMapping]=[]),-1===r[""+t.childMapping].indexOf(h))&&r[""+i]!==o[""+i]&&r[t.childMapping].unshift(h)),t.grid.getPrimaryKeyFieldNames()[0]),l=t.grid.dataSource instanceof b.DataManager?t.grid.dataSource.dataSource.json:t.grid.dataSource,p=0;p<l.length;p++)if(l[parseInt(p.toString(),10)][""+d]===r[""+d]){l[parseInt(p.toString(),10)]=r;break}t.grid.setRowData(i,r);var h,s=t.getRowByIndex(a),n=("Batch"===t.editSettings.mode&&(s="add"===e?t.getRows()[t.grid.getCurrentViewRecords().indexOf(r)]:t.getRows()[t.grid.getRowIndexByPrimaryKey(r[""+i])]),void 0);(t.frozenRows||t.getFrozenColumns())&&(n=t.getRowByIndex(a)),(t.enableVirtualization||C.isNullOrUndefined(s))&&C.isNullOrUndefined(n)||(h=t.treeColumnIndex,t.allowRowDragAndDrop&&t.enableImmutableMode&&(h+=1),t.renderModule.cellRender({data:r,cell:s.cells[parseInt(h.toString(),10)]?s.cells[parseInt(h.toString(),10)]:n.cells[h-t.getFrozenColumns()],column:t.grid.getColumns()[t.treeColumnIndex],requestType:e}),(t.enableImmutableMode&&"indenting"===t.action||"outdenting"===t.action)&&t.renderModule.RowModifier({data:r,row:s}))}else x(t,o.parentItem.uniqueID).childRecords.push(o)}hi=function(e,t){return(hi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var hi,ci,oi=function(e,t){function i(){this.constructor=e}hi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},ui=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},oi=(ci=C.ChildProperty,oi(gi,ci),ui([C.Property(!1)],gi.prototype,"enableCache",void 0),ui([C.Property(3)],gi.prototype,"maxBlocks",void 0),ui([C.Property(3)],gi.prototype,"initialBlocks",void 0),gi);function gi(){return null!==ci&&ci.apply(this,arguments)||this}fi=function(e,t){return(fi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var fi,mi,yi,ui=function(e,t){function i(){this.constructor=e}fi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},c=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},ui=(mi=C.Component,ui(u,mi),(yi=u).prototype.excelExport=function(e,t,i,r){return this.excelExportModule.Map(e,t,i,r,!1)},u.prototype.csvExport=function(e,t,i,r){return this.excelExportModule.Map(e,t,i,r,!0)},u.prototype.pdfExport=function(e,t,i,r){return this.pdfExportModule.Map(e,t,i,r)},u.prototype.serverExcelExport=function(e){this.isExcel=!0,this.exportTreeGrid(e)},u.prototype.serverPdfExport=function(e){this.isExcel=!1,this.exportTreeGrid(e)},u.prototype.serverCsvExport=function(e){this.isExcel=!0,this.exportTreeGrid(e)},u.prototype.exportTreeGrid=function(e){var t=this.grid.getDataModule().generateQuery(!0),t=(new b.UrlAdaptor).processQuery(new b.DataManager({url:""}),t),t=JSON.parse(t.data),i=JSON.parse(this.addOnPersist(["allowPaging","pageSettings","sortSettings","allowPdfExport","allowExcelExport","aggregates","filterSettings","columns","locale","searchSettings","idMapping","parentIdMapping","childMapping","treeColumnIndex"])),t=(i.filterSettings.columns=t.where,i.searchSettings.fields=t.search&&t.search[0].fields||[],i.sortSettings.columns=t.sorted,i.columns=this.setHeaderText(i.columns,["field","headerText","type","format","visible","template","index","width","textAlign","headerTextAlign","columns"]),this.createElement("form",{id:"ExportForm",styles:"display:none;"})),r=this.createElement("input",{id:"treeGridInput",attrs:{name:"treeGridModel"}});r.value=JSON.stringify(i),t.method="POST",t.action=e,t.appendChild(r),document.body.appendChild(t),t.submit(),t.remove()},u.prototype.setHeaderText=function(e,t){for(var i=0;i<e.length;i++)for(var r=this.getColumnByUid(e[parseInt(i.toString(),10)].uid),n=(this.stackedHeader&&C.isNullOrUndefined(r)&&(r=C.isNullOrUndefined(e[parseInt(i.toString(),10)].field)?e[parseInt(i.toString(),10)]:this.getColumnByField(e[parseInt(i.toString(),10)].field)),e[parseInt(i.toString(),10)].headerText=r.headerText,C.isNullOrUndefined(r.template)||(e[parseInt(i.toString(),10)].template="true"),e[parseInt(i.toString(),10)].format&&(e[parseInt(i.toString(),10)].format=I.getNumberFormat(this.getFormat(r.format),r.type,!1,this.currencyCode),this.isExcel||"datetime"!==r.type&&"date"!==r.type||(e[parseInt(i.toString(),10)].format=e[parseInt(i.toString(),10)].format.toString().replace("AM/PM","tt")),e[parseInt(i.toString(),10)].type=r.type),e[parseInt(i.toString(),10)].columns&&this.setHeaderText(e[parseInt(i.toString(),10)].columns,t),Object.keys(e[parseInt(i.toString(),10)])),o=0;o<n.length;o++)t.indexOf(n[parseInt(o.toString(),10)])<0&&delete e[parseInt(i.toString(),10)][n[parseInt(o.toString(),10)]];return e},u.prototype.getFormat=function(e){return"object"==typeof e?C.isNullOrUndefined(e.format)?e.skeleton:e.format:e},u.prototype.getModuleName=function(){return"treegrid"},u.prototype.preRender=function(){this.TreeGridLocale(),this.initProperties(),this.defaultLocale={Above:"Above",Below:"Below",Child:"Child",AddRow:"Add Row",ExpandAll:"Expand All",CollapseAll:"Collapse All",RowIndent:"Indent",RowOutdent:"Outdent"},this.l10n=new C.L10n("treegrid",this.defaultLocale,this.locale),this.isSelfReference&&C.isNullOrUndefined(this.childMapping)&&(this.childMapping="Children")},u.prototype.sortByColumn=function(e,t,i){C.isNullOrUndefined(e)&&C.isNullOrUndefined(t)&&this.trigger(d,{error:"The provided value for the columnName and direction is undefined. Please ensure the columnName and direction contains string."}),this.sortModule&&this.sortModule.sortColumn(e,t,i)},u.prototype.clearSorting=function(){this.sortModule&&this.sortModule.clearSorting()},u.prototype.removeSortColumn=function(e){this.sortModule&&this.sortModule.removeSortColumn(e)},u.prototype.search=function(e){this.grid.search(e)},u.prototype.autoFitColumns=function(e){this.resizeModule.autoFitColumns(e),this.updateColumnModel()},u.prototype.reorderColumns=function(e,t){C.isNullOrUndefined(e)&&C.isNullOrUndefined(t)&&this.trigger(d,{error:"The provided value for the fromFName and toFName is undefined. Please ensure the fromFName and toFName contains string."}),this.grid.reorderColumns(e,t)},u.prototype.TreeGridLocale=function(){var e,t,i;C.isNullOrUndefined(this.locale)||(i=C.L10n.locale,C.setValue(this.locale,{},e={}),t={},t=I.getObject(this.locale,i),i={},i=I.getObject(this.getModuleName(),t),C.setValue("grid",i,I.getObject(this.locale,e)),C.L10n.load(e))},u.prototype.print=function(){this.printModule.print()},u.prototype.treeGridkeyActionHandler=function(e){if(this.allowKeyboard){var t,i,r=void 0,n=void 0,o=void 0,a=void 0,s=void 0;switch(e.action){case"ctrlDownArrow":this.expandAll();break;case"ctrlUpArrow":this.collapseAll();break;case"ctrlShiftUpArrow":o=(r=e.target).closest(".e-rowcell"),C.isNullOrUndefined(o)||(a=o.closest("tr"),C.isNullOrUndefined(a))||C.isNullOrUndefined(a.getElementsByClassName("e-treegridexpand")[0])||this.expandCollapseRequest(a.querySelector(".e-treegridexpand"));break;case"ctrlShiftDownArrow":o=(r=e.target).closest(".e-rowcell"),C.isNullOrUndefined(o)||(a=o.closest("tr"),C.isNullOrUndefined(a))||C.isNullOrUndefined(a.getElementsByClassName("e-treegridcollapse")[0])||this.expandCollapseRequest(a.querySelector(".e-treegridcollapse"));break;case"downArrow":!this.enableVirtualization&&C.isNullOrUndefined(this.rowTemplate)&&(r=e.target,C.isNullOrUndefined(r.querySelectorAll(".e-rowcell"))||(r=I.parentsUntil(r,"e-rowcell")),C.isNullOrUndefined(r)||(n=r.parentElement,C.isNullOrUndefined(n))||(i=n.cellIndex,"dropdownedit"===this.grid.getColumnByIndex(i).editType&&C.isNullOrUndefined(this.grid.getColumnByIndex(i).edit.obj)&&(n=r),null!==(s=this.findnextRowElement(n))?(t=r.cellIndex,t=s.children[parseInt(t.toString(),10)],C.addClass([t],"e-focused"),C.addClass([t],"e-focus")):this.clearSelection()));break;case"upArrow":!this.enableVirtualization&&C.isNullOrUndefined(this.rowTemplate)&&(r=e.target,C.isNullOrUndefined(r.querySelectorAll(".e-rowcell"))||(r=I.parentsUntil(r,"e-rowcell")),C.isNullOrUndefined(r)||(n=r.parentElement,C.isNullOrUndefined(n))||(i=n.cellIndex,"dropdownedit"===this.grid.getColumnByIndex(i).editType&&C.isNullOrUndefined(this.grid.getColumnByIndex(i).edit.obj)&&(n=r),null!==(s=this.findPreviousRowElement(n))?(t=r.cellIndex,C.isNullOrUndefined(t)||(i=s.children[parseInt(t.toString(),10)],C.addClass([i],"e-focused"),C.addClass([i],"e-focus"))):this.clearSelection()))}}},u.prototype.findnextRowElement=function(e){e=e.nextElementSibling;return e=null===e||-1===e.className.indexOf("e-summaryrow")&&"none"!==e.style.display?e:this.findnextRowElement(e)},u.prototype.findPreviousRowElement=function(e){e=e.previousElementSibling;return e=null===e||-1===e.className.indexOf("e-summaryrow")&&"none"!==e.style.display?e:this.findPreviousRowElement(e)},u.prototype.initProperties=function(){this.defaultLocale={},this.flatData=[],this.infiniteScrollData=[],this.remoteCollapsedData=[],this.remoteExpandedData=[],this.parentData=[],this.columnModel=[],this.isExpandAll=!1,this.isCollapseAll=!1,this.keyConfigs={ctrlDownArrow:"ctrl+downarrow",ctrlUpArrow:"ctrl+uparrow",ctrlShiftUpArrow:"ctrl+shift+uparrow",ctrlShiftDownArrow:"ctrl+shift+downarrow",downArrow:"downArrow",upArrow:"upArrow"},this.isLocalData=!(this.dataSource instanceof b.DataManager)||this.dataSource.dataSource.offline||!C.isNullOrUndefined(this.dataSource.ready)||this.dataSource.adaptor instanceof b.RemoteSaveAdaptor,this.isSelfReference=!C.isNullOrUndefined(this.parentIdMapping)},u.prototype.wireEvents=function(){C.EventHandler.add(this.grid.element,"click",this.mouseClickHandler,this),C.EventHandler.add(this.element,"touchend",this.mouseClickHandler,this),this.keyboardModule=new C.KeyboardEvents(this.element,{keyAction:this.treeGridkeyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"}),this.allowKeyboard&&(this.element.tabIndex=-1===this.element.tabIndex?0:this.element.tabIndex)},u.prototype.requiredModules=function(){var e,t=[];return!this.isReact&&C.isNullOrUndefined(this.changedProperties.columns)&&this.grid.splitFrozenCount(this.getColumns()),this.isDestroyed||(t.push({member:"filter",args:[this,this.filterSettings],name:"Filter"}),C.isNullOrUndefined(this.toolbar)||t.push({member:"toolbar",args:[this],name:"Toolbar"}),this.contextMenuItems&&t.push({member:"contextMenu",args:[this],name:"ContextMenu"}),this.allowPaging&&t.push({member:"pager",args:[this,this.pageSettings],name:"Page"}),this.allowReordering&&t.push({member:"reorder",args:[this],name:"Reorder"}),this.allowSorting&&t.push({member:"sort",args:[this],name:"Sort"}),0<this.aggregates.length&&t.push({member:"summary",args:[this],name:"Aggregate"}),this.allowResizing&&t.push({member:"resize",args:[this],name:"Resize"}),this.allowExcelExport&&t.push({member:"ExcelExport",args:[this],name:"ExcelExport"}),e=this.injectedModules.filter(function(e){return"freeze"===e.prototype.getModuleName()}),(this.frozenColumns||this.frozenRows||this.getFrozenColumns()||this.grid.getFrozenLeftColumnsCount()||this.grid.getFrozenRightColumnsCount())&&0<e.length&&t.push({member:"freeze",args:[this],name:"Freeze"}),this.detailTemplate&&t.push({member:"detailRow",args:[this],name:"DetailRow"}),this.allowPdfExport&&t.push({member:"PdfExport",args:[this],name:"PdfExport"}),this.showColumnMenu&&t.push({member:"columnMenu",args:[this],name:"ColumnMenu"}),this.showColumnChooser&&t.push({member:"ColumnChooser",args:[this],name:"ColumnChooser"}),this.extendRequiredModules(t)),t},u.prototype.extendRequiredModules=function(e){var t=this.injectedModules.filter(function(e){return"rowDragAndDrop"===e.prototype.getModuleName()});(this.allowRowDragAndDrop||t.length)&&(C.isNullOrUndefined(this.toolbar)||!this.toolbar.includes("Indent")&&!this.toolbar.includes("Outdent")||(this.isIndentEnabled=!0),e.push({member:"rowDragAndDrop",args:[this],name:"RowDD"})),(this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing)&&e.push({member:"edit",args:[this],name:"Edit"}),!C.isNullOrUndefined(this.columns)&&this.isCommandColumn(this.columns)&&e.push({member:"commandColumn",args:[this],name:"CommandColumn"}),this.allowSelection&&e.push({member:"selection",args:[this],name:"Selection"}),this.enableVirtualization&&e.push({member:"virtualScroll",args:[this],name:"VirtualScroll"}),this.enableInfiniteScrolling&&e.push({member:"infiniteScroll",args:[this],name:"InfiniteScroll"}),e.push({member:"logger",args:[this.grid]})},u.prototype.isCommandColumn=function(e){var t=this;return e.some(function(e){return e.columns?t.isCommandColumn(e.columns):!(!e.commands&&!e.commandsTemplate)})},u.prototype.unwireEvents=function(){this.grid&&this.grid.element&&C.EventHandler.remove(this.grid.element,"click",this.mouseClickHandler),this.element&&(C.EventHandler.remove(this.element,"touchend",this.mouseClickHandler),this.keyboardModule&&(this.keyboardModule.destroy(),this.keyboardModule=null),this.allowKeyboard)&&this.element.removeAttribute("tabIndex")},u.prototype.log=function(e,t){this.loggerModule&&this.loggerModule.treeLog(e,t,this)},u.prototype.render=function(){var i=this,e=(this.isReact&&(this.grid.isReact=!0,this.grid.portals=[]),this.isVue&&(this.grid.isVue=!0,this.grid.vueInstance=this.vueInstance),V.createSpinner({target:this.element},this.createElement),this.log(["mapping_fields_missing"]),this.renderModule=new Ht(this),this.dataModule=new Qt(this),this.printModule=new qt(this),this.trigger(ye),this.autoGenerateColumns(),this.initialRender=!0,C.isNullOrUndefined(this.dataSource)||this.convertTreeData(this.dataSource),this.loadGrid(),this.element.classList.contains("e-treegrid")&&this.rowDropSettings.targetID&&(this.grid.rowDropSettings.targetID+="_gridcontrol"),this.addListener(),C.createElement("div",{id:this.element.id+"_gridcontrol"})),r=(C.addClass([this.element],"e-treegrid"),C.isNullOrUndefined(this.height)||"string"!=typeof this.height||-1===this.height.indexOf("%")||(this.element.style.height=this.height),C.isNullOrUndefined(this.width)||"string"!=typeof this.width||-1===this.width.indexOf("%")||(this.element.style.width=this.width),this.element.appendChild(e),this.grid.requiredModules),t=(this.grid.requiredModules=function(){for(var e=[],e=r.apply(this),t=0;t<e.length;t++)"virtualscroll"===e[parseInt(t.toString(),10)].member&&(e[parseInt(t.toString(),10)].member="treeVirtualScroll");return e},"root");this.grid[t]=this[t]||this,this.grid.appendTo(e),this.actionFailureHandler();this.element.getElementsByClassName("e-gridcontent")[0].childNodes[0].setAttribute("tabindex","0");var t=this.element.getElementsByClassName("e-content")[0].querySelector(".e-table"),e=(C.isNullOrUndefined(t)||t.setAttribute("role","treegrid"),this.isIndentEnabled&&this.refreshToolbarItems(),this.wireEvents(),this.renderComplete(),"destroyTemplate"),n=this.grid[e];this.grid[e]=function(e,t){n.apply(i.grid);i.isReact&&C.isNullOrUndefined(i.portals)||i.clearTemplate(e,t)}},u.prototype.actionFailureHandler=function(){var i,t=this,e=[],r=this.getPrimaryKeyFieldNames(),n=this.flatData.length,r=((this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing)&&0===r.length&&0!==n&&e.push("For the CRUD actions, it is necessary to enable Primary Key field for the unique data column."),this.allowRowDragAndDrop&&0===r.length&&0!==n&&e.push("For the Row Drag and Drop actions, it is necessary to enable Primary Key field for the unique data column."),this.allowPaging&&this.enableVirtualization&&e.push("Paging is not allowed in virtualization case."),0===n&&0===this.columns.length&&e.push("Either of the Data source or columns should be given."),0<this.frozenColumns&&this.columnModel.filter(function(e){return e.isFrozen})&&e.push("Use only one attribute for Frozen either IsFrozen or FrozenColumns."),this.enableVirtualization&&!C.isNullOrUndefined(this.detailTemplate)&&e.push("Virtual scrolling is not compatible with the detail template"),this.stackedHeader&&!C.isNullOrUndefined(this.detailTemplate)&&e.push("Virtual scrolling is not compatible with the detail template"),!(0<this.frozenColumns||this.columnModel.filter(function(e){return e.isFrozen})||0<this.frozenRows)||C.isNullOrUndefined(this.detailTemplate)&&C.isNullOrUndefined(this.rowTemplate)||e.push("Frozen rows and columns are not supported with the Detail template and row template."),(0<this.frozenColumns||0<this.columnModel.filter(function(e){return e.isFrozen}).length||0<this.frozenRows)&&"Cell"===this.editSettings.mode&&e.push("Frozen rows and columns are not supported with cell editing."),this.allowSelection&&!C.isNullOrUndefined(this.rowTemplate)&&e.push("Selection is not supported in RowTemplate"),this.treeColumnIndex<0&&e.push("For showing tree structure it is must to set the TreeColumnIndex value."),this.treeColumnIndex>=this.columns.length&&e.push("TreeColumnIndex value should not exceed the total column count."),this.enableVirtualization&&(this.columnModel.some(function(e){return/%$/.test(e.width)})||/%$/.test(this.height.toString()))&&e.push("column width and height should be in pixels"),"Children"===this.childMapping||C.isNullOrUndefined(this.idMapping)||e.push("Both IdMapping and ChildMapping should not be used together for tree grid rendering."),(!C.isNullOrUndefined(this.idMapping)&&C.isNullOrUndefined(this.parentIdMapping)||C.isNullOrUndefined(this.idMapping)&&!C.isNullOrUndefined(this.parentIdMapping))&&e.push("IdMapping and ParentIdMapping properties should be defined and vice versa."),this.columnModel.filter(function(e){return e.showCheckbox})),n=this.columns[this.treeColumnIndex];0!==r.length&&(r!==n&&e.push("ShowCheckbox column should not be defined other than the tree column."),1<r.length)&&e.push("Only one column can have the ShowCheckbox option enabled."),0!==this.columnModel.filter(function(e){return"Right"===e.textAlign&&e.field===t.columnModel[t.treeColumnIndex].field}).length&&e.push("TextAlign right for the tree column is not applicable."),0<e.length&&(i={error:{}},e.forEach(function(e,t){i.error[parseInt(t.toString(),10)]=e}),this.trigger(d,i))},u.prototype.refreshToolbarItems=function(){var e=this.toolbarModule.getToolbar(),t=this.element.id+"_gridcontrol_indent",i=this.element.id+"_gridcontrol_outdent",t=e.querySelector("#"+t).parentElement,e=e.querySelector("#"+i).parentElement;t.classList.add("e-hidden"),e.classList.add("e-hidden")},u.prototype.afterGridRender=function(){C.isNullOrUndefined(this.grid.clipboardModule)||this.grid.clipboardModule.destroy(),this.clipboardModule=this.grid.clipboardModule=new Mt(this,this.grid.serviceLocator)},u.prototype.convertTreeData=function(e){var t,i=this;(e=w(this)?C.getValue("result",e):e)instanceof Array&&0<e.length&&Object.prototype.hasOwnProperty.call(e[0],"level")?(this.flatData=e,this.flatData.filter(function(e){C.setValue("uniqueIDCollection."+e.uniqueID,e,i),0===e.level&&i.parentData.push(e)})):w(this)?(t=C.getValue("result",this.dataSource),this.dataModule.convertToFlatData(t)):this.dataModule.convertToFlatData(e)},u.prototype.bindGridProperties=function(){this.bindedDataSource(),this.grid.enableRtl=this.enableRtl,this.grid.allowKeyboard=this.allowKeyboard,this.grid.columns=this.getGridColumns(this.columns),this.grid.allowExcelExport=this.allowExcelExport,this.grid.allowPdfExport=this.allowPdfExport,this.grid.query=this.query,this.grid.columnQueryMode=this.columnQueryMode,this.grid.allowPaging=this.allowPaging,this.grid.pageSettings=I.getActualProperties(this.pageSettings),this.grid.pagerTemplate=this.pagerTemplate,this.grid.showColumnMenu=this.showColumnMenu,this.grid.allowSorting=this.allowSorting,this.grid.allowFiltering=this.allowFiltering,this.grid.enableVirtualization=this.enableVirtualization,this.grid.enableColumnVirtualization=this.enableColumnVirtualization,this.grid.enableInfiniteScrolling=this.enableInfiniteScrolling,this.grid.infiniteScrollSettings=this.infiniteScrollSettings,this.grid.enableVirtualMaskRow=this.enableVirtualMaskRow,this.grid.loadingIndicator=this.loadingIndicator,this.grid.width=this.width,this.grid.height=this.height,this.grid.enableAltRow=this.enableAltRow,this.grid.allowReordering=this.allowReordering,this.grid.allowTextWrap=this.allowTextWrap,this.grid.allowResizing=this.allowResizing,this.grid.enableHover=this.enableHover,this.grid.enableAutoFill=this.enableAutoFill,this.grid.enableAdaptiveUI=this.enableAdaptiveUI,this.grid.enableImmutableMode=this.enableImmutableMode,this.grid.allowRowDragAndDrop=this.allowRowDragAndDrop,this.grid.rowDropSettings=I.getActualProperties(this.rowDropSettings),this.grid.rowHeight=this.rowHeight,this.grid.gridLines=this.gridLines,this.grid.allowSelection=this.allowSelection,this.grid.toolbar=I.getActualProperties(this.getGridToolbar()),this.grid.toolbarTemplate=this.toolbarTemplate,this.grid.showColumnChooser=this.showColumnChooser,this.grid.filterSettings=I.getActualProperties(this.filterSettings),this.grid.selectionSettings=I.getActualProperties(this.selectionSettings),this.grid.sortSettings=I.getActualProperties(this.sortSettings),this.grid.searchSettings=I.getActualProperties(this.searchSettings),this.grid.aggregates=I.getActualProperties(this.aggregates),this.grid.textWrapSettings=I.getActualProperties(this.textWrapSettings),this.grid.printMode=I.getActualProperties(this.printMode),this.grid.locale=I.getActualProperties(this.locale),this.grid.selectedRowIndex=this.selectedRowIndex,this.grid.contextMenuItems=I.getActualProperties(this.getContextMenu()),this.grid.columnMenuItems=I.getActualProperties(this.columnMenuItems),this.grid.editSettings=this.getGridEditSettings(),this.grid.rowTemplate=I.getActualProperties(this.rowTemplate),this.grid.detailTemplate=I.getActualProperties(this.detailTemplate),this.grid.frozenRows=this.frozenRows,this.grid.frozenColumns=this.frozenColumns,this.grid.clipMode=I.getActualProperties(this.clipMode);var e="templateDotnetInstance";this.grid[e]=this[e],this.grid.isJsComponent=!0;this.grid.enableHtmlSanitizer=this.enableHtmlSanitizer},u.prototype.triggerEvents=function(e){this.trigger(I.getObject("name",e),e)},u.prototype.IsExpandCollapseClicked=function(e){C.isNullOrUndefined(e.target)||!(e.target.classList.contains("e-treegridexpand")||e.target.classList.contains("e-treegridcollapse")||e.target.classList.contains("e-summarycell"))||this.selectionSettings.checkboxOnly||(!C.isNullOrUndefined(e.data)&&e.data.hasChildRecords||-1!==e.rowIndex&&C.isNullOrUndefined(e.data))&&(e.cancel=!0)},u.prototype.bindGridEvents=function(){var r=this;this.grid.rowSelecting=function(e){r.IsExpandCollapseClicked(e),!C.isNullOrUndefined(e.data)&&r.selectionSettings.persistSelection&&0<r.columnModel.filter(function(e){return"checkbox"===e.type}).length&&S(r)&&(C.isNullOrUndefined(e.data.parentItem)&&!e.isHeaderCheckboxClicked||(r.parentQuery=r.query.queries.filter(function(e){return e.e.field===r.parentIdMapping}),r.query.queries=r.query.queries.slice(0,0))),"Root"===r.pageSettings.pageSizeMode&&(r.grid.selectionModule.totalRecordsCount=r.grid.currentViewData.length),r.enableVirtualization&&e.rowIndex===r.selectedRowIndex&&(e.cancel=!0),r.trigger(be,e)},this.grid.rowDeselecting=function(e){r.IsExpandCollapseClicked(e),!C.isNullOrUndefined(e.data)&&r.selectionSettings.persistSelection&&0<r.columnModel.filter(function(e){return"checkbox"===e.type}).length&&S(r)&&(r.parentQuery=r.query.queries.filter(function(e){return e.e.field===r.parentIdMapping}),r.query.queries=r.query.queries.slice(0,0)),r.trigger(xt,e)},this.grid.rowSelected=function(e){if(r.enableVirtualization&&e.isHeaderCheckboxClicked&&r.grid.currentViewData.length!==r.grid.selectionModule.selectedRowIndexes.length)for(var t=0;t<r.getRows().length;t++)r.getRows()[parseInt(t.toString(),10)].getElementsByClassName("e-frame e-icons e-uncheck").length&&r.grid.selectionModule.updateRowSelection(r.getRows()[parseInt(t.toString(),10)],r.getCurrentViewRecords()[parseInt(t.toString(),10)].index);r.selectedRowIndex=r.grid.selectedRowIndex,r.notify(De,e),r.trigger(De,e)},this.grid.rowDeselected=function(e){r.selectedRowIndex=r.grid.selectedRowIndex,C.isNullOrUndefined(e.data)||r.notify(Oe,e),r.trigger(Oe,e)},this.grid.resizeStop=function(e){r.updateColumnModel(),r.trigger(Ae,e)},this.grid.excelQueryCellInfo=function(e){r.notify("excelCellInfo",e),r.dataResults},this.grid.pdfQueryCellInfo=function(e){r.notify("pdfCellInfo",e),r.dataResults},this.grid.checkBoxChange=function(e){r.trigger(Me,e)},this.grid.pdfExportComplete=this.triggerEvents.bind(this),this.grid.excelExportComplete=this.triggerEvents.bind(this),this.grid.excelHeaderQueryCellInfo=this.triggerEvents.bind(this),this.grid.pdfHeaderQueryCellInfo=this.triggerEvents.bind(this),this.grid.dataSourceChanged=this.triggerEvents.bind(this),this.grid.recordDoubleClick=this.triggerEvents.bind(this),this.grid.cellDeselected=this.triggerEvents.bind(this),this.grid.cellDeselecting=this.triggerEvents.bind(this),this.grid.columnMenuOpen=this.triggerEvents.bind(this),this.grid.columnMenuClick=this.triggerEvents.bind(this),this.grid.cellSelected=this.triggerEvents.bind(this),this.grid.headerCellInfo=this.triggerEvents.bind(this),this.grid.resizeStart=this.triggerEvents.bind(this),this.grid.resizing=this.triggerEvents.bind(this),this.grid.columnDrag=this.triggerEvents.bind(this),this.grid.columnDragStart=this.triggerEvents.bind(this),this.grid.columnDrop=this.triggerEvents.bind(this),this.grid.beforePrint=this.triggerEvents.bind(this),this.grid.beforeCopy=this.triggerEvents.bind(this),this.grid.beforePaste=function(e){for(var t=r.getRows(),i="rowIndex";t[e[i]].classList.contains("e-summaryrow");)e[i]++;r.trigger(He,e)},this.grid.load=function(){r.grid.on("initial-end",r.afterGridRender,r),C.isNullOrUndefined(r.loggerModule)||(r.loggerModule=r.grid.loggerModule=new ce(r.grid))},this.grid.printComplete=this.triggerEvents.bind(this),this.grid.actionFailure=function(e){r.trigger(d,e)},this.extendedGridDataBoundEvent(),this.extendedGridEvents(),this.extendedGridActionEvents(),this.extendedGridEditEvents(),this.bindGridDragEvents(),this.bindCallBackEvents()},u.prototype.lastRowBorder=function(e,t){for(var i=0;i<e.cells.length;i++)t?C.addClass([e.cells[parseInt(i.toString(),10)]],"e-lastrowcell"):C.removeClass([e.cells[parseInt(i.toString(),10)]],"e-lastrowcell")},u.prototype.isPixelHeight=function(){return"auto"!==this.height&&-1===this.height.toString().indexOf("%")},u.prototype.extendedGridDataBoundEvent=function(){var a=this,r=(this.grid.dataBound=function(e){if(a.updateRowTemplate(),a.updateColumnModel(),a.updateAltRow(a.getRows()),a.notify("dataBoundArg",e),!S(a)||v(a)||a.hasChildMapping||(t=void 0,t=a.dataResults.result?0:1,C.setValue("grid.contentModule.isLoaded",!(0<t),a)),a.isPixelHeight()&&a.initialRender)for(var t=a.getContentTable().rows,i=[].slice.call(t),r=i.length-1;0<r;r--)if(!Ut(i[parseInt(r.toString(),10)])){i[parseInt(r.toString(),10)].nextElementSibling&&a.lastRowBorder(i[parseInt(r.toString(),10)],!0);break}if(a.enableVirtualization&&a.selectionSettings.persistSelection&&("expand"===a.dataResults.action||"collapse"===a.dataResults.action)&&(a.grid.selectionModule.refreshPersistSelection(),"Single"===a.grid.selectionSettings.type)&&(n="updateRowSelection",o=a.getCurrentViewRecords().indexOf(a.grid.selectionModule.data),a.grid.selectionModule[""+n](a.getRows()[parseInt(o.toString(),10)],o)),a.enableVirtualization&&a.selectionSettings.persistSelection&&!C.isNullOrUndefined(a.virtualScrollModule.prevSelectedRecord))for(r=0;r<a.virtualScrollModule.prevSelectedRecord.length;r++){var n="updateRowSelection",o=a.getCurrentViewRecords().indexOf(a.virtualScrollModule.prevSelectedRecord[parseInt(r.toString(),10)]);a.grid.selectionModule[""+n](a.getRows()[parseInt(o.toString(),10)],o)}a.trigger(we,e),a.initialRender=!1},this);this.grid.beforeDataBound=function(e){var t,i=I.getObject("action",e);if((S(r)&&!v(r)||w(this))&&"edit"!==i?(r.notify("updateRemoteLevel",e),e=r.dataResults):0===r.flatData.length&&v(r)&&r.dataSource instanceof b.DataManager&&(i=r.dataSource,r.dataModule.convertToFlatData(i.dataSource.json),e.result=r.grid.dataSource.dataSource.json=r.flatData),S(r)||w(this)||C.isNullOrUndefined(r.dataSource)||(this.isPrinting&&C.setValue("isPrinting",!0,e),r.notify("dataProcessor",e)),C.extend(e,r.dataResults),r.enableImmutableMode&&(e.result=e.result.slice()),r.initialRender&&(this.contentModule.objectEqualityChecker=r.objectEqualityChecker),!this.isPrinting)return t=new b.Deferred,r.trigger(Re,e,function(e){t.resolve(e)}),t},this.grid.log=function(e,t){a.loggerModule&&a.loggerModule.log(e,t)}},u.prototype.bindCallBackEvents=function(){var r=this;this.grid.toolbarClick=function(t){var i;if(!(t.item.id===r.grid.element.id+"_excelexport"&&!1===r.allowExcelExport||t.item.id===r.grid.element.id+"_pdfexport"&&!1===r.allowPdfExport||t.item.id===r.grid.element.id+"_csvexport"&&!1===r.allowExcelExport))return i=new b.Deferred,r.trigger(Pe,t,function(e){e.cancel||r.notify(Pe,t),i.resolve(e)}),i},this.grid.cellSelecting=function(e){var t=r.grid.selectionModule.actualTarget,i=(C.isNullOrUndefined(t)||!t.classList.contains("e-treegridexpand")&&!t.classList.contains("e-treegridcollapse")||(e.cancel=!0),new b.Deferred);return r.trigger(I.getObject("name",e),e,function(e){i.resolve(e)}),i},this.grid.beginEdit=function(e){var t;if(C.isNullOrUndefined(e.row)||!e.row.classList.contains("e-summaryrow"))return t=new b.Deferred,r.trigger(Qe,e,function(e){t.resolve(e)}),t;e.cancel=!0}},u.prototype.extendedGridEditEvents=function(){var r=this;this.grid.dataStateChange=function(e){r.isExpandRefresh?(r.isExpandRefresh=!1,r.grid.dataSource={result:r.flatData,count:C.getValue("count",r.grid.dataSource)}):("infiniteScroll"!==e.action.requestType&&(r.infiniteScrollData=[]),r.trigger(xe,e))},this.grid.cellSave=function(e){r.grid.isContextMenuOpen()&&(t=r.grid.contextMenuModule.contextMenu.element.getElementsByClassName("e-selected")[0],!C.isNullOrUndefined(t)&&t.id===r.element.id+"_gridcontrol_cmenu_Save"||(e.cancel=!0));var t,i=new b.Deferred;return r.trigger(Ye,e,function(e){e.cancel||r.notify(Ye,e),i.resolve(e)}),i},this.grid.cellSaved=function(e){r.trigger(Je,e),r.notify(Je,e)},this.grid.cellEdit=function(e){var t=new b.Deferred;return e.promise=t,r.notify(Xe,e),t},this.grid.batchAdd=function(e){r.trigger(et,e),r.notify(et,e)},this.grid.beforeBatchSave=function(e){r.trigger(rt,e),r.notify(rt,e)},this.grid.beforeBatchAdd=function(e){r.trigger(it,e),r.notify(it,e)},this.grid.batchDelete=function(e){r.trigger($e,e),r.notify($e,e)},this.grid.beforeBatchDelete=function(e){r.trigger(tt,e),r.notify(tt,e)},this.grid.batchCancel=function(e){"Cell"!==r.editSettings.mode&&r.trigger(Ze,e),r.notify(Ze,e)}},u.prototype.updateRowTemplate=function(){var n=this;this.rowTemplate&&(this.isReact&&0===this.getContentTable().rows.length?setTimeout(function(){if(n.treeColumnRowTemplate(),n.enableCollapseAll)for(var e=n.getCurrentViewRecords(),t=n.getContentTable().rows,i=0;i<t.length;i++){var r={data:e[parseInt(i.toString(),10)],row:t[parseInt(i.toString(),10)]};n.renderModule.RowModifier(r)}},0):this.treeColumnRowTemplate())},u.prototype.bindedDataSource=function(){var e,t,i,r="dataSource",n="ready";this.dataSource&&w(this)?(e=this.flatData,t=C.getValue("count",this.dataSource),this.grid.dataSource={result:e,count:t}):this.grid.dataSource=this.dataSource instanceof b.DataManager?new b.DataManager(this.dataSource.dataSource,this.dataSource.defaultQuery,this.dataSource.adaptor):this.flatData,this.dataSource instanceof b.DataManager&&(this.dataSource.dataSource.offline||this.dataSource.ready)&&(this.grid.dataSource[r].json=D(this.dataSource[r].json),this.grid.dataSource[n]=this.dataSource.ready,C.isNullOrUndefined((i=this).grid.dataSource[n])||this.grid.dataSource[n].then(function(e){var t=i.grid.dataSource;t[r].offline=!0,t.isDataAvailable=!0,t[r].json=e.result,t.adaptor=new b.JsonAdaptor}))},u.prototype.extendedGridActionEvents=function(){var n=this;this.grid.actionBegin=function(e){var t;if("sorting"===e.requestType&&e.target&&e.target.parentElement&&e.target.parentElement.classList.contains("e-hierarchycheckbox")&&(e.cancel=!0),"reorder"===I.getObject("requestType",e)&&n.notify("getColumnIndex",{}),S(n)&&n.enableVirtualization&&("virtualscroll"===e.requestType?(n.query.expand("VirtualScrollingAction"),n.showSpinner()):"searching"===e.requestType&&""===e.searchString?n.query.expand("ClearSearchingAction"):"clearFilter"===e.action&&n.query.expand("ClearFilteringAction")),n.notify("actionBegin",{editAction:e}),S(n)||C.isNullOrUndefined(n.filterModule)||w(n)||0!==n.grid.filterSettings.columns.length||0!==n.grid.searchSettings.key.length||(n.notify("clearFilters",{flatData:n.grid.dataSource}),n.grid.setProperties({dataSource:n.dataResults.result},!0),C.isNullOrUndefined(n.grid.changedProperties.dataSource)&&(n.grid.renderModule.data.dataManager=n.grid.dataSource instanceof b.DataManager?n.grid.dataSource:C.isNullOrUndefined(n.grid.dataSource)?new b.DataManager:new b.DataManager(n.grid.dataSource),n.grid.renderModule.data.isQueryInvokedFromData=!0,n.grid.query=n.grid.query instanceof b.Query?n.grid.query:new b.Query)),"indenting"!==n.action&&"outdenting"!==n.action)return t=new b.Deferred,n.trigger(ve,e,function(e){e.cancel||n.notify(Qe,e),t.resolve(e)}),t},this.grid.actionComplete=function(e){var t,i,r;n.notify("actioncomplete",e),n.updateColumnModel(),n.updateTreeGridModel(),"reorder"===e.requestType&&n.notify("setColumnIndex",{}),n.notify("actionComplete",{editAction:e}),"add"===e.requestType&&"Top"!==n.editSettings.newRowPosition&&"Bottom"!==n.editSettings.newRowPosition&&n.notify(Ke,e),"batchsave"===e.requestType&&n.notify(nt,e),n.notify("updateGridActions",e),"save"===e.requestType&&n.aggregates.map(function(e){return!0===e.showChildSummary}).length&&n.grid.refresh(),"filter"!==e.action||""===n.filterModule.currentFilterObject||!n.enableVirtualization||n.initialRender||S(n)&&n.enableVirtualization||n.expandAll(),"searching"!==e.requestType||""===n.searchSettings.key||!n.enableVirtualization||n.initialRender||S(n)&&n.enableVirtualization||n.expandAll(),"clearFilter"===e.action&&n.enableCollapseAll&&n.collapseAll(),"indenting"===n.action||"outdenting"===n.action?(n.action="indenting"===n.action?"indented":"outdented",i={data:t=[n.selectedRecords],dropIndex:n.dropIndex,dropPosition:n.dropPosition,modifiedRecords:n.modifiedRecords,requestType:n.action,row:n.selectedRows},n.trigger(Ce,i),n.getCurrentViewRecords().filter(function(e){return e.uniqueID===t[0].uniqueID}).length||n.refreshToolbarItems(),n.action="",n.selectedRecords=n.selectedRows=n.modifiedRecords=[]):(n.grid.isFrozenGrid()&&n.enableVirtualization&&"movable"===e.tableName&&(i=n.grid.element.querySelector("."+Ct),r=n.grid.element.querySelector("."+bt),i.style.height=r.style.height="auto"),n.trigger(Ce,e))}},u.prototype.extendedGridEvents=function(){var t=this,i=this;this.grid.recordDoubleClick=function(e){t.trigger(We,e),t.notify(We,e)},this.grid.detailDataBound=function(e){t.notify("detaildataBound",e),t.trigger(ut,e)},this.grid.rowDataBound=function(e){C.isNullOrUndefined(this.isPrinting)?C.setValue("isPrinting",!1,e):C.setValue("isPrinting",this.isPrinting,e),i.renderModule.RowModifier(e)},this.grid.queryCellInfo=function(e){C.isNullOrUndefined(this.isPrinting)?C.setValue("isPrinting",!1,e):C.setValue("isPrinting",this.isPrinting,e),i.renderModule.cellRender(e)},this.grid.contextMenuClick=function(e){t.notify(Fe,e),t.trigger(Fe,e)},this.grid.contextMenuOpen=function(e){t.notify(je,e),t.trigger(je,e)},this.grid.queryCellInfo=function(e){t.renderModule.cellRender(e)}},u.prototype.bindGridDragEvents=function(){var t=this;this.grid.rowDragStartHelper=function(e){t.trigger(ft,e)},this.grid.rowDragStart=function(e){t.trigger(yt,e)},this.grid.rowDrag=function(e){t.grid.isEdit?e.cancel=!0:(t.notify(It,e),t.trigger(gt,e))},this.grid.rowDrop=function(e){t.grid.isEdit||t.notify(Rt,e),e.cancel=!0}},u.prototype.loadGrid=function(){this.bindGridProperties(),this.bindGridEvents(),C.setValue("registeredTemplate",this.registeredTemplate,this.grid);C.setValue("viewContainerRef",this.viewContainerRef,this.grid)},u.prototype.autoGenerateColumns=function(){if(!this.columns.length&&!this.dataModule.isRemote()&&Object.keys(this.dataSource).length){this.columns=[];for(var e=this.dataSource[0],t=Object.keys(e),i=0;i<t.length;i++)-1===[this.childMapping,this.parentIdMapping].indexOf(t[parseInt(i.toString(),10)])&&this.columns.push(t[parseInt(i.toString(),10)])}},u.prototype.getGridEditSettings=function(){var e={};switch(e.allowAdding=this.editSettings.allowAdding,e.allowEditing=this.editSettings.allowEditing,e.allowDeleting=this.editSettings.allowDeleting,e.newRowPosition="Bottom"===this.editSettings.newRowPosition?"Bottom":"Top",e.allowEditOnDblClick=this.editSettings.allowEditOnDblClick,e.showConfirmDialog=this.editSettings.showConfirmDialog,e.template=this.editSettings.template,e.showDeleteConfirmDialog=this.editSettings.showDeleteConfirmDialog,e.allowNextRowEdit=this.editSettings.allowNextRowEdit,e.guid=this.editSettings.guid,e.dialog=this.editSettings.dialog,this.editSettings.mode){case"Dialog":case"Batch":e.mode=this.editSettings.mode;break;case"Row":e.mode="Normal";break;case"Cell":e.mode="Normal",e.showConfirmDialog=!1}return e},u.prototype.getContextMenu=function(){if(this.contextMenuItems){for(var e=[],t=0;t<this.contextMenuItems.length;t++)switch(this.contextMenuItems[parseInt(t.toString(),10)]){case"AddRow":case r.ContextMenuItems.AddRow:e.push({text:this.l10n.getConstant("AddRow"),target:".e-content",id:this.element.id+"_gridcontrol_cmenu_AddRow",items:[{text:this.l10n.getConstant("Above"),id:"Above"},{text:this.l10n.getConstant("Below"),id:"Below"},{text:this.l10n.getConstant("Child"),id:"Child"}]});break;case"Indent":case r.ContextMenuItems.RowIndent:e.push({text:this.l10n.getConstant("RowIndent"),target:".e-content",iconCss:"e-indent e-icons",id:this.element.id+"_gridcontrol_cmenu_Indent"});break;case"Outdent":case r.ContextMenuItems.RowOutdent:e.push({text:this.l10n.getConstant("RowOutdent"),target:".e-content",iconCss:"e-outdent e-icons",id:this.element.id+"_gridcontrol_cmenu_Outdent"});break;default:e.push(this.contextMenuItems[parseInt(t.toString(),10)])}return e}return null},u.prototype.getGridToolbar=function(){if(this.toolbar){this.l10n=new C.L10n("treegrid",this.defaultLocale,this.locale);for(var e=[],t=void 0,i=0;i<this.toolbar.length;i++)switch(this.toolbar[parseInt(i.toString(),10)]){case"Search":case r.ToolbarItem.Search:e.push("Search");break;case"Print":case r.ToolbarItem.Print:e.push("Print");break;case"ExpandAll":case r.ToolbarItem.ExpandAll:t=this.l10n.getConstant("ExpandAll"),e.push({text:t,tooltipText:t,prefixIcon:"e-expand",id:this.element.id+"_gridcontrol_expandall"});break;case"CollapseAll":case r.ToolbarItem.CollapseAll:t=this.l10n.getConstant("CollapseAll"),e.push({text:t,tooltipText:t,prefixIcon:"e-collapse",id:this.element.id+"_gridcontrol_collapseall"});break;case"Indent":case r.ToolbarItem.RowIndent:t=this.l10n.getConstant("RowIndent"),e.push({text:t,tooltipText:t,prefixIcon:"e-indent",id:this.element.id+"_gridcontrol_indent"});break;case"Outdent":case r.ToolbarItem.RowOutdent:t=this.l10n.getConstant("RowOutdent"),e.push({text:t,tooltipText:t,prefixIcon:"e-outdent",id:this.element.id+"_gridcontrol_outdent"});break;default:e.push(this.toolbar[parseInt(i.toString(),10)])}return e}return null},u.prototype.getGridColumns=function(e,t,i){void 0===i&&(i=0);for(var r=e,n=((t=void 0===t?!0:t)&&(this.columnModel=[]),0===this.columnModel.length&&(i=0===i?-1:i),[]),o=0;o<r.length;o++){i+=1;var a=this.grid.getColumnByUid(r[parseInt(o.toString(),10)].uid),s=a||{},d={};if("string"==typeof this.columns[parseInt(o.toString(),10)])s.field=d.field=this.columns[parseInt(o.toString(),10)];else for(var l=0,p=Object.keys(r[parseInt(o.toString(),10)]);l<p.length;l++){var h=p[l];i===this.treeColumnIndex&&"template"===h?d[""+h]=r[parseInt(o.toString(),10)][""+h]:"columns"!==h||C.isNullOrUndefined(r[parseInt(o.toString(),10)][""+h])?this.initialRender&&!C.isNullOrUndefined(a)&&this.enablePersistence&&"edit"===h?s[""+h]=d[""+h]=a[""+h]:a&&"sortComparer"===h||(s[""+h]=d[""+h]=r[parseInt(o.toString(),10)][""+h]):(s[""+h]=this.getGridColumns(r[parseInt(o.toString(),10)][""+h],!1,this.columnModel.length-1),d[""+h]=r[parseInt(o.toString(),10)][""+h])}d.columns||this.columnModel.push(new j(d)),n.push(s),!C.isNullOrUndefined(this.columnModel[this.treeColumnIndex])&&this.enableRtl&&s.field===this.columnModel[this.treeColumnIndex].field&&(C.isNullOrUndefined(this.treeColumnTextAlign)&&(this.treeColumnTextAlign=this.columnModel[this.treeColumnIndex].textAlign,this.treeColumnField=this.columnModel[this.treeColumnIndex].field),s.textAlign="Right")}return n},u.prototype.onPropertyChanged=function(e){var t=Object.keys(e),i=!1;-1<t.indexOf("columns")&&!C.isNullOrUndefined(e.columns)&&0===this.frozenColumns&&0===this.frozenRows&&!this.columnModel.some(function(e){return e.isFrozen||e.freeze})&&(this.grid.columns=this.getGridColumns(e.columns),this.grid.updateColumnObject(),i=!0);for(var r=0,n=t;r<n.length;r++){var o,a=n[r];switch(a){case"treeColumnIndex":this.grid.refreshColumns();break;case"allowPaging":this.grid.allowPaging=this.allowPaging;break;case"pageSettings":this.grid.pageSettings=I.getActualProperties(this.pageSettings),i=!0;break;case"enableVirtualization":this.grid.enableVirtualization=this.enableVirtualization;break;case"enableColumnVirtualization":this.grid.enableColumnVirtualization=this.enableColumnVirtualization;break;case"toolbar":this.grid.toolbar=this.getGridToolbar();break;case"allowSelection":this.grid.allowSelection=this.allowSelection;break;case"selectionSettings":this.grid.selectionSettings=I.getActualProperties(this.selectionSettings);break;case"allowSorting":this.grid.allowSorting=this.allowSorting;break;case"allowMultiSorting":this.grid.allowMultiSorting=this.allowMultiSorting;break;case"sortSettings":this.grid.sortSettings=I.getActualProperties(this.sortSettings);break;case"searchSettings":this.grid.searchSettings=I.getActualProperties(this.searchSettings);break;case"allowFiltering":this.grid.allowFiltering=this.allowFiltering;break;case"filterSettings":this.initialRender||(this.grid.filterSettings=I.getActualProperties(this.filterSettings));break;case"showColumnMenu":this.grid.showColumnMenu=this.showColumnMenu;break;case"allowRowDragAndDrop":this.grid.allowRowDragAndDrop=this.allowRowDragAndDrop;break;case"aggregates":this.grid.aggregates=I.getActualProperties(this.aggregates);break;case"enableInfiniteScrolling":this.grid.enableInfiniteScrolling=this.enableInfiniteScrolling;break;case"dataSource":this.isLocalData=!(this.dataSource instanceof b.DataManager)||!C.isNullOrUndefined(this.dataSource.ready)||this.dataSource.adaptor instanceof b.RemoteSaveAdaptor,this.convertTreeData(this.dataSource),this.isLocalData?(w(this)?(o=C.getValue("count",this.dataSource),this.grid.dataSource={result:this.flatData,count:o}):(o=this.dataSource,this.grid.dataSource=o instanceof b.DataManager?new b.DataManager(o.dataSource,o.defaultQuery,o.adaptor):this.flatData),this.enableVirtualization&&(this.grid.contentModule.isDataSourceChanged=!0)):(this.bindedDataSource(),this.enableVirtualization&&(this.grid.contentModule.removeEventListener(),this.grid.contentModule.eventListener("on"),this.grid.contentModule.renderTable()));break;case"query":this.grid.query=this.query;break;case"enableCollapseAll":e[""+a]?this.collapseAll():this.expandAll();break;case"expandStateMapping":this.grid.refresh();break;case"gridLines":this.grid.gridLines=this.gridLines;break;case"rowTemplate":this.grid.rowTemplate=I.getActualProperties(this.rowTemplate);break;case"frozenRows":this.grid.frozenRows=this.frozenRows;break;case"frozenColumns":this.grid.frozenColumns=this.frozenColumns;break;case"rowHeight":this.grid.rowHeight=this.rowHeight;break;case"height":C.isNullOrUndefined(this.height)||"string"!=typeof this.height||-1===this.height.indexOf("%")||(this.element.style.height=this.height),this.grid.height=this.height;break;case"width":C.isNullOrUndefined(this.width)||"string"!=typeof this.width||-1===this.width.indexOf("%")||(this.element.style.width=this.width),this.grid.width=this.width;break;case"locale":this.grid.locale=this.locale,this.TreeGridLocale(),this.grid.toolbar=this.getGridToolbar(),this.grid.contextMenuItems=this.getContextMenu();break;case"selectedRowIndex":this.grid.selectedRowIndex=this.selectedRowIndex;break;case"enableAltRow":this.grid.enableAltRow=this.enableAltRow;break;case"enableHover":this.grid.enableHover=this.enableHover;break;case"enableAutoFill":this.grid.enableAutoFill=this.enableAutoFill;break;case"enableAdaptiveUI":this.grid.enableAdaptiveUI=this.enableAdaptiveUI;break;case"enableImmutableMode":this.grid.enableImmutableMode=this.enableImmutableMode;break;case"allowExcelExport":this.grid.allowExcelExport=this.allowExcelExport;break;case"allowPdfExport":this.grid.allowPdfExport=this.allowPdfExport;break;case"enableRtl":C.isNullOrUndefined(this.treeColumnField)||this.updateTreeColumnTextAlign(),this.grid.enableRtl=this.enableRtl;break;case"allowReordering":this.grid.allowReordering=this.allowReordering;break;case"allowResizing":this.grid.allowResizing=this.allowResizing;break;case"textWrapSettings":this.grid.textWrapSettings=I.getActualProperties(this.textWrapSettings);break;case"allowTextWrap":this.grid.allowTextWrap=I.getActualProperties(this.allowTextWrap),this.grid.refresh();break;case"contextMenuItems":this.grid.contextMenuItems=this.getContextMenu();break;case"showColumnChooser":this.grid.showColumnChooser=this.showColumnChooser;break;case"detailTemplate":this.grid.detailTemplate=I.getActualProperties(this.detailTemplate);break;case"columnMenuItems":this.grid.columnMenuItems=I.getActualProperties(this.columnMenuItems);break;case"editSettings":this.grid.isEdit&&"Normal"===this.grid.editSettings.mode&&e[""+a].mode&&("Cell"===e[""+a].mode||"Row"===e[""+a].mode)&&this.grid.closeEdit(),this.grid.editSettings=this.getGridEditSettings()}i&&this.grid.refresh()}},u.prototype.updateTreeColumnTextAlign=function(){this.grid.getColumnByField(this.treeColumnField).textAlign=this.enableRtl?"Right":this.treeColumnTextAlign,this.grid.refreshColumns()},u.prototype.destroy=function(){var e=this.element;if(e){for(var e=!(!e.querySelector(".e-gridheader")||!e.querySelector(".e-gridcontent")),t=(e&&this.unwireEvents(),this.removeListener(),e&&mi.prototype.destroy.call(this),this.grid&&this.grid.destroy(),this.dataModule&&this.dataModule.destroy(),["dataModule","sortModule","renderModule","filterModule","printModule","clipboardModule","excelExportModule","pdfExportModule","toolbarModule","summaryModule","reorderModule","resizeModule","pagerModule","keyboardModule","columnMenuModule","contextMenuModule","editModule","virtualScrollModule","selectionModule","detailRow","rowDragAndDropModule","freezeModule"]),i=0;i<t.length;i++)this[t[parseInt(i.toString(),10)]]&&(this[t[parseInt(i.toString(),10)]]=null);this.element.innerHTML="",this.grid=null}},u.prototype.dataBind=function(){C.isNullOrUndefined(this.grid)||(!C.isNullOrUndefined(this.rowDropSettings.targetID)&&C.isNullOrUndefined(document.getElementById(this.grid.rowDropSettings.targetID))&&(document.getElementById(this.rowDropSettings.targetID).id=this.grid.rowDropSettings.targetID,this.rowDropSettings.targetID=this.grid.rowDropSettings.targetID),mi.prototype.dataBind.call(this),this.grid.dataBind())},u.prototype.getPersistData=function(){for(var e=["pageSettings","sortSettings","filterSettings","columns","searchSettings","selectedRowIndex","treeColumnIndex"],t={pageSettings:["template","pageSizes","pageSizeMode","enableQueryString","totalRecordsCount","pageCount"],filterSettings:["type","mode","showFilterBarStatus","immediateModeDelay","ignoreAccent","hierarchyMode"],searchSettings:["fields","operator","ignoreCase"],sortSettings:[],columns:[],selectedRowIndex:[]},i=0;i<e.length;i++)for(var r=this[e[parseInt(i.toString(),10)]],n=0,o=t[e[parseInt(i.toString(),10)]];!C.isNullOrUndefined(o)&&n<o.length;n++)delete r[""+o[parseInt(n.toString(),10)]];return this.ignoreInArrays(["filter","edit","filterBarTemplate","headerTemplate","template","commandTemplate","commands","dataSource"],this.columns),this.addOnPersist(e)},u.prototype.ignoreInArrays=function(e,t){for(var i=0;i<t.length;i++)t[parseInt(i.toString(),10)].columns?(this.ignoreInColumn(e,t[parseInt(i.toString(),10)]),this.ignoreInArrays(e,t[parseInt(i.toString(),10)].columns)):this.ignoreInColumn(e,t[parseInt(i.toString(),10)])},u.prototype.ignoreInColumn=function(e,t){if(C.isNullOrUndefined(t.template))for(var i=0;i<e.length;i++)delete t[e[parseInt(i.toString(),10)]],t.filter={}},u.prototype.mouseClickHandler=function(e){var t,i=this;C.isNullOrUndefined(e.touches)&&(!(e=e.target).classList.contains("e-treegridexpand")&&!e.classList.contains("e-treegridcollapse")||this.isEditCollapse||this.grid.isEdit||this.expandCollapseRequest(e),(e.classList.contains("e-treegridexpand")||e.classList.contains("e-treegridcollapse"))&&this.grid.isEllipsisTooltip()&&this.grid.toolTipObj.close(),this.isEditCollapse=!1,this.notify("checkboxSelection",{target:e}),this.grid.isCheckBoxSelection&&!this.grid.isPersistSelection&&this.aggregates.map(function(e){return!0===e.showChildSummary}).length&&(t=this.grid.getHeaderContent().querySelector(".e-checkselectall"),this.grid.getSelectedRowIndexes().length===this.getCurrentViewRecords().length)&&(t=t.nextElementSibling,C.removeClass([t],["e-stop","e-uncheck"]),C.addClass([t],["e-check"])),e.classList.contains("e-flmenu-cancelbtn")||e.classList.contains("e-flmenu-okbtn")||e.classList.contains("e-content")||e.classList.contains("e-rowcell"))&&!C.isNullOrUndefined(this.filterModule)&&this.isReact&&!C.isNullOrUndefined(this.grid.filterModule.column)&&this.grid.filterModule.column.filterTemplate&&(t=document.getElementById(this.grid.filterModule.filterModule.dlgObj.element.id),this.grid.filterModule.fltrDlgDetails.isOpen=!1,this.grid.filterModule.filterModule.dlgObj)&&!this.grid.filterModule.filterModule.dlgObj.isDestroyed&&t&&this.clearTemplate(["filterTemplate"],void 0,function(){i.grid.filterModule.filterModule.dlgObj.destroy()})},u.prototype.getRows=function(){return this.grid.getRows()},u.prototype.getPager=function(){return this.grid.getPager()},u.prototype.addRecord=function(e,t,i){this.editModule&&(this.editModule.isAddedRowByMethod=!0,this.editModule.addRecord(e,t,i))},u.prototype.closeEdit=function(){this.grid.editModule&&this.grid.editModule.closeEdit()},u.prototype.saveCell=function(){this.grid.editModule&&this.grid.editModule.saveCell()},u.prototype.updateCell=function(e,t,i){this.grid.editModule&&this.grid.editModule.updateCell(e,t,i)},u.prototype.updateRow=function(e,t){var i;this.grid.editModule&&(C.isNullOrUndefined(e)?this.grid.editModule.updateRow(e,t):(i=this.grid.getCurrentViewRecords()[parseInt(e.toString(),10)],C.extend(i,t),this.grid.editModule.updateRow(e,i)))},u.prototype.deleteRecord=function(e,t){(C.isNullOrUndefined(e)&&C.isNullOrUndefined(t)||this.getSelectedRecords().length<=0)&&this.trigger(d,{error:"The provided value for the fieldName and data is undefined. Please ensure the fieldName and data contains number."}),this.grid.editModule&&this.grid.editModule.deleteRecord(e,t)},u.prototype.startEdit=function(e){this.grid.editModule&&this.grid.editModule.startEdit(e)},u.prototype.editCell=function(e,t){this.editModule&&this.editModule.editCell(e,t)},u.prototype.enableToolbarItems=function(e,t){this.grid.toolbarModule&&this.grid.toolbarModule.enableItems(e,t)},u.prototype.endEdit=function(){this.grid.editModule&&this.grid.editModule.endEdit()},u.prototype.openColumnChooser=function(e,t){this.columnChooserModule&&this.columnChooserModule.openColumnChooser(e,t)},u.prototype.deleteRow=function(e){C.isNullOrUndefined(e)&&this.trigger(d,{error:"The provided value for the tr is undefined. Please ensure the tr contains HTMLTableRowElement."}),this.grid.editModule&&this.grid.editModule.deleteRow(e)},u.prototype.getPrimaryKeyFieldNames=function(){return this.grid.getPrimaryKeyFieldNames()},u.prototype.setCellValue=function(e,t,i){this.grid.setCellValue(e,t,i);i=this.grid.getRowIndexByPrimaryKey(e),e=this.getCurrentViewRecords()[parseInt(i.toString(),10)];C.isNullOrUndefined(e)&&this.trigger(d,{error:"The provided value for the record is undefined. Please ensure the record contains ITreeData."}),pi({value:e,action:"edit"},this,this.isSelfReference,e.index,this.grid.selectedRowIndex,t)},u.prototype.setRowData=function(t,e){var i=this.getCurrentViewRecords(),r=this.grid.getPrimaryKeyFieldNames()[0],n={},o=(i.some(function(e){return e[""+r]===t&&(n=e,!0)}),o=n.level,e.level=o,e.index=n.index,e.childRecords=n.childRecords,e.taskData=n.taskData,e.uniqueID=n.uniqueID,e.parentItem=n.parentItem,e.checkboxState=n.checkboxState,e.hasChildRecords=n.hasChildRecords,e.parentUniqueID=n.parentUniqueID,e.expanded=n.expanded,this.grid.setRowData(t,e),this.getVisibleRecords());0<o.length&&t===o[o.length-1][""+r]&&(e=this.getContentTable().scrollHeight,o=this.getContent().clientHeight,this.lastRowBorder(this.getRows()[i.indexOf(n)],e<=o))},u.prototype.goToPage=function(e){C.isNullOrUndefined(e)&&this.trigger(d,{error:"The provided value for the pageNo is undefined. Please ensure the pageNo contains number."}),this.grid.pagerModule&&this.grid.pagerModule.goToPage(e)},u.prototype.updateExternalMessage=function(e){this.pagerModule&&this.grid.pagerModule.updateExternalMessage(e)},u.prototype.getCellFromIndex=function(e,t){return this.grid.getCellFromIndex(e,t)},u.prototype.getColumnByField=function(t){return I.iterateArrayOrObject(this.columnModel,function(e){if(e.field===t)return e})[0]},u.prototype.getColumnByUid=function(t){var e=(this.initialRender?this.grid:this).columns;return this.grid.columns.length!==this.columnModel.length&&(e=this.grid.columnModel),I.iterateArrayOrObject(e,function(e){if(e.uid===t)return e})[0]},u.prototype.getColumnFieldNames=function(){return this.grid.getColumnFieldNames()},u.prototype.getFooterContent=function(){return this.grid.getFooterContent()},u.prototype.getFooterContentTable=function(){return this.grid.getFooterContentTable()},u.prototype.showColumns=function(e,t){this.grid.showColumns(e,t),this.updateColumnModel()},u.prototype.hideColumns=function(e,t){C.isNullOrUndefined(e)&&this.trigger(d,{error:"The provided value for the keys is undefined. Please ensure the keys contains string."}),this.grid.hideColumns(e,t),this.updateColumnModel()},u.prototype.getColumnHeaderByField=function(e){return this.grid.getColumnHeaderByField(e)},u.prototype.getColumnHeaderByIndex=function(e){return this.grid.getColumnHeaderByIndex(e)},u.prototype.getColumnHeaderByUid=function(e){return this.grid.getColumnHeaderByUid(e)},u.prototype.getColumnIndexByField=function(e){return this.grid.getColumnIndexByField(e)},u.prototype.getVirtualColIndexByUid=function(i){var e=I.iterateArrayOrObject(this.grid.columnModel,function(e,t){if(e.uid===i)return t})[0];return C.isNullOrUndefined(e)?-1:e},u.prototype.getColumnIndexByUid=function(e){return this.grid.getColumnIndexByUid(e)},u.prototype.getColumns=function(e){return this.updateColumnModel(this.grid.getColumns(e)),this.columnModel},u.prototype.updateColumnModel=function(e){var t,i,r=C.isNullOrUndefined(e)?this.grid.getColumns():e;if(-1!==this.treeColumnIndex&&this.columnModel[this.treeColumnIndex]&&!C.isNullOrUndefined(this.columnModel[this.treeColumnIndex].template)&&(t=this.columnModel[this.treeColumnIndex].template,i=this.columnModel[this.treeColumnIndex].field),!this.enableColumnVirtualization||this.enableColumnVirtualization&&this.columnModel.length===r.length){this.columnModel=[];for(var n=0;n<r.length;n++){for(var o={},a=0,s=Object.keys(r[parseInt(n.toString(),10)]);a<s.length;a++){var d=s[a];o[""+d]=r[parseInt(n.toString(),10)][""+d]}this.columnModel.push(new j(o)),i!==this.columnModel[parseInt(n.toString(),10)].field||"checkbox"===this.columnModel[parseInt(n.toString(),10)].type||C.isNullOrUndefined(t)||""===t||(this.columnModel[parseInt(n.toString(),10)].template=t)}}e="deepMerge";return this[e]=["columns"],this.grid.columns.length!==this.columnModel.length&&(this.stackedHeader=!0),this.stackedHeader&&this.allowResizing&&!C.isNullOrUndefined(this.columns)&&this.updateColumnsWidth(this.columns),this.stackedHeader||C.isNullOrUndefined(this.columns)||C.merge(this.columns,this.columnModel),this[e]=void 0,this.columnModel},u.prototype.updateColumnsWidth=function(e){var i=this;e.forEach(function(e){var t;!C.isNullOrUndefined(e)&&e.columns?i.updateColumnsWidth(e.columns):!C.isNullOrUndefined(e)&&e.field&&(t=i.grid.getColumnByField(e.field),C.isNullOrUndefined(t)||(e.width=t.width))})},u.prototype.getContent=function(){return this.grid.getContent()},u.prototype.mergePersistTreeGridData=function(){this.grid.mergePersistGridData.apply(this)},u.prototype.mergeColumns=function(e,t){this.grid.mergeColumns.apply(this,[e,t])},u.prototype.setFrozenCount=function(){this.grid.setFrozenCount.apply(this.grid)},u.prototype.splitFrozenCount=function(e){this.grid.splitFrozenCount.apply(this.grid,[e])},u.prototype.isFrozenGrid=function(){return this.grid.isFrozenGrid()},u.prototype.updateTreeGridModel=function(){this.setProperties({filterSettings:I.getObject("properties",this.grid.filterSettings)},!0),this.setProperties({pageSettings:I.getObject("properties",this.grid.pageSettings)},!0),this.setProperties({searchSettings:I.getObject("properties",this.grid.searchSettings)},!0),this.setProperties({sortSettings:I.getObject("properties",this.grid.sortSettings)},!0)},u.prototype.getContentTable=function(){return this.grid.getContentTable()},u.prototype.getDataRows=function(){for(var e=[],t=this.grid.getDataRows(),i=0,r=t.length;i<r;i++)t[parseInt(i.toString(),10)].classList.contains("e-summaryrow")||e.push(t[parseInt(i.toString(),10)]);return e},u.prototype.getCurrentViewRecords=function(){return this.grid.currentViewData.filter(function(e){return C.isNullOrUndefined(e.isSummaryRow)})},u.prototype.getBatchChanges=function(){return this.grid.editModule.getBatchChanges()},u.prototype.getHeaderContent=function(){return this.grid.getHeaderContent()},u.prototype.getHeaderTable=function(){return this.grid.getHeaderTable()},u.prototype.getRowByIndex=function(e){return this.grid.getRowByIndex(e)},u.prototype.getRowInfo=function(e){return this.grid.getRowInfo(e)},u.prototype.getUidByColumnField=function(e){return this.grid.getUidByColumnField(e)},u.prototype.getVisibleColumns=function(){for(var e=[],t=0,i=this.columnModel;t<i.length;t++){var r=i[t];r.visible&&e.push(r)}return e},u.prototype.showSpinner=function(){V.showSpinner(this.element)},u.prototype.hideSpinner=function(){V.hideSpinner(this.element)},u.prototype.refresh=function(){this.uniqueIDCollection={},this.convertTreeData(this.dataSource),w(this)||(this.dataSource instanceof b.DataManager?this.grid.setProperties({dataSource:new b.DataManager(this.dataSource.dataSource,this.dataSource.defaultQuery,this.dataSource.adaptor)},!0):this.grid.dataSource=this.flatData),this.grid.refresh()},u.prototype.getCheckedRecords=function(){return this.selectionModule.getCheckedrecords()},u.prototype.getVisibleRecords=function(){var e=[],t=this.getCurrentViewRecords();if(this.allowPaging)e=t;else for(var i=0;i<t.length;i++)e.push(t[parseInt(i.toString(),10)]),t[parseInt(i.toString(),10)].expanded||(i+=R(t[parseInt(i.toString(),10)]).length);return e},u.prototype.getCheckedRowIndexes=function(){return this.selectionModule.getCheckedRowIndexes()},u.prototype.selectCheckboxes=function(e){this.selectionModule.selectCheckboxes(e)},u.prototype.refreshColumns=function(e){C.isNullOrUndefined(e)||e?(this.grid.columns=this.getGridColumns(this.columns),this.grid.refreshColumns()):this.grid.setProperties({columns:this.getGridColumns(this.columns)},!0)},u.prototype.refreshHeader=function(){this.grid.refreshHeader()},u.prototype.expandCollapseRequest=function(e){if("Batch"===this.editSettings.mode)if((this.getBatchChanges()[this.changedRecords].length||this.getBatchChanges()[this.deletedRecords].length||this.getBatchChanges()[this.addedRecords].length)&&this.editSettings.showConfirmDialog)return t=this.grid.editModule.dialogObj,this.grid.editModule.showDialog("CancelEdit",t),void(this.targetElement=e);var t,i,r;this.rowTemplate?(t=e.closest(".e-treerowcell").parentElement,r=this.getCurrentViewRecords()[t.rowIndex],e.classList.contains("e-treegridexpand")?this.collapseRow(t,r):this.expandRow(t,r)):(r=(i=this.grid.getRowInfo(e)).rowData,this.grid.isFrozenGrid()&&this.enableVirtualization&&!Object.keys(r).length&&(r=this.grid.contentModule.freezeRows.filter(function(e){return e.uid===i.row.getAttribute("data-uid")})[0].data),this.enableImmutableMode&&(r=this.getCurrentViewRecords()[i.rowIndex]),e.classList.contains("e-treegridexpand")?this.collapseRow(i.row,r):this.expandRow(i.row,r))},u.prototype.expandRow=function(t,i,r,n){var e,o,a=this,s=(this.isCollapseAll=!1,C.isNullOrUndefined(t)&&C.isNullOrUndefined(i)&&C.isNullOrUndefined(r)&&C.isNullOrUndefined(n)&&this.trigger(d,{error:"The provided value for the row is undefined. Please ensure the row contains row element."}),this.parentData);this.enableVirtualization||(s=this.flatData.filter(function(e){return e.hasChildRecords})),i=this.getCollapseExpandRecords(t,i),!C.isNullOrUndefined(t)&&t.cells[0].classList.contains("e-lastrowcell")&&this.lastRowBorder(t,!1),this.isExpandAll&&!S(this)?(e=!(o={data:s,row:t,cancel:!1}),this.grid.pagerModule&&!C.isNullOrUndefined(this.grid.pagerModule.pagerObj.pagerdropdownModule)&&(e=!!this.grid.pagerModule.pagerObj.pagerdropdownModule.dropDownListObject.value),this.isExpandingEventTriggered?(!this.allowPaging||e&&"All"===this.grid.pagerModule.pagerObj.pagerdropdownModule.dropDownListObject.value)&&!this.expandAllPrevent&&this.isExpandingEventTriggered&&this.expandRows(t,i,s):this.trigger(ke,o,function(e){a.expandAllPrevent=e.cancel,e.cancel||C.isNullOrUndefined(i)||(e.expandAll&&a.expandCollapseAllChildren(i,"expand",r,n),a.expandRows(t,i,s))}),this.isExpandingEventTriggered=!0):(!this.isExpandAll||this.isExpandAll&&S(this))&&(o={data:i,row:t,cancel:!1},this.trigger(ke,o,function(e){e.cancel||(e.expandAll&&a.expandCollapseAllChildren(i,"expand",r,n),a.expandRows(t,i,s))}))},u.prototype.expandRows=function(e,t,i){this.expandCollapse("expand",e,t);S(this)&&!v(this)||w(this)&&C.isNullOrUndefined(t.Children)||(t={data:t,row:e},C.isNullOrUndefined(this.expandStateMapping)||this.updateExpandStateMapping(t.data,!0),this.isExpandAll&&!this.isExpandedEventTriggered?(this.isExpandedEventTriggered=!0,this.trigger(Ue,t={data:i,row:e})):!this.isExpandAll&&this.enableVirtualization&&this.selectionSettings.persistSelection&&!C.isNullOrUndefined(this.virtualScrollModule.prevSelectedRecord)?this.virtualScrollModule.prevSelectedRecord=[]:this.isExpandAll||this.trigger(Ue,t))},u.prototype.expandCollapseAllChildren=function(e,t,i,r){if((C.isNullOrUndefined(i)||e[this.getPrimaryKeyFieldNames()[0]]===i)&&(C.isNullOrUndefined(r)||r===e.level)){var n=R(e).filter(function(e){return e.hasChildRecords});n.unshift(e);for(var o=0;o<n.length;o++)this.expandCollapse(t,null,n[parseInt(o.toString(),10)])}},u.prototype.getCollapseExpandRecords=function(e,t){return this.allowPaging&&"All"===this.pageSettings.pageSizeMode&&this.isExpandAll&&C.isNullOrUndefined(t)&&!S(this)?t=this.flatData.filter(function(e){return e.hasChildRecords}):C.isNullOrUndefined(t)&&!C.isNullOrUndefined(e)&&(t=this.detailTemplate?this.grid.getCurrentViewRecords()[e.getAttribute("data-rowindex")]:this.enableVirtualization&&(this.isCollapseAll||this.isExpandAll)?-1===e.rowIndex?this.grid.getCurrentViewRecords()[parseInt(e.getAttribute("data-rowindex"),10)]:this.grid.getCurrentViewRecords()[e.rowIndex]:this.rowTemplate?this.grid.getCurrentViewRecords()[e.rowIndex]:this.grid.getCurrentViewRecords()[parseInt(e.getAttribute("data-rowindex"),10)]),t},u.prototype.collapseRow=function(t,i,r){var e,n=this,o=(this.isExpandAll=!1,C.isNullOrUndefined(t)&&C.isNullOrUndefined(i)&&C.isNullOrUndefined(r)&&this.trigger(d,{error:"The provided value for the row is undefined. Please ensure the row contains row element."}),this.parentData);this.enableVirtualization||(o=this.flatData.filter(function(e){return e.hasChildRecords})),i=this.getCollapseExpandRecords(t,i),this.isCollapseAll&&!S(this)?(e={data:o,row:t,cancel:!1},this.isCollapsingEventTriggered?this.allowPaging||this.collapseAllPrevent||!this.isCollapsingEventTriggered||this.collapseRows(t,i,o):this.trigger(Te,e,function(e){n.collapseAllPrevent=e.cancel,e.cancel||(e.collapseAll&&n.expandCollapseAllChildren(i,"collapse",r),n.collapseRows(t,i,o))}),this.isCollapsingEventTriggered=!0):(!this.isCollapseAll||this.isCollapseAll&&S(this))&&(e={data:i,row:t,cancel:!1},this.trigger(Te,e,function(e){e.cancel||C.isNullOrUndefined(i)||n.collapseRows(t,i,o)}))},u.prototype.collapseRows=function(e,t,i){this.expandCollapse("collapse",e,t);t={data:t,row:e};S(this)||(C.isNullOrUndefined(this.expandStateMapping)||this.updateExpandStateMapping(t.data,!1),this.isCollapseAll&&!this.isCollapsedEventTriggered?(this.isCollapsedEventTriggered=!0,this.trigger(qe,t={data:i,row:e})):this.isCollapseAll||this.trigger(qe,t),this.enableInfiniteScrolling&&this.grid.getContent().firstElementChild.scrollHeight-this.grid.getContent().firstElementChild.scrollTop<this.grid.getRowHeight()+ +this.height&&this.grid.getContent().firstElementChild.scrollBy(0,this.grid.getRowHeight()))},u.prototype.updateExpandStateMapping=function(e,t){var i=e;if(i.length)for(var r=0;r<i.length;r++)i[parseInt(r.toString(),10)][this.expandStateMapping]=t,pi({value:i[parseInt(r.toString(),10)],action:"edit"},this,this.isSelfReference,i[parseInt(r.toString(),10)].index,this.grid.selectedRowIndex,this.expandStateMapping);else e[""+this.expandStateMapping]=t,pi({value:e,action:"edit"},this,this.isSelfReference,e.index,this.grid.selectedRowIndex,this.expandStateMapping)},u.prototype.expandAtLevel=function(t){var e;C.isNullOrUndefined(t)&&this.trigger(d,{error:"The provided value for the level is undefined. Please ensure the level contains number."}),(this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)&&!S(this)?(e=this.grid.dataSource.filter(function(e){return e.hasChildRecords&&e.level===t&&(e.expanded=!0),e.hasChildRecords&&e.level===t}),this.expandAction(e,null,t,!0)):(e=this.getRecordDetails(t),e=I.getObject("records",e),this.expandAction(e,null,t))},u.prototype.expandByKey=function(e){C.isNullOrUndefined(e)&&this.trigger(d,{error:"The provided value for the key is undefined. Please ensure the key contains number."}),this.expandCollapseActionByKey(e,"Expand")},u.prototype.expandAction=function(r,n,o,a){void 0===a&&(a=!1);for(var s=this,e=0;e<r.length;e++)!function(e){var t,i;C.isNullOrUndefined(r[parseInt(e.toString(),10)].parentItem)||(t=r[parseInt(e.toString(),10)].parentItem.uniqueID,i=s.flatData.filter(function(e){return e.uniqueID===t}),!1===(i=S(s)?s.getCurrentViewRecords().filter(function(e){return e.uniqueID===t}):i)[0].expanded?(r.push(i[0]),i[0].expanded=!0):y(s,i[0],s.parentData)||i[0].expanded&&void 0!==i[0].parentItem&&r.push(i[0])),a||s.expandRow(null,r[parseInt(e.toString(),10)],n,o)}(e);a&&this.expandRow(null,r,n,o)},u.prototype.getRecordDetails=function(t){var e=this.getRows().filter(function(e){return-1!==e.className.indexOf("level"+t)&&(e.querySelector(".e-treegridcollapse")||e.querySelector(".e-treegridexpand"))});return{records:this.getCurrentViewRecords().filter(function(e){return e.level===t&&e.hasChildRecords}),rows:e}},u.prototype.collapseAtLevel=function(t){var e;C.isNullOrUndefined(t)&&this.trigger(d,{error:"The provided value for the level is undefined. Please ensure the level contains number."}),(this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)&&!S(this)?(e=this.grid.dataSource.filter(function(e){return e.hasChildRecords&&e.level===t&&(e.expanded=!1),e.hasChildRecords&&e.level===t}),this.collapseAction(e,null,!0)):(e=this.getRecordDetails(t),e=I.getObject("records",e),this.collapseAction(e))},u.prototype.collapseByKey=function(e){C.isNullOrUndefined(e)&&this.trigger(d,{error:"The provided value for the key is undefined. Please ensure the key contains number."}),this.expandCollapseActionByKey(e,"Collapse")},u.prototype.expandCollapseActionByKey=function(t,e){var i=this.getPrimaryKeyFieldNames()[0],r=S(this)?this.getCurrentViewRecords():this.grid.dataSource;C.isNullOrUndefined(i)||(r=r.filter(function(e){return e[""+i].toString()===t.toString()}),"Expand"===e?this.expandAction(r,t,null):this.collapseAction(r,t))},u.prototype.collapseAction=function(e,t,i){if(i=void 0===i?!1:i)this.collapseRow(null,e);else for(var r=0;r<e.length;r++)this.collapseRow(null,e[parseInt(r.toString(),10)],t);!this.grid.contentModule.isDataSourceChanged&&this.enableVirtualization&&this.getRows()&&this.parentData.length===this.getRows().length&&(this.grid.contentModule.startIndex=-1,this.grid.contentModule.endIndex=-1)},u.prototype.expandAll=function(){0===this.getCurrentViewRecords().length&&this.trigger(d,{error:"The provided value for the datasource is undefined. Please ensure to add the dataSource."}),this.isExpandedEventTriggered=!1,this.isExpandingEventTriggered=!1,this.expandCollapseAll("expand")},u.prototype.collapseAll=function(){0===this.getCurrentViewRecords().length&&this.trigger(d,{error:"The provided value for the datasource is undefined. Please ensure to add the dataSource."}),this.isCollapsedEventTriggered=!1,this.isCollapsingEventTriggered=!1,this.expandCollapseAll("collapse")},u.prototype.expandCollapseAll=function(t){var e,i=this.rowTemplate?[].slice.call(this.grid.getContentTable().querySelectorAll("tr")).filter(function(e){return e.querySelector(".e-treegrid"+("expand"===t?"collapse":"expand"))}):this.getRows().filter(function(e){return e.querySelector(".e-treegrid"+("expand"===t?"collapse":"expand"))});if(!i.length&&this.getRows().length&&i.push(this.getRows()[0]),this.isExpandAll=!0,this.isCollapseAll=!0,(this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization||this.enableInfiniteScrolling)&&!S(this))if(this.flatData.filter(function(e){e.hasChildRecords&&(e.expanded="collapse"!==t)}),i.length)for(var r=0;r<i.length;r++)"collapse"===t?C.isNullOrUndefined(this.getCurrentViewRecords()[i[parseInt(r.toString(),10)].rowIndex])||this.collapseRow(i[parseInt(r.toString(),10)]):this.enableVirtualization?"true"!==i[0].getAttribute("aria-expanded")&&this.expandRow(i[0]):this.expandRow(i[parseInt(r.toString(),10)]);else this.allowPaging&&(e=this.enableCollapseAll,this.setProperties({enableCollapseAll:!0},!0),this.grid.pagerModule.goToPage(1),this.setProperties({enableCollapseAll:e},!0));else for(r=0;r<i.length;r++)"collapse"===t?this.collapseRow(i[parseInt(r.toString(),10)]):this.expandRow(i[parseInt(r.toString(),10)]);this.isExpandAll=!1,this.isCollapseAll=!1},u.prototype.expandCollapse=function(e,t,i,r){var n,o=this,a={row:t,data:i,childData:[],requestType:e},a=(C.isNullOrUndefined(i)||(d=this.grid.currentViewData.filter(function(e){return e.parentUniqueID===i.uniqueID})),(!S(this)&&"expand"===e&&this.isSelfReference&&w(this)&&!d.length||"collapse"===e||this.isExpandAll&&this.loadChildOnDemand&&!S(this)&&this.isSelfReference&&w(this))&&this.updateChildOnDemand(a),this.getRows());if(this.rowTemplate&&(p=this.getContentTable().rows,a=[].slice.call(p)),C.isNullOrUndefined(t)?(s=this.grid.currentViewData.indexOf(i),t=a[parseInt(s.toString(),10)]):s=+t.getAttribute("data-rowindex"),C.isNullOrUndefined(t)||t.setAttribute("aria-expanded","expand"===e?"true":"false"),!(this.allowPaging&&"All"===this.pageSettings.pageSizeMode||this.enableVirtualization)||S(this)||w(this)){var s=void 0;if("expand"===e){if(s="table-row",r||C.isNullOrUndefined(i)||(i.expanded=!0,this.uniqueIDCollection[i.uniqueID].expanded=i.expanded),C.isNullOrUndefined(t)||(n=t.getElementsByClassName("e-treegridcollapse")[0]),r&&!C.isNullOrUndefined(i[this.expandStateMapping])&&i[this.expandStateMapping]&&C.isNullOrUndefined(n)&&(n=t.getElementsByClassName("e-treegridexpand")[0]),C.isNullOrUndefined(n))return;n.classList.contains("e-treegridexpand")||C.addClass([n],"e-treegridexpand"),C.removeClass([n],"e-treegridcollapse")}else{if(s="none",r&&!w(this)||C.isNullOrUndefined(t)||(i.expanded=!1,this.uniqueIDCollection[i.uniqueID].expanded=i.expanded),C.isNullOrUndefined(t)||(n=t.getElementsByClassName("e-treegridexpand")[0]),r&&!C.isNullOrUndefined(i[this.expandStateMapping])&&!i[this.expandStateMapping]&&C.isNullOrUndefined(n)&&(n=t.getElementsByClassName("e-treegridcollapse")[0]),C.isNullOrUndefined(n))return;n.classList.contains("e-treegridcollapse")||C.addClass([n],"e-treegridcollapse"),C.removeClass([n],"e-treegridexpand")}t.querySelectorAll(".e-treerowcell")[0].setAttribute("aria-expanded","expand"===e?"true":"false");var d,r=a.filter(function(e){return e.classList.contains("e-griddetailrowindex"+i.index+"level"+(i.level+1))});if(S(this)&&!v(this)?this.remoteExpand(e,t,i):(w(this)&&!d.length&&"collapse"!==e||this.localExpand(e,t,i),d=this.getVisibleRecords()[this.getVisibleRecords().length-1].index,d=this.getRowByIndex(d),this.grid.getContentTable().clientHeight<=this.grid.getContent().clientHeight&&!C.isNullOrUndefined(d)&&!d.cells[0].classList.contains("e-lastrowcell")&&this.lastRowBorder(d,!0)),w(this)&&"expand"===e&&(d=this.getCurrentViewRecords().filter(function(e){return y(o,e,o.parentData)}),this.dataResults.result=d),!C.isNullOrUndefined(n)&&n.closest(".e-treerowcell").classList.contains("e-cellselectionbackground")&&(n.closest(".e-treerowcell").classList.remove("e-cellselectionbackground"),n.closest(".e-treerowcell").removeAttribute("aria-selected")),this.isPixelHeight()&&!t.cells[0].classList.contains("e-lastrowcell")){this.getRows();for(var l,p=this.getContentTable().rows,h=(l=[].slice.call(p)).length-1;0<=h;h--)if(!Ut(l[parseInt(h.toString(),10)])){var c=this.getContentTable().scrollHeight,u=this.getContent().clientHeight;this.lastRowBorder(l[parseInt(h.toString(),10)],c<=u);break}}this.notify("rowExpandCollapse",{detailrows:r,action:s,record:i,row:t}),this.updateAltRow(a)}else this.notify(Be,{action:e,row:t,record:i})},u.prototype.updateChildOnDemand=function(d){var l=this;if("collapse"===d.requestType&&w(this)){for(var e=this.flatData.slice(),t=0;t<e.length;t++)e[parseInt(t.toString(),10)].parentUniqueID===d.data.uniqueID&&(e.splice(t,1),t-=1);this.dataResults.result=e}else{var i=new b.Deferred,p=(d.childDataBind=i.resolve,d.data);this.trigger(xe,d),i.promise.then(function(){if(d.childData.length){w(l)&&(l.flatData=l.dataResults.result),l.enableInfiniteScrolling&&w(l)&&(l.flatData=l.infiniteScrollData);for(var e=l.flatData,t=0,i=0;i<e.length;i++)if(e[parseInt(i.toString(),10)].taskData===p.taskData){t=i;break}for(var r=C.getValue("result",l.dataSource),n=D(d.childData),o=(p[l.childMapping]&&p[l.childMapping].length>n.length?p[l.childMapping]:n).length,i=0;i<o;i++)p[l.childMapping]&&r.filter(function(e,t){e[l.parentIdMapping]===p[l.idMapping]&&r.splice(t,1)}),n[parseInt(i.toString(),10)]?(n[parseInt(i.toString(),10)].level=p.level+1,n[parseInt(i.toString(),10)].index=Math.ceil(1e3*Math.random()),n[parseInt(i.toString(),10)].parentItem=C.extend({},p),n[parseInt(i.toString(),10)].taskData=C.extend({},n[parseInt(i.toString(),10)]),delete n[parseInt(i.toString(),10)].parentItem.childRecords,delete n[parseInt(i.toString(),10)].taskData.parentItem,n[parseInt(i.toString(),10)].parentUniqueID=p.uniqueID,n[parseInt(i.toString(),10)].uniqueID=I.getUid(l.element.id+"_data_"),C.setValue("uniqueIDCollection."+n[parseInt(i.toString(),10)].uniqueID,n[parseInt(i.toString(),10)],l),(!C.isNullOrUndefined(n[parseInt(i.toString(),10)][l.childMapping])||n[parseInt(i.toString(),10)][l.hasChildMapping]&&w(l))&&(n[parseInt(i.toString(),10)].hasChildRecords=!0),w(l)&&p[l.childMapping]&&p[l.childMapping][parseInt(i.toString(),10)]?e.splice(t+1+i,0,n[parseInt(i.toString(),10)]):e.splice(t+1+i,p[l.childMapping]&&p[l.childMapping][parseInt(i.toString(),10)]?1:0,n[parseInt(i.toString(),10)])):e.splice(t+1+i,1);e[parseInt(t.toString(),10)][""+l.childMapping]=n,e[parseInt(t.toString(),10)].childRecords=n,e[parseInt(t.toString(),10)].expanded=!0,C.setValue("uniqueIDCollection."+e[parseInt(t.toString(),10)].uniqueID,e[parseInt(t.toString(),10)],l);for(var a=0;a<d.childData.length;a++)r.push(d.childData[parseInt(a.toString(),10)])}w(l)&&l.loadChildOnDemand&&"expand"===d.requestType&&(l.dataResults.expandRecord={},l.dataResults.expandRecord=d.data),l.isExpandRefresh=!0;var s=l.getContentTable().parentElement.scrollTop;l.grid.refresh(),l.enableInfiniteScrolling&&(l.getContentTable().parentElement.scrollTop=s),l.trigger(Ue,d)})}},u.prototype.remoteExpand=function(e,t,i){var r=this.getRows(),n=(this.rowTemplate&&(n=this.getContentTable().rows,r=[].slice.call(n)),{data:i,row:t}),r=r.filter(function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))||e.querySelector(".e-gridrowindex"+i.index+"level0.e-summarycell")});"expand"===e?(this.notify(Ve,{record:i,rows:r,parentRow:t}),0<r.length&&this.trigger(Ue,{row:t,data:i})):"collapse"===e&&this.enableVirtualization?this.dataModule.fetchRemoteChildData({action:e,record:n.data,rows:null,parentRow:n.row}):(this.collapseRemoteChild({record:i,rows:r}),this.trigger(qe,n))},u.prototype.localExpand=function(e,t,i){var r,n,o=this.grid.currentViewData.filter(function(e){return e.parentUniqueID===i.uniqueID}),a=(this.isPixelHeight()&&t.cells[0].classList.contains("e-lastrowcell")&&this.lastRowBorder(t,!1),this.getRows()),s=(this.rowTemplate&&(t=this.getContentTable().rows,a=[].slice.call(t)),"expand"===e?"table-row":"none"),d=this.getPrimaryKeyFieldNames()[0];if(this.enableImmutableMode&&!this.allowPaging)for(var l=[],p=0;p<o.length;p++){var h=this.grid.getRowIndexByPrimaryKey(o[parseInt(p.toString(),10)][""+d]);l.push(this.getRows()[parseInt(h.toString(),10)])}else l=a.filter(function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))});for(var c,t=0<this.grid.getFrozenLeftColumnsCount()||0<this.grid.getFrozenRightColumnsCount(),u=((this.frozenRows||this.frozenColumns||this.getFrozenColumns()||t)&&(r=this.getRows().filter(function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))})),t&&(n=this.getRows().filter(function(e){return e.querySelector(".e-gridrowindex"+i.index+"level"+(i.level+1))})),this.grid.getRowsObject()),g=this.grid.currentViewData,f=g.filter(function(e){return e.uniqueID===i.uniqueID}),m=g.indexOf(f[0]),y=(C.isNullOrUndefined(u[parseInt(m.toString(),10)].visible)||!1===u[parseInt(m.toString(),10)].visible||(u[parseInt(m.toString(),10)].visible=!0),a.filter(function(e){return e.classList.contains("e-griddetailrowindex"+i.index+"level"+(i.level+1))})),p=0;p<l.length;p++)C.isNullOrUndefined(l[parseInt(p.toString(),10)])||(l[parseInt(p.toString(),10)].style.display=s),C.isNullOrUndefined(l[parseInt(p.toString(),10)])||this.allowPaging||this.enableVirtualization||this.enableInfiniteScrolling||S(this)||w(this)||(u[l[parseInt(p.toString(),10)].rowIndex].visible="none"!=s,c=g.filter(function(e){return e.uniqueID===f[0].parentUniqueID}),!C.isNullOrUndefined(c[0])&&a[g.indexOf(c[0])].getElementsByClassName("e-treegridcollapse").length&&(u[parseInt(m.toString(),10)].visible=!1)),C.isNullOrUndefined(r)||(r[parseInt(p.toString(),10)].style.display=s),C.isNullOrUndefined(n)||(n[parseInt(p.toString(),10)].style.display=s),this.notify("childRowExpand",{row:l[parseInt(p.toString(),10)]}),!C.isNullOrUndefined(o[parseInt(p.toString(),10)].childRecords)&&0<o[parseInt(p.toString(),10)].childRecords.length&&("expand"!==e||C.isNullOrUndefined(o[parseInt(p.toString(),10)].expanded)||o[parseInt(p.toString(),10)].expanded)&&(this.expandCollapse(e,l[parseInt(p.toString(),10)],o[parseInt(p.toString(),10)],!0),this.frozenColumns<=this.treeColumnIndex)&&!C.isNullOrUndefined(r)&&this.expandCollapse(e,r[parseInt(p.toString(),10)],o[parseInt(p.toString(),10)],!0);for(p=0;p<y.length;p++)C.isNullOrUndefined(y[parseInt(p.toString(),10)])||this.allowPaging||this.enableVirtualization||this.enableInfiniteScrolling||S(this)||w(this)||(u[y[parseInt(p.toString(),10)].rowIndex].visible="none"!=s,y[parseInt(p.toString(),10)].style.display=s);this.allowPaging||this.enableVirtualization||this.enableInfiniteScrolling||S(this)||w(this)||this.grid.notify("refresh-Expand-and-Collapse",{rows:this.grid.getRowsObject()})},u.prototype.updateAltRow=function(e){if(this.enableAltRow&&!this.rowTemplate)for(var t=0,i=0;e&&i<e.length;i++){var r=e[parseInt(i.toString(),10)];"none"!==r.style.display&&(r.classList.contains("e-altrow")&&C.removeClass([r],"e-altrow"),t%2==0||r.classList.contains("e-summaryrow")||r.classList.contains("e-detailrow")||C.addClass([r],"e-altrow"),r.classList.contains("e-summaryrow")||r.classList.contains("e-detailrow")||t++)}},u.prototype.treeColumnRowTemplate=function(){for(var e=this.getContentTable().rows,e=[].slice.call(e),t=this.grid.getRowsObject(),i=0;i<e.length;i++){var r=this.grid.getContentTable().rows[parseInt(i.toString(),10)].cells[this.treeColumnIndex],n=e[parseInt(i.toString(),10)],n={data:0!==t.length?t[parseInt(i.toString(),10)].data:new Object,row:n,cell:r,column:this.getColumns()[this.treeColumnIndex]};this.renderModule.cellRender(n)}},u.prototype.collapseRemoteChild=function(t,e){C.isNullOrUndefined(e)||e||this.loadChildOnDemand||(t.record.expanded=!1);var i=t.rows,r=[],n=[],o=0<this.getFrozenLeftColumnsCount()||0<this.getFrozenRightColumnsCount();o&&(r=this.getRows().filter(function(e){return e.querySelector(".e-gridrowindex"+t.record.index+"level"+(t.record.level+1))}),n=this.getRows().filter(function(e){return e.querySelector(".e-gridrowindex"+t.record.index+"level"+(t.record.level+1))}));for(var a=0;a<i.length;a++){i[parseInt(a.toString(),10)].style.display="none";var s=i[parseInt(a.toString(),10)],d=i[parseInt(a.toString(),10)].querySelector(".e-detailrowexpand");if(C.isNullOrUndefined(d)||this.grid.detailRowModule.collapse(d),o&&(r[parseInt(a.toString(),10)].style.display="none",n[parseInt(a.toString(),10)].style.display="none",i[parseInt(a.toString(),10)].querySelector(".e-treecolumn-container .e-treegridexpand")||(r[parseInt(a.toString(),10)].querySelector(".e-treecolumn-container .e-treegridexpand")?s=r[parseInt(a.toString(),10)]:n[parseInt(a.toString(),10)].querySelector(".e-treecolumn-container .e-treegridexpand")&&(s=n[parseInt(a.toString(),10)]))),s.querySelector(".e-treecolumn-container .e-treegridexpand")){var d=s.querySelector(".e-treecolumn-container .e-treegridexpand"),l=this.rowTemplate?this.grid.getCurrentViewRecords()[i[parseInt(a.toString(),10)].rowIndex]:this.grid.getRowObjectFromUID(i[parseInt(a.toString(),10)].getAttribute("data-Uid")).data;!C.isNullOrUndefined(d)&&l.expanded&&(C.removeClass([d],"e-treegridexpand"),C.addClass([d],"e-treegridcollapse"));for(var p=[],h=this.getRows(),c=0;c<h.length;c++)h[parseInt(c.toString(),10)].querySelector(".e-gridrowindex"+l.index+"level"+(l.level+1))&&p.push(h[parseInt(c.toString(),10)]);p.length&&l.expanded&&this.collapseRemoteChild({record:l,rows:p},!1)}}},u.prototype.sanitize=function(e){return this.enableHtmlSanitizer&&"string"==typeof e?C.SanitizeHtmlHelper.sanitize(e):e},u.prototype.updateRowAndCellElements=function(e,t,i){for(var r=0;r<e.length;r++)this.renderModule.cellRender({data:e[parseInt(r.toString(),10)],cell:t[parseInt(r.toString(),10)].cells[parseInt(i.toString(),10)],column:this.grid.getColumns()[this.treeColumnIndex],requestType:"rowDragAndDrop"}),"indenting"!==this.action&&"outdenting"!==this.action||this.renderModule.RowModifier({data:e[parseInt(r.toString(),10)],row:t[parseInt(r.toString(),10)]})},u.prototype.addListener=function(){this.on("updateResults",this.updateResultModel,this),this.grid.on("initial-end",this.afterGridRender,this)},u.prototype.updateResultModel=function(e){this.dataResults=e},u.prototype.removeListener=function(){this.isDestroyed||(this.off("updateResults",this.updateResultModel),this.grid.off("initial-end",this.afterGridRender))},u.prototype.filterByColumn=function(e,t,i,r,n,o,a,s){C.isNullOrUndefined(e)&&C.isNullOrUndefined(t)&&C.isNullOrUndefined(i)&&this.trigger(d,{error:"The provided value for the fieldName, filterOperator and filterValue are undefined. Please ensure the fieldName, filterOperator and filterValue."}),this.grid.filterByColumn(e,t,i,r,n,o,a,s)},u.prototype.clearFiltering=function(){this.grid.clearFiltering()},u.prototype.removeFilteredColsByField=function(e,t){this.grid.removeFilteredColsByField(e,t)},u.prototype.selectRow=function(e,t){this.grid.selectRow(e,t)},u.prototype.selectRows=function(e){this.grid.selectRows(e)},u.prototype.clearSelection=function(){this.grid.clearSelection()},u.prototype.copy=function(e){this.clipboardModule.copy(e)},u.prototype.paste=function(e,t,i){C.isNullOrUndefined(e)&&C.isNullOrUndefined(t)&&C.isNullOrUndefined(i)&&this.trigger(d,{error:"The provided value for the index is undefined. Please ensure the index contains number."}),this.clipboardModule.paste(e,t,i)},u.prototype.selectCell=function(e,t){this.grid.selectCell(e,t)},u.prototype.getSelectedRows=function(){return this.grid.getSelectedRows()},u.prototype.getMovableCellFromIndex=function(e,t){return this.grid.getCellFromIndex(e,t)},u.prototype.getMovableDataRows=function(){return this.grid.getDataRows()},u.prototype.getMovableRowByIndex=function(e){return this.grid.getRowByIndex(e)},u.prototype.getMovableRows=function(){return this.grid.getRows()},u.prototype.getFrozenRightRowByIndex=function(e){return this.grid.getRowByIndex(e)},u.prototype.getFrozenRightRows=function(){return this.grid.getRows()},u.prototype.getFrozenRightDataRows=function(){return this.grid.getDataRows()},u.prototype.getFrozenRightCellFromIndex=function(e,t){return this.grid.getCellFromIndex(e,t)},u.prototype.getFrozenLeftColumnHeaderByIndex=function(e){return this.grid.getColumnHeaderByIndex(e)},u.prototype.getFrozenRightColumnHeaderByIndex=function(e){return this.grid.getColumnHeaderByIndex(e)},u.prototype.getMovableColumnHeaderByIndex=function(e){return this.grid.getColumnHeaderByIndex(e)},u.prototype.getMovableColumnsCount=function(){return this.grid.getMovableColumnsCount()},u.prototype.getFrozenLeftColumnsCount=function(){return this.grid.getFrozenLeftColumnsCount()},u.prototype.getFrozenRightColumnsCount=function(){return this.grid.getFrozenRightColumnsCount()},u.prototype.getFrozenLeftColumns=function(){return this.updateColumnModel(this.grid.getFrozenLeftColumns()),this.columnModel},u.prototype.getFrozenRightColumns=function(){return this.updateColumnModel(this.grid.getFrozenRightColumns()),this.columnModel},u.prototype.getVisibleMovableCount=function(){return this.grid.getVisibleMovableCount()},u.prototype.getVisibleFrozenRightCount=function(){return this.grid.getVisibleFrozenRightCount()},u.prototype.getVisibleFrozenLeftCount=function(){return this.grid.getVisibleFrozenLeftCount()},u.prototype.getMovableColumns=function(){return this.updateColumnModel(this.grid.getMovableColumns()),this.columnModel},u.prototype.getFrozenColumns=function(){return this.getFrozenCount(!C.isNullOrUndefined(this.columns)&&this.columns,0)+this.frozenColumns},u.prototype.getFrozenCount=function(e,t){for(var i=0,r=e.length;i<r;i++)e[parseInt(i.toString(),10)].columns?t=this.getFrozenCount(e[parseInt(i.toString(),10)].columns,t):e[parseInt(i.toString(),10)].isFrozen&&t++;return t},u.prototype.getSelectedRowIndexes=function(){return this.grid.getSelectedRowIndexes()},u.prototype.getSelectedRowCellIndexes=function(){return this.grid.getSelectedRowCellIndexes()},u.prototype.getSelectedRecords=function(){return this.grid.getSelectedRecords()},u.prototype.getDataModule=function(){return{baseModule:this.grid.getDataModule(),treeModule:this.dataModule}},u.prototype.reorderRows=function(e,t,i){C.isNullOrUndefined(e)&&C.isNullOrUndefined(t)&&C.isNullOrUndefined(i)&&this.trigger(d,{error:"The provided value for the fromIndexes, toIndex and position is undefined. Please ensure the fromIndexes and toIndex contains number and position contains string."}),this.rowDragAndDropModule.reorderRows(e,t,i)},u.prototype.indent=function(e){C.isNullOrUndefined(this.rowDragAndDropModule)||this.rowDragAndDropModule[this.indentOutdentAction](e,"indent")},u.prototype.outdent=function(e){C.isNullOrUndefined(this.rowDragAndDropModule)||this.rowDragAndDropModule[this.indentOutdentAction](e,"outdent")},c([C.Property(0)],u.prototype,"frozenRows",void 0),c([C.Property(0)],u.prototype,"frozenColumns",void 0),c([C.Property("Ellipsis")],u.prototype,"clipMode",void 0),c([C.Property([])],u.prototype,"columns",void 0),c([C.Property(null)],u.prototype,"childMapping",void 0),c([C.Property(null)],u.prototype,"hasChildMapping",void 0),c([C.Property(0)],u.prototype,"treeColumnIndex",void 0),c([C.Property(null)],u.prototype,"idMapping",void 0),c([C.Property(null)],u.prototype,"parentIdMapping",void 0),c([C.Property(!1)],u.prototype,"enableCollapseAll",void 0),c([C.Property(null)],u.prototype,"expandStateMapping",void 0),c([C.Property(!1)],u.prototype,"allowRowDragAndDrop",void 0),c([C.Property([])],u.prototype,"dataSource",void 0),c([C.Property()],u.prototype,"query",void 0),c([C.Property()],u.prototype,"cloneQuery",void 0),c([C.Property("AllPages")],u.prototype,"printMode",void 0),c([C.Property(!1)],u.prototype,"allowPaging",void 0),c([C.Property(!1)],u.prototype,"loadChildOnDemand",void 0),c([C.Property(!1)],u.prototype,"allowTextWrap",void 0),c([C.Complex({},e)],u.prototype,"textWrapSettings",void 0),c([C.Property(!1)],u.prototype,"allowReordering",void 0),c([C.Property(!1)],u.prototype,"allowResizing",void 0),c([C.Property(!1)],u.prototype,"autoCheckHierarchy",void 0),c([C.Complex({},n)],u.prototype,"pageSettings",void 0),c([C.Complex({},I.RowDropSettings)],u.prototype,"rowDropSettings",void 0),c([C.Property("USD")],u.prototype,"currencyCode",void 0),c([C.Property()],u.prototype,"pagerTemplate",void 0),c([C.Property(!1)],u.prototype,"showColumnMenu",void 0),c([C.Property(!1)],u.prototype,"showColumnChooser",void 0),c([C.Property(!1)],u.prototype,"allowSorting",void 0),c([C.Property(!0)],u.prototype,"allowMultiSorting",void 0),c([C.Complex({},p)],u.prototype,"sortSettings",void 0),c([C.Collection([],a)],u.prototype,"aggregates",void 0),c([C.Complex({},s)],u.prototype,"editSettings",void 0),c([C.Property(!1)],u.prototype,"allowFiltering",void 0),c([C.Property()],u.prototype,"detailTemplate",void 0),c([C.Complex({},J)],u.prototype,"filterSettings",void 0),c([C.Complex({},oe)],u.prototype,"searchSettings",void 0),c([C.Property()],u.prototype,"toolbar",void 0),c([C.Property()],u.prototype,"toolbarTemplate",void 0),c([C.Property("Default")],u.prototype,"gridLines",void 0),c([C.Property()],u.prototype,"contextMenuItems",void 0),c([C.Property()],u.prototype,"columnMenuItems",void 0),c([C.Property()],u.prototype,"rowTemplate",void 0),c([C.Property("Parent")],u.prototype,"copyHierarchyMode",void 0),c([C.Property(null)],u.prototype,"rowHeight",void 0),c([C.Property(!0)],u.prototype,"enableAltRow",void 0),c([C.Property(!0)],u.prototype,"allowKeyboard",void 0),c([C.Property(!1)],u.prototype,"enableHover",void 0),c([C.Property(!1)],u.prototype,"enableAutoFill",void 0),c([C.Property(!1)],u.prototype,"enableAdaptiveUI",void 0),c([C.Property(!1)],u.prototype,"enableImmutableMode",void 0),c([C.Property("auto")],u.prototype,"height",void 0),c([C.Property("auto")],u.prototype,"width",void 0),c([C.Complex({},Y)],u.prototype,"loadingIndicator",void 0),c([C.Property(!0)],u.prototype,"enableVirtualMaskRow",void 0),c([C.Property(!1)],u.prototype,"enableVirtualization",void 0),c([C.Property(!1)],u.prototype,"enableColumnVirtualization",void 0),c([C.Property(!1)],u.prototype,"enableHtmlSanitizer",void 0),c([C.Property(!1)],u.prototype,"enableInfiniteScrolling",void 0),c([C.Complex({},oi)],u.prototype,"infiniteScrollSettings",void 0),c([C.Property("All")],u.prototype,"columnQueryMode",void 0),c([C.Event()],u.prototype,"created",void 0),c([C.Event()],u.prototype,"load",void 0),c([C.Event()],u.prototype,"expanding",void 0),c([C.Event()],u.prototype,"expanded",void 0),c([C.Event()],u.prototype,"collapsing",void 0),c([C.Event()],u.prototype,"collapsed",void 0),c([C.Event()],u.prototype,"cellSave",void 0),c([C.Event()],u.prototype,"cellSaved",void 0),c([C.Event()],u.prototype,"actionBegin",void 0),c([C.Event()],u.prototype,"actionComplete",void 0),c([C.Event()],u.prototype,"beginEdit",void 0),c([C.Event()],u.prototype,"batchAdd",void 0),c([C.Event()],u.prototype,"batchDelete",void 0),c([C.Event()],u.prototype,"batchCancel",void 0),c([C.Event()],u.prototype,"beforeBatchAdd",void 0),c([C.Event()],u.prototype,"beforeBatchDelete",void 0),c([C.Event()],u.prototype,"beforeBatchSave",void 0),c([C.Event()],u.prototype,"cellEdit",void 0),c([C.Event()],u.prototype,"actionFailure",void 0),c([C.Event()],u.prototype,"dataBound",void 0),c([C.Event()],u.prototype,"dataSourceChanged",void 0),c([C.Event()],u.prototype,"dataStateChange",void 0),c([C.Event()],u.prototype,"recordDoubleClick",void 0),c([C.Event()],u.prototype,"rowDataBound",void 0),c([C.Event()],u.prototype,"detailDataBound",void 0),c([C.Event()],u.prototype,"queryCellInfo",void 0),c([C.Property(!0)],u.prototype,"allowSelection",void 0),c([C.Event()],u.prototype,"rowSelecting",void 0),c([C.Event()],u.prototype,"rowSelected",void 0),c([C.Event()],u.prototype,"rowDeselecting",void 0),c([C.Event()],u.prototype,"rowDeselected",void 0),c([C.Event()],u.prototype,"headerCellInfo",void 0),c([C.Event()],u.prototype,"cellSelecting",void 0),c([C.Event()],u.prototype,"columnMenuOpen",void 0),c([C.Event()],u.prototype,"columnMenuClick",void 0),c([C.Event()],u.prototype,"cellSelected",void 0),c([C.Event()],u.prototype,"cellDeselecting",void 0),c([C.Event()],u.prototype,"cellDeselected",void 0),c([C.Event()],u.prototype,"resizeStart",void 0),c([C.Event()],u.prototype,"resizing",void 0),c([C.Event()],u.prototype,"resizeStop",void 0),c([C.Event()],u.prototype,"columnDragStart",void 0),c([C.Event()],u.prototype,"columnDrag",void 0),c([C.Event()],u.prototype,"columnDrop",void 0),c([C.Event()],u.prototype,"checkboxChange",void 0),c([C.Event()],u.prototype,"printComplete",void 0),c([C.Event()],u.prototype,"beforePrint",void 0),c([C.Event()],u.prototype,"toolbarClick",void 0),c([C.Event()],u.prototype,"beforeDataBound",void 0),c([C.Event()],u.prototype,"contextMenuOpen",void 0),c([C.Event()],u.prototype,"contextMenuClick",void 0),c([C.Event()],u.prototype,"beforeCopy",void 0),c([C.Event()],u.prototype,"beforePaste",void 0),c([C.Event()],u.prototype,"rowDrag",void 0),c([C.Event()],u.prototype,"rowDragStart",void 0),c([C.Event()],u.prototype,"rowDragStartHelper",void 0),c([C.Event()],u.prototype,"rowDrop",void 0),c([C.Property(-1)],u.prototype,"selectedRowIndex",void 0),c([C.Complex({},zt)],u.prototype,"selectionSettings",void 0),c([C.Property(!1)],u.prototype,"allowExcelExport",void 0),c([C.Property(!1)],u.prototype,"allowPdfExport",void 0),c([C.Event()],u.prototype,"pdfQueryCellInfo",void 0),c([C.Event()],u.prototype,"pdfHeaderQueryCellInfo",void 0),c([C.Event()],u.prototype,"excelQueryCellInfo",void 0),c([C.Event()],u.prototype,"excelHeaderQueryCellInfo",void 0),c([C.Event()],u.prototype,"beforeExcelExport",void 0),c([C.Event()],u.prototype,"excelExportComplete",void 0),c([C.Event()],u.prototype,"beforePdfExport",void 0),c([C.Event()],u.prototype,"pdfExportComplete",void 0),yi=c([C.NotifyPropertyChanges],u));function u(e,t){e=mi.call(this,e,t)||this;e.dataResults={},e.uniqueIDCollection={},e.uniqueIDFilterCollection={},e.changedRecords="changedRecords",e.deletedRecords="deletedRecords",e.addedRecords="addedRecords",e.indentOutdentAction="indentOutdentAction",e.modifiedRecords=[],e.stackedHeader=!1,e.objectEqualityChecker=function(e,t){if(e){for(var i=Object.keys(e),r=!0,n=["Children","childRecords","taskData","uniqueID","parentItem","parentUniqueID","index"],o=0;o<i.length;o++)if(e[i[parseInt(o.toString(),10)]]!==t[i[parseInt(o.toString(),10)]]&&-1===n.indexOf(i[parseInt(o.toString(),10)]))if(!(e[i[parseInt(o.toString(),10)]]instanceof Date&&t[i[parseInt(o.toString(),10)]]instanceof Date)||e[i[parseInt(o.toString(),10)]].getTime()!==t[i[parseInt(o.toString(),10)]].getTime()){r=!1;break}return r}return!1},yi.Inject(kt,ce),C.setValue("mergePersistData",e.mergePersistTreeGridData,e),C.isNullOrUndefined(e.injectedModules.Logger)||I.Grid.Inject(I.Logger),e.injectedModules.filter(function(e){"freeze"===e.prototype.getModuleName()&&I.Grid.Inject(I.Freeze)});return e.grid=new I.Grid,e}Si.prototype.getModuleName=function(){return"reorder"},Si.prototype.addEventListener=function(){this.parent.on("getColumnIndex",this.getTreeColumn,this)},Si.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("getColumnIndex",this.getTreeColumn)},Si.prototype.destroy=function(){this.removeEventListener()},Si.prototype.getTreeColumn=function(){for(var e,t=this.parent.columnModel[this.parent.treeColumnIndex],i=this.parent.getColumns(),r=0;r<i.length;r++)if(I.getObject("field",t)===I.getObject("field",i[parseInt(r.toString(),10)])){e=r;break}this.parent.setProperties({treeColumnIndex:e},!0)};e=Si;function Si(e){I.Grid.Inject(I.Reorder),this.parent=e,this.addEventListener()}wi.prototype.autoFitColumns=function(e){this.parent.grid.autoFitColumns(e)},wi.prototype.getModuleName=function(){return"resize"},wi.prototype.destroy=function(){this.parent.isDestroyed||this.parent.grid.resizeModule.destroy()};c=wi;function wi(e){I.Grid.Inject(I.Resize),this.parent=e}g.prototype.getChildrecordsByParentID=function(t){var e=this.parent.dataSource instanceof b.DataManager&&v(this.parent)?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource;return e.filter(function(e){return e.uniqueID===t})},g.prototype.addEventListener=function(){this.parent.on(It,this.Rowdraging,this),this.parent.on(Rt,this.rowDropped,this),this.parent.on(St,this.rowsAdded,this),this.parent.on(wt,this.rowsRemoved,this)},g.prototype.reorderRows=function(e,t,i){var r=this.parent,n="action",o="updateRowAndCellElements";if(e[0]!==t&&-1!==["above","below","child"].indexOf(i)){"above"===i&&(this.dropPosition="topSegment"),"below"===i&&(this.dropPosition="bottomSegment"),"child"===i&&(this.dropPosition="middleSegment"),this.parent.dropPosition=this.dropPosition;for(var a=[],s=0;s<e.length;s++){var d=this.parent.getRowByIndex(e[parseInt(s.toString(),10)]).rowIndex;a[parseInt(s.toString(),10)]=this.parent.getCurrentViewRecords()[parseInt(d.toString(),10)]}var l,p,h,i={data:a,dropIndex:t};w(this.parent)||this.dropRows(i,!0),r.isLocalData&&(r.flatData=this.orderToIndex(r.flatData)),"outdenting"!==this.parent[n]||C.isNullOrUndefined(a[0].parentItem)||(a[0].level=a[0].parentItem.level+1),this.parent.grid.refresh(),this.parent.enableImmutableMode&&"middleSegment"===this.dropPosition&&(d=void 0,this.parent.allowRowDragAndDrop?d=this.parent.treeColumnIndex+1:"indenting"===this.parent[n]&&(d=this.parent.treeColumnIndex),l=this.parent.getRows()[e[0]],r=i.data[0],h=[],(p=[]).push(r),h.push(l),r=x(this.parent,i.data[0].parentUniqueID),t=this.parent.getRows()[parseInt(t.toString(),10)],p.push(r),h.push(t),this.parent[o](p,h,d)),this.parent.enableImmutableMode&&"outdenting"===this.parent[n]&&(d=void 0,this.parent.allowRowDragAndDrop?d=this.parent.treeColumnIndex+1:"outdenting"===this.parent[n]&&(d=this.parent.treeColumnIndex),r=i.data[0],l=this.parent.getRows()[e[0]],h=[],(p=[]).push(r),h.push(l),this.parent[o](p,h,d))}},g.prototype.indentOutdentAction=function(e,t){var i=this.parent,r="dropIndex",n=-1;if(!C.isNullOrUndefined(e)||-1!==this.parent.selectedRowIndex){this.parent.enableVirtualization&&-1!==this.parent.selectedRowIndex?n=this.parent.getSelectedRows()[0].rowIndex:-1!==this.parent.selectedRowIndex&&(n=this.parent.selectedRowIndex),this.selectedItem=C.isNullOrUndefined(e)?i.getCurrentViewRecords()[parseInt(n.toString(),10)]:e;e=this.parent.getPrimaryKeyFieldNames()[0],e=this.parent.grid.getRowIndexByPrimaryKey(this.selectedItem[""+e]);if(this.selectedRow=this.parent[this.selectedRows]=-1!==n?this.parent.getSelectedRows()[0]:this.parent.grid.getRowByIndex(e),this.selectedRecord=this.parent[this.selectedRecords]=-1!==n?i.getCurrentViewRecords()[parseInt(n.toString(),10)]:this.selectedItem,"indent"===t){var o=i.getCurrentViewRecords()[this.selectedRow.rowIndex-1],a=void 0;if(0!==this.selectedRow.rowIndex&&-1!==this.selectedRow.rowIndex&&i.getCurrentViewRecords()[this.selectedRow.rowIndex].level-o.level!=1){if(o.level>this.selectedRecord.level)for(var s=0;s<i.getCurrentViewRecords().length;s++)i.getCurrentViewRecords()[parseInt(s.toString(),10)].taskData===o.parentItem.taskData&&(a=s,i.enableVirtualization)&&(a=parseInt(i.getRows()[parseInt(s.toString(),10)].getAttribute("data-rowindex"),10));else a=this.selectedRow.rowIndex-1;!this.parent.enableVirtualization||!this.selectedRecord||o.level>this.selectedRecord.level||(a=parseInt(this.selectedRow.getAttribute("data-rowindex"),10)-1),i.action="indenting",i[r]=a,this.eventTrigger("indenting",a)}}else if("outdent"===t&&-1!==this.selectedRow.rowIndex&&0!==this.selectedRow.rowIndex&&0!==i.getCurrentViewRecords()[this.selectedRow.rowIndex].level){for(var a=void 0,d=this.selectedRecord.parentItem,s=0;s<i.getCurrentViewRecords().length;s++)i.getCurrentViewRecords()[parseInt(s.toString(),10)].uniqueID===d.uniqueID&&(a=s);this.parent.enableVirtualization&&this.selectedRecord&&(a=parseInt(this.parent.getRows()[parseInt(a.toString(),10)].getAttribute("data-rowindex"),10)),i.action="outdenting",i[r]=a,this.eventTrigger("outdenting",a)}}},g.prototype.eventTrigger=function(e,t){var i=this,e={action:e,cancel:!1,data:[this.parent[this.selectedRecords]],row:this.parent[this.selectedRows]};this.parent.trigger(ve,e,function(e){e.cancel||("indenting"===e.action?i.parent.enableVirtualization?i.reorderRows([parseInt(i.selectedRow.getAttribute("data-rowindex"),10)],t,"child"):i.reorderRows([i.selectedRow.rowIndex],t,"child"):"outdenting"===e.action&&(i.parent.enableVirtualization?i.reorderRows([parseInt(i.selectedRow.getAttribute("data-rowindex"),10)],t,"below"):i.reorderRows([i.selectedRow.rowIndex],t,"below")))})},g.prototype.orderToIndex=function(e){for(var t,i=0;i<e.length;i++)e[parseInt(i.toString(),10)].index=i,C.isNullOrUndefined(e[parseInt(i.toString(),10)].parentItem)||(t=C.getValue("uniqueIDCollection."+e[parseInt(i.toString(),10)].parentUniqueID,this.parent),e[parseInt(i.toString(),10)].parentItem.index=t.index);return e},g.prototype.rowsAdded=function(e){for(var t,i,r,n=e.records,o=e.records.length-1;-1<o;o--)(r=n[parseInt(o.toString(),10)]).parentUniqueID&&(i=n.filter(function(e){return e.uniqueID===r.parentUniqueID})).length&&(t=i[0].childRecords.indexOf(r),i=i[0],-1!==t)&&(C.isNullOrUndefined(this.parent.idMapping)&&(i.childRecords.splice(t,1),i.childRecords.length||(i.hasChildRecords=!1,i.hasFilteredChildRecords=!1)),this.isDraggedWithChild=!0);if(C.isNullOrUndefined(this.parent.dataSource)||!this.parent.dataSource.length){for(var a,s=this.parent,d=e.records,o=e.records.length-1;-1<o;o--){a=d[parseInt(o.toString(),10)],!o&&a.hasChildRecords&&(a.taskData[this.parent.parentIdMapping]=null);if(C.isNullOrUndefined(s.parentIdMapping)||(s.childMapping=null),C.isNullOrUndefined(a.taskData)||C.isNullOrUndefined(s.childMapping)||Object.prototype.hasOwnProperty.call(a.taskData,s.childMapping)||(a.taskData[s.childMapping]=[]),!C.isNullOrUndefined(a[s.childMapping])&&Object.prototype.hasOwnProperty.call(a,s.childMapping)&&a[s.childMapping].length&&!this.isDraggedWithChild&&!C.isNullOrUndefined(s.parentIdMapping))for(var l=a[s.childMapping],p=0;p<l.length;p++)-1===d.indexOf(l[parseInt(p.toString(),10)])&&(d.splice(p,0,l[parseInt(p.toString(),10)]),l[parseInt(p.toString(),10)].taskData=C.extend({},l[parseInt(p.toString(),10)]),o+=1);Object.prototype.hasOwnProperty.call(a,s.parentIdMapping)&&null!==a[s.parentIdMapping]&&!this.isDraggedWithChild&&(a.taskData[s.parentIdMapping]=null,delete a.parentItem,delete a.parentUniqueID),C.isNullOrUndefined(s.dataSource)&&(s.dataSource=[]),s.dataSource.splice(0,0,a.taskData)}s.setProperties({dataSource:s.dataSource},!1)}else{for(o=0;o<n.length;o++)C.setValue("uniqueIDCollection."+n[parseInt(o.toString(),10)].uniqueID,n[parseInt(o.toString(),10)],this.parent);e={data:e.records,dropIndex:e.toIndex};this.parent.dataSource instanceof b.DataManager?(this.treeGridData=this.parent.dataSource.dataSource.json,this.treeData=this.parent.dataSource.dataSource.json):(this.treeGridData=this.parent.grid.dataSource,this.treeData=this.parent.dataSource),C.isNullOrUndefined(this.dropPosition)&&(this.dropPosition="bottomSegment",e.dropIndex=1<this.parent.getCurrentViewRecords().length?this.parent.getCurrentViewRecords().length-1:e.dropIndex,e.data=e.data.map(function(e){return e.hasChildRecords&&C.isNullOrUndefined(e.parentItem)||(delete e.parentItem,delete e.parentUniqueID),e.level=0,e})),this.dropRows(e)}},g.prototype.rowsRemoved=function(e){for(var t=0;t<e.records.length;t++)this.draggedRecord=e.records[parseInt(t.toString(),10)],(this.draggedRecord.hasChildRecords||this.draggedRecord.parentItem&&-1!==this.parent.grid.dataSource.indexOf(this.getChildrecordsByParentID(this.draggedRecord.parentUniqueID)[0])||0===this.draggedRecord.level)&&this.deleteDragRow()},g.prototype.refreshGridDataSource=function(){var e,t=this.draggedRecord,i=this.droppedRecord,r=this.parent,n=this.parent.dataSource instanceof b.DataManager&&v(this.parent)?r.dataSource.dataSource.json:r.dataSource;if(!n||C.isNullOrUndefined(i)||i.parentItem||C.isNullOrUndefined(i.taskData)){if(!this.parent.parentIdMapping&&!C.isNullOrUndefined(i)&&i.parentItem&&("topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition))for(var o=this.getChildrecordsByParentID(i.parentUniqueID)[0].childRecords,a=0;a<o.length;a++)i.parentItem.taskData[this.parent.childMapping][parseInt(a.toString(),10)]=o[parseInt(a.toString(),10)].taskData}else{for(var s=Object.keys(n),a=0;a<s.length;a++)n[parseInt(a.toString(),10)][this.parent.childMapping]===i.taskData[this.parent.childMapping]&&(e=a);"topSegment"===this.dropPosition?this.parent.idMapping||n.splice(e,0,t.taskData):"bottomSegment"!==this.dropPosition||this.parent.idMapping||n.splice(e+1,0,t.taskData)}this.parent.parentIdMapping&&(t.parentItem?"topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition?(t[this.parent.parentIdMapping]=i[this.parent.parentIdMapping],t.taskData[this.parent.parentIdMapping]=i[this.parent.parentIdMapping]):(t[this.parent.parentIdMapping]=i[this.parent.idMapping],t.taskData[this.parent.parentIdMapping]=i[this.parent.idMapping]):(t.taskData[this.parent.parentIdMapping]=null,t[this.parent.parentIdMapping]=null))},g.prototype.removeFirstrowBorder=function(e){var t="bottomSegment"===this.dropPosition;0<this.parent.element.getElementsByClassName("e-firstrow-border").length&&e&&(0!==e.rowIndex||t)&&this.parent.element.getElementsByClassName("e-firstrow-border")[0].remove()},g.prototype.removeLastrowBorder=function(e){var t=e&&(e.classList.contains("e-emptyrow")||e.classList.contains("e-columnheader")||e.classList.contains("e-detailrow")),t=this.parent.enableVirtualization?e&&!t&&this.parent.getRows()[this.parent.getCurrentViewRecords().length-1].getAttribute("data-uid")!==e.getAttribute("data-uid"):e&&!t&&this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length-1).getAttribute("data-uid")!==e.getAttribute("data-uid"),i=t||"topSegment"===this.dropPosition;0<this.parent.element.getElementsByClassName("e-lastrow-border").length&&e&&(t||i)&&this.parent.element.getElementsByClassName("e-lastrow-border")[0].remove()},g.prototype.updateIcon=function(e,t,i){var r=i.target?C.closest(i.target,"tr"):null,n=(this.dropPosition=void 0,0);this.removeFirstrowBorder(r),this.removeLastrowBorder(r);for(var o=0;o<i.rows.length;o++)(C.isNullOrUndefined(r)||r.getAttribute("data-uid")!==i.rows[parseInt(o.toString(),10)].getAttribute("data-uid"))&&I.parentsUntil(i.target,"e-gridcontent")||(this.dropPosition="Invalid",this.addErrorElem());var a=this.parent,s=0,d=a.toolbar&&a.toolbar.length?document.getElementById(a.element.id+"_gridcontrol_toolbarItems").offsetHeight:0,l=this.getOffset(a.element),l=a.getHeaderContent().offsetHeight+l.top+d,d=a.getContent().firstElementChild.scrollTop;C.isNullOrUndefined(r)||(n=r.offsetTop-d);var a=((s=this.parent.enableVirtualization?r.getBoundingClientRect().top:n+l+0)+e[0].offsetHeight-s)/3,d=s+a,n=d+a,l=n+a,e=I.getObject("originalEvent.event",i),s=I.getObject("originalEvent.event",i),a="mousemove"===e.type?e.pageY:C.isNullOrUndefined(s)||C.isNullOrUndefined(s.changedTouches)?null:s.changedTouches[0].pageY,e=(a=this.parent.enableVirtualization?"mousemove"===e.type?e.clientY:C.isNullOrUndefined(s)||C.isNullOrUndefined(s.changedTouches)?null:s.changedTouches[0].clientY:a)<=d,s=d<a&&a<=n,d=n<a&&a<=l;return(e||s||d)&&(e&&"Invalid"!==this.dropPosition&&(this.removeChildBorder(),this.dropPosition="topSegment",this.removetopOrBottomBorder(),this.addFirstrowBorder(r),this.removeErrorElem(),this.removeLastrowBorder(r),this.topOrBottomBorder(i.target)),s&&"Invalid"!==this.dropPosition&&(this.removetopOrBottomBorder(),n=[],a=C.closest(i.target,"tr"),0<(n=[].slice.call(a.querySelectorAll(".e-rowcell,.e-rowdragdrop,.e-detailrowcollapse"))).length&&this.addRemoveClasses(n,!0,"e-childborder"),this.addLastRowborder(r),this.addFirstrowBorder(r),this.dropPosition="middleSegment"),d)&&"Invalid"!==this.dropPosition&&(this.removeErrorElem(),this.removetopOrBottomBorder(),this.removeChildBorder(),this.dropPosition="bottomSegment",this.addLastRowborder(r),this.removeFirstrowBorder(r),this.topOrBottomBorder(i.target)),this.dropPosition},g.prototype.removeChildBorder=function(){var e;0<(e=[].slice.call(this.parent.element.querySelectorAll(".e-childborder"))).length&&this.addRemoveClasses(e,!1,"e-childborder")},g.prototype.addFirstrowBorder=function(e){var t,i,r=this.parent.element,n=this.parent;e&&0===e.rowIndex&&!e.classList.contains("e-emptyrow")&&(e=this.parent.createElement("div",{className:"e-firstrow-border"}),t=this.parent.getHeaderContent(),i=0,n.toolbar&&(i=n.toolbarModule.getToolbar().offsetHeight),(n=!C.isNullOrUndefined(this.parent.rowDropSettings.targetID))&&(e.style.top=this.parent.grid.element.getElementsByClassName("e-gridheader")[0].offsetHeight+i+"px"),e.style.width=n?r.offsetWidth+"px":r.offsetWidth-this.getScrollWidth()+"px",t.querySelectorAll(".e-firstrow-border").length||t.appendChild(e))},g.prototype.addLastRowborder=function(e){var t=e&&(e.classList.contains("e-emptyrow")||e.classList.contains("e-columnheader")||e.classList.contains("e-detailrow"));e&&!t&&this.parent.getRows()[this.parent.getCurrentViewRecords().length-1].getAttribute("data-uid")===e.getAttribute("data-uid")&&(t=this.parent.createElement("div",{className:"e-lastrow-border"}),e=this.parent.getContent(),t.style.width=this.parent.element.offsetWidth-this.getScrollWidth()+"px",e.querySelectorAll(".e-lastrow-border").length||(e.classList.add("e-treegrid-relative"),e.appendChild(t),t.style.bottom=this.getScrollWidth()+"px"))},g.prototype.getScrollWidth=function(){var e=this.parent.getContent().firstElementChild;return e.scrollWidth>e.offsetWidth?I.Scroll.getScrollBarWidth():0},g.prototype.addErrorElem=function(){var e,t,i,r=document.getElementsByClassName("e-cloneproperties")[0],n="sanitize";r.querySelectorAll(".e-errorelem").length||this.parent.rowDropSettings.targetID||(e=document.createElement("div"),C.classList(e,["e-errorcontainer"],[]),C.classList(e,["e-icons","e-errorelem"],[]),t=r.querySelector(".errorValue"),i=r.querySelector(".e-rowcell").innerHTML,t&&(i=this.parent[n](t.innerHTML),t.parentNode.removeChild(t)),r.querySelector(".e-rowcell").innerHTML="",(t=document.createElement("span")).className="errorValue",t.style.paddingLeft="16px",t.innerHTML=this.parent[n](i),r.querySelector(".e-rowcell").appendChild(e),r.querySelector(".e-rowcell").appendChild(t),n=document.querySelector(".e-dropitemscount"),this.hasDropItem&&n&&(i=parseInt(n.style.left,10)+e.offsetWidth+16,r=this.parent.enableRtl?0:i,n.style.left=r+"px",this.hasDropItem=!1))},g.prototype.removeErrorElem=function(){var e,t=document.querySelector(".e-errorelem"),i=document.querySelector(".errorValue"),r=document.querySelector(".e-dropitemscount");t&&(r&&(e=parseInt(r.style.left,10)-t.offsetWidth-16,C.setStyleAttribute(i,{paddingLeft:"0px"}),this.parent.enableRtl||C.setStyleAttribute(r,{left:e+"px"})),t.remove()),this.hasDropItem=!0},g.prototype.topOrBottomBorder=function(e){var e=C.closest(e,"tr");(e=e?[].slice.call(e.querySelectorAll(".e-rowcell,.e-rowdragdrop,.e-detailrowcollapse")):[]).length&&("topSegment"===this.dropPosition&&(this.addRemoveClasses(e,!0,"e-droptop"),0<this.parent.element.getElementsByClassName("e-lastrow-dragborder").length)&&this.parent.element.getElementsByClassName("e-lastrow-dragborder")[0].remove(),"bottomSegment"===this.dropPosition)&&this.addRemoveClasses(e,!0,"e-dropbottom")},g.prototype.removetopOrBottomBorder=function(){var e;(e=[].slice.call(this.parent.element.querySelectorAll(".e-dropbottom, .e-droptop"))).length&&(this.addRemoveClasses(e,!1,"e-dropbottom"),this.addRemoveClasses(e,!1,"e-droptop"))},g.prototype.addRemoveClasses=function(e,t,i){for(var r=0,n=e.length;r<n;r++)t?e[parseInt(r.toString(),10)].classList.add(i):e[parseInt(r.toString(),10)].classList.remove(i)},g.prototype.getOffset=function(e){var e=e.getBoundingClientRect(),t=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||t.scrollTop,n=window.pageXOffset||i.scrollLeft||t.scrollLeft,o=i.clientTop||t.clientTop||0,i=i.clientLeft||t.clientLeft||0,t=e.top+r-o,r=e.left+n-i;return{top:Math.round(t),left:Math.round(r)}},g.prototype.Rowdraging=function(e){var t,i=this.parent,r=this.parent.element.querySelector(".e-cloneproperties"),n=(r.style.cursor="",e.target?C.closest(e.target,"tr"):null),n=n?n.rowIndex:-1,o=[],a=i.getCurrentViewRecords()[parseInt(n.toString(),10)];this.removeErrorElem(),this.canDrop=!0,e.data[0]?o=e.data:o.push(e.data),-1!==n?this.ensuredropPosition(o,a):(this.canDrop=!1,this.addErrorElem()),i.rowDropSettings.targetID||!this.canDrop||C.isNullOrUndefined(e.rows[0])||i.rowDragAndDropModule.updateIcon(e.rows,n,e),C.isNullOrUndefined(i.rowDropSettings.targetID)&&!this.canDrop&&this.removetopOrBottomBorder(),i.rowDropSettings.targetID&&(t=I.parentsUntil(e.target,"e-treegrid"))&&t.id===this.parent.rowDropSettings.targetID&&t.ej2_instances[0].rowDragAndDropModule.updateIcon(e.rows,n,e),e.target&&C.closest(e.target,"#"+i.rowDropSettings.targetID)&&((t=I.parentsUntil(e.target,"e-treegrid"))||(r.style.cursor="default"))},g.prototype.rowDropped=function(e){var t=this.parent;if(t.rowDropSettings.targetID?(e.target&&C.closest(e.target,"#"+t.rowDropSettings.targetID)||I.parentsUntil(e.target,"e-treegrid")&&I.parentsUntil(e.target,"e-treegrid").id===t.rowDropSettings.targetID||e.target&&document.getElementById(t.rowDropSettings.targetID))&&(C.setValue("dropPosition",this.dropPosition,e),t.trigger(mt,e),!e.cancel)&&t.rowDropSettings.targetID&&(this.dragDropGrid(e),t.isLocalData)&&(t.flatData=this.orderToIndex(t.flatData)):I.parentsUntil(e.target,"e-content")&&(this.parent.element.querySelector(".e-errorelem")&&(this.dropPosition="Invalid"),C.setValue("dropPosition",this.dropPosition,e),t.trigger(mt,e),e.cancel||(w(this.parent)||this.dropRows(e),t.isLocalData&&(t.flatData=this.orderToIndex(t.flatData)),t.grid.refresh(),C.isNullOrUndefined(t.getHeaderContent().querySelector(".e-firstrow-border")))||t.getHeaderContent().querySelector(".e-firstrow-border").remove()),this.removetopOrBottomBorder(),this.removeChildBorder(),C.isNullOrUndefined(this.parent.element.getElementsByClassName("e-firstrow-border")[0])?C.isNullOrUndefined(this.parent.element.getElementsByClassName("e-lastrow-border")[0])||this.parent.element.getElementsByClassName("e-lastrow-border")[0].remove():this.parent.element.getElementsByClassName("e-firstrow-border")[0].remove(),this.parent.enableImmutableMode&&!this.parent.allowPaging&&!C.isNullOrUndefined(e.data[0].parentItem)){var i=this.parent.treeColumnIndex,t=(i+=1,this.parent.getPrimaryKeyFieldNames()[0]),r=this.parent.grid.getRowIndexByPrimaryKey(e.data[0][""+t]),n=this.parent.getRows()[parseInt(r.toString(),10)],o=e.data[0];if("middleSegment"===this.dropPosition){var a=[],s=[],o=(a.push(o),s.push(n),x(this.parent,e.data[0].parentUniqueID)),r=this.parent.grid.getRowIndexByPrimaryKey(o[""+t]),e=this.parent.getRows()[parseInt(r.toString(),10)];a.push(o),s.push(e);for(var d=0;d<a.length;d++)this.parent.renderModule.cellRender({data:a[parseInt(d.toString(),10)],cell:s[parseInt(d.toString(),10)].cells[parseInt(i.toString(),10)],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex],requestType:"rowDragAndDrop"});t=e.getElementsByClassName("e-treegridcollapse")[0];C.isNullOrUndefined(t)||(C.removeClass([t],"e-treegridcollapse"),C.addClass([t],"e-treegridexpand"))}else this.parent.renderModule.cellRender({data:o,cell:n.cells[parseInt(i.toString(),10)],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex],requestType:"rowDragAndDrop"})}},g.prototype.dragDropGrid=function(e){var t=this.parent,i=C.closest(e.target,"tr"),i=isNaN(this.getTargetIdx(i))?0:this.getTargetIdx(i),e=I.parentsUntil(e.target,"e-treegrid");if(e&&e.id===this.parent.rowDropSettings.targetID&&!S(this.parent)&&!w(this.parent)){for(var r=e.ej2_instances[0],n=t.getSelectedRecords(),o=[],a=0;a<n.length;a++)o[parseInt(a.toString(),10)]=n[parseInt(a.toString(),10)].index;var s=r.dataSource;if(null!==this.parent.idMapping&&(C.isNullOrUndefined(this.dropPosition)||"bottomSegment"===this.dropPosition||"Invalid"===this.dropPosition)&&!s.length){for(var d=[],a=0;a<n.length;a++)if(n[parseInt(a.toString(),10)].hasChildRecords){d.push(n[parseInt(a.toString(),10)]);for(var l=R(n[parseInt(a.toString(),10)]),p=0;p<l.length;p++)d.push(l[parseInt(p.toString(),10)])}d.length&&(n=d)}t.notify(wt,{indexes:o,records:n}),r.notify(St,{toIndex:i,records:n});var h=r.rowDragAndDropModule.treeGridData;if(!C.isNullOrUndefined(h))for(var c,a=0;a<h.length;a++)h[parseInt(a.toString(),10)].index=a,C.isNullOrUndefined(h[parseInt(a.toString(),10)].parentItem)||(c=C.getValue("uniqueIDCollection."+h[parseInt(a.toString(),10)].parentUniqueID+".index",r),h[parseInt(a.toString(),10)].parentItem.index=c);t.grid.refresh(),r.grid.refresh(),1<r.grid.dataSource.length&&(r.grid.refresh(),C.isNullOrUndefined(r.getHeaderContent().querySelector(".e-firstrow-border"))||r.getHeaderContent().querySelector(".e-firstrow-border").remove(),C.isNullOrUndefined(r.getContent().querySelector(".e-lastrow-border"))||r.getContent().querySelector(".e-lastrow-border").remove())}w(this.parent)&&(r=e.ej2_instances[0],t.grid.refresh(),r.grid.refresh())},g.prototype.getTargetIdx=function(e){return e?parseInt(e.getAttribute("data-rowindex"),10):0},g.prototype.getParentData=function(e,t){var i,e=e.parentItem,r=-1;this.parent.enableVirtualization&&-1!==this.parent.selectedRowIndex?r=this.parent.getSelectedRows()[0].rowIndex:-1!==this.parent.selectedRowIndex&&(r=this.parent.selectedRowIndex),"bottomSegment"===this.dropPosition&&(i=this.parent.getPrimaryKeyFieldNames()[0],t=-1===r?this.parent.grid.getRowIndexByPrimaryKey(t[0][""+i]):this.parent.getSelectedRowIndexes()[0],i=this.parent.getCurrentViewRecords()[parseInt(t.toString(),10)],this.droppedRecord=x(this.parent,i.parentItem.uniqueID)),"middleSegment"===this.dropPosition&&(this.parent.getCurrentViewRecords()[parseInt(r.toString(),10)].level===e.level?this.droppedRecord=x(this.parent,e.uniqueID):this.getParentData(e))},g.prototype.dropRows=function(a,s){if("Invalid"!==this.dropPosition&&!S(this.parent)){var d,l=this.parent,p=void 0,h=(C.isNullOrUndefined(a.dropIndex)?(e=this.parent.getPrimaryKeyFieldNames()[0],e=-1===l.selectedRowIndex?this.parent.grid.getRowIndexByPrimaryKey(a.data[0][""+e])-1:l.getSelectedRowIndexes()[0]-1,e=l.getCurrentViewRecords()[parseInt(e.toString(),10)],this.getParentData(e,a.data)):(a.dropIndex=a.dropIndex===a.fromIndex?this.getTargetIdx(a.target.parentElement):a.dropIndex,this.parent.enableVirtualization?(e=this.parent.getRowByIndex(a.dropIndex).rowIndex,this.droppedRecord=l.getCurrentViewRecords()[parseInt(e.toString(),10)]):this.droppedRecord=l.getCurrentViewRecords()[a.dropIndex]),[]),p=this.droppedRecord;a.data[0]?h=a.data:h.push(a.data),this.parent[this.modifiedRecords].push(a.data[0],p);for(var c=0,e=this.parent.rowDropSettings.targetID,t=((this.isMultipleGrid=e)?this.isaddtoBottom=e&&this.isDraggedWithChild:this.ensuredropPosition(h,p),h.length),u=(C.isNullOrUndefined(this.parent.idMapping)||h.reverse(),this),i=0;i<t;i++)!function(e){var t,i,r,n,o;d=h[parseInt(e.toString(),10)],u.draggedRecord=d,"Invalid"===u.dropPosition||C.isNullOrUndefined(u.droppedRecord)||(l.rowDropSettings.targetID&&!s||u.deleteDragRow(),u.draggedRecord===u.droppedRecord&&(e=u.getTargetIdx(a.target.offsetParent.parentElement),isNaN(e)&&(e=u.getTargetIdx(a.target.parentElement)),a.dropIndex=e,p=u.droppedRecord=u.parent.getCurrentViewRecords()[a.dropIndex]),!p.parentItem&&"middleSegment"!==u.dropPosition||-1===(n=(r=l.parentData).indexOf(u.draggedRecord))||r.splice(n,1),e=u.treeGridData.indexOf(p),u.dropAtTop(e),"bottomSegment"===u.dropPosition&&(p.hasChildRecords?(c=u.getChildCount(p,0),u.parent.parentIdMapping&&u.treeData.splice(e+c+1,0,u.draggedRecord.taskData),u.treeGridData.splice(e+c+1,0,u.draggedRecord)):(u.parent.parentIdMapping&&u.treeData.splice(e+1,0,u.draggedRecord.taskData),u.treeGridData.splice(e+1,0,u.draggedRecord)),C.isNullOrUndefined(p.parentItem)&&(delete d.parentItem,delete d.parentUniqueID,d.level=0,u.parent.parentIdMapping)&&(d[u.parent.parentIdMapping]=null),p.parentItem&&(i=(t=u.getChildrecordsByParentID(p.parentUniqueID)[0].childRecords).indexOf(p)+1,t.splice(i,0,d),d.parentItem=p.parentItem,d.parentUniqueID=p.parentUniqueID,d.level=p.level,u.parent.parentIdMapping)&&(d[u.parent.parentIdMapping]=p[u.parent.parentIdMapping],d.parentItem=p.parentItem,d.level=p.level),d.hasChildRecords)&&(u.updateChildRecordLevel(d,1),u.updateChildRecord(d,e+c+1)),u.dropMiddle(e)),C.isNullOrUndefined(d.parentItem)&&(n=(r=l.parentData).indexOf(u.droppedRecord),o=0,r.filter(function(e){d.uniqueID===e.uniqueID&&o++}),"bottomSegment"===u.dropPosition&&0===o?r.splice(n+1,0,d):"topSegment"===u.dropPosition&&0===o&&r.splice(n,0,d)),l.rowDragAndDropModule.refreshGridDataSource()}(i)}},g.prototype.dropMiddle=function(e){var t=this.parent,i=R(this.droppedRecord),i=C.isNullOrUndefined(i)||0===i.length?e+1:i.length+e+1;"middleSegment"===this.dropPosition&&(t.parentIdMapping&&this.treeData.splice(i,0,this.draggedRecord.taskData),this.treeGridData.splice(i,0,this.draggedRecord),this.recordLevel(),this.draggedRecord.hasChildRecords)&&this.updateChildRecord(this.draggedRecord,i)},g.prototype.dropAtTop=function(e){var t=this.parent;"topSegment"===this.dropPosition&&(t.parentIdMapping&&this.treeData.splice(e,0,this.draggedRecord.taskData),this.draggedRecord.parentItem=this.treeGridData[parseInt(e.toString(),10)].parentItem,this.draggedRecord.parentUniqueID=this.treeGridData[parseInt(e.toString(),10)].parentUniqueID,this.draggedRecord.level=this.treeGridData[parseInt(e.toString(),10)].level,this.treeGridData.splice(parseInt(e.toString(),10),0,this.draggedRecord),this.draggedRecord.hasChildRecords&&(this.updateChildRecord(this.draggedRecord,e),this.updateChildRecordLevel(this.draggedRecord,1)),this.droppedRecord.parentItem)&&(e=(t=this.getChildrecordsByParentID(this.droppedRecord.parentUniqueID)[0].childRecords).indexOf(this.droppedRecord),t.splice(e,0,this.draggedRecord))},g.prototype.recordLevel=function(){var e,t=this.parent,i=this.draggedRecord,r=this.droppedRecord,n=t.childMapping;!r.hasChildRecords&&(r.hasChildRecords=!0,r.hasFilteredChildRecords=!0,C.isNullOrUndefined(r.childRecords)||0===r.childRecords.length)&&(r.childRecords=[],!t.parentIdMapping)&&C.isNullOrUndefined(r.taskData[""+n])&&(r.taskData[""+n]=[]),"middleSegment"===this.dropPosition&&(delete(e=C.extend({},r)).childRecords,i.parentItem=e,i.parentUniqueID=r.uniqueID,r.childRecords.splice(r.childRecords.length,0,i),t.isSelfReference&&(r[t.childMapping]=[],r[t.childMapping].splice(r[t.childMapping].length,0,i)),C.isNullOrUndefined(i)||t.parentIdMapping||C.isNullOrUndefined(r.taskData[""+n])||r.taskData[t.childMapping].splice(r.childRecords.length,0,i.taskData),i.hasChildRecords?(i.level=r.level+1,this.updateChildRecordLevel(i,1)):i.level=r.level+1,r.expanded=!0)},g.prototype.deleteDragRow=function(){this.parent.dataSource instanceof b.DataManager&&v(this.parent)?(this.treeGridData=this.parent.grid.dataSource.dataSource.json,this.treeData=this.parent.dataSource.dataSource.json):(this.treeGridData=this.parent.grid.dataSource,this.treeData=this.parent.dataSource);var e=x(this.parent,this.draggedRecord.uniqueID);!C.isNullOrUndefined(e.childRecords)&&e.childRecords.length&&(e.hasChildRecords=!0),this.removeRecords(e)},g.prototype.updateChildRecord=function(e,t){var i,r=this.parent;if(!e.hasChildRecords)return 0;for(var n=e.childRecords.length,o=0;o<n;o++)i=this.isMultipleGrid?e.childRecords[parseInt(o.toString(),10)]:C.getValue("uniqueIDCollection."+e.childRecords[parseInt(o.toString(),10)].uniqueID,r),r.flatData.splice(++t,0,i),C.setValue("uniqueIDCollection."+i.uniqueID,i,this.parent),r.parentIdMapping&&this.treeData.splice(t,0,i.taskData),i.hasChildRecords&&(t=this.updateChildRecord(i,t));return t},g.prototype.updateChildRecordLevel=function(e,t){if(t++,!e.hasChildRecords)return 0;for(var i=e.childRecords.length,r=0;r<i;r++){var n=this.isMultipleGrid?e.childRecords[parseInt(r.toString(),10)]:C.getValue("uniqueIDCollection."+e.childRecords[parseInt(r.toString(),10)].uniqueID,this.parent),o=void 0;e.parentItem&&(o=x(this.parent,e.parentItem.uniqueID)),C.isNullOrUndefined(o)&&!C.isNullOrUndefined(e.parentItem)&&(o=e.parentItem),n.level=e.parentItem?o.level+t:e.level+1,n.hasChildRecords&&(t--,t=this.updateChildRecordLevel(n,t))}return t},g.prototype.removeRecords=function(e){var t=this.parent,i=this.parent.dataSource instanceof b.DataManager&&v(this.parent)?this.parent.dataSource.dataSource.json:this.parent.dataSource,r=e,e=!C.isNullOrUndefined(t.parentIdMapping),n=this.getChildrecordsByParentID(r.parentUniqueID)[0];if(r){if(r.parentItem&&(p=0,l=n?n.childRecords:[])&&0<l.length&&(p=l.indexOf(r),n.childRecords.splice(p,1),this.parent.parentIdMapping&&!t.enableImmutableMode||pi({value:r,action:"delete"},this.parent,e,r.index,r.index)),t.parentIdMapping){r.hasChildRecords&&0<r.childRecords.length&&this.removeChildItem(r);for(var o=void 0,a=void 0,s=i,d=0;d<s.length;d++)s[parseInt(d.toString(),10)][this.parent.idMapping]===r.taskData[this.parent.idMapping]&&(o=d);for(d=0;d<this.treeGridData.length;d++)this.treeGridData[parseInt(d.toString(),10)][this.parent.idMapping]===r.taskData[this.parent.idMapping]&&(a=d);-1===o||C.isNullOrUndefined(o)||i.splice(o,1),-1===a||C.isNullOrUndefined(a)||this.treeGridData.splice(a,1)}var l,p,h=this.treeGridData.indexOf(r);if(t.parentIdMapping||-1!==(l=this.parent.parentData.indexOf(r))&&(t.parentData.splice(l,1),i.splice(l,1)),-1===h&&!t.parentIdMapping)for(var c=t.getPrimaryKeyFieldNames()[0],u=0;u<this.treeGridData.length;u++)this.treeGridData[parseInt(u.toString(),10)][""+c]===r[""+c]&&(h=u);t.parentIdMapping||(p=this.getChildCount(r,0),this.treeGridData.splice(h,p+1)),r.parentItem&&n&&n.childRecords&&!n.childRecords.length&&(n.expanded=!1,n.hasChildRecords=!1,n.hasFilteredChildRecords=!1),-1!==this.parent[this.modifiedRecords].indexOf(n)||C.isNullOrUndefined(n)||this.parent[this.modifiedRecords].push(n),C.isNullOrUndefined(n)||this.updateModifiedRecords(n)}},g.prototype.updateModifiedRecords=function(e){e=x(this.parent,e.parentUniqueID);C.isNullOrUndefined(e)||(this.parent[this.modifiedRecords].push(e),this.updateModifiedRecords(e))},g.prototype.removeChildItem=function(e){for(var t,i,r,n=this.parent.dataSource instanceof b.DataManager&&v(this.parent)?this.parent.dataSource.dataSource.json:this.parent.dataSource,o=0;o<e.childRecords.length;o++){t=e.childRecords[parseInt(o.toString(),10)],!C.isNullOrUndefined(t.childRecords)&&t.childRecords.length&&(t.hasChildRecords=!0);for(var a=void 0,a=this.parent.dataSource instanceof b.DataManager&&v(this.parent)?this.parent.dataSource.dataSource.json:this.parent.dataSource,s=0;s<a.length;s++)a[parseInt(s.toString(),10)][this.parent.idMapping]===t.taskData[this.parent.idMapping]&&(i=s);for(var d=0;d<this.treeGridData.length;d++)if(this.treeGridData[parseInt(d.toString(),10)][this.parent.idMapping]===t.taskData[this.parent.idMapping]){r=d;break}-1===i||C.isNullOrUndefined(i)||n.splice(i,1),-1===r||C.isNullOrUndefined(r)||this.treeGridData.splice(r,1),t.hasChildRecords&&this.removeChildItem(t)}},g.prototype.getChildCount=function(e,t){var i;if(!e.hasChildRecords)return 0;for(var r=0;r<e.childRecords.length;r++)t++,(i=e.childRecords[parseInt(r.toString(),10)]).hasChildRecords&&(t=this.getChildCount(i,t));return t},g.prototype.ensuredropPosition=function(e,t){var i=this;e.filter(function(e){e.hasChildRecords&&!C.isNullOrUndefined(e.childRecords)&&(-1===e.childRecords.indexOf(t)?i.ensuredropPosition(e.childRecords,t):(i.dropPosition="Invalid",i.addErrorElem(),i.canDrop=!1))})},g.prototype.destroy=function(){this.removeEventListener()},g.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(It,this.Rowdraging),this.parent.off(Rt,this.rowDropped),this.parent.off(St,this.rowsAdded),this.parent.off(wt,this.rowsRemoved))},g.prototype.getModuleName=function(){return"rowDragAndDrop"};var Ii=g;function g(e){this.canDrop=!0,this.isDraggedWithChild=!1,this.modifiedRecords="modifiedRecords",this.selectedRecords="selectedRecords",this.selectedRows="selectedRows",this.hasDropItem=!0,this.isaddtoBottom=!1,I.Grid.Inject(I.RowDD),this.parent=e,this.addEventListener()}Ri=function(e,t){return(Ri=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Ri,vi,xi=function(e,t){function i(){this.constructor=e}Ri(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Ci=function(e,t,i,r){var n,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(o<3?n(a):3<o?n(t,i,a):n(t,i))||a);return 3<o&&a&&Object.defineProperty(t,i,a),a},xi=(vi=C.ChildProperty,xi(bi,vi),Ci([C.Property()],bi.prototype,"targetID",void 0),bi);function bi(){return null!==vi&&vi.apply(this,arguments)||this}Di=function(e,t){return(Di=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Di,Mi,Ci=function(e,t){function i(){this.constructor=e}Di(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Oi=(Mi=I.VirtualRowModelGenerator,Ci(Pi,Mi),Pi.prototype.addEventListener=function(){this.parent.on(lt,this.getDatas,this)},Pi.prototype.getDatas=function(e){this.visualData=e.data},Pi.prototype.getDataInfo=function(){return Mi.prototype.getData.call(this)},Pi.prototype.generateRows=function(e,t){!C.isNullOrUndefined(t.virtualInfo)&&t.virtualInfo.loadNext&&t.virtualInfo.nextInfo.page!==this.parent.pageSettings.currentPage?this.parent.setProperties({pageSettings:{currentPage:t.virtualInfo.nextInfo.page}},!0):C.isNullOrUndefined(t.virtualInfo)||t.virtualInfo.loadNext||t.virtualInfo.page===this.parent.pageSettings.currentPage||this.parent.setProperties({pageSettings:{currentPage:t.virtualInfo.page}},!0);var i=this.getDataInfo();if(C.isNullOrUndefined(t.virtualInfo)||("right"!==t.virtualInfo.direction&&"left"!==t.virtualInfo.direction?(this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||w(this.parent))&&1!==t.virtualInfo.blockIndexes.length||(t.virtualInfo.blockIndexes=i.blockIndexes):t.virtualInfo.blockIndexes=this.getBlockIndexes(t.virtualInfo.page)),this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||w(this.parent))return Mi.prototype.generateRows.call(this,e,t);C.isNullOrUndefined(t.requestType)||"collapseAll"!==t.requestType.toString()||(t.requestType="refresh");var r=Mi.prototype.generateRows.call(this,e,t);if(!C.isNullOrUndefined(this.visualData))for(var n=0;n<r.length;n++)r[parseInt(n.toString(),10)].index=this.visualData.indexOf(r[parseInt(n.toString(),10)].data);return r},Pi.prototype.checkAndResetCache=function(t){var e,i=["paging","refresh","sorting","filtering","searching","reorder","save","delete"].some(function(e){return t===e});return this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||w(this.parent)?(e=this.model.currentPage,i?(this.cache={},this.data={},this.groups={}):"virtualscroll"===t&&this.cache[parseInt(e.toString(),10)]&&this.cache[parseInt(e.toString(),10)].length>this.parent.contentModule.getBlockSize()&&delete this.cache[parseInt(e.toString(),10)]):!i&&"virtualscroll"!==t||(this.cache={},this.data={},this.groups={}),i},Pi);function Pi(e){e=Mi.call(this,e)||this;return e.addEventListener(),e}f.prototype.getModuleName=function(){return"filter"},f.prototype.destroy=function(){this.removeEventListener()},f.prototype.addEventListener=function(){this.parent.on("updateFilterRecs",this.updatedFilteredRecord,this),this.parent.on("clearFilters",this.clearFilterLevel,this)},f.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateFilterRecs",this.updatedFilteredRecord),this.parent.off("clearFilters",this.clearFilterLevel))},f.prototype.updatedFilteredRecord=function(e){C.setValue("uniqueIDFilterCollection",{},this.parent),this.flatFilteredData=e.data,this.filteredParentRecs=[],this.filteredResult=[],this.isHierarchyFilter=!1;for(var t=0;t<this.flatFilteredData.length;t++){var i=this.flatFilteredData[parseInt(t.toString(),10)],r=(this.addParentRecord(i),(""===this.parent.grid.searchSettings.key?this.parent.filterSettings:this.parent.searchSettings).hierarchyMode),r=("Child"!==r&&"None"!==r||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key||(this.isHierarchyFilter=!0),I.getObject("childRecords",i)),r=(!C.isNullOrUndefined(r)&&r.length&&C.setValue("hasFilteredChildRecords",this.checkChildExsist(i),i),I.getObject("parentItem",i));C.isNullOrUndefined(r)||(r=x(this.parent,i.parentItem.uniqueID,!0),C.setValue("hasFilteredChildRecords",!0,r),r&&r.parentItem&&this.updateParentFilteredRecord(r))}0<this.flatFilteredData.length&&this.isHierarchyFilter&&this.updateFilterLevel(),this.parent.notify("updateAction",{result:this.filteredResult})},f.prototype.updateParentFilteredRecord=function(e){var e=x(this.parent,e.parentItem.uniqueID,!0),t=C.getValue("uniqueIDFilterCollection",this.parent);e&&Object.prototype.hasOwnProperty.call(t,e.uniqueID)&&C.setValue("hasFilteredChildRecords",!0,e),e&&e.parentItem&&this.updateParentFilteredRecord(e)},f.prototype.addParentRecord=function(e){var t=x(this.parent,e.parentUniqueID);"None"!==(""===this.parent.grid.searchSettings.key?this.parent.filterSettings:this.parent.searchSettings).hierarchyMode||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key?(C.isNullOrUndefined(t)||("Child"!==(""===this.parent.grid.searchSettings.key?this.parent.filterSettings:this.parent.searchSettings).hierarchyMode||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key||-1!==this.flatFilteredData.indexOf(t))&&this.addParentRecord(t),-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),C.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent))):C.isNullOrUndefined(t)?-1!==this.flatFilteredData.indexOf(e)&&-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),C.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent),e.hasFilteredChildRecords=!0):(this.addParentRecord(t),-1!==this.flatFilteredData.indexOf(t)||-1!==this.filteredResult.indexOf(t)?-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),C.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent)):-1===this.filteredResult.indexOf(e)&&-1!==this.flatFilteredData.indexOf(e)&&(this.filteredResult.push(e),C.setValue("uniqueIDFilterCollection."+e.uniqueID,e,this.parent)))},f.prototype.checkChildExsist=function(e){for(var t=I.getObject("childRecords",e),i=!1,r=0;r<t.length;r++){var n,o=t[parseInt(r.toString(),10)].childRecords,a=(""===this.parent.grid.searchSettings.key?this.parent.filterSettings:this.parent.searchSettings).hierarchyMode;if("Child"!==a&&"Both"!==a||0===this.parent.grid.filterSettings.columns.length&&""===this.parent.grid.searchSettings.key||(n=C.getValue("uniqueIDFilterCollection",this.parent),Object.prototype.hasOwnProperty.call(n,t[parseInt(r.toString(),10)].uniqueID))||(this.filteredResult.push(t[parseInt(r.toString(),10)]),C.setValue("uniqueIDFilterCollection."+t[parseInt(r.toString(),10)].uniqueID,t[parseInt(r.toString(),10)],this.parent),i=!0),"None"===a&&(0!==this.parent.grid.filterSettings.columns.length||""!==this.parent.grid.searchSettings.key)&&-1!==this.flatFilteredData.indexOf(t[parseInt(r.toString(),10)])){i=!0;break}!C.isNullOrUndefined(o)&&o.length&&(i=this.checkChildExsist(t[parseInt(r.toString(),10)])),"Child"!==a&&"Both"!==a||!t.length||(i=!0)}return i},f.prototype.updateFilterLevel=function(){for(var e=this.filteredResult,t=this.filteredResult.length,i=0;i<t;i++){var r=x(this.parent,e[parseInt(i.toString(),10)].parentUniqueID);-1!==e.indexOf(r)?(r=x(this.parent,e[parseInt(i.toString(),10)].parentUniqueID,!0),e[parseInt(i.toString(),10)].filterLevel=r.filterLevel+1):(e[parseInt(i.toString(),10)].filterLevel=0,this.filteredParentRecs.push(e[parseInt(i.toString(),10)]))}},f.prototype.clearFilterLevel=function(e){for(var t=0,i=e.flatData,r=i.length;t<r;t++){var n,o=(n=i[parseInt(t.toString(),10)]).filterLevel;!o&&0!==o&&C.isNullOrUndefined(n.hasFilteredChildRecords)||(n.hasFilteredChildRecords=null,n.filterLevel=null)}this.filteredResult=[],this.parent.notify("updateResults",{result:i,count:i.length})};Ci=f;function f(e){I.Grid.Inject(I.Filter),this.parent=e,this.isHierarchyFilter=!1,this.filteredResult=[],this.flatFilteredData=[],this.filteredParentRecs=[],this.addEventListener()}m.prototype.getModuleName=function(){return"ExcelExport"},m.prototype.addEventListener=function(){this.parent.on("updateResults",this.updateExcelResultModel,this),this.parent.on("excelCellInfo",this.excelQueryCellInfo,this),this.parent.grid.on("export-RowDataBound",this.exportRowDataBound,this),this.parent.grid.on("finalPageSetup",this.finalPageSetup,this)},m.prototype.destroy=function(){this.removeEventListener()},m.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateResults",this.updateExcelResultModel),this.parent.off("excelCellInfo",this.excelQueryCellInfo),this.parent.grid.off("export-RowDataBound",this.exportRowDataBound),this.parent.grid.off("finalPageSetup",this.finalPageSetup))},m.prototype.updateExcelResultModel=function(e){this.dataResults=e},m.prototype.Map=function(r,n,o,a,s){var d=this,l=this.parent.dataSource,p=new I.Data(this.parent.grid),h=Object();if(C.setValue("isCsv",s,h),C.setValue("cancel",!1,h),C.isNullOrUndefined(r)||(this.isCollapsedStatePersist=r.isCollapsedStatePersist),!C.isNullOrUndefined(r)){if(!C.isNullOrUndefined(r.dataSource)&&!r.dataSource.dataSource)return this.parent.grid.excelExportModule.Map(this.parent.grid,r,n,o,s,a);if("CurrentPage"===r.exportType)return r.dataSource=this.parent.getCurrentViewRecords(),this.parent.grid.excelExportModule.Map(this.parent.grid,r,n,o,s,a)}return new Promise(function(i){var e=!d.isLocal()||l instanceof b.DataManager?d.parent.dataSource:new b.DataManager(l),t=new b.Query;if(d.isLocal()||((t=d.generateQuery(t)).queries=d.parent.grid.getDataModule().generateQuery().queries,t=I.ExportHelper.getQuery(d.parent.grid,p),C.isNullOrUndefined(d.parent.filterModule)&&(t.queries=t.queries.slice(1,2),t.params=t.params.slice(0,0)),C.setValue("query",t,h)),d.parent.trigger(Ee,C.extend(h,r)),I.getObject("cancel",h))return null;e.executeQuery(t).then(function(e){var t=null;return C.isNullOrUndefined(r)||C.isNullOrUndefined(r.dataSource)||(t=r.dataSource),r=d.manipulateExportProperties(r,l,e),d.parent.grid.excelExportModule.Map(d.parent.grid,r,n,o,s,a).then(function(e){null!=t?r.dataSource=t:delete r.dataSource,i(e)})})})},m.prototype.generateQuery=function(e,t){return!C.isNullOrUndefined(t)&&"CurrentPage"===t.exportType&&this.parent.allowPaging&&(t.exportType="AllPages",e.addParams("ExportType","CurrentPage"),e.where(this.parent.parentIdMapping,"equal",null),e=I.getObject("grid.renderModule.data.pageQuery",this.parent)(e)),e},m.prototype.manipulateExportProperties=function(e,t,i){var r,n=Object();return C.setValue("query",this.parent.grid.getDataModule().generateQuery(!0),n),C.setValue("isExport",!0,n),C.isNullOrUndefined(e)||C.isNullOrUndefined(e.exportType)||C.setValue("exportType",e.exportType,n),this.isLocal()||(this.parent.parentData=[],this.parent.dataModule.convertToFlatData(I.getObject("result",i)),C.setValue("expresults",this.parent.flatData,n)),this.parent.notify("dataProcessor",n),n=this.dataResults,t=C.isNullOrUndefined(n.result)?this.parent.flatData.slice(0):n.result,this.isLocal()||(this.parent.flatData=[]),e&&e.dataSource&&(i=this.parent.flatData,r=e.dataSource instanceof b.DataManager?e.dataSource.dataSource.json:e.dataSource,this.parent.dataModule.convertToFlatData(r),t=this.parent.flatData,this.parent.flatData=i),(e=C.isNullOrUndefined(e)?Object():e).dataSource=new b.DataManager({json:t}),0<this.parent.aggregates.length&&(e.query=n.query),e},m.prototype.excelQueryCellInfo=function(e){var t,i;this.parent.grid.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex&&(t={},i=e.data,i=C.isNullOrUndefined(i.filterLevel)?i.level:i.filterLevel,t.indent=i,e.style=t),this.parent.notify("updateResults",e),this.parent.trigger("excelQueryCellInfo",e)},m.prototype.exportRowDataBound=function(e){var t,i,r,n,o,a;"excel"===e.type&&(t=e.rowObj.data,n=this.parent.grid.filterSettings.columns.length,i=e.excelRows.length,r=t.level,t.parentItem&&x(this.parent,t.parentItem.uniqueID,Boolean(n))?(o=n=!1,a=y(this.parent,t,this.parent.parentData),!this.isCollapsedStatePersist||a&&this.parent.isLocalData||(n=!0,o=!t.expanded),e.excelRows[i-1].grouping={outlineLevel:r,isCollapsed:o,isHidden:n}):t.hasChildRecords&&C.isNullOrUndefined(t.parentItem)&&(e.excelRows[i-1].grouping={outlineLevel:r}))},m.prototype.finalPageSetup=function(e){for(var t=0;t<e.worksheets.length;t++)e.worksheets[parseInt(t.toString(),10)].rows&&(e.worksheets[parseInt(t.toString(),10)].pageSetup={isSummaryRowBelow:!1})},m.prototype.isLocal=function(){return!S(this.parent)&&v(this.parent)};var Ei=m;function m(e){this.isCollapsedStatePersist=!1,I.Grid.Inject(I.ExcelExport),this.parent=e,this.dataResults={},this.addEventListener()}Ai.prototype.getModuleName=function(){return"PdfExport"},Ai.prototype.addEventListener=function(){this.parent.on("pdfCellInfo",this.pdfQueryCellInfo,this),this.parent.on("updateResults",this.updatePdfResultModel,this)},Ai.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("pdfCellInfo",this.pdfQueryCellInfo),this.parent.off("updateResults",this.updatePdfResultModel))},Ai.prototype.destroy=function(){this.removeEventListener()},Ai.prototype.updatePdfResultModel=function(e){this.dataResults=e},Ai.prototype.Map=function(r,n,o,a){var s=this,d=this.parent.dataSource,l=Object(),p=!S(this.parent)&&v(this.parent);return C.setValue("cancel",!1,l),new Promise(function(i){var e=!p||d instanceof b.DataManager?s.parent.dataSource:new b.DataManager(d),t=new b.Query;if(p||(t=s.generateQuery(t),C.setValue("query",t,l)),s.parent.trigger(Ne,C.extend(l,r)),I.getObject("cancel",l))return null;e.executeQuery(t).then(function(e){var t=null;return C.isNullOrUndefined(r)||C.isNullOrUndefined(r.dataSource)||(t=r.dataSource),r=s.manipulatePdfProperties(r,d,e),s.parent.grid.pdfExportModule.Map(s.parent.grid,r,n,o,a).then(function(e){null!=t?r.dataSource=t:delete r.dataSource,i(e)})})})},Ai.prototype.generateQuery=function(e,t){return!C.isNullOrUndefined(t)&&"CurrentPage"===t.exportType&&this.parent.allowPaging&&(t.exportType="AllPages",e.addParams("ExportType","CurrentPage"),e.where(this.parent.parentIdMapping,"equal",null),e=I.getObject("grid.renderModule.data.pageQuery",this.parent)(e)),e},Ai.prototype.manipulatePdfProperties=function(e,t,i){var r={},n=!S(this.parent)&&v(this.parent);return C.setValue("query",this.parent.grid.getDataModule().generateQuery(!0),r),C.setValue("isExport",!0,r),C.setValue("isPdfExport",!0,r),C.isNullOrUndefined(e)||C.isNullOrUndefined(e.isCollapsedStatePersist)||C.setValue("isCollapsedStatePersist",e.isCollapsedStatePersist,r),C.isNullOrUndefined(e)||C.isNullOrUndefined(e.exportType)||C.setValue("exportType",e.exportType,r),n||(this.parent.parentData=[],this.parent.dataModule.convertToFlatData(C.getValue("result",i)),C.setValue("expresults",this.parent.flatData,r)),this.parent.notify("dataProcessor",r),r=this.dataResults,t=C.isNullOrUndefined(r.result)?this.parent.flatData.slice(0):r.result,n||(this.parent.flatData=[]),e&&e.dataSource&&n&&(i=this.parent.flatData,n=e.dataSource instanceof b.DataManager?e.dataSource.dataSource.json:e.dataSource,this.parent.dataModule.convertToFlatData(n),t=this.parent.flatData,this.parent.flatData=i),(e=C.isNullOrUndefined(e)?{}:e).dataSource=new b.DataManager({json:t}),e.query=r.query,e},Ai.prototype.pdfQueryCellInfo=function(e){var t,i;this.parent.grid.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex&&(t={},i=I.getObject("data",e),i=C.isNullOrUndefined(i.filterLevel)?i.level:i.filterLevel,t.paragraphIndent=3*i,e.style=t),this.parent.notify("updateResults",e),this.parent.trigger("pdfQueryCellInfo",e)};var Ni=Ai;function Ai(e){I.Grid.Inject(I.PdfExport),this.parent=e,this.dataResults={},this.addEventListener()}O.prototype.addEventListener=function(){this.parent.on(Be,this.collapseExpandPagedchilds,this),this.parent.on(ze,this.pageAction,this)},O.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Be,this.collapseExpandPagedchilds),this.parent.off(ze,this.pageAction))},O.prototype.getModuleName=function(){return"pager"},O.prototype.refresh=function(){this.parent.grid.pagerModule.refresh()},O.prototype.destroy=function(){this.removeEventListener()},O.prototype.goToPage=function(e){this.parent.grid.pagerModule.goToPage(e)},O.prototype.updateExternalMessage=function(e){C.isNullOrUndefined(e)&&this.parent.trigger(d,{error:"The provided value for the message is undefined. Please ensure the message contains string."}),this.parent.grid.pagerModule.updateExternalMessage(e)},O.prototype.collapseExpandPagedchilds=function(t){t.record.expanded="collapse"!==t.action,this.parent.flatData.map(function(e){return e.expanded=(e.uniqueID===t.record.uniqueID&&e.expanded!==t.record.expanded?t.record:e).expanded}),this.parent.enableImmutableMode&&(i=this.parent.getPrimaryKeyFieldNames()[0],(r=this.parent.flatData.filter(function(e){return e[""+i]===t.record[""+i]})).length)&&(r[0].expanded=t.record.expanded);var i,e,r={result:this.parent.flatData,row:t.row,action:t.action,record:t.record,count:this.parent.flatData.length};C.getValue("grid.renderModule",this.parent).dataManagerSuccess(r),this.parent.enableImmutableMode&&(e=void 0,"collapse"===r.action?(e=r.row.getElementsByClassName("e-treegridexpand")[0],C.isNullOrUndefined(e)||(C.removeClass([e],"e-treegridexpand"),C.addClass([e],"e-treegridcollapse"))):"expand"===r.action&&(e=r.row.getElementsByClassName("e-treegridcollapse")[0],C.isNullOrUndefined(e)||(C.removeClass([e],"e-treegridcollapse"),C.addClass([e],"e-treegridexpand"))))},O.prototype.pageRoot=function(i,r,e){for(var n=C.isNullOrUndefined(e)?[]:e,o=this,t=0;t<r.length;t++)!function(t){n.push(r[parseInt(t.toString(),10)]);var e;r[parseInt(t.toString(),10)].hasChildRecords&&(e=i.filter(function(e){return r[parseInt(t.toString(),10)].uniqueID===e.parentUniqueID}),n=o.pageRoot(i,e,n))}(t);return n},O.prototype.updatePageSize=function(e){var e=e.result.length,t=this.parent.grid.pagerModule;!0===this.parent.pageSettings.pageSizes&&t.pagerObj.pagerdropdownModule.dropDownListObject.value===t.pagerObj.getLocalizedLabel("All")&&(t.pagerObj.totalRecordsCount=e,this.parent.grid.pageSettings.pageSize=e)},O.prototype.pageAction=function(e){var t,i,r,n,o,a,s=this,d=new b.DataManager(e.result);"Root"===this.parent.pageSettings.pageSizeMode?(t=[],r=0<this.parent.grid.filterSettings.columns.length&&("Child"===this.parent.filterSettings.hierarchyMode||"None"===this.parent.filterSettings.hierarchyMode)?"filterLevel":"level",r=(new b.Query).where(r,"equal",0),t=d.executeLocal(r),e.count=t.length,a=(n=this.parent.grid.pageSettings.pageSize)*((o=this.parent.grid.pageSettings.currentPage)-1),r=r.skip(a).take(n),t=d.executeLocal(r),d=this.pageRoot(e.result,t),e.result=d):(t=new b.DataManager(e.result),d=new b.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),d=t.executeLocal((new b.Query).where(d)),i=void 0,i=Et(this.parent)&&"collapse"!==e.actionArgs.action&&"expand"!==e.actionArgs.action?d:d.filter(function(e){return y(s.parent,e)}),e.count=i.length,r=new b.Query,n=this.parent.grid.pageSettings.pageSize,this.updatePageSize(e),o=this.parent.grid.pageSettings.currentPage,i.length<o*n&&(o=Math.floor(i.length/n)+(i.length%n?1:0),this.parent.grid.setProperties({pageSettings:{currentPage:o=o||1}},!0)),r=r.skip(a=n*(o-1)).take(n),t.dataSource.json=i,e.result=t.executeLocal(r)),this.parent.notify("updateAction",e)};var Ui=O;function O(e){I.Grid.Inject(I.Page),this.parent=e,this.addEventListener()}qi.prototype.getModuleName=function(){return"toolbar"},qi.prototype.addEventListener=function(){this.parent.on(De,this.refreshToolbar,this),this.parent.on(Oe,this.refreshToolbar,this),this.parent.on(Pe,this.toolbarClickHandler,this)},qi.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(De,this.refreshToolbar),this.parent.off(Oe,this.refreshToolbar),this.parent.off(Pe,this.toolbarClickHandler))},qi.prototype.refreshToolbar=function(e){var t,i,r,n,o,a,s,d,l,p=this.parent.grid.toolbarModule.getToolbar();C.isNullOrUndefined(p)||(l=d=void 0,i=(t=this.parent).element.id+"_gridcontrol_indent",r=t.element.id+"_gridcontrol_outdent",s=p.querySelector("#"+i),n=p.querySelector("#"+r),o=e.row,a=t.getSelectedRows()[0],C.isNullOrUndefined(o[0])||(o=o[0]),o=C.isNullOrUndefined(a)||a.rowIndex===o.rowIndex?o:a,null!==s&&null!==n&&(d=p.querySelector("#"+i).parentElement,l=p.querySelector("#"+r).parentElement,0===o.rowIndex||1<t.getSelectedRowIndexes().length?(d.classList.add("e-hidden"),l.classList.add("e-hidden")):("rowDeselected"!==e.name||!C.isNullOrUndefined(a)&&t.grid.isCheckBoxSelection)&&(s=t.getCurrentViewRecords()[o.rowIndex],C.isNullOrUndefined(s)||(s.level>t.getCurrentViewRecords()[o.rowIndex-1].level?d.classList.add("e-hidden"):d.classList.remove("e-hidden"),s.level===t.getCurrentViewRecords()[o.rowIndex-1].level&&d.classList.remove("e-hidden"),0===s.level&&l.classList.add("e-hidden"),0!==s.level&&l.classList.remove("e-hidden"))),"rowDeselected"===e.name)&&C.isNullOrUndefined(a)&&!t.grid.isCheckBoxSelection&&(this.parent.toolbar.includes("Indent")&&d.classList.add("e-hidden"),this.parent.toolbar.includes("Outdent"))&&l.classList.add("e-hidden"))},qi.prototype.toolbarClickHandler=function(e){var t=this.parent,i="indentOutdentAction";"Cell"===this.parent.editSettings.mode&&"Batch"===this.parent.grid.editSettings.mode&&e.item.id===this.parent.grid.element.id+"_update"&&(e.cancel=!0,this.parent.grid.editModule.saveCell()),e.item.id===this.parent.grid.element.id+"_expandall"&&this.parent.expandAll(),e.item.id===this.parent.grid.element.id+"_collapseall"&&this.parent.collapseAll(),e.item.id===t.grid.element.id+"_indent"&&t.getSelectedRecords().length&&!C.isNullOrUndefined(t.rowDragAndDropModule)&&this.parent.rowDragAndDropModule[i](null,"indent"),e.item.id===t.grid.element.id+"_outdent"&&t.getSelectedRecords().length&&!C.isNullOrUndefined(t.rowDragAndDropModule)&&this.parent.rowDragAndDropModule[i](null,"outdent")},qi.prototype.getToolbar=function(){return this.parent.grid.toolbarModule.getToolbar()},qi.prototype.enableItems=function(e,t){this.parent.grid.toolbarModule.enableItems(e,t)},qi.prototype.destroy=function(){this.removeEventListener()};var ki=qi;function qi(e){I.Grid.Inject(I.Toolbar),this.parent=e,this.addEventListener()}Vi.prototype.getModuleName=function(){return"summary"},Vi.prototype.removeEventListener=function(){this.parent.isDestroyed},Vi.prototype.calculateSummaryValue=function(e,t,a){var s;this.summaryQuery=e;for(var i=[],r=0,n=Object.keys(t).length;r<n;r++)I.getObject("isSummaryRow",t[parseInt(r.toString(),10)])||i.push(t[parseInt(r.toString(),10)]);var d,o=Nt(i),l=i.slice(),p=Object.keys(this.parent.aggregates).length,e=Object.keys(o).length,h=this.parent.getColumns();if(this.parent.aggregates.filter(function(e){return e.showChildSummary}).length){for(var c=0,n=e;c<n;c++)if(s=o[parseInt(c.toString(),10)],d=this.getChildRecordsLength(s,l)){for(var u=this,g=1,f=p;g<=f;g++)!function(e){for(var t=void 0,t={},i=0;i<h.length;i++)t[""+(C.isNullOrUndefined(I.getObject("field",h[parseInt(i.toString(),10)]))?h[parseInt(i.toString(),10)]:I.getObject("field",h[parseInt(i.toString(),10)]))]=null;if(t=u.createSummaryItem(t,u.parent.aggregates[e-1]),!u.parent.aggregates[e-1].showChildSummary)return;l.map(function(e,t){e.uniqueID===s.uniqueID&&(r=t)});var r,e=r+d+e,n=C.extend({},s),o=(delete n.childRecords,delete n[u.parent.childMapping],C.setValue("parentItem",n,t),I.getObject("level",n));C.setValue("level",o+1,t),C.setValue("isSummaryRow",!0,t),C.setValue("parentUniqueID",n.uniqueID,t),a&&(o=I.getObject("childRecords",s)).length&&o.push(t),l.splice(e,0,t)}(g);this.flatChildRecords=[]}}else{for(var m={},y=0,S=h.length;y<S;y++)m[""+(C.isNullOrUndefined(I.getObject("field",h[parseInt(y.toString(),10)]))?h[parseInt(y.toString(),10)]:I.getObject("field",h[parseInt(y.toString(),10)]))]=null;for(var g=1,w=p;g<=w;g++)this.createSummaryItem(m,this.parent.aggregates[g-1])}return l},Vi.prototype.getChildRecordsLength=function(e,t){for(var i=0,r=Object.keys(t).length;i<r;i++){var n=t[parseInt(i.toString(),10)];e===(C.isNullOrUndefined(n.parentItem)?null:t.filter(function(e){return e.uniqueID===n.parentItem.uniqueID})[0])&&(this.flatChildRecords.push(n),I.getObject("hasChildRecords",n))&&this.getChildRecordsLength(n,t)}return this.flatChildRecords.length},Vi.prototype.createSummaryItem=function(e,t){for(var i=0,r=Object.keys(t.columns).length;i<r;i++)for(var n=C.isNullOrUndefined(t.columns[parseInt(i.toString(),10)].columnName)?t.columns[parseInt(i.toString(),10)].field:t.columns[parseInt(i.toString(),10)].columnName,o=0,a=Object.keys(e);o<a.length;o++){var s,d=a[o];d===n&&(this.flatChildRecords.length?e[""+d]=this.getSummaryValues(t.columns[parseInt(i.toString(),10)],this.flatChildRecords):this.parent.isLocalData&&(s=this.parent.dataSource instanceof b.DataManager?this.parent.dataSource.dataSource.json:this.parent.flatData,e[""+d]=this.getSummaryValues(t.columns[parseInt(i.toString(),10)],s)))}return e},Vi.prototype.getSummaryValues=function(e,t){for(var i=new b.Query,r={},n={},o=C.isNullOrUndefined(e.field)?void 0:this.parent.getColumnByField(e.field).type,a=(e.setPropertiesSilent({format:this.getFormatFromType(e.format,o)}),e.setFormatter(this.parent.grid.locale),e.getFormatter()||function(e){return e}),o=(e.setTemplate(n),e.getTemplate(2)),s=(i.queries=this.summaryQuery,i.requiresCount(),new b.DataManager(t).executeLocal(i)),d=e.type,d=[e.type],l=0;l<d.length;l++){var p=d[parseInt(l.toString(),10)],h=e.field+" - "+d[parseInt(l.toString(),10)].toLowerCase(),c="Custom"!==d[parseInt(l.toString(),10)]?I.getObject("aggregates",s):I.calculateAggregate(d[parseInt(l.toString(),10)],s,e,this.parent),u=e.columnName,g="Custom"!==d[parseInt(l.toString(),10)]?c[h]:c;r[""+u]=r[""+u]||{},r[""+u][h]=g,r[""+u][d[parseInt(l.toString(),10)]]=C.isNullOrUndefined(c)?" ":a(g)}n.format=e.getFormatter();t=C.createElement("td",{className:"e-summary"}),this.parent.isReact?(o.fn(r[e.columnName],this.parent,o.property,"",null,null,t),this.parent.renderReactTemplates()):I.appendChildren(t,o.fn(r[e.columnName],this.parent,o.property)),i=r[""+e.columnName][""+p];return-1===t.innerHTML.indexOf(i)?t.innerHTML+i:t.innerHTML},Vi.prototype.getFormatFromType=function(e,t){if(C.isNullOrUndefined(t)||"string"!=typeof e)return e;var i;switch(t){case"number":i={format:e};break;case"datetime":i={type:"dateTime",skeleton:e};break;case"date":i={type:t,skeleton:e}}return i},Vi.prototype.destroy=function(){this.removeEventListener()};var Ti=Vi;function Vi(e){I.Grid.Inject(I.Aggregate),this.parent=e,this.flatChildRecords=[],this.summaryQuery=[]}P.prototype.getModuleName=function(){return"sort"},P.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this),this.parent.on("createSort",this.createdSortedRecords,this)},P.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateModel",this.updateModel),this.parent.off("createSort",this.createdSortedRecords))},P.prototype.createdSortedRecords=function(e){var t=e.modifiedData,i=e.srtQry;this.iterateSort(t,i),this.storedIndex=-1,e.modifiedData=this.flatSortedData,this.flatSortedData=[]},P.prototype.iterateSort=function(e,t){for(var i,r,n=0;n<e.length;n++)(0<this.parent.grid.filterSettings.columns.length||""!==this.parent.grid.searchSettings.key)&&C.isNullOrUndefined(x(this.parent,e[parseInt(n.toString(),10)].uniqueID,!0))||(this.storedIndex++,this.flatSortedData[this.storedIndex]=e[parseInt(n.toString(),10)]),e[parseInt(n.toString(),10)].hasChildRecords&&(i=new b.DataManager(e[parseInt(n.toString(),10)].childRecords).executeLocal(t),this.parent.allowRowDragAndDrop&&-1!==e[parseInt(n.toString(),10)].childRecords.indexOf(this.parent.rowDragAndDropModule.draggedRecord)&&"middleSegment"!==this.parent.rowDragAndDropModule.dropPosition&&(r=i.indexOf(this.parent.rowDragAndDropModule.draggedRecord),i.splice(r,1),r=i.indexOf(this.parent.rowDragAndDropModule.droppedRecord),"topSegment"===this.parent.rowDragAndDropModule.dropPosition?i.splice(r,0,this.parent.rowDragAndDropModule.draggedRecord):"bottomSegment"===this.parent.rowDragAndDropModule.dropPosition&&i.splice(r+1,0,this.parent.rowDragAndDropModule.draggedRecord)),this.iterateSort(i,t))},P.prototype.sortColumn=function(e,t,i){this.parent.grid.sortColumn(e,t,i)},P.prototype.removeSortColumn=function(e){this.parent.grid.removeSortColumn(e)},P.prototype.updateModel=function(){this.parent.setProperties({sortSettings:I.getActualProperties(this.parent.grid.sortSettings)},!0)},P.prototype.clearSorting=function(){this.parent.grid.clearSorting(),this.updateModel()},P.prototype.destroy=function(){this.removeEventListener()};var Bi=P;function P(e){I.Grid.Inject(I.Sort),this.parent=e,this.taskIds=[],this.flatSortedData=[],this.storedIndex=-1,this.isSelfReference=!C.isNullOrUndefined(this.parent.parentIdMapping),this.addEventListener()}Li.prototype.getColumnMenu=function(){return this.parent.grid.columnMenuModule.getColumnMenu()},Li.prototype.destroy=function(){},Li.prototype.getModuleName=function(){return"columnMenu"};var zi=Li;function Li(e){I.Grid.Inject(I.ColumnMenu),this.parent=e}Fi.prototype.addEventListener=function(){this.parent.on("contextMenuOpen",this.contextMenuOpen,this),this.parent.on("contextMenuClick",this.contextMenuClick,this)},Fi.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("contextMenuOpen",this.contextMenuOpen),this.parent.off("contextMenuClick",this.contextMenuClick))},Fi.prototype.contextMenuOpen=function(e){var t=C.select("#"+this.parent.element.id+"_gridcontrol_cmenu_AddRow",e.element),i=C.select("#"+this.parent.element.id+"_gridcontrol_cmenu_Edit",e.element),r=C.select("#"+this.parent.element.id+"_gridcontrol_cmenu_Indent",e.element),n=C.select("#"+this.parent.element.id+"_gridcontrol_cmenu_Outdent",e.element),o=(t&&(!1===this.parent.grid.editSettings.allowAdding||this.parent.grid.isEdit?t.style.display="none":t.style.display="block"),"Cell"!==this.parent.editSettings.mode&&"Batch"!==this.parent.editSettings.mode||C.isNullOrUndefined(i)||i.classList.contains("e-menu-hide")||(i.style.display="none"),this.parent),t=o.getSelectedRows()[0];if(!r&&!n||C.isNullOrUndefined(t)){if((r||n||o.grid.isEdit)&&C.isNullOrUndefined(t)){for(var a=0,s=e.items;a<s.length;a++)"Outdent"!==(d=s[a]).text&&"Indent"!==d.text||o.grid.contextMenuModule.hiddenItems.push(d.text);o.grid.contextMenuModule.contextMenu.hideItems(o.grid.contextMenuModule.hiddenItems),r.style.display=n.style.display="none"}}else{var i=e.event.target.closest("td");if(!C.isNullOrUndefined(i)&&(C.isNullOrUndefined(i)||i.classList.contains("e-rowcell")&&0===i.querySelectorAll(".e-gridform").length))0===t.rowIndex||1<o.getSelectedRowIndexes().length?r.style.display=n.style.display="none":("rowDeselected"!==e.name||!C.isNullOrUndefined(t)&&o.grid.isCheckBoxSelection)&&(i=o.getCurrentViewRecords()[t.rowIndex],C.isNullOrUndefined(i)||(i.level>o.getCurrentViewRecords()[t.rowIndex-1].level?r.style.display="none":r.style.display="block",i.level===o.getCurrentViewRecords()[t.rowIndex-1].level&&(r.style.display="block"),0===i.level?n.style.display="none":n.style.display="block"));else{for(var d,l=0,p=e.items;l<p.length;l++)"Outdent"!==(d=p[l]).text&&"Indent"!==d.text||o.grid.contextMenuModule.hiddenItems.push(d.text);o.grid.contextMenuModule.contextMenu.hideItems(o.grid.contextMenuModule.hiddenItems),r.style.display=n.style.display="none"}}},Fi.prototype.contextMenuClick=function(e){"Above"!==e.item.id&&"Below"!==e.item.id&&"Child"!==e.item.id||(this.parent.notify("savePreviousRowPosition",e),this.parent.setProperties({editSettings:{newRowPosition:e.item.id}},!0),this.parent.editModule.isAddedRowByContextMenu=!0,this.parent.addRecord()),e.item.id!==this.parent.element.id+"_gridcontrol_cmenu_Indent"&&e.item.id!==this.parent.element.id+"_gridcontrol_cmenu_Outdent"||C.isNullOrUndefined(this.parent.rowDragAndDropModule)||(e=e.item.id===this.parent.element.id+"_gridcontrol_cmenu_Indent"?"indent":"outdent",this.parent.rowDragAndDropModule.indentOutdentAction(null,e))},Fi.prototype.getModuleName=function(){return"contextMenu"},Fi.prototype.destroy=function(){this.removeEventListener()},Fi.prototype.getContextMenu=function(){return this.parent.grid.contextMenuModule.getContextMenu()};var ji=Fi;function Fi(e){I.Grid.Inject(I.ContextMenu),this.parent=e,this.addEventListener()}E.prototype.addEventListener=function(){this.parent.on(Je,this.cellSaved,this),this.parent.on(et,this.batchAdd,this),this.parent.on(it,this.beforeBatchAdd,this),this.parent.on(nt,this.batchSave,this),this.parent.on(tt,this.beforeBatchDelete,this),this.parent.on(rt,this.beforeBatchSave,this),this.parent.on("batchPageAction",this.batchPageAction,this),this.parent.on("batchCancelAction",this.batchCancelAction,this),this.parent.grid.on("immutable-batch-cancel",this.immutableBatchAction,this),this.parent.grid.on("next-cell-index",this.nextCellIndex,this)},E.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Je,this.cellSaved),this.parent.off(et,this.batchAdd),this.parent.off(nt,this.batchSave),this.parent.off(it,this.beforeBatchAdd),this.parent.off(tt,this.beforeBatchDelete),this.parent.off(rt,this.beforeBatchSave),this.parent.off("batchPageAction",this.batchPageAction),this.parent.off("batchCancelAction",this.batchCancelAction),this.parent.grid.off("immutable-batch-cancel",this.immutableBatchAction),this.parent.grid.off("next-cell-index",this.nextCellIndex))},E.prototype.destroy=function(){this.removeEventListener()},E.prototype.getBatchRecords=function(){return this.batchRecords},E.prototype.getAddRowIndex=function(){return this.addRowIndex},E.prototype.getSelectedIndex=function(){return this.selectedIndex},E.prototype.getBatchChildCount=function(){return this.batchChildCount},E.prototype.batchPageAction=function(){var e,t=this.parent.grid.dataSource instanceof b.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,i=this.parent.grid.getPrimaryKeyFieldNames()[0];if(!C.isNullOrUndefined(this.batchAddedRecords)&&this.batchAddedRecords.length)for(var r=0;r<this.batchAddedRecords.length;r++)e=t.map(function(e){return e[""+i]}).indexOf(this.batchAddedRecords[parseInt(r.toString(),10)][""+i]),t.splice(e,1);this.batchAddedRecords=this.batchRecords=this.batchAddRowRecord=this.batchDeletedRecords=this.currentViewRecords=[]},E.prototype.cellSaved=function(e){var t,i,r,n,o,a,s,d,l,p,h,c;e.column.index===this.parent.treeColumnIndex&&this.parent.renderModule.cellRender({data:e.rowData,cell:e.cell,column:this.parent.grid.getColumnByIndex(e.column.index)}),this.isAdd&&"Batch"===this.parent.editSettings.mode&&"Bottom"!==this.parent.editSettings.newRowPosition&&(e=this.parent.grid.dataSource instanceof b.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,t=void 0,i=this.parent.grid.getPrimaryKeyFieldNames()[0],r=h=void 0,n="parentItem",o=-1<this.selectedIndex?this.batchRecords[parseInt(this.addRowIndex.toString(),10)][n]:null,d=s=a=void 0,c="Top"===this.parent.editSettings.newRowPosition||-1===this.selectedIndex?0:"Above"===this.parent.editSettings.newRowPosition?this.addRowIndex:this.addRowIndex+1,c=this.getActualRowObjectIndex(c),this.newBatchRowAdded)&&(this.batchRecords.length&&(a=this.batchRecords[this.addRowIndex][this.parent.idMapping],d=this.batchRecords[this.addRowIndex][this.parent.parentIdMapping],this.batchRecords[parseInt(this.addRowIndex.toString(),10)][n])&&(s=this.batchRecords[parseInt(this.addRowIndex.toString(),10)][n].uniqueID),this.batchAddedRecords=D(this.batchAddedRecords),this.batchAddRowRecord=D(this.batchAddRowRecord),this.batchAddRowRecord.push(this.batchRecords[this.addRowIndex]),(t=this.parent.grid.getRowsObject()[parseInt(c.toString(),10)].changes).uniqueID=I.getUid(this.parent.element.id+"_data_"),C.setValue("uniqueIDCollection."+t.uniqueID,t,this.parent),Object.prototype.hasOwnProperty.call(t,"level")||(this.batchIndex=-1===this.selectedIndex?0:this.batchIndex,"Child"===this.parent.editSettings.newRowPosition?(t.primaryParent=o,-1<this.selectedIndex&&(t.parentItem=C.extend({},this.batchRecords[this.addRowIndex]),t.parentUniqueID=t.parentItem.uniqueID,delete t.parentItem.childRecords,delete t.parentItem[this.parent.childMapping],t.level=t.parentItem.level+1,t.index=this.batchIndex,l=R(this.batchRecords[this.addRowIndex]).length,p=R(this.batchRecords[this.addRowIndex])[l-1],p=C.isNullOrUndefined(p)?this.batchRecords[this.addRowIndex]:p,h=e.map(function(e){return e[""+i]}).indexOf(p[""+i]),this.isSelfReference&&(t[this.parent.parentIdMapping]=a),M(i,t.parentItem,"add",this.parent,this.isSelfReference,t))):"Above"!==this.parent.editSettings.newRowPosition&&"Below"!==this.parent.editSettings.newRowPosition||C.isNullOrUndefined(this.batchRecords[this.addRowIndex])||(t.level=this.batchRecords[parseInt(this.addRowIndex.toString(),10)].level,t.level&&-1<this.selectedIndex&&(t.parentItem=o,t.parentUniqueID=s,delete t.parentItem.childRecords,delete t.parentItem[this.parent.childMapping]),t.index="Below"===this.parent.editSettings.newRowPosition?this.batchIndex:this.batchIndex-1,"Below"===this.parent.editSettings.newRowPosition&&-1<this.selectedIndex&&(l=R(this.batchRecords[this.addRowIndex]).length,p=R(this.batchRecords[this.addRowIndex])[l-1],p=C.isNullOrUndefined(p)?this.batchRecords[this.addRowIndex]:p,h=e.map(function(e){return e[""+i]}).indexOf(p[""+i])),"Above"===this.parent.editSettings.newRowPosition&&-1<this.selectedIndex&&(p=this.batchRecords[this.addRowIndex],h=e.map(function(e){return e[""+i]}).indexOf(p[""+i])),this.isSelfReference&&(t[this.parent.parentIdMapping]=d)),t.index=-1===t.index?0:t.index,t.hasChildRecords=!1,t.childRecords=[],this.batchRecords.splice(t.index,0,t),this.currentViewRecords.splice(t.index,0,t),r=h||t.index,"Above"!==this.parent.editSettings.newRowPosition&&(r=0===t.index?r:r+1),e.splice(r,0,t),this.batchAddedRecords.push(t)),this.parent.grid.getRowsObject()[parseInt(c.toString(),10)].data=t,this.newBatchRowAdded=!1)},E.prototype.beforeBatchAdd=function(e){var t="isTabLastRow";"Cell"===this.parent.editSettings.mode&&this.parent.editModule[t]?(e.cancel=!0,this.parent.editModule[t]=!1):!this.parent.editModule.isAddedRowByMethod||C.isNullOrUndefined(this.parent.editModule.addRowIndex)||this.parent.editModule.isAddedRowByContextMenu||-1!==this.parent.grid.selectedRowIndex&&!this.parent.editModule.batchEditModule.isAdd?(this.selectedIndex=this.parent.grid.selectedRowIndex,this.addRowIndex=-1<this.parent.grid.selectedRowIndex?this.parent.grid.selectedRowIndex:0,this.parent.editModule.addRowIndex=-1<this.parent.grid.selectedRowIndex?this.parent.grid.selectedRowIndex:0,this.addRowRecord=this.parent.getSelectedRecords()[0]):(this.selectedIndex=this.parent.editModule.selectedIndex,this.addRowIndex=this.parent.editModule.addRowIndex,this.addRowRecord=(this.batchRecords.length?this.batchRecords:this.parent.getCurrentViewRecords())[this.selectedIndex])},E.prototype.batchAdd=function(e){var t,i,r;"Bottom"!==this.parent.editSettings.newRowPosition&&(this.isAdd=!0,this.newBatchRowAdded=!0,t=0,this.batchRecords.length||(this.batchAddedRecords=[],this.batchRecords=D(this.parent.grid.getCurrentViewRecords()),this.currentViewRecords=D(this.parent.grid.getCurrentViewRecords())),this.parent.editModule.isAddedRowByMethod&&!C.isNullOrUndefined(this.parent.editModule.addRowIndex)&&C.classList(this.parent.grid.getDataRows()[0],["e-batchrow"],[]),"Top"!==this.parent.editSettings.newRowPosition&&(i=this.parent.grid.getCurrentViewRecords(),"Batch"===this.parent.editSettings.mode&&(1<this.parent.getBatchChanges()[this.addedRecords].length||this.parent.getBatchChanges()[this.deletedRecords].length)&&(i=this.batchRecords),this.updateChildCount(i),this.parent.notify(Ke,{}),this.batchChildCount=0),this.updateRowIndex(),i=C.getValue("focusModule",this.parent.grid),r=this.parent.getContentTable(),this.parent.getBatchChanges()[this.deletedRecords].length&&"Above"===this.parent.editSettings.newRowPosition?(t=e.row.rowIndex,i.getContent().matrix.matrix=this.matrix):t=r.getElementsByClassName("e-batchrow")[0].rowIndex,i.getContent().matrix.current=[t,i.getContent().matrix.current[1]],!this.parent.editModule.isAddedRowByMethod||C.isNullOrUndefined(this.parent.editModule.addRowIndex)||this.parent.editModule.isAddedRowByContextMenu||(e=this.parent.getBatchChanges().addedRecords,r=parseInt(this.parent.getContentTable().getElementsByClassName("e-insertedrow")[e.length-1].getAttribute("data-rowindex"),10),this.batchRecords.splice(r,0,e[e.length-1])))},E.prototype.beforeBatchDelete=function(e){this.batchRecords.length||(this.batchRecords=D(this.parent.grid.getCurrentViewRecords()),this.currentViewRecords=D(this.parent.grid.getCurrentViewRecords()));var t,i,r=C.getValue("focusModule",this.parent.grid),n=(this.matrix=r.getContent().matrix.matrix,[]),o=this.parent.grid.getPrimaryKeyFieldNames()[0],r=(C.isNullOrUndefined(e.row)||-1!==this.parent.getSelectedRows().indexOf(e.row)?(i=R(t=this.parent.grid.getSelectedRecords()[this.parent.grid.getSelectedRecords().length-1]),this.parent.getSelectedRows()[0]):(i=R(t=e.rowData),e.row)).getAttribute("data-uid"),e=parseInt(this.parent.grid.getRowElementByUID(r).getAttribute("data-rowindex"),10);if(i.length)for(var a=e+i.length,s=e+1;s<=a;s++)n.push(this.parent.grid.getDataRows()[parseInt(s.toString(),10)]),(this.parent.frozenRows||this.parent.frozenColumns||this.parent.getFrozenColumns())&&n.push(this.parent.grid.getHeaderContent()[parseInt(s.toString(),10)]);C.isNullOrUndefined(t.parentItem)||(r=x(this.parent,t.parentItem.uniqueID),!C.isNullOrUndefined(r)&&r.hasChildRecords&&(e=r.childRecords.indexOf(t),r.childRecords.splice(e,1)),this.batchDeletedRecords=D(this.batchDeletedRecords),this.batchDeletedRecords.push(t)),i.push(t);for(var d=i,s=0;s<d.length;s++){var l=this.batchRecords.map(function(e){return e[""+o]}).indexOf(d[parseInt(s.toString(),10)][""+o]);-1!==l&&this.batchRecords.splice(l,1)}for(s=0;s<n.length;s++)C.isNullOrUndefined(n[parseInt(s.toString(),10)])||this.parent.grid.selectionModule.selectedRecords.push(n[parseInt(s.toString(),10)])},E.prototype.updateRowIndex=function(){for(var e=this.parent.grid.getDataRows(),t=0;t<e.length;t++)e[parseInt(t.toString(),10)].setAttribute("data-rowindex",t.toString())},E.prototype.updateChildCount=function(e){for(var t=this.parent.grid.getPrimaryKeyFieldNames()[0],i="addedRecords",r="Child"===this.parent.editSettings.newRowPosition?"primaryParent":"parentItem",n=0;n<this.parent.getBatchChanges()[i].length;n++)C.isNullOrUndefined(this.parent.getBatchChanges()[i][parseInt(n.toString(),10)][r])||this.parent.getBatchChanges()[i][parseInt(n.toString(),10)][r][""+t]===e[parseInt(this.addRowIndex.toString(),10)][""+t]&&(this.batchChildCount=this.batchChildCount+1)},E.prototype.beforeBatchSave=function(e){var t="changedRecords",i="deletedRecords",r=e.batchChanges[t];if(e.batchChanges[t].length)for(var n=0;n<r.length;n++)pi({value:r[parseInt(n.toString(),10)],action:"edit"},this.parent,this.isSelfReference,this.addRowIndex,this.selectedIndex,void 0);if(e.batchChanges[i].length)for(var o=e.batchChanges[i],n=0;n<o.length;n++){this.deleteUniqueID(o[parseInt(n.toString(),10)].uniqueID);for(var a=R(o[parseInt(n.toString(),10)]),s=0;s<a.length;s++)this.deleteUniqueID(a[parseInt(s.toString(),10)].uniqueID);e.batchChanges[i]=e.batchChanges[i].concat(a)}this.isAdd=!1},E.prototype.deleteUniqueID=function(e){delete this.parent.uniqueIDFilterCollection[""+e];delete this.parent.uniqueIDCollection[""+e]},E.prototype.batchCancelAction=function(){var e,t="targetElement",i="parentItem",r="index",n=this.parent.grid.getCurrentViewRecords(),o="childRecords",a=this.parent.grid.dataSource instanceof b.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,s=this.parent.grid.getPrimaryKeyFieldNames()[0];if(!C.isNullOrUndefined(this.batchAddedRecords))for(var d=0;d<this.batchAddedRecords.length;d++)if(-1!==(h=a.map(function(e){return e[""+s]}).indexOf(this.batchAddedRecords[parseInt(d.toString(),10)][""+s]))&&a.splice(h,1),"Child"===this.parent.editSettings.newRowPosition&&(h=n.map(function(e){return e[""+s]}).indexOf((this.batchAddedRecords[parseInt(d.toString(),10)][i]?this.batchAddedRecords[parseInt(d.toString(),10)][i]:this.batchAddedRecords[parseInt(d.toString(),10)])[""+s]),!C.isNullOrUndefined(n[parseInt(h.toString(),10)])))for(var l=n[parseInt(h.toString(),10)][o],p=0;l&&p<l.length;p++)l[parseInt(p.toString(),10)][""+s]===this.batchAddedRecords[parseInt(d.toString(),10)][""+s]&&n[parseInt(h.toString(),10)][o].splice(p,1);if(C.isNullOrUndefined(this.parent[t])||(e=this.parent[t].closest("tr"),this.parent.collapseRow(e),this.parent[t]=null),!C.isNullOrUndefined(this.batchDeletedRecords))for(var h,c,d=0;d<this.batchDeletedRecords.length;d++)C.isNullOrUndefined(this.batchDeletedRecords[parseInt(d.toString(),10)][i])||(h=n.map(function(e){return e[""+s]}).indexOf(this.batchDeletedRecords[parseInt(d.toString(),10)][i][""+s]),c=0===this.batchDeletedRecords[parseInt(d.toString(),10)][r]?this.batchDeletedRecords[parseInt(d.toString(),10)][r]:this.batchDeletedRecords[parseInt(d.toString(),10)][r]-1,C.isNullOrUndefined(n[parseInt(h.toString(),10)]))||n[parseInt(h.toString(),10)][o].splice(c,0,this.batchDeletedRecords[parseInt(d.toString(),10)]);this.batchAddedRecords=this.batchRecords=this.batchAddRowRecord=this.currentViewRecords=[],this.batchRecords=D(this.parent.grid.getCurrentViewRecords()),this.batchIndex=0,this.currentViewRecords=D(this.parent.grid.getCurrentViewRecords()),this.batchDeletedRecords=[],this.parent.grid.renderModule.refresh()},E.prototype.batchSave=function(e){if("Batch"===this.parent.editSettings.mode){var t,i,r,n=void 0,o=Object.hasOwnProperty.call(e,"updatedRecords")?e.updatedRecords:this.parent.getBatchChanges(),a="deletedRecords",s=this.parent.grid.dataSource instanceof b.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,d=this.parent.grid.getCurrentViewRecords(),l=this.parent.grid.getPrimaryKeyFieldNames()[0],p=o.addedRecords,h="parentItem",c=void 0,u=void 0,g=void 0,f="childRecords";if(1<p.length&&"Bottom"!==this.parent.editSettings.newRowPosition&&p.reverse(),"Bottom"!==this.parent.editSettings.newRowPosition&&!Object.hasOwnProperty.call(e,"updatedRecords")){if(s.splice(s.length-p.length,p.length),this.parent.editModule.isAddedRowByMethod&&p.length&&!C.isNullOrUndefined(this.parent.editModule.addRowIndex)&&!this.parent.editModule.isAddedRowByContextMenu){p.reverse();for(var m=0;m<p.length;m++){var y=parseInt(this.parent.getContentTable().getElementsByClassName("e-insertedrow")[parseInt(m.toString(),10)].getAttribute("data-rowindex"),10);s.splice(y,0,p[parseInt(m.toString(),10)])}}this.parent.allowPaging||s.length===d.length?(t=D(s)).length&&(r=(i=t.map(function(e){return e[""+l]}).indexOf(d[0][""+l]))+this.parent.grid.pageSettings.pageSize,d=t.splice(i,r)):d.length>p.length&&d.splice(d.length-p.length,p.length)}for(0===this.batchAddRowRecord.length&&this.batchAddRowRecord.push(this.parent.flatData[e.index]),this.parent.editModule.isAddedRowByContextMenu&&p.reverse(),n=0;n<p.length;n++){var S,w=C.extend({},p[parseInt(n.toString(),10)]);if(delete w.parentItem,delete w.uniqueID,delete w.index,delete w.level,delete w.hasChildRecords,delete w.childRecords,delete w.parentUniqueID,C.isNullOrUndefined(w.primaryParent)||delete w.primaryParent,1<p.length&&this.parent.editModule.isAddedRowByContextMenu&&(S=this.parent.editSettings.newRowPosition,this.parent.editSettings.newRowPosition=this.parent.editModule.previousNewRowPosition,this.parent.editModule.previousNewRowPosition=S),p[parseInt(n.toString(),10)].taskData=w,g=this.batchAddRowRecord[parseInt(n.toString(),10)],C.isNullOrUndefined(g)&&(g=this.batchAddRowRecord[n-1]),!this.isSelfReference||C.isNullOrUndefined(p[parseInt(n.toString(),10)].parentItem)||M(l,p[parseInt(n.toString(),10)].parentItem,"add",this.parent,this.isSelfReference,p[parseInt(n.toString(),10)]),C.isNullOrUndefined(g)||(u=g.index),"Top"!==this.parent.editSettings.newRowPosition&&"Bottom"!==this.parent.editSettings.newRowPosition&&C.isNullOrUndefined(p[parseInt(n.toString(),10)].parentItem)&&-1===this.selectedIndex&&(c=-1,g=null),pi({value:p[parseInt(n.toString(),10)],action:"add"},this.parent,this.isSelfReference,u,c,void 0,g),c=null,"Child"===this.parent.editSettings.newRowPosition&&!C.isNullOrUndefined(p[parseInt(n.toString(),10)][h])&&(C.isNullOrUndefined(this.parent.editModule.addRowIndex)||this.isSelfReference))for(var I=d.map(function(e){return e[""+l]}).indexOf(p[parseInt(n.toString(),10)][h][""+l]),R=d[parseInt(I.toString(),10)][f],v=0;v<R.length;v++)R[parseInt(v.toString(),10)][""+l]===p[parseInt(n.toString(),10)][""+l]&&d[parseInt(I.toString(),10)][f].splice(v,1)}if(o[a].length)for(n=0;n<o[a].length;n++)pi({value:o[a][parseInt(n.toString(),10)],action:"delete"},this.parent,this.isSelfReference,u,c,void 0,g);this.parent.parentData=[];for(var x=0;x<s.length;x++)s[parseInt(x.toString(),10)].index=x,C.setValue("uniqueIDCollection."+s[parseInt(x.toString(),10)].uniqueID+".index",x,this.parent),s[parseInt(x.toString(),10)].level||this.parent.parentData.push(s[parseInt(x.toString(),10)])}this.batchAddRowRecord=this.batchAddedRecords=this.batchRecords=this.batchDeletedRecords=this.currentViewRecords=[],this.parent.editModule.isAddedRowByContextMenu&&(this.parent.editModule.isAddedRowByContextMenu=!1)},E.prototype.getActualRowObjectIndex=function(e){var t=this.parent.grid.getDataRows();return("Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&-1<this.selectedIndex&&(!C.isNullOrUndefined(this.batchRecords[this.addRowIndex])&&this.batchRecords[this.addRowIndex].expanded&&(1<this.parent.getBatchChanges()[this.addedRecords].length||this.parent.getBatchChanges()[this.deletedRecords].length?(e+=R(this.batchRecords[this.addRowIndex]).length,"Child"!==this.parent.editSettings.newRowPosition&&(e+=this.getBatchChildCount())):e+=R(this.batchRecords[this.addRowIndex]).length),e>=t.length&&(e=t.length-1),this.updateChildCount(this.parent.grid.getCurrentViewRecords()),this.batchChildCount&&(e+=this.batchChildCount),this.batchChildCount=0),e},E.prototype.immutableBatchAction=function(e){e.args.cancel=!0;var t=this.parent.grid.getBatchChanges(),i=[];Object.keys(t).length&&(i=t.addedRecords);for(var r=0;r<i.length;r++)e.rows.splice(i[parseInt(r.toString(),10)].index,1)},E.prototype.nextCellIndex=function(e){this.parent.getSelectedRows().length?e.index=this.parent.getSelectedRows()[0].rowIndex:e.index=this.batchIndex};var _i=E;function E(e){this.batchChildCount=0,this.addedRecords="addedRecords",this.deletedRecords="deletedRecords",this.batchAddedRecords=[],this.batchDeletedRecords=[],this.batchAddRowRecord=[],this.parent=e,this.isSelfReference=!C.isNullOrUndefined(e.parentIdMapping),this.batchRecords=[],this.currentViewRecords=[],this.isAdd=!1,this.addEventListener()}N.prototype.getModuleName=function(){return"edit"},N.prototype.addEventListener=function(){this.parent.on(Ge,this.crudAction,this),this.parent.on(Qe,this.beginEdit,this),this.parent.on(Ke,this.beginAdd,this),this.parent.on(We,this.recordDoubleClick,this),this.parent.on(Ye,this.cellSave,this),this.parent.on(Ze,this.batchCancel,this),this.parent.grid.on(ot,this.keyPressed,this),this.parent.grid.on("batchedit-form",this.lastCellTab,this),this.parent.grid.on("content-ready",this.contentready,this),this.parent.on(Xe,this.cellEdit,this),this.parent.on("actionBegin",this.editActionEvents,this),this.parent.on("actionComplete",this.editActionEvents,this),this.parent.grid.on(at,this.recordDoubleClick,this),this.parent.grid.on("dblclick",this.gridDblClick,this),this.parent.grid.on("recordAdded",this.customCellSave,this),this.parent.on("savePreviousRowPosition",this.savePreviousRowPosition,this),this.parent.grid.on(ht,this.beforeStartEdit,this),this.parent.grid.on(ct,this.beforeBatchCancel,this),this.parent.grid.on("reset-edit-props",this.resetIsOnBatch,this),this.parent.grid.on("get-row-position",this.getRowPosition,this)},N.prototype.gridDblClick=function(e){this.doubleClickTarget=e.target,e.target.classList.contains("e-frame")&&0===this.parent.getCurrentViewRecords().length&&(this.doubleClickTarget=null),(e.target.classList.contains("e-treegridcollapse")||e.target.classList.contains("e-treegridexpand"))&&(e=(e=I.parentsUntil(e.target,"e-row"))&&parseInt(e.getAttribute("data-rowindex"),10),!C.isNullOrUndefined(e))&&0<=e&&this.parent.allowPaging&&(this.parent.grid.getDataRows()[e].dataset.uid=this.parent.grid.contentModule.getRows()[e].uid)},N.prototype.getRowPosition=function(e){e.newRowPosition=this.parent.editSettings.newRowPosition,e.addRowIndex=this.addRowIndex,e.dataRowIndex=+this.prevAriaRowIndex},N.prototype.beforeStartEdit=function(e){"Cell"===this.parent.editSettings.mode&&this.parent.trigger(ve,e)},N.prototype.beforeBatchCancel=function(e){"Cell"===this.parent.editSettings.mode&&(e.requestType="cancel",this.parent.trigger(Ce,e))},N.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ge,this.crudAction),this.parent.off(Qe,this.beginEdit),this.parent.off(Ke,this.beginAdd),this.parent.off(We,this.recordDoubleClick),this.parent.off(Ze,this.batchCancel),this.parent.grid.off(ot,this.keyPressed),this.parent.grid.off("batchedit-form",this.lastCellTab),this.parent.grid.off("content-ready",this.contentready),this.parent.off(Xe,this.cellEdit),this.parent.off("actionBegin",this.editActionEvents),this.parent.off("actionComplete",this.editActionEvents),this.parent.grid.off("recordAdded",this.customCellSave),this.parent.grid.off(at,this.recordDoubleClick),this.parent.off("savePreviousRowPosition",this.savePreviousRowPosition),this.parent.grid.off(ht,this.beforeStartEdit),this.parent.grid.off(ct,this.beforeBatchCancel),this.parent.grid.off("dblclick",this.gridDblClick),this.parent.grid.off("reset-edit-props",this.resetIsOnBatch),this.parent.grid.off("get-row-position",this.getRowPosition))},N.prototype.destroy=function(){this.removeEventListener()},N.prototype.applyFormValidation=function(e){this.parent.grid.editModule.applyFormValidation(e)},N.prototype.editActionEvents=function(e){var e=I.getObject("editAction",e),t=I.getObject("name",e),i=this.parent,r=!C.isNullOrUndefined(i.dataSource)&&i.dataSource.adaptor;if(!C.isNullOrUndefined(r)&&(S(i)||r instanceof b.RemoteSaveAdaptor)&&"save"===e.requestType&&"add"===e.action&&("Child"===i.editSettings.newRowPosition||"Below"===i.editSettings.newRowPosition||"Above"===i.editSettings.newRowPosition))if("actionBegin"===t){r=C.isNullOrUndefined(e.row)||!Object.keys(e.row).length?this.selectedIndex:e.row.rowIndex-1,r=C.isNullOrUndefined(r)||-1===r?-1:i.getCurrentViewRecords()[parseInt(r.toString(),10)][i.getPrimaryKeyFieldNames()[0]];i.grid.query.addParams("relationalKey",r)}else if("actionComplete"===t)for(var n=i.grid.query.params.length,o=0;o<n;o++)"relationalKey"===i.grid.query.params[parseInt(o.toString(),10)].key&&i.grid.query.params.splice(o);this.parent.enableInfiniteScrolling&&"actionComplete"===t&&this.infiniteAddAction(e),"Batch"===this.parent.editSettings.mode&&"paging"===e.requestType&&this.parent.notify("batchPageAction",{})},N.prototype.infiniteAddAction=function(e){var t,i,r;("save"===e.requestType&&"add"===e.action||"delete"===e.requestType)&&("Top"!==this.parent.editSettings.newRowPosition&&-1!==this.selectedIndex&&"save"===e.requestType&&"add"===e.action&&(t=(e=this.parent.grid.getRowsObject()).splice(0,1)[0],r=this.addRowIndex,i=this.parent.getCurrentViewRecords(),"Below"!==this.parent.editSettings.newRowPosition&&"Child"!==this.parent.editSettings.newRowPosition||(r+=R(i[r+1]).length),r="Below"===this.parent.editSettings.newRowPosition?r+1:r,e.splice(r,0,t),e=i.splice(0,1)[0],i.splice(r,0,e),this.updateInfiniteCurrentViewData(e,this.addRowIndex)),t=this.parent.grid.getRows(),i=this.parent.grid.getRowsObject(),(r=this.parent.infiniteScrollSettings.enableCache)||(I.resetRowIndex(this.parent.grid,this.parent.grid.getRowsObject(),this.parent.grid.getRows(),0),this.updateIndex(this.parent.grid.dataSource,this.parent.getRows(),this.parent.getCurrentViewRecords())),!r)&&0<this.parent.getFrozenColumns()&&(I.resetRowIndex(this.parent.grid,i,t,0),this.updateIndex(this.parent.grid.dataSource,t,this.parent.getCurrentViewRecords()))},N.prototype.updateInfiniteCurrentViewData=function(e,t){var i=this,r=Math.ceil(t/this.parent.grid.pageSettings.pageSize),r=0<r?r:1,n=t-(r-1)*this.parent.pageSettings.pageSize,t=this.parent.grid.infiniteScrollModule.infiniteCurrentViewData,o=(t[1].splice(0,1),t[parseInt(r.toString(),10)]);!C.isNullOrUndefined(this.addRowRecord)&&(o.filter(function(e,t){e.uniqueID===i.addRowRecord.uniqueID&&(n=t)}),this.addRowRecord.hasChildRecords&&this.addRowRecord.childRecords.length&&"Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&(n+=R(this.addRowRecord).length),n>=this.parent.pageSettings.pageSize&&(r+=1,o=t[parseInt(r.toString(),10)],n=0<=n-this.parent.pageSettings.pageSize?n-this.parent.pageSettings.pageSize:0),n="Below"===this.parent.editSettings.newRowPosition?n+1:n,o.splice(n,0,e),this.parent.grid.infiniteScrollModule.updateCurrentViewData()},N.prototype.recordDoubleClick=function(e){var t,i=e.target;C.isNullOrUndefined(i.closest("td.e-rowcell"))||this.parent.grid.editSettings.allowEditing&&!this.parent.grid.isEdit&&(t=this.parent.grid.getColumnByIndex(+i.closest("td.e-rowcell").getAttribute("data-colindex")),"Cell"===this.parent.editSettings.mode&&!this.isOnBatch&&t&&!t.isPrimaryKey&&this.parent.editSettings.allowEditing&&t.allowEditing&&!i.classList.contains("e-treegridexpand")&&!i.classList.contains("e-treegridcollapse")&&this.parent.editSettings.allowEditOnDblClick?(this.isOnBatch=!0,this.parent.grid.setProperties({selectedRowIndex:e.rowIndex},!0),this.parent.enableVirtualization&&(i=I.parentsUntil(e.target,"e-row"),this.prevAriaRowIndex=i.getAttribute("data-rowindex"),i.setAttribute("data-rowindex",i.rowIndex+"")),this.updateGridEditMode("Batch")):"Cell"!==this.parent.editSettings.mode||t.allowEditing&&!t.isPrimaryKey||(this.isOnBatch=!0,this.updateGridEditMode("Batch")))},N.prototype.updateGridEditMode=function(e){this.parent.grid.setProperties({editSettings:{mode:e}},!0),I.getObject("updateEditObj",this.parent.grid.editModule).apply(this.parent.grid.editModule),this.parent.grid.isEdit=!1},N.prototype.resetIsOnBatch=function(){this.parent.enableVirtualization&&"Cell"===this.parent.editSettings.mode&&(this.isOnBatch=!1,this.updateGridEditMode("Normal"))},N.prototype.keyPressed=function(e){this.isOnBatch&&(this.keyPress=e.action),"f2"===e.action&&this.recordDoubleClick(e),"escape"===e.action&&this.parent.closeEdit()},N.prototype.deleteUniqueID=function(e){delete this.parent.uniqueIDFilterCollection[""+e];delete this.parent.uniqueIDCollection[""+e]},N.prototype.cellEdit=function(e){var t=this,i="promise",r=e[i];delete e[i],this.parent.enableVirtualization&&!C.isNullOrUndefined(this.prevAriaRowIndex)&&"-1"!==this.prevAriaRowIndex&&(e.row.setAttribute("data-rowindex",this.prevAriaRowIndex),this.prevAriaRowIndex=void 0),"enter"!==this.keyPress&&this.parent.trigger(Xe,e,function(e){e.cancel||"Cell"!==t.parent.editSettings.mode?e.cancel&&"Cell"===t.parent.editSettings.mode&&(t.isOnBatch=!1,t.updateGridEditMode("Normal")):t.enableToolbarItems("edit"),C.isNullOrUndefined(r)||r.resolve(e)}),this.doubleClickTarget&&(this.doubleClickTarget.classList.contains("e-treegridexpand")||this.doubleClickTarget.classList.contains("e-treegridcollapse")||this.doubleClickTarget.classList.contains("e-summarycell"))?(e.cancel=!0,this.doubleClickTarget=null):("Cell"===this.parent.editSettings.mode&&("tab"===this.keyPress||"shiftTab"===this.keyPress?this.keyPress=null:"enter"===this.keyPress&&(e.cancel=!0,this.keyPress=null,C.setValue("isEditCollapse",!1,this.parent)),e.columnObject.allowEditing||(e.cancel=!0)),this.parent.enableVirtualization&&(this.parent.grid.contentModule.editedRowIndex=this.parent.grid.editModule.editModule.index))},N.prototype.enableToolbarItems=function(e){var t;C.isNullOrUndefined(this.parent.grid.toolbarModule)||(t=this.parent.element.id+"_gridcontrol_",this.parent.grid.toolbarModule.enableItems([t+"add",t+"edit",t+"delete"],"save"===e),this.parent.grid.toolbarModule.enableItems([t+"update",t+"cancel"],"edit"===e))},N.prototype.batchCancel=function(){var e,t;"Cell"===this.parent.editSettings.mode&&(e=C.getValue("editModule.cellDetails",this.parent.grid.editModule),t=this.parent.getCellFromIndex(e.rowIndex,this.parent.treeColumnIndex),this.parent.renderModule.cellRender({data:e.rowData,cell:t,column:this.parent.grid.getColumns()[this.parent.treeColumnIndex]}),this.updateGridEditMode("Normal"),this.isOnBatch=!1),"Batch"===this.parent.editSettings.mode&&this.parent.notify("batchCancelAction",{})},N.prototype.customCellSave=function(e){w(this.parent)&&"Cell"===this.parent.editSettings.mode&&"edit"===e.action&&(this.updateCell(e,e.rowIndex),this.afterCellSave(e,e.row))},N.prototype.cellSave=function(i){var t,r,n,e,o=this;"Cell"===this.parent.editSettings.mode&&this.parent.element.querySelector("form")&&(i.cancel=!0,C.setValue("isEditCollapse",!0,this.parent),i.rowData[i.columnName]=i.value,t=(C.isNullOrUndefined(i.cell)?this.parent.grid.editModule.editModule.form.parentElement:i.cell).parentNode,r=this.parent.getPrimaryKeyFieldNames(),C.isNullOrUndefined(t)?this.parent.grid.getCurrentViewRecords().filter(function(e,t){e[r[0]]===i.rowData[r[0]]&&(n=t)}):n=(0<this.parent.getFrozenLeftColumnsCount()||0<this.parent.getFrozenRightColumnsCount()?(this.parent.getRows().indexOf(t),this.parent):-1===this.parent.getRows().indexOf(t)&&0<this.parent.getFrozenColumns()?this.parent.grid:this.parent).getRows().indexOf(t),C.extend(e={},i),e.cancel=!1,e.type="save",t=this.parent.grid.getRows()[t.rowIndex],this.parent.trigger(ve,e),e.cancel?this.parent.grid.isEdit=!0:(t.rowIndex===this.parent.getCurrentViewRecords().length-1&&"tab"===this.keyPress&&(this.isTabLastRow=!0),S(this.parent)||this.parent.dataSource instanceof b.DataManager&&this.parent.dataSource.adaptor instanceof b.RemoteSaveAdaptor?(S(this.parent)||this.parent.dataSource instanceof b.DataManager&&this.parent.dataSource.adaptor instanceof b.RemoteSaveAdaptor)&&(e=this.parent.grid.query,this.parent.isGantt&&!this.parent.loadChildOnDemand?(this.updateCell(i,n),C.setValue("isEdit",!1,this.parent.grid),this.afterCellSave(i,t)):this.parent.grid.dataSource.update(r[0],i.rowData,e.fromTable,e,i.previousValue).then(function(e){C.isNullOrUndefined(e)||(i.rowData[i.columnName]=e[i.columnName]),o.updateCell(i,n),C.setValue("isEdit",!1,o.parent.grid),o.afterCellSave(i,t)})):w(this.parent)?(e={requestType:"save",data:i.rowData,action:"edit",row:t,rowIndex:n,rowData:i.rowData,columnName:i.columnName,filterChoiceCount:null,excelSearchOperator:null},this.parent.grid.getDataModule().eventPromise(e,this.parent.grid.query)):(this.updateCell(i,n),C.setValue("isEdit",!1,this.parent.grid),this.afterCellSave(i,t)))),this.parent.enableVirtualization&&(this.parent.grid.contentModule.virtualData={})},N.prototype.afterCellSave=function(e,t){this.parent.grid.aggregateModule&&this.parent.grid.aggregateModule.refresh(e.rowData),this.parent.grid.editModule.destroyWidgets([this.parent.grid.getColumnByField(e.columnName)]),this.parent.grid.editModule.formObj.destroy(),"tab"!==this.keyPress&&"shiftTab"!==this.keyPress&&(this.updateGridEditMode("Normal"),this.isOnBatch=!1),this.enableToolbarItems("save"),C.removeClass([t],["e-editedrow","e-batchrow"]),C.removeClass(t.querySelectorAll(".e-rowcell"),["e-editedbatchcell","e-updatedtd"]),!1!==this.parent.isCellSaveFocus&&this.parent.grid.focusModule.restoreFocus(),pi({value:e.rowData,action:"edit"},this.parent,this.isSelfReference,this.addRowIndex,this.selectedIndex,e.columnName),t.rowIndex===this.parent.getCurrentViewRecords().length-1&&"enter"===this.keyPress&&(this.keyPress=null);t={type:"save",column:this.parent.getColumnByField(e.columnName),data:e.rowData,previousData:e.previousValue,row:t,target:e.cell};this.parent.aggregates.map(function(e){return!0===e.showChildSummary}).length&&this.parent.grid.refresh(),this.parent.trigger(Ce,t)},N.prototype.lastCellTab=function(){!this.parent.grid.isEdit&&this.isOnBatch&&"tab"===this.keyPress&&"Cell"===this.parent.editSettings.mode&&(this.parent.editSettings.allowNextRowEdit?this.enableToolbarItems("edit"):(this.updateGridEditMode("Normal"),this.isOnBatch=!1,this.keyPress=null))},N.prototype.updateCell=function(e,t){this.parent.grid.editModule.updateCell(t,e.columnName,e.rowData[e.columnName]),this.parent.grid.getRowsObject()[parseInt(t.toString(),10)].data=e.rowData},N.prototype.crudAction=function(e,t){pi(e,this.parent,this.isSelfReference,this.addRowIndex,this.selectedIndex,t,this.addRowRecord),this.parent.parentData=[];for(var i=this.parent.grid.dataSource instanceof b.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,r=0;r<i.length;r++){i[parseInt(r.toString(),10)].index=r;var n=this.parent.grid.getPrimaryKeyFieldNames()[0],n=(e.value[""+n]===i[parseInt(r.toString(),10)][""+n]&&"add"===e.action&&(i[parseInt(r.toString(),10)].level=this.internalProperties.level,i[parseInt(r.toString(),10)].taskData=this.internalProperties.taskData,i[parseInt(r.toString(),10)].uniqueID=this.internalProperties.uniqueID,C.isNullOrUndefined(this.internalProperties.parentItem)||(i[parseInt(r.toString(),10)].parentItem=this.internalProperties.parentItem,i[parseInt(r.toString(),10)].parentUniqueID=this.internalProperties.parentUniqueID),i[parseInt(r.toString(),10)].childRecords=this.internalProperties.childRecords),C.setValue("uniqueIDCollection."+i[parseInt(r.toString(),10)].uniqueID+".index",r,this.parent),this.parent.dataSource.adaptor);(S(this.parent)||n instanceof b.RemoteSaveAdaptor)&&C.setValue("uniqueIDCollection."+i[parseInt(r.toString(),10)].uniqueID,i[parseInt(r.toString(),10)],this.parent),i[parseInt(r.toString(),10)].level||this.parent.parentData.push(i[parseInt(r.toString(),10)])}this.parent.enableInfiniteScrolling||"add"===e.action&&null!=this.previousNewRowPosition&&(this.parent.setProperties({editSettings:{newRowPosition:this.previousNewRowPosition}},!0),this.previousNewRowPosition=null)},N.prototype.updateIndex=function(e,t,i){for(var r=0;r<this.parent.getDataRows().length;r++){var n,o=i[parseInt(r.toString(),10)];C.isNullOrUndefined(o)||(c=C.getValue("uniqueIDCollection."+o.uniqueID+".index",this.parent),o.index=c,C.isNullOrUndefined(o.parentItem))||(n=C.getValue("uniqueIDCollection."+o.parentItem.uniqueID+".index",this.parent),o.parentItem.index=n)}var a=-1,s=this.parent.treeColumnIndex;if(0<this.parent.getFrozenColumns())for(var d=t[0].querySelectorAll(".e-rowcell"),l=0;l<d.length;l++)if(d[parseInt(l.toString(),10)].classList.contains("e-gridrowindex0level0")){s=l;break}for(var p=0;p<this.parent.getRows().length;p++){t[parseInt(p.toString(),10)].classList.contains("e-detailrow")||a++;var h=i[parseInt(a.toString(),10)];if(!C.isNullOrUndefined(h)){var c=h.index,u=h.level,g=t[parseInt(p.toString(),10)],f=(C.isNullOrUndefined(h.parentItem)||(c=C.getValue("uniqueIDCollection."+h.parentItem.uniqueID+".index",this.parent)),g.cells[parseInt(s.toString(),10)]);if(!C.isNullOrUndefined(f)){for(l=0;l<f.classList.length;l++){var m=f.classList[parseInt(l.toString(),10)],y=m.match(/e-gridrowindex/i),S=m.match(/e-griddetailrowindex/i);null!=y&&C.removeClass([f],m),null!=S&&C.removeClass([f],m)}t[parseInt(p.toString(),10)].classList.contains("e-detailrow")?C.addClass([f],"e-griddetailrowindex"+c+"level"+u):C.addClass([f],"e-gridrowindex"+c+"level"+u)}}}},N.prototype.beginAdd=function(){var e=this.addRowIndex,t=this.parent.grid.getCurrentViewRecords(),i=("Batch"===this.parent.editSettings.mode&&(e=this.batchEditModule.getAddRowIndex(),this.selectedIndex=this.batchEditModule.getSelectedIndex(),1<this.parent.getBatchChanges()[this.addedRecords].length||this.parent.getBatchChanges()[this.deletedRecords].length)&&(t=this.batchEditModule.getBatchRecords()),this.parent.grid.getDataRows()),r=i.length?+i[0].getAttribute("data-rowindex"):0,n=i.length?+i[i.length-1].getAttribute("data-rowindex"):0,r=this.selectedIndex>=r&&this.selectedIndex<=n,n=this.parent.enableVirtualization&&-1<this.addRowIndex&&"-1"!==this.prevAriaRowIndex;if("Dialog"!==this.parent.editSettings.mode&&("Above"===this.parent.editSettings.newRowPosition?a="before":("Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&(-1<this.selectedIndex||n)&&r&&(a="after",!C.isNullOrUndefined(t[parseInt(e.toString(),10)]))&&t[parseInt(e.toString(),10)].expanded&&("Batch"===this.parent.editSettings.mode&&(1<this.parent.getBatchChanges()[this.addedRecords].length||this.parent.getBatchChanges()[this.deletedRecords].length)?(e+=R(t[parseInt(e.toString(),10)]).length,"Child"!==this.parent.editSettings.newRowPosition&&(e+=this.batchEditModule.getBatchChildCount())):this.parent.enableVirtualization||(e+=R(t[parseInt(e.toString(),10)]).length)),(-1<this.selectedIndex||n)&&r&&(e||"Child"===this.parent.editSettings.newRowPosition||"Below"===this.parent.editSettings.newRowPosition))){e>=i.length-1&&(e=i.length-2);var t="rows",r=this.parent.grid.contentModule[t][0],o=document.activeElement,a=(i[e+1][""+a](i[0]),C.setValue("batchIndex",e+1,this.batchEditModule),"Above"===this.parent.editSettings.newRowPosition?e:e+1);if("Batch"===this.parent.editSettings.mode&&(this.parent.grid.contentModule[t].splice(0,1),this.parent.grid.contentModule[t].splice(a,0,r)),"Row"===this.parent.editSettings.mode||"Cell"===this.parent.editSettings.mode){for(var s=this.parent.grid.getContentTable().querySelectorAll(".e-griderror"),d=0;d<s.length;d++)s[parseInt(d.toString(),10)].remove();C.setValue("errorRules",[],this.parent.grid.editModule.formObj)}n&&(this.prevAriaRowIndex="-1"),this.parent.enableVirtualization&&(!this.parent.enableVirtualization||Object.keys(this.parent.grid.contentModule.emptyRowData).length)||o.focus(),this.parent.enableVirtualization&&!Object.keys(this.parent.grid.contentModule.emptyRowData).length&&this.parent.grid.contentModule.createEmptyRowdata()}if("Batch"===this.parent.editSettings.mode&&!C.isNullOrUndefined(this.addRowIndex)&&-1!==this.addRowIndex&&this.isAddedRowByMethod&&!this.isAddedRowByContextMenu){e=this.batchEditModule.getAddRowIndex(),this.selectedIndex=this.batchEditModule.getSelectedIndex();var l=this.parent.getBatchChanges().addedRecords,p=void 0;if(l.length)for(d=0;d<l.length;d++)C.isNullOrUndefined(l[parseInt(d.toString(),10)].uniqueID)&&(p=l[parseInt(d.toString(),10)]);i={action:"add",data:p,index:e,seletedRow:0};this.beginAddEdit(i),this.batchEditModule.batchAddRowRecord.push(this.batchEditModule.addRowRecord),this.batchEditModule.batchAddedRecords.push(i.data)}},N.prototype.beginEdit=function(i){if("refresh"===i.requestType&&this.isOnBatch)i.cancel=!0;else if("Cell"===this.parent.editSettings.mode&&"beginEdit"===i.requestType)i.cancel=!0;else if(this.doubleClickTarget&&(this.doubleClickTarget.classList.contains("e-treegridexpand")||this.doubleClickTarget.classList.contains("e-treegridcollapse")||this.doubleClickTarget.classList.contains("e-frame")))i.cancel=!0,this.doubleClickTarget=null;else{if("delete"===i.requestType){var r=i.data;if(C.isNullOrUndefined(i.data[0].uniqueID))for(var n=this.parent.getPrimaryKeyFieldNames(),e=this,t=0;t<r.length;t++)!function(t){e.parent.flatData.filter(function(e){e[""+n[0]]===i.data[parseInt(t.toString(),10)][n[0]]&&(r[parseInt(t.toString(),10)]=e)})}(t);for(t=0;t<r.length;t++){this.deleteUniqueID(r[parseInt(t.toString(),10)].uniqueID);for(var o=R(r[parseInt(t.toString(),10)]),a=0;a<o.length;a++)this.deleteUniqueID(o[parseInt(a.toString(),10)].uniqueID);i.data=i.data.concat(o)}}var s,d;("add"===i.requestType||this.isAddedRowByMethod&&(this.parent.enableVirtualization||this.parent.enableInfiniteScrolling))&&((-1===this.parent.grid.selectedRowIndex&&this.isAddedRowByMethod||i.index!==this.parent.grid.selectedRowIndex)&&0!==i.index||(this.selectedIndex=this.parent.grid.selectedRowIndex),this.parent.enableVirtualization?(s='.e-row[data-rowindex="'+this.selectedIndex+'"]',d=void 0,-1<this.selectedIndex&&"Top"!==this.parent.editSettings.newRowPosition&&"Bottom"!==this.parent.editSettings.newRowPosition?(this.prevAriaRowIndex=this.selectedIndex.toString(),d=this.parent.getContent().querySelector(s),this.addRowIndex=d?d.rowIndex:0):this.prevAriaRowIndex&&"-1"!==this.prevAriaRowIndex?(s='.e-row[data-rowindex="'+this.prevAriaRowIndex+'"]',d=this.parent.getContent().querySelector(s),this.addRowIndex=d?d.rowIndex:0):this.addRowIndex=0):this.isAddedRowByMethod&&(this.parent.enableVirtualization||this.parent.enableInfiniteScrolling)?0!==i.index?this.addRowIndex=i.index:this.addRowIndex=this.parent.grid.selectedRowIndex:this.addRowIndex=-1<this.parent.grid.selectedRowIndex?this.parent.grid.selectedRowIndex:0,(this.isAddedRowByMethod||this.isAddedRowByContextMenu&&-1!==this.parent.grid.selectedRowIndex)&&(this.parent.enableVirtualization||this.parent.enableInfiniteScrolling)?(this.addRowRecord=this.parent.flatData[this.parent.grid.selectedRowIndex],this.parent.enableVirtualization&&this.isAddedRowByContextMenu&&(this.addRowRecord=this.parent.getCurrentViewRecords()[this.addRowIndex])):this.addRowRecord=this.parent.getSelectedRecords()[0]),this.isAddedRowByMethod&&0!==i.index&&(this.addRowRecord=this.parent.flatData[i.index],this.addRowIndex=i.index),"Child"!==this.parent.editSettings.newRowPosition||C.isNullOrUndefined(this.parent.getSelectedRecords()[0])||(this.addRowRecord=this.parent.getSelectedRecords()[0]),C.isNullOrUndefined(this.addRowRecord)&&this.parent.getCurrentViewRecords().length>this.addRowIndex&&"save"===i.requestType&&0!==this.parent.getSelectedRecords().length&&(this.addRowRecord=this.parent.getCurrentViewRecords()[this.addRowIndex]),this.isAddedRowByMethod=!1,i=this.beginAddEdit(i)}},N.prototype.savePreviousRowPosition=function(){null===this.previousNewRowPosition&&(this.previousNewRowPosition=this.parent.editSettings.newRowPosition)},N.prototype.beginAddEdit=function(e){var t,i,r,n,o,a,s,d,l,p,h,c,u=e.data;if("add"===e.action&&(t=this.parent.grid.getPrimaryKeyFieldNames()[0],s=null,c=void(u.taskData=C.isNullOrUndefined(u.taskData)?C.extend({},e.data):u.taskData),c=this.parent.enableVirtualization&&0!==e.index?this.parent.flatData:"Batch"===this.parent.editSettings.mode&&this.isAddedRowByMethod&&!C.isNullOrUndefined(this.addRowIndex)?this.batchEditModule.batchRecords:this.parent.grid.getCurrentViewRecords(),this.parent.enableVirtualization&&0!==e.index&&(this.addRowIndex=this.parent.flatData.indexOf(this.addRowRecord),this.selectedIndex=this.addRowIndex),d=this.addRowIndex,u.uniqueID=I.getUid(this.parent.element.id+"_data_"),C.setValue("uniqueIDCollection."+u.uniqueID,u,this.parent),n=g=r=i=void(h=0),o=this.parent.enableVirtualization&&-1<this.addRowIndex&&"-1"!==this.prevAriaRowIndex,a=(l=this.parent.getRows()).length?c.indexOf(c[0]):0,l=l.length?+l[l.length-1].getAttribute("data-rowindex"):0,a=!(!this.parent.enableVirtualization||0===e.index)||this.selectedIndex>=a&&this.selectedIndex<=l,c.length&&(i=c[this.addRowIndex][this.parent.idMapping],n=c[this.addRowIndex][this.parent.parentIdMapping],c[this.addRowIndex].parentItem&&(r=c[this.addRowIndex].parentItem.uniqueID),g=c[this.addRowIndex].parentItem),"Top"!==this.parent.editSettings.newRowPosition&&c.length&&(h=c[this.addRowIndex].level,"Above"===this.parent.editSettings.newRowPosition?(s="before",d=c[this.addRowIndex].index):"Below"===this.parent.editSettings.newRowPosition?(s="after",l=R(c[this.addRowIndex]).length,p=c[this.addRowIndex].index,d=0<l?p+l:p):"Child"===this.parent.editSettings.newRowPosition&&(s="after",(-1<this.selectedIndex||o)&&a&&(u.parentItem=C.extend({},c[this.addRowIndex]),u.parentUniqueID=u.parentItem.uniqueID,delete u.parentItem.childRecords,delete u.parentItem[this.parent.childMapping]),l=R(c[this.addRowIndex]).length,p=c[this.addRowIndex].index,0<=this.selectedIndex&&(u.level=h+1),d=0<l?p+l:p,this.isSelfReference)&&(this.parent.isLocalData||-1!==this.parent.editModule.selectedIndex?u.taskData[this.parent.parentIdMapping]=u[this.parent.parentIdMapping]=i:u.taskData[this.parent.parentIdMapping]=u[this.parent.parentIdMapping]=null,C.isNullOrUndefined(u.parentItem)||M(t,u.parentItem,"add",this.parent,this.isSelfReference,u)),"Above"!==this.parent.editSettings.newRowPosition&&"Below"!==this.parent.editSettings.newRowPosition||((-1<this.selectedIndex||o)&&h&&a&&(u.parentUniqueID=r,u.parentItem=C.extend({},g),delete u.parentItem.childRecords,delete u.parentItem[this.parent.childMapping]),u.level=h,this.isSelfReference&&(u.taskData[this.parent.parentIdMapping]=u[this.parent.parentIdMapping]=n,C.isNullOrUndefined(u.parentItem)||M(t,u.parentItem,"add",this.parent,this.isSelfReference,u))),null!=s&&(-1<this.selectedIndex||o)&&a&&(e.index="before"===s?d:d+1),"Bottom"===this.parent.editSettings.newRowPosition)&&(h=0,c=this.parent.grid.dataSource instanceof b.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource,e.index=c.length),C.isNullOrUndefined(u.level)&&(u.level=h),u.hasChildRecords=!1,u.childRecords=[],u.index=0),"add"===e.action&&(this.internalProperties={level:u.level,parentItem:u.parentItem,uniqueID:u.uniqueID,taskData:u.taskData,parentUniqueID:C.isNullOrUndefined(u.parentItem)?void 0:u.parentItem.uniqueID,childRecords:u.childRecords}),"delete"===e.requestType)for(var g,f,m=e.data,y=0;y<m.length;y++)m[parseInt(y.toString(),10)].parentItem&&(g=x(this.parent,m[parseInt(y.toString(),10)].parentItem.uniqueID),!C.isNullOrUndefined(g))&&g.hasChildRecords&&(f=g.childRecords.indexOf(m[parseInt(y.toString(),10)]),g.childRecords.splice(f,1));return e},N.prototype.addRecord=function(e,t,i){var r,n,o;this.parent.editSettings.newRowPosition!==this.previousNewRowPosition&&null!==this.previousNewRowPosition||(this.previousNewRowPosition=this.parent.editSettings.newRowPosition),this.isSelfReference||C.isNullOrUndefined(e)||!Object.hasOwnProperty.call(e,this.parent.childMapping)?(e&&(-1<t?(this.selectedIndex=t,this.addRowIndex=t):(this.selectedIndex=this.parent.selectedRowIndex,this.addRowIndex=this.parent.selectedRowIndex),i)&&this.parent.setProperties({editSettings:{newRowPosition:i}},!0),this.parent.grid.editModule.addRecord(e,t)):(n=this.parent.editSettings.mode,o=this.parent.grid.editSettings.mode,(r=[]).push(e),this.parent.setProperties({editSettings:{mode:"Batch"}},!0),this.parent.grid.setProperties({editSettings:{mode:"Batch"}},!0),C.isNullOrUndefined(i)||this.parent.setProperties({editSettings:{newRowPosition:i}},!0),this.parent.notify(nt,{updatedRecords:{addedRecords:r,changedRecords:[],deletedRecords:[]},index:t}),this.parent.setProperties({editSettings:{mode:n}},!0),this.parent.grid.setProperties({editSettings:{mode:o}},!0),this.parent.refresh())},N.prototype.editFormValidate=function(){return this.parent.grid.editModule.editFormValidate()},N.prototype.destroyForm=function(){this.parent.grid.editModule.destroyForm()},N.prototype.contentready=function(e){C.isNullOrUndefined(e.args.requestType)||"delete"!==e.args.requestType.toString()&&"save"!==e.args.requestType.toString()&&("Batch"!==this.parent.editSettings.mode||"batchsave"!==e.args.requestType.toString())||(this.updateIndex(this.parent.grid.dataSource,this.parent.getRows(),this.parent.getCurrentViewRecords()),(this.parent.frozenRows||this.parent.getFrozenColumns()||this.parent.frozenColumns)&&this.parent.grid.dataSource.length===this.parent.getDataRows().length&&this.updateIndex(this.parent.grid.dataSource,this.parent.getDataRows(),this.parent.getCurrentViewRecords()))},N.prototype.editCell=function(e,t){"Cell"!==this.parent.editSettings.mode&&"Batch"!==this.parent.editSettings.mode||("Batch"!==this.parent.editSettings.mode&&(this.isOnBatch=!0,this.updateGridEditMode("Batch")),this.parent.grid.editModule.editCell(e,t))};var Hi=N;function N(e){this.addedRecords="addedRecords",this.deletedRecords="deletedRecords",this.prevAriaRowIndex="-1",this.isAddedRowByMethod=!1,this.isAddedRowByContextMenu=!1,I.Grid.Inject(I.Edit),this.parent=e,this.isSelfReference=!C.isNullOrUndefined(e.parentIdMapping),this.previousNewRowPosition=null,this.internalProperties={},this.batchEditModule=new _i(this.parent),this.addEventListener()}Qi.prototype.getModuleName=function(){return"commandColumn"},Qi.prototype.destroy=function(){};var Gi=Qi;function Qi(e){I.Grid.Inject(I.CommandColumn),this.parent=e}A.prototype.getModuleName=function(){return"detailRow"},A.prototype.addEventListener=function(){this.parent.on("dataBoundArg",this.dataBoundArg,this),this.parent.on("detaildataBound",this.detaildataBound,this),this.parent.grid.on("detail-indentcell-info",this.setIndentVisibility,this),this.parent.on("childRowExpand",this.childRowExpand,this),this.parent.on("rowExpandCollapse",this.rowExpandCollapse,this),this.parent.on("actioncomplete",this.actioncomplete,this)},A.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("dataBoundArg",this.dataBoundArg),this.parent.off("detaildataBound",this.detaildataBound),this.parent.off("childRowExpand",this.childRowExpand),this.parent.off("rowExpandCollapse",this.rowExpandCollapse),this.parent.off("actioncomplete",this.actioncomplete),this.parent.grid.off("detail-indentcell-info",this.setIndentVisibility))},A.prototype.setIndentVisibility=function(e){e.visible=!1},A.prototype.dataBoundArg=function(){for(var e=this.parent.getRows().filter(function(e){return!e.classList.contains("e-detailrow")}),t=0;t<e.length;t++){var i=e[parseInt(t.toString(),10)].getElementsByClassName("e-detailrowcollapse"),r=this.parent.grid.getRowObjectFromUID(e[parseInt(t.toString(),10)].getAttribute("data-Uid")),n=I.getObject("parentItem",this.parent.grid.getCurrentViewRecords()[parseInt(t.toString(),10)]);(C.isNullOrUndefined(n)||!C.isNullOrUndefined(n)&&y(this.parent,r.data,this.parent.grid.getCurrentViewRecords()))&&this.parent.grid.detailRowModule.expand(i[0])}},A.prototype.childRowExpand=function(e){e=e.row.getElementsByClassName("e-detailrowcollapse");C.isNullOrUndefined(e[0])||this.parent.grid.detailRowModule.expand(e[0])},A.prototype.rowExpandCollapse=function(e){if(!S(this.parent))for(var t=0;t<e.detailrows.length;t++)e.detailrows[parseInt(t.toString(),10)].style.display=e.action},A.prototype.detaildataBound=function(e){var t=e.data,i=e.detailElement.parentElement.previousSibling,r="e-gridrowindex"+(C.isNullOrUndefined(t.parentItem)?t:t.parentItem).index+"level"+t.level,t=i.querySelector("."+r).classList,i=[].slice.call(t).filter(function(e){return e===r}),t=i[0].length,i=i.toString().slice(6,t);C.addClass([e.detailElement.parentElement],"e-griddetail"+i)},A.prototype.actioncomplete=function(e){"beginEdit"!==e.requestType&&"add"!==e.requestType||(t=e.row.querySelectorAll(".e-editcell")[0].getAttribute("colSpan"),t=(parseInt(t,10)-1).toString(),e.row.querySelectorAll(".e-editcell")[0].setAttribute("colSpan",t));for(var t,i=this.parent.grid.contentModule.getRows(),r=0;r<i.length;r++)i[parseInt(r.toString(),10)].cells[0].visible=!1;I.getObject("focusModule",this.parent.grid).refreshMatrix(!0)({rows:this.parent.grid.contentModule.getRows()})},A.prototype.destroy=function(){this.removeEventListener()};var Ki=A;function A(e){I.Grid.Inject(I.DetailRow),this.parent=e,this.addEventListener()}Wi=function(e,t){return(Wi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Wi,U,Yi=function(e,t){function i(){this.constructor=e}Wi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Ji=(U=I.VirtualContentRenderer,Yi(k,U),k.prototype.getModelGenerator=function(){return new Oi(this.parent)},k.prototype.getRowByIndex=function(t){return this.parent.enableVirtualization&&this.parent.isFrozenGrid()?this.getRowCollection(t,!0):this.parent.getDataRows().filter(function(e){return parseInt(e.getAttribute("data-rowindex"),10)===t})[0]},k.prototype.getFrozenRightVirtualRowByIndex=function(e){return this.getRowCollection(e,!1,!1,!0)},k.prototype.getRowCollection=function(e,t,i,r){var n=parseInt(this.parent.getRows()[0].getAttribute(Dt),10),o=this.parent.getDataRows(),a=(i?this.parent.getCurrentViewRecords():o)[e-n];return a=this.parent.frozenRows&&1<this.parent.pageSettings.currentPage?i?e<=this.parent.frozenRows?this.parent.getRowsObject()[parseInt(e.toString(),10)].data:a:e<=this.parent.frozenRows?o[parseInt(e.toString(),10)]:o[e-n+this.parent.frozenRows]:a},k.prototype.addEventListener=function(){this.parent.on(st,this.virtualOtherAction,this),this.parent.on(pt,this.indexModifier,this)},k.prototype.virtualOtherAction=function(e){e.setTop?(this.translateY=0,this.startIndex=0,this.endIndex=this.parent.pageSettings.pageSize-1):e.isExpandCollapse&&(this.isExpandCollapse=!0)},k.prototype.indexModifier=function(e){var t,i=this.parent.getContent().querySelector(".e-content");(this.recordAdded||"delete"===e.requestType&&this.endIndex>e.count-this.parent.pageSettings.pageSize)&&-1<this.startIndex&&-1<this.endIndex&&(this.endIndex>e.count-this.parent.pageSettings.pageSize?((t=(i=~~(i.scrollTop/this.parent.getRowHeight()))+this.parent.getRows().length)>e.count&&(t=i+(e.count-i)),this.startIndex=t-this.parent.getRows().length,this.endIndex=t):("Top"!==this.parent.root.editSettings.newRowPosition&&-1!==this.parent.root.editModule.selectedIndex||-1!==this.parent.root.editModule.selectedIndex)&&(this.startIndex+=1,this.endIndex+=1),this.recordAdded=!1),this.isDataSourceChanged&&(this.startIndex=0,this.endIndex=this.parent.pageSettings.pageSize-1),this.endIndex-this.startIndex!==this.parent.pageSettings.pageSize&&this.totalRecords>this.parent.pageSettings.pageSize&&this.endIndex===this.totalRecords?e.startIndex=this.endIndex-this.parent.pageSettings.pageSize:e.startIndex=this.startIndex,e.endIndex=this.endIndex},k.prototype.eventListener=function(e){var t=this;this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&w(this.parent)?U.prototype.eventListener.call(this,"on"):(this.parent[""+e]("data-ready",this.onDataReady,this),this.parent[""+e]("refresh-virtual-block",this.refreshContentRows,this),this.fn=function(){t.observers.observes(function(e){return t.scrollListeners(e)},t.onEnteredAction(),t.parent),t.parent.off("content-ready",t.fn)},this.parent.addEventListener("dataBound",this.dataBoundEvent.bind(this)),this.parent.addEventListener("rowSelected",this.rowSelectedEvent.bind(this)),this.parent[""+e]("select-virtual-Row",this.toSelectVirtualRow,this),this.parent.on("content-ready",this.fn,this),this.parent.addEventListener(Ce,this.onActionComplete.bind(this)),this.parent[""+e]("virtual-scroll-edit-action-begin",this.beginEdit,this),this.parent[""+e]("virtual-scroll-add-action-begin",this.beginAdd,this),this.parent[""+e]("virtual-scroll-edit-success",this.virtualEditSuccess,this),this.parent[""+e]("edit-reset",this.resetIseditValue,this),this.parent[""+e]("get-virtual-data",this.getData,this),this.parent[""+e]("virtual-scroll-edit-cancel",this.cancelEdit,this),this.parent[""+e]("select-row-on-context-open",this.toSelectRowOnContextOpen,this),this.parent[""+e]("refresh-virtual-editform-cells",this.refreshCell,this),this.parent[""+e]("virtaul-cell-focus",this.cellFocus,this))},k.prototype.cellFocus=function(e){U.prototype.virtualCellFocus.call(this,e)},k.prototype.onDataReady=function(e){var t,i;U.prototype.onDataReady.call(this,e),this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&w(this.parent)||(C.isNullOrUndefined(e.count)||(this.totalRecords=e.count,this.parent.isFrozenGrid()&&e.count<Object.keys(this.parent.dataSource).length&&(t=this.parent.enableColumnVirtualization?this.getColumnOffset(this.parent.columns.length-1)+"px":"100%",i=this.parent.getRowHeight()*e.count-this.parent.getRowHeight()*this.parent.pageSettings.pageSize,C.getValue("virtualEle",this).setVirtualHeight(i,t)),this.parent.enableColumnVirtualization)||this.parent.isFrozenGrid()||C.getValue("virtualEle",this).setVirtualHeight(this.parent.getRowHeight()*e.count,"100%"),(!C.isNullOrUndefined(e.requestType)&&"collapseAll"===e.requestType.toString()||this.isDataSourceChanged&&(-1===this.startIndex||0===this.startIndex&&0===this.preStartIndex))&&(this.contents.scrollTop=0,this.isDataSourceChanged=!1))},k.prototype.renderTable=function(){U.prototype.renderTable.call(this),this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&w(this.parent)||(C.getValue("observer",this).options.debounceEvent=!1,this.observers=new $i(C.getValue("observer",this).element,C.getValue("observer",this).options),this.contents=this.getPanel().firstChild)},k.prototype.getTranslateY=function(e,t,i,r){return this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||w(this.parent)?this.isRemoteExpand?(this.isRemoteExpand=!1,this.preTranslate):(this.preTranslate=U.prototype.getTranslateY.call(this,e,t,i,r),U.prototype.getTranslateY.call(this,e,t,i,r)):U.prototype.getTranslateY.call(this,e,t,i,r)},k.prototype.dataBoundEvent=function(){var e,t,i="initialRowTop";!this.parent.getRows().length||C.isNullOrUndefined(this.parent.getRowByIndex(0))||this[i]||(e=this.parent.getRowByIndex(0).getBoundingClientRect().top,t=this.parent.element.getBoundingClientRect().top,this[i]=0<e?this.parent.getRowByIndex(0).getBoundingClientRect().top-t:this.content.getBoundingClientRect().top-this.parent.getRowByIndex(0).getBoundingClientRect().height),U.prototype.dataBound.call(this)},k.prototype.rowSelectedEvent=function(e){U.prototype.rowSelected.call(this,e),this.parent.notify("virtualTransform",{requestType:"transformChange"})},k.prototype.toSelectVirtualRow=function(e){var t;!this.parent.isEdit&&(C.isNullOrUndefined(this.observer[t="containerRect"])&&(this.observer[t]=this.observers[t]),C.isNullOrUndefined(this.parent.clipboardModule.treeGridParent.editModule)||0!==e.selectedIndex||C.isNullOrUndefined(this.parent.clipboardModule.treeGridParent.editModule.addRowIndex))&&U.prototype.selectVirtualRow.call(this,e)},k.prototype.refreshCell=function(e){e.cells=this.generateCells()},k.prototype.generateCells=function(){for(var e=[],t=0;t<this.parent.columns.length;t++)e.push(this.generateCell(this.parent.columns[parseInt(t.toString(),10)]));return e},k.prototype.generateCell=function(e,t,i,r,n,o){t={visible:e.visible,isDataCell:!C.isNullOrUndefined(e.field||e.template),isTemplate:!C.isNullOrUndefined(e.template),rowID:t,column:e,cellType:C.isNullOrUndefined(i)?I.CellType.Data:i,colSpan:r,commands:e.commands,isForeignKey:e.isForeignColumn&&e.isForeignColumn(),foreignKeyData:e.isForeignColumn&&e.isForeignColumn()&&C.getValue(e.field,o)};return(t.isDataCell||"checkbox"===t.column.type||t.commands)&&(t.index=n),new I.Cell(t)},k.prototype.beginEdit=function(e){this.editedRowIndex=e.index;var t='.e-row[data-rowindex="'+e.index+'"]',t=this.parent.getContent().querySelector(t).rowIndex,t=this.parent.getCurrentViewRecords()[parseInt(t.toString(),10)];e.data=t},k.prototype.beginAdd=function(e){var t={newRowPosition:this.rowPosition,addRowIndex:this.addRowIndex,dataRowIndex:this.dataRowIndex},t=(this.parent.notify("get-row-position",t),this.rowPosition=t.newRowPosition,this.addRowIndex=t.addRowIndex,this.dataRowIndex=t.dataRowIndex,this.parent.getRows()),i=t.length?+t[0].getAttribute("data-rowindex"):0,t=t.length?+t[t.length-1].getAttribute("data-rowindex"):0,i=this.parent.selectedRowIndex>=i&&this.parent.selectedRowIndex<=t;"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition&&(this.isAdd=!0),"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition&&(this.addRowIndex&&-1!==this.addRowIndex||-1!==this.parent.selectedRowIndex&&i)||U.prototype.addActionBegin.call(this,e)},k.prototype.restoreEditState=function(){U.prototype.restoreEdit.call(this)},k.prototype.resetIseditValue=function(){this.parent.notify("reset-edit-props",{}),"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition||!this.isAdd||U.prototype.resetIsedit.call(this)},k.prototype.virtualEditSuccess=function(){var e=this.parent.getContent().querySelector(".e-content");this.isAdd&&e.querySelector(".e-addedrow")&&(this.recordAdded=!0)},k.prototype.cancelEdit=function(e){U.prototype.editCancel.call(this,e)},k.prototype.toSelectRowOnContextOpen=function(e){U.prototype.selectRowOnContextOpen.call(this,e)},k.prototype.restoreNewRow=function(){var e=this.parent.getContent().querySelector(".e-content");this.isAdd&&!e.querySelector(".e-addedrow")&&(this.parent.isEdit=!1,this.parent.editModule.addRecord(null,this.parent.root.editModule.selectedIndex))},k.prototype.getData=function(e){U.prototype.getVirtualData.call(this,e)},k.prototype.onActionComplete=function(e){var t;"add"===e.requestType&&(t={newRowPosition:this.rowPosition,addRowIndex:this.addRowIndex,dataRowIndex:this.dataRowIndex},this.parent.notify("get-row-position",t),this.rowPosition=t.newRowPosition,this.addRowIndex=t.addRowIndex,this.dataRowIndex=this.parent.root.editModule.selectedIndex);U.prototype.actionComplete.call(this,e)},k.prototype.onEnteredAction=function(){var l=this;return function(e,t,i,r,n,o){var a,s,d;l.parent.directVirtualRender||(a="preventEvent",!C.Browser.isIE||n||!o||l[a]||l.parent.enableVirtualMaskRow||l.parent.showSpinner(),l.parent.enableVirtualMaskRow&&!l[a]&&setTimeout(function(){l.parent.showMaskRow(t.axis),l.parent.notify("showGanttShimmer",{requestType:"showShimmer"})},0),n=l.content.getBoundingClientRect().height,o=l.prevInfo.offsets?l.prevInfo.offsets.top:null,a="X"===t.axis,s=l.getColumnOffset(a?l.vgenerator.getColumnIndexes()[0]-1:l.prevInfo.columnIndexes[0]-1),a&&(d=Object.keys(l.vgenerator.cOffsets).length-l.prevInfo.columnIndexes.length,s=(d=l.vgenerator.cOffsets[d-1])<s?d:s),d=l.getTranslateY(r.top,n,a&&o===r.top?l.prevInfo:void 0,!0),l.parent.isFrozenGrid()&&!l.parent.enableVirtualMaskRow)||(l.parent.enableVirtualMaskRow?(n=r.top-l.translateY<0,d=Math.round(l.translateY)>d&&!n?Math.round(l.translateY):d,l.virtualEle.adjustTable(s,d)):l.virtualEle.adjustTable(s,l.translateY),l.parent.enableColumnVirtualization&&l.header.virtualEle.adjustTable(s,0))}},k.prototype.scrollListeners=function(e){this.scrollAfterEdit();var t,i,r,n=e.sentinel,o=this.parent.getRowHeight(),a=this.parent.pageSettings.pageSize-Math.ceil(this.parent.pageSettings.pageSize/2),s=(C.isNullOrUndefined(this.parent.contentModule)||(t=this.parent.getContent().querySelector(".e-content")),a*o),d=e.offset.top-this.translateY<=0,s=Math.ceil(e.offset.top-this.translateY)+o>=s,l="selectedRowIndex",p=this.parent.currentViewData,h="index";d&&"right"!==e.direction&&"left"!==e.direction&&!C.isNullOrUndefined(t)?(i=+(this.parent.height.toString().indexOf("%")<0?parseInt(this.parent.height.toString(),10):this.parent.element.getBoundingClientRect().height),i=0<(i=~~(t.scrollTop/o)+Math.ceil(i/o)-this.parent.pageSettings.pageSize)?i:0,!C.isNullOrUndefined(this[l])&&-1!==this[l]&&i!==this[l]&&this.parent.rowHeight*this.parent.pageSettings.pageSize<t.scrollTop&&(i=this[l]),this.startIndex=i,this.endIndex=i+this.parent.pageSettings.pageSize,this.endIndex>this.totalRecords&&(i=this.totalRecords-1,r=this.endIndex%i,this.endIndex=i,this.startIndex=this.startIndex-r<0?0:this.startIndex-r),p.length&&p[0][h]>=this.parent.pageSettings.pageSize/2&&p[0][h]-this.startIndex<this.parent.pageSettings.pageSize/2&&this.parent.selectionModule.isRowSelected&&(this.startIndex=p[0][h]-this.parent.pageSettings.pageSize/2,this.endIndex=this.startIndex+this.parent.pageSettings.pageSize),i=Math.ceil(e.offset.top/o),i%=this.parent.pageSettings.pageSize,(r=0)===(r=C.isNullOrUndefined(this.parent.getRows()[parseInt(i.toString(),10)])||C.isNullOrUndefined(this.parent.getContent().querySelectorAll(".e-content tr")[parseInt(i.toString(),10)])?r:+this.parent.getContent().querySelectorAll(".e-content tr")[parseInt(i.toString(),10)].querySelector("td").getAttribute("index"))?this.translateY=0<e.offset.top-a*o?e.offset.top-a*this.parent.getRowHeight()+o:0:(0<this.parent.getFrozenColumns()&&(e.offset.top=e.offset.top+80),this.translateY=0<e.offset.top-a*o?e.offset.top-a*o+10:0)):s&&"right"!==e.direction&&"left"!==e.direction&&!C.isNullOrUndefined(t)&&(i=~~(t.scrollTop/o),r=!(this[l]+this.parent.pageSettings.pageSize<this.totalRecords),(a=(i=C.isNullOrUndefined(this[l])||-1===this[l]||i===this[l]||r?i:this[l])+this.parent.pageSettings.pageSize)>this.totalRecords&&(a=i+(this.totalRecords-i)),this.startIndex=!r||C.isNullOrUndefined(this[l])?a-this.parent.pageSettings.pageSize:i,this.endIndex=a,i+this.parent.pageSettings.pageSize>this.totalRecords&&this.endIndex-this.startIndex<this.parent.pageSettings.pageSize/2&&this.endIndex-i<this.parent.pageSettings.pageSize/2&&(this.startIndex=a-this.parent.pageSettings.pageSize/2),p.length&&this.startIndex>p[0][h]&&this.startIndex-p[0][h]<this.parent.pageSettings.pageSize/2&&this.parent.selectionModule.isRowSelected&&(this.startIndex=p[0][h]+this.parent.pageSettings.pageSize/2),e.offset.top>o*this.totalRecords?this.translateY=this.getTranslateY(e.offset.top,t.getBoundingClientRect().height):this.totalRecords===this.endIndex?this.translateY=this.totalRecords*o-(this.endIndex-this.startIndex)*o:this.parent.allowRowDragAndDrop?this.translateY=e.offset.top-2*o:0<this.parent.getFrozenColumns()?this.translateY=e.offset.top-(2*o+this.parent.pageSettings.pageSize):this.translateY=e.offset.top),s&&e.offset.top<o*this.totalRecords||d||"right"===e.direction||"left"===e.direction||this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url&&(s||d)||w(this.parent)?(r=this.currentInfo=C.getValue("getInfoFromView",this).apply(this,[e.direction,n,e.offset]),this.previousInfo=r,this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization?r.columnIndexes:[]),l=(r.loadNext&&!r.loadSelf?r.nextInfo:r).page,this.parent.setProperties({pageSettings:{currentPage:l}},!0),s&&this.endIndex===this.totalRecords&&r.loadNext&&(r.loadNext=!1),this.requestType="virtualscroll","right"!==e.direction&&"left"!==e.direction&&(r.event="refresh-virtual-block"===r.event?"model-changed":r.event),this.parent.enableVirtualMaskRow&&(this.parent.showMaskRow(n.axis),this.parent.addShimmerEffect(),this.parent.notify("showGanttShimmer",{requestType:"showShimmer"})),this.parent.notify(r.event,{requestType:"virtualscroll",virtualInfo:r,focusElement:e.focusElement})):this.parent.enableVirtualMaskRow&&(this.parent.removeMaskRow(),this.parent.notify("removeGanttShimmer",{requestType:"hideShimmer"}))},k.prototype.appendContent=function(e,t,i){var r,n,o,a;this.parent.dataSource instanceof b.DataManager&&void 0!==this.parent.dataSource.dataSource.url&&!this.parent.dataSource.dataSource.offline&&""!==this.parent.dataSource.dataSource.url||w(this.parent)?(C.getValue("isExpandCollapse",i)&&(this.isRemoteExpand=!0),U.prototype.appendContent.call(this,e,t,i),-1!==C.getValue("requestTypes",this).indexOf("isFrozen")&&(C.getValue("requestTypes",this).splice(C.getValue("requestTypes",this).indexOf("isFrozen"),1),this.requestType="isFrozen"===this.requestType?void 0:this.requestType)):(n=(r=i.virtualInfo.sentinelInfo&&"Y"===i.virtualInfo.sentinelInfo.axis&&C.getValue("currentInfo",this).page&&C.getValue("currentInfo",this).page!==i.virtualInfo.page?C.getValue("currentInfo",this):i.virtualInfo).columnIndexes[0]-1,n=this.getColumnOffset(n),a=void 0,this.parent.enableColumnVirtualization&&(this.header.virtualEle.adjustTable(n,0),o=r.columnIndexes,a=this.getColumnOffset(o[o.length-1])-this.getColumnOffset(o[0]-1)+"",this.header.virtualEle.setWrapperWidth(a)),this.virtualEle.setWrapperWidth(a,C.Browser.isIE||"edge"===C.Browser.info.name),(e=this.parent.createElement("tbody")).appendChild(t),this.getTable().querySelector("tbody").replaceWith(e),this.isExpandCollapse&&0!==this.translateY?this.isExpandCollapse=!1:(this.translateY=this.translateY<0?0:this.translateY,C.getValue("virtualEle",this).adjustTable(n,this.translateY)),C.setValue("prevInfo",this.previousInfo||r,this),"virtualscroll"===i.requestType&&"X"===i.virtualInfo.sentinelInfo.axis&&this.parent.notify(vt,{}),U.prototype.focusCell.call(this,i),this.isAdd&&!this.parent.getContent().querySelector(".e-content").querySelector(".e-addedrow")&&"Top"!==this.rowPosition&&"Bottom"!==this.rowPosition&&(this.dataRowIndex>=this.startIndex?this.restoreNewRow():this.addRowIndex&&-1<this.addRowIndex&&(this.isAdd=!1,this.parent.isEdit=!1)),this.restoreEditState(),U.prototype.restoreAdd.call(this),U.prototype.ensureSelectedRowPosition.call(this))},k.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("data-ready",this.onDataReady),this.parent.off("content-ready",this.fn),this.parent.off("select-virtual-Row",this.toSelectVirtualRow),this.parent.off("dataBound",this.dataBoundEvent),this.parent.off("rowSelected",this.rowSelectedEvent),this.parent.off(st,this.virtualOtherAction),this.parent.off(pt,this.indexModifier),this.parent.off("virtual-scroll-edit-action-begin",this.beginEdit),this.parent.off("virtual-scroll-add-action-begin",this.beginAdd),this.parent.off("virtual-scroll-edit-success",this.virtualEditSuccess),this.parent.off("edit-reset",this.resetIseditValue),this.parent.off("get-virtual-data",this.getData),this.parent.off("virtual-scroll-edit-cancel",this.cancelEdit),this.parent.off("select-row-on-context-open",this.toSelectRowOnContextOpen),this.parent.off("refresh-virtual-editform-cells",this.refreshCell),this.parent.off("virtaul-cell-focus",this.cellFocus))},k);function k(e,t){e=U.call(this,e,t)||this;return e.isExpandCollapse=!1,e.translateY=0,e.maxiPage=0,e.recordAdded=!1,e.startIndex=-1,e.endIndex=-1,e.preTranslate=0,e.isRemoteExpand=!1,e.isDataSourceChanged=!1,e.addEventListener(),e}Xi=I.InterSectionObserver,Yi(Zi,Xi),Zi.prototype.observes=function(e,t,i){Xi.prototype.containerRect=C.getValue("options",this).container.getBoundingClientRect(),C.EventHandler.add(C.getValue("options",this).container,"scroll",this.virtualScrollHandlers(e,t,i),this),C.getValue("options",this).movableContainer&&(Xi.prototype.movableContainerRect=C.getValue("options",this).movableContainer.getBoundingClientRect(),C.EventHandler.add(C.getValue("options",this).movableContainer,"scroll",this.virtualScrollHandlers(e,t,i),this))},Zi.prototype.clear=function(){this.lastPos=null},Zi.prototype.virtualScrollHandlers=function(a,s,d){var l=this,e="chrome"===C.Browser.info.name?200:100,p="options",h="movableEle",c="fromWheel",u=C.debounce(a,e),g=C.debounce(a,50);return this[p].prevTop=this[p].prevLeft=0,function(e){var t=(l[p].movableContainer?l[p].container:e.target).scrollTop,i=(l[p].movableContainer?l[p].scrollbar:e.target).scrollLeft,r=l[p].prevTop<t?"down":"up",r=l[p].prevLeft===i?r:l[p].prevLeft<i?"right":"left",n=(l[p].prevTop=t,l[p].prevLeft=i,l.sentinelInfo[r]),o=0;l.newPos=t,null!=l.lastPos&&(o=l.newPos-l.lastPos),l.lastPos=l.newPos,l.timer&&clearTimeout(l.timer),l.timer=setTimeout(l.clear,0),(100<o||o<-100)&&e&&e.preventDefault&&(e.returnValue=!1,e.preventDefault()),-1!==l[p].axes.indexOf(n.axis)&&(l.containerRect=l[p].container.getBoundingClientRect(),o=l.check(r),n.entered&&("X"===n.axis||d.enableVirtualMaskRow)&&(!l[h]||"right"!=r&&"left"!=r?s(l.element,n,r,{top:t,left:i},l[c],o):s(l[h],n,r,{top:t,left:i},l[c],o)),o&&(e=g,("X"===n.axis?e:d.dataSource instanceof b.DataManager&&void 0!==d.dataSource.dataSource.url&&!d.dataSource.dataSource.offline&&""!==d.dataSource.dataSource.url||w(d)||d.enableVirtualMaskRow?e=d.enableVirtualMaskRow?u:e:a)({direction:r,sentinel:n,offset:{top:t,left:i},focusElement:document.activeElement})),l[c]=!1)}};var Xi,$i=Zi;function Zi(){var e=null!==Xi&&Xi.apply(this,arguments)||this;return e.isWheeling=!1,e.newPos=0,e.lastPos=0,e.timer=0,e}er=function(e,t){return(er=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var er,Yi=function(e,t){function i(){this.constructor=e}er(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},tr=(ir.prototype.returnVisualData=function(e){e.data=this.visualData},ir.prototype.getModuleName=function(){return"virtualScroll"},ir.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(Be,this.collapseExpandVirtualchilds,this),this.parent.on(ze,this.virtualPageAction,this),this.parent.on(dt,this.destroy,this))},ir.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Be,this.collapseExpandVirtualchilds),this.parent.off(ze,this.virtualPageAction),this.parent.off(dt,this.destroy))},ir.prototype.collapseExpandVirtualchilds=function(e){this.parent.grid.notify(st,{isExpandCollapse:!0}),this.expandCollapseRec=e.record,e.record.expanded="collapse"!==e.action;var e={result:this.parent.flatData,row:e.row,action:e.action,record:e.record,count:this.parent.flatData.length},t=((this.parent.enableVirtualization&&"Cell"===this.parent.selectionSettings.mode||"Row"===this.parent.selectionSettings.mode&&!this.parent.selectionSettings.persistSelection)&&this.parent.grid.clearSelection(),C.getValue("isCollapseAll",this.parent)&&this.parent.selectionSettings.persistSelection&&0<this.parent.getSelectedRecords().length&&(this.prevSelectedRecord=this.parent.getSelectedRecords(),this.parent.grid.clearSelection()),C.getValue("isCollapseAll",this.parent)?"collapseAll":"refresh");C.getValue("grid.renderModule",this.parent).dataManagerSuccess(e,{requestType:t})},ir.prototype.virtualPageAction=function(e){var t,i,r,n=this,o=new b.DataManager(e.result),a=new b.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),a=o.executeLocal((new b.Query).where(a)).filter(function(e){return y(n.parent,e)}),s=(this.visualData=a,e.count=a.length,this.parent.grid.notify(lt,{data:a}),{startIndex:-1,endIndex:-1,count:e.count,requestType:e.actionArgs.requestType}),d=(this.parent.grid.notify(pt,s),s.startIndex),l=s.endIndex;e.count=a.length,-1===d&&-1===l?(i=new b.Query,t=this.parent.grid.pageSettings.pageSize,r=this.parent.grid.pageSettings.currentPage,i=i.skip(t*(r-1)).take(t),o.dataSource.json=a,e.result=o.executeLocal(i)):(("filtering"===(r=e.actionArgs.requestType)||"collapseAll"===r||"searching"===r||"refresh"===r&&C.getValue("isExpandAll",this.parent)||"refresh"===r&&this.parent.enableCollapseAll&&l>a.length&&C.isNullOrUndefined(this.expandCollapseRec))&&(d=0,l=this.parent.grid.pageSettings.pageSize-1,this.parent.grid.getContent().firstElementChild.scrollTop=0,this.parent.grid.notify(st,{setTop:!0})),("save"===r&&e.actionArgs.index>=s.count-this.parent.grid.pageSettings.pageSize||"refresh"===r&&this.parent.isGantt&&this.parent.isAddedFromGantt)&&(!(s.endIndex+this.parent.pageSettings.pageSize>=s.count&&this.parent.root&&s.count-s.endIndex==this.visualData.length-this.parent.root.previousFlatData.length)&&this.parent.isGantt&&this.parent.isAddedFromGantt||(d=s.startIndex+(s.count-s.endIndex),l=s.count),this.parent.isAddedFromGantt=!1),t=this.parent.grid.contentModule.virtualEle.wrapper,o=I.getTransformValues(t).height,!C.isNullOrUndefined(this.expandCollapseRec)&&("virtualscroll"===e.actionArgs.requestType||"refresh"===e.actionArgs.requestType&&d!==this.prevstartIndex)&&d<this.parent.getRows().length&&l<=d+this.parent.getRows().length&&0===o&&(d=0),C.isNullOrUndefined(this.expandCollapseRec)||(i=this.parent.getRows(),r=a.indexOf(this.expandCollapseRec),a.slice(r,r+i.length).length<i.length&&0<=r&&0!==d?(d=r=0<(r=a.length-i.length)?r:0,l=a.length):C.getValue("isCollapseAll",this.parent)&&(l=this.parent.grid.pageSettings.pageSize-1,this.parent.grid.notify(st,{setTop:!(d=0)}))),"collapseAll"!==this.prevrequestType||"virtualscroll"!==e.actionArgs.requestType||C.isNullOrUndefined(this.parent.idMapping)||0!==d||(l=this.parent.grid.pageSettings.pageSize-1,this.parent.grid.notify(st,{setTop:!(d=0)})),!this.parent.enableCollapseAll&&!this.parent.expandStateMapping||C.isNullOrUndefined(this.expandCollapseRec)||(e.count<this.parent.getRows()[0].getBoundingClientRect().height?d=0:this.parent.isExpandAll||(d=-1===this.prevstartIndex?0:this.prevstartIndex)),this.expandCollapseRec=null,d=d<0?0:d,0===l&&0<a.length?e.result=a:e.result=a.slice(d,l),this.prevstartIndex=d,this.prevendIndex=l,this.prevrequestType=e.actionArgs.requestType),this.parent.notify("updateAction",e)},ir.prototype.destroy=function(){this.removeEventListener()},ir);function ir(e){this.prevstartIndex=-1,this.prevendIndex=-1,this.prevSelectedRecord=[],this.parent=e,I.Grid.Inject(nr),this.addEventListener()}rr=I.VirtualScroll,Yi(or,rr),or.prototype.getModuleName=function(){return"treeVirtualScroll"},or.prototype.instantiateRenderers=function(){var e=C.getValue("parent",this),t=(C.getValue("parent",this).log(["limitation","virtual_height"],"virtualization"),C.getValue("locator",this).getService("rendererFactory"));e.enableColumnVirtualization&&C.getValue("addRenderer",t).apply(t,[I.RenderType.Header,new I.VirtualHeaderRenderer(C.getValue("parent",this),C.getValue("locator",this))]),C.getValue("addRenderer",t).apply(t,[I.RenderType.Content,new Ji(C.getValue("parent",this),C.getValue("locator",this))]),this.ensurePageSize()},or.prototype.ensurePageSize=function(){var e=C.getValue("parent",this),t=e.getRowHeight();C.isNullOrUndefined(e.height)||"string"!=typeof e.height||-1===e.height.indexOf("%")||(e.element.style.height=e.height);var t=2*~~((e.height.toString().indexOf("%")<0?parseInt(e.height.toString(),10):e.element.getBoundingClientRect().height)/t),i=e.pageSettings.pageSize;e.setProperties({pageSettings:{pageSize:i<t?t:i}},!0)};var rr,nr=or;function or(e,t){e=rr.call(this,e,t)||this;return C.getValue("parent",e).off("initial-load",C.getValue("instantiateRenderer",e),e),C.getValue("parent",e).on("initial-load",e.instantiateRenderers,e),e}ar.prototype.addEventListener=function(){this.parent.on("rowExpandCollapse",this.rowExpandCollapse,this),this.parent.on("dataBoundArg",this.dataBoundArg,this),this.parent.grid.on("dblclick",this.dblClickHandler,this)},ar.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("rowExpandCollapse",this.rowExpandCollapse),this.parent.off("dataBoundArg",this.dataBoundArg),this.parent.grid.off("dblclick",this.dblClickHandler))},ar.prototype.rowExpandCollapse=function(t){var e,i=this.parent.getDataRows(),r=this.parent.getRows(),n=0<this.parent.getFrozenLeftColumnsCount()||0<this.parent.getFrozenRightColumnsCount();n&&(e=this.parent.getRows().filter(function(e){return e.querySelector(".e-gridrowindex"+t.record.index+"level"+(t.record.level+1))}));for(var o=t.detailrows.length?t.detailrows:i.filter(function(e){return e.querySelector(".e-gridrowindex"+t.record.index+"level"+(t.record.level+1))}),a=0;a<o.length;a++){var s=o[parseInt(a.toString(),10)],d=this.parent.grid.getRowObjectFromUID(s.getAttribute("data-Uid")).data,l=(!C.isNullOrUndefined(i)&&0<s.parentElement.firstElementChild.clientHeight&&(s.style.height=s.parentElement.firstElementChild.clientHeight+"px"),s.style.display=t.action,n&&e.length&&(e[parseInt(a.toString(),10)].style.display=t.action),"none"===t.action?".e-treecolumn-container .e-treegridcollapse":".e-treecolumn-container .e-treegridexpand");if(r[s.rowIndex].querySelector(l)){for(var p=[],h=0;h<i.length;h++)i[parseInt(h.toString(),10)].querySelector(".e-gridrowindex"+d.index+"level"+(d.level+1))&&p.push(i[parseInt(h.toString(),10)]);p.length&&(s=this.parent.getCurrentViewRecords()[p[0].rowIndex],this.rowExpandCollapse({detailrows:p,action:t.action,record:s}))}}},ar.prototype.dblClickHandler=function(e){I.parentsUntil(e.target,"e-rowcell")&&this.parent.grid.editSettings.allowEditOnDblClick&&"Cell"!==this.parent.editSettings.mode&&!e.target.classList.contains("e-treegridcollapse")&&!e.target.classList.contains("e-treegridexpand")&&this.parent.startEdit(I.parentsUntil(e.target,"e-row"))},ar.prototype.dataBoundArg=function(){this.parent.getColumns().filter(function(e){return e.showCheckbox}).length&&this.parent.freezeModule&&this.parent.initialRender&&C.addClass([this.parent.element.getElementsByClassName("e-grid")[0]],"e-checkselection")},ar.prototype.destroy=function(){this.removeEventListener()},ar.prototype.getModuleName=function(){return"freeze"};Yi=ar;function ar(e){I.Grid.Inject(I.Freeze),this.parent=e,this.addEventListener()}dr.prototype.openColumnChooser=function(e,t){return this.parent.grid.columnChooserModule.openColumnChooser(e,t)},dr.prototype.destroy=function(){},dr.prototype.getModuleName=function(){return"ColumnChooser"};var sr=dr;function dr(e){I.Grid.Inject(I.ColumnChooser),this.parent=e}q.prototype.getModuleName=function(){return"infiniteScroll"},q.prototype.addEventListener=function(){this.parent.on(ze,this.infinitePageAction,this),this.parent.on("infinite-remote-expand",this.infiniteRemoteExpand,this),this.parent.grid.on("delete-complete",this.infiniteDeleteHandler,this),this.parent.grid.on("infinite-edit-handler",this.infiniteEditHandler,this),this.parent.grid.on("infinite-crud-cancel",this.createRows,this),this.parent.grid.on("content-ready",this.contentready,this)},q.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("infinite-remote-expand",this.infiniteRemoteExpand),this.parent.grid.off("delete-complete",this.infiniteDeleteHandler),this.parent.grid.off("infinite-edit-handler",this.infiniteEditHandler),this.parent.off(ze,this.infinitePageAction),this.parent.grid.off("infinite-crud-cancel",this.createRows),this.parent.grid.off("content-ready",this.contentready))},q.prototype.infiniteRemoteExpand=function(e){for(var t=this.parent.grid.getRowsObject(),i=this.parent.grid.infiniteScrollModule.serviceLocator,r=new I.RowRenderer(i,null,this.parent.grid),n=this.parent.getRows(),o=e.index===n.length-1?"after":"before",a=this.parent.grid.getColumns(),s=this.parent.grid.infiniteScrollModule.generateRows(e.childData,e),d=[],l=0;l<s.length;l++)d.push(r.render(s[parseInt(l.toString(),10)],a));t.splice.apply(t,[e.index+1,0].concat(s));for(l=0;l<d.length;l++)("after"==o?n[e.index+l]:n[e.index+l+1])[o](d[parseInt(l.toString(),10)]),n.splice(e.index+1+l,0,d[parseInt(l.toString(),10)]);I.resetRowIndex(this.parent.grid,this.parent.grid.getRowsObject(),this.parent.grid.getRows(),0)},q.prototype.contentready=function(){var e;this.parent.infiniteScrollSettings.enableCache&&!C.isNullOrUndefined(this.parent.editModule)&&(this.parent.editModule[e="updateIndex"](this.parent.grid.dataSource,this.parent.getRows(),this.parent.getCurrentViewRecords()),this.parent.getFrozenColumns())&&this.parent.editModule[e](this.parent.grid.dataSource,this.parent.getDataRows(),this.parent.getCurrentViewRecords())},q.prototype.infinitePageAction=function(e){var t=new b.DataManager(e.result),i=new b.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),i=t.executeLocal((new b.Query).where(i)),r=C.getValue("actionArgs",e.actionArgs),n=C.getValue("actions",this.parent.grid.infiniteScrollModule);this.parent.grid.infiniteScrollModule.isInitialRender&&!this.parent.initialRender&&(this.parent.grid.pageSettings.currentPage=1);var o,a,s,d,l,n=!!n.some(function(e){return e===r.requestType})||!!this.parent.initialRender;this.visualData=i,e.count=i.length,C.getValue("isPrinting",e.actionArgs)?e.result=i:(l=new b.Query,(o=this.parent.infiniteScrollSettings.enableCache)&&this.parent.infiniteScrollSettings.initialBlocks>this.parent.infiniteScrollSettings.maxBlocks&&(this.parent.infiniteScrollSettings.initialBlocks=this.parent.infiniteScrollSettings.maxBlocks),n=n?this.parent.grid.pageSettings.pageSize*this.parent.infiniteScrollSettings.initialBlocks:this.parent.grid.pageSettings.pageSize,d=this.parent.grid.pageSettings.currentPage,l=C.isNullOrUndefined(r)?l.page(d,n):(a=C.getValue("lastIndex",this.parent.grid.infiniteScrollModule),s=C.getValue("firstIndex",this.parent.grid.infiniteScrollModule),o||"delete"!==r.requestType?o&&"delete"===r.requestType||"save"===r.requestType&&"add"===r.action?(l=l.skip(s)).take(this.parent.infiniteScrollSettings.initialBlocks*this.parent.pageSettings.pageSize):l.page(d,n):(s=a-r.data.length+1,d=r.data.length,l.skip(s).take(d))),t.dataSource.json=i,o||C.isNullOrUndefined(r)||"save"!==r.requestType||"add"!==r.action?e.result=t.executeLocal(l):e.result=[r.data]),this.parent.notify("updateAction",e)},q.prototype.infiniteEditHandler=function(e){var t=this.parent.grid.infiniteScrollModule.infiniteCurrentViewData,i=Object.keys(t);if("delete"===e.e.requestType&&1<e.result.length)for(var r=1;r<e.result.length;r++)t[i[i.length-1]].push(e.result[parseInt(r.toString(),10)])},q.prototype.infiniteDeleteHandler=function(e){var t,i,r;"delete"===e.requestType&&(r=this.parent.grid.getRowsObject(),i=this.parent.getRows(),e=e.data instanceof Array?e.data:[e.data],t=this.parent.grid.getPrimaryKeyFieldNames()[0],this.removeRows(i,r,e,t,!0),0<this.parent.getFrozenColumns())&&(i=this.parent.grid.getRowsObject(),r=this.parent.grid.getRows(),this.removeRows(r,i,e,t))},q.prototype.removeRows=function(r,n,o,a,s){for(var d=this,e=0;e<o.length;e++)!function(i){n.filter(function(e,t){e.data[""+a]===o[parseInt(i.toString(),10)][""+a]&&(s&&(e=Math.ceil((t+1)/d.parent.grid.pageSettings.pageSize),d.parent.grid.infiniteScrollModule.resetInfiniteCurrentViewData(e,t)),n.splice(t,1),C.remove(r[parseInt(t.toString(),10)]),r.splice(t,1))})}(e)},q.prototype.createRows=function(e){var t,i=e.args.e,r=e.row,n=this.parent.grid.infiniteScrollModule.serviceLocator,o=new I.RowRenderer(n,null,this.parent.grid),a=this.parent.getCurrentViewRecords(),s=e.isMovable?this.parent.grid.getRows():this.parent.grid.getDataRows(),d=(e.isFrozenRight?this.parent.element.querySelector(".e-frozen-right-content"):(this.parent.grid.isFrozenGrid()?(e.isMovable,this.parent.grid):this.parent).getContent()).querySelector("tbody");this.parent.frozenRows&&(d=e.isFrozenRows&&"add"!==this.parent.grid.infiniteScrollModule.requestType||!e.isFrozenRows&&"add"===this.parent.grid.infiniteScrollModule.requestType?(this.parent.grid.isFrozenGrid()?!e.isMovable&&e.isFrozenRight?this.parent.element.querySelector(".e-frozen-right-header"):this.parent.grid.getHeaderContent():this.parent.getHeaderContent()).querySelector("tbody"):d);for(var l="addRowIndex",p=this.parent.editModule[l],h=0;h<r.length;h++){var c=o.render(r[parseInt(h.toString(),10)],this.parent.grid.getColumns());"save"===i.requestType&&"add"===i.action?-1!==C.getValue("selectedIndex",this.parent.editModule)&&"Top"!==this.parent.editSettings.newRowPosition?"Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition?(t="after",p+=R(a[parseInt(p.toString(),10)]).length,"Child"===this.parent.editSettings.newRowPosition&&--p,s[parseInt(p.toString(),10)][""+t](c)):"Above"===this.parent.editSettings.newRowPosition&&s[this.parent.editModule[l]][""+(t="before")](c):"Bottom"===this.parent.editSettings.newRowPosition?d.appendChild(c):d.insertBefore(c,d.firstElementChild):"delete"===i.requestType&&d.appendChild(c)}e.cancel=!0},q.prototype.destroy=function(){this.removeEventListener()};var lr=q;function q(e){this.parent=e,I.Grid.Inject(I.InfiniteScroll),this.addEventListener()}r.Aggregate=Ti,r.AggregateColumn=$t,r.AggregateRow=a,r.Column=j,r.ColumnChooser=sr,r.ColumnMenu=zi,r.CommandColumn=Gi,r.ContextMenu=ji,r.DataManipulation=Qt,r.DetailRow=Ki,r.Edit=Hi,r.EditSettings=s,r.ExcelExport=Ei,r.Filter=Ci,r.FilterSettings=J,r.Freeze=Yi,r.InfiniteScroll=lr,r.InfiniteScrollSettings=oi,r.LoadingIndicator=Y,r.Logger=ce,r.Page=Ui,r.PageSettings=n,r.PdfExport=Ni,r.Predicate=ee,r.Render=Ht,r.Reorder=e,r.Resize=c,r.RowDD=Ii,r.RowDropSettings=xi,r.SearchSettings=oe,r.Selection=kt,r.SelectionSettings=zt,r.Sort=Bi,r.SortDescriptor=ai,r.SortSettings=p,r.StackedColumn=z,r.Toolbar=ki,r.TreeClipboard=Mt,r.TreeGrid=ui,r.TreeGridColumn=L,r.TreeVirtual=nr,r.TreeVirtualRowModelGenerator=Oi,r.VirtualScroll=tr,r.actionBegin=ve,r.actionComplete=Ce,r.actionFailure=d,r.ariaColIndex="aria-colindex",r.ariaRowIndex="aria-rowindex",r.autoCol=vt,r.batchAdd=et,r.batchCancel=Ze,r.batchDelete=$e,r.batchEditFormRendered="batcheditform-rendered",r.batchSave=nt,r.beforeBatchAdd=it,r.beforeBatchCancel=ct,r.beforeBatchDelete=tt,r.beforeBatchSave=rt,r.beforeCopy=_e,r.beforeDataBound=Re,r.beforeExcelExport=Ee,r.beforePaste=He,r.beforePdfExport=Ne,r.beforeStartEdit=ht,r.beginAdd=Ke,r.beginEdit=Qe,r.cellEdit=Xe,r.cellSave=Ye,r.cellSaved=Je,r.checkboxChange=Me,r.collapsed=qe,r.collapsing=Te,r.content="e-content",r.contextMenuClick=Fe,r.contextMenuOpen=je,r.crudAction=Ge,r.dataBound=we,r.dataColIndex="data-colindex",r.dataListener=lt,r.dataRowIndex=Dt,r.dataStateChange=xe,r.destroy=dt,r.detailDataBound=ut,r.doubleTap=at,r.expanded=Ue,r.expanding=ke,r.extendArray=D,r.findChildrenRecords=R,r.findParentRecords=Nt,r.frozenContent=bt,r.frozenHeader="e-frozenheader",r.frozenLeft="frozen-left",r.frozenRight="frozen-right",r.getExpandStatus=y,r.getParentData=x,r.getPlainData=At,r.headerContent="e-headercontent",r.indexModifier=pt,r.isCheckboxcolumn=Pt,r.isCountRequired=w,r.isFilterChildHierarchy=Et,r.isHidden=Ut,r.isOffline=v,r.isRemoteData=S,r.keyPressed=ot,r.leftRight="Left-Right",r.load=ye,r.localPagedExpandCollapse=Be,r.movableContent=Ct,r.movableHeader="e-movableheader",r.pagingActions=ze,r.printGridInit=Le,r.queryCellInfo=Ie,r.recordDoubleClick=We,r.remoteExpand=Ve,r.resizeStop=Ae,r.rowDataBound=Se,r.rowDeselected=Oe,r.rowDeselecting=xt,r.rowDrag=gt,r.rowDragStart=yt,r.rowDragStartHelper=ft,r.rowDrop=mt,r.rowDropped=Rt,r.rowSelected=De,r.rowSelecting=be,r.rowdraging=It,r.rowsAdd=St,r.rowsRemove=wt,r.savePreviousRowPosition="savePreviousRowPosition",r.table="e-table",r.toolbarClick=Pe,r.treeGridDetails=me,r.updateData="update-data",r.virtualActionArgs=st,r.virtualColumnIndex="virtualColumnIndex",Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-treegrid.umd.min.js.map
